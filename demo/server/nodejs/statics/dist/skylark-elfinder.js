/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
!function(e,t){var n=t.define,require=t.require,i="function"==typeof n&&n.amd,a=!i&&"undefined"!=typeof exports;if(!i&&!n){var o={};n=t.define=function(e,t,n){"function"==typeof n?(o[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),i=e.split("/");n.pop();for(var a=0;a<i.length;a++)"."!=i[a]&&(".."==i[a]?n.pop():n.push(i[a]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):o[e]={factory:null,resolved:!0,exports:n}},require=t.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=o[e];if(!module.resolved){var n=[];module.deps.forEach(function(e){n.push(require(e))}),module.exports=module.factory.apply(t,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-elfinder/elFinder",[],function(){var t,n,i,a,o,r,s,l,c,d,p,u,h=function(e,t,n){"use strict";var i,a,o,r,s,l,c,d,p,u,f,m,g,v,b,y,w,x,k,C,T,z=this,j=[],A=["button","tooltip"],O=$(e),I=$.extend(!0,{},$._data(O.get(0),"events")),M=$("<div/>").append(O.contents()).attr("class",O.attr("class")||"").attr("style",O.attr("style")||""),S=O.attr("id")||O.attr("id","elfauto"+$(".elfinder").length).attr("id"),F="elfinder-"+S,E="mousedown."+F,D="keydown."+F,U="keypress."+F,P="keyup."+F,q=!1,R=!1,H="",_={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,uploadOverwrite:!0,uploadMaxSize:0,jpgQuality:100,tmbCrop:!1,tmbReqCustomData:!1,tmb:!1},N={},L={},B={},W={},V=[],K={},X={},G=[],J={},Y=[],Q=[],Z=new z.command(z),ee="auto",te=400,ne=null,ie="sounds/",ae="",oe=!1,re=$(document.createElement("audio")).hide().appendTo("body")[0],se=0,le="",ce=null,de=function(e){var t,n,i,a,o,r,s,l={},c={};z.api>=2.1?(z.commandMap=e.options.uiCmdMap&&Object.keys(e.options.uiCmdMap).length?e.options.uiCmdMap:{},le!==JSON.stringify(z.commandMap)&&(le=JSON.stringify(z.commandMap))):z.options.sync=0,e.init?(L={},W={}):(o=H,t="elfinder-subtree-loaded "+z.res("class","navexpand"),z.res("class","navcollapse"),n=Object.keys(L),i=function(e){if(!L[e])return!0;var n="directory"===L[e].mime,i=L[e].phash;!(!n||l[i]||!c[i]&&z.navHash2Elm(L[e].hash).is(":hidden")&&z.navHash2Elm(i).next(".elfinder-navbar-subtree").children().length>100)||!n&&i===H||J[e]?n&&(c[i]=!0):(n&&!l[i]&&(l[i]=!0,z.navHash2Elm(i).removeClass(t).next(".elfinder-navbar-subtree").empty()),he(L[e]))},a=function(){n.length&&(ce&&ce._abort(),ce=z.asyncJob(i,n,{interval:20,numPerOnce:100}).done(function(){var e=z.storage("hide")||{items:{}};Object.keys(B).length&&$.each(B,function(t){e.items[t]||delete B[t]})}))},z.trigger("filesgc").one("filesgc",function(){n=[]}),z.one("opendone",function(){o!==H&&(O.data("lazycnt")?z.one("lazydone",a):a())})),z.sorters={},H=e.cwd.hash,pe(e.files),L[H]?(s=z.diff([e.cwd],!0)).changed.length&&(pe(s.changed,"change"),z.change({changed:s.changed})):pe([e.cwd]),e.changed&&e.changed.length&&pe(e.changed,"change"),r=JSON.stringify(z.sorters),ae!==r&&(z.trigger("sorterupdate"),ae=r),z.lastDir(H),z.autoSync()},pe=function(e,t){var n,i,a,o,r,t=t||"files",s=["sizeInfo","encoding"],l={name:!0,perm:!0,date:!0,size:!0,kind:!0},c=!z.sorters._checked&&"files"===t,d=e.length,p=function(e){var t=e||{},n=[];$.each(z.sortRules,function(e){(l[e]||void 0!==t[e]||"mode"===e&&void 0!==t.perm)&&n.push(e)}),z.sorters=z.arrayFlip(n,!0),z.sorters._checked=!0},u={},h=z.storage("hide")||{},f=h.items||{};for(i=0;i<d;i++)if(n=Object.assign({},e[i]),r=!(h.show||!f[n.hash]),n.name&&n.hash&&n.mime){if(r||(c&&n.phash===H&&(p(n),c=!1),!n.phash||"add"!==t&&("change"!==t||L[n.hash]&&n.size===L[n.hash])||(o=z.parents(n.phash))&&$.each(o,function(){u[this]=!0})),L[n.hash]){for(a=0;a<s.length;a++)L[n.hash][s[a]]&&!n[s[a]]&&(n[s[a]]=L[n.hash][s[a]]);n.sizeInfo&&!n.size&&(n.size=n.sizeInfo.size),he(L[n.hash],!0)}f[n.hash]&&(B[n.hash]=n),r?(d--,e.splice(i--,1)):(L[n.hash]=n,"directory"!==n.mime||W[n.hash]||(W[n.hash]={}),n.phash&&(W[n.phash]||(W[n.phash]={}),W[n.phash][n.hash]=!0))}$.each(Object.keys(u),function(){var e=L[this];e&&e.sizeInfo&&delete e.sizeInfo}),c&&p()},ue=function(e){var t,n=e.length,i={},a=function(e){var n=L[e];n&&("directory"===n.mime&&(i[e]&&delete z.roots[i[e]],$.each(z.leafRoots,function(t,n){var i,a;-1!==(i=$.inArray(e,n))&&(1===n.length?((a=Object.assign({},L[t]))&&a._realStats&&($.each(a._realStats,function(e,t){a[e]=t}),ue(L[t]._realStats),z.change({changed:[a]})),delete z.leafRoots[t]):z.leafRoots[t].splice(i,1))}),z.searchStatus.state<2&&$.each(L,function(t,n){n.phash==e&&a(t)})),n.phash&&(t=z.parents(n.phash))&&$.each(t,function(){o[this]=!0}),he(L[e]))},o={};for($.each(z.roots,function(e,t){i[t]=e});n--;)a(e[n]);$.each(Object.keys(o),function(){var e=L[this];e&&e.sizeInfo&&delete e.sizeInfo})},he=function(e,t){var n=e.hash,i=e.phash;i&&W[i]&&delete W[i][n],t||(W[n]&&delete W[n],z.optionsByHashes[n]&&delete z.optionsByHashes[n]),delete L[n]},fe=0,me=[],ge=null,ve=function(e){var t,n=e.keyCode,i=!(!e.ctrlKey&&!e.metaKey),a="mousedown"===e.type;!a&&(z.keyState.keyCode=n),z.keyState.ctrlKey=i,z.keyState.shiftKey=e.shiftKey,z.keyState.metaKey=e.metaKey,z.keyState.altKey=e.altKey,a||("keyup"!==e.type?q&&($.each(X,function(t,a){a.type==e.type&&a.keyCode==n&&a.shiftKey==e.shiftKey&&a.ctrlKey==i&&a.altKey==e.altKey&&(e.preventDefault(),e.stopPropagation(),a.callback(e,z),z.debug("shortcut-exec",t+" : "+a.description))}),n!=$.ui.keyCode.TAB||$(e.target).is(":input")||e.preventDefault(),"keydown"===e.type&&n==$.ui.keyCode.ESCAPE&&(O.find(".ui-widget:visible").length||z.clipboard().length&&z.clipboard([]),$.ui.ddmanager&&(t=$.ui.ddmanager.current)&&t.helper&&t.cancel(),z.toHide(O.find(".ui-widget.elfinder-button-menu.elfinder-frontmost:visible")),z.trigger("keydownEsc",e))):z.keyState.keyCode=null)},be=new Date,ye=window.parent!==window,we=function(){var e,t;if(ye)try{(t=$("iframe",window.parent.document)).length&&$.each(t,function(t,n){if(n.contentWindow===window)return e=$(n),!1})}catch(e){}return e}();t||(t={}),z.UA.Mobile&&$(window).on("orientationchange."+F,function(){var e=(screen&&screen.orientation&&screen.orientation.angle||window.orientation||0)+0;-90===e&&(e=270),z.UA.Angle=e,z.UA.Rotated=e%180!=0}).trigger("orientationchange."+F),t.bootCallback&&"function"==typeof t.bootCallback&&(d=n,p=t.bootCallback,n=function(e,t){d&&"function"==typeof d&&d.call(this,e,t),p.call(this,e,t)}),delete t.bootCallback,this.api=null,this.newAPI=!1,this.oldAPI=!1,this.netDrivers=[],this.baseUrl="",this.i18nBaseUrl="",this.cssloaded=!1,this.theme=null,this.mimesCanMakeEmpty={},this.bootCallback,this.reloadCallback,this.id=S,this.storage=function(){try{return"localStorage"in window&&null!==window.localStorage?(z.UA.Safari&&(window.localStorage.setItem("elfstoragecheck",1),window.localStorage.removeItem("elfstoragecheck")),z.localStorage):z.cookie}catch(e){return z.cookie}}(),this.pauseUnloadCheck=function(e,t){if(void 0===e)return oe;oe=!!e,e&&!t&&requestAnimationFrame(function(){oe=!1})},this.options=Object.assign({},this._options),t.uiOptions&&t.uiOptions.toolbar&&Array.isArray(t.uiOptions.toolbar)&&$.isPlainObject(t.uiOptions.toolbar[t.uiOptions.toolbar.length-1])&&(z.options.uiOptions.toolbarExtra=Object.assign(z.options.uiOptions.toolbarExtra||{},t.uiOptions.toolbar.pop())),(u=function(e,t){$.isPlainObject(e)&&$.each(e,function(e,n){$.isPlainObject(n)?(t[e]||(t[e]={}),u(n,t[e])):t[e]=n})})(t,z.options),this.options.uiOptions.toolbar.push(this.options.uiOptions.toolbarExtra),delete this.options.uiOptions.toolbarExtra,this.toUnbindEvents={},this.bind=function(e,t,n){var i,a;if(t&&("function"==typeof t||"function"==typeof t.done))for(e=(""+e).toLowerCase().replace(/^\s+|\s+$/g,"").split(/\s+/),a=e.length,i=0;i<a;i++)void 0===K[e[i]]&&(K[e[i]]=[]),K[e[i]][n?"unshift":"push"](t);return this},this.unbind=function(e,t){var n,i,a,o;for(e=(""+e).toLowerCase().split(/\s+/),i=e.length,n=0;n<i;n++)(a=K[e[n]])&&(o=$.inArray(t,a))>-1&&a.splice(o,1);return t=null,this},this.trigger=function(e,t,n){var i,a,o,r,s=e.toLowerCase(),l="object"==typeof t,c=K[s]||[],d=[];if(this.debug("event-"+s,t),l&&void 0!==n||(n=!0),a=c.length){for(r=$.Event(s),t&&(t._getEvent=function(){return r}),n&&(r.data=t),i=0;i<a;i++)if(c[i])if(c[i].done)d.push(c[i].done);else{if(c[i].length&&!n){if(void 0===o)try{o=JSON.stringify(t)}catch(e){o=!1}r.data=o?JSON.parse(o):t}try{if(!1===c[i].call(r,r,this)||r.isDefaultPrevented()){this.debug("event-stoped",r.type);break}}catch(e){window.console&&window.console.log&&window.console.log(e)}}if(a=d.length)for(i=0;i<a;i++)try{if(!1===d[i].call(r,r,this)||r.isDefaultPrevented()){this.debug("event-stoped",r.type+"(done)");break}}catch(e){window.console&&window.console.log&&window.console.log(e)}this.toUnbindEvents[s]&&this.toUnbindEvents[s].length&&($.each(this.toUnbindEvents[s],function(e,t){z.unbind(t.type,t.callback)}),delete this.toUnbindEvents[s])}return this},this.getListeners=function(e){return e?K[e.toLowerCase()]:K},this.baseUrl=function(){var e,t,n;return z.options.baseUrl?z.options.baseUrl:(n="",e=null,$("head > script").each(function(){if(this.src&&this.src.match(/js\/elfinder(?:-[a-z0-9_-]+)?\.(?:min|full)\.js$/i))return e=$(this),!1}),e&&((n=e.attr("src").replace(/js\/[^\/]+$/,"")).match(/^(https?\/\/|\/)/)||(t=$("head > base[href]").attr("href"))&&(n=t.replace(/\/$/,"")+"/"+n)),""!==n?z.options.baseUrl=n:(z.options.baseUrl||(z.options.baseUrl="./"),n=z.options.baseUrl),n)}(),this.i18nBaseUrl=(this.options.i18nBaseUrl||this.baseUrl+"js/i18n").replace(/\/$/,"")+"/",this.options.maxErrorDialogs=Math.max(1,parseInt(this.options.maxErrorDialogs||5)),_.dispInlineRegex=this.options.dispInlineRegex,this.options.cssAutoLoad&&(f=z.baseUrl,m=$('head > link[href$="css/elfinder.min.css"],link[href$="css/elfinder.full.css"]:first').length,g=function(){O.data("cssautoloadHide")&&(O.data("cssautoloadHide").remove(),O.removeData("cssautoloadHide"))},v=function(){z.cssloaded||(g(),z.cssloaded=!0,z.trigger("cssloaded"))},m||(z.cssloaded=null),Array.isArray(z.options.cssAutoLoad)&&(z.options.themes.default?!0===z.cssloaded?z.loadCss(z.options.cssAutoLoad):z.bind("cssloaded",function(){z.loadCss(z.options.cssAutoLoad)}):(z.options.themes=Object.assign({default:{name:"default",cssurls:z.options.cssAutoLoad}},z.options.themes),z.options.theme||(z.options.theme="default"))),null===z.cssloaded&&(O.addClass("elfinder").data("cssautoloadHide",$("<style>.elfinder{visibility:hidden;overflow:hidden}</style>")),$("head").append(O.data("cssautoloadHide")),z.options.themes.default||(z.options.themes=Object.assign({default:{name:"default",cssurls:"css/theme.css",author:"elFinder Project",license:"3-clauses BSD"}},z.options.themes),z.options.theme||(z.options.theme="default")),requestAnimationFrame(function(){"hidden"===O.css("visibility")?z.loadCss([f+"css/elfinder.min.css"],{dfd:$.Deferred().done(function(){v()}).fail(function(){g(),z.cssloaded||(z.cssloaded=!1,z.bind("init",function(){z.cssloaded||z.error(["errRead","CSS (elfinder.min)"])}))})}):v()}))),y=z.options.themes,(w=Object.keys(y||{})).length&&(b=z.storage("theme")||z.options.theme,y[b]||(b=w[0]),z.cssloaded?z.changeTheme(b):z.bind("cssloaded",function(){z.changeTheme(b)})),this.optionProperties={icon:void 0,csscls:void 0,tmbUrl:void 0,uiCmdMap:{},netkey:void 0,disabled:[]},ye||this.options.enableAlways||2!==$("body").children().length||(this.options.enableAlways=!0),!0===this.options.debug?this.options.debug="all":Array.isArray(this.options.debug)?(x={},$.each(z.options.debug,function(){x[this]=!0}),z.options.debug=x):this.options.debug=!1,this.noConflicts={},this.noConflict=function(){$.each(A,function(e,t){$.fn[t]&&"function"==typeof $.fn[t].noConflict&&(z.noConflicts[t]=$.fn[t].noConflict())})},this.noConflict(),this.isCORS=!1,function(){if(void 0!==z.options.cors&&null!==z.options.cors)z.isCORS=!!z.options.cors;else{var e,n=document.createElement("a"),i=window.location.protocol,a=function(e){return"https:"===(e=e&&":"!==e?e:i)?/\:443$/:/\:80$/},o=window.location.host.replace(a(i),"");n.href=t.url,t.urlUpload&&t.urlUpload!==t.url&&((e=document.createElement("a")).href=t.urlUpload),(o!==n.host.replace(a(n.protocol),"")||":"!==n.protocol&&""!==n.protocol&&i!==n.protocol||e&&(o!==e.host.replace(a(e.protocol),"")||":"!==e.protocol&&""!==e.protocol&&i!==e.protocol))&&(z.isCORS=!0)}z.isCORS&&($.isPlainObject(z.options.customHeaders)||(z.options.customHeaders={}),$.isPlainObject(z.options.xhrFields)||(z.options.xhrFields={}),z.options.requestType="post",z.options.customHeaders["X-Requested-With"]="XMLHttpRequest",z.options.xhrFields.withCredentials=!0)}(),this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",o=Math.max(parseInt(this.options.requestMaxConn),1),this.optsCustomData=$.isPlainObject(this.options.customData)?this.options.customData:{},this.customData=Object.assign({},this.optsCustomData),this.prevCustomData=null,this.customHeaders=$.isPlainObject(this.options.customHeaders)?this.options.customHeaders:{},this.xhrFields=$.isPlainObject(this.options.xhrFields)?this.options.xhrFields:{},this.replaceXhrSend=function(){c||(c=XMLHttpRequest.prototype.send),XMLHttpRequest.prototype.send=function(){var e=this;return z.customHeaders&&$.each(z.customHeaders,function(t){e.setRequestHeader(t,this)}),z.xhrFields&&$.each(z.xhrFields,function(t){t in e&&(e[t]=this)}),c.apply(this,arguments)}},this.restoreXhrSend=function(){c&&(XMLHttpRequest.prototype.send=c)},this.abortCmdsOnOpen=this.options.abortCmdsOnOpen||["tmb","parents"],this.navPrefix="nav"+(h.prototype.uniqueid?h.prototype.uniqueid:"")+"-",this.cwdPrefix=h.prototype.uniqueid?"cwd"+h.prototype.uniqueid+"-":"",++h.prototype.uniqueid,this.uploadURL=t.urlUpload||t.url,this.namespace=F,this.today=new Date(be.getFullYear(),be.getMonth(),be.getDate()).getTime()/1e3,this.yesterday=this.today-86400,r=this.options.UTCDate?"UTC":"",this.getHours="get"+r+"Hours",this.getMinutes="get"+r+"Minutes",this.getSeconds="get"+r+"Seconds",this.getDate="get"+r+"Date",this.getDay="get"+r+"Day",this.getMonth="get"+r+"Month",this.getFullYear="get"+r+"FullYear",this.zIndex,this.searchStatus={state:0,query:"",target:"",mime:"",mixed:!1,ininc:!1},this.lang=this.storage("lang")||this.options.lang,"jp"===this.lang&&(this.lang=this.options.lang="ja"),this.viewType=this.storage("view")||this.options.defaultView||"icons",this.sortType=this.storage("sortType")||this.options.sortType||"name",this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc",this.sortStickFolders=this.storage("sortStickFolders"),null===this.sortStickFolders?this.sortStickFolders=!!this.options.sortStickFolders:this.sortStickFolders=!!this.sortStickFolders,this.sortAlsoTreeview=this.storage("sortAlsoTreeview"),null===this.sortAlsoTreeview||null===this.options.sortAlsoTreeview?this.sortAlsoTreeview=!!this.options.sortAlsoTreeview:this.sortAlsoTreeview=!!this.sortAlsoTreeview,this.sortRules=$.extend(!0,{},this._sortRules,this.options.sortRules),$.each(this.sortRules,function(e,t){"function"!=typeof t&&delete z.sortRules[e]}),this.compare=$.proxy(this.compare,this),this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500,this.draggingUiHelper=null,this.droppable={greedy:!0,tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename",hoverClass:this.res("class","adroppable"),classes:{"ui-droppable-hover":this.res("class","adroppable")},autoDisable:!0,drop:function(e,t){var n,i,a,o=$(this),r=$.grep(t.helper.data("files")||[],function(e){return!!e}),s=[],l=[],c=[],d=t.helper.hasClass("elfinder-drag-helper-plus"),p="class";if(void 0===e.button||t.helper.data("namespace")!==F||!z.insideWorkzone(e.pageX,e.pageY))return!1;for(i=o.hasClass(z.res(p,"cwdfile"))?z.cwdId2Hash(o.attr("id")):o.hasClass(z.res(p,"navdir"))?z.navId2Hash(o.attr("id")):H,n=r.length;n--;)(a=r[n])!=i&&L[a].phash!=i?s.push(a):(d&&a!==i&&L[i].write?l:c).push(a);if(c.length)return!1;t.helper.data("droped",!0),l.length&&(t.helper.hide(),z.exec("duplicate",l,{_userAction:!0})),s.length&&(t.helper.hide(),z.clipboard(s,!d),z.exec("paste",i,{_userAction:!0},i).always(function(){z.clipboard([]),z.trigger("unlockfiles",{files:r})}),z.trigger("drop",{files:r}))}},this.enabled=function(){return q&&this.visible()},this.visible=function(){return O[0].elfinder&&O.is(":visible")},this.isRoot=function(e){return!(!e.isroot&&e.phash)},this.root=function(e,t){var n,i;if(e=e||H,!t&&($.each(z.roots,function(t,i){if(0===e.indexOf(t))return n=i,!1}),n))return n;for(n=L[e];n&&n.phash&&(t||!n.isroot);)n=L[n.phash];if(n)return n.hash;for(;i in L&&L.hasOwnProperty(i);)if("directory"===(n=L[i]).mime&&!n.phash&&n.read)return n.hash;return""},this.cwd=function(){return L[H]||{}},this.option=function(e,t){var n,i;return t=t||H,z.optionsByHashes[t]&&void 0!==z.optionsByHashes[t][e]?z.optionsByHashes[t][e]:!z.hasVolOptions||H===t||(i=z.file(t))&&i.phash===H?N[e]||"":(n="",$.each(z.volOptions,function(i,a){if(0===t.indexOf(i))return n=a[e]||"",!1}),n)},this.getDisabledCmds=function(e,t){var n={hidden:!0};return Array.isArray(e)||(e=[e]),$.each(e,function(e,t){var i=z.option("disabledFlip",t);i&&Object.assign(n,i)}),t?n:Object.keys(n)},this.file=function(e,t){return e?L[e]||(t?B[e]:void 0):void 0},this.files=function(e){var t={};return e?W[e]?($.each(W[e],function(n){L[n]?t[n]=L[n]:delete W[e][n]}),Object.assign({},t)):{}:Object.assign({},L)},this.parents=function(e){for(var t,n=[];e&&(t=this.file(e));)n.unshift(t.hash),e=t.phash;return n},this.path2array=function(e,t){for(var n,i=[];e;){if(!(n=L[e])||!n.hash){i=[];break}i.unshift(t&&n.i18?n.i18:n.name),e=n.isroot?null:n.phash}return i},this.path=function(e,t,n){var i=L[e]&&L[e].path?L[e].path:this.path2array(e,t).join(N.separator);if(n&&L[e]){n=Object.assign({notify:{type:"parents",cnt:1,hideCnt:!0}},n);var a,o=$.Deferred(),r=n.notify,s=!1,l=function(){z.request({data:{cmd:"parents",target:L[e].phash},notify:r,preventFail:!0}).done(c).fail(function(){o.reject()})},c=function(){z.one("parentsdone",function(){""===(i=z.path(e,t))&&s?(s=!1,l()):(r&&(clearTimeout(a),r.cnt=-parseInt(r.cnt||0),z.notify(r)),o.resolve(i))})};return i?o.resolve(i):(z.ui.tree?(r&&(a=setTimeout(function(){z.notify(r)},z.notifyDelay)),s=!0,c(!0)):l(),o)}return i},this.url=function(e,t){var n,i=L[e],a=t||{},o=a.async||!1,r=a.temporary||!1,s=a.onetime&&z.option("onetimeUrl",e)||!1,l=a.absurl||!1,c=o||s?$.Deferred():null,d=function(e){return e&&l&&(e=z.convAbsUrl(e)),e},p=function(t){if(t)return d(t);if(i.url)return d(i.url);if(void 0===n&&(n=u()),n)return d(n+$.map(z.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/"));var a=Object.assign({},z.customData,{cmd:"file",target:i.hash});return z.oldAPI&&(a.cmd="open",a.current=i.phash),d(z.options.url+(-1===z.options.url.indexOf("?")?"?":"&")+$.param(a,!0))},u=function(){return z.option("url",!z.isRoot(i)&&i.phash||i.hash)};if(!i||!i.read)return o?c.resolve(""):"";if(!s||i.url&&"1"!=i.url||(n=u()))if("1"==i.url||r&&!i.url&&!(n=u()))this.request({data:{cmd:"url",target:e,options:{temporary:r?1:0}},preventDefault:!0,options:{async:o},notify:o?{type:r?"file":"url",cnt:1,hideCnt:!0}:{},progressBar:a.progressBar}).done(function(e){i.url=e.url||""}).fail(function(){i.url=""}).always(function(){var e;if(i.url&&r&&(e=i.url,i.url="1"),!o)return p(e);c.resolve(p(e))});else{if(!o)return p();c.resolve(p())}else o=!0,this.request({data:{cmd:"url",target:e,options:{onetime:1}},preventDefault:!0,options:{async:o},notify:{type:"file",cnt:1,hideCnt:!0},progressBar:a.progressBar}).done(function(e){c.resolve(d(e.url||""))}).fail(function(){c.resolve("")});return o?c:void 0},this.forExternalUrl=function(e,t){var n=z.option("onetimeUrl",e),i={async:!0,absurl:!0};return i[n?"onetime":"temporary"]=!0,z.url(e,Object.assign({},t,i))},this.openUrl=function(e,t,n,i){var a=L[e],o="",r=(i||{}).onetimeSize||5242880;return a&&a.read?t&&"sameorigin"!==t||(a.url?1!=a.url&&(o=a.url):N.url&&0===a.hash.indexOf(z.cwd().volumeid)&&(o=N.url+$.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/")),t&&!this.isSameOrigin(o)||!o)?n&&this.hasParrotHeaders()?(i?delete i.onetimeSize:i={},!i.onetime&&!i.temporary&&a.size>r&&(a.mime.match(/^video|audio/)?i.temporary=!0:i.onetime=!0),i.onetime||i.temporary?this.url(a.hash,Object.assign({async:!0},i)).done(function(e){n(e)}).fail(function(){n("")}):this.getContents(e,"blob",i).done(function(e){o=(window.URL||window.webkitURL).createObjectURL(e),n(o)}).fail(function(){n("")})):(o=(o=this.options.url)+(-1===o.indexOf("?")?"?":"&")+(this.oldAPI?"cmd=open&current="+a.phash:"cmd=file")+"&target="+a.hash+"&_t="+(a.ts||parseInt(+new Date/1e3)),!0===t&&(o+="&download=1"),$.each(this.customData,function(e,t){o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n?void n(o):o):(o+=(o.match(/\?/)?"&":"?")+"_".repeat((o.match(/[\?&](_+)t=/g)||["&t="]).sort().shift().match(/[\?&](_*)t=/)[1].length+1)+"t="+(a.ts||parseInt(+new Date/1e3)),n?void n(o):o):""},this.tmb=function(e){var t,n,i="elfinder-cwd-bgurl",a="",o={},r=0;return!(!$.isPlainObject(e)||(z.searchStatus.state&&0!==e.hash.indexOf(z.cwd().volumeid)?(t=z.option("tmbUrl",e.hash),n=z.option("tmbCrop",e.hash)):(t=N.tmbUrl,n=N.tmbCrop),n&&(i+=" elfinder-cwd-bgurl-crop"),"self"===t&&0===e.mime.indexOf("image/")?(a=z.openUrl(e.hash),i+=" elfinder-cwd-bgself"):(z.oldAPI||t)&&e&&e.tmb&&1!=e.tmb?a=t+e.tmb:z.newAPI&&e&&e.tmb&&1!=e.tmb&&(a=e.tmb),!a))&&("self"!==t&&(e.ts&&(o._t=e.ts),N.tmbReqCustomData&&Object.keys(this.customData).length&&(o=Object.assign(o,this.customData)),Object.keys(o).length&&(a+=a.match(/\?/)?"&":"?",$.each(o,function(e,t){a+=(0==r++?"":"&")+encodeURIComponent(e)+"="+encodeURIComponent(t)}))),{url:a,className:i})},this.selected=function(){return V.slice(0)},this.selectedFiles=function(){return $.map(V,function(e){return L[e]?Object.assign({},L[e]):null})},this.fileByName=function(e,t){var n;for(n in L)if(L.hasOwnProperty(n)&&L[n].phash==t&&L[n].name==e)return L[n]},this.validResponse=function(e,t){return t.error||this.rules[this.rules[e]?e:"defaults"](t)},this.returnBytes=function(e){var t;return isNaN(e)?(e||(e=""),e=e.replace(/b$/i,""),t=e.charAt(e.length-1).toLowerCase(),e=e.replace(/[tgmk]$/i,""),"t"==t?e=1024*e*1024*1024*1024:"g"==t?e=1024*e*1024*1024:"m"==t?e=1024*e*1024:"k"==t&&(e*=1024),e=isNaN(e)?0:parseInt(e)):(e=parseInt(e))<1&&(e=0),e},this.request=function(e){var t,n,i,a,r=this,s=this.options,l=$.Deferred(),c=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),d=Object.assign({},r.customData,{mimes:s.onlyMimes},e.data||e),p=d.cmd,u="binary"===(e.options||{}).dataType,h=!e.asNotOpen&&"open"===p,f=!(u||e.preventDefault||e.preventFail),m=!(u||e.preventDefault||e.preventDone),g=e.progressVal||20,v=null,b=!1,y=e.progressBar?{}:e.notify?Object.assign({progress:g*e.notify.cnt},e.notify):{},w=!!e.cancel,x=u||!!e.raw,k=e.syncOnFail,C=!!e.lazy,T=e.prepare,z=e.navigate,j=(e.options||{}).cache,A=Object.assign({url:s.url,async:!0,type:this.requestType,dataType:"json",cache:r.api>=2.1029,data:d,headers:this.customHeaders,xhrFields:this.xhrFields,progress:function(t){var n=t.loaded/t.total*100;if(v&&clearTimeout(v),e.progressBar)try{e.progressBar.width(n+"%")}catch(t){}else b&&y.type&&(n*=y.cnt,g<n&&(r.notify({type:y.type,progress:n-g,cnt:0,hideCnt:y.hideCnt}),g=n));if(e.progress)try{e.progress(t)}catch(t){}}},e.options||{}),O=function(e){e.warning&&r.error(e.warning),h?de(e):r.updateCache(e),r.lazy(function(){e.removed&&e.removed.length&&r.remove(e),e.added&&e.added.length&&r.add(e),e.changed&&e.changed.length&&r.change(e)}).then(function(){return r.lazy(function(){r.trigger(p,e,!1)})}).then(function(){return r.lazy(function(){r.trigger(p+"done")})}).then(function(){e.toasts&&Array.isArray(e.toasts)&&$.each(e.toasts,function(){this.msg&&r.toast(this)}),e.sync&&r.sync()})},I=function(e,t){var n,i,a=r.options.debug;switch(t){case"abort":n=e.quiet?"":["errConnect","errAbort"];break;case"timeout":n=["errConnect","errTimeout"];break;case"parsererror":n=["errResponse","errDataNotJSON"],e.responseText&&(!H||a&&("all"===a||a["backend-error"]))&&n.push(e.responseText);break;default:if(e.responseText)try{(i=JSON.parse(e.responseText))&&i.error&&(n=i.error)}catch(e){}if(!n)if(403==e.status)n=["errConnect","errAccess","HTTP error "+e.status];else if(404==e.status)n=["errConnect","errNotFound","HTTP error "+e.status];else if(e.status>=500)n=["errResponse","errServerError","HTTP error "+e.status];else{if(414==e.status&&"get"===A.type)return A.type="post",r.abortXHR(e),void(l.xhr=e=r.transport.send(A).fail(n).done(M));n=e.quiet?"":["errConnect","HTTP error "+e.status]}}r.trigger(p+"done"),l.reject({error:n},e,t)},M=function(e){if(r.currentReqCmd=p,e.debug&&r.responseDebug(e),r.setCustomHeaderByXhr(n),x)return r.abortXHR(n),e&&e.debug&&r.debug("backend-debug",e),l.resolve(e);if(!e)return l.reject({error:["errResponse","errDataEmpty"]},n,e);if(!$.isPlainObject(e))return l.reject({error:["errResponse","errDataNotJSON"]},n,e);if(e.error)return h&&$.each(r.leafRoots,function(e,t){r.leafRoots[e]=$.grep(t,function(e){return e!==d.target})}),l.reject({error:e.error},n,e);var t=function(){var t,i=function(t){r.leafRoots[d.target]&&e[t]&&$.each(r.leafRoots[d.target],function(n,i){var a;(a=r.file(i))&&e[t].push(a)})},a=function(){r.textMimes={},$.each(r.res("mimes","text"),function(){r.textMimes[this.toLowerCase()]=!0})};if(h?i("files"):"tree"===p&&i("tree"),e=r.normalize(e),!r.validResponse(p,e))return l.reject({error:e.norError||"errResponse"},n,e);h&&(r.api||(r.api=e.api||1,"2.0"==r.api&&void 0!==e.options.uploadMaxSize&&(r.api="2.1"),r.newAPI=r.api>=2,r.oldAPI=!r.newAPI),e.textMimes&&Array.isArray(e.textMimes)&&(r.resources.mimes.text=e.textMimes,a()),!r.textMimes&&a(),e.options&&(N=Object.assign({},_,e.options)),e.netDrivers&&(r.netDrivers=e.netDrivers),e.maxTargets&&(r.maxTargets=e.maxTargets),d.init&&(r.uplMaxSize=r.returnBytes(e.uplMaxSize),r.uplMaxFile=e.uplMaxFile?Math.min(parseInt(e.uplMaxFile),50):20)),"function"==typeof T&&T(e),z&&(t=z.target||"added",e[t]&&e[t].length&&r.one(p+"done",function(){var n=e[t],i=r.findCwdNodes(n),a=function(){var e=r.cwd().hash;return $.map(n,function(t){return t.phash&&e===t.phash?t.hash:null})},o=a(),s=function(e){var t,n,i,s=void 0,l=e.action?e.action.data:void 0;return(l||o.length)&&e.action&&(n=e.action.msg)&&(t=e.action.cmd)&&(!e.action.cwdNot||e.action.cwdNot!==r.cwd().hash)&&(i=e.action.done,l=e.action.data,s=$("<div/>").append($('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+r.i18n(n)+"</span></button>").on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){r.exec(t,l||o,{_userAction:!0,_currentType:"toast",_currentNode:$(this)}),i&&r.one(t+"done",function(){"function"==typeof i?i():"select"===i&&r.trigger("selectfiles",{files:a()})})}))),delete e.action,e.extNode=s,e};z.toast||(z.toast={}),!z.noselect&&r.trigger("selectfiles",{files:r.searchStatus.state>1?$.map(n,function(e){return e.hash}):o}),i.length?(z.noscroll||(i.first().trigger("scrolltoview",{blink:!1}),r.resources.blink(i,"lookme")),$.isPlainObject(z.toast.incwd)&&r.toast(s(z.toast.incwd))):$.isPlainObject(z.toast.inbuffer)&&r.toast(s(z.toast.inbuffer))})),l.resolve(e),e.debug&&r.debug("backend-debug",e)};r.abortXHR(n),C?r.lazy(t):t()},S=function(e){n&&"pending"===n.state()&&(r.abortXHR(n,{quiet:!0,abort:!0}),(!e||"unload"!==e.type&&"destroy"!==e.type)&&r.autoSync())},F=function(e){if(r.trigger(p+"done"),"autosync"==e.type){if("stop"!=e.data.action)return}else if(!("unload"==e.type||"destroy"==e.type||"openxhrabort"==e.type||e.data.added&&e.data.added.length))return;S(e)},E=function(e){var t=function(){k=!1,l.reject()};if(e&&"cmd"===e)return p;if(h){if(ge&&"pending"===ge.state()){if(ge._target===d.target)return l.reject("openabort");ge.xhr?ge.xhr.queueAbort():ge.reject("openabort")}(ge=l)._target=d.target}if(l.always(function(){delete A.headers["X-elFinderReqid"],h&&(ge=null)}).fail(function(e,t,n){var i,o;h&&"openabort"===e&&(e="",k=!1),i={cmd:p,err:e,xhr:t,rc:n},0===e&&me.length&&(me=$.grep(me,function(e){return e("cmd")!==p})),r.trigger("requestError",i),i._getEvent&&i._getEvent().isDefaultPrevented()&&(f=!1,k=!1,e&&(e.error="")),S(),h&&(a=r.file(d.target))&&a.volumeid&&r.isRoot(a)&&delete r.volumeExpires[a.volumeid],r.trigger(p+"fail",n),(o="object"==typeof e?e.error:e)&&(f?r.error(o):r.debug("error",r.i18n(o))),k&&r.sync()}),!p)return k=!1,l.reject({error:"errCmdReq"});if(r.maxTargets&&d.targets&&d.targets.length>r.maxTargets)return k=!1,l.reject({error:["errMaxTargets",r.maxTargets]});if(m&&l.done(O),h){for(;i=Y.pop();)i.queueAbort();if(H!==d.target)for(;i=Q.pop();)i.queueAbort()}return-1!==$.inArray(p,(r.cmdsToAdd+" autosync").split(" "))&&("autosync"!==p&&(r.autoSync("stop"),l.always(function(){r.autoSync()})),r.trigger("openxhrabort")),delete A.preventFail,r.api>=2.1029&&(j?A.headers["X-elFinderReqid"]=c:Object.assign(A.data,{reqid:c})),l.syncOnFail=function(e){k=!!e},fe++,l.xhr=n=r.transport.send(A).always(function(){A._xhr&&void 0!==A._xhr.responseURL&&(n.responseURL=A._xhr.responseURL||""),--fe,me.length&&me.shift()()}).fail(I).done(M),r.api>=2.1029&&(n._requestId=c),h||d.compare&&"info"===p?(n.queueAbort=t,Y.unshift(n),d.compare&&r.bind(r.cmdsToAdd+" autosync openxhrabort",F),l.always(function(){var e=$.inArray(n,Y);d.compare&&r.unbind(r.cmdsToAdd+" autosync openxhrabort",F),-1!==e&&Y.splice(e,1)})):-1!==$.inArray(p,r.abortCmdsOnOpen)&&(n.queueAbort=t,Q.unshift(n),l.always(function(){var e=$.inArray(n,Q);-1!==e&&Q.splice(e,1)})),r.bind("unload destroy",F),l.always(function(){r.unbind("unload destroy",F)}),l},D=function(){return y.type&&y.cnt&&(w&&(y.cancel=l,e.eachCancel&&(y.id=+new Date)),t=setTimeout(function(){v=setTimeout(U,1e3),r.notify(y),b=!0,l.always(function(){y.cnt=-(parseInt(y.cnt)||0),r.notify(y),b=!1})},r.notifyDelay),l.always(function(){clearTimeout(t)})),fe<o?E():(h?me.unshift(E):me.push(E),l)},U=function(){var e;b&&v&&(e=1*y.cnt,v=null,r.notify({type:y.type,progress:e,cnt:0,hideCnt:y.hideCnt}),(g+=e)/y.cnt<80&&(v=setTimeout(U,500)))},P={opts:e,result:!0};return r.api||d.init?(r.trigger("request."+p,P,!0),P.result?"object"==typeof P.result&&P.result.promise?(P.result.done(D).fail(function(){r.trigger(p+"done"),l.reject()}),l):D():(r.trigger(p+"done"),l.reject())):(k=!1,l.reject())},this.cache=function(e,t){Array.isArray(e)||(e=[e]),pe(e,t)},this.updateCache=function(e){$.isPlainObject(e)&&(e.files&&e.files.length&&pe(e.files,"files"),e.tree&&e.tree.length&&pe(e.tree,"tree"),e.removed&&e.removed.length&&ue(e.removed),e.added&&e.added.length&&pe(e.added,"add"),e.changed&&e.changed.length&&pe(e.changed,"change"))},this.diff=function(e,t,n){var i={},a=[],o=[],r=[],s=null;return $.each(e,function(e,t){i[t.hash]=t}),n&&n.length&&(s={},$.each(n,function(){s[this]=!0})),$.each(L,function(e,n){i[e]||t&&n.phash!==t||o.push(e)}),$.each(i,function(e,t){var n,i=L[e],o={};i?($.each(Object.keys(i),function(){o[this]=!0}),$.each(t,function(e){if(delete o[e],!(s&&s[e]||t[e]===i[e]))return r.push(t),o={},!1}),0!==(n=Object.keys(o).length)&&(s&&$.each(o,function(e){s[e]&&--n}),0!==n&&r.push(t))):a.push(t)}),$.each(o,function(e,t){var n=L[t],a=n.phash;a&&"directory"==n.mime&&-1===$.inArray(a,o)&&i[a]&&!function(e){var t=r.length;for(;t--;)if(r[t].hash==e)return!0}(a)&&r.push(i[a])}),{added:a,removed:o,changed:r}},this.sync=function(e,t){this.autoSync("stop");var n,i=this,a=function(){var n="",i=0,a=0;e&&t&&$.each(L,function(t,o){o.phash&&o.phash===e&&(++i,a=Math.max(a,o.ts)),n=i+":"+a});return n}(),o=$.Deferred().always(function(){!n&&i.trigger("sync")}),r=[this.request({data:{cmd:"open",reload:1,target:H,tree:!e&&this.ui.tree?1:0,compare:a},preventDefault:!0})];return!e&&i.api>=2&&(H!==this.root()&&r.push(this.request({data:{cmd:"parents",target:H},preventDefault:!0})),$.each(function(){var e,t=[],n=i.file(i.root(H)),a=n?n.volumeid:null,o=i.cwd().phash;for(;o;)(e=i.file(o))?(0!==o.indexOf(a)&&(t.push({target:o,cmd:"tree"}),i.isRoot(e)||t.push({target:o,cmd:"parents"}),n=i.file(i.root(o)),a=n?n.volumeid:null),o=e.phash):o=null;return t}(),function(e,t){r.push(i.request({data:{cmd:t.cmd,target:t.target},preventDefault:!0}))})),$.when.apply($,r).fail(function(e,a){n=a&&200!=a.status,t&&-1===$.inArray("errOpen",e)?o.reject(e&&0!=a.status?e:void 0):(o.reject(e),i.parseError(e)&&i.request({data:{cmd:"open",target:i.lastDir("")||i.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}}))}).done(function(t){var n,r,s;if(t.cwd.compare&&a===t.cwd.compare)return o.reject();if(n={tree:[]},(r=arguments.length)>1)for(s=1;s<r;s++)arguments[s].tree&&arguments[s].tree.length&&n.tree.push.apply(n.tree,arguments[s].tree);if(i.api<2.1&&(n.tree||(n.tree=[]),n.tree.push(t.cwd)),t=i.normalize(t),!i.validResponse("open",t))return o.reject(t.norError||"errResponse");if(n=i.normalize(n),!i.validResponse("tree",n))return o.reject(n.norError||"errResponse");var l=i.diff(t.files.concat(n&&n.tree?n.tree:[]),e);return l.added.push(t.cwd),i.updateCache(l),l.removed.length&&i.remove(l),l.added.length&&i.add(l),l.changed.length&&i.change(l),o.resolve(l)}).always(function(){i.autoSync()}),o},this.upload=function(e){return this.transport.upload(e,this)},this.shortcut=function(e){var t,n,i,a,o;if(this.options.allowShortcuts&&e.pattern&&$.isFunction(e.callback))for(t=e.pattern.toUpperCase().split(/\s+/),a=0;a<t.length;a++)n=t[a],o=n.split("+"),(i=1==(i=o.pop()).length?i>0?i:i.charCodeAt(0):i>0?i:$.ui.keyCode[i])&&!X[n]&&(X[n]={keyCode:i,altKey:-1!=$.inArray("ALT",o),ctrlKey:-1!=$.inArray("CTRL",o),shiftKey:-1!=$.inArray("SHIFT",o),type:e.type||"keydown",callback:e.callback,description:e.description,pattern:n});return this},this.shortcuts=function(){var e=[];return $.each(X,function(t,n){e.push([n.pattern,z.i18n(n.description)])}),e},this.clipboard=function(e,t){var n=function(){return $.map(G,function(e){return e.hash})};return void 0!==e&&(G.length&&this.trigger("unlockfiles",{files:n()}),J={},G=$.map(e||[],function(e){var n=L[e];return n?(J[e]=!0,{hash:e,phash:n.phash,name:n.name,mime:n.mime,read:n.read,locked:n.locked,cut:!!t}):null}),this.trigger("changeclipboard",{clipboard:G.slice(0,G.length)}),t&&this.trigger("lockfiles",{files:n()})),G.slice(0,G.length)},this.isCommandEnabled=function(e,t){var n,i,a=z.cwd().volumeid||"";return!t&&z.searchStatus.state>1&&z.selected().length&&(t=z.selected()[0]),n=!t||a&&0===t.indexOf(a)?N.disabledFlip:z.option("disabledFlip",t),!!(i=this._commands[e])&&(i.alwaysEnabled||!n[e])},this.exec=function(e,t,n,i){var a,o;return!i&&this.commandMap[e]&&"hidden"!==this.commandMap[e]&&(e=this.commandMap[e]),"open"===e&&((this.searchStatus.state||this.searchStatus.ininc)&&this.trigger("searchend",{noupdate:!0}),this.autoSync("stop")),!i&&t&&($.isArray(t)?t.length&&(i=t[0]):i=t),a=this._commands[e]&&this.isCommandEnabled(e,i)?this._commands[e].exec(t,n):$.Deferred().reject("errUnknownCmd"),"object"===(o=typeof a)&&a.promise||(z.debug("warning",'"cmd.exec()" should be returned "$.Deferred" but cmd "'+e+'" returned "'+o+'"'),a=$.Deferred().resolve()),this.trigger("exec",{dfrd:a,cmd:e,files:t,opts:n,dstHash:i}),a},this.dialog=function(e,t){var n=$("<div/>").append(e).appendTo(O).elfinderdialog(t,z),i=n.closest(".ui-dialog"),a=function(){!n.data("draged")&&n.is(":visible")&&n.elfinderdialog("posInit")};return i.length&&(z.bind("resize",a),i.on("remove",function(){z.unbind("resize",a)})),n},this.toast=function(e){return $('<div class="ui-front"/>').appendTo(this.ui.toast).elfindertoast(e||{},this)},this.getUI=function(e){return e?this.ui[e]||$():O},this.getCommand=function(e){return void 0===e?this._commands:this._commands[e]},this.resize=function(e,t){var n,i=!O.hasClass("ui-resizable"),a=O.data("resizeSize")||{w:0,h:0},o={};ne&&ne.data("resizeTm")&&clearTimeout(ne.data("resizeTm")),"string"==typeof t&&(n=t.match(/^([0-9.]+)%$/))&&(ne&&ne.length||(ne=$(window)),ne.data("marginToMyNode")||ne.data("marginToMyNode",function(){var e=O.outerHeight(!0)-O.innerHeight(),t=O;for(;t.get(0)!==ne.get(0)&&(t=t.parent(),e+=t.outerHeight(!0)-t.innerHeight(),t.parent().length););return e}()),ne.data("fitToBaseFunc")||ne.data("fitToBaseFunc",function(e){var t=ne.data("resizeTm");e.preventDefault(),e.stopPropagation(),t&&cancelAnimationFrame(t),O.hasClass("elfinder-fullscreen")||z.UA.Mobile&&ne.data("rotated")===z.UA.Rotated||(ne.data("rotated",z.UA.Rotated),ne.data("resizeTm",requestAnimationFrame(function(){z.restoreSize()})))}),void 0===ne.data("rotated")&&ne.data("rotated",z.UA.Rotated),t=ne.height()*(n[1]/100)-ne.data("marginToMyNode"),ne.off("resize."+z.namespace,ne.data("fitToBaseFunc")),i&&ne.on("resize."+z.namespace,ne.data("fitToBaseFunc"))),O.css({width:e,height:parseInt(t)}),o.w=Math.round(O.width()),o.h=Math.round(O.height()),O.data("resizeSize",o),o.w===a.w&&o.h===a.h||(O.trigger("resize"),this.trigger("resize",{width:o.w,height:o.h}))},this.restoreSize=function(){this.resize(ee,te)},this.show=function(){O.show(),this.enable().trigger("show")},this.hide=function(){this.options.enableAlways&&(R=q,q=!1),this.disable(),this.trigger("hide"),O.hide()},this.lazy=function(e,t,n){var i=function(e){var t,i=O.data("lazycnt");e?(t=!O.data("lazyrepaint")&&n.repaint,i?O.data("lazycnt",++i):O.data("lazycnt",1).addClass("elfinder-processing"),t&&O.data("lazyrepaint",!0).css("display")):i&&i>1?O.data("lazycnt",--i):(t=O.data("lazyrepaint"),O.data("lazycnt",0).removeData("lazyrepaint").removeClass("elfinder-processing"),t&&O.css("display"),z.trigger("lazydone"))},a=$.Deferred(),o=function(){a.resolve(e.call(a)),i(!1)};return t=t||0,n=n||{},i(!0),t?setTimeout(o,t):requestAnimationFrame(o),a},this.destroy=function(){O&&O[0].elfinder&&(O.hasClass("elfinder-fullscreen")&&z.toggleFullscreen(O),this.options.syncStart=!1,this.autoSync("forcestop"),this.trigger("destroy").disable(),G=[],V=[],K={},X={},$(window).off("."+F),$(document).off("."+F),z.trigger=function(){},$(re).remove(),O.off().removeData().empty().append(M.contents()).attr("class",M.attr("class")).attr("style",M.attr("style")),delete O[0].elfinder,$.each(I,function(e,t){$.each(t,function(e,t){O.on(t.type+(t.namespace?"."+t.namespace:""),t.selector,t.handler)})}))},this.autoSync=function(e){var t;if(z.options.sync>=1e3){if(a&&(clearTimeout(a),a=null,z.trigger("autosync",{action:"stop"})),"stop"===e?++se:se=Math.max(0,--se),se||"forcestop"===e||!z.options.syncStart)return;(t=function(e){var n;N.syncMinMs&&(e||a)&&(e&&z.trigger("autosync",{action:"start"}),n=Math.max(z.options.sync,N.syncMinMs),a&&clearTimeout(a),a=setTimeout(function(){var e,i=!0,o=H;N.syncChkAsTs&&L[o]&&(e=L[o].ts)?z.request({data:{cmd:"info",targets:[o],compare:e,reload:1},preventDefault:!0}).done(function(n){var a;i=!0,n.compare&&(a=n.compare)==e&&(i=!1),i?z.sync(o).always(function(){a&&(L[o].ts=a),t()}):t()}).fail(function(e,i){var o=z.parseError(e);o&&0!=i.status?(z.error(o),Array.isArray(o)&&-1!==$.inArray("errOpen",o)&&z.request({data:{cmd:"open",target:z.lastDir("")||z.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})):a=setTimeout(function(){t()},n)}):z.sync(H,!0).always(function(){t()})},n))})(!0)}},this.insideWorkzone=function(e,t,n){var i=this.getUI("workzone").data("rectangle");return n=n||1,!(e<i.left+n||e>i.left+i.width+n||t<i.top+n||t>i.top+i.height+n)},this.toFront=function(e){var t=O.children(".ui-front").removeClass("elfinder-frontmost"),n=t.last();t.css("z-index",""),$(e).addClass("ui-front elfinder-frontmost").css("z-index",n.css("z-index")+1)},this.toHide=function(e,t){var n,i=$(e);!t&&i.hide(),i.hasClass("elfinder-frontmost")&&(i.removeClass("elfinder-frontmost"),(n=O.children(".ui-front:visible:not(.elfinder-frontmost)").last()).length&&requestAnimationFrame(function(){O.children(".elfinder-frontmost:visible").length||(z.toFront(n),n.trigger("frontmost"))}))},this.getMaximizeCss=function(){return{width:"100%",height:"100%",margin:0,top:0,left:0,display:"block",position:"fixed",zIndex:Math.max(z.zIndex?z.zIndex+1:0,1e3),maxWidth:"",maxHeight:""}},function(){ye&&z.UA.Fullscreen&&(z.UA.Fullscreen=!1,we&&void 0!==we.attr("allowfullscreen")&&(z.UA.Fullscreen=!0));var e,t,n,i,a="elfinder-fullscreen",o="elfinder-fullscreen-native",r=function(){var e=0,t=0;$.each(O.children(".ui-dialog,.ui-draggable"),function(n,i){var a=$(i),o=a.position();o.top<0&&(a.css("top",e),e+=20),o.left<0&&(a.css("left",t),t+=20)})},s=function(){var n=z.storage("useFullscreen");i=z.UA.Fullscreen&&(n?n>0:"screen"===z.options.commandsOptions.fullscreen.mode)?{fullElm:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null},exitFull:function(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():void 0},toFull:function(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():!!e.msRequestFullscreen&&e.msRequestFullscreen()}}:{fullElm:function(){var e;return O.hasClass(a)?O.get(0):(e=O.find("."+a)).length?e.get(0):null},exitFull:function(){var n;$(window).off("resize."+F,c),void 0!==t&&$("body").css("overflow",t),t=void 0,e&&(n=e.elm,l(n),$(n).trigger("resize",{fullscreen:"off"})),$(window).trigger("resize")},toFull:function(e){return t=$("body").css("overflow")||"",$("body").css("overflow","hidden"),$(e).css(z.getMaximizeCss()).addClass(a).trigger("resize",{fullscreen:"on"}),r(),$(window).on("resize."+F,c).trigger("resize"),!0}}},l=function(t){e&&e.elm==t&&($(t).removeClass(a+" "+o).attr("style",e.style),e=null)},c=function(e){var t;e.target===window&&(n&&cancelAnimationFrame(n),n=requestAnimationFrame(function(){(t=i.fullElm())&&$(t).trigger("resize",{fullscreen:"on"})}))};s(),$(document).on("fullscreenchange."+F+" webkitfullscreenchange."+F+" mozfullscreenchange."+F+" MSFullscreenChange."+F,function(t){if(z.UA.Fullscreen){var s=i.fullElm(),d=$(window);n&&cancelAnimationFrame(n),null===s?(d.off("resize."+F,c),e&&(s=e.elm,l(s),$(s).trigger("resize",{fullscreen:"off"}))):($(s).addClass(a+" "+o).attr("style","width:100%; height:100%; margin:0; padding:0;").trigger("resize",{fullscreen:"on"}),d.on("resize."+F,c),r()),d.trigger("resize")}}),z.toggleFullscreen=function(t,n){var a=$(t).get(0),o=null;if(o=i.fullElm()){if(o==a){if(!0===n)return o}else if(!1===n)return o;return i.exitFull(),null}return!1===n?null:(s(),e={elm:a,style:$(a).attr("style")},!1!==i.toFull(a)?a:(e=null,null))}}(),C="elfinder-maximized",T=function(e){if(e.target===window&&e.data&&e.data.elm){var t=e.data.elm;k&&cancelAnimationFrame(k),k=requestAnimationFrame(function(){t.trigger("resize",{maximize:"on"})})}},z.toggleMaximize=function(e,t){var n=$(e),i=n.hasClass(C);if(i){if(!0===t)return;!function(e){$(window).off("resize."+F,T),$("body").css("overflow",e.data("bodyOvf")),e.removeClass(C).attr("style",e.data("orgStyle")).removeData("bodyOvf").removeData("orgStyle"),e.trigger("resize",{maximize:"off"})}(n)}else{if(!1===t)return;!function(e){e.data("bodyOvf",$("body").css("overflow")||"").data("orgStyle",e.attr("style")).addClass(C).css(z.getMaximizeCss()),$("body").css("overflow","hidden"),$(window).on("resize."+F,{elm:e},T),e.trigger("resize",{maximize:"on"})}(n)}},Object.assign($.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DIG0:48,DIG1:49,DIG2:50,DIG3:51,DIG4:52,DIG5:53,DIG6:54,DIG7:55,DIG8:56,DIG9:57,NUM0:96,NUM1:97,NUM2:98,NUM3:99,NUM4:100,NUM5:101,NUM6:102,NUM7:103,NUM8:104,NUM9:105,CONTEXTMENU:93,DOT:190}),this.dragUpload=!1,this.xhrUpload=("undefined"!=typeof XMLHttpRequestUpload||"undefined"!=typeof XMLHttpRequestEventTarget)&&"undefined"!=typeof File&&"undefined"!=typeof FormData,this.transport={},"object"==typeof this.options.transport&&(this.transport=this.options.transport,"function"==typeof this.transport.init&&this.transport.init(this)),"function"!=typeof this.transport.send&&(this.transport.send=function(e){return z.UA.IE||(e._xhr=new XMLHttpRequest,e.xhr=function(){return e.progress&&e._xhr.addEventListener("progress",e.progress),e._xhr}),$.ajax(e)}),"iframe"==this.transport.upload?this.transport.upload=$.proxy(this.uploads.iframe,this):"function"==typeof this.transport.upload?this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload&&this.options.dragUploadAllow?(this.transport.upload=$.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=$.proxy(this.uploads.iframe,this),this.decodeRawString=function(e){return function(e){var t,n,i,a,o=String.fromCharCode;for(t=0,n=e.length,a="";i=e[t],t<n;t++)a+=i<=127?o(i):i<=223&&i>=194?o((31&i)<<6|63&e[++t]):i<=239&&i>=224?o((15&i)<<12|(63&e[++t])<<6|63&e[++t]):i<=247&&i>=240?o(55296|((7&i)<<8|(63&e[++t])<<2|e[++t]>>>4&3)-64,56320|(15&e[t++])<<6|63&e[t]):o(65533);return a}(function(e){var t,n,i,a=[];"string"==typeof e&&(e=function(e){var t,n,i;for(t=0,n=e.length,i=[];t<n;t++)i.push(e.charCodeAt(t));return i}(e));for(t=0,n=e.length;i=e[t],t<n;t++)i>=55296&&i<=56319?a.push(64+(1023&i)<<10|1023&e[++t]):a.push(i);return a}(e))},this.getContents=function(e,t,n){var i,a,o=$.Deferred(),r=t||"arraybuffer";return o.fail(function(){a&&"pending"===a.state()&&a.reject()}),i=this.openUrl(e),this.isSameOrigin(i)||(i=this.openUrl(e,!0)),a=this.request(Object.assign({data:{cmd:"get"},options:{url:i,type:"get",cache:!0,dataType:"binary",responseType:r,processData:!1},notify:{type:"file",cnt:1,hideCnt:!0},cancel:!0},n||{})).fail(function(){o.reject()}).done(function(e){o.resolve(e)}),o},this.getBinaryByUrl=function(e,t,n){var i,a=$.Deferred();return a.fail(function(){i&&"pending"===i.state()&&i.reject()}),i=this.request(Object.assign({data:{cmd:"get"},options:Object.assign({type:"get",cache:!0,dataType:"binary",responseType:"blob",processData:!1},e)},n||{})).fail(function(){a.reject()}).done(function(e){t&&t(e),a.resolve(e)}),a},this.getMimetype=function(e,t){var n,a,o=t;return(a=(e+"").match(/\.([^.]+)$/))&&(n=a[1])&&(i||(i=z.arrayFlip(z.mimeTypes)),(o=i[n.toLowerCase()])||(o=t)),o},z.hashCheckers=[],function(e){var t={};window.Worker&&window.ArrayBuffer&&(e.options.cdns.sparkmd5&&(t.SparkMD5=!0,e.hashCheckers.push("md5")),e.options.cdns.jssha&&(t.jsSHA=!0,e.hashCheckers=e.hashCheckers.concat(["sha1","sha224","sha256","sha384","sha512","sha3-224","sha3-256","sha3-384","sha3-512","shake128","shake256"]))),e.getContentsHashes=function(n,i,a,o){var r,s=$.Deferred(),l=e.arrayFlip(i||["md5"],!0),c=[],d={},p=a||{shake128len:256,shake256len:512};return s.fail(function(){r&&r.reject()}),Object.keys(t).length?r=e.getContents(n,"arraybuffer",o).done(function(i){l.md5&&t.SparkMD5&&c.push(function(){var a=$.Deferred();try{var o=e.getWorker();a.fail(function(){o&&o.terminate()}),o.onmessage=function(t){var i;(o&&o.terminate(),t.data.hash)?(d.md5=t.data.hash,(i=e.file(n))&&(i.md5=d.md5)):t.data.error&&(d.md5=t.data.error);s.notify(d),a.resolve()},o.onerror=function(e){a.reject()},o.postMessage({scripts:[e.options.cdns.sparkmd5,e.getWorkerUrl("calcfilehash.js")],data:{type:"md5",bin:i}}),s.fail(function(){a.reject()})}catch(e){a.reject(),delete t.SparkMD5}return a}()),t.jsSHA&&$.each(["1","224","256","384","512","3-224","3-256","3-384","3-512","ke128","ke256"],function(a,o){l["sha"+o]&&c.push(function(){var a=$.Deferred();try{var r=e.getWorker();a.fail(function(){r&&r.terminate()}),r.onmessage=function(t){var i;(r&&r.terminate(),t.data.hash)?(d["sha"+o]=t.data.hash,(i=e.file(n))&&(i["sha"+o]=d["sha"+o])):t.data.error&&(d["sha"+o]=t.data.error);s.notify(d),a.resolve()},r.onerror=function(e){a.reject()},r.postMessage({scripts:[e.options.cdns.jssha,e.getWorkerUrl("calcfilehash.js")],data:{type:o,bin:i,hashOpts:p}}),s.fail(function(){a.reject()})}catch(e){a.reject(),delete t.jsSHA}return a}())}),c.length?$.when.apply(null,c).always(function(){s.resolve(d)}):s.reject()}).fail(function(){s.reject()}):s.reject(),s}}(this),this.parseError=function(e){var t=e;return $.isPlainObject(t)&&(t=t.error),t},this.error=function(){var e,t=arguments[0],n=arguments[1]||null;return 1==arguments.length&&"function"==typeof t?z.bind("error",t):!0!==(e=this.parseError(t))&&e?z.trigger("error",{error:e,opts:n}):this},$.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","selectfiles","unselectfiles","dragstart","dragstop","search","searchend","viewchange"],function(e,t){z[t]=function(){var e=arguments[0];return 1==arguments.length&&"function"==typeof e?z.bind(t,e):z.trigger(t,$.isPlainObject(e)?e:{})}}),this.enable(function(){!q&&z.api&&z.visible()&&z.ui.overlay.is(":hidden")&&!O.children(".elfinder-dialog."+z.res("class","editing")+":visible").length&&(q=!0,document.activeElement&&document.activeElement.blur(),O.removeClass("elfinder-disabled"))}).disable(function(){R=q,q=!1,O.addClass("elfinder-disabled")}).open(function(){V=[]}).select(function(e){var t=0,n=[];V=$.grep(e.data.selected||e.data.value||[],function(e){return n.length||z.maxTargets&&++t>z.maxTargets?(n.push(e),!1):!!L[e]}),n.length&&(z.trigger("unselectfiles",{files:n,inselect:!0}),z.toast({mode:"warning",msg:z.i18n(["errMaxTargets",z.maxTargets])}))}).error(function(e){var t,n,i={cssClass:"elfinder-dialog-error",title:z.i18n("error"),resizable:!1,destroyOnClose:!0,buttons:{}},a=z.getUI(),o=a.children(".elfinder-dialog-error").length;o<z.options.maxErrorDialogs?(i.buttons[z.i18n(z.i18n("btnClose"))]=function(){$(this).elfinderdialog("close")},e.data.opts&&$.isPlainObject(e.data.opts)&&Object.assign(i,e.data.opts),z.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+z.i18n(e.data.error),i)):(t=a.children(".elfinder-dialog-error:last").children(".ui-dialog-content:first"),(n=t.children(".elfinder-error-counter")).length?n.data("cnt",parseInt(n.data("cnt"))+1).html(z.i18n(["moreErrors",n.data("cnt")])):(n=$('<span class="elfinder-error-counter">'+z.i18n(["moreErrors",1])+"</span>").data("cnt",1),t.append("<br/>",n)))}).bind("tmb",function(e){$.each(e.data.images||[],function(e,t){L[e]&&(L[e].tmb=t)})}).bind("searchstart",function(e){Object.assign(z.searchStatus,e.data),z.searchStatus.state=1}).bind("search",function(e){z.searchStatus.state=2}).bind("searchend",function(){z.searchStatus.state=0,z.searchStatus.ininc=!1,z.searchStatus.mixed=!1}).bind("canMakeEmptyFile",function(e){var t=e.data,n={};t&&Array.isArray(t.mimes)&&(t.unshift||(n=z.mimesCanMakeEmpty),$.each(t.mimes,function(){n[this]||(n[this]=z.mimeTypes[this])}),t.unshift&&(z.mimesCanMakeEmpty=Object.assign(n,z.mimesCanMakeEmpty)))}).bind("themechange",function(){requestAnimationFrame(function(){z.trigger("uiresize")})}),!0===this.options.sound&&this.bind("playsound",function(e){var t=re.canPlayType&&re.canPlayType('audio/wav; codecs="1"'),n=e.data&&e.data.soundFile;t&&n&&""!=t&&"no"!=t&&$(re).html('<source src="'+ie+n+'" type="audio/wav">')[0].play()}),$.each(this.options.handlers,function(e,t){z.bind(e,t)}),this.history=new this.history(this),this.roots={},this.leafRoots={},this.volumeExpires={},this._commands={},Array.isArray(this.options.commands)||(this.options.commands=[]),-1!==$.inArray("*",this.options.commands)&&(this.options.commands=Object.keys(this.commands)),this.commandMap={},this.volOptions={},this.hasVolOptions=!1,this.trashes={},this.optionsByHashes={},this.uiAutoHide=[],this.one("open",function(){z.uiAutoHide.length&&setTimeout(function(){z.trigger("uiautohide")},500)}),this.bind("uiautohide",function(){z.uiAutoHide.length&&z.uiAutoHide.shift()()}),this.options.width&&(ee=this.options.width),this.options.height&&(te=this.options.height),this.options.heightBase&&(ne=$(this.options.heightBase)),ie=this.options.soundPath?this.options.soundPath.replace(/\/+$/,"")+"/":this.baseUrl+ie,this.options.parrotHeaders&&Array.isArray(this.options.parrotHeaders)&&this.options.parrotHeaders.length?(this.parrotHeaders=this.options.parrotHeaders,$.each(this.parrotHeaders,function(e,t){var n=z.sessionStorage("core-ph:"+t);n&&(z.customHeaders[t]=n)})):this.parrotHeaders=[],z.one("opendone",function(){var e;$(document).on("click."+F,function(e){q&&!z.options.enableAlways&&!$(e.target).closest(O).length&&z.disable()}).on(D+" "+U+" "+P+" "+E,ve),z.options.useBrowserHistory&&$(window).on("popstate."+F,function(e){var t,n,i=e.originalEvent.state||{},a=!!i.thash,o=O.find(".elfinder-frontmost:visible"),r=O.find(".elfinder-navbar-dir,.elfinder-cwd-filename").find("input,textarea");a||(i={thash:z.cwd().hash},$("html,body").animate({scrollTop:O.offset().top})),o.length||r.length?(history.pushState(i,null,location.pathname+location.search+"#elf_"+i.thash),o.length?o.hasClass(z.res("class","preventback"))||(o.hasClass("elfinder-contextmenu")?$(document).trigger($.Event("keydown",{keyCode:$.ui.keyCode.ESCAPE,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1})):o.hasClass("elfinder-dialog")?o.elfinderdialog("close"):o.trigger("close")):r.trigger($.Event("keydown",{keyCode:$.ui.keyCode.ESCAPE,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))):a?!$.isEmptyObject(z.files())&&z.request({data:{cmd:"open",target:i.thash,onhistory:1},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0}):(t=function(){n.trigger("click")},z.one("open",t,!0),n=z.toast({msg:z.i18n("pressAgainToExit"),onHidden:function(){z.unbind("open",t),history.pushState(i,null,location.pathname+location.search+"#elf_"+i.thash)}}))}),$(window).on("resize."+F,function(t){t.target===this&&(e&&cancelAnimationFrame(e),e=requestAnimationFrame(function(){var e=O.data("resizeSize")||{w:0,h:0},t={w:Math.round(O.width()),h:Math.round(O.height())};O.data("resizeSize",t),t.w===e.w&&t.h===e.h||(O.trigger("resize"),z.trigger("resize",{width:t.w,height:t.h}))}))}).on("beforeunload."+F,function(e){var t,n;if(!z.pauseUnloadCheck()){if(O.is(":visible")&&(z.ui.notify.children().length&&-1!==$.inArray("hasNotifyDialog",z.options.windowCloseConfirm)?t=z.i18n("ntfsmth"):O.find("."+z.res("class","editing")).length&&-1!==$.inArray("editingFile",z.options.windowCloseConfirm)?t=z.i18n("editingFile"):(n=Object.keys(z.selected()).length)&&-1!==$.inArray("hasSelectedItem",z.options.windowCloseConfirm)?t=z.i18n("hasSelected",""+n):(n=Object.keys(z.clipboard()).length)&&-1!==$.inArray("hasClipboardData",z.options.windowCloseConfirm)&&(t=z.i18n("hasClipboard",""+n)),t))return e.returnValue=t,t;z.trigger("unload")}}),$(window).on("message."+F,function(e){var t,n,i=e.originalEvent||null;if(i&&(0===z.convAbsUrl(z.options.url).indexOf(i.origin)||0===z.convAbsUrl(z.uploadURL).indexOf(i.origin)))try{t=JSON.parse(i.data),(n=t.data||null)&&(n.error?(t.bind&&z.trigger(t.bind+"fail",n),z.error(n.error)):(n.warning&&z.error(n.warning),z.updateCache(n),n.removed&&n.removed.length&&z.remove(n),n.added&&n.added.length&&z.add(n),n.changed&&n.changed.length&&z.change(n),t.bind&&(z.trigger(t.bind,n),z.trigger(t.bind+"done")),n.sync&&z.sync()))}catch(e){z.sync()}}),z.options.enableAlways?($(window).on("focus."+F,function(e){e.target===this&&z.enable()}),ye&&$(window.top).on("focus."+F,function(){!z.enable()||we&&!we.is(":visible")||requestAnimationFrame(function(){$(window).trigger("focus")})})):ye&&$(window).on("blur."+F,function(e){q&&e.target===this&&z.disable()}),ye&&O.on("click",function(e){$(window).trigger("focus")}),z.options.enableByMouseOver&&O.on("mouseenter touchstart",function(e){ye&&$(window).trigger("focus"),!z.enabled()&&z.enable()}),$(window).on("visibilitychange."+F,function(e){var t=document.hidden||document.webkitHidden||document.msHidden;z.options.syncStart&&z.autoSync(t?"stop":void 0)})}),O[0].elfinder=this,j.push(function(){var e=z.lang,t=z.i18nBaseUrl+"elfinder."+e+".js",n=$.Deferred();n.done(function(){z.i18[e]&&(z.lang=e),z.trigger("i18load"),s="en"===z.lang?z.i18.en:$.extend(!0,{},z.i18.en,z.i18[z.lang])});return z.i18[e]?n.resolve():(z.lang="en",z.hasRequire?require([t],function(){n.resolve()},function(){n.resolve()}):z.loadScript([t],function(){n.resolve()},{loadType:"tag",error:function(){n.resolve()}})),n}()),l=function(){var e,t,n,i,a,o,r,l,c;return z.messages=s.messages,$.fn.selectable&&$.fn.draggable&&$.fn.droppable&&$.fn.resizable&&$.fn.button&&$.fn.slider?O.length?z.options.url?(e=Object.assign({name:z.i18n("name"),perm:z.i18n("perms"),date:z.i18n("modify"),size:z.i18n("size"),kind:z.i18n("kind"),modestr:z.i18n("mode"),modeoct:z.i18n("mode"),modeboth:z.i18n("mode")},z.options.uiOptions.cwd.listView.columnsCustomName),z.getColumnName=function(t){return e[t]||z.i18n(t)},z.direction=s.direction,z.dateFormat=z.options.dateFormat||s.dateFormat,z.fancyFormat=z.options.fancyDateFormat||s.fancyDateFormat,z.nonameDateFormat=(z.options.nonameDateFormat||s.nonameDateFormat).replace(/[\/\\]/g,"_"),z.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==z.direction?"rtl":"ltr")+(z.UA.Touch?" elfinder-touch"+(z.options.resizable?" touch-punch":""):"")+(z.UA.Mobile?" elfinder-mobile":"")+(z.UA.iOS?" elfinder-ios":"")+" "+z.options.cssClass,O.addClass(z.cssClass).on(E,function(){!q&&z.enable()}),r=D+"draggable keyup."+F+"draggable",z.draggable={appendTo:O,addClasses:!1,distance:4,revert:!0,refreshPositions:!1,cursor:"crosshair",cursorAt:{left:50,top:47},scroll:!1,start:function(e,r){var s,l,c=r.helper,d=$.grep(c.data("files")||[],function(e){return!!e&&(J[e]=!0,!0)}),p=!1;for(o=O.attr("style"),O.width(O.width()).height(O.height()),t="ltr"===z.direction,n=z.getUI("workzone").data("rectangle"),i=n.top+n.height,a=i-z.getUI("navdock").outerHeight(!0),z.draggingUiHelper=c,s=d.length;s--;)if(l=d[s],L[l].locked){p=!0,c.data("locked",!0);break}!p&&z.trigger("lockfiles",{files:d}),c.data("autoScrTm",setInterval(function(){c.data("autoScr")&&z.autoScroll[c.data("autoScr")](c.data("autoScrVal"))},50))},drag:function(e,o){var r,s,l,c=o.helper;((s=n.top>e.pageY)||a<e.pageY)&&(r=n.cwdEdge>e.pageX?(t?"navbar":"cwd")+(s?"Up":"Down"):(t?"cwd":"navbar")+(s?"Up":"Down"),s||("cwd"===r.substr(0,3)?i<e.pageY?l=i:r=null:l=a),r&&(c.data("autoScr",r),c.data("autoScrVal",Math.pow(s?n.top-e.pageY:e.pageY-l,1.3)))),r||c.data("autoScr")&&c.data("refreshPositions",1).data("autoScr",null),c.data("refreshPositions")&&$(this).elfUiWidgetInstance("draggable")&&(c.data("refreshPositions")>0?($(this).draggable("option",{refreshPositions:!0,elfRefresh:!0}),c.data("refreshPositions",-1)):($(this).draggable("option",{refreshPositions:!1,elfRefresh:!1}),c.data("refreshPositions",null)))},stop:function(e,t){var n,i=t.helper;$(document).off(r),$(this).elfUiWidgetInstance("draggable")&&$(this).draggable("option",{refreshPositions:!1}),z.draggingUiHelper=null,z.trigger("focus").trigger("dragstop"),i.data("droped")||(n=$.grep(i.data("files")||[],function(e){return!!e}),z.trigger("unlockfiles",{files:n}),z.trigger("selectfiles",{files:z.selected()})),z.enable(),O.attr("style",o),i.data("autoScrTm")&&clearInterval(i.data("autoScrTm"))},helper:function(e,t){var n,i,a,o=this.id?$(this):$(this).parents("[id]:first"),s=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"/></div>'),l=function(e){var t,n=e.mime,i=z.tmb(e);return t='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+z.mime2class(n)+' ui-corner-all"/>',i?t=$(t).addClass(i.className).css("background-image","url('"+i.url+"')").get(0).outerHTML:e.icon&&(t=$(t).css(z.getIconStyle(e,!0)).get(0).outerHTML),e.csscls&&(t='<div class="'+e.csscls+'">'+t+"</div>"),t};return z.draggingUiHelper&&z.draggingUiHelper.stop(!0,!0),z.trigger("dragstart",{target:o[0],originalEvent:e},!0),n=o.hasClass(z.res("class","cwdfile"))?z.selected():[z.navId2Hash(o.attr("id"))],s.append(l(L[n[0]])).data("files",n).data("locked",!1).data("droped",!1).data("namespace",F).data("dropover",0),(i=n.length)>1&&s.append(l(L[n[i-1]])+'<span class="elfinder-drag-num">'+i+"</span>"),$(document).on(r,function(e){var t=e.shiftKey||e.ctrlKey||e.metaKey;a!==t&&(a=t,s.is(":visible")&&s.data("dropover")&&!s.data("droped")&&(s.toggleClass("elfinder-drag-helper-plus",!!s.data("locked")||a),z.trigger(a?"unlockfiles":"lockfiles",{files:n,helper:s})))}),s}},z.commands.getfile&&("function"==typeof z.options.getFileCallback?(z.bind("dblclick",function(e){e.preventDefault(),z.exec("getfile").fail(function(){z.exec("open",e.data&&e.data.file?[e.data.file]:void 0)})}),z.shortcut({pattern:"enter",description:z.i18n("cmdgetfile"),callback:function(){z.exec("getfile").fail(function(){z.exec("mac"==z.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:z.i18n("mac"==z.OS?"cmdrename":"cmdopen"),callback:function(){z.exec("mac"==z.OS?"rename":"open")}})):z.options.getFileCallback=null),$.each(z.commands,function(e,t){var n,i,a=Object.assign({},t.prototype);if($.isFunction(t)&&!z._commands[e]&&(t.prototype.forceLoad||-1!==$.inArray(e,z.options.commands))){if(n=t.prototype.extendsCmd||""){if(!$.isFunction(z.commands[n]))return!0;t.prototype=Object.assign({},Z,new z.commands[n],t.prototype)}else t.prototype=Object.assign({},Z,t.prototype);z._commands[e]=new t,t.prototype=a,i=z.options.commandsOptions[e]||{},n&&z.options.commandsOptions[n]&&(i=$.extend(!0,{},z.options.commandsOptions[n],i)),z._commands[e].setup(e,i),z._commands[e].linkedCmds.length&&$.each(z._commands[e].linkedCmds,function(e,t){var n=z.commands[t];$.isFunction(n)&&!z._commands[t]&&(n.prototype=Z,z._commands[t]=new n,z._commands[t].setup(t,z.options.commandsOptions[t]||{}))})}}),z.ui={workzone:$("<div/>").appendTo(O).elfinderworkzone(z),navbar:$("<div/>").appendTo(O).elfindernavbar(z,z.options.uiOptions.navbar||{}),navdock:$("<div/>").appendTo(O).elfindernavdock(z,z.options.uiOptions.navdock||{}),contextmenu:$("<div/>").appendTo(O).elfindercontextmenu(z),overlay:$("<div/>").appendTo(O).elfinderoverlay({show:function(){z.disable()},hide:function(){R&&z.enable()}}),cwd:$("<div/>").appendTo(O).elfindercwd(z,z.options.uiOptions.cwd||{}),notify:z.dialog("",{cssClass:"elfinder-dialog-notify"+(z.options.notifyDialog.canClose?"":" elfinder-titlebar-button-hide"),position:z.options.notifyDialog.position,absolute:!0,resizable:!1,autoOpen:!1,allowMinimize:!0,closeOnEscape:!!z.options.notifyDialog.canClose,title:"&nbsp;",width:z.options.notifyDialog.width?parseInt(z.options.notifyDialog.width):null,minHeight:null,minimize:function(){z.ui.notify.trigger("minimize")}}),statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(O),toast:$('<div class="elfinder-toast"/>').appendTo(O),bottomtray:$('<div class="elfinder-bottomtray">').appendTo(O),progressbar:$('<div class="elfinder-ui-progressbar">').appendTo(O)},z.trigger("uiready"),$.each(z.options.ui||[],function(e,t){var n="elfinder"+t,i=z.options.uiOptions[t]||{};!z.ui[t]&&$.fn[n]&&(z.ui[t]=$("<"+(i.tag||"div")+"/>").appendTo(O),z.ui[t][n](z,i))}),z.ui.progressbar.appendTo(z.ui.workzone),z.ui.notify.prev(".ui-dialog-titlebar").append('<div class="elfinder-ui-progressbar"></div>'),z.resize(ee,te),z.options.resizable&&(O.resizable({resize:function(e,t){z.resize(t.size.width,t.size.height)},handles:"se",minWidth:300,minHeight:200}),z.UA.Touch&&O.addClass("touch-punch")),l=z.getUI("navbar"),c=z.getUI("cwd").parent(),z.autoScroll={navbarUp:function(e){l.scrollTop(Math.max(0,l.scrollTop()-e))},navbarDown:function(e){l.scrollTop(l.scrollTop()+e)},cwdUp:function(e){c.scrollTop(Math.max(0,c.scrollTop()-e))},cwdDown:function(e){c.scrollTop(c.scrollTop()+e)}},z.UA.Touch&&function(){var e,t,n,i,a,o,r,s,l,c=z.getUI("navbar"),d=z.getUI("toolbar"),p="touchmove.stopscroll",u=function(e){var n=e.originalEvent.touches||[{}],i=n[0].pageY||null;(!t||i<t)&&(e.preventDefault(),s&&clearTimeout(s))},h=function(e){e.preventDefault(),s&&clearTimeout(s)};c=c.children().length?c:null,d=d.length?d:null,O.on("touchstart touchmove touchend",function(f){if("touchend"===f.type)return e=!1,t=!1,void(s=setTimeout(function(){O.off(p)},100));var m,g,v,b,y=f.originalEvent.touches||[{}],w=y[0].pageX||null,x=y[0].pageY||null,k="ltr"===z.direction;null===w||null===x||"touchstart"===f.type&&y.length>1||("touchstart"===f.type?(n=O.offset(),i=O.width(),c&&(e=!1,c.is(":hidden")?(l||(l=Math.max(50,i/10)),(k?w-n.left:i+n.left-w)<l&&(e=w)):f.originalEvent._preventSwipeX||(o=c.width(),(k?w<n.left+o:w>n.left+i-o)?(l=Math.max(50,i/10),e=w):e=!1)),d&&(t=!1,f.originalEvent._preventSwipeY||(r=d.height(),a=n.top,x-a<(d.is(":hidden")?50:r+30)&&(t=x,O.on(p,d.is(":hidden")?h:u))))):(c&&!1!==e&&(m=(k?e>w:e<w)?"navhide":"navshow",g=Math.abs(e-w),("navhide"===m&&g>.6*o||g>("navhide"===m?o/3:45)&&("navshow"===m||(k?w<n.left+20:w>n.left+i-20)))&&(z.getUI("navbar").trigger(m,{handleW:l}),e=!1)),d&&!1!==t&&(v=d.offset().top,Math.abs(t-x)>Math.min(45,r/3)&&("slideDown"===(b=t>x?"slideUp":"slideDown")||v+20>x)&&(d.is("slideDown"===b?":hidden":":visible")&&d.stop(!0,!0).trigger("toggle",{duration:100,handleH:50}),t=!1))))})}(),z.dragUpload&&function(){var e,t,n=function(e){return"TEXTAREA"!==e.target.nodeName&&"INPUT"!==e.target.nodeName&&0===$(e.target).closest("div.ui-dialog-content").length},i="native-drag-enter",a="native-drag-disable",o="class",r=z.res(o,"navdir"),s=(z.res(o,"droppable"),z.res(o,"adroppable"),z.res(o,"navarrow"),z.res(o,"adroppable")),l=z.getUI("workzone"),c="ltr"===z.direction,d=function(){t&&cancelAnimationFrame(t),t=null};O.on("dragenter",function(t){d(),n(t)&&(t.preventDefault(),t.stopPropagation(),e=l.data("rectangle"))}).on("dragleave",function(e){d(),n(e)&&(e.preventDefault(),e.stopPropagation())}).on("dragover",function(i){var a;n(i)?(i.preventDefault(),i.stopPropagation(),i.originalEvent.dataTransfer.dropEffect="none",t||(t=requestAnimationFrame(function(){var n,o=e.top+e.height,r=o-z.getUI("navdock").outerHeight(!0);((a=i.pageY<e.top)||i.pageY>r)&&(n=e.cwdEdge>i.pageX?(c?"navbar":"cwd")+(a?"Up":"Down"):(c?"cwd":"navbar")+(a?"Up":"Down"),a||"cwd"===n.substr(0,3)&&(o<i.pageY?r=o:n=""),n&&z.autoScroll[n](Math.pow(a?e.top-i.pageY:i.pageY-r,1.3))),t=null}))):d()}).on("drop",function(e){d(),n(e)&&(e.stopPropagation(),e.preventDefault())}),O.on("dragenter",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t,n=$(e.currentTarget),o=e.currentTarget.id||null,r=null;if(!o){r=z.cwd(),n.data(a,!1);try{$.each(e.originalEvent.dataTransfer.types,function(e,n){"elfinderfrom:"===n.substr(0,13)&&(t=n.substr(13).toLowerCase())})}catch(e){}}r&&(!r.write||t&&t===(window.location.href+r.hash).toLowerCase())?n.data(a,!0):(e.preventDefault(),e.stopPropagation(),n.data(i,!0),n.addClass(s))}}).on("dragleave",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t=$(e.currentTarget);e.preventDefault(),e.stopPropagation(),t.data(i)?t.data(i,!1):t.removeClass(s)}}).on("dragover",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t=$(e.currentTarget);e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect=t.data(a)?"none":"copy",t.data(i,!1)}}).on("drop",".native-droppable",function(e){if(e.originalEvent&&e.originalEvent.dataTransfer){var t,n=$(e.currentTarget);e.preventDefault(),e.stopPropagation(),n.removeClass(s),t=e.currentTarget.id?n.hasClass(r)?z.navId2Hash(e.currentTarget.id):z.cwdId2Hash(e.currentTarget.id):z.cwd().hash,e.originalEvent._target=t,z.exec("upload",{dropEvt:e.originalEvent,target:t},void 0,t)}})}(),!1===z.cssloaded&&(z.cssloaded=!0,z.trigger("cssloaded")),z.zIndexCalc(),void z.trigger("init").request({data:{cmd:"open",target:z.startDir(),init:1,tree:1},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){z.trigger("fail").disable().lastDir(""),K={},X={},$(document).add(O).off("."+F),z.trigger=function(){}}).done(function(e){var t=function(e){var t=z.file(z.trashes[e]);z.options.debug;t&&t.volumeid&&delete z.volOptions[t.volumeid].trashHash,z.trashes[e]=!1,z.debug("backend-error",'Trash hash "'+e+'" was not found or not writable.')},n={};z.options.rawStringDecoder&&z.registRawStringDecoder(z.options.rawStringDecoder),z.zIndexCalc(),z.load().debug("api",z.api),O.trigger("resize"),de(e),z.trigger("open",e,!1),z.trigger("opendone"),ye&&z.options.enableAlways&&$(window).trigger("focus"),$.each(z.trashes,function(e){var i=z.file(e);i?"directory"===i.mime&&i.write||t(e):n[e]=!0}),Object.keys(n).length&&z.request({data:{cmd:"info",targets:Object.keys(n)},preventDefault:!0}).done(function(e){e&&e.files&&$.each(e.files,function(e,t){"directory"===t.mime&&t.write&&delete n[t.hash]})}).always(function(){$.each(n,t)}),z[z.options.enableAlways?"enable":"disable"]()})):alert(z.i18n("errURL")):alert(z.i18n("errNode")):alert(z.i18n("errJqui"))},n&&"function"==typeof n&&(z.bootCallback=n,n.call(O.get(0),z,{dfrdsBeforeBootup:j})),$.when.apply(null,j).done(function(){l()}).fail(function(e){z.error(e)})};return("undefined"==typeof toGlobal||toGlobal)&&(window.elFinder=h),h.prototype={uniqueid:0,res:function(e,t){return this.resources[e]&&this.resources[e][t]},OS:-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other",UA:(r=!document.unqueID&&!window.opera&&!window.sidebar&&"localStorage"in window&&"WebkitAppearance"in document.documentElement.style,s=r&&window.chrome,l={ltIE6:void 0===window.addEventListener&&void 0===document.documentElement.style.maxHeight,ltIE7:void 0===window.addEventListener&&void 0===document.querySelectorAll,ltIE8:void 0===window.addEventListener&&void 0===document.getElementsByClassName,ltIE9:document.uniqueID&&document.documentMode<=9,ltIE10:document.uniqueID&&document.documentMode<=10,gtIE11:document.uniqueID&&document.documentMode>=11,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:r,Chrome:s,Edge:!(!s||!window.msCredentials),Safari:r&&!window.chrome,Mobile:void 0!==window.orientation,Touch:void 0!==window.ontouchstart,iOS:navigator.platform.match(/^iP(?:[ao]d|hone)/),Mac:navigator.platform.match(/^Mac/),Fullscreen:void 0!==(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen),Angle:0,Rotated:!1,CSS:(a=document.createElement("a").style,o=document.createElement("p").style,i="position:sticky;position:-webkit-sticky;",i+="width:-webkit-max-content;width:-moz-max-content;width:-ms-max-content;width:max-content;",a.cssText=i,{positionSticky:-1!==a.position.indexOf("sticky"),widthMaxContent:-1!==a.width.indexOf("max-content"),flex:void 0!==o.flex})},l),cookieEnabled:(t=!1,n="elftest=",document.cookie=n+"1",t=2===document.cookie.split(n).length,document.cookie=n+";max-age=0",t),hasRequire:"function"==typeof e&&e.amd,currentReqCmd:"",keyState:{},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",nonameDateFormat:"ymd-His",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["msJan","msFeb","msMar","msApr","msMay","msJun","msJul","msAug","msSep","msOct","msNov","msDec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",group:"Selects",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/msword":"MsWord","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/x-xz":"XZ","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","text/x-markdown":"Markdown","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},mimeTypes:{},rules:{defaults:function(e){return!(!e||e.added&&!Array.isArray(e.added)||e.removed&&!Array.isArray(e.removed)||e.changed&&!Array.isArray(e.changed))},open:function(e){return e&&e.cwd&&e.files&&$.isPlainObject(e.cwd)&&Array.isArray(e.files)},tree:function(e){return e&&e.tree&&Array.isArray(e.tree)},parents:function(e){return e&&e.tree&&Array.isArray(e.tree)},tmb:function(e){return e&&e.images&&($.isPlainObject(e.images)||Array.isArray(e.images))},upload:function(e){return e&&($.isPlainObject(e.added)||Array.isArray(e.added))},search:function(e){return e&&e.files&&Array.isArray(e.files)}},commands:{},cmdsToAdd:"archive duplicate extract mkdir mkfile paste rm upload",parseUploadData:function(e){var t,n=this;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{t=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return t=n.normalize(t),n.validResponse("upload",t)?(t.removed=$.merge(t.removed||[],$.map(t.added||[],function(e){return n.file(e.hash)?e.hash:null})),t):{error:t.norError||["errResponse"]}},iframeCnt:0,uploads:{xhrUploading:!1,failSyncTm:null,chunkfailReq:{},checkExists:function(e,t,n,i){var a,o=$.Deferred(),r=[],s={},l=function(){for(var t=e.length;--t>-1;)e[t]._remove=!0},c=function(){o.resolve(r,s)};return n.api>=2.1&&"object"==typeof e[0]?function(){var o=[],d=[],p=t!==n.cwd().hash?n.path(t,!0)+n.option("separator",t):"",u=function(t){var a=t==d.length-1,o={cssClass:"elfinder-confirm-upload",title:n.i18n("cmdupload"),text:["errExists",p+d[t].name,"confirmRepl"],all:!a,accept:{label:"btnYes",callback:function(e){a||e?c():u(++t)}},reject:{label:"btnNo",callback:function(n){var i;if(n)for(i=d.length;t<i--;)e[d[i].i]._remove=!0;else e[d[t].i]._remove=!0;a||n?c():u(++t)}},cancel:{label:"btnCancel",callback:function(){l(),c()}},buttons:[{label:"btnBackup",cssClass:"elfinder-confirm-btn-backup",callback:function(e){var n;if(e)for(n=d.length;t<n--;)r.push(d[n].name);else r.push(d[t].name);a||e?c():u(++t)}}]};i||o.buttons.push({label:"btnRename"+(a?"":"All"),cssClass:"elfinder-confirm-btn-rename",callback:function(){r=null,c()}}),n.iframeCnt>0&&delete o.reject,n.confirm(o)};if(!n.file(t).read)return void c();a=$.map(e,function(e,t){return!e.name||n.UA.iOS&&"image.jpg"===e.name?null:{i:t,name:e.name}}),n.request({data:{cmd:"ls",target:t,intersect:$.map(a,function(e){return e.name})},notify:{type:"preupload",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){var i,r;e&&(e.error?l():n.options.overwriteUploadConfirm&&n.option("uploadOverwrite",t)&&e.list&&(Array.isArray(e.list)?o=e.list||[]:(i=[],o=$.map(e.list,function(e){return"string"==typeof e?e:(i=i.concat(e),!1)}),i.length&&(o=o.concat(i)),s=e.list),(d=$.grep(a,function(e){return-1!==$.inArray(e.name,o)})).length&&o.length&&t==n.cwd().hash&&(r=$.map(n.files(t),function(e){return e.name}),$.grep(o,function(e){return-1===$.inArray(e,r)}).length&&n.sync()))),d.length>0?u(0):c()}).fail(function(e){l(),c(),e&&n.error(e)})}():c(),o},checkFile:function(e,t,n){if(e.checked||"files"==e.type)return e.files;if("data"==e.type){var i,a,o=$.Deferred(),r=$.Deferred(),s=[],l=[],c=0,d=[],p=!1,u=function(e){var n,i=t.options.folderUploadExclude[t.OS]||null,a=e.length,o=function(){--c<1&&"pending"===r.state()&&r.resolve()},h=function(e){i&&e.name.match(i)||(l.push(n.fullPath||""),s.push(e)),o()},f=function(e){var t=[],n=function(){e.readEntries(function(e){if(p||!e.length){for(var i=0;i<t.length;i++){if(p){r.reject();break}u([t[i]])}o()}else t=t.concat((a=e,Array.prototype.slice.call(a||[],0))),n();var a},o)};n()};c++;for(var m=0;m<a;m++){if(p){r.reject();break}(n=e[m])&&(n.isFile?(c++,n.file(h,o)):n.isDirectory&&t.api>=2.1&&(c++,d.push(n.fullPath),f(n.createReader())))}return o(),r};return i=$.map(e.files.items,function(e){return e.getAsEntry?e.getAsEntry():e.webkitGetAsEntry()}),$.each(i,function(e,t){if(t.isDirectory)return a=!0,!1}),i.length>0?(t.uploads.checkExists(i,n,t,a).done(function(a,r){var c=[];t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",n)&&(null===a&&(e.overwrite=0,a=[]),i=$.grep(i,function(e){var i,o,s,l;return e.isDirectory&&a.length&&-1!==(i=$.inArray(e.name,a))&&(a.splice(i,1),o=t.uniqueName(e.name+t.options.backupSuffix,null,""),$.each(r,function(t,n){if(e.name==n)return s=t,!1}),s||(s=t.fileByName(e.name,n).hash),t.lockfiles({files:[s]}),l=t.request({data:{cmd:"rename",target:s,name:o},notify:{type:"rename",cnt:1}}).fail(function(){e._remove=!0,t.sync()}).always(function(){t.unlockfiles({files:[s]})}),c.push(l)),!e._remove})),$.when.apply($,c).done(function(){var e,n,c=+new Date;i.length>0?(n=t.escape(i[0].name),i.length>1&&(n+=" ... "+i.length+t.i18n("items")),e=setTimeout(function(){t.notify({type:"readdir",id:c,cnt:1,hideCnt:!0,msg:t.i18n("ntfreaddir")+" ("+n+")",cancel:function(){p=!0}})},t.options.notifyDelay),u(i).done(function(){e&&clearTimeout(e),t.notify({type:"readdir",id:c,cnt:-1}),p?o.reject():o.resolve([s,l,a,r,d])}).fail(function(){o.reject()})):o.reject()})}),o.promise()):o.reject()}var h=[],f=[],m=e.files[0];if("html"==e.type){var g,v=$("<html/>").append($.parseHTML(m.replace(/ src=/gi," _elfsrc=")));$("img[_elfsrc]",v).each(function(){var t,n,i=$(this),a=i.closest("a");a&&a.attr("href")&&a.attr("href").match(/\.(?:jpe?g|gif|bmp|png)/i)&&(n=a.attr("href")),(t=i.attr("_elfsrc"))&&(n?(-1==$.inArray(n,h)&&h.push(n),-1==$.inArray(t,f)&&f.push(t)):-1==$.inArray(t,h)&&h.push(t)),1===h.length&&h[0].match(/^data:image\/png/)&&(e.clipdata=!0)}),(g=$("a[href]",v)).each(function(){var e,t,n,i;(e=$(this).text())&&(n=$(this).attr("href"),(i=document.createElement("a")).href=n,(t=i).href&&t.href.match(/^(?:ht|f)tp/i)&&(1===g.length||!t.pathname.match(/(?:\.html?|\/[^\/.]*)$/i)||$.trim(e).match(/\.[a-z0-9-]{1,10}$/i))&&-1==$.inArray(t.href,h)&&-1==$.inArray(t.href,f)&&h.push(t.href))})}else{var b,y,w;for(b=/((?:ht|f)tps?:\/\/[-_.!~*\'()a-z0-9;/?:\@&=+\$,%#\*\[\]]+)/gi;y=b.exec(m);)w=y[1].replace(/&amp;/g,"&"),-1==$.inArray(w,h)&&h.push(w)}return h},xhr:function(e,t){var n=t||this,i=n.getUI(),a=new XMLHttpRequest,o=null,r=null,s=null,l=e.checked,c=e.isDataType||"data"==e.type,d=e.target||n.cwd().hash,p=e.dropEvt||null,u=e.extraData||null,h=-1!=n.option("uploadMaxConn",d),f=Math.min(5,Math.max(1,n.option("uploadMaxConn",d))),m=0,g=function(e){var t=$.Deferred();return e.promise?e.always(function(e){t.resolve(Array.isArray(e)&&e.length?c?e[0][0]:e[0]:{})}):t.resolve(e.length?c?e[0][0]:e[0]:{}),t},v=$.Deferred().fail(function(e){var i,a=n.parseError(e);"userabort"===a&&(i=!0,a=void 0),y&&(n.uploads.xhrUploading||i)?g(y).done(function(e){i||U(a,e),e._cid?n.uploads.chunkfailReq[e._cid]||(n.uploads.chunkfailReq[e._cid]=!0,setTimeout(function(){t.request({data:{cmd:"upload",target:d,chunk:e._chunk,cid:e._cid,upload:["chunkfail"],mimes:"chunkfail"},options:{type:"post",url:n.uploadURL},preventDefault:!0}).always(function(){delete n.uploads.chunkfailReq[e._chunk]})},1e3)):(n.uploads.failSyncTm&&clearTimeout(n.uploads.failSyncTm),n.uploads.failSyncTm=setTimeout(function(){n.sync(d)},1e3))}):U(a),!i&&n.sync(),n.uploads.xhrUploading=!1,y=null}).done(function(e){n.uploads.xhrUploading=!1,y=null,e&&(n.currentReqCmd="upload",e.warning&&U(e.warning),n.updateCache(e),e.removed&&e.removed.length&&n.remove(e),e.added&&e.added.length&&n.add(e),e.changed&&e.changed.length&&n.change(e),n.trigger("upload",e,!1),n.trigger("uploaddone"),e.toasts&&Array.isArray(e.toasts)&&$.each(e.toasts,function(){this.msg&&n.toast(this)}),e.sync&&n.sync(),e.debug&&(n.responseDebug(e),t.debug("backend-debug",e)))}).always(function(){n.abortXHR(a),i.off("uploadabort",S),$(window).off("unload",S),o&&clearTimeout(o),r&&clearTimeout(r),s&&clearTimeout(s),l&&!e.multiupload&&M()&&n.notify({type:"upload",cnt:-w,progress:0,size:0}),r&&O&&n.notify({type:"chunkmerge",cnt:-w}),_&&j.children(".elfinder-notify-chunkmerge").length&&n.notify({type:"chunkmerge",cnt:-1})}),b=new FormData,y=e.input?e.input.files:n.uploads.checkFile(e,n,d),w=e.checked&&c?y[0].length:y.length,x=!1,k=0,C=0,T=0,z=!1,j=n.ui.notify,A=!0,O=!1,I=!1,M=function(){return!z&&(N=j.children(".elfinder-notify-upload")).length&&(z=!0),z},S=function(e,t){I=!0,n.abortXHR(a,{quiet:!0,abort:!0}),v.reject(t),M()&&n.notify({type:"upload",cnt:-1*N.data("cnt"),progress:0,size:0})},F=function(e,t){N.children(".elfinder-notify-cancel")[e?"show":"hide"](),A=e},E=function(t){return t||(t=T),setTimeout(function(){z=!0,n.notify({type:"upload",cnt:w,progress:k-C,size:t,cancel:function(){i.trigger("uploadabort","userabort")}}),N=j.children(".elfinder-notify-upload"),C=k,e.multiupload?A&&F(!0):F(A&&k<t)},n.options.notifyDelay)},D=function(){z&&v.notifyWith(N,[{cnt:N.data("cnt"),progress:N.data("progress"),total:N.data("total")}])},U=function(e,t,i){e&&n.trigger("xhruploadfail",{error:e,file:t}),i?e&&(q<n.options.maxErrorDialogs&&(Array.isArray(e)?P=P.concat(e):P.push(e)),q++):e?n.error(e):(P.length&&(q>=n.options.maxErrorDialogs&&(P=P.concat("moreErrors",q-n.options.maxErrorDialogs)),n.error(P)),P=[],q=0)},P=[],q=0,R=e.renames||null,H=e.hashes||null,_=!1,N=$();if(i.one("uploadabort",S),$(window).one("unload."+t.namespace,S),!_&&(C=k),!c&&!w)return v.reject(["errUploadNoFiles"]);a.addEventListener("error",function(){0==a.status?I?v.reject():!c&&e.files&&$.grep(e.files,function(e){return!e.type&&e.size===(n.UA.Safari?1802:0)}).length?v.reject(["errAbort","errFolderUpload"]):e.input&&$.grep(e.input.files,function(e){return!e.type&&e.size===(n.UA.Safari?1802:0)}).length?v.reject(["errUploadNoFiles"]):m++<=30?(M()&&C&&n.notify({type:"upload",cnt:0,progress:0,size:C}),n.abortXHR(a,{quiet:!0}),C=k=0,setTimeout(function(){var e;I||(a.open("POST",n.uploadURL,!0),n.api>=2.1029&&(e=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),"function"==typeof b.delete&&b.delete("reqid"),b.append("reqid",e),a._requestId=e),a.send(b))},1e4)):i.trigger("uploadabort",["errAbort","errTimeout"]):i.trigger("uploadabort","errConnect")},!1),a.addEventListener("load",function(t){var r,l,d=a.status,p=0,u="";if(n.setCustomHeaderByXhr(a),d>=400?u=d>500?"errResponse":["errResponse","errServerError"]:a.responseText||(u=["errResponse","errDataEmpty"]),u&&(i.trigger("uploadabort"),g(y||{}).done(function(e){return v.reject(e._cid?null:u)})),k=T,M()&&(p=k-C)&&(n.notify({type:"upload",cnt:0,progress:p,size:0}),D()),(r=n.parseUploadData(a.responseText))._chunkmerged){b=new FormData;var h=[{_chunkmerged:r._chunkmerged,_name:r._name,_mtime:r._mtime}];return _=!0,i.off("uploadabort",S),s=setTimeout(function(){n.notify({type:"chunkmerge",cnt:1})},n.options.notifyDelay),void(c?W(h,y[1]):W(h))}r._multiupload=!!e.multiupload,r.error?(l={cmd:"upload",err:r,xhr:a,rc:a.status},n.trigger("uploadfail",r),n.trigger("requestError",l),l._getEvent&&l._getEvent().isDefaultPrevented()&&(r.error=""),r._chunkfailure||r._multiupload?(I=!0,n.uploads.xhrUploading=!1,o&&clearTimeout(o),N.length?(n.notify({type:"upload",cnt:-w,progress:0,size:0}),v.reject(r)):v.reject()):v.reject(r)):v.resolve(r)},!1),a.upload.addEventListener("loadstart",function(t){!_&&t.lengthComputable&&(k=t.loaded,m&&(k=0),T=t.total,k||(k=parseInt(.05*T)),M()&&(n.notify({type:"upload",cnt:0,progress:k-C,size:e.multiupload?0:T}),C=k,D()))},!1),a.upload.addEventListener("progress",function(t){var i;t.lengthComputable&&!_&&a.readyState<2&&(k=t.loaded,!e.checked&&k>0&&!o&&(o=E(a._totalSize-k)),T||(T=t.total,k||(k=parseInt(.05*T))),i=k-C,M()&&i/t.total>=.05&&(n.notify({type:"upload",cnt:0,progress:i,size:0}),C=k,D()),!O&&k>=T&&!x&&(O=!0,r=setTimeout(function(){n.notify({type:"chunkmerge",cnt:w})},n.options.notifyDelay)),A&&!e.multiupload&&k>=T&&M()&&F(!1))},!1);var L,B,W=function(i,r){var s,m,g,y,k,C,T,z,j,O,S,D,q,_,N,L=0,B=1,W=[],V=0,K=w,X=0,G=[],J=(new Date).getTime().toString().substr(-9),Y=Math.min((t.uplMaxSize?t.uplMaxSize:2097152)-8190,t.options.uploadMaxChunkSize),Q=!h&&"",Z=function(i,a){var r,s,l,u=[],h=0;if(!I){for(;i.length&&u.length<a;)u.push(i.shift());if(h=u.length){s=h;for(var f=0;f<h&&!I;f++)r=c?u[f][0][0]._cid||null:u[f][0]._cid||null,l=!(!l&&!r),_[r]?q--:t.exec("upload",{type:e.type,isDataType:c,files:u[f],checked:!0,target:d,dropEvt:p,renames:R,hashes:H,multiupload:!0,overwrite:0===e.overwrite?0:void 0,clipdata:e.clipdata},void 0,d).fail(function(e){e&&"No such command"===e&&(I=!0,t.error(["errUpload","errPerm"])),r&&(_[r]=!0)}).always(function(e){e&&e.added&&(S=$.merge(S,e.added)),q<=++D&&(t.trigger("multiupload",{added:S}),o&&clearTimeout(o),M()&&n.notify({type:"upload",cnt:-w,progress:0,size:0})),i.length?Z(i,1):(--s<=1&&A&&F(!1,l),v.resolve())})}}(u.length<1||I)&&(I?(o&&clearTimeout(o),r&&(_[r]=!0),v.reject()):(v.resolve(),n.uploads.xhrUploading=!1))},ee=function(){n.uploads.xhrUploading?setTimeout(ee,100):(n.uploads.xhrUploading=!0,Z(W,f))};if(!l&&(c||"files"==e.type)){for((s=t.option("uploadMaxSize",d))||(s=0),k=0;k<i.length;k++){try{j=i[k],m=j.size,!1===Q&&(Q="",n.api>=2.1&&("slice"in j?Q="slice":"mozSlice"in j?Q="mozSlice":"webkitSlice"in j&&(Q="webkitSlice")))}catch(e){w--,K--;continue}if(s&&m>s||!Q&&t.uplMaxSize&&m>t.uplMaxSize)U(["errUploadFile",j.name,"errUploadFileSize"],j,!0),w--,K--;else if(!j.type||n.uploadMimeCheck(j.type,d))if(Q&&m>Y){for(C=0,T=Y,z=-1,K=Math.floor((m-1)/Y),g=j.lastModified?Math.round(j.lastModified/1e3):0,y=e.clipdata?t.date(t.nonameDateFormat)+".png":j.name,X+=m,G[J]=0;C<m;)(O=j[Q](C,T))._chunk=y+"."+ ++z+"_"+K+".part",O._cid=J,O._range=C+","+O.size+","+m,O._mtime=g,G[J]++,L&&V++,void 0===W[V]&&(W[V]=[],c&&(W[V][0]=[],W[V][1]=[])),L=Y,B=1,c?(W[V][0].push(O),W[V][1].push(r[k])):W[V].push(O),T=(C=T)+Y;null==O?(U(["errUploadFile",j.name,"errUploadFileSize"],j,!0),w--,K--):(K+=z,L=0,B=1,V++)}else(t.uplMaxSize&&L+m>t.uplMaxSize||B>t.uplMaxFile)&&(L=0,B=1,V++),void 0===W[V]&&(W[V]=[],c&&(W[V][0]=[],W[V][1]=[])),c?(W[V][0].push(j),W[V][1].push(r[k])):W[V].push(j),L+=m,X+=m,B++;else U(["errUploadFile",j.name,"errUploadMime","("+j.type+")"],j,!0),w--,K--}if(P.length&&U(),0==W.length)return e.checked=!0,!1;if(W.length>1)return o=E(X),S=[],D=0,q=W.length,_=[],ee(),!0;c?(i=W[0][0],r=W[0][1]):i=W[0]}return l||(t.UA.Safari&&e.files?a._totalSize=X:o=E(X)),l=!0,i.length||v.reject(["errUploadNoFiles"]),a.open("POST",n.uploadURL,!0),t.customHeaders&&$.each(t.customHeaders,function(e){a.setRequestHeader(e,this)}),t.xhrFields&&$.each(t.xhrFields,function(e){e in a&&(a[e]=this)}),n.api>=2.1029&&(N=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),b.append("reqid",N),a._requestId=N),b.append("cmd","upload"),b.append(n.newAPI?"target":"current",d),R&&R.length&&($.each(R,function(e,t){b.append("renames[]",t)}),b.append("suffix",t.options.backupSuffix)),H&&$.each(H,function(e,t){b.append("hashes["+e+"]",t)}),$.each(n.customData,function(e,t){b.append(e,t)}),$.each(n.options.onlyMimes,function(e,t){b.append("mimes[]",t)}),$.each(i,function(n,i){var a,o;i._chunkmerged?(b.append("chunk",i._chunkmerged),b.append("upload[]",i._name),b.append("mtime[]",i._mtime),e.clipdata&&b.append("overwrite",0),x=!0):(i._chunkfail?(b.append("upload[]","chunkfail"),b.append("mimes","chunkfail")):(e.clipdata?i._chunk||(e.overwrite=0,a=t.date(t.nonameDateFormat)+".png"):i.name&&(a=i.name,t.UA.iOS&&(a.match(/^image\.jpe?g$/i)?(e.overwrite=0,a=t.date(t.nonameDateFormat)+".jpg"):a.match(/^capturedvideo\.mov$/i)&&(e.overwrite=0,a=t.date(t.nonameDateFormat)+".mov")),o=(i.webkitRelativePath||i.relativePath||i._relativePath||"").replace(/[^\/]+$/,""),a=o+a),a?b.append("upload[]",i,a):b.append("upload[]",i)),i._chunk?(b.append("chunk",i._chunk),b.append("cid",i._cid),b.append("range",i._range),b.append("mtime[]",i._mtime),x=!0):b.append("mtime[]",i.lastModified?Math.round(i.lastModified/1e3):0))}),c&&$.each(r,function(e,t){b.append("upload_path[]",t)}),0===e.overwrite&&b.append("overwrite",0),p&&b.append("dropWith",parseInt((p.altKey?"1":"0")+(p.ctrlKey?"1":"0")+(p.metaKey?"1":"0")+(p.shiftKey?"1":"0"),2)),u&&$.each(u,function(e,t){b.append(e,t)}),a.send(b),!0};if(c)l?W(y[0],y[1]):y.done(function(e){if(R=[],w=e[0].length){if(e[4]&&e[4].length)return void t.request({data:{cmd:"mkdir",target:d,dirs:e[4]},notify:{type:"mkdir",cnt:e[4].length},preventFail:!0}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?f=1:(f=0,v.reject(e))}).done(function(t){var n=!1;t.hashes||(t.hashes={}),e[1]=$.map(e[1],function(i,a){return e[0][a]._relativePath=i.replace(/^\//,""),""===(i=i.replace(/\/[^\/]*$/,""))?d:t.hashes[i]?t.hashes[i]:(n=!0,e[0][a]._remove=!0,null)}),n&&(e[0]=$.grep(e[0],function(e){return!e._remove}))}).always(function(t){f&&(R=e[2],H=e[3],W(e[0],e[1]))});e[1]=$.map(e[1],function(){return d}),R=e[2],H=e[3],W(e[0],e[1])}else v.reject(["errUploadNoFiles"])}).fail(function(){v.reject()});else if(y.length>0)if(e.clipdata||null!=R)W(y)||v.reject();else{var V=[],K=[],X=t.options.folderUploadExclude[t.OS]||null;$.each(y,function(e,t){var n,i,a=t.webkitRelativePath||t.relativePath||"";if(!a)return!1;X&&t.name.match(X)?(t._remove=!0,a=void 0):(a="/"+a.replace(/\/[^\/]*$/,"").replace(/^\//,""))&&-1===$.inArray(a,V)&&(V.push(a),-1!==(n=a.substr(1).indexOf("/"))&&(i=a.substr(0,n+1))&&-1===$.inArray(i,V)&&V.unshift(i)),K.push(a)}),R=[],H={},V.length?(L=$.map(V,function(e){return-1===e.substr(1).indexOf("/")?{name:e.substr(1)}:null}),B=[],t.uploads.checkExists(L,d,t,!0).done(function(e,n){var i,a,o=[];t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",d)&&(B=$.map(L,function(e){return e._remove?e.name:null}),L=$.grep(L,function(e){return!e._remove})),B.length&&$.each(K.concat(),function(e,t){0===$.inArray(t,B)&&(y[e]._remove=!0,K[e]=void 0)}),y=$.grep(y,function(e){return!e._remove}),K=$.grep(K,function(e){return void 0!==e}),L.length?($.Deferred(),e.length?$.each(e,function(r,s){i=t.uniqueName(s+t.options.backupSuffix,null,""),$.each(n,function(t,n){if(e[0]==n)return a=t,!1}),a||(a=t.fileByName(e[0],d).hash),t.lockfiles({files:[a]}),o.push(t.request({data:{cmd:"rename",target:a,name:i},notify:{type:"rename",cnt:1}}).fail(function(e){v.reject(e),t.sync()}).always(function(){t.unlockfiles({files:[a]})}))}):o.push(null),$.when.apply($,o).done(function(){t.request({data:{cmd:"mkdir",target:d,dirs:V},notify:{type:"mkdir",cnt:V.length},preventFail:!0}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?f=1:(f=0,v.reject(e))}).done(function(e){var t=!1;e.hashes||(e.hashes={}),K=$.map(K.concat(),function(n,i){return"/"===n?d:e.hashes[n]?e.hashes[n]:(t=!0,y[i]._remove=!0,null)}),t&&(y=$.grep(y,function(e){return!e._remove}))}).always(function(e){f&&(c=!0,W(y,K)||v.reject())})})):v.reject()})):t.uploads.checkExists(y,d,t).done(function(n,i){t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",d)&&(H=i,null===n?e.overwrite=0:R=n,y=$.grep(y,function(e){return!e._remove})),(w=y.length)>0&&W(y)||v.reject()})}else v.reject();return v},iframe:function(e,t){var n,i,a,o,r=t||this,s=!!e.input&&e.input,l=!s&&r.uploads.checkFile(e,r),c=$.Deferred().fail(function(e){e&&r.error(e)}),d="iframe-"+t.namespace+ ++r.iframeCnt,p=$('<form action="'+r.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+d+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),u=this.UA.IE,h=function(){o&&clearTimeout(o),a&&clearTimeout(a),i&&r.notify({type:"upload",cnt:-n}),setTimeout(function(){u&&$('<iframe src="javascript:false;"/>').appendTo(p),p.remove(),f.remove()},100)},f=$('<iframe src="'+(u?"javascript:false;":"about:blank")+'" name="'+d+'" style="position:absolute;left:-1000px;top:-1000px" />').on("load",function(){f.off("load").on("load",function(){h(),c.resolve()}),a=setTimeout(function(){i=!0,r.notify({type:"upload",cnt:n})},r.options.notifyDelay),r.options.iframeTimeout>0&&(o=setTimeout(function(){h(),c.reject(["errConnect","errTimeout"])},r.options.iframeTimeout)),p.submit()}),m=e.target||r.cwd().hash,g=[],v=[],b=[],y={};if(l&&l.length)$.each(l,function(e,t){p.append('<input type="hidden" name="upload[]" value="'+t+'"/>')}),n=1;else{if(!(s&&$(s).is(":file")&&$(s).val()))return c.reject();t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",m)&&(g=s.files?s.files:[{name:$(s).val().replace(/^(?:.+[\\\/])?([^\\\/]+)$/,"$1")}],v.push(r.uploads.checkExists(g,m,r).done(function(t,i){y=i,null===t?e.overwrite=0:(b=t,(n=$.grep(g,function(e){return!e._remove}).length)!=g.length&&(n=0))}))),n=s.files?s.files.length:1,p.append(s)}return $.when.apply($,v).done(function(){if(n<1)return c.reject();p.append('<input type="hidden" name="'+(r.newAPI?"target":"current")+'" value="'+m+'"/>').append('<input type="hidden" name="html" value="1"/>').append('<input type="hidden" name="node" value="'+r.id+'"/>').append($(s).attr("name","upload[]")),b.length>0&&($.each(b,function(e,t){p.append('<input type="hidden" name="renames[]" value="'+r.escape(t)+'"/>')}),p.append('<input type="hidden" name="suffix" value="'+t.options.backupSuffix+'"/>')),y&&$.each(b,function(e,t){p.append('<input type="hidden" name="['+e+']" value="'+r.escape(t)+'"/>')}),0===e.overwrite&&p.append('<input type="hidden" name="overwrite" value="0"/>'),$.each(r.options.onlyMimes||[],function(e,t){p.append('<input type="hidden" name="mimes[]" value="'+r.escape(t)+'"/>')}),$.each(r.customData,function(e,t){p.append('<input type="hidden" name="'+e+'" value="'+r.escape(t)+'"/>')}),p.appendTo("body"),f.appendTo("body")}),c}},one:function(e,t,n){var i=this,a=e.toLowerCase(),o=function(e,n){return i.toUnbindEvents[a]||(i.toUnbindEvents[a]=[]),i.toUnbindEvents[a].push({type:a,callback:o}),(t.done?t.done:t).apply(this,arguments)};return t.done&&(o={done:o}),this.bind(a,o,n)},localStorage:function(e,t){var n,i,a,o,r,s=window.localStorage,l="elfinder-"+(e||"")+this.id,c=window.location.pathname+"-elfinder-",d=this.id,p=[];if(void 0===e)return o=c.length,r=-1*d.length,$.each(s,function(e){e.substr(0,o)===c&&e.substr(r)===d&&p.push(e)}),$.each(p,function(e,t){s.removeItem(t)}),!0;if(e=c+e+d,null===t)return s.removeItem(e);if(void 0===t&&!(n=s.getItem(e))&&(i=s.getItem(l))&&(t=i,s.removeItem(l)),void 0!==t){"string"!==(a=typeof t)&&"number"!==a&&(t=JSON.stringify(t));try{s.setItem(e,t)}catch(n){try{s.clear(),s.setItem(e,t)}catch(e){this.debug("error",e.toString())}}n=s.getItem(e)}if(n&&("{"===n.substr(0,1)||"["===n.substr(0,1)))try{return JSON.parse(n)}catch(e){}return n},sessionStorage:function(e,t){var n,i,a;try{n=window.sessionStorage}catch(e){}if(n){if(null===t)return n.removeItem(e);if(void 0!==t){"string"!==(a=typeof t)&&"number"!==a&&(t=JSON.stringify(t));try{n.setItem(e,t)}catch(i){try{n.clear(),n.setItem(e,t)}catch(e){this.debug("error",e.toString())}}}if((i=n.getItem(e))&&("{"===i.substr(0,1)||"["===i.substr(0,1)))try{return JSON.parse(i)}catch(e){}return i}},cookie:function(e,t){var n,i,a,o,r,s;if(e="elfinder-"+e+this.id,void 0===t){if(this.cookieEnabled&&document.cookie&&""!=document.cookie)for(a=document.cookie.split(";"),e+="=",o=0;o<a.length;o++)if(a[o]=$.trim(a[o]),a[o].substring(0,e.length)==e){if("{"===(r=decodeURIComponent(a[o].substring(e.length))).substr(0,1)||"["===r.substr(0,1))try{return JSON.parse(r)}catch(e){}return r}return null}if(!this.cookieEnabled)return"";if(i=Object.assign({},this.options.cookie),null===t?(t="",i.expires=-1):"string"!==(s=typeof t)&&"number"!==s&&(t=JSON.stringify(t)),"number"==typeof i.expires&&((n=new Date).setTime(n.getTime()+864e5*i.expires),i.expires=n),document.cookie=e+"="+encodeURIComponent(t)+"; expires="+i.expires.toUTCString()+(i.path?"; path="+i.path:"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":""),t&&("{"===t.substr(0,1)||"["===t.substr(0,1)))try{return JSON.parse(t)}catch(e){}return t},startDir:function(){var e=window.location.hash;return e&&e.match(/^#elf_/)?e.replace(/^#elf_/,""):this.options.startPathHash?this.options.startPathHash:this.lastDir()},lastDir:function(e){return this.options.rememberLastDir?this.storage("lastdir",e):""},_node:$("<span/>"),escape:function(e){return this._node.text(e).html().replace(/"/g,"&quot;").replace(/'/g,"&#039;")},normalize:function(e){var t,n,i,a,o,r,s,l=this,c=function(){var e,t;return(t=l.options.fileFilter)&&("function"==typeof t?e=function(e){return t.call(l,e)}:t instanceof RegExp&&(e=function(e){return t.test(e.name)})),e||null}(),d=function(e){var t=function(e){var t=typeof e;return"object"===t&&Array.isArray(e)&&(t="array"),t};return $.each(l.optionProperties,function(n,i){void 0!==i&&e[n]&&t(e[n])!==t(i)&&(e[n]=i)}),e.disabled?(e.disabledFlip=l.arrayFlip(e.disabled,!0),$.each(l.options.disabledCmdsRels,function(t,n){var i,a;e.disabledFlip[t]?a=!0:(i=t.match(/^([^&]+)&([^=]+)=(.*)$/))&&e.disabledFlip[i[1]]&&e[i[2]]==i[3]&&(a=!0),a&&$.each(n,function(t,n){e.disabledFlip[n]||(e.disabledFlip[n]=!0,e.disabled.push(n))})})):e.disabledFlip={},e},p=function(e,o,r){var s,p,u,f,m,g,v=!o||e,b=!!o&&null;if(e&&e.hash&&e.name&&e.mime){if("application/x-empty"===e.mime&&(e.mime="text/plain"),(u=l.isRoot(e))&&!e.volumeid&&l.debug("warning","The volume root statuses requires `volumeid` property."),u||"directory"===e.mime){if(e.phash){if(e.phash===e.hash)return h=h.concat(['Parent folder of "$1" is itself.',e.name]),b;if(u&&e.volumeid&&0===e.phash.indexOf(e.volumeid))return h=h.concat(['Parent folder of "$1" is inner itself.',e.name]),b}e.volumeid&&(s=e.volumeid,u&&(e.phash&&(l.leafRoots[e.phash]?-1===$.inArray(e.hash,l.leafRoots[e.phash])&&l.leafRoots[e.phash].push(e.hash):l.leafRoots[e.phash]=[e.hash]),l.hasVolOptions=!0,l.volOptions[s]||(l.volOptions[s]={dispInlineRegex:l.options.dispInlineRegex}),p=l.volOptions[s],e.options&&Object.assign(p,e.options),e.disabled&&(p.disabled=e.disabled,p.disabledFlip=l.arrayFlip(e.disabled,!0)),e.tmbUrl&&(p.tmbUrl=e.tmbUrl),p.url&&"/"!==p.url.substr(-1)&&(p.url+="/"),(m=p).uiCmdMap&&($.isPlainObject(m.uiCmdMap)&&Object.keys(m.uiCmdMap).length?(m.disabledFlip||(m.disabledFlip={}),g=m.disabledFlip,$.each(m.uiCmdMap,function(e,t){"hidden"!==t||g[e]||(m.disabled.push(e),m.disabledFlip[e]=!0)})):delete m.uiCmdMap),p.trashHash&&(!1===l.trashes[p.trashHash]?delete p.trashHash:l.trashes[p.trashHash]=e.hash),$.each(l.optionProperties,function(t){p[t]&&(e[t]=p[t])}),"cwd"!==r&&(l.roots[s]=e.hash),e.expires&&(l.volumeExpires[s]=e.expires)),a!==s&&(a=s,i=l.option("i18nFolderName",s))),u&&!e.i18&&(t="volume_"+e.name,n=l.i18n(!1,t),t!==n&&(e.i18=n)),i&&!e.i18&&(t="folder_"+e.name,n=l.i18n(!1,t),t!==n&&(e.i18=n)),u&&(f=l.storage("rootNames"))&&(f[e.hash]&&(e._name=e.name,e._i18=e.i18,e.name=f[e.hash]=f[e.hash],delete e.i18),l.storage("rootNames",f)),l.trashes[e.hash]&&(e.locked=!0)}else{if(c)try{if(!c(e))return b}catch(e){l.debug(e)}0==e.size&&(e.mime=l.getMimetype(e.name,e.mime))}return e.options&&(l.optionsByHashes[e.hash]=d(e.options)),delete e.options,v}return b},u=function(t,n){$.each(t,function(t,i){var a,o;l.leafRoots[i.hash]&&l.applyLeafRootStats(i),"change"!==n&&i.phash&&l.isRoot(i)&&(a=l.file(i.phash))&&(l.applyLeafRootStats(a),e.changed?($.each(e.changed,function(t,n){if(n.hash===a.hash)return e.changed[t]=a,o=!0,!1}),o||e.changed.push(a)):e.changed=[a])})},h=[];if(e.customData&&(!l.prevCustomData||JSON.stringify(e.customData)!==JSON.stringify(l.prevCustomData))){l.prevCustomData=e.customData;try{o=JSON.parse(e.customData),$.isPlainObject(o)&&(l.prevCustomData=o,$.each(Object.keys(o),function(e,t){null===o[t]&&(delete o[t],delete l.optsCustomData[t])}),l.customData=Object.assign({},l.optsCustomData,o))}catch(e){}}return e.options&&d(e.options),e.cwd&&(e.cwd.volumeid&&e.options&&Object.keys(e.options).length&&l.isRoot(e.cwd)&&(l.hasVolOptions=!0,l.volOptions[e.cwd.volumeid]=e.options),e.cwd=p(e.cwd,!0,"cwd")),e.files&&(e.files=$.grep(e.files,p)),e.tree&&(e.tree=$.grep(e.tree,p)),e.added&&(e.added=$.grep(e.added,p)),e.changed&&(e.changed=$.grep(e.changed,p)),e.removed&&e.removed.length&&2===l.searchStatus.state&&(e.removed=e.removed.concat((r=e.removed,s=[],$.each(l.files(),function(e,t){$.each(l.parents(e),function(t,n){if(-1!==$.inArray(n,r)&&-1===$.inArray(e,r))return s.push(e),!1})}),s))),e.api&&(e.init=!0),Object.keys(l.leafRoots).length&&(e.files&&u(e.files),e.tree&&u(e.tree),e.added&&u(e.added),e.changed&&u(e.changed,"change")),e.cwd&&e.cwd.options&&e.options&&Object.assign(e.options,d(e.cwd.options)),e.options&&e.options.url&&"/"!==e.options.url.substr(-1)&&(e.options.url+="/"),h.length&&(e.norError=["errResponse"].concat(h)),e},setSort:function(e,t,n,i){this.storage("sortType",this.sortType=this.sortRules[e]?e:"name"),this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc"),this.storage("sortStickFolders",(this.sortStickFolders=!!n)?1:""),this.storage("sortAlsoTreeview",(this.sortAlsoTreeview=!!i)?1:""),this.trigger("sortchange")},_sortRules:{name:function(e,t){return h.prototype.naturalCompare(e.i18||e.name,t.i18||t.name)},size:function(e,t){var n=parseInt(e.size)||0,i=parseInt(t.size)||0;return n===i?0:n>i?1:-1},kind:function(e,t){return h.prototype.naturalCompare(e.mime,t.mime)},date:function(e,t){var n=e.ts||e.date||0,i=t.ts||t.date||0;return n===i?0:n>i?1:-1},perm:function(e,t){var n=function(e){return(e.write?2:0)+(e.read?1:0)},i=n(e),a=n(t);return i===a?0:i>a?1:-1},mode:function(e,t){var n=e.mode||e.perm||"",i=t.mode||t.perm||"";return h.prototype.naturalCompare(n,i)},owner:function(e,t){var n=e.owner||"",i=t.owner||"";return h.prototype.naturalCompare(n,i)},group:function(e,t){var n=e.group||"",i=t.group||"";return h.prototype.naturalCompare(n,i)}},sorters:{},naturalCompare:function(e,t){var n=h.prototype.naturalCompare;return void 0===n.loc&&(n.loc=navigator.userLanguage||navigator.browserLanguage||navigator.language||"en-US"),void 0===n.sort&&("11".localeCompare("2",n.loc,{numeric:!0})>0?window.Intl&&window.Intl.Collator?n.sort=new Intl.Collator(n.loc,{numeric:!0}).compare:n.sort=function(e,t){return e.localeCompare(t,n.loc,{numeric:!0})}:(n.sort=function(e,t){var i,a,o=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,r=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,c=/^0/,d=/^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/,p=function(e){return n.sort.insensitive&&(""+e).toLowerCase()||""+e},u=p(e).replace(r,"").replace(/^_/,"")||"",h=p(t).replace(r,"").replace(/^_/,"")||"",f=u.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=h.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(u.match(l))||1!=f.length&&u.match(s)&&Date.parse(u),v=parseInt(h.match(l))||g&&h.match(s)&&Date.parse(h)||null,b=0;if(v){if(g<v)return-1;if(g>v)return 1}for(var y=0,w=Math.max(f.length,m.length);y<w;y++){if(i=!(f[y]||"").match(c)&&parseFloat(f[y])||f[y]||0,a=!(m[y]||"").match(c)&&parseFloat(m[y])||m[y]||0,isNaN(i)!==isNaN(a)){if(isNaN(i)&&("string"!=typeof i||!i.match(d)))return 1;if("string"!=typeof a||!a.match(d))return-1}if(0===parseInt(i,10)&&(i=0),0===parseInt(a,10)&&(a=0),typeof i!=typeof a&&(i+="",a+=""),n.sort.insensitive&&"string"==typeof i&&"string"==typeof a&&0!==(b=i.localeCompare(a,n.loc)))return b;if(i<a)return-1;if(i>a)return 1}return 0},n.sort.insensitive=!0)),n.sort(e,t)},compare:function(e,t){var n,i=this.sortType,a="asc"==this.sortOrder,o=this.sortStickFolders,r=this.sortRules,s=r[i],l="directory"==e.mime,c="directory"==t.mime;if(o){if(l&&!c)return-1;if(!l&&c)return 1}return n=a?s(e,t):s(t,e),"name"!==i&&0===n?n=a?r.name(e,t):r.name(t,e):n},sortFiles:function(e){return e.sort(this.compare)},notify:function(e){var t,n,i,a=this,o=e.type,r=e.id?"elfinder-notify-"+e.id:"",s=this.i18n(void 0!==e.msg?e.msg:this.messages["ntf"+o]?"ntf"+o:"ntfsmth"),l=this.arrayFlip(this.options.notifyDialog.hiddens||[]),c=this.ui.notify,d=c.closest(".ui-dialog"),p=c.children(".elfinder-notify-"+o+(r?"."+r:"")),u=p.children("div.elfinder-notify-cancel").children("button"),h='<div class="elfinder-notify elfinder-notify-{type}'+(r?" "+r:"")+'"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div><div class="elfinder-notify-cancel"/></div>',f=e.cnt+0,m=void 0!==e.size?parseInt(e.size):null,g=void 0!==e.progress&&e.progress>=0?e.progress:null,v=e.fakeinterval||200,b=e.cancel,y=function(){var e=p.find(".elfinder-notify-progress"),t=function(){p.remove(),c.children(d.data("minimized")?void 0:":visible").length||(d.data("minimized")?d.data("minimized").hide():c.elfinderdialog("close")),x()};p._esc&&$(document).off("keydown",p._esc),p.data("cur")<100?e.animate({width:"100%"},50,function(){requestAnimationFrame(function(){t()})}):t()},w=function(e){var t;p.length&&(t=p.data("cur")+1)<=98&&(p.find(".elfinder-notify-progress").width(t+"%"),p.data("cur",t),x(),setTimeout(function(){w(e*=1.05)},e))},x=function(){var e,t=0,n=0,i=c.children(".elfinder-notify");i.length?(i.each(function(){t++,n+=Math.min($(this).data("cur"),100)}),e=t?Math.floor(n/(100*t)*100)+"%":0,a.ui.progressbar.width(e),d.data("minimized")&&(d.data("minimized").title(e),d.data("minimized").dialog().children(".ui-dialog-titlebar").children(".elfinder-ui-progressbar").width(e))):(a.ui.progressbar.width(0),d.data("minimized")&&d.data("minimized").hide())};return o?(p.length?void 0!==e.msg&&p.children("span.elfinder-notify-msg").html(s):(p=$(h.replace(/\{type\}/g,o).replace(/\{msg\}/g,s)),l[o]?p.hide():c.on("minimize",function(e){d.data("minimized")&&x()}),p.appendTo(c).data("cnt",0),null!=g?p.data({progress:0,total:0,cur:0}):(p.data({cur:0}),w(v)),b&&(u=$('<span class="elfinder-notify-button ui-icon ui-icon-close" title="'+this.i18n("btnCancel")+'"/>').on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"===e.type)}),p.children("div.elfinder-notify-cancel").append(u)),c.trigger("resize")),(t=f+parseInt(p.data("cnt")))>0?(b&&u.length&&($.isFunction(b)||"object"==typeof b&&b.promise)&&(p._esc=function(e){"keydown"==e.type&&e.keyCode!=$.ui.keyCode.ESCAPE||(e.preventDefault(),e.stopPropagation(),y(),b.promise?b.reject(0):b(e))},u.on("click",function(e){p._esc(e)}),$(document).on("keydown."+this.namespace,p._esc)),!e.hideCnt&&p.children(".elfinder-notify-cnt").text("("+t+")"),f>0&&c.is(":hidden")&&!l[o]&&(d.data("minimized")?d.data("minimized").show():c.elfinderdialog("open",this).height("auto")),p.data("cnt",t),null!=g&&(n=p.data("total"))>=0&&(i=p.data("progress"))>=0&&(n+=null!=m?m:f,i+=g,null==m&&f<0&&(i+=100*f),p.data({progress:i,total:n}),null!=m&&(i*=100,n=Math.max(1,n)),g=Math.min(parseInt(i/n),100),p.find(".elfinder-notify-progress").animate({width:(g<100?g:100)+"%"},20,function(){p.data("cur",g),x()}))):y(),this):this},confirm:function(e){var t,n,i=this,a=!1,o={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(e.title||"confirmReq"),buttons:{},close:function(){!a&&e.cancel.callback(),$(this).elfinderdialog("destroy")}},r=this.i18n("apllyAll");return e.cssClass&&(o.cssClass+=" "+e.cssClass),o.buttons[this.i18n(e.accept.label)]=function(){e.accept.callback(!(!t||!t.prop("checked"))),a=!0,$(this).elfinderdialog("close")},o.buttons[this.i18n(e.accept.label)]._cssClass="elfinder-confirm-accept",e.reject&&(o.buttons[this.i18n(e.reject.label)]=function(){e.reject.callback(!(!t||!t.prop("checked"))),a=!0,$(this).elfinderdialog("close")},o.buttons[this.i18n(e.reject.label)]._cssClass="elfinder-confirm-reject"),e.buttons&&e.buttons.length>0&&(n=1,$.each(e.buttons,function(e,r){o.buttons[i.i18n(r.label)]=function(){r.callback(!(!t||!t.prop("checked"))),a=!0,$(this).elfinderdialog("close")},o.buttons[i.i18n(r.label)]._cssClass="elfinder-confirm-extbtn"+n++,r.cssClass&&(o.buttons[i.i18n(r.label)]._cssClass+=" "+r.cssClass)})),o.buttons[this.i18n(e.cancel.label)]=function(){$(this).elfinderdialog("close")},o.buttons[this.i18n(e.cancel.label)]._cssClass="elfinder-confirm-cancel",e.all&&(o.create=function(){var e=$('<div class="elfinder-dialog-confirm-applyall"/>');t=$('<input type="checkbox" />'),$(this).next().find(".ui-dialog-buttonset").prepend(e.append($("<label>"+r+"</label>").prepend(t)))}),e.optionsCallback&&$.isFunction(e.optionsCallback)&&e.optionsCallback(o),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(e.text),o)},uniqueName:function(e,t,n){var i,a,o=0,r="";if(e=this.i18n(!1,e),t=t||this.cwd().hash,n=void 0===n?" ":n,(i=e.match(/^(.+)(\.[^.]+)$/))&&(r=i[2],e=i[1]),a=e+r,!this.fileByName(a,t))return a;for(;o<1e4;)if(a=e+n+ ++o+r,!this.fileByName(a,t))return a;return e+Math.random()+r},i18n:function(){var e,t,n,i,a,o=this,r=this.messages,s=[],l=[],c=function(e){var t;return 0===e.indexOf("#")&&(t=o.file(e.substr(1)))?t.name:e},d=0;for(arguments.length&&!1===arguments[0]&&(i=function(e){return e},d=1),e=d;e<arguments.length;e++)if(n=arguments[e],Array.isArray(n))for(t=0;t<n.length;t++)n[t]instanceof jQuery?s.push(n[t]):void 0!==n[t]&&s.push(c(""+n[t]));else n instanceof jQuery?s.push(n[t]):void 0!==n&&s.push(c(""+n));for(e=0;e<s.length;e++)-1===$.inArray(e,l)&&("string"==typeof(n=s[e])?(a=!(!r[n]||!n.match(/^err/)),n=(n=r[n]||(i?i(n):o.escape(n))).replace(/\$(\d+)/g,function(t,n){var r;return(n=e+parseInt(n))>0&&s[n]&&l.push(n),r=i?i(s[n]):o.escape(s[n]),a&&(r='<span class="elfinder-err-var elfinder-err-var'+n+'">'+r+"</span>"),r})):n=n.get(0).outerHTML,s[e]=n);return $.grep(s,function(e,t){return-1===$.inArray(t,l)}).join("<br>")},getIconStyle:function(e,t){var n=this,i="",a={},o=0;return e.icon&&(i='style="',$.each({background:"url('{url}') 0 0 no-repeat","background-size":"contain"},function(r,s){0==o++&&(s=s.replace("{url}",n.escape(e.icon))),t?a[r]=s:i+=r+":"+s+";"}),i+='"'),t?a:i},mime2class:function(e){var t="elfinder-cwd-icon-",n=e.toLowerCase(),i=this.textMimes[n];return n=n.split("/"),i?n[0]+=" "+t+"text":n[1]&&n[1].match(/\+xml$/)&&(n[0]+=" "+t+"xml"),t+n[0]+(n[1]?" "+t+n[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(e){var t,n="object"==typeof e,i=n?e.mime:e;return n&&e.alias&&"symlink-broken"!=i?t="Alias":this.kinds[i]&&(t=!n||"directory"!==i||e.phash&&!e.isroot?this.kinds[i]:"Root"),t||(t=0===i.indexOf("text")?"Text":0===i.indexOf("image")?"Image":0===i.indexOf("audio")?"Audio":0===i.indexOf("video")?"Video":0===i.indexOf("application")?"App":i),this.messages["kind"+t]?this.i18n("kind"+t):i},mimeIsText:function(e){return!!(this.textMimes[e.toLowerCase()]||0===e.indexOf("text/")&&"rtf"!==e.substr(5,3)||e.match(/^application\/.+\+xml$/))},date:function(e,t){var n,i,a,o,r,s,l,c,d=this;return t||(t=new Date),r=t[d.getHours](),s=r>12?r-12:r,l=t[d.getMinutes](),c=t[d.getSeconds](),n=t[d.getDate](),i=t[d.getDay](),a=t[d.getMonth]()+1,o=t[d.getFullYear](),e.replace(/[a-z]/gi,function(e){switch(e){case"d":return n>9?n:"0"+n;case"j":return n;case"D":return d.i18n(d.i18.daysShort[i]);case"l":return d.i18n(d.i18.days[i]);case"m":return a>9?a:"0"+a;case"n":return a;case"M":return d.i18n(d.i18.monthsShort[a-1]);case"F":return d.i18n(d.i18.months[a-1]);case"Y":return o;case"y":return(""+o).substr(2);case"H":return r>9?r:"0"+r;case"G":return r;case"g":return s;case"h":return s>9?s:"0"+s;case"a":return r>=12?"pm":"am";case"A":return r>=12?"PM":"AM";case"i":return l>9?l:"0"+l;case"s":return c>9?c:"0"+c}return e})},formatDate:function(e,t){var n,i,a,o=this,r=t||e.ts;o.i18;return o.options.clientFormatDate&&r>0?(n=new Date(1e3*r),i=r>=this.yesterday?this.fancyFormat:this.dateFormat,a=o.date(i,n),r>=this.yesterday?a.replace("$1",this.i18n(r>=this.today?"Today":"Yesterday")):a):e.date?e.date.replace(/([a-z]+)\s/i,function(e,t){return o.i18n(t)+" "}):o.i18n("dateUnknown")},toLocaleString:function(e){var t=new Number(e);return t?t.toLocaleString?t.toLocaleString():String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):e},perms2class:function(e){var t="";return e.read||e.write?e.read?e.write||(t="elfinder-ro"):t="elfinder-wo":t="elfinder-na",e.type&&(t+=" elfinder-"+this.escape(e.type)),t},formatPermissions:function(e){var t=[];return e.read&&t.push(this.i18n("read")),e.write&&t.push(this.i18n("write")),t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(e){var t=1,n="b";return"unknown"==e?this.i18n("unknown"):(e>1073741824?(t=1073741824,n="GB"):e>1048576?(t=1048576,n="MB"):e>1024&&(t=1024,n="KB"),((e/=t)>0?t>=1048576?e.toFixed(2):Math.round(e):0)+" "+n)},formatFileMode:function(e,t){var n,i,a,o,r,s,l,c;if(t||(t=this.options.fileModeStyle.toLowerCase()),(e=$.trim(e)).match(/[rwxs-]{9}$/i)){if(l=e=e.substr(-9),"string"==t)return l;for(c="",a=0,n=0;n<7;n+=3)i=e.substr(n,3),o=0,i.match(/[r]/i)&&(o+=4),i.match(/[w]/i)&&(o+=2),i.match(/[xs]/i)&&(i.match(/[xs]/)&&(o+=1),i.match(/[s]/i)&&(0==n?a+=4:3==n&&(a+=2))),c+=o.toString(8);a&&(c=a.toString(8)+c)}else{if(e=parseInt(e,8),c=e?e.toString(8):"",!e||"octal"==t)return c;for(i=e.toString(8),a=0,i.length>3&&(i=i.substr(-4),a=parseInt(i.substr(0,1),8),i=i.substr(1)),1==(1&a),s=2==(2&a),r=4==(4&a),l="",n=0;n<3;n++)4==(4&parseInt(i.substr(n,1),8))?l+="r":l+="-",2==(2&parseInt(i.substr(n,1),8))?l+="w":l+="-",1==(1&parseInt(i.substr(n,1),8))?l+=0==n&&r||1==n&&s?"s":"x":l+="-"}return"both"==t?l+" ("+c+")":"string"==t?l:c},registRawStringDecoder:function(e){$.isFunction(e)&&(this.decodeRawString=this.options.rawStringDecoder=e)},uploadMimeCheck:function(e,t){t=t||this.cwd().hash;var n,i,a=!0,o=this.option("uploadMime",t),r=function(t){var n=!1;return"string"==typeof t&&"all"===t.toLowerCase()?n=!0:Array.isArray(t)&&t.length&&$.each(t,function(t,i){if("all"===(i=i.toLowerCase())||0===e.indexOf(i))return n=!0,!1}),n};return e&&$.isPlainObject(o)&&(e=e.toLowerCase(),n=r(o.allow),i=r(o.deny),"allow"===o.firstOrder?(a=!1,i||!0!==n||(a=!0)):(a=!0,!0!==i||n||(a=!1))),a},sequence:function(e){var t=e.length,n=function(t,i){return e[++i]?n(t.then(e[i]),i):t};return t>1?n(e[0](),0):e[0]()},reloadContents:function(e){var t,n=$.Deferred();try{t=$('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">').attr("src",e).one("load",function(){var t=$(this);try{this.contentDocument.location.reload(!0),t.one("load",function(){t.remove(),n.resolve()})}catch(i){t.attr("src","").attr("src",e).one("load",function(){t.remove(),n.resolve()})}}).appendTo("body")}catch(e){t&&t.remove(),n.reject()}return n},makeNetmountOptionOauth:function(e,t,n,i){var a,o="boolean"==typeof i?i:null,r=Object.assign({noOffline:!1,root:"root",pathI18n:"folderId",folders:!0},null===o?i||{}:{noOffline:o}),s=function(t,i,o){var c,d=this,p=Object.keys($.isPlainObject(o)?o:{}).length;i.next().remove(),p&&(c=$('<select class="ui-corner-all elfinder-tabstop" style="max-width:200px;">').append($($.map(o,function(e,n){return'<option value="'+t.escape((n+"").trim())+'">'+t.escape(e)+"</option>"}).join(""))).on("change click",function(i){var o,c=$(this),p=c.val();d.inputs.path.val(p),!r.folders||"change"!==i.type&&c.data("current")===p||(c.next().remove(),c.data("current",p),p!=r.root&&(o=l(),a&&"pending"===a.state()&&t.abortXHR(a,{quiet:!0,abort:!0}),c.after(o),a=t.request({data:{cmd:"netmount",protocol:e,host:n,user:"init",path:p,pass:"folders"},preventDefault:!0}).done(function(e){s.call(d,t,c,e.folders)}).always(function(){t.abortXHR(a,{quiet:!0}),o.remove()}).xhr))}),i.after($("<div/>").append(c)).closest(".ui-dialog").trigger("tabstopsInit"),c.trigger("focus"))},l=function(){return $('<div class="elfinder-netmount-spinner"/>').append('<span class="elfinder-spinner"/>')};return{vars:{},name:t,inputs:{offline:$('<input type="checkbox"/>').on("change",function(){$(this).parents("table.elfinder-netmount-tb").find("select:first").trigger("change","reset")}),host:$('<span><span class="elfinder-spinner"/></span><input type="hidden"/>'),path:$('<input type="text" value="'+r.root+'"/>'),user:$('<input type="hidden"/>'),pass:$('<input type="hidden"/>'),mnt2res:$('<input type="hidden"/>')},select:function(t,i,a){var o=this.inputs,s=o.offline,l=$(o.host[0]),c=a||null;this.vars.mbtn=o.host.closest(".ui-dialog").children(".ui-dialog-buttonpane:first").find("button.elfinder-btncnt-0"),l.data("inrequest")||!l.find("span.elfinder-spinner").length&&"reset"!==c&&("winfocus"!==c||l.siblings("span.elfinder-button-icon-reload").length)?(s.closest("tr")[r.noOffline||o.user.val()?"hide":"show"](),l.data("funcexpup")&&l.data("funcexpup")()):(1===s.parent().children().length&&(o.path.parent().prev().html(t.i18n(r.pathI18n)),s.attr("title",t.i18n("offlineAccess")),s.uniqueId().after($("<label/>").attr("for",s.attr("id")).html(" "+t.i18n("offlineAccess")))),l.data("inrequest",!0).empty().addClass("elfinder-spinner").parent().find("span.elfinder-button-icon").remove(),t.request({data:{cmd:"netmount",protocol:e,host:n,user:"init",options:{id:t.id,offline:s.prop("checked")?1:0,pass:o.host[1].value}},preventDefault:!0}).done(function(e){l.removeClass("elfinder-spinner").html(e.body.replace(/\{msg:([^}]+)\}/g,function(e,i){return t.i18n(i,n)}))}),r.noOffline&&s.closest("tr").hide()),this.vars.mbtn[$(o.host[1]).val()?"show":"hide"]()},done:function(t,i){var a,o=this.inputs,l=this.protocol,c=$(o.host[0]),d=$(o.host[1]),p="&nbsp;",u=this.vars,h=function(){u.oauthW&&!document.hasFocus()&&--u.chkCnt&&(l.trigger("change","winfocus"),u.tm=setTimeout(h,3e3))};if(r.noOffline&&o.offline.closest("tr").hide(),"makebtn"==i.mode)c.removeClass("elfinder-spinner").removeData("expires").removeData("funcexpup"),a=o.host.find("input").on("mouseenter mouseleave",function(){$(this).toggleClass("ui-state-hover")}),i.url&&a.on("click",function(){u.tm&&clearTimeout(u.tm),u.oauthW=window.open(i.url),(t.UA.iOS||t.UA.Mac)&&t.isCORS&&!u.chkdone&&(u.chkCnt=60,u.tm=setTimeout(h,5e3))}),d.val(""),o.path.val(r.root).next().remove(),o.user.val(""),o.pass.val(""),!r.noOffline&&o.offline.closest("tr").show(),u.mbtn.hide();else if("folders"==i.mode)i.folders&&s.call(this,t,o.path.nextAll(":last"),i.folders);else{if(u.oauthW&&(u.tm&&clearTimeout(u.tm),u.oauthW.close(),delete u.oauthW,u.chkdone=!0),i.expires&&(p="()",c.data("expires",i.expires)),c.html(n+p).removeClass("elfinder-spinner"),i.expires&&(c.data("funcexpup",function(){var e=Math.floor((c.data("expires")-+new Date/1e3)/60);e<3?c.parent().children(".elfinder-button-icon-reload").click():(c.text(c.text().replace(/\(.*\)/,"("+t.i18n(["minsLeft",e])+")")),setTimeout(function(){c.is(":visible")&&c.data("funcexpup")()},6e4))}),c.data("funcexpup")()),i.reset)return void l.trigger("change","reset");c.parent().append($('<span class="elfinder-button-icon elfinder-button-icon-reload" title="'+t.i18n("reAuth")+'">').on("click",function(){d.val("reauth"),l.trigger("change","reset")})),d.val(e),u.mbtn.show(),i.folders&&s.call(this,t,o.path,i.folders),i.mnt2res&&o.mnt2res.val("1"),o.user.val("done"),o.pass.val("done"),o.offline.closest("tr").hide()}c.removeData("inrequest")},fail:function(e,t){$(this.inputs.host[0]).removeData("inrequest"),this.protocol.trigger("change","reset")},integrateInfo:r.integrate}},findCwdNodes:function(e,t){var n=this,i=(this.getUI("cwd"),this.cwd().hash),a=$();return t=t||{},$.each(e,function(e,o){if((o.phash===i||n.searchStatus.state>1)&&(a=a.add(n.cwdHash2Elm(o.hash)),t.firstOnly))return!1}),a},convAbsUrl:function(e){if(e.match(/^http/i))return e;if("//"===e.substr(0,2))return window.location.protocol+e;var t,n=window.location.protocol+"//"+window.location.host,i=/[^\/]+\/\.\.\//;for(t=(t="/"===e.substr(0,1)?n+e:n+window.location.pathname.replace(/\/[^\/]+$/,"/")+e).replace("/./","/");i.test(t);)t=t.replace(i,"");return t},isSameOrigin:function(e){var t;if(e=this.convAbsUrl(e),location.origin&&window.URL)try{return t=new URL(e),location.origin===t.origin}catch(e){}return(t=document.createElement("a")).href=e,location.protocol===t.protocol&&location.host===t.host&&location.port&&t.port},navHash2Id:function(e){return this.navPrefix+e},navId2Hash:function(e){return"string"==typeof e&&e.substr(this.navPrefix.length)},cwdHash2Id:function(e){return this.cwdPrefix+e},cwdId2Hash:function(e){return"string"==typeof e&&e.substr(this.cwdPrefix.length)},navHash2Elm:function(e){return $(document.getElementById(this.navHash2Id(e)))},cwdHash2Elm:function(e){return $(document.getElementById(this.cwdHash2Id(e)))},isInWindow:function(e,t){var n,i;return!!(n=e.get(0))&&(!(!t&&null===n.offsetParent)&&(i=n.getBoundingClientRect(),!!document.elementFromPoint(i.left,i.top)))},zIndexCalc:function(){var e=this,t=this.getUI(),n=t.css("z-index");n&&"auto"!==n&&"inherit"!==n?e.zIndex=n:t.parents().each(function(t,n){var i=$(n).css("z-index");if("auto"!==i&&"inherit"!==i&&(i=parseInt(i)))return e.zIndex=i,!1})},loadScript:function(e,t,n,i){var a,o,r={dataType:"script",cache:!0},s={},l={};return(n=n||{}).tryRequire&&this.hasRequire?require(e,t,n.error):(a=function(){var e,a,o;$.each(l,function(e,t){if("success"!==t&&"notmodified"!==t)return o=!0,!1}),o?n.error&&$.isFunction(n.error)&&n.error({loadResults:l}):$.isFunction(t)&&(i&&void 0===i.obj[i.name]?(e=i.timeout?i.timeout/10:1,a=setInterval(function(){(--e<0||void 0!==i.obj[i.name])&&(clearInterval(a),t())},10)):t())},"tag"===n.loadType?($("head > script").each(function(){s[this.src]=this}),o=e.length,$.each(e,function(e,t){var i,r=!1;s[t]?(l[e]=s[t]._error||"success",--o<1&&a()):((i=document.createElement("script")).charset=n.charset||"UTF-8",$("head").append(i),i.onload=i.onreadystatechange=function(){r||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(r=!0,l[e]="success",--o<1&&a())},i.onerror=function(t){l[e]=i._error=t&&t.type?t.type:"error",--o<1&&a()},i.src=t)})):(n=$.isPlainObject(n)?Object.assign(r,n):r,o=0,function t(i,r){void 0!==i&&(l[o++]=r),e.length?$.ajax(Object.assign({},n,{url:e.shift(),success:t,error:t})):a()}())),this},loadCss:function(e,t){var n,i,a=this;return"string"==typeof e&&(e=[e]),t&&(t.className&&(n=t.className),t.dfd&&t.dfd.promise&&(i=[])),$.each(e,function(e,t){var o;t=a.convAbsUrl(t).replace(/^https?:/i,""),i&&(i[e]=$.Deferred()),$('head > link[href="'+a.escape(t)+'"]').length?i&&i[e].resolve():((o=document.createElement("link")).type="text/css",o.rel="stylesheet",o.href=t,n&&(o.className=n),i&&(o.onload=function(){i[e].resolve()},o.onerror=function(){i[e].reject()}),$("head").append(o))}),i&&$.when.apply(null,i).done(function(){t.dfd.resolve()}).fail(function(){t.dfd.reject()}),this},asyncJob:function(e,t,n){var i,a,o=$.Deferred(),r=!1,s=Object.assign({interval:0,numPerOnce:1},n||{}),l=[],c=[],d=[];return o._abort=function(e){a&&clearTimeout(a),c=[],r=!0,"pending"===o.state()&&o[e?"resolve":"reject"](l)},o.fail(function(){o._abort()}).always(function(){o._abort=function(){}}),"function"==typeof e&&Array.isArray(t)?(c=t.concat(),i=function(){var t,n,p;if(!r){for(d=c.splice(0,s.numPerOnce),n=d.length,t=0;t<n&&!r;t++)null!==(p=e(d[t]))&&l.push(p);r||(c.length?a=setTimeout(i,s.interval):o.resolve(l))}},c.length?a=setTimeout(i,0):o.resolve(l)):o.reject(),o},getSize:function(e){var t=this,n=[],i=e.length,a=$.Deferred().fail(function(){$.each(n,function(e,t){t&&(t.syncOnFail&&t.syncOnFail(!1),t.reject())})});return t.autoSync("stop"),function(){var e=$.Deferred(),n=Object.keys(t.leafRoots).length;n>0?$.each(t.leafRoots,function(i){(function(e){var n=$.Deferred(),i=t.file(e),a=i?i.phash:e;a&&!t.file(a)?t.request({data:{cmd:"parents",target:a},preventFail:!0}).done(function(){t.one("parentsdone",function(){n.resolve()})}).fail(function(){n.resolve()}):n.resolve();return n})(i).done(function(){--n<1&&e.resolve()})}):e.resolve();return e}().done(function(){var o=[],r={},s=[],l=[],c={};$.each(e,function(){o.push.apply(o,function(e){var n=[];"directory"===e.mime&&$.each(t.leafRoots,function(i,a){var o;if(i===e.hash)n.push.apply(n,a);else for(o=(t.file(i)||{}).phash;o;)o===e.hash&&n.push.apply(n,a),o=(t.file(o)||{}).phash});return n}(t.file(this)))}),e.push.apply(e,o),$.each(e,function(){var e=t.root(this),n=t.file(this);n&&(n.sizeInfo||"directory"!==n.mime)?l.push($.Deferred().resolve(n.sizeInfo?n.sizeInfo:{size:n.size,dirCnt:0,fileCnt:1})):r[e]?r[e].push(this.toString()):r[e]=[this.toString()]}),$.each(r,function(){var e=s.length;1===this.length&&(c[e]=this[0]),s.push(t.request({data:{cmd:"size",targets:this},preventDefault:!0}))}),n.push.apply(n,s),s.push.apply(s,l),$.when.apply($,s).fail(function(){a.reject()}).done(function(){var e,n,o=function(e,n){var i;(i=t.file(e))&&(i.sizeInfo={isCache:!0},$.each(["size","dirCnt","fileCnt"],function(){i.sizeInfo[this]=n[this]||0}),i.size=parseInt(i.sizeInfo.size),h.push(i))},r=0,s=0,l=0,d=arguments.length,p=[],u="",h=[];for(e=0;e<d;e++)n=arguments[e],null,n.isCache||(c[e]&&t.file(c[e])?o(c[e],n):n.sizes&&$.isPlainObject(n.sizes)&&$.each(n.sizes,function(e,t){o(e,t)})),r+=parseInt(n.size),!1!==s&&(void 0===n.fileCnt?s=!1:s+=parseInt(n.fileCnt||0)),!1!==l&&(void 0===n.dirCnt?l=!1:l+=parseInt(n.dirCnt||0));h.length&&t.change({changed:h}),!1!==l&&p.push(t.i18n("folders")+": "+(l-(i>1?0:1))),!1!==s&&p.push(t.i18n("files")+": "+s),p.length&&(u="<br>"+p.join(", ")),a.resolve({size:r,fileCnt:s,dirCnt:l,formated:(r>=0?t.formatSize(r):t.i18n("unknown"))+u})}),t.autoSync()}),a},wkObjUrl:null,getWorker:function(e){var t;try{this.wkObjUrl||(this.wkObjUrl=(window.URL||window.webkitURL).createObjectURL(new Blob([function(){self.onmessage=function(e){var t=e.data;try{if(self.data=t.data,t.scripts)for(var n=0;n<t.scripts.length;n++)importScripts(t.scripts[n]);self.postMessage(self.res)}catch(e){self.postMessage({error:e.toString()})}}}.toString().replace(/\s+/g," ").replace(/ *([^\w]) */g,"$1").replace(/^function\b.+?\{|\}$/g,"")],{type:"text/javascript"}))),t=new Worker(this.wkObjUrl,e)}catch(e){this.debug("error",e.toString())}return t},getWorkerUrl:function(e){return this.convAbsUrl(this.baseUrl+"js/worker/"+e)},getTheme:function(e){var t,n,i=this,a=$.Deferred(),o=function(e,t){return t||(t=i.convAbsUrl(i.baseUrl)),Array.isArray(e)?$.map(e,function(e){return o(e,t)}):e.match(/^(?:http|\/\/)/i)?e:t+e.replace(/^(?:\.\/|\/)/,"")};return e&&(t=i.options.themes[e])?"string"==typeof t?(url=o(t),(n=url.match(/^(.+\/)[^/]+\.json$/i))?$.getJSON(url).done(function(i){(t=i).id=e,t.cssurls&&(t.cssurls=o(t.cssurls,n[1])),a.resolve(t)}).fail(function(){a.reject()}):a.resolve({id:e,name:e,cssurls:[url]})):$.isPlainObject(t)&&t.cssurls?(t.id=e,t.cssurls=o(t.cssurls),Array.isArray(t.cssurls)||(t.cssurls=[t.cssurls]),t.name||(t.name=e),a.resolve(t)):a.reject():a.reject(),a},changeTheme:function(e){var t=this;return e&&(!t.options.themes[e]||t.theme&&t.theme.id===e?"default"===e&&t.theme&&"default"!==t.theme.id&&($("head>link.elfinder-theme-ext").remove(),t.theme=null,t.trigger&&t.trigger("themechange")):t.getTheme(e).done(function(e){e.cssurls&&($("head>link.elfinder-theme-ext").remove(),t.loadCss(e.cssurls,{className:"elfinder-theme-ext",dfd:$.Deferred().done(function(){t.theme=e,t.trigger&&t.trigger("themechange")})}))})),this},applyLeafRootStats:function(e,t){var n=this,i=t?e:n.file(e.hash)||e,a=i.ts,o=!1;return!t&&e._realStats||(e._realStats={locked:e.locked||0,dirs:e.dirs||0,ts:e.ts}),e.locked=1,i.locked||(o=!0),e.dirs=1,i.dirs||(o=!0),$.each(n.leafRoots[e.hash],function(){var t=n.file(this);t&&t.ts&&(e.ts||0)<t.ts&&(e.ts=t.ts)}),a!==e.ts&&(o=!0),o},abortXHR:function(e,t){var n=t||{};e&&(n.quiet&&(e.quiet=!0),n.abort&&e._requestId&&this.request({data:{cmd:"abort",id:e._requestId},preventDefault:!0}),e=void 0)},setCustomHeaderByXhr:function(e){var t=this;e.getResponseHeader&&t.parrotHeaders&&t.parrotHeaders.length&&$.each(t.parrotHeaders,function(n,i){var a=e.getResponseHeader(i);a?(t.customHeaders[i]=a,t.sessionStorage("core-ph:"+i,a)):"string"==typeof a&&(delete t.customHeaders[i],t.sessionStorage("core-ph:"+i,null))})},hasParrotHeaders:function(){var e=!1,t=this.parrotHeaders;if(Object.keys(this.customHeaders).length)for(var n=0;n<t.length;n++)if(this.customHeaders[t[n]]){e=!0;break}return e},getRequestId:function(){return(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16)},arrayFlip:function(e,t){var n,i={},a=$.isArray(e);for(n in e)(a||e.hasOwnProperty(n))&&(i[e[n]]=t||n);return i},splitFileExtention:function(e){var t;return(t=e.match(/^(.+?)?\.((?:tar\.(?:gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(?:gz|bz2)|[a-z0-9]{1,10})$/i))?(void 0===t[1]&&(t[1]=""),[t[1],t[2]]):[e,""]},sliceArrayBuffer:function(e,t){for(var n=[],i=0;i*t<e.byteLength;)n.push(e.slice(i*t,(i+1)*t)),i++;return n},arrayBufferToBase64:function(e){if(!window.btoa)return"";var t=new Uint8Array(e),n=Array.prototype.slice.call(t),i=n.map(function(e){return String.fromCharCode(e)});return window.btoa(i.join(""))},log:function(e){return window.console&&window.console.log&&window.console.log(e),this},debug:function(e,t){var n,i,a=this,o=this.options.debug,r=this.options.toastBackendWarn;return"backend-error"===e?(!this.cwd().hash||o&&("all"===o||o["backend-error"]))&&(t=Array.isArray(t)?t:[t],this.error(t)):"backend-warning"===e?(i=!0,r&&(n=$.isPlainObject(r)?r:{},$.each(Array.isArray(t)?t:[t],function(e,t){a.toast(Object.assign({mode:"warning",msg:t},n))}))):"backend-debug"===e&&this.trigger("backenddebug",t),(i||o&&("all"===o||o[e]))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+e+"] ["+this.id+"]",t),this},responseDebug:function(e){var t,n=e.debug;n&&((t=this.options.debug)&&"all"===t||(t||(t=this.options.debug={}),t["backend-error"]=!0,t.warning=!0),n.mountErrors&&("string"==typeof n.mountErrors||Array.isArray(n.mountErrors)&&n.mountErrors.length)&&this.debug("backend-error",n.mountErrors),n.backendErrors&&("string"==typeof n.backendErrors||Array.isArray(n.backendErrors)&&n.backendErrors.length)&&this.debug("backend-warning",n.backendErrors))},time:function(e){window.console&&window.console.time&&window.console.time(e)},timeEnd:function(e){window.console&&window.console.timeEnd&&window.console.timeEnd(e)}},Object.keys||(Object.keys=(c=Object.prototype.hasOwnProperty,d=!{toString:null}.propertyIsEnumerable("toString"),u=(p=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)c.call(e,n)&&t.push(n);if(d)for(var i=0;i<u;i++)c.call(e,p[i])&&t.push(p[i]);return t})),Array.isArray||(Array.isArray=function(e){return jQuery.isArray(e)}),Object.assign||(Object.assign=function(){return jQuery.extend.apply(null,arguments)}),String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";if(null==this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var n="",i=0;i<e;i++)n+=t;return n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){try{return void Array.apply(null,{})}catch(e){}var e=Object.prototype.toString,t=Function.prototype.apply,n=Array.prototype.slice;Function.prototype.apply=function(i,a){return t.call(this,i,"[object Array]"===e.call(a)?a:n.call(a))}}(),Array.from||(Array.from=function(e){return 1===e.length?[e[0]]:Array.apply(null,e)}),window.cancelAnimationFrame||function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),a=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+a)},a);return e=i+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),h}),e("skylark-elfinder/version",["./elFinder"],function(e){return e.prototype.version="2.1.55",e}),e("skylark-elfinder/jquery.elfinder",["skylark-jquery"],function(e){!function(){if(e.ui&&e.ui.ddmanager){var t=e.ui.ddmanager.prepareOffsets;e.ui.ddmanager.prepareOffsets=function(n,i){var a=function(e){if(e.is(":hidden"))return!0;var t=e[0].getBoundingClientRect();return!document.elementFromPoint(t.left,t.top)&&!document.elementFromPoint(t.left+t.width,t.top+t.height)};if("mousedown"===i.type||n.options.elfRefresh){var o,r,s=e.ui.ddmanager.droppables[n.options.scope]||[],l=s.length;for(o=0;o<l;o++)(r=s[o]).options.autoDisable&&(!r.options.disabled||r.options.autoDisable>1)&&(r.options.disabled=a(r.element),r.options.autoDisable=r.options.disabled?2:1)}return t(n,i)}}}(),function(e,t){"use strict";e.ajaxTransport("+binary",function(e,t,n){var i;if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,n){var a,o=e.responseType||"blob",r=e.xhr();if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)r[a]=e.xhrFields[a];for(a in e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)r.setRequestHeader(a,t[a]);i=function(t){return function(){if(i)if(i=r.onload=r.onerror=r.onabort=r.ontimeout=null,"abort"===t)r.abort();else if("error"===t)n(r.status,r.statusText);else{var a={};a[e.dataType]=r.response,n(r.status,r.statusText,a,r.getAllResponseHeaders())}}},r.onload=i(),r.onabort=r.onerror=r.ontimeout=i("error"),i=i("abort");try{r.responseType=o,r.send(e.data||null)}catch(e){if(i)throw e}},abort:function(){i&&i()}}})}(e),function(e){if(e.support.touch="ontouchend"in document,e.support.touch){var t,n,i,a=e.ui.mouse.prototype,o=a._mouseInit,r=a._mouseDestroy;a._touchStart=function(e){!t&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(n=e.originalEvent.changedTouches[0].screenX.toFixed(0),i=e.originalEvent.changedTouches[0].screenY.toFixed(0),t=!0,this._touchMoved=!1,s(e,"mouseover"),s(e,"mousemove"),s(e,"mousedown"))},a._touchMove=function(e){if(t){var a=e.originalEvent.changedTouches[0].screenX.toFixed(0),o=e.originalEvent.changedTouches[0].screenY.toFixed(0);Math.abs(n-a)<=4&&Math.abs(i-o)<=4||(this._touchMoved=!0,s(e,"mousemove"))}},a._touchEnd=function(e){t&&(s(e,"mouseup"),s(e,"mouseout"),this._touchMoved||s(e,"click"),t=!1,this._touchMoved=!1)},a._mouseInit=function(){this.element.hasClass("touch-punch")&&this.element.on({touchstart:e.proxy(this,"_touchStart"),touchmove:e.proxy(this,"_touchMove"),touchend:e.proxy(this,"_touchEnd")}),o.call(this)},a._mouseDestroy=function(){this.element.hasClass("touch-punch")&&this.element.off({touchstart:e.proxy(this,"_touchStart"),touchmove:e.proxy(this,"_touchMove"),touchend:e.proxy(this,"_touchEnd")}),r.call(this)}}function s(t,n){if(!(t.originalEvent.touches.length>1)){e(t.currentTarget).hasClass("touch-punch-keep-default")||t.preventDefault();var i=t.originalEvent.changedTouches[0],a=document.createEvent("MouseEvents");a.initMouseEvent(n,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(a)}}}(e),e.fn.elfinder=function(t,n){return"instance"===t?this.getElFinder():this.each(function(){var i,a="string"==typeof t?t:"",o="function"==typeof n?n:void 0,r=this.elfinder;if(r)switch(a){case"close":case"hide":r.hide();break;case"open":case"show":r.show();break;case"destroy":r.destroy();break;case"reload":case"restart":r&&(i=e.extend(!0,r.options,e.isPlainObject(n)?n:{}),o=r.bootCallback,r.reloadCallback&&e.isFunction(r.reloadCallback)?r.reloadCallback(i,o):(r.destroy(),new elFinder(this,i,o)))}else e.isPlainObject(t)&&new elFinder(this,t,o)})},e.fn.getElFinder=function(){var e;return this.each(function(){if(this.elfinder)return e=this.elfinder,!1}),e},e.fn.elfUiWidgetInstance=function(e){try{return this[e]("instance")}catch(n){var t=this.data("ui-"+e);return t&&"object"==typeof t&&t.widgetFullName==="ui-"+e?t:null}},e.fn.scrollRight||e.fn.extend({scrollRight:function(e){var t=this.get(0);return void 0===e?Math.max(0,t.scrollWidth-(t.scrollLeft+t.clientWidth)):this.scrollLeft(t.scrollWidth-t.clientWidth-e)}}),e.fn.scrollBottom||e.fn.extend({scrollBottom:function(e){var t=this.get(0);return void 0===e?Math.max(0,t.scrollHeight-(t.scrollTop+t.clientHeight)):this.scrollTop(t.scrollHeight-t.clientHeight-e)}})}),e("skylark-elfinder/mimetypes",["./elFinder"],function(e){return e.prototype.mimeTypes={"application/x-executable":"exe","application/x-jar":"jar","application/x-gzip":"gz","application/x-bzip2":"tbz","application/x-rar":"rar","text/x-php":"php","text/javascript":"js","application/rtfd":"rtfd","text/x-python":"py","text/x-ruby":"rb","text/x-shellscript":"sh","text/x-perl":"pl","text/xml":"xml","text/x-csrc":"c","text/x-chdr":"h","text/x-c++src":"cpp","text/x-c++hdr":"hh","text/x-markdown":"md","text/x-yaml":"yml","image/x-ms-bmp":"bmp","image/x-targa":"tga","image/xbm":"xbm","image/pxm":"pxm","audio/wav":"wav","video/x-dv":"dv","video/x-ms-wmv":"wm","video/ogg":"ogm","video/MP2T":"m2ts","application/x-mpegURL":"m3u8","application/dash+xml":"mpd","application/andrew-inset":"ez","application/applixware":"aw","application/atom+xml":"atom","application/atomcat+xml":"atomcat","application/atomsvc+xml":"atomsvc","application/ccxml+xml":"ccxml","application/cdmi-capability":"cdmia","application/cdmi-container":"cdmic","application/cdmi-domain":"cdmid","application/cdmi-object":"cdmio","application/cdmi-queue":"cdmiq","application/cu-seeme":"cu","application/davmount+xml":"davmount","application/docbook+xml":"dbk","application/dssc+der":"dssc","application/dssc+xml":"xdssc","application/ecmascript":"ecma","application/emma+xml":"emma","application/epub+zip":"epub","application/exi":"exi","application/font-tdpfr":"pfr","application/gml+xml":"gml","application/gpx+xml":"gpx","application/gxf":"gxf","application/hyperstudio":"stk","application/inkml+xml":"ink","application/ipfix":"ipfix","application/java-serialized-object":"ser","application/java-vm":"class","application/json":"json","application/jsonml+json":"jsonml","application/lost+xml":"lostxml","application/mac-binhex40":"hqx","application/mac-compactpro":"cpt","application/mads+xml":"mads","application/marc":"mrc","application/marcxml+xml":"mrcx","application/mathematica":"ma","application/mathml+xml":"mathml","application/mbox":"mbox","application/mediaservercontrol+xml":"mscml","application/metalink+xml":"metalink","application/metalink4+xml":"meta4","application/mets+xml":"mets","application/mods+xml":"mods","application/mp21":"m21","application/mp4":"mp4s","application/msword":"doc","application/mxf":"mxf","application/octet-stream":"bin","application/oda":"oda","application/oebps-package+xml":"opf","application/ogg":"ogx","application/omdoc+xml":"omdoc","application/onenote":"onetoc","application/oxps":"oxps","application/patch-ops-error+xml":"xer","application/pdf":"pdf","application/pgp-encrypted":"pgp","application/pgp-signature":"asc","application/pics-rules":"prf","application/pkcs10":"p10","application/pkcs7-mime":"p7m","application/pkcs7-signature":"p7s","application/pkcs8":"p8","application/pkix-attr-cert":"ac","application/pkix-cert":"cer","application/pkix-crl":"crl","application/pkix-pkipath":"pkipath","application/pkixcmp":"pki","application/pls+xml":"pls","application/postscript":"ai","application/prs.cww":"cww","application/pskc+xml":"pskcxml","application/rdf+xml":"rdf","application/reginfo+xml":"rif","application/relax-ng-compact-syntax":"rnc","application/resource-lists+xml":"rl","application/resource-lists-diff+xml":"rld","application/rls-services+xml":"rs","application/rpki-ghostbusters":"gbr","application/rpki-manifest":"mft","application/rpki-roa":"roa","application/rsd+xml":"rsd","application/rss+xml":"rss","application/rtf":"rtf","application/sbml+xml":"sbml","application/scvp-cv-request":"scq","application/scvp-cv-response":"scs","application/scvp-vp-request":"spq","application/scvp-vp-response":"spp","application/sdp":"sdp","application/set-payment-initiation":"setpay","application/set-registration-initiation":"setreg","application/shf+xml":"shf","application/smil+xml":"smi","application/sparql-query":"rq","application/sparql-results+xml":"srx","application/srgs":"gram","application/srgs+xml":"grxml","application/sru+xml":"sru","application/ssdl+xml":"ssdl","application/ssml+xml":"ssml","application/tei+xml":"tei","application/thraud+xml":"tfi","application/timestamped-data":"tsd","application/vnd.3gpp.pic-bw-large":"plb","application/vnd.3gpp.pic-bw-small":"psb","application/vnd.3gpp.pic-bw-var":"pvb","application/vnd.3gpp2.tcap":"tcap","application/vnd.3m.post-it-notes":"pwn","application/vnd.accpac.simply.aso":"aso","application/vnd.accpac.simply.imp":"imp","application/vnd.acucobol":"acu","application/vnd.acucorp":"atc","application/vnd.adobe.air-application-installer-package+zip":"air","application/vnd.adobe.formscentral.fcdt":"fcdt","application/vnd.adobe.fxp":"fxp","application/vnd.adobe.xdp+xml":"xdp","application/vnd.adobe.xfdf":"xfdf","application/vnd.ahead.space":"ahead","application/vnd.airzip.filesecure.azf":"azf","application/vnd.airzip.filesecure.azs":"azs","application/vnd.amazon.ebook":"azw","application/vnd.americandynamics.acc":"acc","application/vnd.amiga.ami":"ami","application/vnd.android.package-archive":"apk","application/vnd.anser-web-certificate-issue-initiation":"cii","application/vnd.anser-web-funds-transfer-initiation":"fti","application/vnd.antix.game-component":"atx","application/vnd.apple.installer+xml":"mpkg","application/vnd.aristanetworks.swi":"swi","application/vnd.astraea-software.iota":"iota","application/vnd.audiograph":"aep","application/vnd.blueice.multipass":"mpm","application/vnd.bmi":"bmi","application/vnd.businessobjects":"rep","application/vnd.chemdraw+xml":"cdxml","application/vnd.chipnuts.karaoke-mmd":"mmd","application/vnd.cinderella":"cdy","application/vnd.claymore":"cla","application/vnd.cloanto.rp9":"rp9","application/vnd.clonk.c4group":"c4g","application/vnd.cluetrust.cartomobile-config":"c11amc","application/vnd.cluetrust.cartomobile-config-pkg":"c11amz","application/vnd.commonspace":"csp","application/vnd.contact.cmsg":"cdbcmsg","application/vnd.cosmocaller":"cmc","application/vnd.crick.clicker":"clkx","application/vnd.crick.clicker.keyboard":"clkk","application/vnd.crick.clicker.palette":"clkp","application/vnd.crick.clicker.template":"clkt","application/vnd.crick.clicker.wordbank":"clkw","application/vnd.criticaltools.wbs+xml":"wbs","application/vnd.ctc-posml":"pml","application/vnd.cups-ppd":"ppd","application/vnd.curl.car":"car","application/vnd.curl.pcurl":"pcurl","application/vnd.dart":"dart","application/vnd.data-vision.rdz":"rdz","application/vnd.dece.data":"uvf","application/vnd.dece.ttml+xml":"uvt","application/vnd.dece.unspecified":"uvx","application/vnd.dece.zip":"uvz","application/vnd.denovo.fcselayout-link":"fe_launch","application/vnd.dna":"dna","application/vnd.dolby.mlp":"mlp","application/vnd.dpgraph":"dpg","application/vnd.dreamfactory":"dfac","application/vnd.ds-keypoint":"kpxx","application/vnd.dvb.ait":"ait","application/vnd.dvb.service":"svc","application/vnd.dynageo":"geo","application/vnd.ecowin.chart":"mag","application/vnd.enliven":"nml","application/vnd.epson.esf":"esf","application/vnd.epson.msf":"msf","application/vnd.epson.quickanime":"qam","application/vnd.epson.salt":"slt","application/vnd.epson.ssf":"ssf","application/vnd.eszigno3+xml":"es3","application/vnd.ezpix-album":"ez2","application/vnd.ezpix-package":"ez3","application/vnd.fdf":"fdf","application/vnd.fdsn.mseed":"mseed","application/vnd.fdsn.seed":"seed","application/vnd.flographit":"gph","application/vnd.fluxtime.clip":"ftc","application/vnd.framemaker":"fm","application/vnd.frogans.fnc":"fnc","application/vnd.frogans.ltf":"ltf","application/vnd.fsc.weblaunch":"fsc","application/vnd.fujitsu.oasys":"oas","application/vnd.fujitsu.oasys2":"oa2","application/vnd.fujitsu.oasys3":"oa3","application/vnd.fujitsu.oasysgp":"fg5","application/vnd.fujitsu.oasysprs":"bh2","application/vnd.fujixerox.ddd":"ddd","application/vnd.fujixerox.docuworks":"xdw","application/vnd.fujixerox.docuworks.binder":"xbd","application/vnd.fuzzysheet":"fzs","application/vnd.genomatix.tuxedo":"txd","application/vnd.geogebra.file":"ggb","application/vnd.geogebra.tool":"ggt","application/vnd.geometry-explorer":"gex","application/vnd.geonext":"gxt","application/vnd.geoplan":"g2w","application/vnd.geospace":"g3w","application/vnd.gmx":"gmx","application/vnd.google-earth.kml+xml":"kml","application/vnd.google-earth.kmz":"kmz","application/vnd.grafeq":"gqf","application/vnd.groove-account":"gac","application/vnd.groove-help":"ghf","application/vnd.groove-identity-message":"gim","application/vnd.groove-injector":"grv","application/vnd.groove-tool-message":"gtm","application/vnd.groove-tool-template":"tpl","application/vnd.groove-vcard":"vcg","application/vnd.hal+xml":"hal","application/vnd.handheld-entertainment+xml":"zmm","application/vnd.hbci":"hbci","application/vnd.hhe.lesson-player":"les","application/vnd.hp-hpgl":"hpgl","application/vnd.hp-hpid":"hpid","application/vnd.hp-hps":"hps","application/vnd.hp-jlyt":"jlt","application/vnd.hp-pcl":"pcl","application/vnd.hp-pclxl":"pclxl","application/vnd.hydrostatix.sof-data":"sfd-hdstx","application/vnd.ibm.minipay":"mpy","application/vnd.ibm.modcap":"afp","application/vnd.ibm.rights-management":"irm","application/vnd.ibm.secure-container":"sc","application/vnd.iccprofile":"icc","application/vnd.igloader":"igl","application/vnd.immervision-ivp":"ivp","application/vnd.immervision-ivu":"ivu","application/vnd.insors.igm":"igm","application/vnd.intercon.formnet":"xpw","application/vnd.intergeo":"i2g","application/vnd.intu.qbo":"qbo","application/vnd.intu.qfx":"qfx","application/vnd.ipunplugged.rcprofile":"rcprofile","application/vnd.irepository.package+xml":"irp","application/vnd.is-xpr":"xpr","application/vnd.isac.fcs":"fcs","application/vnd.jam":"jam","application/vnd.jcp.javame.midlet-rms":"rms","application/vnd.jisp":"jisp","application/vnd.joost.joda-archive":"joda","application/vnd.kahootz":"ktz","application/vnd.kde.karbon":"karbon","application/vnd.kde.kchart":"chrt","application/vnd.kde.kformula":"kfo","application/vnd.kde.kivio":"flw","application/vnd.kde.kontour":"kon","application/vnd.kde.kpresenter":"kpr","application/vnd.kde.kspread":"ksp","application/vnd.kde.kword":"kwd","application/vnd.kenameaapp":"htke","application/vnd.kidspiration":"kia","application/vnd.kinar":"kne","application/vnd.koan":"skp","application/vnd.kodak-descriptor":"sse","application/vnd.las.las+xml":"lasxml","application/vnd.llamagraphics.life-balance.desktop":"lbd","application/vnd.llamagraphics.life-balance.exchange+xml":"lbe","application/vnd.lotus-1-2-3":123,"application/vnd.lotus-approach":"apr","application/vnd.lotus-freelance":"pre","application/vnd.lotus-notes":"nsf","application/vnd.lotus-organizer":"org","application/vnd.lotus-screencam":"scm","application/vnd.lotus-wordpro":"lwp","application/vnd.macports.portpkg":"portpkg","application/vnd.mcd":"mcd","application/vnd.medcalcdata":"mc1","application/vnd.mediastation.cdkey":"cdkey","application/vnd.mfer":"mwf","application/vnd.mfmp":"mfm","application/vnd.micrografx.flo":"flo","application/vnd.micrografx.igx":"igx","application/vnd.mif":"mif","application/vnd.mobius.daf":"daf","application/vnd.mobius.dis":"dis","application/vnd.mobius.mbk":"mbk","application/vnd.mobius.mqy":"mqy","application/vnd.mobius.msl":"msl","application/vnd.mobius.plc":"plc","application/vnd.mobius.txf":"txf","application/vnd.mophun.application":"mpn","application/vnd.mophun.certificate":"mpc","application/vnd.mozilla.xul+xml":"xul","application/vnd.ms-artgalry":"cil","application/vnd.ms-cab-compressed":"cab","application/vnd.ms-excel":"xls","application/vnd.ms-excel.addin.macroenabled.12":"xlam","application/vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","application/vnd.ms-excel.sheet.macroenabled.12":"xlsm","application/vnd.ms-excel.template.macroenabled.12":"xltm","application/vnd.ms-fontobject":"eot","application/vnd.ms-htmlhelp":"chm","application/vnd.ms-ims":"ims","application/vnd.ms-lrm":"lrm","application/vnd.ms-officetheme":"thmx","application/vnd.ms-pki.seccat":"cat","application/vnd.ms-pki.stl":"stl","application/vnd.ms-powerpoint":"ppt","application/vnd.ms-powerpoint.addin.macroenabled.12":"ppam","application/vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","application/vnd.ms-powerpoint.slide.macroenabled.12":"sldm","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","application/vnd.ms-powerpoint.template.macroenabled.12":"potm","application/vnd.ms-project":"mpp","application/vnd.ms-word.document.macroenabled.12":"docm","application/vnd.ms-word.template.macroenabled.12":"dotm","application/vnd.ms-works":"wps","application/vnd.ms-wpl":"wpl","application/vnd.ms-xpsdocument":"xps","application/vnd.mseq":"mseq","application/vnd.musician":"mus","application/vnd.muvee.style":"msty","application/vnd.mynfc":"taglet","application/vnd.neurolanguage.nlu":"nlu","application/vnd.nitf":"ntf","application/vnd.noblenet-directory":"nnd","application/vnd.noblenet-sealer":"nns","application/vnd.noblenet-web":"nnw","application/vnd.nokia.n-gage.data":"ngdat","application/vnd.nokia.n-gage.symbian.install":"n-gage","application/vnd.nokia.radio-preset":"rpst","application/vnd.nokia.radio-presets":"rpss","application/vnd.novadigm.edm":"edm","application/vnd.novadigm.edx":"edx","application/vnd.novadigm.ext":"ext","application/vnd.oasis.opendocument.chart":"odc","application/vnd.oasis.opendocument.chart-template":"otc","application/vnd.oasis.opendocument.database":"odb","application/vnd.oasis.opendocument.formula":"odf","application/vnd.oasis.opendocument.formula-template":"odft","application/vnd.oasis.opendocument.graphics":"odg","application/vnd.oasis.opendocument.graphics-template":"otg","application/vnd.oasis.opendocument.image":"odi","application/vnd.oasis.opendocument.image-template":"oti","application/vnd.oasis.opendocument.presentation":"odp","application/vnd.oasis.opendocument.presentation-template":"otp","application/vnd.oasis.opendocument.spreadsheet":"ods","application/vnd.oasis.opendocument.spreadsheet-template":"ots","application/vnd.oasis.opendocument.text":"odt","application/vnd.oasis.opendocument.text-master":"odm","application/vnd.oasis.opendocument.text-template":"ott","application/vnd.oasis.opendocument.text-web":"oth","application/vnd.olpc-sugar":"xo","application/vnd.oma.dd2+xml":"dd2","application/vnd.openofficeorg.extension":"oxt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.presentationml.slide":"sldx","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","application/vnd.openxmlformats-officedocument.presentationml.template":"potx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","application/vnd.osgeo.mapguide.package":"mgp","application/vnd.osgi.dp":"dp","application/vnd.osgi.subsystem":"esa","application/vnd.palm":"pdb","application/vnd.pawaafile":"paw","application/vnd.pg.format":"str","application/vnd.pg.osasli":"ei6","application/vnd.picsel":"efif","application/vnd.pmi.widget":"wg","application/vnd.pocketlearn":"plf","application/vnd.powerbuilder6":"pbd","application/vnd.previewsystems.box":"box","application/vnd.proteus.magazine":"mgz","application/vnd.publishare-delta-tree":"qps","application/vnd.pvi.ptid1":"ptid","application/vnd.quark.quarkxpress":"qxd","application/vnd.realvnc.bed":"bed","application/vnd.recordare.musicxml":"mxl","application/vnd.recordare.musicxml+xml":"musicxml","application/vnd.rig.cryptonote":"cryptonote","application/vnd.rim.cod":"cod","application/vnd.rn-realmedia":"rm","application/vnd.rn-realmedia-vbr":"rmvb","application/vnd.route66.link66+xml":"link66","application/vnd.sailingtracker.track":"st","application/vnd.seemail":"see","application/vnd.sema":"sema","application/vnd.semd":"semd","application/vnd.semf":"semf","application/vnd.shana.informed.formdata":"ifm","application/vnd.shana.informed.formtemplate":"itp","application/vnd.shana.informed.interchange":"iif","application/vnd.shana.informed.package":"ipk","application/vnd.simtech-mindmapper":"twd","application/vnd.smaf":"mmf","application/vnd.smart.teacher":"teacher","application/vnd.solent.sdkm+xml":"sdkm","application/vnd.spotfire.dxp":"dxp","application/vnd.spotfire.sfs":"sfs","application/vnd.stardivision.calc":"sdc","application/vnd.stardivision.draw":"sda","application/vnd.stardivision.impress":"sdd","application/vnd.stardivision.math":"smf","application/vnd.stardivision.writer":"sdw","application/vnd.stardivision.writer-global":"sgl","application/vnd.stepmania.package":"smzip","application/vnd.stepmania.stepchart":"sm","application/vnd.sun.xml.calc":"sxc","application/vnd.sun.xml.calc.template":"stc","application/vnd.sun.xml.draw":"sxd","application/vnd.sun.xml.draw.template":"std","application/vnd.sun.xml.impress":"sxi","application/vnd.sun.xml.impress.template":"sti","application/vnd.sun.xml.math":"sxm","application/vnd.sun.xml.writer":"sxw","application/vnd.sun.xml.writer.global":"sxg","application/vnd.sun.xml.writer.template":"stw","application/vnd.sus-calendar":"sus","application/vnd.svd":"svd","application/vnd.symbian.install":"sis","application/vnd.syncml+xml":"xsm","application/vnd.syncml.dm+wbxml":"bdm","application/vnd.syncml.dm+xml":"xdm","application/vnd.tao.intent-module-archive":"tao","application/vnd.tcpdump.pcap":"pcap","application/vnd.tmobile-livetv":"tmo","application/vnd.trid.tpt":"tpt","application/vnd.triscape.mxs":"mxs","application/vnd.trueapp":"tra","application/vnd.ufdl":"ufd","application/vnd.uiq.theme":"utz","application/vnd.umajin":"umj","application/vnd.unity":"unityweb","application/vnd.uoml+xml":"uoml","application/vnd.vcx":"vcx","application/vnd.visio":"vsd","application/vnd.visionary":"vis","application/vnd.vsf":"vsf","application/vnd.wap.wbxml":"wbxml","application/vnd.wap.wmlc":"wmlc","application/vnd.wap.wmlscriptc":"wmlsc","application/vnd.webturbo":"wtb","application/vnd.wolfram.player":"nbp","application/vnd.wordperfect":"wpd","application/vnd.wqd":"wqd","application/vnd.wt.stf":"stf","application/vnd.xara":"xar","application/vnd.xfdl":"xfdl","application/vnd.yamaha.hv-dic":"hvd","application/vnd.yamaha.hv-script":"hvs","application/vnd.yamaha.hv-voice":"hvp","application/vnd.yamaha.openscoreformat":"osf","application/vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","application/vnd.yamaha.smaf-audio":"saf","application/vnd.yamaha.smaf-phrase":"spf","application/vnd.yellowriver-custom-menu":"cmp","application/vnd.zul":"zir","application/vnd.zzazz.deck+xml":"zaz","application/voicexml+xml":"vxml","application/widget":"wgt","application/winhlp":"hlp","application/wsdl+xml":"wsdl","application/wspolicy+xml":"wspolicy","application/x-7z-compressed":"7z","application/x-abiword":"abw","application/x-ace-compressed":"ace","application/x-apple-diskimage":"dmg","application/x-authorware-bin":"aab","application/x-authorware-map":"aam","application/x-authorware-seg":"aas","application/x-bcpio":"bcpio","application/x-bittorrent":"torrent","application/x-blorb":"blb","application/x-bzip":"bz","application/x-cbr":"cbr","application/x-cdlink":"vcd","application/x-cfs-compressed":"cfs","application/x-chat":"chat","application/x-chess-pgn":"pgn","application/x-conference":"nsc","application/x-cpio":"cpio","application/x-csh":"csh","application/x-debian-package":"deb","application/x-dgc-compressed":"dgc","application/x-director":"dir","application/x-doom":"wad","application/x-dtbncx+xml":"ncx","application/x-dtbook+xml":"dtb","application/x-dtbresource+xml":"res","application/x-dvi":"dvi","application/x-envoy":"evy","application/x-eva":"eva","application/x-font-bdf":"bdf","application/x-font-ghostscript":"gsf","application/x-font-linux-psf":"psf","application/x-font-pcf":"pcf","application/x-font-snf":"snf","application/x-font-type1":"pfa","application/x-freearc":"arc","application/x-futuresplash":"spl","application/x-gca-compressed":"gca","application/x-glulx":"ulx","application/x-gnumeric":"gnumeric","application/x-gramps-xml":"gramps","application/x-gtar":"gtar","application/x-hdf":"hdf","application/x-install-instructions":"install","application/x-iso9660-image":"iso","application/x-java-jnlp-file":"jnlp","application/x-latex":"latex","application/x-lzh-compressed":"lzh","application/x-mie":"mie","application/x-mobipocket-ebook":"prc","application/x-ms-application":"application","application/x-ms-shortcut":"lnk","application/x-ms-wmd":"wmd","application/x-ms-wmz":"wmz","application/x-ms-xbap":"xbap","application/x-msaccess":"mdb","application/x-msbinder":"obd","application/x-mscardfile":"crd","application/x-msclip":"clp","application/x-msdownload":"dll","application/x-msmediaview":"mvb","application/x-msmetafile":"wmf","application/x-msmoney":"mny","application/x-mspublisher":"pub","application/x-msschedule":"scd","application/x-msterminal":"trm","application/x-mswrite":"wri","application/x-netcdf":"nc","application/x-nzb":"nzb","application/x-pkcs12":"p12","application/x-pkcs7-certificates":"p7b","application/x-pkcs7-certreqresp":"p7r","application/x-research-info-systems":"ris","application/x-shar":"shar","application/x-shockwave-flash":"swf","application/x-silverlight-app":"xap","application/x-sql":"sql","application/x-stuffit":"sit","application/x-stuffitx":"sitx","application/x-subrip":"srt","application/x-sv4cpio":"sv4cpio","application/x-sv4crc":"sv4crc","application/x-t3vm-image":"t3","application/x-tads":"gam","application/x-tar":"tar","application/x-tcl":"tcl","application/x-tex":"tex","application/x-tex-tfm":"tfm","application/x-texinfo":"texinfo","application/x-tgif":"obj","application/x-ustar":"ustar","application/x-wais-source":"src","application/x-x509-ca-cert":"der","application/x-xfig":"fig","application/x-xliff+xml":"xlf","application/x-xpinstall":"xpi","application/x-xz":"xz","application/x-zmachine":"z1","application/xaml+xml":"xaml","application/xcap-diff+xml":"xdf","application/xenc+xml":"xenc","application/xhtml+xml":"xhtml","application/xml":"xsl","application/xml-dtd":"dtd","application/xop+xml":"xop","application/xproc+xml":"xpl","application/xslt+xml":"xslt","application/xspf+xml":"xspf","application/xv+xml":"mxml","application/yang":"yang","application/yin+xml":"yin","application/zip":"zip","audio/adpcm":"adp","audio/basic":"au","audio/midi":"mid","audio/mp4":"m4a","audio/mpeg":"mpga","audio/ogg":"oga","audio/s3m":"s3m","audio/silk":"sil","audio/vnd.dece.audio":"uva","audio/vnd.digital-winds":"eol","audio/vnd.dra":"dra","audio/vnd.dts":"dts","audio/vnd.dts.hd":"dtshd","audio/vnd.lucent.voice":"lvp","audio/vnd.ms-playready.media.pya":"pya","audio/vnd.nuera.ecelp4800":"ecelp4800","audio/vnd.nuera.ecelp7470":"ecelp7470","audio/vnd.nuera.ecelp9600":"ecelp9600","audio/vnd.rip":"rip","audio/webm":"weba","audio/x-aac":"aac","audio/x-aiff":"aif","audio/x-caf":"caf","audio/x-flac":"flac","audio/x-matroska":"mka","audio/x-mpegurl":"m3u","audio/x-ms-wax":"wax","audio/x-ms-wma":"wma","audio/x-pn-realaudio":"ram","audio/x-pn-realaudio-plugin":"rmp","audio/xm":"xm","chemical/x-cdx":"cdx","chemical/x-cif":"cif","chemical/x-cmdf":"cmdf","chemical/x-cml":"cml","chemical/x-csml":"csml","chemical/x-xyz":"xyz","font/collection":"ttc","font/otf":"otf","font/ttf":"ttf","font/woff":"woff","font/woff2":"woff2","image/cgm":"cgm","image/g3fax":"g3","image/gif":"gif","image/ief":"ief","image/jpeg":"jpeg","image/ktx":"ktx","image/png":"png","image/prs.btif":"btif","image/sgi":"sgi","image/svg+xml":"svg","image/tiff":"tiff","image/vnd.adobe.photoshop":"psd","image/vnd.dece.graphic":"uvi","image/vnd.djvu":"djvu","image/vnd.dvb.subtitle":"sub","image/vnd.dwg":"dwg","image/vnd.dxf":"dxf","image/vnd.fastbidsheet":"fbs","image/vnd.fpx":"fpx","image/vnd.fst":"fst","image/vnd.fujixerox.edmics-mmr":"mmr","image/vnd.fujixerox.edmics-rlc":"rlc","image/vnd.ms-modi":"mdi","image/vnd.ms-photo":"wdp","image/vnd.net-fpx":"npx","image/vnd.wap.wbmp":"wbmp","image/vnd.xiff":"xif","image/webp":"webp","image/x-3ds":"3ds","image/x-cmu-raster":"ras","image/x-cmx":"cmx","image/x-freehand":"fh","image/x-icon":"ico","image/x-mrsid-image":"sid","image/x-pcx":"pcx","image/x-pict":"pic","image/x-portable-anymap":"pnm","image/x-portable-bitmap":"pbm","image/x-portable-graymap":"pgm","image/x-portable-pixmap":"ppm","image/x-rgb":"rgb","image/x-xpixmap":"xpm","image/x-xwindowdump":"xwd","message/rfc822":"eml","model/iges":"igs","model/mesh":"msh","model/vnd.collada+xml":"dae","model/vnd.dwf":"dwf","model/vnd.gdl":"gdl","model/vnd.gtw":"gtw","model/vnd.vtu":"vtu","model/vrml":"wrl","model/x3d+binary":"x3db","model/x3d+vrml":"x3dv","model/x3d+xml":"x3d","text/cache-manifest":"appcache","text/calendar":"ics","text/css":"css","text/csv":"csv","text/html":"html","text/n3":"n3","text/plain":"txt","text/prs.lines.tag":"dsc","text/richtext":"rtx","text/sgml":"sgml","text/tab-separated-values":"tsv","text/troff":"t","text/turtle":"ttl","text/uri-list":"uri","text/vcard":"vcard","text/vnd.curl":"curl","text/vnd.curl.dcurl":"dcurl","text/vnd.curl.mcurl":"mcurl","text/vnd.curl.scurl":"scurl","text/vnd.fly":"fly","text/vnd.fmi.flexstor":"flx","text/vnd.graphviz":"gv","text/vnd.in3d.3dml":"3dml","text/vnd.in3d.spot":"spot","text/vnd.sun.j2me.app-descriptor":"jad","text/vnd.wap.wml":"wml","text/vnd.wap.wmlscript":"wmls","text/x-asm":"s","text/x-c":"cc","text/x-fortran":"f","text/x-java-source":"java","text/x-nfo":"nfo","text/x-opml":"opml","text/x-pascal":"p","text/x-setext":"etx","text/x-sfv":"sfv","text/x-uuencode":"uu","text/x-vcalendar":"vcs","text/x-vcard":"vcf","video/3gpp":"3gp","video/3gpp2":"3g2","video/h261":"h261","video/h263":"h263","video/h264":"h264","video/jpeg":"jpgv","video/jpm":"jpm","video/mj2":"mj2","video/mp4":"mp4","video/mpeg":"mpeg","video/quicktime":"qt","video/vnd.dece.hd":"uvh","video/vnd.dece.mobile":"uvm","video/vnd.dece.pd":"uvp","video/vnd.dece.sd":"uvs","video/vnd.dece.video":"uvv","video/vnd.dvb.file":"dvb","video/vnd.fvt":"fvt","video/vnd.mpegurl":"mxu","video/vnd.ms-playready.media.pyv":"pyv","video/vnd.uvvu.mp4":"uvu","video/vnd.vivo":"viv","video/webm":"webm","video/x-f4v":"f4v","video/x-fli":"fli","video/x-flv":"flv","video/x-m4v":"m4v","video/x-matroska":"mkv","video/x-mng":"mng","video/x-ms-asf":"asf","video/x-ms-vob":"vob","video/x-ms-wmx":"wmx","video/x-ms-wvx":"wvx","video/x-msvideo":"avi","video/x-sgi-movie":"movie","video/x-smv":"smv","x-conference/x-cooltalk":"ice","text/x-sql":"sql","image/x-pixlr-data":"pxd","image/x-adobe-dng":"dng","image/x-sketch":"sketch","image/x-xcf":"xcf","audio/amr":"amr","image/vnd-ms.dds":"dds","application/plt":"plt","application/sat":"sat","application/step":"step","text/x-httpd-cgi":"cgi","text/x-asap":"asp","text/x-jsp":"jsp"},e}),e("skylark-elfinder/options",["./elFinder"],function(e){return e.prototype._options={cdns:{ace:"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8",codemirror:"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0",ckeditor:"https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.12.1",ckeditor5:"https://cdn.ckeditor.com/ckeditor5/17.0.0",tinymce:"https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.2.0",simplemde:"https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2",fabric:"https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2",fabric16:"https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7",tui:"https://uicdn.toast.com",hls:"https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.13.2/hls.min.js",dash:"https://cdnjs.cloudflare.com/ajax/libs/dashjs/3.0.2/dash.all.min.js",flv:"https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.5.0/flv.min.js",videojs:"https://cdnjs.cloudflare.com/ajax/libs/video.js/7.7.4",prettify:"https://cdn.jsdelivr.net/gh/google/code-prettify@f1c3473acd1e8ea8c8c1a60c56e89f5cdd06f915/loader/run_prettify.js",psd:"https://cdnjs.cloudflare.com/ajax/libs/psd.js/3.2.0/psd.min.js",rar:"https://cdn.jsdelivr.net/gh/nao-pon/rar.js@6cef13ec66dd67992fc7f3ea22f132d770ebaf8b/rar.min.js",zlibUnzip:"https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/unzip.min.js",zlibGunzip:"https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/gunzip.min.js",bzip2:"https://cdn.jsdelivr.net/gh/nao-pon/bzip2.js@0.8.0/bzip2.js",marked:"https://cdnjs.cloudflare.com/ajax/libs/marked/0.7.0/marked.min.js",sparkmd5:"https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.min.js",jssha:"https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js",amr:"https://cdn.jsdelivr.net/gh/yxl/opencore-amr-js@dcf3d2b5f384a1d9ded2a54e4c137a81747b222b/js/amrnb.js",tiff:"https://cdn.jsdelivr.net/gh/seikichi/tiff.js@545ede3ee46b5a5bc5f06d65954e775aa2a64017/tiff.min.js"},url:"",requestType:"get",cors:null,parrotHeaders:[],requestMaxConn:3,transport:{},urlUpload:"",dragUploadAllow:"auto",overwriteUploadConfirm:!0,uploadMaxChunkSize:10485760,folderUploadExclude:{win:/^(?:desktop\.ini|thumbs\.db)$/i,mac:/^\.ds_store$/i},iframeTimeout:0,customData:{},handlers:{},customHeaders:{},xhrFields:{},lang:"en",baseUrl:"",i18nBaseUrl:"",cssAutoLoad:!0,themes:{},theme:null,maxErrorDialogs:5,cssClass:"",commands:["*"],commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:"",onerror:"",getPath:!0,getImgSize:!1},open:{method:"post",into:"window",selectAction:"open"},opennew:{url:"",useOriginQuery:!0},upload:{ui:"button"},download:{maxRequests:10,minFilesZipdl:2},quicklook:{autoplay:!0,width:450,height:300,mediaControlsList:"",pdfToolbar:!0,textInitialLines:100,prettifyMaxLines:300,contain:!1,docked:0,dockHeight:"auto",dockAutoplay:!1,googleMapsApiKey:"",googleMapsOpts:{maps:{},kml:{suppressInfoWindows:!1,preserveViewport:!1}},viewerjs:{url:"",mimes:["application/pdf","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"],pdfNative:!0},sharecadMimes:[],googleDocsMimes:[],officeOnlineMimes:[],getDimThreshold:"200K",unzipMaxSize:"50M",mimeRegexNotEmptyCheck:/^application\/vnd\.google-apps\./},edit:{dialogWidth:void 0,dialogHeight:void 0,mimes:[],mkfileHideMimes:[],makeTextMimes:["text/plain","text/css","text/html"],useStoredEditor:!1,editorMaximized:!1,editors:[],encodings:["Big5","Big5-HKSCS","Cp437","Cp737","Cp775","Cp850","Cp852","Cp855","Cp857","Cp858","Cp862","Cp866","Cp874","EUC-CN","EUC-JP","EUC-KR","GB18030","ISO-2022-CN","ISO-2022-JP","ISO-2022-KR","ISO-8859-1","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-13","ISO-8859-15","KOI8-R","KOI8-U","Shift-JIS","Windows-1250","Windows-1251","Windows-1252","Windows-1253","Windows-1254","Windows-1257"],extraOptions:{uploadOpts:{},tuiImgEditOpts:{iconsPath:void 0,theme:{}},pixo:{apikey:""},managerUrl:null,ckeditor:{},ckeditor5:{mode:"decoupled-document"},tinymce:{},onlineConvert:{maxSize:100,showLink:!0}}},fullscreen:{mode:"screen"},search:{incsearch:{enable:!0,minlen:1,wait:500},searchTypes:{SearchMime:{name:"btnMime",title:"searchMime",incsearch:"mime"}}},info:{nullUrlDirLinkSelf:!0,hideItems:[],showHashMaxsize:104857600,showHashAlgorisms:["md5","sha256"],showHashOpts:{shake128len:256,shake256len:512},custom:{}},mkdir:{intoNewFolderToolbtn:!1},resize:{grid8px:"disable",presetSize:[[320,240],[400,400],[640,480],[800,600]],getDimThreshold:204800,dimSubImgSize:307200},rm:{quickTrash:!0,infoCheckWait:10,toTrashMaxItems:1e3},paste:{moveConfirm:!1},help:{view:["about","shortcuts","help","integrations","debug"],helpSource:""},preference:{width:600,height:400,categories:null,prefs:null,langs:null,selectActions:["open","edit/download","resize/edit/download","download","quicklook"]}},disabledCmdsRels:{get:["edit"],rm:["cut","empty"],"file&url=":["download","zipdl"]},bootCallback:null,getFileCallback:null,defaultView:"icons",startPathHash:"",sound:!0,ui:["toolbar","places","tree","path","stat"],uiOptions:{toolbar:[["home","back","forward","up","reload"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["undo","redo"],["copy","cut","paste","rm","empty","hide"],["duplicate","rename","edit","resize","chmod"],["selectall","selectnone","selectinvert"],["quicklook","info"],["extract","archive"],["search"],["view","sort"],["preference","help"],["fullscreen"]],toolbarExtra:{displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"],defaultHides:["home","reload"],showPreferenceButton:"none",preferenceInContextmenu:!0},tree:{attrTitle:!0,openRootOnLoad:!0,openCwdOnOpen:!0,syncTree:!0,subTreeMax:100,subdirsMaxConn:2,subdirsAtOnce:5,durations:{slideUpDown:"fast",autoScroll:"fast"}},navbar:{minWidth:150,maxWidth:500,autoHideUA:[]},navdock:{disabled:!1,initMaxHeight:"50%",maxHeight:"90%"},cwd:{oldSchool:!1,showSelectCheckboxUA:["Touch"],metakeyDragout:!0,listView:{columns:["perm","date","size","kind"],columnsCustomName:{},fixedHeader:!0},iconsView:{size:0,sizeMax:3,sizeNames:{0:"viewSmall",1:"viewMedium",2:"viewLarge",3:"viewExtraLarge"}}},path:{toWorkzoneWithoutNavbar:!0},dialog:{focusOnMouseOver:!0},toast:{animate:{showMethod:"fadeIn",showDuration:300,showEasing:"swing",timeOut:3e3,hideMethod:"fadeOut",hideDuration:1500,hideEasing:"swing"}}},dispInlineRegex:"^(?:(?:image|video|audio)|application/(?:x-mpegURL|dash+xml)|(?:text/plain|application/pdf)$)",onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,sortAlsoTreeview:!1,clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",fileModeStyle:"both",width:"auto",height:400,heightBase:null,resizable:!0,notifyDelay:500,notifyDialog:{position:{},width:null,canClose:!1,hiddens:["open"]},dialogContained:!1,allowShortcuts:!0,rememberLastDir:!0,reloadClearHistory:!1,useBrowserHistory:!0,showFiles:50,showThreshold:50,validName:!1,fileFilter:!1,backupSuffix:"~",sync:0,syncStart:!0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","opennew","download","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","empty","hide","|","rename","|","archive","|","places","info","chmod","netunmount"],cwd:["undo","redo","|","back","up","reload","|","upload","mkdir","mkfile","paste","|","empty","hide","|","view","sort","selectall","colwidth","|","places","info","chmod","netunmount","|","fullscreen","|","preference"],files:["getfile","|","open","opennew","download","opendir","quicklook","|","upload","mkdir","|","copy","cut","paste","duplicate","|","rm","empty","hide","|","rename","edit","resize","|","archive","extract","|","selectall","selectinvert","|","places","info","chmod","netunmount"]},enableAlways:!1,enableByMouseOver:!0,windowCloseConfirm:["hasNotifyDialog","editingFile"],rawStringDecoder:"object"==typeof Encoding&&$.isFunction(Encoding.convert)?function(e){return Encoding.convert(e,{to:"UNICODE",type:"string"})}:null,debug:["error","warning","event-destroy"],toastBackendWarn:!0},e}),e("skylark-elfinder/options.netmount",["./elFinder","./options"],function(e){return e.prototype._options.commandsOptions.netmount={ftp:{name:"FTP",inputs:{host:$('<input type="text"/>'),port:$('<input type="number" placeholder="21" class="elfinder-input-optional"/>'),path:$('<input type="text" value="/"/>'),user:$('<input type="text"/>'),pass:$('<input type="password" autocomplete="new-password"/>'),FTPS:$('<input type="checkbox" value="1" title="File Transfer Protocol over SSL/TLS"/>'),encoding:$('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>'),locale:$('<input type="text" placeholder="Optional" class="elfinder-input-optional"/>')}},dropbox2:e.prototype.makeNetmountOptionOauth("dropbox2","Dropbox","Dropbox",{noOffline:!0,root:"/",pathI18n:"path",integrate:{title:"Dropbox.com",link:"https://www.dropbox.com"}}),googledrive:e.prototype.makeNetmountOptionOauth("googledrive","Google Drive","Google",{integrate:{title:"Google Drive",link:"https://www.google.com/drive/"}}),onedrive:e.prototype.makeNetmountOptionOauth("onedrive","One Drive","OneDrive",{integrate:{title:"Microsoft OneDrive",link:"https://onedrive.live.com"}}),box:e.prototype.makeNetmountOptionOauth("box","Box","Box",{noOffline:!0,integrate:{title:"Box.com",link:"https://www.box.com"}})},e}),e("skylark-elfinder/history",["./elFinder"],function(e){return e.prototype.history=function(e){"use strict";var t,n=this,i=!0,a=[],o=function(){a=[e.cwd().hash],t=0,i=!0},r=e.options.useBrowserHistory&&window.history&&window.history.pushState?window.history:null,s=function(r){return r&&n.canForward()||!r&&n.canBack()?(i=!1,e.exec("open",a[r?++t:--t]).fail(o)):$.Deferred().reject()},l=function(e){!r||r.state&&r.state.thash===e||r.pushState({thash:e},null,location.pathname+location.search+(e?"#elf_"+e:""))};this.canBack=function(){return t>0},this.canForward=function(){return t<a.length-1},this.back=s,this.forward=function(){return s(!0)},e.bind("init",function(){r&&!r.state&&l(e.startDir())}).open(function(){var n=a.length,o=e.cwd().hash;i&&(t>=0&&n>t+1&&a.splice(t+1),a[a.length-1]!=o&&a.push(o),t=a.length-1),i=!0,l(o)}).reload(e.options.reloadClearHistory&&o)},e}),e("skylark-elfinder/command",["./elFinder"],function(e){return e.prototype.command=function(e){"use strict";this.fm=e,this.name="",this.dialogClass="",this.className="",this.title="",this.linkedCmds=[],this.state=-1,this.alwaysEnabled=!1,this.noChangeDirOnRemovedCwd=!1,this._disabled=!1,this.disableOnSearch=!1,this.updateOnSelect=!0,this.syncTitleOnChange=!1,this.keepContextmenu=!1,this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load sync":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name)),this.update(void 0,this.value),this.change()}},this.handlers={},this.shortcuts=[],this.options={ui:"button"},this.listeners=[],this.setup=function(e,t){var n,i,a,o=this,r=this.fm,s=function(e){var t=e.callback||function(e){r.exec(o.name,void 0,{_userAction:!0,_currentType:"shortcut"})};e.callback=function(e){var n,i={};o.enabled()&&(r.searchStatus.state<2?n=r.isCommandEnabled(o.name):($.each(r.selected(),function(e,t){r.optionsByHashes[t]?i[t]=!0:$.each(r.volOptions,function(e){if(!i[e]&&0===t.indexOf(e))return i[e]=!0,!1})}),$.each(i,function(e){if(!(n=r.isCommandEnabled(o.name,e)))return!1})),n&&(o.event=e,t.call(o),delete o.event))}};for(this.name=e,this.title=r.messages["cmd"+e]?r.i18n("cmd"+e):this.extendsCmd&&r.messages["cmd"+this.extendsCmd]?r.i18n("cmd"+this.extendsCmd):e,this.options=Object.assign({},this.options,t),this.listeners=[],this.dialogClass="elfinder-dialog-"+e,t.shortcuts&&("function"==typeof t.shortcuts?a=t.shortcuts(this.fm,this.shortcuts):Array.isArray(t.shortcuts)&&(a=t.shortcuts),this.shortcuts=a||[]),this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),$.each(Object.assign({},o._handlers,o.handlers),function(e,t){r.bind(e,$.proxy(t,o))}),n=0;n<this.shortcuts.length;n++)i=this.shortcuts[n],s(i),!i.description&&(i.description=this.title),r.shortcut(i);this.disableOnSearch&&r.bind("search searchend",function(){o._disabled="search"===this.type||!(this.alwaysEnabled||r.isCommandEnabled(e)),o.update(void 0,o.value)}),this.init()},this.init=function(){},this.exec=function(e,t){return $.Deferred().reject()},this.getUndo=function(e,t){return!1},this.disabled=function(){return this.state<0},this.enabled=function(){return this.state>-1},this.active=function(){return this.state>0},this.getstate=function(){return-1},this.update=function(e,t){var n=this.state,i=this.value;this._disabled&&0===this.fm.searchStatus?this.state=-1:this.state=void 0!==e?e:this.getstate(),this.value=t,n==this.state&&i==this.value||this.change()},this.change=function(e){var t,n;if("function"==typeof e)this.listeners.push(e);else for(n=0;n<this.listeners.length;n++){t=this.listeners[n];try{t(this.state,this.value)}catch(e){this.fm.debug("error",e)}}return this},this.hashes=function(t){return t?$.grep(Array.isArray(t)?t:[t],function(t){return!!e.file(t)}):e.selected()},this.files=function(e){var t=this.fm;return e?$.map(Array.isArray(e)?e:[e],function(e){return t.file(e)||null}):t.selectedFiles()},this.fmDialog=function(e,t){return t.cssClass?t.cssClass+=" "+this.dialogClass:t.cssClass=this.dialogClass,this.fm.dialog(e,t)}},e}),e("skylark-elfinder/resources",["./elFinder"],function(e){return e.prototype.resources={class:{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search",editing:"elfinder-to-editing",preventback:"elfinder-prevent-back",tabstab:"ui-state-default ui-tabs-tab ui-corner-top ui-tab",tabsactive:"ui-tabs-active ui-state-active"},tpl:{perms:'<span class="elfinder-perms"/>',lock:'<span class="elfinder-lock"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-spinner elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper{root}"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon" {style}/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"/></div>',placedir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"{title}><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon" {style}/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree" style="display:none"/></div>'},mimes:{text:["application/dash+xml","application/docbook+xml","application/javascript","application/json","application/plt","application/sat","application/sql","application/step","application/vnd.hp-hpgl","application/x-awk","application/x-config","application/x-csh","application/x-empty","application/x-mpegurl","application/x-perl","application/x-php","application/x-web-config","application/xhtml+xml","application/xml","audio/x-mp3-playlist","image/cgm","image/svg+xml","image/vnd.dxf","model/iges"]},mixin:{make:function(){"use strict";var e,t,n,i,a,o,r,s,l,c,d=this,p=this.fm,u=this.name,h=this.requestCmd||u,f=p.getUI("workzone"),m=this.origin&&"navbar"===this.origin?"tree":"cwd",g="tree"===m,v=g?"navHash2Elm":"cwdHash2Elm",b=!g&&"list"!=p.storage("view"),y=p.selected(),w=this.move||!1,x=f.hasClass("elfinder-cwd-wrapper-empty"),k=function(){requestAnimationFrame(function(){D&&D.trigger("blur")})},C=function(){S.is(":hidden")||S.elfinderoverlay("hide").off("click close",E),t&&(n.removeClass("ui-front").css("position","").off("unselect."+p.namespace,k),b?t&&t.css("max-height",""):g||n.css("width","").parent("td").css("overflow",""))},T=$.Deferred().fail(function(e){o&&a.attr("class",o),x&&f.addClass("elfinder-cwd-wrapper-empty"),y&&(w&&p.trigger("unlockfiles",{files:y}),p.clipboard([]),p.trigger("selectfiles",{files:y})),e&&p.error(e)}).always(function(){C(),F(),p.enable().unbind("open",q).trigger("resMixinMake")}),z="tmp_"+parseInt(1e5*Math.random()),j=this.data&&this.data.target?this.data.target:g?p.file(y[0]).hash:p.cwd().hash,A=new Date,O={hash:z,phash:j,name:p.uniqueName(this.prefix,j),mime:this.mime,read:!0,write:!0,date:"Today "+A.getHours()+":"+A.getMinutes(),move:w},I=(p.getUI(m).trigger("create."+p.namespace,O),this.data||{}),M=p[v](z),S=p.getUI("overlay"),F=function(){M&&M.length&&(D.off(),M.hide(),p.unselectfiles({files:[z]}).unbind("resize",P),requestAnimationFrame(function(){g?M.closest(".elfinder-navbar-wrapper").remove():M.remove()}))},E=function(e){S.is(":hidden")||n.css("z-index",""),R||(F(),T.reject(),e&&(e.stopPropagation(),e.preventDefault()))},D=$(b?"<textarea/>":'<input type="text"/>').on("keyup text",function(){b?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):e&&(this.style.width=e+"px",this.scrollWidth>e&&(this.style.width=this.scrollWidth+10+"px"))}).on("keydown",function(e){e.stopImmediatePropagation(),e.keyCode==$.ui.keyCode.ESCAPE?T.reject():e.keyCode==$.ui.keyCode.ENTER&&(e.preventDefault(),D.trigger("blur"))}).on("mousedown click dblclick",function(e){e.stopPropagation(),"dblclick"===e.type&&e.preventDefault()}).on("blur",function(){var e,t=$.trim(D.val()),a=D.parent(),o=!0;if(S.is(":hidden")||n.css("z-index",""),""===t)return E();if(!R&&a.length){if(p.options.validName&&p.options.validName.test)try{o=p.options.validName.test(t)}catch(e){o=!1}if(!t||"."===t||".."===t||!o)return R=!0,p.error("directory"===O.mime?"errInvDirname":"errInvName",{modal:!0,close:function(){setTimeout(U,120)}}),!1;if(p.fileByName(t,j))return R=!0,p.error(["errExists",t],{modal:!0,close:function(){setTimeout(U,120)}}),!1;e=y&&w?p.exec("cut",y):null,$.when(e).done(function(){var e={},n={};C(),D.hide().before($("<span>").text(t)),p.lockfiles({files:[z]}),p.request({data:Object.assign({cmd:h,name:t,target:j},I||{}),notify:{type:h,cnt:1},preventFail:!0,syncOnFail:!0,navigate:{toast:e}}).fail(function(e){p.unlockfiles({files:[z]}),R=!0,D.show().prev().remove(),p.error(e,{modal:!0,close:function(){Array.isArray(e)&&-1!==$.inArray("errUploadMime",e)?T.notify("errUploadMime").reject():setTimeout(U,120)}})}).done(function(t){if(t&&t.added&&t.added[0]){var a,o=t.added[0],r=o.hash,s=(p[v](r),{directory:{cmd:"open",msg:"cmdopendir"},text:{cmd:"edit",msg:"cmdedit"},default:{cmd:"open",msg:"cmdopen"}});y&&w&&p.one(h+"done",function(){p.exec("paste",r)}),w||(p.mimeIsText(o.mime)&&!p.mimesCanMakeEmpty[o.mime]&&p.mimeTypes[o.mime]&&(p.trigger("canMakeEmptyFile",{mimes:[o.mime],unshift:!0}),(a={})[o.mime]=p.mimeTypes[o.mime],p.storage("mkfileTextMimes",Object.assign(a,p.storage("mkfileTextMimes")||{}))),Object.assign(n,i||s[o.mime]||s[o.mime.split("/")[0]]||s[p.mimesCanMakeEmpty[o.mime]||-1!==$.inArray(o.mime,p.resources.mimes.text)?"text":"none"]||s.default),Object.assign(e,n.cmd?{incwd:{msg:p.i18n(["complete",p.i18n("cmd"+u)]),action:n},inbuffer:{msg:p.i18n(["complete",p.i18n("cmd"+u)]),action:n}}:{inbuffer:{msg:p.i18n(["complete",p.i18n("cmd"+u)])}}))}T.resolve(t)})}).fail(function(){T.reject()})}}).on("dragenter dragleave dragover drop",function(e){e.stopPropagation()}),U=function(){var e=p.splitFileExtention(D.val())[0];R||!p.UA.Mobile||p.UA.iOS||(S.on("click close",E).elfinderoverlay("show"),n.css("z-index",S.css("z-index")+1)),R=!1,!p.enabled()&&p.enable(),D.trigger("focus").trigger("select"),D[0].setSelectionRange&&D[0].setSelectionRange(0,e.length)},P=function(){M.trigger("scrolltoview",{blink:!1})},q=function(){T&&"pending"===T.state()&&T.reject()},R=!1;return p.isCommandEnabled(h,j)&&M.length?($.isPlainObject(d.nextAction)&&(i=Object.assign({},d.nextAction)),g?(a=p[v](j),r=p.res("class","navcollapse"),s=p.res("class","navexpand"),l=p.res("class","navarrow"),c=p.res("class","navsubtree"),M.closest("."+c).show(),a.hasClass(r)||(o=a.attr("class"),a.addClass(r+" "+s+" elfinder-subtree-loaded")),a.is("."+r+":not(."+s+")")&&a.children("."+l).trigger("click").data("dfrd").done(function(){D.val()===O.name&&D.val(p.uniqueName(d.prefix,j)).trigger("select").trigger("focus")}),t=M.contents().filter(function(){return 3==this.nodeType&&$(this).parent().attr("id")===p.navHash2Id(O.hash)}),n=t.parent(),t.replaceWith(D.val(O.name))):(x&&f.removeClass("elfinder-cwd-wrapper-empty"),t=M.find(".elfinder-cwd-filename"),n=t.parent(),b?t.css("max-height","none"):(e=n.width(),n.width(e-15).parent("td").css("overflow","visible")),t.empty().append(D.val(O.name))),n.addClass("ui-front").css("position","relative").on("unselect."+p.namespace,k),p.bind("resize",P).one("open",q),D.trigger("keyup"),U(),T):T.reject()}},blink:function(e,t){"use strict";var n,i={slowonce:function(){e.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500)},lookme:function(){e.show().fadeOut(500).fadeIn(750)}};n=i[t=t||"slowonce"]||i.lookme,e.stop(!0,!0),n()}},e}),e("skylark-elfinder/jquery.dialogelfinder",["skylark-jquery"],function(e){e.fn.dialogelfinder=function(t,n){var i,a,o="elfinderDestroyOnClose";if(e.isPlainObject(t))this.not(".elfinder").each(function(){t.handlers=t.handlers||{};var i,a=e(this),r=(e(document),e('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(t.title||"Files")+"</div>")),s=(e('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"> </span></a>').appendTo(r).on("click",function(e){e.preventDefault(),a.dialogelfinder("close")}),t.handlers.init);t.handlers.init=function(e,t){a.prepend(r),s&&s(e,t)},(i=a.addClass("elfinder dialogelfinder touch-punch").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",containment:"window",stop:function(){a.trigger("resize"),i.trigger("resize")}}).elfinder(t,n).elfinder("instance")).reloadCallback=function(e,t){i.destroy(),e.handlers.init=s,a.dialogelfinder(e,t).dialogelfinder("open")},a.width(parseInt(a.width())||840).data(o,!!t.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top"),t.position&&a.data("elfinderPosition",t.position),!1!==t.autoOpen&&e(this).dialogelfinder("open")});else if("open"===t)i=e(this),a=i.data("elfinderPosition")||{top:parseInt(e(document).scrollTop()+(e(window).height()<i.height()?2:(e(window).height()-i.height())/2)),left:parseInt(e(document).scrollLeft()+(e(window).width()<i.width()?2:(e(window).width()-i.width())/2))},i.is(":hidden")&&(i.addClass("ui-front").css(a).show().trigger("resize"),setTimeout(function(){i.trigger("resize").trigger("mousedown")},200));else if("close"===t)(i=e(this).removeClass("ui-front")).is(":visible")&&(i.data(o)?i.elfinder("destroy").remove():i.elfinder("close"));else if("instance"===t)return e(this).getElFinder();return this}}),e("skylark-elfinder/i18n/elfinder.en",["../elFinder"],function(e){return e.prototype.i18.en={translator:"Troex Nevelin &lt;troex@fury.scancode.ru&gt;, Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;",language:"English",direction:"ltr",dateFormat:"M d, Y h:i A",fancyDateFormat:"$1 h:i A",nonameDateFormat:"ymd-His",messages:{error:"Error",errUnknown:"Unknown error.",errUnknownCmd:"Unknown command.",errJqui:"Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.",errNode:"elFinder requires DOM Element to be created.",errURL:"Invalid elFinder configuration! URL option is not set.",errAccess:"Access denied.",errConnect:"Unable to connect to backend.",errAbort:"Connection aborted.",errTimeout:"Connection timeout.",errNotFound:"Backend not found.",errResponse:"Invalid backend response.",errConf:"Invalid backend configuration.",errJSON:"PHP JSON module not installed.",errNoVolumes:"Readable volumes not available.",errCmdParams:'Invalid parameters for command "$1".',errDataNotJSON:"Data is not JSON.",errDataEmpty:"Data is empty.",errCmdReq:"Backend request requires command name.",errOpen:'Unable to open "$1".',errNotFolder:"Object is not a folder.",errNotFile:"Object is not a file.",errRead:'Unable to read "$1".',errWrite:'Unable to write into "$1".',errPerm:"Permission denied.",errLocked:'"$1" is locked and can not be renamed, moved or removed.',errExists:'Item named "$1" already exists.',errInvName:"Invalid file name.",errInvDirname:"Invalid folder name.",errFolderNotFound:"Folder not found.",errFileNotFound:"File not found.",errTrgFolderNotFound:'Target folder "$1" not found.',errPopup:"Browser prevented opening popup window. To open file enable it in browser options.",errMkdir:'Unable to create folder "$1".',errMkfile:'Unable to create file "$1".',errRename:'Unable to rename "$1".',errCopyFrom:'Copying files from volume "$1" not allowed.',errCopyTo:'Copying files to volume "$1" not allowed.',errMkOutLink:"Unable to create a link to outside the volume root.",errUpload:"Upload error.",errUploadFile:'Unable to upload "$1".',errUploadNoFiles:"No files found for upload.",errUploadTotalSize:"Data exceeds the maximum allowed size.",errUploadFileSize:"File exceeds maximum allowed size.",errUploadMime:"File type not allowed.",errUploadTransfer:'"$1" transfer error.',errUploadTemp:"Unable to make temporary file for upload.",errNotReplace:'Object "$1" already exists at this location and can not be replaced by object with another type.',errReplace:'Unable to replace "$1".',errSave:'Unable to save "$1".',errCopy:'Unable to copy "$1".',errMove:'Unable to move "$1".',errCopyInItself:'Unable to copy "$1" into itself.',errRm:'Unable to remove "$1".',errTrash:"Unable into trash.",errRmSrc:"Unable remove source file(s).",errExtract:'Unable to extract files from "$1".',errArchive:"Unable to create archive.",errArcType:"Unsupported archive type.",errNoArchive:"File is not archive or has unsupported archive type.",errCmdNoSupport:"Backend does not support this command.",errReplByChild:'The folder "$1" can\'t be replaced by an item it contains.',errArcSymlinks:"For security reason denied to unpack archives contains symlinks or files with not allowed names.",errArcMaxSize:"Archive files exceeds maximum allowed size.",errResize:'Unable to resize "$1".',errResizeDegree:"Invalid rotate degree.",errResizeRotate:"Unable to rotate image.",errResizeSize:"Invalid image size.",errResizeNoChange:"Image size not changed.",errUsupportType:"Unsupported file type.",errNotUTF8Content:'File "$1" is not in UTF-8 and cannot be edited.',errNetMount:'Unable to mount "$1".',errNetMountNoDriver:"Unsupported protocol.",errNetMountFailed:"Mount failed.",errNetMountHostReq:"Host required.",errSessionExpires:"Your session has expired due to inactivity.",errCreatingTempDir:'Unable to create temporary directory: "$1"',errFtpDownloadFile:'Unable to download file from FTP: "$1"',errFtpUploadFile:'Unable to upload file to FTP: "$1"',errFtpMkdir:'Unable to create remote directory on FTP: "$1"',errArchiveExec:'Error while archiving files: "$1"',errExtractExec:'Error while extracting files: "$1"',errNetUnMount:"Unable to unmount.",errConvUTF8:"Not convertible to UTF-8",errFolderUpload:"Try the modern browser, If you'd like to upload the folder.",errSearchTimeout:'Timed out while searching "$1". Search result is partial.',errReauthRequire:"Re-authorization is required.",errMaxTargets:"Max number of selectable items is $1.",errRestore:"Unable to restore from the trash. Can't identify the restore destination.",errEditorNotFound:"Editor not found to this file type.",errServerError:"Error occurred on the server side.",errEmpty:'Unable to empty folder "$1".',moreErrors:"There are $1 more errors.",cmdarchive:"Create archive",cmdback:"Back",cmdcopy:"Copy",cmdcut:"Cut",cmddownload:"Download",cmdduplicate:"Duplicate",cmdedit:"Edit file",cmdextract:"Extract files from archive",cmdforward:"Forward",cmdgetfile:"Select files",cmdhelp:"About this software",cmdhome:"Root",cmdinfo:"Get info",cmdmkdir:"New folder",cmdmkdirin:"Into New Folder",cmdmkfile:"New file",cmdopen:"Open",cmdpaste:"Paste",cmdquicklook:"Preview",cmdreload:"Reload",cmdrename:"Rename",cmdrm:"Delete",cmdtrash:"Into trash",cmdrestore:"Restore",cmdsearch:"Find files",cmdup:"Go to parent folder",cmdupload:"Upload files",cmdview:"View",cmdresize:"Resize & Rotate",cmdsort:"Sort",cmdnetmount:"Mount network volume",cmdnetunmount:"Unmount",cmdplaces:"To Places",cmdchmod:"Change mode",cmdopendir:"Open a folder",cmdcolwidth:"Reset column width",cmdfullscreen:"Full Screen",cmdmove:"Move",cmdempty:"Empty the folder",cmdundo:"Undo",cmdredo:"Redo",cmdpreference:"Preferences",cmdselectall:"Select all",cmdselectnone:"Select none",cmdselectinvert:"Invert selection",cmdopennew:"Open in new window",cmdhide:"Hide (Preference)",btnClose:"Close",btnSave:"Save",btnRm:"Remove",btnApply:"Apply",btnCancel:"Cancel",btnNo:"No",btnYes:"Yes",btnMount:"Mount",btnApprove:"Goto $1 & approve",btnUnmount:"Unmount",btnConv:"Convert",btnCwd:"Here",btnVolume:"Volume",btnAll:"All",btnMime:"MIME Type",btnFileName:"Filename",btnSaveClose:"Save & Close",btnBackup:"Backup",btnRename:"Rename",btnRenameAll:"Rename(All)",btnPrevious:"Prev ($1/$2)",btnNext:"Next ($1/$2)",btnSaveAs:"Save As",ntfopen:"Open folder",ntffile:"Open file",ntfreload:"Reload folder content",ntfmkdir:"Creating folder",ntfmkfile:"Creating files",ntfrm:"Delete items",ntfcopy:"Copy items",ntfmove:"Move items",ntfprepare:"Checking existing items",ntfrename:"Rename files",ntfupload:"Uploading files",ntfdownload:"Downloading files",ntfsave:"Save files",ntfarchive:"Creating archive",ntfextract:"Extracting files from archive",ntfsearch:"Searching files",ntfresize:"Resizing images",ntfsmth:"Doing something",ntfloadimg:"Loading image",ntfnetmount:"Mounting network volume",ntfnetunmount:"Unmounting network volume",ntfdim:"Acquiring image dimension",ntfreaddir:"Reading folder infomation",ntfurl:"Getting URL of link",ntfchmod:"Changing file mode",ntfpreupload:"Verifying upload file name",ntfzipdl:"Creating a file for download",ntfparents:"Getting path infomation",ntfchunkmerge:"Processing the uploaded file",ntftrash:"Doing throw in the trash",ntfrestore:"Doing restore from the trash",ntfchkdir:"Checking destination folder",ntfundo:"Undoing previous operation",ntfredo:"Redoing previous undone",ntfchkcontent:"Checking contents",volume_Trash:"Trash",dateUnknown:"unknown",Today:"Today",Yesterday:"Yesterday",msJan:"Jan",msFeb:"Feb",msMar:"Mar",msApr:"Apr",msMay:"May",msJun:"Jun",msJul:"Jul",msAug:"Aug",msSep:"Sep",msOct:"Oct",msNov:"Nov",msDec:"Dec",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",sortname:"by name",sortkind:"by kind",sortsize:"by size",sortdate:"by date",sortFoldersFirst:"Folders first",sortperm:"by permission",sortmode:"by mode",sortowner:"by owner",sortgroup:"by group",sortAlsoTreeview:"Also Treeview","untitled file.txt":"NewFile.txt","untitled folder":"NewFolder",Archive:"NewArchive","untitled file":"NewFile.$1",extentionfile:"$1: File",extentiontype:"$1: $2",confirmReq:"Confirmation required",confirmRm:"Are you sure you want to permanently remove items?<br/>This cannot be undone!",confirmRepl:"Replace old file with new one? (If it contains folders, it will be merged. To backup and replace, select Backup.)",confirmRest:"Replace existing item with the item in trash?",confirmConvUTF8:"Not in UTF-8<br/>Convert to UTF-8?<br/>Contents become UTF-8 by saving after conversion.",confirmNonUTF8:"Character encoding of this file couldn't be detected. It need to temporarily convert to UTF-8 for editting.<br/>Please select character encoding of this file.",confirmNotSave:"It has been modified.<br/>Losing work if you do not save changes.",confirmTrash:"Are you sure you want to move items to trash bin?",confirmMove:'Are you sure you want to move items to "$1"?',apllyAll:"Apply to all",name:"Name",size:"Size",perms:"Permissions",modify:"Modified",kind:"Kind",read:"read",write:"write",noaccess:"no access",and:"and",unknown:"unknown",selectall:"Select all items",selectfiles:"Select item(s)",selectffile:"Select first item",selectlfile:"Select last item",viewlist:"List view",viewicons:"Icons view",viewSmall:"Small icons",viewMedium:"Medium icons",viewLarge:"Large icons",viewExtraLarge:"Extra large icons",places:"Places",calc:"Calculate",path:"Path",aliasfor:"Alias for",locked:"Locked",dim:"Dimensions",files:"Files",folders:"Folders",items:"Items",yes:"yes",no:"no",link:"Link",searcresult:"Search results",selected:"selected items",about:"About",shortcuts:"Shortcuts",help:"Help",webfm:"Web file manager",ver:"Version",protocolver:"protocol version",homepage:"Project home",docs:"Documentation",github:"Fork us on GitHub",twitter:"Follow us on Twitter",facebook:"Join us on Facebook",team:"Team",chiefdev:"chief developer",developer:"developer",contributor:"contributor",maintainer:"maintainer",translator:"translator",icons:"Icons",dontforget:"and don't forget to take your towel",shortcutsof:"Shortcuts disabled",dropFiles:"Drop files here",or:"or",selectForUpload:"Select files",moveFiles:"Move items",copyFiles:"Copy items",restoreFiles:"Restore items",rmFromPlaces:"Remove from places",aspectRatio:"Aspect ratio",scale:"Scale",width:"Width",height:"Height",resize:"Resize",crop:"Crop",rotate:"Rotate","rotate-cw":"Rotate 90 degrees CW","rotate-ccw":"Rotate 90 degrees CCW",degree:"",netMountDialogTitle:"Mount network volume",protocol:"Protocol",host:"Host",port:"Port",user:"User",pass:"Password",confirmUnmount:"Are you sure to unmount $1?",dropFilesBrowser:"Drop or Paste files from browser",dropPasteFiles:"Drop files, Paste URLs or images(clipboard) here",encoding:"Encoding",locale:"Locale",searchTarget:"Target: $1",searchMime:"Search by input MIME Type",owner:"Owner",group:"Group",other:"Other",execute:"Execute",perm:"Permission",mode:"Mode",emptyFolder:"Folder is empty",emptyFolderDrop:"Folder is empty\\A Drop to add items",emptyFolderLTap:"Folder is empty\\A Long tap to add items",quality:"Quality",autoSync:"Auto sync",moveUp:"Move up",getLink:"Get URL link",selectedItems:"Selected items ($1)",folderId:"Folder ID",offlineAccess:"Allow offline access",reAuth:"To re-authenticate",nowLoading:"Now loading...",openMulti:"Open multiple files",openMultiConfirm:"You are trying to open the $1 files. Are you sure you want to open in browser?",emptySearch:"Search results is empty in search target.",editingFile:"It is editing a file.",hasSelected:"You have selected $1 items.",hasClipboard:"You have $1 items in the clipboard.",incSearchOnly:"Incremental search is only from the current view.",reinstate:"Reinstate",complete:"$1 complete",contextmenu:"Context menu",pageTurning:"Page turning",volumeRoots:"Volume roots",reset:"Reset",bgcolor:"Background color",colorPicker:"Color picker","8pxgrid":"8px Grid",enabled:"Enabled",disabled:"Disabled",emptyIncSearch:"Search results is empty in current view.\\A Press [Enter] to expand search target.",emptyLetSearch:"First letter search results is empty in current view.",textLabel:"Text label",minsLeft:"$1 mins left",openAsEncoding:"Reopen with selected encoding",saveAsEncoding:"Save with the selected encoding",selectFolder:"Select folder",firstLetterSearch:"First letter search",presets:"Presets",tooManyToTrash:"It's too many items so it can't into trash.",TextArea:"TextArea",folderToEmpty:'Empty the folder "$1".',filderIsEmpty:'There are no items in a folder "$1".',preference:"Preference",language:"Language",clearBrowserData:"Initialize the settings saved in this browser",toolbarPref:"Toolbar settings",charsLeft:"... $1 chars left.",linesLeft:"... $1 lines left.",sum:"Sum",roughFileSize:"Rough file size",autoFocusDialog:"Focus on the element of dialog with mouseover",select:"Select",selectAction:"Action when select file",useStoredEditor:"Open with the editor used last time",selectinvert:"Invert selection",renameMultiple:"Are you sure you want to rename $1 selected items like $2?<br/>This cannot be undone!",batchRename:"Batch rename",plusNumber:"+ Number",asPrefix:"Add prefix",asSuffix:"Add suffix",changeExtention:"Change extention",columnPref:"Columns settings (List view)",reflectOnImmediate:"All changes will reflect immediately to the archive.",reflectOnUnmount:"Any changes will not reflect until un-mount this volume.",unmountChildren:"The following volume(s) mounted on this volume also unmounted. Are you sure to unmount it?",selectionInfo:"Selection Info",hashChecker:"Algorithms to show the file hash",infoItems:"Info Items (Selection Info Panel)",pressAgainToExit:"Press again to exit.",toolbar:"Toolbar",workspace:"Work Space",dialog:"Dialog",all:"All",iconSize:"Icon Size (Icons view)",editorMaximized:"Open the maximized editor window",editorConvNoApi:"Because conversion by API is not currently available, please convert on the website.",editorConvNeedUpload:"After conversion, you must be upload with the item URL or a downloaded file to save the converted file.",convertOn:"Convert on the site of $1",integrations:"Integrations",integrationWith:"This elFinder has the following external services integrated. Please check the terms of use, privacy policy, etc. before using it.",showHidden:"Show hidden items",hideHidden:"Hide hidden items",toggleHidden:"Show/Hide hidden items",makefileTypes:'File types to enable with "New file"',typeOfTextfile:"Type of the Text file",add:"Add",theme:"Theme",default:"Default",description:"Description",website:"Website",author:"Author",email:"Email",license:"License",exportToSave:"This item can't be saved. To avoid losing the edits you need to export to your PC.",dblclickToSelect:"Double click on the file to select it.",useFullscreen:"Use fullscreen mode",kindUnknown:"Unknown",kindRoot:"Volume Root",kindFolder:"Folder",kindSelects:"Selections",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindXZ:"XZ archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindMarkdown:"Markdown text",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}},e}),e("skylark-elfinder/ui/button",["skylark-jquery"],function(e){e.fn.elfinderbutton=function(t){"use strict";return this.each(function(){var n,i,a="class",o=t.fm,r=o.res(a,"disabled"),s=o.res(a,"active"),l=o.res(a,"hover"),c="elfinder-button-menu-item",d=e('<span class="elfinder-button-text">'+t.title+"</span>"),p=t.className?t.className:t.name,u=e(this).addClass("ui-state-default elfinder-button").attr("title",t.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+p+'"/>',d).on("mouseenter mouseleave",function(e){!u.hasClass(r)&&u["mouseleave"==e.type?"removeClass":"addClass"](l)}).on("click",function(e){u.hasClass(r)||(n&&t.variants.length>=1?(n.is(":hidden")&&o.getUI().click(),e.stopPropagation(),n.css(f()).slideToggle({duration:100,done:function(e){o[n.is(":visible")?"toFront":"toHide"](n)}})):o.exec(t.name,m(),{_userAction:!0,_currentType:"toolbar",_currentNode:u}))}),h=function(){o.toHide(n)},f=function(){var e=o.getUI(),t=e.offset(),n=u.offset();return{top:n.top-t.top,left:n.left-t.left,maxHeight:e.height()-40}},m=function(){var e=o.selected();return e.length||(e=o.cwd()?[o.cwd().hash]:void 0),e};d.hide(),t.button=u,Array.isArray(t.variants)&&(u.addClass("elfinder-menubutton"),n=e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-'+p+'-menu ui-corner-all"/>').hide().appendTo(o.getUI()).on("mouseenter mouseleave","."+c,function(){e(this).toggleClass(l)}).on("click","."+c,function(i){var a=e(this).data("value");i.preventDefault(),i.stopPropagation(),u.removeClass(l),o.toHide(n),void 0===a&&(a={}),"object"==typeof a&&(a._userAction=!0),o.exec(t.name,m(),a)}).on("close",h),o.bind("disable select",h).getUI().on("click",h),t.change(function(){n.html(""),e.each(t.variants,function(i,a){n.append(e('<div class="'+c+'">'+a[1]+"</div>").data("value",a[0]).addClass(a[0]==t.value?"elfinder-button-menu-item-selected":""))})})),t.change(function(){var e;i&&cancelAnimationFrame(i),i=requestAnimationFrame(function(){t.disabled()?u.removeClass(s+" "+l).addClass(r):(u.removeClass(r),u[t.active()?"addClass":"removeClass"](s)),t.syncTitleOnChange&&(e=t.className?t.className:t.name,p!==e&&(u.children(".elfinder-button-icon").removeClass("elfinder-button-icon-"+p).addClass("elfinder-button-icon-"+e),n&&n.removeClass("elfinder-button-"+p+"-menu").addClass("elfinder-button-"+e+"-menu"),p=e),d.html(t.title),u.attr("title",t.title))})}).change()})}}),e("skylark-elfinder/ui/contextmenu",["skylark-jquery"],function(e){e.fn.elfindercontextmenu=function(t){"use strict";return this.each(function(){e(this);var n,i,a,o,r,s,l,c="elfinder-contextmenu-item",d="elfinder-contextsubmenu-item",p="elfinder-contextmenu-extra-icon",u=t.res("class","hover"),h={distance:8,start:function(){f.data("drag",!0).data("touching")&&f.find("."+u).removeClass(u)},stop:function(){f.data("draged",!0).removeData("drag")}},f=e(this).addClass("touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+t.direction).hide().on("touchstart",function(e){f.data("touching",!0).children().removeClass(u)}).on("touchend",function(e){f.removeData("touching")}).on("mouseenter mouseleave","."+c,function(t){e(this).toggleClass(u,!("mouseenter"!==t.type&&(f.data("draged")||!f.data("submenuKeep")))),f.data("draged")&&f.data("submenuKeep")&&f.find(".elfinder-contextmenu-sub:visible").parent().addClass(u)}).on("mouseenter mouseleave","."+p,function(t){e(this).parent().toggleClass(u,"mouseleave"===t.type)}).on("mouseenter mouseleave","."+c+",."+d,function(t){var n,i=function(t,n){e.each(n?r:a,function(e,i){if(t[0]===i)return(n?r:a)._cur=e,n?s=t:o=t,!1})};if(t.originalEvent){var l=e(this),c=function(){o&&!o.children("div.elfinder-contextmenu-sub:visible").length&&o.removeClass(u)};"mouseenter"===t.type?l.hasClass(d)?(s&&s.removeClass(u),o&&(r=o.find("div."+d)),i(l,!0)):(c(),i(l)):l.hasClass(d)?(s=null,r=null):(c(),n=o,setTimeout(function(){n===o&&(o=null)},250))}}).on("contextmenu",function(){return!1}).on("mouseup",function(){setTimeout(function(){f.removeData("draged")},100)}).draggable(h),m="ltr"===t.direction,g=m?"left":"right",v=Object.assign({},t.options.contextmenu),b='<div class="'+c+'{className}"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"{style}/><span>{label}</span></div>',y=function(n,i,a,o){var r,s,l="",c="",d="";return o&&(o.className&&(l=" "+o.className),o.iconClass&&(d=o.iconClass,i=""),o.iconImg&&(r=o.iconImg.split(/ +/),s=r[1]&&r[2]?t.escape(r[1]+"px "+r[2]+"px"):"",c=" style=\"background:url('"+t.escape(r[0])+"') "+(s||"0 0")+" no-repeat;"+(s?"":"posbackground-size:contain;")+'"')),e(b.replace("{icon}",i?"elfinder-button-icon-"+i:d||"").replace("{label}",n).replace("{style}",c).replace("{className}",l)).on("click",function(e){e.stopPropagation(),e.preventDefault(),a()})},w=function(n){var i=n.keyCode,l=e.ui.keyCode.ESCAPE,c=e.ui.keyCode.ENTER,p=e.ui.keyCode.LEFT,h=e.ui.keyCode.RIGHT,f=e.ui.keyCode.UP,m=e.ui.keyCode.DOWN,g="ltr"===t.direction?h:p,v=g===h?p:h;-1!==e.inArray(i,[l,c,p,h,f,m])&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),i==l||i===v?o&&r&&s?(s.trigger("mouseleave").trigger("submenuclose"),o.addClass(u),r=null,s=null):i==l&&k():i==f||i==m?r?(s&&s.trigger("mouseleave"),i==m&&(!s||r.length<=++r._cur)?r._cur=0:i==f&&(!s||--r._cur<0)&&(r._cur=r.length-1),s=r.eq(r._cur).trigger("mouseenter")):(r=null,o&&o.trigger("mouseleave"),i==m&&(!o||a.length<=++a._cur)?a._cur=0:i==f&&(!o||--a._cur<0)&&(a._cur=a.length-1),o=a.eq(a._cur).addClass(u)):!o||i!=c&&i!==g||(o.hasClass("elfinder-contextmenu-group")?s?i==c&&s.click():(o.trigger("mouseenter"),(r=o.find("div."+d))._cur=0,s=r.first().addClass(u)):i==c&&o.click()))},x=function(a,c,d){var p,u,h=f.outerWidth(),m=f.outerHeight(),v=n.attr("style"),b=n.offset(),y=n.width(),$=n.height(),C=t.UA.Mobile?40:2,T=t.UA.Mobile?20:2,a=a-(b?b.left:0),c=c-(b?b.top:0),d=Object.assign(d||{},{top:Math.max(0,c+T+m<$?c+T:c-(c+m-$)),left:Math.max(0,a<h+C||a+C+h<y?a+C:a-C-h),opacity:"1"});l=!0,t.autoSync("stop"),n.width(y),f.stop().removeAttr("style").css(d),t.toFront(f),f.show(),n.attr("style",v),d[g]=parseInt(f.width()),f.find(".elfinder-contextmenu-sub").css(d),t.UA.iOS&&e("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","auto"),o=null,r=null,s=null,e(document).on("keydown."+t.namespace,w),(p=e._data(document).events)&&p.keydown&&p.keydown.unshift(p.keydown.pop()),t.UA.Mobile&&(u="touchstart.contextmenuAutoToggle",f.data("hideTm")&&clearTimeout(f.data("hideTm")),f.is(":visible")&&f.on("touchstart",function(e){e.originalEvent.touches.length>1||(f.stop(),t.toFront(f),f.data("hideTm")&&clearTimeout(f.data("hideTm")))}).data("hideTm",setTimeout(function(){f.is(":visible")&&(i.find(".elfinder-cwd-file").off(u),i.find(".elfinder-cwd-file.ui-selected").one(u,function(t){if(!(t.originalEvent.touches.length>1)){var n=e(t.target);if(f.first().length&&!n.is("input:checkbox")&&!n.hasClass("elfinder-cwd-select"))return t.stopPropagation(),x(t.originalEvent.touches[0].pageX,t.originalEvent.touches[0].pageY),i.data("longtap",!0),void n.one("touchend",function(){setTimeout(function(){i.removeData("longtap")},80)});i.find(".elfinder-cwd-file").off(u)}}).one("unselect."+t.namespace,function(){i.find(".elfinder-cwd-file").off(u)}),f.fadeOut({duration:300,fail:function(){f.css("opacity","1").show()},done:function(){t.toHide(f)}}))},4500))),requestAnimationFrame(function(){t.getUI().one("click."+t.namespace,k)})},k=function(){if(t.getUI().off("click."+t.namespace,k),e(document).off("keydown."+t.namespace,w),$=C=null,f.is(":visible")||f.children().length){t.toHide(f.removeAttr("style").empty().removeData("submenuKeep"));try{f.draggable("instance")||f.draggable(h)}catch(e){f.hasClass("ui-draggable")||f.draggable(h)}f.data("prevNode")&&(f.data("prevNode").after(f),f.removeData("prevNode")),t.trigger("closecontextmenu"),t.UA.iOS&&e("div.elfinder div.overflow-scrolling-touch").css("-webkit-overflow-scrolling","touch")}l&&t.searchStatus.state<1&&!t.searchStatus.ininc&&t.autoSync(),l=!1},$=null,C=null;t.one("load",function(){n=t.getUI(),i=t.getUI("cwd"),t.bind("contextmenu",function(o){var r,s,l=o.data,h={};l.type&&"files"!==l.type&&i.trigger("unselectall"),k(),l.type&&l.targets?(t.trigger("contextmenucreate",l),function(i,o){var r,s=!1,l=!1,h=[],g="cwd"===i,b=0;$=i,C=o,(r=t.option("uiCmdMap",g?void 0:o[0]))||(r={});g||(h=t.getDisabledCmds(o));(b=t.selected().length)>1&&f.append('<div class="ui-corner-top ui-widget-header elfinder-contextmenu-header"><span>'+t.i18n("selectedItems",""+b)+"</span></div>");a=e(),e.each(v[i]||[],function(v,b){var w,x,$,C,T,z;if("|"!==b){if(r[b]?(x=r[b],$=!0):x=b,!(w=t.getCommand(x))||g||t.searchStatus.state&&w.disableOnSearch||(w.__disabled=w._disabled,w._disabled=!(w.alwaysEnabled||t._commands[x]&&!(-1!==e.inArray(b,h)||$&&h[x])),e.each(w.linkedCmds,function(e,n){var i;(i=t.getCommand(n))&&(i.__disabled=i._disabled,i._disabled=!(i.alwaysEnabled||t._commands[n]&&!h[n]))})),w&&!w._disabled&&-1!=w.getstate(o)){if(w.variants){if(!w.variants.length)return;C=y(w.title,w.className?w.className:w.name,function(){},w.contextmenuOpts),T=e('<div class="ui-front ui-corner-all elfinder-contextmenu-sub"/>').hide().css("max-height",t.getUI().height()-30).appendTo(C.append('<span class="elfinder-contextmenu-arrow"/>')),z=function(e){if(e){var i=n.attr("style");n.width(n.width()),T.css({top:"-1000px",left:"auto",right:"auto"});var a,o,r=C.offset(),s=r.left,l=r.top,c=C.outerWidth(),d=T.outerWidth(!0),p=T.outerHeight(!0),u=n.offset(),h=u.left+n.width(),g=u.top+n.height(),v=m,b=c;m?(o=s+c+d-h)>10&&(s>d-5?(b-=5,v=!1):t.UA.Mobile||(b=c-o)):(o=d-s)>0&&(s+c+d-15<h?(b-=5,v=!0):t.UA.Mobile||(b=c-o)),a=(o=l+5+p-g)>0&&l<g?5-o:o>0?30-p:5,f.find(".elfinder-contextmenu-sub:visible").hide(),T.css({top:a,left:v?b:"auto",right:v?"auto":b,overflowY:"auto"}).show(),n.attr("style",i)}else T.hide()},C.addClass("elfinder-contextmenu-group").on("mouseleave",".elfinder-contextmenu-sub",function(e){f.data("draged")||f.removeData("submenuKeep")}).on("submenuclose",".elfinder-contextmenu-sub",function(e){z(!1)}).on("click","."+d,function(n){var a,r;n.stopPropagation(),f.data("draged")||(r=e(this),w.keepContextmenu?(r.removeClass(u),C.addClass(u)):f.hide(),void 0===(a=r.data("exec"))&&(a={}),"object"==typeof a&&(a._userAction=!0,a._currentType=i,a._currentNode=r),!w.keepContextmenu&&k(),t.exec(w.name,o,a))}).on("touchend",function(e){f.data("drag")||(z(!0),f.data("submenuKeep",!0))}).on("mouseenter mouseleave",function(t){f.data("touching")||(C.data("timer")&&(clearTimeout(C.data("timer")),C.removeData("timer")),e(t.target).closest(".elfinder-contextmenu-sub",f).length||("mouseleave"===t.type?f.data("submenuKeep")||C.data("timer",setTimeout(function(){C.removeData("timer"),z(!1)},250)):C.data("timer",setTimeout(function(){C.removeData("timer"),z(!0)},a.find("div.elfinder-contextmenu-sub:visible").length?250:0))))}),e.each(w.variants,function(t,n){var i,a,o,r,s="|"===n?'<div class="elfinder-contextmenu-separator"/>':e('<div class="'+c+" "+d+'"><span>'+n[1]+"</span></div>").data("exec",n[0]);void 0!==n[2]&&(i=e("<span/>").addClass("elfinder-button-icon elfinder-contextmenu-icon"),/\//.test(n[2])?i.css((a=n[2],o=a.split(/ +/),r=o[1]&&o[2]?o[1]+"px "+o[2]+"px":"",{backgroundImage:'url("'+o[0]+'")',backgroundRepeat:"no-repeat",backgroundPosition:r||"",backgroundSize:r?"":"contain"})):i.addClass("elfinder-button-icon-"+n[2]),s.prepend(i).addClass(d+"-icon")),T.append(s)})}else C=y(w.title,w.className?w.className:w.name,function(){f.data("draged")||(!w.keepContextmenu&&k(),t.exec(w.name,o,{_userAction:!0,_currentType:i,_currentNode:C}))},w.contextmenuOpts),w.extra&&w.extra.node?(e('<span class="elfinder-button-icon elfinder-button-icon-'+(w.extra.icon||"")+" "+p+'"/>').append(w.extra.node).appendTo(C),e(w.extra.node).trigger("ready",{targets:o})):C.remove("."+p);w.extendsCmd&&C.children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+w.extendsCmd),l&&f.append('<div class="elfinder-contextmenu-separator"/>'),f.append(C),s=!0,l=!1}w&&void 0!==w.__disabled&&(w._disabled=w.__disabled,delete w.__disabled,e.each(w.linkedCmds,function(e,n){var i;(i=t.getCommand(n))&&(i._disabled=i.__disabled,delete i.__disabled)}))}else s&&(l=!0)}),a=f.children("div."+c)}(l.type,l.targets),t.trigger("contextmenucreatedone",l)):l.raw&&(s=l.raw,$="raw",e.each(s,function(e,t){var n;"|"===t?f.append('<div class="elfinder-contextmenu-separator"/>'):t.label&&"function"==typeof t.callback&&(n=y(t.label,t.icon,function(){f.data("draged")||(!t.remain&&k(),t.callback())},t.options||null),f.append(n))}),a=f.children("div."+c)),f.children().length&&((r=l.prevNode||null)&&(f.data("prevNode",f.prev()),r.after(f)),l.fitHeight&&(h={maxHeight:Math.min(t.getUI().height(),e(window).height()),overflowY:"auto"},f.draggable("destroy").removeClass("ui-draggable")),x(l.x,l.y,h),l.opened&&"function"==typeof l.opened&&l.opened.call(f))}).one("destroy",function(){f.remove()}).bind("disable",k).bind("select",function(e){"files"===$&&(!e.data||e.data.selected.toString()!==C.toString())&&k()})}).shortcut({pattern:"mac"===t.OS?"ctrl+m":"contextmenu shift+f10",description:"contextmenu",callback:function(n){n.stopPropagation(),n.preventDefault(),e(document).one("contextmenu."+t.namespace,function(e){e.preventDefault(),e.stopPropagation()});var i,a,o,r,s=t.selected();s.length?(i="files",a=s,r=t.cwdHash2Elm(s[0])):(i="cwd",a=[t.cwd().hash],o=t.getUI("workzone").offset()),r&&r.length||(r=t.getUI("workzone")),(o=r.offset()).top+=r.height()/2,o.left+=r.width()/2,t.trigger("contextmenu",{type:i,targets:a,x:o.left,y:o.top})}})})}}),e("skylark-elfinder/ui/cwd",["skylark-jquery"],function(e){e.fn.elfindercwd=function(t,n){"use strict";return this.not(".elfinder-cwd").each(function(){var i,a,o,r,s,l,c,d=t.UA.Mobile,p="list"==t.viewType,u="select."+t.namespace,h="unselect."+t.namespace,f="disable."+t.namespace,m="enable."+t.namespace,g="class",v=t.res(g,"cwdfile"),b="."+v,y="ui-selected",w=t.res(g,"disabled"),x=t.res(g,"draggable"),k=t.res(g,"droppable"),$=t.res(g,"hover"),C=t.res(g,"active"),T=t.res(g,"adroppable"),z=v+"-tmp",j="elfinder-cwd-selectchk",A=t.options.loadTmbs>0?t.options.loadTmbs:5,O="",I={},M=[],S=[],F=void 0,E=[],D="",U=function(){return'<tr id="{id}" class="'+v+' {permsclass} {dirclass}" title="{tooltip}"{css}><td class="elfinder-col-name"><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"{style}/>{marker}<span class="elfinder-cwd-filename">{name}</span></div>'+P+"</td>"+function(){for(var e="",t=0;t<E.length;t++)e+='<td class="elfinder-col-'+E[t]+'">{'+E[t]+"}</td>";return e}()+"</tr>"},P=e.map(n.showSelectCheckboxUA,function(e){return!(!t.UA[e]&&!e.match(/^all$/i))||null}).length?'<div class="elfinder-cwd-select"><input type="checkbox" class="'+j+'"></div>':"",q=!1,R=null,H={icon:'<div id="{id}" class="'+v+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on"{style}/>{marker}</div><div class="elfinder-cwd-filename" title="{nametitle}">{name}</div>'+P+"</div>",row:""},_=t.res("tpl","perms"),N=t.res("tpl","lock"),L=t.res("tpl","symlink"),B={id:function(e){return t.cwdHash2Id(e.hash)},name:function(e){var n=t.escape(e.i18||e.name);return!p&&(n=n.replace(/([_.])/g,"&#8203;$1")),n},nametitle:function(e){return t.escape(e.i18||e.name)},permsclass:function(e){return t.perms2class(e)},perm:function(e){return t.formatPermissions(e)},dirclass:function(e){var i="directory"==e.mime?"directory":"";return e.isroot&&(i+=" isroot"),e.csscls&&(i+=" "+t.escape(e.csscls)),n.getClass&&(i+=" "+n.getClass(e)),i},style:function(e){return e.icon?t.getIconStyle(e):""},mime:function(e){var n=t.mime2class(e.mime);return e.icon&&(n+=" elfinder-cwd-bgurl"),n},size:function(e){return"directory"!==e.mime||e.size?t.formatSize(e.size):"-"},date:function(e){return t.formatDate(e)},kind:function(e){return t.mime2kind(e)},mode:function(e){return e.perm?t.formatFileMode(e.perm):""},modestr:function(e){return e.perm?t.formatFileMode(e.perm,"string"):""},modeoct:function(e){return e.perm?t.formatFileMode(e.perm,"octal"):""},modeboth:function(e){return e.perm?t.formatFileMode(e.perm,"both"):""},marker:function(e){return(e.alias||"symlink-broken"==e.mime?L:"")+(e.read&&e.write?"":_)+(e.locked?N:"")},tooltip:function(e){var n=t.formatDate(e)+(e.size>0?" ("+t.formatSize(e.size)+")":""),i="";return i=O&&e.path?t.escape(e.path.replace(/\/[^\/]*$/,"")):e.tooltip?t.escape(e.tooltip).replace(/\r/g,"&#13;"):"",p&&(i+=(i?"&#13;":"")+t.escape(e.i18||e.name)),i?i+"&#13;"+n:n}},W={},V=function(n){return n.mime&&"directory"!==n.mime&&!W[n.mime]&&function(n,i){var o,r,s;if(n&&!W[n]&&(void 0===a&&(e("#elfinderAddBadgeStyle"+t.namespace).length&&e("#elfinderAddBadgeStyle"+t.namespace).remove(),a=e('<style id="addBadgeStyle'+t.namespace+'"/>').insertBefore(e("head").children(":first")).get(0).sheet||null),a)){if(n=n.toLowerCase(),s=n.split("/"),r=t.escape(t.mimeTypes[n]||(i.replace(/.bac?k$/i,"").match(/\.([^.]+)$/)||["",""])[1])){o=".elfinder-cwd-icon-"+s[0].replace(/(\.|\+)/g,"-"),void 0!==s[1]&&(o+=".elfinder-cwd-icon-"+s[1].replace(/(\.|\+)/g,"-"));try{a.insertRule(o+':before{content:"'+r.toLowerCase()+'"}',0)}catch(e){}}W[n]=!0}}(n.mime,n.name),H[p?"row":"icon"].replace(/\{([a-z0-9_]+)\}/g,function(e,i){return B[i]?B[i](n,t):n[i]?n[i]:""})},K=e(),X=!1,G={},J=function(e){t.cwdHash2Elm(e).trigger(u)},Y=!1,Q=function(){t.cwd().hash;P&&Oe.find("input").prop("checked",!0),t.lazy(function(){var n;t.maxTargets&&(F||S).length>t.maxTargets?(Z({notrigger:!0}),n=(n=e.map(F||S,function(e){return t.file(e)||null})).slice(0,t.maxTargets),G={},e.each(n,function(e,n){G[n.hash]=!0,t.cwdHash2Elm(n.hash).trigger(u)}),t.toast({mode:"warning",msg:t.i18n(["errMaxTargets",t.maxTargets])})):(ze.find("[id]:not(.ui-selected):not(.elfinder-cwd-parent)").trigger(u),G=t.arrayFlip(F||S,!0)),te(),P&&Oe.data("pending",!1)},0,{repaint:!0})},Z=function(e){var t=e||{};P&&Oe.find("input").prop("checked",!1),Object.keys(G).length&&(X=!1,G={},ze.find("[id].ui-selected").trigger(h),P&&ze.find("input:checkbox."+j).prop("checked",!1)),!t.notrigger&&te(),P&&Oe.data("pending",!1),ze.removeClass("elfinder-cwd-allselected")},ee=void 0,te=function(){var e=Object.keys(G),n={selected:e,origin:"cwd"};de&&(e.length>1||e[0]!==t.cwdId2Hash(de.attr("id")))&&de.hasClass(y)&&de.trigger(h),Y=e.length&&e.length===(F||S).length&&(!t.maxTargets||e.length<=t.maxTargets),P&&(Oe.find("input").prop("checked",Y),ze[Y?"addClass":"removeClass"]("elfinder-cwd-allselected")),Y?n.selectall=!0:e.length||(n.unselectall=!0),t.trigger("select",n)},ne=function(e,n){if(e.length){var i=e.position().top,a=e.outerHeight(!0),o=je.scrollTop(),r=je.get(0).clientHeight,s=he?he.outerHeight(!0):0;i+s+a>o+r?je.scrollTop(parseInt(i+s+a-r)):i<o&&je.scrollTop(i),p&&je.scrollLeft(0),n&&t.resources.blink(e,"lookme")}},ie=[],ae={},oe=function(e){for(var t=ie.length;t--;)if(ie[t].hash==e)return t;return-1},re=!1,se={disabled:!0,filter:"[id]:first",stop:te,delay:250,appendTo:"body",autoRefresh:!1,selected:function(t,n){e(n.selected).trigger(u)},unselected:function(t,n){e(n.unselected).trigger(h)}},le={},ce=function(a,o){if(ae.renderd){var r=(p?ze.find("tbody:first"):ze).children("[id]"+(n.oldSchool?":not(.elfinder-cwd-parent)":"")+":first");if(r.length){var s,l,c,d,u,h,f,m,g=ze.data("selectable"),y=(c=je.offset(),d=je.width(),u=e(window),h=r.width()/2,f=Math.min(c.left-u.scrollLeft()+("ltr"===t.direction?h:d-h),c.left+d-10),m=c.top-u.scrollTop()+10+(p?i:0),{left:Math.max(0,Math.round(f)),top:Math.max(0,Math.round(m))}),w=a?r:e(document.elementFromPoint(y.left,y.top)),x={},k={},$=Math.ceil((ae.hpi?Math.ceil(Fe.data("rectangle").height/ae.hpi*1.5):pe)/5),C=function(){var e,n,i;for(i=0;i<5&&((e=w.attr("id"))&&(ae.getTmbs=[],n=t.cwdId2Hash(e),le[n]=e,ae.attachTmbs[n]&&(k[n]=ae.attachTmbs[n]),g&&(x[e]=!0)),(w=w.next()).length);i++);},T=function(){var e;ze.data("selectable")&&(Object.assign(x,G),(e=Object.keys(x)).length&&(se.filter="#"+e.join(", #"),ze.selectable("enable").selectable("option",{filter:se.filter}).selectable("refresh"))),Object.keys(k).length&&(ae.getTmbs=[],ye(k))},z=function(){w.hasClass(v)||(w=w.closest(b))};if(le={},g&&ze.selectable("option","disabled"),w.length&&(w.hasClass(v)||w.closest(b).length||((l=t.getUI().find(".ui-dialog:visible,.ui-widget:visible")).length?(l.hide(),w=e(document.elementFromPoint(y.left,y.top)),l.show()):l=null),z(),w.length||(l&&l.hide(),w=e(document.elementFromPoint(y.left,y.top+5)),l&&l.show(),z())),w.length){if(w.attr("id"))if(a){for(var j=0;j<$&&(C(),w.length);j++);T()}else s=new Array($),ae.repaintJob=t.asyncJob(function(){C(),w.length||T()},s).done(T)}else a&&ae.renderd&&(o=o||0)<10&&requestAnimationFrame(function(){ce(a,++o)})}}},de=null,pe=t.options.showFiles,ue=function(){if(!(ae.rendering||ae.renderd&&!ie.length)){var i,a,o=p?ze.children("table").children("tbody"):ze,r=!!e.htmlPrefilter,s=e(r?document.createDocumentFragment():"<div/>"),l=function(n){var i,a,l,c=n||null,h=[],f=!1,m={},g="self"===t.option("tmbUrl"),v=!ae.renderd;i=ie.splice(0,pe+(c||0)/(ae.hpi||1)),ae.renderd+=i.length,ie.length||(Ae.hide(),je.off("elfscrstop",ue)),a=[],h=e.map(i,function(e){return e.hash&&e.name?("directory"==e.mime&&(f=!0),(e.tmb&&(1!=e.tmb||e.size>0)||g&&0===e.mime.indexOf("image/"))&&(m[e.hash]=e.tmb||"self"),I[e.hash]&&a.push(e.hash),V(e)):null}),s.empty().append(h.join("")),f&&!d&&be(s),l=[],Object.keys(G).length&&s.find("[id]:not(.ui-selected):not(.elfinder-cwd-parent)").each(function(){G[t.cwdId2Hash(this.id)]&&l.push(e(this))}),o.append(r?s:s.children()),l.length&&(e.each(l,function(e,t){t.trigger(u)}),te()),a.length&&t.trigger("lockfiles",{files:a}),!ae.hpi&&$e(o,i.length),p&&(ze.find("thead").show(),me({fitWidth:!R})),Object.keys(m).length&&Object.assign(ae.attachTmbs,m),v&&(d||ze.data("selectable")||ze.selectable(se).data("selectable",!0)),!re&&je.trigger("elfscrstop")};ae.renderd||(ae.rendering=!0,je.scrollTop(0),i=t.cwd().phash,l(),n.oldSchool&&(i&&!O?function(n){var i=t.cwd().phash,a=t.file(i)||null,o=function(n){n&&(de=e(V(e.extend(!0,{},n,{name:"..",i18:"..",mime:"directory"}))).addClass("elfinder-cwd-parent").on("dblclick",function(){t.trigger("select",{selected:[i]}).exec("open",i)}),(p?de.children("td:first"):de).children(".elfinder-cwd-select").remove(),t.cwdHash2Elm(i).length?t.cwdHash2Elm(i).replaceWith(de):(p?ze.find("tbody"):ze).prepend(de),t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1))};a?o(a):(o({hash:i,read:!0,write:!0}),t.getUI("tree").length?t.one("parents",function(){o(t.file(i)||null),je.trigger("elfscrstop")}):t.request({data:{cmd:"parents",target:t.cwd().hash},preventFail:!0}).done(function(e){o(t.file(i)||null),je.trigger("elfscrstop")}))}():de=e()),p&&(R&&ge(),me({fitWidth:!0})),ae.itemH=(p?o.find("tr:first"):o.find("[id]:first")).outerHeight(!0),t.trigger("cwdrender"),ae.rendering=!1,ce(!0)),!ae.rendering&&ie.length?(a=je.height()+je.scrollTop()+t.options.showThreshold+ae.row-ae.renderd*ae.hpi)>0?(ae.rendering=!0,t.lazy(function(){l(a),ae.rendering=!1})):!t.enabled()&&Me():Me()}},he=null,fe=t.UA.CSS.positionSticky&&t.UA.CSS.widthMaxContent,me=function(a){if(i=0,n.listView.fixedHeader){var o,r,s,l,c,d,p,u,h,f,m,g,v,b=function(){var e,n;n="ltr"===t.direction?"left":"right",e=-1*("ltr"===t.direction?je.scrollLeft():s.outerWidth(!0)-je.width()-je.scrollLeft()),r.css(n)!==e&&r.css(n,e)},y=a||{};if(c=ze.find("tbody"),(u=c.children("tr:first")).length&&u.is(":visible")){if(s=c.parent(),he?(l=e("#"+t.namespace+"-cwd-thead"),p=l.children("tr:first")):(v=!0,c.addClass("elfinder-cwd-fixheader"),l=ze.find("thead").attr("id",t.namespace+"-cwd-thead"),p=l.children("tr:first"),d=p.outerHeight(!0),ze.css("margin-top",d-parseInt(s.css("padding-top"))),fe?(he=e('<div class="elfinder-table-header-sticky"/>').addClass(ze.attr("class")).append(e("<table/>").append(l)),ze.after(he),je.on("resize.fixheader",function(e){e.stopPropagation(),me({fitWidth:!0})})):(r=e("<div/>").addClass(ze.attr("class")).append(e("<table/>").append(l)),he=e("<div/>").addClass(je.attr("class")+" elfinder-cwd-fixheader").removeClass("ui-droppable native-droppable").css(je.position()).css({height:d,width:ze.outerWidth()}).append(r),"rtl"===t.direction&&he.css("left",je.data("width")-je.width()+"px"),b(),je.after(he).on("scroll.fixheader resize.fixheader",function(e){b(),"resize"===e.type&&(e.stopPropagation(),he.css(je.position()),je.data("width",je.css("overflow","hidden").width()),je.css("overflow","auto"),me())}))),v||y.fitWidth||Math.abs(u.outerWidth()-p.outerWidth())>2){o=E.length+1;for(var w=0;w<o&&(h=p.children("td:eq("+w+")"),f=u.children("td:eq("+w+")"),m=h.width(),g=f.width(),void 0===h.data("delta")&&h.data("delta",h.outerWidth()-m-(f.outerWidth()-g)),g-=h.data("delta"),v||y.fitWidth||m!==g);w++)h.css("width",g+"px")}fe||(he.data("widthTimer")&&cancelAnimationFrame(he.data("widthTimer")),he.data("widthTimer",requestAnimationFrame(function(){he&&(he.css("width",Ee.width()+"px"),"rtl"===t.direction&&he.css("left",je.data("width")-je.width()+"px"))}))),i=l.height()}}},ge=function(){if(p&&R){var t="elfinder-cwd-colwidth",n=ze.find("tr[id]:first");n.hasClass(t)||(ze.find("tr."+t).removeClass(t).find("td").css("width",""),n.addClass(t),ze.find("table:first").css("table-layout","fixed"),e.each(e.merge(["name"],E),function(e,t){var i=R[t]||n.find("td.elfinder-col-"+t).width();n.find("td.elfinder-col-"+t).width(i)}))}},ve=Object.assign({},t.droppable,{over:function(n,i){var a,o,r,s=e(this),l=i.helper,c=n.shiftKey||n.ctrlKey||n.metaKey;n.stopPropagation(),l.data("dropover",l.data("dropover")+1),s.data("dropover",!0),l.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"),l.data("namespace")===t.namespace&&t.insideWorkzone(n.pageX,n.pageY)?(s.hasClass(t.res(g,"cwdfile"))?(a=t.cwdId2Hash(s.attr("id")),s.data("dropover",a)):(a=t.cwd().hash,t.cwd().write&&s.data("dropover",a)),r=t.file(l.data("files")[0]).phash===a,s.data("dropover")===a?e.each(l.data("files"),function(e,t){if(t===a||r&&!c&&!l.hasClass("elfinder-drag-helper-plus"))return s.removeClass(T),!1}):s.removeClass(T),l.data("locked")||r?o="elfinder-drag-helper-plus":(o="elfinder-drag-helper-move",c&&(o+=" elfinder-drag-helper-plus")),s.hasClass(T)&&l.addClass(o),requestAnimationFrame(function(){s.hasClass(T)&&l.addClass(o)})):s.removeClass(T)},out:function(t,n){var i=n.helper;t.stopPropagation(),i.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(i.data("dropover")-1,0)),e(this).removeData("dropover").removeClass(T)},deactivate:function(){e(this).removeData("dropover").removeClass(T)},drop:function(e,n){Z({notrigger:!0}),t.droppable.drop.call(this,e,n)}}),be=function(n){var i=(n=n||(p?ze.find("tbody"):ze)).children(".directory:not(."+k+",.elfinder-na,.elfinder-ro)");t.isCommandEnabled("paste")&&i.droppable(ve),t.isCommandEnabled("upload")&&i.addClass("native-droppable"),n.children(".isroot").each(function(n,i){var a=e(i),o=t.cwdId2Hash(i.id);t.isCommandEnabled("paste",o)?a.hasClass(k+",elfinder-na,elfinder-ro")||a.droppable(ve):a.hasClass(k)&&a.droppable("destroy"),t.isCommandEnabled("upload",o)?a.hasClass("native-droppable,elfinder-na,elfinder-ro")||a.addClass("native-droppable"):a.hasClass("native-droppable")&&a.removeClass("native-droppable")})},ye=function(n,i){e.isPlainObject(n)&&Object.keys(n).length&&(Object.assign(ae.attachTmbs,n),e.each(n,function(n,a){var o,r,s=t.cwdHash2Elm(n);s.length&&("1"!=a?((o=t.file(n)).tmb!==a&&(o.tmb=a),r=t.tmb(o),i?s.find(".elfinder-cwd-icon").addClass(r.className).css("background-image","url('"+r.url+"')"):function(t,n){e("<img/>").on("load",function(){t.find(".elfinder-cwd-icon").addClass(n.className).css("background-image","url('"+n.url+"')")}).attr("src",n.url)}(s,r),delete ae.attachTmbs[n]):i?we([n]):ae.tmbLoading[n]||ae.getTmbs.push(n))}),i||!ae.getTmbs.length||Object.keys(ae.tmbLoading).length||we())},we=function(n){var i=[],a=!1;t.oldAPI?t.request({data:{cmd:"tmb",current:t.cwd().hash},preventFail:!0}).done(function(e){e.images&&Object.keys(e.images).length&&ye(e.images),e.tmb&&we()}):(n?(a=!0,i=n.splice(0,A)):i=ae.getTmbs.splice(0,A),i.length&&(a||le[i[0]]||le[i[i.length-1]])&&(e.each(i,function(e,t){ae.tmbLoading[t]=!0}),t.request({data:{cmd:"tmb",targets:i},preventFail:!0}).done(function(t){var o,r=[];t.images&&((o=Object.keys(t.images).length)?(o<i.length&&e.each(i,function(e,n){t.images[n]||r.push(n)}),ye(t.images,a)):r=i,r.length&&e.each(r,function(e,t){delete ae.attachTmbs[t]})),a&&n.length&&we(n)}).always(function(){ae.tmbLoading={},!a&&ae.getTmbs.length&&we()})))},xe=function(n,i){var a,o,r,s,l,c,u=p?ze.find("tbody"):ze,h=n.length,f={},m=function(e){for(var n,i=ze.find("[id]:first");i.length;){if(n=t.file(t.cwdId2Hash(i.attr("id"))),!i.hasClass("elfinder-cwd-parent")&&n&&t.compare(e,n)<0)return i;i=i.next("[id]")}},g=function(e){var n,i=ie.length;for(n=0;n<i;n++)if(t.compare(e,ie[n])<0)return n;return i||-1},v=!!e.htmlPrefilter,b=e(v?document.createDocumentFragment():"<div/>");if(h>pe)Te(),G=t.arrayFlip(e.map(n,function(e){return e.hash}),!0),te();else{for(h&&Fe.removeClass("elfinder-cwd-wrapper-empty"),c="self"===t.option("tmbUrl");h--;)a=n[h],o=a.hash,t.cwdHash2Elm(o).length||((r=m(a))&&!r.length&&(r=null),!r&&(l=g(a))>=0?ie.splice(l,0,a):(b.empty().append(V(a)),"directory"===a.mime&&!d&&be(b),s=v?b:b.children(),r?r.before(s):u.append(s),++ae.renderd),t.cwdHash2Elm(o).length&&(a.tmb&&(1!=a.tmb||a.size>0)||c&&0===a.mime.indexOf("image/"))&&(f[o]=a.tmb||"self"));p&&(ge(),me({fitWidth:!R})),$e(u),Object.keys(f).length&&(Object.assign(ae.attachTmbs,f),ie.length<1&&we())}},ke=function(n){var i,a,o,r,s=n.length,l=t.searchStatus.state>1,c=t.getCommand(t.currentReqCmd)||{};if(!t.cwd().hash&&!c.noChangeDirOnRemovedCwd)return e.each(M.reverse(),function(e,n){if(t.file(n))return r=!0,t.one(t.currentReqCmd+"done",function(){!t.cwd().hash&&t.exec("open",n)}),!1}),void(!r&&!t.cwd().hash&&t.exec("open",t.roots[Object.keys(t.roots)[0]]));for(;s--;){if(i=n[s],(a=t.cwdHash2Elm(i)).length)try{a.remove(),--ae.renderd}catch(e){t.debug("error",e)}else-1!==(o=oe(i))&&ie.splice(o,1);G[i]&&delete G[i],l&&-1!==(o=e.inArray(i,S))&&S.splice(o,1)}l&&t.trigger("cwdhasheschange",S),p&&(ge(),me({fitWidth:!R}))},$e=function(e,n){var i,a=e||(p?ze.find("tbody"):ze),o=Pe[t.viewType],r=1;ie.length>0&&(ae.hpi?p||(r=Math.floor(a.width()/o.width)):(!function(e){var t,n;e.height||(t=p?ze.find("tbody"):ze,n=t.find(p?"tr:first":"[id]:first"),e.height=n.outerHeight(!0),p||(e.width=n.outerWidth(!0)))}(o),p?ae.row=ae.hpi=o.height:(r=Math.floor(a.width()/o.width),ae.row=o.height,ae.hpi=ae.row/r)),i=Math.ceil((ie.length+(n||0))/r),p&&he&&++i,Ae.css({top:ae.row*i+"px"}).show())},Ce={contextmenu:function(e){e.preventDefault(),void 0===ze.data("longtap")?t.trigger("contextmenu",{type:"cwd",targets:[t.cwd().hash],x:e.pageX,y:e.pageY}):e.stopPropagation()},touchstart:function(e){e.originalEvent.touches.length>1||(!1!==ze.data("longtap")&&(je.data("touching",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}),ze.data("tmlongtap",setTimeout(function(){ze.data("longtap",!0),t.trigger("contextmenu",{type:"cwd",targets:[t.cwd().hash],x:je.data("touching").x,y:je.data("touching").y})},500))),ze.data("longtap",null))},touchend:function(e){"touchmove"===e.type?(!je.data("touching")||Math.abs(je.data("touching").x-e.originalEvent.touches[0].pageX)+Math.abs(je.data("touching").y-e.originalEvent.touches[0].pageY)>4)&&je.data("touching",null):setTimeout(function(){ze.removeData("longtap")},80),clearTimeout(ze.data("tmlongtap"))},click:function(e){ze.data("longtap")&&(e.preventDefault(),e.stopPropagation())}},Te=function(){t.lazy(function(){var n;Fe.append(Oe).removeClass("elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result elfinder-letsearch-result"),(t.searchStatus.state>1||t.searchStatus.ininc)&&Fe.addClass("elfinder-search-result"+(t.searchStatus.ininc?" elfinder-"+("/"===O.substr(0,1)?"let":"inc")+"search-result":"")),ae.attachThumbJob&&ae.attachThumbJob._abort(),ze.data("selectable")&&ze.selectable("disable").selectable("destroy").removeData("selectable"),t.trigger("cwdinit"),K=e();try{ze.empty()}catch(e){ze.html("")}he&&(je.off("scroll.fixheader resize.fixheader"),he.remove(),he=null),ze.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(p?"list":"icons")).attr("style","").css("height","auto"),Ae.hide(),je[p?"addClass":"removeClass"]("elfinder-cwd-wrapper-list")._padding=parseInt(je.css("padding-top"))+parseInt(je.css("padding-bottom")),t.UA.iOS&&je.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"),p&&(ze.html("<table><thead/><tbody/></table>"),n=e('<tr class="ui-state-default"><td class="elfinder-cwd-view-th-name">'+t.getColumnName("name")+"</td>"+function(){for(var e="",n="",i=0;i<E.length;i++)e=t.getColumnName(E[i]),n+='<td class="elfinder-cwd-view-th-'+E[i]+' sortable-item">'+e+"</td>";return n}()+"</tr>"),ze.find("thead").hide().append(n).find("td:first").append(Oe),e.fn.sortable&&n.addClass("touch-punch touch-punch-keep-default").sortable({axis:"x",distance:8,items:"> .sortable-item",start:function(t,n){e(n.item[0]).data("dragging",!0),n.placeholder.width(n.helper.removeClass("ui-state-hover").width()).removeClass("ui-state-active").addClass("ui-state-hover").css("visibility","visible")},update:function(n,i){var a,o,r=e(i.item[0]).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");E=e.map(e(this).children(),function(t){var n=e(t).attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","");return o||(r===n?o=!0:a=n),"name"===n?null:n}),H.row=U(),t.storage("cwdCols",E),a=".elfinder-col-"+a+":first",r=".elfinder-col-"+r+":first",t.lazy(function(){ze.find("tbody tr").each(function(){var t=e(this);t.children(a).after(t.children(r))})})},stop:function(t,n){setTimeout(function(){e(n.item[0]).removeData("dragging")},100)}}),n.find("td").addClass("touch-punch").resizable({handles:"ltr"===t.direction?"e":"w",start:function(t,n){var i=ze.find("td.elfinder-col-"+n.element.attr("class").split(" ")[0].replace("elfinder-cwd-view-th-","")+":first");n.element.data("dragging",!0).data("resizeTarget",i).data("targetWidth",i.width()),q=!0,"fixed"!==ze.find("table").css("table-layout")&&(ze.find("tbody tr:first td").each(function(){e(this).width(e(this).width())}),ze.find("table").css("table-layout","fixed"))},resize:function(e,t){t.element.data("resizeTarget").width(t.element.data("targetWidth")-(t.originalSize.width-t.size.width))},stop:function(n,i){q=!1,me({fitWidth:!0}),R={},ze.find("tbody tr:first td").each(function(){var t=e(this).attr("class").split(" ")[0].replace("elfinder-col-","");R[t]=e(this).width()}),t.storage("cwdColWidth",R),setTimeout(function(){i.element.removeData("dragging")},100)}}).find(".ui-resizable-handle").addClass("ui-icon ui-icon-grip-dotted-vertical")),ie=e.map(F||S,function(e){return t.file(e)||null}),ie=t.sortFiles(ie),F?F=e.map(ie,function(e){return e.hash}):S=e.map(ie,function(e){return e.hash}),ae={renderd:0,attachTmbs:{},getTmbs:[],tmbLoading:{},lazyOpts:{tm:0}},Fe[ie.length<1?"addClass":"removeClass"]("elfinder-cwd-wrapper-empty"),je.off("elfscrstop",ue).on("elfscrstop",ue).trigger("elfscrstop"),t.cwd().write?(je[t.isCommandEnabled("upload")?"addClass":"removeClass"]("native-droppable"),je.droppable(t.isCommandEnabled("paste")?"enable":"disable")):je.removeClass("native-droppable").droppable("disable").removeClass("ui-state-disabled")})},ze=e(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").on("click."+t.namespace,b,function(n){var i,a,o,r,s,l=this.id?e(this):e(this).parents("[id]:first"),c=e(n.target);if(P&&(c.is("input:checkbox."+j)||c.hasClass("elfinder-cwd-select")))return n.stopPropagation(),n.preventDefault(),l.trigger(l.hasClass(y)?h:u),te(),void requestAnimationFrame(function(){c.prop("checked",l.hasClass(y))});if(ze.data("longtap")||c.hasClass("elfinder-cwd-nonselect"))n.stopPropagation();else{if(D||(D=l.attr("id"),setTimeout(function(){D=""},500)),n.shiftKey&&(i=l.prevAll(ee||".ui-selected:first"),a=l.nextAll(ee||".ui-selected:first"),o=i.length,r=a.length),n.shiftKey&&(o||r))s=(s=o?l.prevUntil("#"+i.attr("id")):l.nextUntil("#"+a.attr("id"))).add(l),o||(s=e(s.get().reverse())),s.trigger(u);else if(n.ctrlKey||n.metaKey)l.trigger(l.hasClass(y)?h:u);else{if(je.data("touching")&&l.hasClass(y))return je.data("touching",null),void t.dblclick({file:t.cwdId2Hash(this.id)});Z({notrigger:!0}),l.trigger(u)}te()}}).on("dblclick."+t.namespace,b,function(n){if(D){var i=t.cwdId2Hash(D);n.stopPropagation(),this.id!==D&&(e(this).trigger(h),e("#"+D).trigger(u),te()),t.dblclick({file:i})}}).on("touchstart."+t.namespace,b,function(n){if(!(n.originalEvent.touches.length>1)){var i=this.id?e(this):e(this).parents("[id]:first"),a=e(n.target),o=n.target.nodeName;if("INPUT"===o&&"text"===n.target.type||"TEXTAREA"===o||a.hasClass("elfinder-cwd-nonselect"))n.stopPropagation();else{if(i.find("input:text,textarea").length)return n.stopPropagation(),void n.preventDefault();je.data("touching",{x:n.originalEvent.touches[0].pageX,y:n.originalEvent.touches[0].pageY}),P&&(a.is("input:checkbox."+j)||a.hasClass("elfinder-cwd-select"))||(i.prevAll(".ui-selected:first").length+i.nextAll(".ui-selected:first").length,ze.data("longtap",null),(Object.keys(G).length||p&&"TD"!==n.target.nodeName||!p&&this!==n.target)&&(ze.data("longtap",!1),i.addClass($),i.data("tmlongtap",setTimeout(function(){ze.data("longtap",!0),i.trigger(u),te(),t.trigger("contextmenu",{type:"files",targets:t.selected(),x:n.originalEvent.touches[0].pageX,y:n.originalEvent.touches[0].pageY})},500))))}}}).on("touchmove."+t.namespace+" touchend."+t.namespace,b,function(n){var i,a=e(n.target);P&&(a.is("input:checkbox."+j)||a.hasClass("elfinder-cwd-select"))||("INPUT"!=n.target.nodeName&&"TEXTAREA"!=n.target.nodeName?(i=this.id?e(this):e(this).parents("[id]:first"),clearTimeout(i.data("tmlongtap")),"touchmove"===n.type?(je.data("touching",null),i.removeClass($)):(je.data("touching")&&!ze.data("longtap")&&i.hasClass(y)&&(n.preventDefault(),je.data("touching",null),t.dblclick({file:t.cwdId2Hash(this.id)})),setTimeout(function(){ze.removeData("longtap")},80))):n.stopPropagation())}).on("mouseenter."+t.namespace,b,function(i){if(!re){var a=e(this),o=null;if(!(d||a.data("dragRegisted")||a.hasClass(z)||a.hasClass(x)||a.hasClass(w))){if(a.data("dragRegisted",!0),!t.isCommandEnabled("copy",t.searchStatus.state>1||a.hasClass("isroot")?t.cwdId2Hash(a.attr("id")):void 0))return;a.on("mousedown",function(i){var o=n.metakeyDragout&&!t.UA.IE&&(i.shiftKey||i.altKey),r=!1;o&&ze.data("selectable")&&(ze.selectable("disable").selectable("destroy").removeData("selectable"),requestAnimationFrame(function(){ze.selectable(se).selectable("option",{disabled:!1}).selectable("refresh").data("selectable",!0)})),a.removeClass("ui-state-disabled"),o?a.draggable("option","disabled",!0).attr("draggable","true"):(a.hasClass(y)||(r=p?e(i.target).closest("span,tr").is("tr"):e(i.target).hasClass("elfinder-cwd-file")),r?a.draggable("option","disabled",!0).removeClass("ui-state-disabled"):a.draggable("option","disabled",!1).removeAttr("draggable").draggable("option","cursorAt",{left:50-parseInt(e(i.currentTarget).css("margin-left")),top:47}))}).on("dragstart",function(n){var i=n.dataTransfer||n.originalEvent.dataTransfer||null;if(o=null,i&&!t.UA.IE){var a,r=this.id?e(this):e(this).parents("[id]:first"),s=e("<span>"),l="",c=null,d=null,p=[],h=function(n){var i,a=n.mime,o=t.tmb(n);return i='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+t.mime2class(a)+' ui-corner-all"/>',o&&(i=e(i).addClass(o.className).css("background-image","url('"+o.url+"')").get(0).outerHTML),i},f=[];if(r.trigger(u),te(),e.each(G,function(n){var i=t.file(n),a=i.url;if(i&&"directory"!==i.mime){if(a){if("1"==a)return f.push(n),!0}else a=t.url(i.hash);a&&(a=t.convAbsUrl(a),p.push(n),e("<a>").attr("href",a).text(a).appendTo(s),l+=a+"\n",c||(c=i.mime+":"+i.name+":"+a),d||(d=a+"\n"+i.name))}}),f.length)return e.each(f,function(e,n){var i=t.file(n);i.url="",t.request({data:{cmd:"url",target:n},notify:{type:"url",cnt:1},preventDefault:!0}).always(function(e){i.url=e.url?e.url:"1"})}),!1;if(!l)return!1;i.setDragImage&&(o=e('<div class="elfinder-drag-helper html5-native"></div>').append(h(t.file(p[0]))).appendTo(e(document.body)),(a=p.length)>1&&o.append(h(t.file(p[a-1]))+'<span class="elfinder-drag-num">'+a+"</span>"),i.setDragImage(o.get(0),50,47)),i.effectAllowed="copyLink",i.setData("DownloadURL",c),i.setData("text/x-moz-url",d),i.setData("text/uri-list",l),i.setData("text/plain",l),i.setData("text/html",s.html()),i.setData("elfinderfrom",window.location.href+t.cwd().hash),i.setData("elfinderfrom:"+i.getData("elfinderfrom"),"")}}).on("dragend",function(e){Z({notrigger:!0}),o&&o.remove()}).draggable(t.draggable)}}}).on(u,b,function(n){var i=e(this),a=t.cwdId2Hash(i.attr("id"));X||i.hasClass(w)||(ee="#"+this.id,i.addClass(y).children().addClass($).find("input:checkbox."+j).prop("checked",!0),G[a]||(G[a]=!0),K=ze.find("[id].ui-selected:last").next())}).on(h,b,function(n){var i=e(this),a=t.cwdId2Hash(i.attr("id"));X||(i.removeClass(y).children().removeClass($).find("input:checkbox."+j).prop("checked",!1),ze.hasClass("elfinder-cwd-allselected")&&(P&&Oe.children("input").prop("checked",!1),ze.removeClass("elfinder-cwd-allselected")),G[a]&&delete G[a])}).on(f,b,function(){var t=e(this).removeClass($+" "+y).addClass(w),n=t.children(),i=p?t:n.find("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");n.removeClass($+" "+y),t.hasClass(k)&&t.droppable("disable"),i.hasClass(x)&&i.draggable("disable")}).on(m,b,function(){var t=e(this).removeClass(w),n=p?t:t.children("div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename");t.hasClass(k)&&t.droppable("enable"),n.hasClass(x)&&n.draggable("enable")}).on("scrolltoview",b,function(t,n){ne(e(this),!n||void 0===n.blink||n.blink)}).on("mouseenter."+t.namespace+" mouseleave."+t.namespace,b,function(n){var i="mouseenter"===n.type;i&&(re||t.UA.Mobile)||(t.trigger("hover",{hash:t.cwdId2Hash(e(this).attr("id")),type:n.type}),e(this).toggleClass($,"mouseenter"==n.type))}).on("mouseenter."+t.namespace+" mouseleave."+t.namespace,".elfinder-cwd-file-wrapper,.elfinder-cwd-filename",function(t){var n="mouseenter"===t.type;n&&re||e(this).closest(b).children(".elfinder-cwd-file-wrapper,.elfinder-cwd-filename").toggleClass(C,"mouseenter"==t.type)}).on("contextmenu."+t.namespace,function(n){var i=e(n.target).closest(b);(i.get(0)!==n.target||G[t.cwdId2Hash(i.get(0).id)])&&(i.find("input:text,textarea").length?n.stopPropagation():i.length&&("TD"!=n.target.nodeName||G[t.cwdId2Hash(i.get(0).id)])&&(n.stopPropagation(),n.preventDefault(),i.hasClass(w)||je.data("touching")||(i.hasClass(y)||(Z({notrigger:!0}),i.trigger(u),te()),t.trigger("contextmenu",{type:"files",targets:t.selected(),x:n.pageX,y:n.pageY}))))}).on("click."+t.namespace,function(e){e.target!==this||ze.data("longtap")||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&Z()}).on("create."+t.namespace,function(n,i){var a=p?ze.find("tbody"):ze,o=a.find(".elfinder-cwd-parent"),r=i.move||!1,s=e(V(i)).addClass(z),l=t.selected();l.length?r&&t.trigger("lockfiles",{files:l}):Z(),o.length?o.after(s):a.prepend(s),ge(),je.scrollTop(0).scrollLeft(0)}).on("unselectall",Z).on("selectfile",function(e,n){t.cwdHash2Elm(n).trigger(u),te()}).on("colwidth",function(){p&&(ze.find("table").css("table-layout","").find("td").css("width",""),me({fitWidth:!0}),t.storage("cwdColWidth",R=null))}).on("iconpref",function(e,t){ze.removeClass(function(e,t){return(t.match(/\belfinder-cwd-size\S+/g)||[]).join(" ")}),s=t&&parseInt(t.size)||0,p||(s>0&&ze.addClass("elfinder-cwd-size"+s),ae.renderd&&requestAnimationFrame(function(){Pe.icons={},ae.hpi=null,$e(ze,ae.renderd),ce()}))}).on("onwheel"in document?"wheel":"mousewheel",function(e){var i,a;!p&&(e.ctrlKey&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&(e.stopPropagation(),e.preventDefault(),void 0!==(i=ze.data("wheelTm"))?(clearTimeout(i),ze.data("wheelTm",setTimeout(function(){ze.removeData("wheelTm")},200))):(ze.data("wheelTm",!1),a=s||0,(e.originalEvent.deltaY?e.originalEvent.deltaY:-e.originalEvent.wheelDelta)>0?s>0&&(a=s-1):s<n.iconsView.sizeMax&&(a=s+1),a!==s&&(t.storage("iconsize",a),ze.trigger("iconpref",{size:a}))))}),je=e('<div class="elfinder-cwd-wrapper"/>').droppable(Object.assign({},ve,{autoDisable:!1})).on("contextmenu."+t.namespace,Ce.contextmenu).on("touchstart."+t.namespace,Ce.touchstart).on("touchmove."+t.namespace+" touchend."+t.namespace,Ce.touchend).on("click."+t.namespace,Ce.click).on("scroll."+t.namespace,function(){re||(ze.data("selectable")&&ze.selectable("disable"),je.trigger("elfscrstart")),re=!0,ae.scrtm&&cancelAnimationFrame(ae.scrtm),ae.scrtm&&Math.abs((ae.scrolltop||0)-(ae.scrolltop=this.scrollTop||e(this).scrollTop()))<5&&(ae.scrtm=0,je.trigger("elfscrstop")),ae.scrtm=requestAnimationFrame(function(){ae.scrtm=0,je.trigger("elfscrstop")})}).on("elfscrstop",function(){re=!1,ce()}),Ae=e("<div>&nbsp;</div>").css({position:"absolute",width:"1px",height:"1px"}).hide(),Oe=P?e('<div class="elfinder-cwd-selectall"><input type="checkbox"/></div>').attr("title",t.i18n("selectall")).on("touchstart mousedown click",function(t){if(t.stopPropagation(),t.preventDefault(),e(this).data("pending")||"click"===t.type)return!1;Oe.data("pending",!0),ze.hasClass("elfinder-cwd-allselected")?(Oe.find("input").prop("checked",!1),requestAnimationFrame(function(){Z()})):Q()}):e(),Ie=null,Me=function(t){var n=function(){if(void 0!==ae.renderd){var t=0;je.siblings("div.elfinder-panel:visible").each(function(){t+=e(this).outerHeight(!0)}),je.height(Fe.height()-t-je._padding)}};t&&n(),Ie&&cancelAnimationFrame(Ie),Ie=requestAnimationFrame(function(){var e;!t&&n(),ze.css("height","auto"),e=je[0].clientHeight-parseInt(je.css("padding-top"))-parseInt(je.css("padding-bottom"))-parseInt(ze.css("margin-top")),ze.outerHeight(!0)<e&&ze.height(e)}),p&&!q&&(t?je.trigger("resize.fixheader"):me()),ce()},Se=e(this).parent().on("resize",Me),Fe=Se.children(".elfinder-workzone").append(je.append(this).append(Ae)),Ee=e('<div class="elfinder-cwd-message-board"/>').insertAfter(ze),De=e('<div class="elfinder-cwd-expires" />'),Ue=function(){var e,n,i;o&&clearTimeout(o),l&&t.volumeExpires[l]&&(n=t.volumeExpires[l]-+new Date/1e3,i=n%60+.1,e=Math.floor(n/60),De.html(t.i18n(["minsLeft",e])).show(),e&&(o=setTimeout(Ue,1e3*i)))},Pe={icons:{},list:{}};t.UA.ltIE10||Ee.append(e('<div class="elfinder-cwd-trash" />').html(t.i18n("volume_Trash"))).append(De),B=Object.assign(B,n.replacement||{});try{R=t.storage("cwdColWidth")?t.storage("cwdColWidth"):null}catch(e){R=null}t.bind("columnpref",function(i){var a=i.data||{};(E=t.storage("cwdCols"))?(E=e.grep(E,function(e){return-1!==n.listView.columns.indexOf(e)}),n.listView.columns.length>E.length&&e.each(n.listView.columns,function(e,t){-1===E.indexOf(t)&&E.push(t)})):E=n.listView.columns;var o=t.storage("columnhides")||null;o&&Object.keys(o).length&&(E=e.grep(E,function(e){return!o[e]})),H.row=U(),p&&a.repaint&&Te()}).trigger("columnpref"),d&&e("body").on("touchstart touchmove touchend",function(e){}),P&&ze.addClass("elfinder-has-checkbox"),e(window).on("scroll."+t.namespace,function(){c&&cancelAnimationFrame(c),c=requestAnimationFrame(function(){je.trigger("elfscrstop")})}),e(document).on("keydown."+t.namespace,function(n){n.keyCode==e.ui.keyCode.ESCAPE&&(t.getUI().find(".ui-widget:visible").length||Z())}),t.one("init",function(){var i,a,o,s,l=document.createElement("style"),c=0;document.head&&(document.head.appendChild(l),(i=l.sheet).insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyFolder")+'" }',c++),i.insertRule('.elfinder-cwd-wrapper-empty .native-droppable .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyFolder"+(d?"LTap":"Drop"))+'" }',c++),i.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyFolder")+'" }',c++),i.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptySearch")+'" }',c++),i.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyIncSearch")+'" }',c++),i.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-letsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:"'+t.i18n("emptyLetSearch")+'" }',c++)),(s=t.storage("iconsize")||n.iconsView.size||0)&&(s=Math.min(s,n.iconsView.sizeMax),ze.trigger("iconpref",{size:s})),d||(t.one("open",function(){i&&t.zIndex&&i.insertRule(".ui-selectable-helper{z-index:"+t.zIndex+";}",c++)}),o=e('<div style="position:absolute"/>'),(a=t.getUI()).on("resize",function(e,t){var n;e.preventDefault(),e.stopPropagation(),t&&t.fullscreen&&(n=a.offset(),"on"===t.fullscreen?(o.css({top:-1*n.top,left:-1*n.left}).appendTo(a),se.appendTo=o):(o.detach(),se.appendTo="body"),ze.data("selectable")&&ze.selectable("option",{appendTo:se.appendTo}))})),r=t.getUI("tree").length}).bind("enable",function(){Me()}).bind("request.open",function(){ae.getTmbs=[]}).one("open",function(){t.maxTargets&&(A=Math.min(t.maxTargets,A))}).bind("open add remove searchend",function(){var n,i=t.cwd().hash,a=this.type;if(("open"===a||"searchend"===a||t.searchStatus.state<2)&&(S=e.map(t.files(i),function(e){return e.hash}),t.trigger("cwdhasheschange",S)),"open"===a){var o=i&&(!t.file(i)||r)?r?(n=e.Deferred(),t.one("treesync",function(e){e.data.always(function(){n.resolve()})}),n):t.request({data:{cmd:"parents",target:t.cwd().hash},preventFail:!0}):null,s=t.cwd();s.volumeid!==l&&(De.empty().hide(),l&&je.removeClass("elfinder-cwd-wrapper-"+l),l=s.volumeid,Ue(),je.addClass("elfinder-cwd-wrapper-"+l)),e.when(o).done(function(){var n;M=t.parents(s.hash),je[(n=!1,e.each(M,function(e,i){if(t.trashes[i])return n=!0,!1}),n?"addClass":"removeClass")]("elfinder-cwd-wrapper-trash")}),F=void 0,Z({notrigger:!0}),Te()}}).bind("search",function(n){S=e.map(n.data.files,function(e){return e.hash}),t.trigger("cwdhasheschange",S),F=void 0,t.searchStatus.ininc=!1,Te(),t.autoSync("stop")}).bind("searchend",function(e){(O||F)&&(O="",F?t.trigger("incsearchend",e.data):e.data&&e.data.noupdate||Te()),t.autoSync()}).bind("searchstart",function(e){Z(),O=e.data.query}).bind("incsearchstart",function(n){var i=n.data.query||"",a=n.data.type||"SearchName",o=t.options.commandsOptions.search.searchTypes||{};(o[a]&&o[a].incsearch||"SearchName"===a)&&(G={},t.lazy(function(){var n,r,s="";if(O=i,i){if("/"===i.substr(0,1)&&(i=i.substr(1),s="^"),n=new RegExp(s+i.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"),"SearchName"===a)F=e.grep(S,function(e){var i=t.file(e);return!(!i||!(i.name.match(n)||i.i18&&i.i18.match(n)))});else if("string"==typeof(r=o[a].incsearch))F=e.grep(S,function(e){var i=t.file(e);return!!(i&&i[r]&&(i[r]+"").match(n))});else if("function"==typeof r)try{F=e.grep(r({val:i,regex:n},S,t),function(e){return!!t.file(e)})}catch(e){F=[]}t.trigger("incsearch",{hashes:F,query:i}).searchStatus.ininc=!0,Te(),t.autoSync("stop")}else t.trigger("incsearchend")}))}).bind("incsearchend",function(e){O="",t.searchStatus.ininc=!1,F=void 0,e.data&&e.data.noupdate||Te(),t.autoSync()}).bind("sortchange",function(){var e=je.scrollLeft(),n=ze.hasClass("elfinder-cwd-allselected");Te(),t.one("cwdrender",function(){je.scrollLeft(e),n&&(G=t.arrayFlip(F||S,!0)),(n||Object.keys(G).length)&&te()})}).bind("viewchange",function(){var e="list"!=t.viewType,n=ze.hasClass("elfinder-cwd-allselected");e!=p&&(p=e,t.viewType=p?"list":"icons",s&&t.one("cwdinit",function(){ze.trigger("iconpref",{size:s})}),Te(),Me(),n&&(ze.addClass("elfinder-cwd-allselected"),Oe.find("input").prop("checked",!0)),Object.keys(G).length&&te())}).bind("wzresize",function(){var e,n=p?ze.find("tbody"):ze;Me(!0),ae.hpi&&$e(n,n.find("[id]").length),e=ze.offset(),Fe.data("rectangle",Object.assign({width:Fe.width(),height:Fe.height(),cwdEdge:"ltr"===t.direction?e.left:e.left+ze.width()},Fe.offset())),ae.itemH=(p?n.find("tr:first"):n.find("[id]:first")).outerHeight(!0)}).bind("changeclipboard",function(t){I={},t.data&&t.data.clipboard&&t.data.clipboard.length&&e.each(t.data.clipboard,function(e,t){t.cut&&(I[t.hash]=!0)})}).bind("resMixinMake",function(){ge()}).bind("tmbreload",function(t){var n={},i=t.data&&t.data.files?t.data.files:null;e.each(i,function(e,t){t.tmb&&"1"!=t.tmb&&(n[t.hash]=t.tmb)}),Object.keys(n).length&&ye(n,!0)}).add(function(n){var i=O?new RegExp(O.replace(/([\\*\;\.\?\[\]\{\}\(\)\^\$\-\|])/g,"\\$1"),"i"):null,a=t.searchStatus.mime,o=t.searchStatus.state>1,r=o&&t.searchStatus.target?t.searchStatus.target:t.cwd().hash,s=t.path(r),l=e.grep(n.data.added||[],function(n){return!!function(n){var l,c;!(l=n.phash===r)&&o&&(c=n.path||t.path(n.hash),!(l=s&&0===c.indexOf(s))&&t.searchStatus.mixed&&(l=!!e.grep(t.searchStatus.mixed,function(e){return 0===n.hash.indexOf(e)}).length));l&&o&&(l=a?0===n.mime.indexOf(a):!!(n.name.match(i)||n.i18&&n.i18.match(i)));return l}(n)});xe(l),2===t.searchStatus.state&&(e.each(l,function(t,n){-1===e.inArray(n.hash,S)&&S.push(n.hash)}),t.trigger("cwdhasheschange",S)),p&&Me(),je.trigger("elfscrstop")}).change(function(n){var i,a=t.cwd().hash,o=t.selected();O?e.each(n.data.changed||[],function(n,a){t.cwdHash2Elm(a.hash).length&&(ke([a.hash]),xe([a],"change"),-1!==e.inArray(a.hash,o)&&J(a.hash),i=!0)}):e.each(e.grep(n.data.changed||[],function(e){return e.phash==a}),function(n,a){t.cwdHash2Elm(a.hash).length&&(ke([a.hash]),xe([a],"change"),-1!==e.inArray(a.hash,o)&&J(a.hash),i=!0)}),i&&(t.trigger("cwdhasheschange",S),p&&Me(),je.trigger("elfscrstop")),te()}).remove(function(e){var t=p?ze.find("tbody"):ze;ke(e.data.removed||[]),te(),ie.length<1&&t.children(b+(n.oldSchool?":not(.elfinder-cwd-parent)":"")).length<1?(Fe.addClass("elfinder-cwd-wrapper-empty"),P&&Oe.find("input").prop("checked",!1),Ae.hide(),je.off("elfscrstop",ue),Me()):($e(t),je.trigger("elfscrstop"))}).dragstart(function(t){var n=e(t.data.target),i=t.data.originalEvent;n.hasClass(v)&&(n.hasClass(y)||(!(i.ctrlKey||i.metaKey||i.shiftKey)&&Z({notrigger:!0}),n.trigger(u),te())),ze.removeClass(w).data("selectable")&&ze.selectable("disable"),X=!0}).dragstop(function(){ze.data("selectable")&&ze.selectable("enable"),X=!1}).bind("lockfiles unlockfiles selectfiles unselectfiles",function(n){var i,a,o,r={lockfiles:f,unlockfiles:m,selectfiles:u,unselectfiles:h},s=r[n.type],l=n.data.files||[],c=l.length,d=n.data.helper||e();if(c>0&&(i=t.parents(l[0])),s!==u&&s!==h||(o=s===u,e.each(l,function(e,t){var n=ze.hasClass("elfinder-cwd-allselected");G[t]?(n&&(P&&Oe.children("input").prop("checked",!1),ze.removeClass("elfinder-cwd-allselected"),n=!1),!o&&delete G[t]):o&&(G[t]=!0)})),!d.data("locked")){for(;c--;)try{t.cwdHash2Elm(l[c]).trigger(s)}catch(n){}!n.data.inselect&&te()}je.data("dropover")&&-1!==i.indexOf(je.data("dropover"))&&(a="lockfiles"!==n.type,d.toggleClass("elfinder-drag-helper-plus",a),je.toggleClass(T,a))}).bind("mkdir mkfile duplicate upload rename archive extract paste multiupload",function(n){if("upload"!=n.type||!n.data._multiupload){var i=t.cwd().hash;Z({notrigger:!0}),e.each((n.data.added||[]).concat(n.data.changed||[]),function(e,t){t&&t.phash==i&&J(t.hash)}),te()}}).shortcut({pattern:"ctrl+a",description:"selectall",callback:Q}).shortcut({pattern:"ctrl+shift+i",description:"selectinvert",callback:function(){var n={};Y?Z():Object.keys(G).length?(e.each(F||S,function(e,i){var a=t.cwdHash2Elm(i);G[i]?a.length&&a.trigger(h):(n[i]=!0,a.length&&a.trigger(u))}),G=n,te()):Q()}}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(t){!function(t,n){var i,a,o,r,s,l=e.ui.keyCode,c=t==l.LEFT||t==l.UP,d=ze.find("[id].ui-selected");function f(e,t){return e[t+"All"]("[id]:not(."+w+"):not(.elfinder-cwd-parent):first")}if(d.length)if(i=d.filter(c?":first":":last"),(o=f(i,c?"prev":"next")).length)if(p||t==l.LEFT||t==l.RIGHT)a=o;else if(r=i.position().top,s=i.position().left,a=i,c){do{a=a.prev("[id]")}while(a.length&&!(a.position().top<r&&a.position().left<=s));a.hasClass(w)&&(a=f(a,"next"))}else{do{a=a.next("[id]")}while(a.length&&!(a.position().top>r&&a.position().left>=s));a.hasClass(w)&&(a=f(a,"prev")),a.length||(o=ze.find("[id]:not(."+w+"):last")).position().top>r&&(a=o)}else a=i;else a=K.length?c?K.prev():K:ze.find("[id]:not(."+w+"):not(.elfinder-cwd-parent):"+(c?"last":"first"));a&&a.length&&!a.hasClass("elfinder-cwd-parent")&&(i&&n?a=i.add(i[c?"prevUntil":"nextUntil"]("#"+a.attr("id"))).add(a):d.trigger(h),a.trigger(u),ne(a.filter(c?":first":":last")),te())}(t.keyCode,t.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(e){Z({notrigger:!0}),ne(ze.find("[id]:first").trigger(u)),te()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(e){Z({notrigger:!0}),ne(ze.find("[id]:last").trigger(u)),te()}}).shortcut({pattern:"page_up",description:"pageTurning",callback:function(e){ae.itemH&&je.scrollTop(Math.round(je.scrollTop()-Math.floor((je.height()+(p?-1*ae.itemH:16))/ae.itemH)*ae.itemH))}}).shortcut({pattern:"page_down",description:"pageTurning",callback:function(e){ae.itemH&&je.scrollTop(Math.round(je.scrollTop()+Math.floor((je.height()+(p?-1*ae.itemH:16))/ae.itemH)*ae.itemH))}})}),this}}),e("skylark-elfinder/ui/dialog",["skylark-jquery"],function(e){e.fn.elfinderdialog=function(t,n){"use strict";var i,a,o,r,s=-1!=window.navigator.platform.indexOf("Win"),l={},c={enabled:!1,width:!1,height:!1,defaultSize:null},d=function(t){var i,a;c.enabled&&(a=n.options.dialogContained?o:e(window),i={maxWidth:c.width?a.width()-l.width:null,maxHeight:c.height?a.height()-l.height:null},Object.assign(r,i),t.css(i).trigger("resize"),t.data("hasResizable")&&(t.resizable("option","maxWidth")<i.maxWidth||t.resizable("option","maxHeight")<i.maxHeight)&&t.resizable("option",i))},p=function(e){var t=e.data;i&&cancelAnimationFrame(i),i=requestAnimationFrame(function(){c.enabled&&d(t)})},u=function(){var e=o.children(".elfinder-dialog."+n.res("class","editing")+":visible");n[e.length?"disable":"enable"]()},h={};return n&&n.ui?o=n.getUI():(o=this.closest(".elfinder"),n||(n=o.elfinder("instance"))),"string"==typeof t?((a=this.closest(".ui-dialog")).length&&("open"===t?"none"===a.css("display")&&(a.trigger("posinit").show().trigger("open").hide(),a.fadeIn(120,function(){n.trigger("dialogopened",{dialog:a})})):"close"===t||"destroy"===t?(a.stop(!0),(a.is(":visible")||o.is(":hidden"))&&(a.trigger("close"),n.trigger("dialogclosed",{dialog:a})),"destroy"===t?(a.remove(),n.trigger("dialogremoved",{dialog:a})):a.data("minimized")&&a.data("minimized").close()):"toTop"===t?(a.trigger("totop"),n.trigger("dialogtotoped",{dialog:a})):"posInit"===t?(a.trigger("posinit"),n.trigger("dialogposinited",{dialog:a})):"tabstopsInit"===t?(a.trigger("tabstopsInit"),n.trigger("dialogtabstopsinited",{dialog:a})):"checkEditing"===t&&u()),this):((t=Object.assign({},e.fn.elfinderdialog.defaults,t)).allowMinimize&&"auto"===t.allowMinimize&&(t.allowMinimize=!!this.find("textarea,input").length),t.openMaximized=t.allowMinimize&&t.openMaximized,t.headerBtnPos&&"auto"===t.headerBtnPos&&(t.headerBtnPos=s?"right":"left"),t.headerBtnOrder&&"auto"===t.headerBtnOrder&&(t.headerBtnOrder=s?"close:maximize:minimize":"close:minimize:maximize"),t.modal&&t.allowMinimize&&(t.allowMinimize=!1),n.options.dialogContained?c.width=c.height=c.enabled=!0:(c.width="window"===t.maxWidth,c.height="window"===t.maxHeight,(c.width||c.height)&&(c.enabled=!0)),h=n.arrayFlip(t.propagationEvents,!0),this.filter(":not(.ui-dialog-content)").each(function(){var i,a,f=e(this).addClass("ui-dialog-content ui-widget-content"),m="elfinder-dialog",g="ui-state-hover",v="elfinder-tabstop",b=parseInt(1e6*Math.random()),y=e('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"><span class="elfinder-dialog-title">'+t.title+"</span></div>"),w=e('<div class="ui-dialog-buttonset"/>'),x=e('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(w),k=0,$=0,C=e(),T=e('<div style="width:100%;height:100%;position:absolute;top:0px;left:0px;"/>').hide(),z=function(){(C=O.find("."+v)).length&&(C.attr("tabindex","-1"),C.filter(".elfinder-focus").length||w.children("."+v+":"+(s?"first":"last")).addClass("elfinder-focus"))},j=function(t){var n=C.filter(":visible:enabled"),i=t?null:n.filter(".elfinder-focus:first");return i&&i.length||(i=n.first()),t&&e.each(n,function(e,a){if(a===t&&n[e+1])return i=n.eq(e+1),!1}),i},A={close:function(){y.prepend(e('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"/></span>').on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),f.elfinderdialog("close")}))},maximize:function(){t.allowMaximize&&(O.on("resize",function(e,t){var n,i;if(e.preventDefault(),e.stopPropagation(),t&&t.maximize){if(i=y.find(".elfinder-titlebar-full"),n="on"===t.maximize,i.children("span.ui-icon").toggleClass("ui-icon-plusthick",!n).toggleClass("ui-icon-arrowreturnthick-1-s",n),n){try{O.hasClass("ui-draggable")&&O.draggable("disable"),O.hasClass("ui-resizable")&&O.resizable("disable")}catch(e){}f.css("width","100%").css("height",O.height()-O.children(".ui-dialog-titlebar").outerHeight(!0)-x.outerHeight(!0))}else{f.attr("style",i.data("style")),i.removeData("style"),I();try{O.hasClass("ui-draggable")&&O.draggable("enable"),O.hasClass("ui-resizable")&&O.resizable("enable")}catch(e){}}O.trigger("resize",{init:!0})}}),y.prepend(e('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"/></span>').on("mousedown",function(i){var a=e(this);i.preventDefault(),i.stopPropagation(),O.hasClass("elfinder-maximized")||void 0!==a.data("style")||(f.height(f.height()),a.data("style",f.attr("style")||"")),n.toggleMaximize(O),"function"==typeof t.maximize&&t.maximize.call(f[0])})))},minimize:function(){var i,a,o;t.allowMinimize&&(i=e('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"/></span>').on("mousedown",function(i){var r=e(this),s=n.getUI("bottomtray"),l={width:70,height:24},c=e("<div/>").css(l).addClass(O.get(0).className+" elfinder-dialog-minimized"),d=function(){a.remove(),O.removeData("minimized").show(),f.elfinderdialog("close")},p={};i.preventDefault(),i.stopPropagation(),O.data("minimized")?(O.removeData("minimized").before(a.css(Object.assign({position:"absolute"},a.offset()))),n.toFront(a),a.animate(Object.assign({width:O.width(),height:O.height()},o),function(){O.show(),n.toFront(O),a.remove(),I(),u(),O.trigger("resize",{init:!0}),"function"==typeof t.minimize&&t.minimize.call(f[0])})):(o=O.data("minimized",{dialog:function(){return a},show:function(){a.show()},hide:function(){a.hide()},close:d,title:function(e){a.children(".ui-dialog-titlebar").children(".elfinder-dialog-title").text(e)}}).position(),a=O.clone().on("mousedown",function(){r.trigger("mousedown")}).removeClass("ui-draggable ui-resizable elfinder-frontmost"),s.append(c),Object.assign(p,c.offset(),l),c.remove(),a.height(O.height()).children(".ui-dialog-content:first").empty(),n.toHide(O.before(a)),a.children(".ui-dialog-content:first,.ui-dialog-buttonpane,.ui-resizable-handle").remove(),a.find(".elfinder-titlebar-minimize,.elfinder-titlebar-full").remove(),a.find(".ui-dialog-titlebar-close").on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),d()}),a.animate(p,function(){a.attr("style","").css({maxWidth:O.width()}).addClass("elfinder-dialog-minimized").appendTo(s),u(),"function"==typeof t.minimize&&t.minimize.call(f[0])}))}),y.on("dblclick",function(t){e(this).children(".elfinder-titlebar-minimize").trigger("mousedown")}).prepend(i),O.on("togleminimize",function(){i.trigger("mousedown")}))}},O=e('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+m+" "+t.cssClass+'"/>').hide().append(f).appendTo(o).draggable({containment:n.options.dialogContained?o:null,handle:".ui-dialog-titlebar",start:function(){T.show()},drag:function(e,t){var i=t.offset.top,a=t.offset.left;i<0&&(t.position.top=t.position.top-i),a<0&&(t.position.left=t.position.left-a),n.options.dialogContained&&(t.position.top<0&&(t.position.top=0),t.position.left<0&&(t.position.left=0))},stop:function(e,n){T.hide(),O.css({height:t.height}),f.data("draged",!0)}}).css({width:t.width,height:t.height,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight}).on("touchstart touchmove touchend click dblclick mouseup mouseenter mouseleave mouseout mouseover mousemove",function(e){!h[e.type]&&e.stopPropagation()}).on("mousedown",function(t){!h[t.type]&&t.stopPropagation(),requestAnimationFrame(function(){O.is(":visible")&&!O.hasClass("elfinder-frontmost")&&((a=e(":focus")).length||(a=void 0),O.trigger("totop"))})}).on("open",function(){O.data("margin-y",f.outerHeight(!0)-f.height()),c.enabled&&(t.height&&"auto"!==t.height&&O.trigger("resize",{init:!0}),c.defaultSize||(c.defaultSize={width:f.width(),height:f.height()}),d(O),O.trigger("resize").trigger("posinit"),o.on("resize."+n.namespace,O,p)),O.hasClass("elfinder-dialog-notify")||o.children("."+m+":visible:not(.elfinder-dialog-notify)").each(function(){var t=e(this),n=parseInt(t.css("top")),i=parseInt(t.css("left")),a=parseInt(O.css("top")),o=parseInt(O.css("left")),r=Math.abs(n-a)<10,s=Math.abs(i-o)<10;t[0]!=O[0]&&(r||s)&&O.css({top:r?n+10:a,left:s?i+10:o})}),O.data("modal")&&(O.addClass("elfinder-dialog-modal"),n.getUI("overlay").elfinderoverlay("show")),O.trigger("totop"),t.openMaximized&&n.toggleMaximize(O),n.trigger("dialogopen",{dialog:O}),"function"==typeof t.open&&e.proxy(t.open,f[0])(),t.closeOnEscape&&e(document).on("keydown."+b,function(t){t.keyCode==e.ui.keyCode.ESCAPE&&O.hasClass("elfinder-frontmost")&&f.elfinderdialog("close")}),O.hasClass(n.res("class","editing"))&&u()}).on("close",function(i){var a;t.beforeclose&&"function"==typeof t.beforeclose?(a=t.beforeclose())&&a.promise||(a=a?e.Deferred().resolve():e.Deferred().reject()):a=e.Deferred().resolve(),a.done(function(){c.enabled&&o.off("resize."+n.namespace,p),t.closeOnEscape&&e(document).off("keyup."+b),t.allowMaximize&&n.toggleMaximize(O,!1),n.toHide(O),O.data("modal")&&n.getUI("overlay").elfinderoverlay("hide"),"function"==typeof t.close&&e.proxy(t.close,f[0])(),t.destroyOnClose&&O.parent().length&&O.hide().remove(),o.children("."+m+":visible"),O.hasClass(n.res("class","editing"))&&u()})}).on("totop frontmost",function(){var e=n.storage("autoFocusDialog");O.data("focusOnMouseOver",e?e>0:n.options.uiOptions.dialog.focusOnMouseOver),O.data("minimized")&&y.children(".elfinder-titlebar-minimize").trigger("mousedown"),!O.data("modal")&&n.getUI("overlay").is(":visible")?n.getUI("overlay").before(O):n.toFront(O),o.children("."+m+":not(.elfinder-dialog-modal)").removeClass("elfinder-dialog-active"),O.addClass("elfinder-dialog-active"),!n.UA.Mobile&&(a||j()).trigger("focus"),a=void 0}).on("posinit",function(){var i,a,s,l,c,d,p,u=t.position;if(!O.hasClass("elfinder-maximized")){if(!u&&!O.data("resizing")){if(p=o.hasClass("elfinder-fullscreen")||n.options.enableAlways,O.css(p?{maxWidth:"100%",maxHeight:"100%",overflow:"auto"}:r),n.UA.Mobile&&!p&&O.data("rotated")===n.UA.Rotated)return;O.data("rotated",n.UA.Rotated),c=e(window),i=o.offset(),(l={width:O.outerWidth(!0),height:O.outerHeight(!0)}).right=i.left+l.width,l.bottom=i.top+l.height,(d={scrLeft:c.scrollLeft(),scrTop:c.scrollTop(),width:c.width(),height:c.height()}).right=d.scrLeft+d.width,d.bottom=d.scrTop+d.height,n.options.dialogContained||p?(a=0,s=0):(a=-1*i.top+d.scrTop,s=-1*i.left+d.scrLeft),u={top:l.height>=d.height?a:Math.max(a,parseInt((o.height()-l.height)/2-42)),left:l.width>=d.width?s:Math.max(s,parseInt((o.width()-l.width)/2))},l.right+u.left>d.right&&(u.left=Math.max(s,d.right-l.right)),l.bottom+u.top>d.bottom&&(u.top=Math.max(a,d.bottom-l.bottom))}t.absolute&&(u.position="absolute"),u&&O.css(u)}}).on("resize",function(n,i){var a,o,r,s,l=0,d=i&&i.init;i&&(i.minimize||i.maxmize)||O.data("minimized")||(n.stopPropagation(),n.preventDefault(),O.children(".ui-widget-header,.ui-dialog-buttonpane").each(function(){l+=e(this).outerHeight(!0)}),(s="auto"===t.height)&&f.css({"max-height":"",height:"auto"}),d||!c.enabled||n.originalEvent||O.hasClass("elfinder-maximized")?a=O.height()-l-O.data("margin-y"):(a=O.height(),o=O.css("min-height")||a,r=O.css("max-height")||a,o=o.match(/%/)?Math.floor(parseInt(o)/100*O.parent().height()):parseInt(o),r=r.match(/%/)?Math.floor(parseInt(r)/100*O.parent().height()):parseInt(r),a=Math.min(s?O.height():c.defaultSize.height,Math.max(r,o)-l-O.data("margin-y"))),f.css(s?"max-height":"height",a),d||(I(),o=f.height(),o=a<o?o+l+O.data("margin-y"):t.minHeight,O.css("min-height",o),O.data("hasResizable")&&O.resizable("option",{minHeight:o}),"function"==typeof t.resize&&e.proxy(t.resize,f[0])(n,i)))}).on("tabstopsInit",z).on("focus","."+v,function(){e(this).addClass(g).parent("label").addClass(g),this.id&&e(this).parent().find("label[for="+this.id+"]").addClass(g)}).on("click","select."+v,function(){var t=e(this);t.data("keepFocus")?t.removeData("keepFocus"):t.data("keepFocus",!0)}).on("blur","."+v,function(){e(this).removeClass(g).removeData("keepFocus").parent("label").removeClass(g),this.id&&e(this).parent().find("label[for="+this.id+"]").removeClass(g)}).on("mouseenter mouseleave","."+v+",label",function(n){var i,a=e(this);("LABEL"!==this.nodeName||a.children("."+v).length||(i=a.attr("for"))&&e("#"+i).hasClass(v))&&(t.btnHoverFocus&&O.data("focusOnMouseOver")?"mouseenter"!==n.type||e(":focus").data("keepFocus")||a.trigger("focus"):a.toggleClass(g,"mouseenter"==n.type))}).on("keydown","."+v,function(t){var n,i,a=e(this);if(a.is(":focus")){if(n=t.keyCode===e.ui.keyCode.ESCAPE,t.keyCode===e.ui.keyCode.ENTER?(t.preventDefault(),a.trigger("click")):t.keyCode===e.ui.keyCode.TAB&&t.shiftKey||t.keyCode===e.ui.keyCode.LEFT||t.keyCode==e.ui.keyCode.UP?i="prev":t.keyCode!==e.ui.keyCode.TAB&&t.keyCode!=e.ui.keyCode.RIGHT&&t.keyCode!=e.ui.keyCode.DOWN||(i="next"),i&&(a.is("textarea")&&!t.ctrlKey&&!t.metaKey||a.is("select,span.ui-slider-handle")&&t.keyCode!==e.ui.keyCode.TAB||a.is("input:not(:checkbox,:radio)")&&!t.ctrlKey&&!t.metaKey&&t.keyCode===e.ui.keyCode["prev"===i?"LEFT":"RIGHT"]))return void t.stopPropagation();n?a.is("input:not(:checkbox,:radio),textarea")&&""!==a.val()&&(a.val(""),t.stopPropagation()):t.stopPropagation(),i&&(t.preventDefault(),("prev"===i?function(t){var n=C.filter(":visible:enabled"),i=n.last();return e.each(n,function(e,a){if(a===t&&n[e-1])return i=n.eq(e-1),!1}),i}:j)(this).trigger("focus"))}}).data({modal:t.modal}),I=function(){var e,t=n.getUI();t.hasClass("elfinder-fullscreen")&&(e=O.position(),O.css("top",Math.max(Math.min(Math.max(e.top,0),t.height()-100),0)),O.css("left",Math.max(Math.min(Math.max(e.left,0),t.width()-200),0)))};O.prepend(y),e.each(t.headerBtnOrder.split(":").reverse(),function(e,t){A[t]&&A[t]()}),s&&y.children(".elfinder-titlebar-button").addClass("elfinder-titlebar-button-right"),e.each(t.buttons,function(t,n){var i=e('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-btncnt-'+$+++" "+v+'"><span class="ui-button-text">'+t+"</span></button>").on("click",e.proxy(n,f[0]));n._cssClass&&i.addClass(n._cssClass),s?w.append(i):w.prepend(i)}),w.children().length&&(O.append(x),O.show(),x.find("button").each(function(t,n){k+=e(n).outerWidth(!0)}),O.hide(),k+=20,O.width()<k&&O.width(k)),O.append(T),c.enabled&&(l.width=O.outerWidth(!0)-O.width()+(O.outerWidth()-O.width())/2,l.height=O.outerHeight(!0)-O.height()+(O.outerHeight()-O.height())/2),n.options.dialogContained&&(i={maxWidth:o.width()-l.width,maxHeight:o.height()-l.height},t.maxWidth=t.maxWidth?Math.min(i.maxWidth,t.maxWidth):i.maxWidth,t.maxHeight=t.maxHeight?Math.min(i.maxHeight,t.maxHeight):i.maxHeight,O.css(i)),r={maxWidth:O.css("max-width"),maxHeight:O.css("max-height"),overflow:O.css("overflow")},t.resizable&&O.resizable({minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,start:function(){T.show(),!0!==O.data("resizing")&&O.data("resizing")&&clearTimeout(O.data("resizing")),O.data("resizing",!0)},stop:function(e,t){T.hide(),O.data("resizing",setTimeout(function(){O.data("resizing",!1)},200)),c.enabled&&(c.defaultSize={width:f.width(),height:f.height()})}}).data("hasResizable",!0),t.optimizeNumber&&O.find("input[type=number]").each(function(){e(this).attr("inputmode","numeric"),e(this).attr("pattern","[0-9]*")}),z(),"function"==typeof t.create&&e.proxy(t.create,this)(),t.autoOpen&&(t.open?requestAnimationFrame(function(){f.elfinderdialog("open")}):f.elfinderdialog("open")),t.resize&&n.bind("themechange",function(){setTimeout(function(){O.data("margin-y",f.outerHeight(!0)-f.height()),O.trigger("resize",{init:!0})},300)})}),this)},e.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},btnHoverFocus:!0,position:null,absolute:!1,width:320,height:"auto",minWidth:200,minHeight:70,maxWidth:null,maxHeight:null,allowMinimize:"auto",allowMaximize:!1,openMaximized:!1,headerBtnPos:"auto",headerBtnOrder:"auto",optimizeNumber:!0,propagationEvents:["mousemove","mouseup"]}}),e("skylark-elfinder/ui/fullscreenbutton",["skylark-jquery"],function(e){e.fn.elfinderfullscreenbutton=function(t){"use strict";return this.each(function(){var n,i=e(this).elfinderbutton(t),a=i.children(".elfinder-button-icon");t.change(function(){n&&cancelAnimationFrame(n),n=requestAnimationFrame(function(){var e=t.value;a.addClass("elfinder-button-icon-fullscreen").toggleClass("elfinder-button-icon-unfullscreen",e),t.className=e?"unfullscreen":""})})})}}),e("skylark-elfinder/ui/navbar",["skylark-jquery"],function(e){e.fn.elfindernavbar=function(t,n){"use strict";return this.not(".elfinder-navbar").each(function(){var i,a,o,r,s,l,c,d=e(this).hide().addClass("ui-state-default elfinder-navbar"),p=d.css("overflow","hidden").parent(),u=p.children(".elfinder-workzone").append(d),h="ltr"==t.direction,f=function(){var e=t.getUI("cwd"),n=t.getUI("workzone"),i=n.data("rectangle"),a=e.offset();n.data("rectangle",Object.assign(i,{cwdEdge:"ltr"===t.direction?a.left:a.left+e.width()}))},m=function(){d.css("overflow","hidden"),i=Math.round(d.outerHeight()-d.height()),a=Math.round(c.outerWidth()-c.innerWidth()),d.css("overflow","auto")};t.one("init",function(){c=t.getUI("navdock");var e=function(){m(),t.bind("wzresize",function(){var e=0;c.width(d.outerWidth()-a),c.children().length>1&&(e=c.outerHeight(!0)),d.height(u.height()-e-i)}).trigger("wzresize")};t.cssloaded?e():t.one("cssloaded",e)}).one("opendone",function(){o&&o.trigger("resize"),d.css("overflow","auto")}).bind("themechange",m),t.UA.Touch&&(void 0===(s=t.storage("autoHide")||{}).navbar&&(s.navbar=n.autoHideUA&&n.autoHideUA.length>0&&e.grep(n.autoHideUA,function(e){return!!t.UA[e]}).length,t.storage("autoHide",s)),s.navbar&&t.one("init",function(){d.children().length&&t.uiAutoHide.push(function(){d.stop(!0,!0).trigger("navhide",{duration:"slow",init:!0})})}),t.bind("load",function(){d.children().length&&"none"!==(r=e('<div class="elfinder-navbar-swipe-handle"/>').hide().appendTo(u)).css("pointer-events")&&(r.remove(),r=null)}),d.on("navshow navhide",function(e,n){var i="navshow"===e.type?"show":"hide",a=n&&n.duration?n.duration:"fast",o=n&&n.handleW?n.handleW:Math.max(50,t.getUI().width()/10);d.stop(!0,!0)[i]({duration:a,step:function(){t.trigger("wzresize")},complete:function(){r&&("show"===i?r.stop(!0,!0).hide():(r.width(o||""),t.resources.blink(r,"slowonce"))),t.trigger("navbar"+i),n.init&&t.trigger("uiautohide"),f()}}),s.navbar="show"!==i,t.storage("autoHide",Object.assign(t.storage("autoHide"),{navbar:s.navbar}))}).on("touchstart",function(n){e(this)["scroll"+("ltr"===t.direction?"Right":"Left")]()>5&&(n.originalEvent._preventSwipeX=!0)})),t.UA.Mobile||(o=d.resizable({handles:h?"e":"w",minWidth:n.minWidth||150,maxWidth:n.maxWidth||500,resize:function(){t.trigger("wzresize")},stop:function(e,n){t.storage("navbarWidth",n.size.width),f()}}).on("resize scroll",function(n){var i=e(this),a=i.data("posinit");n.preventDefault(),n.stopPropagation(),h||"resize"!==n.type||d.css("left",0),a&&cancelAnimationFrame(a),i.data("posinit",requestAnimationFrame(function(){var e=t.UA.Opera&&d.scrollLeft()?20:2;o.css("top",0).css({top:parseInt(d.scrollTop())+"px",left:h?"auto":-1*parseInt(d.scrollRight()-e),right:h?-1*parseInt(d.scrollLeft()-e):"auto"}),"resize"===n.type&&t.getUI("cwd").trigger("resize")}))}).children(".ui-resizable-handle").addClass("ui-front")),(l=t.storage("navbarWidth"))?d.width(l):t.UA.Mobile&&t.one(t.cssloaded?"init":"cssloaded",function(){var n=function(){l=d.parent().width()/2,d.data("defWidth")>l?d.width(l):d.width(d.data("defWidth")),d.data("width",d.width()),t.trigger("wzresize")};d.data("defWidth",d.width()),e(window).on("resize."+t.namespace,n),n()})}),this}}),e("skylark-elfinder/ui/navdock",["skylark-jquery"],function(e){e.fn.elfindernavdock=function(t,n){"use strict";return this.not(".elfinder-navdock").each(function(){var i,a,o=e(this).hide().addClass("ui-state-default elfinder-navdock touch-punch"),r=o.parent(),s=(r.children(".elfinder-workzone").append(o),function(n,i){var a,r=i||o.height(),s=n-r,l=Object.keys(c).length,d=l?s/l:0;s&&(a=o.css("overflow"),o.css("overflow","hidden"),o.height(n),e.each(c,function(e,n){n.height(n.height()+d).trigger("resize."+t.namespace)}),t.trigger("wzresize"),o.css("overflow",a))}),l=e('<div class="ui-front ui-resizable-handle ui-resizable-n"/>').appendTo(o),c={},d=(parseInt(n.initMaxHeight)||50)/100,p=(parseInt(n.maxHeight)||90)/100;o.data("addNode",function(e,n){var r,u,h,f=t.getUI("workzone").height(),m=f*d;return n=Object.assign({first:!1,sizeSync:!0,init:!1},n),e.attr("id")||e.attr("id",t.namespace+"-navdock-"+ +new Date),n.sizeSync&&(c[e.attr("id")]=e),r=o.height(),u=r+e.outerHeight(!0),n.first?l.after(e):o.append(e),a=!0,o.resizable("enable").height(u).show(),t.trigger("wzresize"),n.init&&(h=t.storage("navdockHeight"),i=u=h||(u>m?m:u)),s(Math.min(u,f*p)),o}).data("removeNode",function(n,i){var r=e("#"+n);return delete c[n],o.height(o.height()-e("#"+n).outerHeight(!0)),i?"detach"===i?r=r.detach():i.append(r):r.remove(),o.children().length<=1&&(a=!1,o.resizable("disable").height(0).hide()),t.trigger("wzresize"),r}),n.disabled||t.one("init",function(){var e;t.getUI("navbar").children().not(".ui-resizable-handle").length&&(o.data("dockEnabled",!0),o.resizable({maxHeight:t.getUI("workzone").height()*p,handles:{n:l},start:function(n,i){e=o.css("overflow"),o.css("overflow","hidden"),t.trigger("navdockresizestart",{event:n,ui:i},!0)},resize:function(e,n){o.css("top",""),t.trigger("wzresize",{inNavdockResize:!0})},stop:function(n,a){t.trigger("navdockresizestop",{event:n,ui:a},!0),o.css("top",""),i=a.size.height,t.storage("navdockHeight",i),s(i,a.originalSize.height),o.css("overflow",e)}}),t.bind("wzresize",function(e){var n,a;o.is(":visible")&&(n=t.getUI("workzone").height()*p,e.data&&e.data.inNavdockResize||(a=o.height(),n<i?Math.abs(a-n)>1&&s(n):Math.abs(a-i)>1&&s(i)),o.resizable("option","maxHeight",n))}).bind("themechange",function(){var e=Math.round(o.height());requestAnimationFrame(function(){var t=Math.round(o.height()),n=e-t;0!==n&&s(o.height(),t-n)})})),t.bind("navbarshow navbarhide",function(e){o[a&&"navbarshow"===e.type?"show":"hide"]()})})}),this}}),e("skylark-elfinder/ui/overlay",["skylark-jquery"],function(e){e.fn.elfinderoverlay=function(t){"use strict";var n,i,a,o,r=this.parent().elfinder("instance");return this.filter(":not(.elfinder-overlay)").each(function(){t=Object.assign({},t),e(this).addClass("ui-front ui-widget-overlay elfinder-overlay").hide().on("mousedown",function(e){e.preventDefault(),e.stopPropagation()}).data({cnt:0,show:"function"==typeof t.show?t.show:function(){},hide:"function"==typeof t.hide?t.hide:function(){}})}),"show"==t&&(n=this.eq(0),i=n.data("cnt")+1,a=n.data("show"),r.toFront(n),n.data("cnt",i),n.is(":hidden")&&(n.show(),a())),"hide"==t&&(n=this.eq(0),i=n.data("cnt")-1,o=n.data("hide"),n.data("cnt",i),i<=0&&(n.hide(),o())),this}}),e("skylark-elfinder/ui/panel",["skylark-jquery"],function(e){e.fn.elfinderpanel=function(t){"use strict";return this.each(function(){var n=e(this).addClass("elfinder-panel ui-state-default ui-corner-all"),i="margin-"+("ltr"==t.direction?"left":"right");t.one("load",function(e){var a=t.getUI("navbar");n.css(i,parseInt(a.outerWidth(!0))),a.on("resize",function(e){e.preventDefault(),e.stopPropagation(),n.is(":visible")&&n.css(i,parseInt(a.outerWidth(!0)))})})})}}),e("skylark-elfinder/ui/path",["skylark-jquery"],function(e){e.fn.elfinderpath=function(t,n){"use strict";return this.each(function(){var i,a,o="",r="",s=[],l="statusbar",c=t.res("class","hover"),d="path"+(elFinder.prototype.uniqueid?elFinder.prototype.uniqueid:"")+"-",p=e('<div class="ui-widget-header ui-helper-clearfix elfinder-workzone-path"/>'),u=e(this).addClass("elfinder-path").html("&nbsp;").on("mousedown","span.elfinder-path-dir",function(n){var i=e(this).attr("id").substr(d.length);n.preventDefault(),i!=t.cwd().hash&&(e(this).addClass(c),o?t.exec("search",o,{target:i,mime:s.join(" ")}):t.trigger("select",{selected:[i]}).exec("open",i))}).prependTo(t.getUI("statusbar").show()),h=e('<div class="elfinder-path-roots"/>').on("click",function(n){n.stopPropagation(),n.preventDefault();var i=e.map(t.roots,function(e){return t.file(e)}),a=[];e.each(i,function(e,n){n.phash||t.root(t.cwd().hash,!0)===n.hash||a.push({label:t.escape(n.i18||n.name),icon:"home",callback:function(){t.exec("open",n.hash)},options:{iconClass:n.csscls||"",iconImg:n.icon||""}})}),t.trigger("contextmenu",{raw:a,x:n.pageX,y:n.pageY})}).append('<span class="elfinder-button-icon elfinder-button-icon-menu" />').appendTo(p),f=function(n){var i=[],a=[];return e.each(t.parents(n),function(e,o){var r=n===o?"elfinder-path-dir elfinder-path-cwd":"elfinder-path-dir",s=t.file(o),l=t.escape(s.i18||s.name);a.push(l),i.push('<span id="'+d+o+'" class="'+r+'" title="'+a.join(t.option("separator"))+'">'+l+"</span>")}),i.join('<span class="elfinder-path-other">'+t.option("separator")+"</span>")},m=function(){var n;u.children("span.elfinder-path-dir").attr("style",""),n="ltr"===t.direction?e("#"+d+t.cwd().hash).prevAll("span.elfinder-path-dir:first"):e(),u.scrollLeft(n.length?n.position().left:0)},g=function(){if(!t.UA.CSS.flex){var n,i,a=u.children("span.elfinder-path-dir"),o=a.length;"workzone"===l||o<2?a.attr("style",""):(u.width(u.css("max-width")),a.css({maxWidth:100/o+"%",display:"inline-block"}),n=u.width()-9,u.children("span.elfinder-path-other").each(function(){n-=e(this).width()}),i=[],a.each(function(t){var a=e(this),o=a.width();n-=o,o<this.scrollWidth&&i.push(t)}),u.width(""),i.length?(n>0&&(n/=i.length,e.each(i,function(t,i){var o=e(a[i]);o.css("max-width",o.width()+n)})),a.last().attr("style","")):a.attr("style",""))}};t.one("init",function(){i=t.getUI("tree").length,a=t.getUI("stat").length,!i&&n.toWorkzoneWithoutNavbar&&(p.append(u).insertBefore(t.getUI("workzone")),l="workzone",t.bind("open",m).one("opendone",function(){t.getUI().trigger("resize")}))}).bind("open searchend parents",function(){o="",r="",s=[],u.html(f(t.cwd().hash)),Object.keys(t.roots).length>1?(u.css("margin",""),h.show()):(u.css("margin",0),h.hide()),!a&&g()}).bind("searchstart",function(e){e.data&&(o=e.data.query||"",r=e.data.target||"",s=e.data.mimes||[])}).bind("search",function(e){var n="";n=r?f(r):t.i18n("btnAll"),u.html('<span class="elfinder-path-other">'+t.i18n("searcresult")+": </span>"+n),g()}).bind("navbarshow navbarhide",function(){var e=t.getUI("workzone");"navbarshow"===this.type?(t.unbind("open",m),u.prependTo(t.getUI("statusbar")),p.detach(),l="statusbar"):(p.append(u).insertBefore(e),l="workzone",m(),t.bind("open",m)),t.trigger("uiresize")}).bind("resize uistatchange",g)})}}),e("skylark-elfinder/ui/places",["skylark-jquery"],function(e){e.fn.elfinderplaces=function(t,n){"use strict";return this.each(function(){var i={},a="class",o=t.res(a,"navdir"),r=t.res(a,"navcollapse"),s=t.res(a,"navexpand"),l=t.res(a,"hover"),c=t.res(a,"treeroot"),d=t.res(a,"adroppable"),p=t.res("tpl","placedir"),u=t.res("tpl","perms"),h=e(t.res("tpl","navspinner")),f=n.suffix?n.suffix:"",m="places"+f,g=null,v=function(e){return e.substr(6)},b=function(e){return"place-"+e},y=function(t){return e(document.getElementById(b(t)))},w=function(){var n=[],a={};(n=e.map(O.children().find("[id]"),function(e){return v(e.id)})).length?e.each(n.reverse(),function(e,t){a[t]=i[t]}):a=null,t.storage(m,a)},x=function(){var a,o;m="places"+(n.suffix?n.suffix:""),i={},"string"==typeof(a=t.storage(m))?(a=e.grep(a.split(","),function(e){return!!e}),e.each(a,function(e,t){var n=t.split("#");i[n[0]]=n[1]?n[1]:n[0]})):e.isPlainObject(a)&&(i=a),t.trigger("placesload",{dirs:i,storageKey:m},!0),(o=Object.keys(i)).length&&(A.prepend(h),t.request({data:{cmd:"info",targets:o},preventDefault:!0}).done(function(n){var a={};n.files&&n.files.length&&t.cache(n.files),e.each(n.files,function(e,t){var n=t.hash;a[n]=t}),e.each(i,function(e,t){$(a[e]||Object.assign({notfound:!0},t))}),t.storage("placesState")>0&&A.trigger("click")}).always(function(){h.remove()}))},k=function(n,i){return e(p.replace(/\{id\}/,b(n?n.hash:i)).replace(/\{name\}/,t.escape(n?n.i18||n.name:i)).replace(/\{cssclass\}/,n?t.perms2class(n)+(n.notfound?" elfinder-na":"")+(n.csscls?" "+n.csscls:""):"").replace(/\{permissions\}/,!n||n.read&&n.write&&!n.notfound?"":u).replace(/\{title\}/,n?' title="'+t.escape(t.path(n.hash,!0)||n.i18||n.name)+'"':"").replace(/\{symlink\}/,"").replace(/\{style\}/,n&&n.icon?t.getIconStyle(n):""))},$=function(e){var n,a;return"directory"===e.mime&&(a=e.hash,t.files().hasOwnProperty(a)||t.trigger("tree",{tree:[e]}),n=k(e,a),i[a]=e,O.prepend(n),A.addClass(r),z.toggle(O.children().length>1),!0)},C=function(e){var t,n,a=null;return i[e]&&(delete i[e],(t=y(e)).length&&(a=t.text(),t.parent().remove(),n=O.children().length,z.toggle(n>1),n||(A.removeClass(r),I.removeClass(s),O.slideToggle(!1)))),a},T=function(e,t){var n=e.hash,a=y(t||n),o=k(e,n);return a.length>0&&(a.parent().replaceWith(o),i[n]=e,!0)},z=e('<span class="elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon" title="'+t.i18n("cmdsort")+'"/>').hide().on("click",function(n){n.stopPropagation(),O.empty(),e.each(i,function(n,i){var a=t.file(n)||i,r=k(a,n),s=null;if(a||r.hide(),O.children().length&&(e.each(O.children(),function(){var t=e(this);if((a.i18||a.name).localeCompare(t.children("."+o).text())<0)return s=!r.insertBefore(t)}),null!==s))return!0;!y(n).length&&O.append(r)}),w()}),j=k({hash:"root-"+t.namespace,name:t.i18n(n.name,"places"),read:!0,write:!0}),A=j.children("."+o).addClass(c).on("click",function(e){e.stopPropagation(),A.hasClass(r)&&(I.toggleClass(s),O.slideToggle(),t.storage("placesState",I.hasClass(s)?1:0))}).append(z),O=j.children("."+t.res(a,"navsubtree")),I=e(this).addClass(t.res(a,"tree")+" elfinder-places ui-corner-all").hide().append(j).appendTo(t.getUI("navbar")).on("mouseenter mouseleave","."+o,function(t){e(this).toggleClass("ui-state-hover","mouseenter"==t.type)}).on("click","."+o,function(n){var i=e(this);i.data("longtap")?n.stopPropagation():!i.hasClass("elfinder-na")&&t.exec("open",i.attr("id").substr(6))}).on("contextmenu","."+o+":not(."+c+")",function(n){var i=e(this),a=i.attr("id").substr(6);n.preventDefault(),t.trigger("contextmenu",{raw:[{label:t.i18n("moveUp"),icon:"up",remain:!0,callback:function(){!function(e){var n=y(e),i=n.parent(),a=i.prev("div"),o="ui-state-hover",r=t.getUI("contextmenu");g&&clearTimeout(g),a.length&&(r.find(":first").data("placesHash",e),n.addClass(o),i.insertBefore(a),a=i.prev("div"),g=setTimeout(function(){n.removeClass(o),r.find(":first").data("placesHash")===e&&r.hide().empty()},1500));a.length||(n.removeClass(o),r.hide().empty())}(a),w()}},"|",{label:t.i18n("rmFromPlaces"),icon:"rm",callback:function(){C(a),w()}}],x:n.pageX,y:n.pageY}),i.addClass("ui-state-hover"),t.getUI("contextmenu").children().on("mouseenter",function(){i.addClass("ui-state-hover")}),t.bind("closecontextmenu",function(){i.removeClass("ui-state-hover")})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:t.res("class","adroppable"),classes:{"ui-droppable-hover":t.res("class","adroppable")},over:function(n,a){var o=a.helper,r=e.grep(o.data("files"),function(e){return"directory"===t.file(e).mime&&!i[e]});n.stopPropagation(),o.data("dropover",o.data("dropover")+1),t.insideWorkzone(n.pageX,n.pageY)&&(r.length>0?(o.addClass("elfinder-drag-helper-plus"),t.trigger("unlockfiles",{files:o.data("files"),helper:o})):e(this).removeClass(d))},out:function(t,n){var i=n.helper;t.stopPropagation(),i.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus").data("dropover",Math.max(i.data("dropover")-1,0)),e(this).removeData("dropover").removeClass(d)},drop:function(n,a){var o=a.helper,r=!0;e.each(o.data("files"),function(e,n){var a=t.file(n);a&&"directory"==a.mime&&!i[a.hash]?$(a):r=!1}),w(),r&&o.hide()}}).on("touchstart","."+o+":not(."+c+")",function(n){if(!(n.originalEvent.touches.length>1))var i=e(this).attr("id").substr(6),a=e(this).addClass(l).data("longtap",null).data("tmlongtap",setTimeout(function(){a.data("longtap",!0),t.trigger("contextmenu",{raw:[{label:t.i18n("rmFromPlaces"),icon:"rm",callback:function(){C(i),w()}}],x:n.originalEvent.touches[0].pageX,y:n.originalEvent.touches[0].pageY})},500))}).on("touchmove touchend","."+o+":not(."+c+")",function(t){clearTimeout(e(this).data("tmlongtap")),"touchmove"==t.type&&e(this).removeClass(l)});e.fn.sortable&&O.addClass("touch-punch").sortable({appendTo:t.getUI(),revert:!1,helper:function(n){var i=e(n.target).parent();return i.children().removeClass("ui-state-hover"),e('<div class="ui-widget elfinder-place-drag elfinder-'+t.direction+'"/>').append(e('<div class="elfinder-navbar"/>').show().append(i.clone()))},stop:function(t,n){var i=e(n.item[0]),a=I.offset().top,o=I.offset().left,r=I.width(),s=I.height(),l=t.pageX,c=t.pageY;l>o&&l<o+r&&c>a&&c<c+s||(C(v(i.children(":first").attr("id"))),w())},update:function(e,t){w()}}),e(this).on("regist",function(t,n){var a=!1;e.each(n,function(e,t){t&&"directory"==t.mime&&!i[t.hash]&&$(t)&&(a=!0)}),a&&w()}),t.one("load",function(){t.oldAPI||(I.show().parent().show(),x(),t.change(function(t){var n=!1;e.each(t.data.changed,function(e,t){i[t.hash]&&("directory"!==t.mime?C(t.hash)&&(n=!0):T(t)&&(n=!0))}),n&&w()}).bind("rename",function(t){var n=!1;t.data.removed&&e.each(t.data.removed,function(e,i){t.data.added[e]&&T(t.data.added[e],i)&&(n=!0)}),n&&w()}).bind("rm paste",function(t){var n=[],i=!1;t.data.removed&&e.each(t.data.removed,function(e,t){var i=C(t);i&&n.push(i)}),n.length&&(i=!0),t.data.added&&n.length&&e.each(t.data.added,function(t,i){1!==e.inArray(i.name,n)&&"directory"==i.mime&&$(i)}),i&&w()}).bind("sync netmount",function(){var a,o=this,l=n.suffix?n.suffix:"";if("sync"===o.type&&f!==l)return f=l,O.empty(),A.removeClass(r),I.removeClass(s),O.slideToggle(!1),void x();(a=Object.keys(i)).length&&(A.prepend(h),t.request({data:{cmd:"info",targets:a},preventDefault:!0}).done(function(n){var a={},r=!1,s=t.cwd().hash;e.each(n.files||[],function(e,n){var i=n.hash;a[i]=n,t.files().hasOwnProperty(n.hash)||t.updateCache({tree:[n]})}),e.each(i,function(e,t){Boolean(t.notfound)===Boolean(a[e])?t.phash===s&&"netmount"!==o.type||a[e]&&"directory"!==a[e].mime?C(e)&&(r=!0):T(a[e]||Object.assign({notfound:!0},t))&&(r=!0):a[e]&&a[e].phash!=s&&T(a[e])}),r&&w()}).always(function(){h.remove()}))}))})})}}),e("skylark-elfinder/ui/searchbutton",["skylark-jquery"],function(e){e.fn.elfindersearchbutton=function(t){"use strict";return this.each(function(){var n,i,a,o,r=!1,s=t.fm,l=(s.res("class","disabled"),t.options.incsearch||{enable:!1}),c=t.options.searchTypes,d=function(e){return s.namespace+s.escape(e)},p=s.getUI("toolbar"),u=s.res("class","searchbtn"),h=e(this).hide().addClass("ui-widget-content elfinder-button "+u).on("click",function(e){e.stopPropagation()}),f=function(){v.data("inctm")&&clearTimeout(v.data("inctm"));var n=e.trim(v.val()),a=!e("#"+d("SearchFromAll")).prop("checked"),o=e("#"+d("SearchMime")).prop("checked"),l="";a&&(a=e("#"+d("SearchFromVol")).prop("checked")?s.root(s.cwd().hash):s.cwd().hash),o&&(o=n,n="."),i&&(l=i.children("input:checked").val()),n?(v.trigger("focus"),t.exec(n,a,o,l).done(function(){r=!0}).fail(function(){m()})):s.trigger("searchend")},m=function(){v.data("inctm")&&clearTimeout(v.data("inctm")),v.val("").trigger("blur"),(r||g)&&(r=!1,g="",s.lazy(function(){s.trigger("searchend")}))},g="",v=e('<input type="text" size="42"/>').on("focus",function(){var e,t;!h.hasClass("ui-state-active")&&s.getUI().click(),o=!0,g="",h.addClass("ui-state-active"),s.trigger("uiresize"),n&&n.css((e=s.getUI(),t=e.offset(),{top:h.offset().top-t.top,maxHeight:e.height()-40})).slideDown(function(){h.addClass("ui-state-active"),s.toFront(n)})}).on("blur",function(){o=!1,n?n.data("infocus")?n.data("infocus",!1):n.slideUp(function(){h.removeClass("ui-state-active"),s.trigger("uiresize"),s.toHide(n)}):h.removeClass("ui-state-active")}).appendTo(h).on("keypress",function(e){e.stopPropagation()}).on("keydown",function(t){t.stopPropagation(),t.keyCode===e.ui.keyCode.ENTER?f():t.keyCode===e.ui.keyCode.ESCAPE&&(t.preventDefault(),m())});l.enable&&(l.minlen=l.minlen||2,l.wait=l.wait||500,v.attr("title",s.i18n("incSearchOnly")).on("compositionstart",function(){v.data("composing",!0)}).on("compositionend",function(){v.removeData("composing"),v.trigger("input")}).on("input",function(){v.data("composing")||(v.data("inctm")&&clearTimeout(v.data("inctm")),v.data("inctm",setTimeout(function(){var e=v.val();(0===e.length||e.length>=l.minlen)&&(g!==e&&s.trigger("incsearchstart",{query:e,type:i?i.children("input:checked").val():"searchName"}),g=e,""===e&&s.searchStatus.state>1&&s.searchStatus.query&&v.val(s.searchStatus.query).trigger("select"))},l.wait)))}),s.UA.ltIE8&&v.on("keydown",function(e){229===e.keyCode&&(v.data("imetm")&&clearTimeout(v.data("imetm")),v.data("composing",!0),v.data("imetm",setTimeout(function(){v.removeData("composing")},100)))}).on("keyup",function(t){v.data("imetm")&&clearTimeout(v.data("imetm")),v.data("composing")?t.keyCode===e.ui.keyCode.ENTER&&v.trigger("compositionend"):v.trigger("input")})),e('<span class="ui-icon ui-icon-search" title="'+t.title+'"/>').appendTo(h).on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),h.hasClass("ui-state-active")?f():v.trigger("focus")}),e('<span class="ui-icon ui-icon-close"/>').appendTo(h).on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),""!==v.val()||h.hasClass("ui-state-active")?m():v.trigger("focus")}),s.bind("toolbarload",function(){var e=h.parent();if(e.length&&(p.prepend(h.show()),e.remove(),s.UA.ltIE7)){var t=h.children("ltr"==s.direction?".ui-icon-close":".ui-icon-search");t.css({right:"",left:parseInt(h.width())-t.outerWidth(!0)})}}),s.one("init",function(){s.getUI("cwd").on("touchstart click",function(){o&&v.trigger("blur")})}).one("open",function(){(n=s.api<2.1?null:e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all"/>').append(e('<div class="buttonset"/>').append(e('<input id="'+d("SearchFromCwd")+'" name="serchfrom" type="radio" checked="checked"/><label for="'+d("SearchFromCwd")+'">'+s.i18n("btnCwd")+"</label>"),e('<input id="'+d("SearchFromVol")+'" name="serchfrom" type="radio"/><label for="'+d("SearchFromVol")+'">'+s.i18n("btnVolume")+"</label>"),e('<input id="'+d("SearchFromAll")+'" name="serchfrom" type="radio"/><label for="'+d("SearchFromAll")+'">'+s.i18n("btnAll")+"</label>")),e('<div class="buttonset elfinder-search-type"/>').append(e('<input id="'+d("SearchName")+'" name="serchcol" type="radio" checked="checked" value="SearchName"/><label for="'+d("SearchName")+'">'+s.i18n("btnFileName")+"</label>"))).hide().appendTo(s.getUI()))&&(c&&(i=n.find(".elfinder-search-type"),e.each(t.options.searchTypes,function(t,n){i.append(e('<input id="'+d(t)+'" name="serchcol" type="radio" value="'+s.escape(t)+'"/><label for="'+d(t)+'">'+s.i18n(n.name)+"</label>"))})),n.find("div.buttonset").buttonset(),e("#"+d("SearchFromAll")).next("label").attr("title",s.i18n("searchTarget",s.i18n("btnAll"))),c&&e.each(c,function(t,n){n.title&&e("#"+d(t)).next("label").attr("title",s.i18n(n.title))}),n.on("mousedown","div.buttonset",function(e){e.stopPropagation(),n.data("infocus",!0)}).on("click","input",function(t){t.stopPropagation(),e.trim(v.val())?f():v.trigger("focus")}).on("close",function(){v.trigger("blur")}))}).bind("searchend",function(){v.val("")}).bind("open parents",function(){var t=[],n=s.file(s.root(s.cwd().hash));n&&(e.each(s.parents(s.cwd().hash),function(e,n){t.push(s.file(n).name)}),e("#"+d("SearchFromCwd")).next("label").attr("title",s.i18n("searchTarget",t.join(s.option("separator")))),e("#"+d("SearchFromVol")).next("label").attr("title",s.i18n("searchTarget",n.name)))}).bind("open",function(){g&&m()}).bind("cwdinit",function(){a=!1}).bind("cwdrender",function(){a=!0}).bind("keydownEsc",function(){g&&"/"===g.substr(0,1)&&(g="",v.val(""),s.trigger("searchend"))}).shortcut({pattern:"ctrl+f f3",description:t.title,callback:function(){v.trigger("select").trigger("focus")}}).shortcut({pattern:"a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9",description:s.i18n("firstLetterSearch"),callback:function(t){if(a){var n,i=t.originalEvent.keyCode,o=function(){var t=s.selected(),n=e.ui.keyCode[!t.length||s.cwdHash2Elm(t[0]).next("[id]").length?"RIGHT":"HOME"];e(document).trigger(e.Event("keydown",{keyCode:n,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))};i>=96&&i<=105&&(i-=48),n="/"+String.fromCharCode(i),g!==n?(v.val(n),g=n,s.trigger("incsearchstart",{query:n}).one("cwdrender",o)):o()}}})})}}),e("skylark-elfinder/ui/sortbutton",["skylark-jquery"],function(e){e.fn.elfindersortbutton=function(t){"use strict";return this.each(function(){var n,i=t.fm,a=t.name,o="class",r=i.res(o,"disabled"),s=i.res(o,"hover"),l="elfinder-button-menu-item",c=l+"-selected",d=c+"-asc",p=c+"-desc",u=e('<span class="elfinder-button-text">'+t.title+"</span>"),h=e(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+a).attr("title",t.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+a+'"/>',u).on("mouseenter mouseleave",function(e){!h.hasClass(r)&&h.toggleClass(s,"mouseenter"===e.type)}).on("click",function(e){h.hasClass(r)||(e.stopPropagation(),m.is(":hidden")&&i.getUI().click(),m.css(v()).slideToggle({duration:100,done:function(e){i[m.is(":visible")?"toFront":"toHide"](m)}}))}),f=function(){i.toHide(m)},m=e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-sort-menu ui-corner-all"/>').hide().appendTo(i.getUI()).on("mouseenter mouseleave","."+l,function(t){e(this).toggleClass(s,"mouseenter"===t.type)}).on("click",function(e){e.preventDefault(),e.stopPropagation()}).on("close",f),g=function(){m.children("[rel]").removeClass(c+" "+d+" "+p).filter('[rel="'+i.sortType+'"]').addClass(c+" "+("asc"==i.sortOrder?d:p)),m.children(".elfinder-sort-stick").toggleClass(c,i.sortStickFolders),m.children(".elfinder-sort-tree").toggleClass(c,i.sortAlsoTreeview)},v=function(){var e=i.getUI().offset(),t=h.offset();return{top:t.top-e.top,left:t.left-e.left}};u.hide(),e.each(i.sortRules,function(t,n){m.append(e('<div class="'+l+'" rel="'+t+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+i.i18n("sort"+t)+"</div>").data("type",t))}),m.children().on("click",function(n){t.exec([],e(this).removeClass(s).attr("rel"))}),e('<div class="'+l+" "+l+'-separated elfinder-sort-ext elfinder-sort-stick"><span class="ui-icon ui-icon-check"/>'+i.i18n("sortFoldersFirst")+"</div>").appendTo(m).on("click",function(){t.exec([],"stick")}),i.one("init",function(){i.ui.tree&&null!==i.options.sortAlsoTreeview&&e('<div class="'+l+" "+l+'-separated elfinder-sort-ext elfinder-sort-tree"><span class="ui-icon ui-icon-check"/>'+i.i18n("sortAlsoTreeview")+"</div>").appendTo(m).on("click",function(){t.exec([],"tree")})}).bind("disable select",f).bind("sortchange",g).getUI().on("click",f),m.children().length>1?t.change(function(){n&&cancelAnimationFrame(n),n=requestAnimationFrame(function(){h.toggleClass(r,t.disabled()),g()})}).change():h.addClass(r)})}}),e("skylark-elfinder/ui/stat",["skylark-jquery"],function(e){return e.fn.elfinderstat=function(t){"use strict";return this.each(function(){var n=e(this).addClass("elfinder-stat-size"),i=e('<div class="elfinder-stat-selected"/>').on("click","a",function(n){var i=e(this).data("hash");n.preventDefault(),t.exec("opendir",[i])}),a=t.i18n("items"),o=t.i18n("selected"),r=t.i18n("size"),s=function(e){n.find("span.elfinder-stat-incsearch").html(e?e.hashes.length+" / ":""),n.attr("title",n.text()),t.trigger("uistatchange")},l=function(n){var a,s,l=0,c=0,d=[];1===n.length?(s=n[0],l=s.size,2===t.searchStatus.state&&(a=t.escape(s.path?s.path.replace(/\/[^\/]*$/,""):".."),d.push('<a href="#elf_'+s.phash+'" data-hash="'+s.hash+'" title="'+a+'">'+a+"</a>")),d.push(t.escape(s.i18||s.name)),i.html(d.join("/")+(l>0?", "+t.formatSize(l):""))):n.length?(e.each(n,function(e,t){c++,l+=parseInt(t.size)||0}),i.html(c?o+": "+c+", "+r+": "+t.formatSize(l):"&nbsp;")):i.html(""),i.attr("title",i.text()),t.trigger("uistatchange")};t.getUI("statusbar").prepend(n).append(i).show(),t.UA.Mobile&&e.fn.tooltip&&t.getUI("statusbar").tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0}),t.bind("cwdhasheschange",function(i){!function(i){var o=0,r=0,s=t.cwd(),l=!0,c=!0;(s.sizeInfo||s.size)&&(r=s.size,l=!1);e.each(i,function(e,t){o++,l&&(r+=parseInt(t.size)||0,!0!==c||"directory"!==t.mime||t.sizeInfo||(c=!1))}),n.html(a+': <span class="elfinder-stat-incsearch"></span>'+o+',&nbsp;<span class="elfinder-stat-size'+(c?" elfinder-stat-size-recursive":"")+'">'+t.i18n(c?"sum":"size")+": "+t.formatSize(r)+"</span>").attr("title",n.text()),t.trigger("uistatchange")}(e.map(i.data,function(e){return t.file(e)}))}).change(function(i){var a=i.data.changed||[],o=t.cwd().hash;e.each(a,function(){if(this.hash===o)return this.size&&(n.children(".elfinder-stat-size").addClass("elfinder-stat-size-recursive").html(t.i18n("sum")+": "+t.formatSize(this.size)),n.attr("title",n.text())),!1})}).select(function(){l(t.selectedFiles())}).bind("open",function(){l([])}).bind("incsearch",function(e){s(e.data)}).bind("incsearchend",function(){s()})})},e}),e("skylark-elfinder/ui/toast",["skylark-jquery"],function(e){return e.fn.elfindertoast=function(t,n){"use strict";var i=Object.assign({mode:"success",msg:"",showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1500,hideEasing:"swing",onHidden:void 0,timeOut:3e3,extNode:void 0,button:void 0,width:void 0},e.isPlainObject(n.options.uiOptions.toast.defaults)?n.options.uiOptions.toast.defaults:{});return this.each(function(){t=Object.assign({},i,t||{});var a,o=e(this),r=function(e){o.stop(),n.toFront(o),o[t.showMethod]({duration:t.showDuration,easing:t.showEasing,complete:function(){t.onShown&&t.onShown(),!e&&t.timeOut&&(a=setTimeout(s,t.timeOut))}})},s=function(){o[t.hideMethod]({duration:t.hideDuration,easing:t.hideEasing,complete:function(){t.onHidden&&t.onHidden(),o.remove()}})};o.on("click",function(e){e.stopPropagation(),e.preventDefault(),a&&clearTimeout(a),t.onHidden&&t.onHidden(),o.stop().remove()}).on("mouseenter mouseleave",function(e){t.timeOut&&(a&&clearTimeout(a),a=null,"mouseenter"===e.type?r(!0):a=setTimeout(s,t.timeOut))}).hide().addClass("toast-"+t.mode).append(e('<div class="elfinder-toast-msg"/>').html(t.msg.replace(/%([a-zA-Z0-9]+)%/g,function(e,t){return n.i18n(t)}))),t.extNode&&o.append(t.extNode),t.button&&o.append(e('<button class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"/>').append(e('<span class="ui-button-text"/>').text(n.i18n(t.button.text))).on("mouseenter mouseleave",function(t){e(this).toggleClass("ui-state-hover","mouseenter"==t.type)}).on("click",t.button.click||function(){})),t.width&&o.css("max-width",t.width),r()})},e}),e("skylark-elfinder/ui/toolbar",["skylark-jquery"],function(e){return e.fn.elfindertoolbar=function(t,n){"use strict";return this.not(".elfinder-toolbar").each(function(){var i,a,o,r,s,l,c,d,p,u=t._commands,h=e(this).addClass("ui-helper-clearfix ui-widget-header elfinder-toolbar"),f={displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"],showPreferenceButton:"none"},m=function(n){var l,c;for(e.each(g,function(e,t){t.detach()}),h.empty(),i=v.length;i--;)if(v[i]){for(r=e('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),a=v[i].length;a--;)l=v[i][a],n&&n[l]||!(o=u[l])||(s="elfinder"+o.options.ui,!g[l]&&e.fn[s]&&(g[l]=e("<div/>")[s](o)),g[l]&&(g[l].children(".elfinder-button-text")[d?"show":"hide"](),r.prepend(g[l])));r.children().length&&h.prepend(r),r.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}(c=u.preference)&&("always"===f.showPreferenceButton||!h.children().length&&"auto"===f.showPreferenceButton)&&(r=e('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),l="preference",s="elfinder"+o.options.ui,g[l]=e("<div/>")[s](c),g[l].children(".elfinder-button-text")[d?"show":"hide"](),r.prepend(g[l]),h.append(r)),!h.data("swipeClose")&&h.children().length?h.show():h.hide(),w=h[0].clientHeight,t.trigger("toolbarload").trigger("uiresize")},g={},v=function(t){return e.grep(t,function(t){return!e.isPlainObject(t)||(f=Object.assign(f,t),!1)})}(n||[]),b=null,y="",w=0,x=[];f.showPreferenceButton=f.showPreferenceButton.toLowerCase(),"none"!==f.displayTextLabel&&(d=null===(d=t.storage("toolbarTextLabel"))?f.displayTextLabel&&(!f.labelExcludeUA||!f.labelExcludeUA.length||!e.grep(f.labelExcludeUA,function(e){return!!t.UA[e]}).length):1==d,x.push({label:t.i18n("textLabel"),icon:"text",callback:function(){d=!d,h.css("height","").find(".elfinder-button-text")[d?"show":"hide"](),t.trigger("uiresize").storage("toolbarTextLabel",d?"1":"0")}})),f.preferenceInContextmenu&&u.preference&&x.push({label:t.i18n("toolbarPref"),icon:"preference",callback:function(){t.exec("preference",void 0,{tab:"toolbar"})}}),x.length&&h.on("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),t.trigger("contextmenu",{raw:x,x:e.pageX,y:e.pageY})}).on("touchstart",function(e){e.originalEvent.touches.length>1||(h.data("tmlongtap")&&clearTimeout(h.data("tmlongtap")),h.removeData("longtap").data("longtap",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}).data("tmlongtap",setTimeout(function(){h.removeData("longtapTm").trigger({type:"contextmenu",pageX:h.data("longtap").x,pageY:h.data("longtap").y}).data("longtap",{longtap:!0})},500)))}).on("touchmove touchend",function(e){h.data("tmlongtap")&&(("touchend"===e.type||Math.abs(h.data("longtap").x-e.originalEvent.touches[0].pageX)+Math.abs(h.data("longtap").y-e.originalEvent.touches[0].pageY)>4)&&clearTimeout(h.data("tmlongtap")),h.removeData("longtapTm"))}).on("click",function(e){h.data("longtap")&&h.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}).on("touchend click",".elfinder-button",function(e){h.data("longtap")&&h.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}),h.prev().length&&h.parent().prepend(this),m(),t.bind("open sync select toolbarpref",function(){var n,i,a,o=Object.assign({},t.option("disabledFlip")),r=t.storage("toolbarhides");if(!r&&Array.isArray(f.defaultHides)&&(r={},e.each(f.defaultHides,function(){r[this]=!0}),t.storage("toolbarhides",r)),"select"===this.type){if(t.searchStatus.state<2)return;(i=t.selected()).length&&(o=t.getDisabledCmds(i,!0))}e.each(r,function(e){o[e]||(o[e]=!0)}),Object.keys(t.commandMap).length&&e.each(t.commandMap,function(e,t){"hidden"===t&&(o[e]=!0)}),a=Object.keys(o),b&&b.toString()===a.sort().toString()||(m(a.length?o:null),n=!0),b=a.sort(),(n||y!==JSON.stringify(t.commandMap))&&(y=JSON.stringify(t.commandMap),n||e.each(e("div.elfinder-button"),function(){var t=e(this).data("origin");t&&e(this).after(t).detach()}),Object.keys(t.commandMap).length&&e.each(t.commandMap,function(n,i){var a,o=t._commands[i],r=o?"elfinder"+o.options.ui:null;r&&e.fn[r]&&(a=g[n])&&(!g[i]&&e.fn[r]&&(g[i]=e("<div/>")[r](o),g[i]&&(g[i].children(".elfinder-button-text")[d?"show":"hide"](),o.extendsCmd&&g[i].children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+o.extendsCmd))),g[i]&&(a.after(g[i]),g[i].data("origin",a.detach())))}))}).bind("resize",function(e){p&&cancelAnimationFrame(p),p=requestAnimationFrame(function(){var e=h[0].clientHeight;w!==e&&(w=e,t.trigger("uiresize"))})}),t.UA.Touch&&(void 0===(c=t.storage("autoHide")||{}).toolbar&&(c.toolbar=f.autoHideUA&&f.autoHideUA.length>0&&e.grep(f.autoHideUA,function(e){return!!t.UA[e]}).length,t.storage("autoHide",c)),c.toolbar&&t.one("init",function(){t.uiAutoHide.push(function(){h.stop(!0,!0).trigger("toggle",{duration:500,init:!0})})}),t.bind("load",function(){"none"!==(l=e('<div class="elfinder-toolbar-swipe-handle"/>').hide().appendTo(t.getUI())).css("pointer-events")&&(l.remove(),l=null)}),h.on("toggle",function(e,n){var i=t.getUI("workzone"),a=h.is(":hidden"),o=i.height(),r=h.height(),s=h.outerHeight(!0),d=s-r,p=Object.assign({step:function(e){i.height(o+(a?-1*(e+d):r-e)),t.trigger("resize")},always:function(){requestAnimationFrame(function(){h.css("height",""),t.trigger("uiresize"),l&&(a?l.stop(!0,!0).hide():(l.height(n.handleH?n.handleH:""),t.resources.blink(l,"slowonce"))),a&&h.scrollTop("0px"),n.init&&t.trigger("uiautohide")})}},n);h.data("swipeClose",!a).stop(!0,!0).animate({height:"toggle"},p),c.toolbar=!a,t.storage("autoHide",Object.assign(t.storage("autoHide"),{toolbar:c.toolbar}))}).on("touchstart",function(e){h.scrollBottom()>5&&(e.originalEvent._preventSwipeY=!0)}))}),this},e}),e("skylark-elfinder/ui/tree",["skylark-jquery"],function(e){return e.fn.elfindertree=function(t,n){"use strict";var i=t.res("class","tree");return this.not("."+i).each(function(){var a,o,r,s,l="class",c=t.UA.Mobile,d=t.res(l,"treeroot"),p=n.openRootOnLoad,u=n.openCwdOnOpen,h=u||n.syncTree,f=t.res(l,"navsubtree"),m=t.res(l,"treedir"),g="span."+m,v=t.res(l,"navcollapse"),b=t.res(l,"navexpand"),y="elfinder-subtree-loaded",w=t.res(l,"navarrow"),x=t.res(l,"active"),k=t.res(l,"adroppable"),$=t.res(l,"hover"),C=t.res(l,"disabled"),T=t.res(l,"draggable"),z=t.res(l,"droppable"),j="elfinder-navbar-wrapper-root",A="elfinder-navbar-wrapper-pastable",O="elfinder-navbar-wrapper-uploadable",I=function(e){var t=re.offset().left;return t<=e&&e<=t+re.width()},M={},S=[],F=function(n){var i=[];if(e.each(n,function(e,n){M[n]&&i.push(t.navId2Hash(n)),delete M[n]}),i.length)return t.request({data:{cmd:"subdirs",targets:i,preventDefault:!0}}).done(function(n){n&&n.subdirs&&e.each(n.subdirs,function(e,n){var i=t.navHash2Elm(e);i.removeClass("elfinder-subtree-chksubdir"),i[n?"addClass":"removeClass"](v)})})},E=null,D=function(){var n=Object.keys(M);n.length&&(E&&E._abort(),a&&clearTimeout(a),S=[],E=t.asyncJob(function(n){return t.isInWindow(e("#"+n))?n:null},n,{numPerOnce:200}).done(function(e){e.length&&(S=e,P())}))},U=0,P=function(){var e,i=n.subdirsMaxConn-U,o=t.maxTargets?Math.min(t.maxTargets,n.subdirsAtOnce):n.subdirsAtOnce;if(a&&cancelAnimationFrame(a),S.length)if(i>0)for(e=0;e<i;e++)S.length&&(U++,F(S.splice(0,o)).always(function(){U--,P()}));else a=requestAnimationFrame(function(){S.length&&P()})},q=t.droppable.drop,R=e.extend(!0,{},t.droppable,{over:function(n,i){var a,o,r=e(this),s=i.helper,l=$+" "+k;if(n.stopPropagation(),s.data("dropover",s.data("dropover")+1),r.data("dropover",!0),i.helper.data("namespace")!==t.namespace||!t.insideWorkzone(n.pageX,n.pageY))return r.removeClass(l),void s.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus");I(n.clientX)?(s.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"),r.addClass($),r.is("."+v+":not(."+b+")")&&r.data("expandTimer",setTimeout(function(){r.is("."+v+"."+$)&&r.children("."+w).trigger("click")},500)),r.is(".elfinder-ro,.elfinder-na")?r.removeClass(k):(a=t.navId2Hash(r.attr("id")),r.data("dropover",a),e.each(i.helper.data("files"),function(e,n){if(n===a||t.file(n).phash===a&&!i.helper.hasClass("elfinder-drag-helper-plus"))return r.removeClass(l),!1}),s.data("locked")?o="elfinder-drag-helper-plus":(o="elfinder-drag-helper-move",(n.shiftKey||n.ctrlKey||n.metaKey)&&(o+=" elfinder-drag-helper-plus")),r.hasClass(k)&&s.addClass(o),requestAnimationFrame(function(){r.hasClass(k)&&s.addClass(o)}))):r.removeClass(l)},out:function(t,n){var i=e(this),a=n.helper;t.stopPropagation(),I(t.clientX)&&a.removeClass("elfinder-drag-helper-move elfinder-drag-helper-plus"),a.data("dropover",Math.max(a.data("dropover")-1,0)),i.data("expandTimer")&&clearTimeout(i.data("expandTimer")),i.removeData("dropover").removeClass($+" "+k)},deactivate:function(){e(this).removeData("dropover").removeClass($+" "+k)},drop:function(e,t){I(e.clientX)&&q.call(this,e,t)}}),H=e(t.res("tpl","navspinner")),_=t.res("tpl","navdir"),N=t.res("tpl","perms"),L=(t.res("tpl","lock"),t.res("tpl","symlink")),B={},W={id:function(e){return t.navHash2Id(e.hash)},name:function(e){return t.escape(e.i18||e.name)},cssclass:function(e){var i=(e.phash&&!e.isroot?"":d)+" "+m+" "+t.perms2class(e);return e.dirs&&!e.link&&(i+=" "+v)&&-1==e.dirs&&(i+=" elfinder-subtree-chksubdir"),n.getClass&&(i+=" "+n.getClass(e)),e.csscls&&(i+=" "+t.escape(e.csscls)),i},title:function(e){return n.attrTitle?' title="'+t.escape(t.path(e.hash,!0)||e.i18||e.name)+'"':""},root:function(t){var n="";return!t.phash||t.isroot?(n+=" "+j,!t.disabled||t.disabled.length<1?n+=" "+A+" "+O:(-1===e.inArray("paste",t.disabled)&&(n+=" "+A),-1===e.inArray("upload",t.disabled)&&(n+=" "+O)),n):""},permissions:function(e){return e.read&&e.write?"":N},symlink:function(e){return e.alias?L:""},style:function(e){return e.icon?t.getIconStyle(e):""}},V=function(e){return _.replace(/(?:\{([a-z]+)\})/gi,function(t,n){var i=W[n]?W[n](e):e[n]||"";return"id"===n&&-1==e.dirs&&(M[i]=i),i})},K=function(n,i){return e.map(n||[],function(e){return"directory"!==e.mime||i&&!t.navHash2Elm(e.hash).length?null:e})},X=function(e){return e?t.navHash2Elm(e).next("."+f):ae},G=function(e,n){for(var i,a=e.children(":first");a.length;){if(i=t.file(t.navId2Hash(a.children("[id]").attr("id"))),(i=t.file(t.navId2Hash(a.children("[id]").attr("id"))))&&Y(n,i)<0)return a;a=a.next()}return e.children("button.elfinder-navbar-pager-next")},J=function(i){for(var a,o,r,s,l,d,p,u=i.length,h=[],f=u,m=e(),g={},v=t.cwd(),b=function(i,a,o,r){var s={},l=0,d=t.newAPI?Math.min(1e4,Math.max(10,n.subTreeMax)):1e4,p=function(){s={},e.each(a,function(e,t){s[t.hash]=e})},u=function(t,n){var o,r;(t.stopPropagation(),n.select)?m(h(n.select)):n.change?"prepare"===(r=n.change)?e.each(a,function(e,t){t.node&&i.append(t.node.hide())}):"done"===r&&e.each(a,function(e,t){t.node&&t.node.detach().show()}):(n.removed&&n.removed.length&&(a=e.grep(a,function(e){return-1===n.removed.indexOf(e.hash)||(!o&&(o=!0),!1)})),n.added&&n.added.length&&(a=a.concat(e.grep(n.added,function(e){return void 0===s[e.hash]&&(!o&&(o=!0),!0)}))),o&&(a.sort(Y),p(),m(l)))},h=function(e){if(void 0!==s[e])return Math.floor(s[e]/d)*d},f=t.navId2Hash(i.prev("[id]").attr("id")),m=function(n,o){var r,s,b,y,w,x,k,$=[],C={};delete B[f],l=n,i.off("update."+t.namespace,u),a.length>d&&(i.on("update."+t.namespace,u),void 0===n&&(0,p(),void 0===(n=h(v.hash))&&(n=0)),b=a.slice(n,n+d),B[f]=i,y=n?Math.max(-1,n-d):-1,w=n+d>=a.length?0:n+d,r=Math.ceil(a.length/d),s=Math.ceil(n/d)),e.each(b||a,function(e,t){$.push(V(t)),t.node&&(C[t.hash]=t.node)}),x=y>-1?e('<button class="elfinder-navbar-pager elfinder-navbar-pager-prev"/>').text(t.i18n("btnPrevious",s,r)).button({icons:{primary:"ui-icon-caret-1-n"}}).on("click",function(e){e.preventDefault(),e.stopPropagation(),m(y,"up")}):e(),k=w?e('<button class="elfinder-navbar-pager elfinder-navbar-pager-next"/>').text(t.i18n("btnNext",s+2,r)).button({icons:{primary:"ui-icon-caret-1-s"}}).on("click",function(e){e.preventDefault(),e.stopPropagation(),m(w,"down")}):e(),g(),i.empty()[b?"addClass":"removeClass"]("elfinder-navbar-hasmore").append(x,$.join(""),k),e.each(C,function(e,n){t.navHash2Elm(e).parent().replaceWith(n)}),o&&Q(t.navHash2Id(b["up"===o?b.length-1:0].hash)),!c&&t.lazy(function(){ne(null,i)})},g=function(){e.each(i.children(".elfinder-navbar-wrapper"),function(n,i){var o,r,l=e(i),c=l.children("[id]:first");c.hasClass(y)&&(o=t.navId2Hash(c.attr("id")))&&void 0!==(r=s[o])&&(a[r].node=l.detach())})};m()},w={},x=[],k={};f--;)a=i[f],g[a.hash]||t.navHash2Elm(a.hash).length||(g[a.hash]=!0,(o=X(a.phash)).length?(p=a.phash||"treeroot",void 0===k[p]&&(k[p]=o.children(":last")),s=!k[p].length,a.phash&&(s||o.hasClass("elfinder-navbar-hasmore")||(r=G(o,a)).length)?s?(w[a.phash]||(w[a.phash]=[]),w[a.phash].push(a)):r?(d=V(a),r.before(d),!c&&(m=m.add(d))):x.push(a):(d=V(a),s?o.prepend(d):k[p].after(d),a.phash&&!a.isroot||(l=t.navHash2Elm(a.hash).parent()),!c&&ne(null,l))):h.push(a));Object.keys(w).length&&e.each(w,function(e,t){var n=X(e);t.sort(Y),b(n,t)}),x.length&&o.trigger("update."+t.namespace,{added:x}),h.length&&h.length<u?J(h):!c&&m.length&&t.lazy(function(){ne(m)})},Y=function(e,n){if(t.sortAlsoTreeview){var i,a="asc"==t.sortOrder,o=t.sortType,r=t.sortRules;return i=a?r[t.sortType](e,n):r[t.sortType](n,e),"name"!==o&&0===i?i=a?r.name(e,n):r.name(n,e):i}return t.sortRules.name(e,n)},Q=function(i){var a,r,s,l,c,d,p=e.Deferred();return o&&clearTimeout(o),o=setTimeout(function(){(a=e(document.getElementById(i||t.navHash2Id(t.cwd().hash)))).length?((u?a:a.parent()).parents(".elfinder-navbar-wrapper").children("."+y).addClass(b).next("."+f).show(),r=ae.parent().stop(!1,!0),s=r.offset().top,l=r.height(),c=s+l-a.outerHeight(),(d=a.offset().top)<s||d>c?r.animate({scrollTop:r.scrollTop()+d-s-l/3},{duration:n.durations.autoScroll,complete:function(){p.resolve()}}):p.resolve()):p.reject()},100),p},Z=function(e){var n,i,a,o=e||t.cwd(),r=o.hash?[o.hash]:[];for(i=t.root(o.hash),a=t.file(i);a&&(n=a.phash)&&(r.unshift(n),i=t.root(n),a=t.file(i),!t.navHash2Elm(a.hash).hasClass(y)););return r},ee=function(e){var n=e||t.cwd(),i=n.hash,a=t.navHash2Elm(i);if(!a.length){for(;n&&n.phash;)B[n.phash]&&!t.navHash2Elm(n.hash).length&&B[n.phash].trigger("update."+t.namespace,{select:n.hash}),n=t.file(n.phash);a=t.navHash2Elm(i)}return a},te=function(n,i){var a,o,s,l,c,d,u,f,k=t.cwd(),$=k.hash,C=void 0===i?h:i,T=function(i,o){var r,s=function(){p&&a&&(X(a.hash).show().prev(g).addClass(b),p=!1),C?Q().done(D):D()};i&&e.each(i,function(e,n){n&&J(n),ee(t.file(e)),n&&ie(n,y)}),n&&(t.api<2.1&&n.push(k),J(n)),(r=ee()).hasClass(x)||(ae.find(g+"."+x).removeClass(x),r.addClass(x)),r.parents(".elfinder-navbar-wrapper").children("."+m).addClass(y),i?t.lazy(s).done(function(){o.resolve()}):(s(),o.resolve())},z=function(e){a&&(o.remove(),a.addClass(v+(e?"":" "+y)))},j=e.Deferred();return t.navHash2Elm($).length?T(void 0,j):(r=!0,(d=e.Deferred(),u=[],f=Z(s),(u=e.map(f,function(e){var n,i,a=t.file(e),o=!!a&&t.isRoot(a),r=t.navHash2Elm(e),s=function(e,n){var i,a,o=n||1;return(a=!!(i=t.file(e))&&i.phash)&&o>1?s(a,--o):a},c=function(){var i=s(e);for(n=i;i&&!t.navHash2Elm(i).hasClass(y);)n=i,i=s(i);return i||(n=void 0,i=t.root(e)),i}();return r.hasClass(y)||!o&&a&&t.navHash2Elm(a.phash).hasClass(y)?null:(o||c===s(e)||c===s(e,2)?(n=void 0,i="tree",o||(e=s(e))):i="parents",l||(l="tree"===i?e:c),function(e,n,i){var a={cmd:e,target:n};return i&&(a.until=i),t.request({data:a,preventFail:!0})}(i,e,n))})).length?(ee(t.file(l)),c=t.navHash2Id(l),C&&Q(c),a=e("#"+c),o=e(t.res("tpl","navspinner")).insertBefore(a.children("."+w)),a.removeClass(v),e.when.apply(e,u).done(function(){var e,t,n,i={};if((t=arguments.length)>0)for(n=0;n<t;n++)e=arguments[n].tree||[],i[f[n]]=Object.assign([],K(e));d.resolve(i)}).fail(function(){d.reject()}),d):d.resolve()).done(function(e){T(e,j),z()}).fail(function(){z(!0),j.reject()}).always(function(){r=!1})),t.trigger("treesync",j),j},ne=function(n,i){n||(i&&!i.closest("div."+j).hasClass(O)||(i||ae.find("div."+O)).find(g+":not(.elfinder-ro,.elfinder-na)").addClass("native-droppable"),n=!i||i.closest("div."+j).hasClass(A)?(i||ae.find("div."+A)).find(g+":not(."+z+")"):e(),i&&i.children("div."+j).each(function(){ne(null,e(this))})),n.length&&t.asyncJob(function(t){e(t).droppable(R)},e.makeArray(n),{interval:20,numPerOnce:100})},ie=function(n,i){var a=i==y?"."+v+":not(."+y+")":":not(."+v+")";e.each(n,function(n,o){t.navHash2Elm(o.phash).filter(a).filter(function(){return e.grep(e(this).next("."+f).children(),function(t){return!e(t).children().hasClass(d)}).length>0}).addClass(i)})},ae=e(this).addClass(i).on("mouseenter mouseleave",g,function(i){var a="mouseenter"===i.type;if(!a||!oe){var o,r,s=e(this);s.hasClass(k+" "+C)||(c||!a||s.data("dragRegisted")||s.hasClass(d+" "+T+" elfinder-na elfinder-wo")||(s.data("dragRegisted",!0),t.isCommandEnabled("copy",o=t.navId2Hash(s.attr("id")))&&s.draggable(t.draggable)),s.toggleClass($,a)),a&&n.attrTitle&&((r=t.file(o||t.navId2Hash(s.attr("id")))).isroot||s.attr("title")!==(r.i18||r.name)||s.attr("title",t.path(o,!0)))}}).on("dragenter",g,function(t){if(t.originalEvent.dataTransfer){var n=e(this);n.addClass($),n.is("."+v+":not(."+b+")")&&n.data("expandTimer",setTimeout(function(){n.is("."+v+"."+$)&&n.children("."+w).trigger("click")},500))}}).on("dragleave",g,function(t){if(t.originalEvent.dataTransfer){var n=e(this);n.data("expandTimer")&&clearTimeout(n.data("expandTimer")),n.removeClass($)}}).on("click",g,function(n){var i=e(this),a=t.navId2Hash(i.attr("id"));t.file(a);if(i.data("longtap"))return i.removeData("longtap"),void n.stopPropagation();i.hasClass(x)||(ae.find(g+"."+x).removeClass(x),i.addClass(x)),a==t.cwd().hash||i.hasClass(C)?(i.hasClass(v),t.select({selected:[a],origin:"navbar"})):t.exec("open",a).done(function(){t.one("opendone",function(){t.select({selected:[a],origin:"navbar"})})})}).on("touchstart",g,function(n){if(!(n.originalEvent.touches.length>1)){var i,a=n.originalEvent;"INPUT"!==n.target.nodeName?i=e(this).addClass($).removeData("longtap").data("tmlongtap",setTimeout(function(e){i.data("longtap",!0),t.trigger("contextmenu",{type:"navbar",targets:[t.navId2Hash(i.attr("id"))],x:a.touches[0].pageX,y:a.touches[0].pageY})},500)):n.stopPropagation()}}).on("touchmove touchend",g,function(t){"INPUT"!==t.target.nodeName?(clearTimeout(e(this).data("tmlongtap")),e(this).removeData("tmlongtap"),"touchmove"==t.type&&e(this).removeClass($)):t.stopPropagation()}).on("click",g+"."+v+" ."+w,function(i){var a=e(this),o=a.parent(g),r=o.next("."+f),s=e.Deferred();i.stopPropagation(),o.hasClass(y)?(o.toggleClass(b),t.lazy(function(){(o.hasClass(b)?r.children().length+r.find("div.elfinder-navbar-subtree[style*=block]").children().length:r.find("div:visible").length)>30?(r.toggle(),t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1),D()):r.stop(!0,!0)[o.hasClass(b)?"slideDown":"slideUp"](n.durations.slideUpDown,function(){t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1),D()})}).always(function(){s.resolve()})):(H.insertBefore(a),o.removeClass(v),t.request({cmd:"tree",target:t.navId2Hash(o.attr("id"))}).done(function(e){J(Object.assign([],K(e.tree))),r.children().length&&(o.addClass(v+" "+b),r.children().length>30?(r.show(),t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1),D()):r.stop(!0,!0).slideDown(n.durations.slideUpDown,function(){t.draggingUiHelper&&t.draggingUiHelper.data("refreshPositions",1),D()}))}).always(function(e){H.remove(),o.addClass(y),t.one("treedone",function(){s.resolve()})})),a.data("dfrd",s)}).on("contextmenu",g,function(n){var i=e(this);i.find("input:text").length?n.stopPropagation():(n.preventDefault(),i.data("tmlongtap")||t.trigger("contextmenu",{type:"navbar",targets:[t.navId2Hash(e(this).attr("id"))],x:n.pageX,y:n.pageY}),i.addClass("ui-state-hover"),t.getUI("contextmenu").children().on("mouseenter",function(){i.addClass("ui-state-hover")}),t.bind("closecontextmenu",function(){i.removeClass("ui-state-hover")}))}).on("scrolltoview",g,function(n,i){var a=e(this);Q(a.attr("id")).done(function(){i&&"undefined"!==i.blink&&!i.blink||t.resources.blink(a,"lookme")})}).on("create."+t.namespace,function(n,i){var a=X(i.phash),o=i.move||!1,r=e(V(i)).addClass("elfinder-navbar-wrapper-tmp"),s=t.selected();o&&s.length&&t.trigger("lockfiles",{files:s}),a.prepend(r)}),oe=!1,re=t.getUI("navbar").append(ae).show().on("scroll",function(){oe=!0,s&&cancelAnimationFrame(s),s=requestAnimationFrame(function(){oe=!1,D()})}),se=t.sortAlsoTreeview;t.open(function(e){var n=e.data,i=K(n.files),a=t.getUI("contextmenu");n.init&&ae.empty(),t.UA.iOS&&re.removeClass("overflow-scrolling-touch").addClass("overflow-scrolling-touch"),i.length?t.lazy(function(){a.data("cmdMaps")||a.data("cmdMaps",{}),J(i),ie(i,y),te(i)}):te()}).add(function(e){var t=K(e.data.added);t.length&&(J(t),ie(t,v))}).change(function(n){if(!r){var i,a,o,s,l,d,p,u,h,m,v,w,x=K(n.data.changed,!0),k=x.length,$=k;e();for(e.each(B,function(e,n){n.trigger("update."+t.namespace,{change:"prepare"})});$--;)if(i=x[$],a=i.phash,(o=t.navHash2Elm(i.hash)).length){if(v=o.parent(),a){if(l=o.closest("."+f),d=X(a),p=o.parent().next(),u=G(d,i),!d.length)continue;d[0]===l[0]&&p.get(0)===u.get(0)||(u.length?u.before(v):d.append(v))}h=o.hasClass(b),m=o.hasClass(y),s=e(V(i)),o.replaceWith(s.children(g)),!c&&ne(null,v),i.dirs&&(h||m)&&(o=t.navHash2Elm(i.hash))&&o.next("."+f).children().length&&(h&&o.addClass(b),m&&o.addClass(y)),w|=-1==i.dirs}w&&D(),e.each(B,function(e,n){n.trigger("update."+t.namespace,{change:"done"})}),k&&te(void 0,!1)}}).remove(function(n){var i,a,o,r=n.data.removed,s=r.length;for(e.each(B,function(e,n){n.trigger("update."+t.namespace,{removed:r}),n.trigger("update."+t.namespace,{change:"prepare"})});s--;)(i=t.navHash2Elm(r[s])).length&&(o=!0,a=i.closest("."+f),i.parent().detach(),a.children().length||a.hide().prev(g).removeClass(v+" "+b+" "+y));o&&t.getUI("navbar").children(".ui-resizable-handle").trigger("resize"),e.each(B,function(e,n){n.trigger("update."+t.namespace,{change:"done"})})}).bind("lockfiles unlockfiles",function(n){var i="lockfiles"==n.type,a=!!n.data.helper&&n.data.helper.data("locked"),o=i&&!a?"disable":"enable",r=e.grep(n.data.files||[],function(e){var n=t.file(e);return!(!n||"directory"!=n.mime)});e.each(r,function(e,n){var r=t.navHash2Elm(n);r.length&&!a&&(r.hasClass(T)&&r.draggable(o),r.hasClass(z)&&r.droppable(o),r[i?"addClass":"removeClass"](C))})}).bind("sortchange",function(){if(t.sortAlsoTreeview||se!==t.sortAlsoTreeview){var n,i=[],a={},o={},r="",s=!1;t.lazy(function(){n=K(t.files()),se=t.sortAlsoTreeview,ae.empty(),J(e.map(t.roots,function(e){var n=t.file(e);return n&&!n.phash?n:null})),Object.keys(B).length?((i=Z()).length>1?(e.each(i,function(e,n){var i=t.file(t.root(n)).volumeid;0===e&&(r=i),o[i]=n,a[n]=[]}),e.each(n,function(e,t){if(!t.volumeid)return s=!0,!1;a[o[t.volumeid]||o[r]].push(t)})):s=!0,s?e.each(i,function(e,i){J(n),ee(t.file(i)),ie(n,y)}):e.each(a,function(e,n){J(n),ee(t.file(e)),ie(n,y)})):(J(n),ee(),ie(n,y)),te()},100)}})}),this},e}),e("skylark-elfinder/ui/uploadButton",["skylark-jquery"],function(e){e.fn.elfinderuploadbutton=function(t){"use strict";return this.each(function(){var n,i=t.fm,a=e(this).elfinderbutton(t).off("click"),o=e("<form/>").appendTo(a),r=e('<input type="file" multiple="true" title="'+t.fm.i18n("selectForUpload")+'"/>').on("change",function(){var t=e(this);t.val()&&(i.exec("upload",{input:t.remove()[0]},void 0,i.cwd().hash),r.clone(!0).appendTo(o))}).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="copy"});o.append(r.clone(!0)),t.change(function(){n&&cancelAnimationFrame(n),n=requestAnimationFrame(function(){var e=t.disabled();o.is("visible")?!e&&o.hide():e&&o.show()})}).change()})}}),e("skylark-elfinder/ui/viewbutton",["skylark-jquery"],function(e){e.fn.elfinderviewbutton=function(t){"use strict";return this.each(function(){var n,i=e(this).elfinderbutton(t),a=i.children(".elfinder-button-icon"),o=i.children(".elfinder-button-text");t.change(function(){n&&cancelAnimationFrame(n),n=requestAnimationFrame(function(){var e="icons"==t.value;a.toggleClass("elfinder-button-icon-view-list",e),t.className=e?"view-list":"",t.title=t.fm.i18n(e?"viewlist":"viewicons"),i.attr("title",t.title),o.html(t.title)})})})}}),e("skylark-elfinder/ui/workzone",["skylark-jquery"],function(e){e.fn.elfinderworkzone=function(t){"use strict";var n="elfinder-workzone";return this.not("."+n).each(function(){var i,a=e(this).addClass(n),o=Math.round(a.height()),r=a.parent(),s=function(){i=a.outerHeight(!0)-a.height()},l=function(s){var l=r.height()-i,c=r.attr("style"),d=Math.round(a.height());s&&(s.preventDefault(),s.stopPropagation()),r.css("overflow","hidden").children(":visible:not(."+n+")").each(function(){var t=e(this);"absolute"!=t.css("position")&&"fixed"!=t.css("position")&&(l-=t.outerHeight(!0))}),r.attr("style",c||""),l=Math.max(0,Math.round(l)),o===l&&d===l||(o=Math.round(a.height()),a.height(l),t.trigger("wzresize"))};s(),r.on("resize."+t.namespace,l),t.one("cssloaded",function(){i=a.outerHeight(!0)-a.height(),l()}).bind("uiresize",l).bind("themechange",s)}),this}}),e("skylark-elfinder/commands/archive",["../elFinder"],function(e){return e.prototype.commands.archive=function(){"use strict";var e,t=this,n=t.fm,i=[];this.variants=[],this.disableOnSearch=!1,this.nextAction={},n.bind("open reload",function(){t.variants=[],$.each(i=n.option("archivers").create||[],function(e,i){t.variants.push([i,n.mime2kind(i)])}),t.change()}),this.getstate=function(t){var a,o=this.files(t),r=o.length,s=r&&!n.isRoot(o[0])&&(n.file(o[0].phash)||{}).write&&!$.grep(o,function(e){return!e.read}).length;return s&&n.searchStatus.state>1&&(a=n.cwd().volumeid,s=r===$.grep(o,function(e){return!(!e.read||0!==e.hash.indexOf(a))}).length),s&&!this._disabled&&i.length&&(r||e&&"pending"==e.state())?0:-1},this.exec=function(a,o){var r,s=this.files(a),l=s.length,c=o||i[0],d=n.file(s[0].phash)||null,p=["errArchive","errPerm","errCreatingTempDir","errFtpDownloadFile","errFtpUploadFile","errFtpMkdir","errArchiveExec","errExtractExec","errRm"];if(e=$.Deferred().fail(function(e){e&&n.error(e)}),!l||!i.length||-1===$.inArray(c,i))return e.reject();if(!d.write)return e.reject(p);for(r=0;r<l;r++)if(!s[r].read)return e.reject(p);return t.mime=c,t.prefix=(l>1?"Archive":s[0].name)+(n.option("archivers").createext?"."+n.option("archivers").createext[c]:""),t.data={targets:t.hashes(a),type:c},n.cwd().hash!==d.hash?n.exec("open",d.hash).done(function(){n.one("cwdrender",function(){n.selectfiles({files:a}),e=$.proxy(n.res("mixin","make"),t)()})}):(n.selectfiles({files:a}),e=$.proxy(n.res("mixin","make"),t)()),e}},e}),e("skylark-elfinder/commands/back",["../elFinder"],function(e){return(e.prototype.commands.back=function(){"use strict";this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+left backspace"}],this.getstate=function(){return this.fm.history.canBack()?0:-1},this.exec=function(){return this.fm.history.back()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/chmod",["../elFinder"],function(e){return e.prototype.commands.chmod=function(){"use strict";this.updateOnSelect=!1;var e=this.fm,t={0:"owner",1:"group",2:"other"},n={read:e.i18n("read"),write:e.i18n("write"),execute:e.i18n("execute"),perm:e.i18n("perm"),kind:e.i18n("kind"),files:e.i18n("files")},i=function(e){return!isNaN(parseInt(e,8)&&parseInt(e,8)<=511)||e.match(/^([r-][w-][x-]){3}$/i)};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div>{dataTable}',itemTitle:'<strong>{name}</strong><span id="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",dataTable:'<table id="{id}-table-perm"><tr><td>{0}</td><td>{1}</td><td>{2}</td></tr></table><div class="">'+n.perm+': <input class="elfinder-tabstop elfinder-focus" id="{id}-perm" type="text" size="4" maxlength="3" value="{value}"></div>',fieldset:'<fieldset id="{id}-fieldset-{level}"><legend>{f_title}{name}</legend><input type="checkbox" value="4" class="elfinder-tabstop" id="{id}-read-{level}-perm"{checked-r}> <label for="{id}-read-{level}-perm">'+n.read+'</label><br><input type="checkbox" value="6" class="elfinder-tabstop" id="{id}-write-{level}-perm"{checked-w}> <label for="{id}-write-{level}-perm">'+n.write+'</label><br><input type="checkbox" value="5" class="elfinder-tabstop" id="{id}-execute-{level}-perm"{checked-x}> <label for="{id}-execute-{level}-perm">'+n.execute+"</label><br>"},this.shortcuts=[{}],this.getstate=function(e){var t=this.fm;return 0==(e=e||t.selected()).length&&(e=[t.cwd().hash]),this.checkstate(this.files(e))?0:-1},this.checkstate=function(e){var t=e.length;if(!t)return!1;var n=$.grep(e,function(e){return!(!(e.isowner&&e.perm&&i(e.perm))||1!=t&&"directory"==e.mime)}).length;return t==n},this.exec=function(e){var a=this.hashes(e),o=this.files(a);o.length||(a=[this.fm.cwd().hash],o=this.files(a));var r,s,l=this.fm,c=$.Deferred().always(function(){l.enable()}),d=this.tpl,p=o.length,u=o[0],h=l.namespace+"-perm-"+u.hash,f=d.main,m=' checked="checked"',g=function(){var e,t=$.trim($("#"+h+"-perm").val());if(!i(t))return!1;w.elfinderdialog("close"),e={cmd:"chmod",targets:a,mode:t},l.request({data:e,notify:{type:"chmod",cnt:p}}).fail(function(e){c.reject(e)}).done(function(t){t.changed&&t.changed.length&&(t.undo={cmd:"chmod",callback:function(){var e=[];return $.each(x,function(t,n){e.push(l.request({data:{cmd:"chmod",targets:n,mode:t},notify:{type:"undo",cnt:n.length}}))}),$.when.apply(null,e)}},t.redo={cmd:"chmod",callback:function(){return l.request({data:e,notify:{type:"redo",cnt:a.length}})}}),c.resolve(t)})},v=function(){for(var e,n="",i=0;i<3;i++)e=0,$("#"+h+"-read-"+t[i]+"-perm").is(":checked")&&(e|=4),$("#"+h+"-write-"+t[i]+"-perm").is(":checked")&&(e|=2),$("#"+h+"-execute-"+t[i]+"-perm").is(":checked")&&(e|=1),n+=e.toString(8);$("#"+h+"-perm").val(n)},b=function(e){if(isNaN(parseInt(e,8))){for(var t=e.split(""),n=[],i=0,a=t.length;i<a;i++)0===i||3===i||6===i?t[i].match(/[r]/i)?n.push(1):t[i].match(/[-]/)&&n.push(0):1===i||4===i||7===i?t[i].match(/[w]/i)?n.push(1):t[i].match(/[-]/)&&n.push(0):t[i].match(/[x]/i)?n.push(1):t[i].match(/[-]/)&&n.push(0);n.splice(3,0,","),n.splice(7,0,",");for(var o=n.join(""),r=o.split(","),s=[],l=0,c=r.length;l<c;l++){var d=parseInt(r[l],2).toString(8);s.push(d)}e=s.join("")}else e=parseInt(e,8).toString(8);return e},y={title:this.title,width:"auto",buttons:function(){var e={};return e[l.i18n("btnApply")]=g,e[l.i18n("btnCancel")]=function(){w.elfinderdialog("close")},e}(),close:function(){$(this).elfinderdialog("destroy")}},w=l.getUI().find("#"+h),x={},k="";return w.length?(w.elfinderdialog("toTop"),$.Deferred().resolve()):(f=f.replace("{class}",p>1?"elfinder-cwd-icon-group":l.mime2class(u.mime)),p>1?r=d.groupTitle.replace("{items}",l.i18n("items")).replace("{num}",p):(r=d.itemTitle.replace("{name}",u.name).replace("{kind}",l.mime2kind(u)),k=l.tmb(u)),s=function(e,i){for(var a,o,r="",s=d.dataTable,c=0;c<3;c++)a=parseInt(e.slice(c,c+1),8),r+=a.toString(8),o=d.fieldset.replace("{f_title}",l.i18n(t[c])).replace("{name}",(p=i[t[c]],p?":"+p:"")).replace(/\{level\}/g,t[c]),s=s.replace("{"+c+"}",o).replace("{checked-r}",4==(4&a)?m:"").replace("{checked-w}",2==(2&a)?m:"").replace("{checked-x}",1==(1&a)?m:"");var p;return s=s.replace("{value}",r).replace("{valueCaption}",n.perm)}(function(e){for(var t,n,i,a="777",o="",r=e.length,s=0;s<r;s++){t=b(e[s].perm),x[t]||(x[t]=[]),x[t].push(e[s].hash),o="";for(var l=0;l<3;l++)n=parseInt(t.slice(l,l+1),8),i=parseInt(a.slice(l,l+1),8),4!=(4&n)&&4==(4&i)&&(i-=4),2!=(2&n)&&2==(2&i)&&(i-=2),1!=(1&n)&&1==(1&i)&&(i-=1),o+=i.toString(8);a=o}return a}(o),1==o.length?o[0]:{}),f=f.replace("{title}",r).replace("{dataTable}",s).replace(/{id}/g,h),(w=this.fmDialog(f,y)).attr("id",h),k&&$("<img/>").on("load",function(){w.find(".elfinder-cwd-icon").addClass(k.className).css("background-image","url('"+k.url+"')")}).attr("src",k.url),$("#"+h+"-table-perm :checkbox").on("click",function(){v()}),$("#"+h+"-perm").on("keydown",function(e){var t=e.keyCode;if(t==$.ui.keyCode.ENTER)return e.stopPropagation(),void g()}).on("focus",function(e){$(this).trigger("select")}).on("keyup",function(e){3==$(this).val().length&&($(this).trigger("select"),function(e){for(var n,i=0;i<3;i++)n=parseInt(e.slice(i,i+1),8),$("#"+h+"-read-"+t[i]+"-perm").prop("checked",!1),$("#"+h+"-write-"+t[i]+"-perm").prop("checked",!1),$("#"+h+"-execute-"+t[i]+"-perm").prop("checked",!1),4==(4&n)&&$("#"+h+"-read-"+t[i]+"-perm").prop("checked",!0),2==(2&n)&&$("#"+h+"-write-"+t[i]+"-perm").prop("checked",!0),1==(1&n)&&$("#"+h+"-execute-"+t[i]+"-perm").prop("checked",!0);v()}($(this).val()))}),c)}},e}),e("skylark-elfinder/commands/colwidth",["../elFinder"],function(e){return e.prototype.commands.colwidth=function(){"use strict";this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return"fixed"===this.fm.getUI("cwd").find("table").css("table-layout")?0:-1},this.exec=function(){return this.fm.getUI("cwd").trigger("colwidth"),$.Deferred().resolve()}},e}),e("skylark-elfinder/commands/copy",["../elFinder"],function(e){return e.prototype.commands.copy=function(){"use strict";this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}],this.getstate=function(e){var t=this.files(e),n=t.length;return n&&$.grep(t,function(e){return!!e.read}).length==n?0:-1},this.exec=function(e){var t=this.fm,n=$.Deferred().fail(function(e){t.error(e)});return $.each(this.files(e),function(e,t){if(!t.read)return!n.reject(["errCopy",t.name,"errPerm"])}),"rejected"==n.state()?n:n.resolve(t.clipboard(this.hashes(e)))}},e}),e("skylark-elfinder/commands/cut",["../elFinder"],function(e){return e.prototype.commands.cut=function(){"use strict";var e=this.fm;this.shortcuts=[{pattern:"ctrl+x shift+insert"}],this.getstate=function(t){var n=this.files(t),i=n.length;return i&&$.grep(n,function(t){return!(!t.read||t.locked||e.isRoot(t))}).length==i?0:-1},this.exec=function(t){var n=$.Deferred().fail(function(t){e.error(t)});return $.each(this.files(t),function(t,i){return!i.read||i.locked||e.isRoot(i)?!n.reject(["errCopy",i.name,"errPerm"]):i.locked?!n.reject(["errLocked",i.name]):void 0}),"rejected"==n.state()?n:n.resolve(e.clipboard(this.hashes(t),!0))}},e}),e("skylark-elfinder/commands/download",["../elFinder"],function(e){return e.prototype.commands.zipdl=function(){},e.prototype.commands.download=function(){"use strict";var e=this,t=this.fm,n=null,i=!1,a=!1,o=!1,r=window.location.pathname||"/",s=function(o,r){var s,l;if(null!==n&&(t.searchStatus.state>1?a=t.searchStatus.mixed:t.leafRoots[t.cwd().hash]&&(s=t.cwd().volumeid,$.each(o,function(e,t){if(0!==t.indexOf(s))return a=!0,!1})),i=t.isCommandEnabled("zipdl",o[0])),a){if(l=n?"zipdl":"download",!(o=$.grep(o,function(e){var i=t.file(e),a=!(!i||!n&&"directory"===i.mime||!t.isCommandEnabled(l,e));return i&&r&&!a&&t.cwdHash2Elm(i.hash).trigger("unselect"),a})).length)return[]}else if(!t.isCommandEnabled("download",o[0]))return[];return $.grep(e.files(o),function(e){var n=!(!e.read||!i&&"directory"==e.mime);return r&&!n&&t.cwdHash2Elm(e.hash).trigger("unselect"),n})};this.linkedCmds=["zipdl"],this.shortcuts=[{pattern:"shift+enter"}],this.getstate=function(e){var n=this.hashes(e),a=n.length,o=this.options.maxRequests||10;return a<1?-1:(a=s(n).length)&&(i||a<=o&&(!t.UA.IE&&!t.UA.Mobile||1==a))?0:-1},t.bind("contextmenu",function(t){var n,i,a,o=e.fm,r=null,s=function(e){var t=e.url||o.url(e.hash);return{icon:"link",node:$("<a/>").attr({href:t,target:"_blank",title:o.i18n("link")}).text(e.name).on("mousedown click touchstart touchmove touchend contextmenu",function(e){e.stopPropagation()}).on("dragstart",function(t){var n=t.dataTransfer||t.originalEvent.dataTransfer||null;if(r=null,n){n.effectAllowed="copyLink",n.setDragImage&&(r=$('<div class="elfinder-drag-helper html5-native">').append(function(e){var t,n=e.mime,i=o.tmb(e);t='<div class="elfinder-cwd-icon '+o.mime2class(n)+' ui-corner-all"/>',i&&(t=$(t).addClass(i.className).css("background-image","url('"+i.url+"')").get(0).outerHTML);return t}(e)).appendTo($(document.body)),n.setDragImage(r.get(0),50,47)),o.UA.IE||(n.setData("elfinderfrom",window.location.href+e.phash),n.setData("elfinderfrom:"+n.getData("elfinderfrom"),""))}}).on("dragend",function(e){r&&r.remove()})}};(e.extra=null,t.data)&&(1===(n=t.data.targets||[]).length&&(i=o.file(n[0]))&&"directory"!==i.mime&&("1"!=i.url?e.extra=s(i):(e.extra={icon:"link",node:$("<a/>").attr({href:"#",title:o.i18n("getLink"),draggable:"false"}).text(i.name).on("click touchstart",function(e){if(!("touchstart"===e.type&&e.originalEvent.touches.length>1)){var t=a.parent();e.stopPropagation(),e.preventDefault(),t.removeClass("ui-state-disabled").addClass("elfinder-button-icon-spinner"),o.request({data:{cmd:"url",target:i.hash},preventDefault:!0}).always(function(e){if(t.removeClass("elfinder-button-icon-spinner"),e.url){var n=o.file(i.hash);n.url=e.url,a.replaceWith(s(i).node)}else t.addClass("ui-state-disabled")})}})},(a=e.extra.node).ready(function(){requestAnimationFrame(function(){a.parent().addClass("ui-state-disabled").css("pointer-events","auto")})}))))}).one("open",function(){t.api>=2.1012&&(n=t.getCommand("zipdl")),o=t.cookieEnabled&&t.api>2.1038&&!t.isCORS}),this.exec=function(t){var n,l,c,d,p,u,h,f,m,g=this.hashes(t),v=this.fm,b=(v.options.url,s(g,!0)),y=$.Deferred(),w="",x={},k=!1,C=function(e){var t;"function"==typeof MouseEvent?t=new MouseEvent("click"):(t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),v.pauseUnloadCheck(!0),e.dispatchEvent(t)},T=function(e){var t="elfdl"+e;2===document.cookie.split(t+"=").length?(u&&clearTimeout(u),document.cookie=t+"=; path="+r+"; max-age=0",z()):setTimeout(function(){T(e)},200)},z=function(){v.ui.notify.children(".elfinder-notify-download").length&&v.notify({type:"download",cnt:-1})},j=[];if(!b.length)return y.reject();if(p=$.grep(b,function(e){return"directory"!==e.mime}).length,c=$("<a>").hide().appendTo("body"),d="string"==typeof c.get(0).download,i&&(p!==b.length||p>=(this.options.minFilesZipdl||1)))return c.remove(),k=!d&&v.UA.Mobile,a?(x={},$.each(b,function(e,t){var n=t.hash.split("_",2);x[n[0]]?x[n[0]].push(t.hash):x[n[0]]=[t.hash]}),!k&&v.UA.Mobile&&Object.keys(x).length>1&&(k=!0)):x=[$.map(b,function(e){return e.hash})],y=v.sequence($.map(x,function(t){return n=t,function(){var t,i,a,o=$.Deferred(),r=v.file(v.root(n[0])),s=1===n.length,c=r?r.i18||r.name:null;return s?(t=v.file(n[0]))&&(i=t.i18||t.name):($.each(n,function(){var e=v.file(this);if(!e||a&&a!==e.phash)return a=null,!1;a=e.phash}),a&&(t=v.file(a))&&(i=(t.i18||t.name)+"-"+n.length)),i&&(c=i),c&&(c=" ("+c+")"),v.request({data:{cmd:"zipdl",targets:n},notify:{type:"zipdl",cnt:1,hideCnt:!0,msg:v.i18n("ntfzipdl")+c},cancel:!0,eachCancel:!0,preventDefault:!0}).done(function(t){var a,r,s,c,p,u,h={},f="dlw"+ +new Date,m=function(t){s=$("<a/>").attr("href",t).attr("download",v.escape(i)).on("click",function(){o.resolve(),r&&r.elfinderdialog("destroy")}),k?(s.attr("target","_blank").append('<span class="elfinder-button-icon elfinder-button-icon-download"></span>'+v.escape(i)),h[v.i18n("btnCancel")]=function(){r.elfinderdialog("destroy")},r=e.fmDialog(s,{title:v.i18n("link"),buttons:h,width:"200px",destroyOnClose:!0,close:function(){"resolved"!==o.state()&&o.resolve()}})):(C(s.hide().appendTo("body").get(0)),s.remove())};t.error?(v.error(t.error),o.resolve()):t.zipdl&&(a=t.zipdl,i?(u=v.splitFileExtention(a.name||""),i+=u[1]?"."+u[1]:".zip"):i=a.name,d&&(!v.UA.Safari||v.isSameOrigin(v.options.url))||k?(l=v.options.url+(-1===v.options.url.indexOf("?")?"?":"&")+"cmd=zipdl&download=1",$.each([n[0],a.file,i,a.mime],function(e,t){l+="&targets%5B%5D="+encodeURIComponent(t)}),$.each(v.customData,function(e,t){l+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),l+="&"+encodeURIComponent(i),v.hasParrotHeaders()?v.getBinaryByUrl({url:l},function(e){e instanceof Blob?(l=(window.URL||window.webkitURL).createObjectURL(e),m(l)):v.error(["errUploadTransfer",v.i18n("kindZIP")])}):m(l)):(c=$('<form action="'+v.options.url+'" method="post" target="'+f+'" style="display:none"/>').append('<input type="hidden" name="cmd" value="zipdl"/>').append('<input type="hidden" name="download" value="1"/>'),$.each([n[0],a.file,i,a.mime],function(e,t){c.append('<input type="hidden" name="targets[]" value="'+v.escape(t)+'"/>')}),$.each(v.customData,function(e,t){c.append('<input type="hidden" name="'+e+'" value="'+v.escape(t)+'"/>')}),c.attr("target",f).appendTo("body"),p=$('<iframe style="display:none" name="'+f+'">').appendTo("body").ready(function(){c.submit().remove(),o.resolve(),setTimeout(function(){p.remove()},2e4)})))}).fail(function(e){e&&v.error(e),o.resolve()}),o.promise()};var n})).always(function(){v.trigger("download",{files:b})});for(j=[],f=$.Deferred().done(function(e){for(n=0;n<e.length;n++)l=e[n],o&&l.substr(0,v.options.url.length)===v.options.url&&(h=v.getRequestId(),j.push(h),l+="&cpath="+r+"&reqid="+h,u=setTimeout(function(){v.notify({type:"download",cnt:1,cancel:v.UA.IE||v.UA.Edge?void 0:function(){j.length&&$.each(j,function(){v.request({data:{cmd:"abort",id:this},preventDefault:!0})}),j=[]}})},v.notifyDelay),T(h)),!d||v.UA.Safari&&!v.isSameOrigin(l)?v.UA.Mobile?setTimeout(function(){window.open(l)||(v.error("errPopup"),u&&cleaerTimeout(u),z())},100):w+='<iframe class="downloader" id="downloader-'+b[n].hash+'" style="display:none" src="'+l+'"/>':C(c.attr("href",l).attr("download",v.escape(b[n].name)).get(0));c.remove(),$(w).appendTo("body").ready(function(){setTimeout(function(){$(w).each(function(){$("#"+$(this).attr("id")).remove()})},2e4+1e4*n)}),v.trigger("download",{files:b}),y.resolve()}),p=b.length,m=[],n=0;n<b.length;n++)v.openUrl(b[n].hash,!0,function(e){e&&m.push(e),--p<1&&f.resolve(m)});return y}},e}),e("skylark-elfinder/commands/duplicate",["../elFinder"],function(e){return e.prototype.commands.duplicate=function(){"use strict";var e=this.fm;this.getstate=function(t){var n=this.files(t),i=n.length;return i&&e.cwd().write&&$.grep(n,function(t){return!(!t.read||t.phash!==e.cwd().hash||e.isRoot(t))}).length==i?0:-1},this.exec=function(e){var t=this.fm,n=this.files(e),i=n.length,a=$.Deferred().fail(function(e){e&&t.error(e)});return i?($.each(n,function(e,n){if(!n.read||!t.file(n.phash).write)return!a.reject(["errCopy",n.name,"errPerm"])}),"rejected"==a.state()?a:t.request({data:{cmd:"duplicate",targets:this.hashes(e)},notify:{type:"copy",cnt:i},navigate:{toast:{inbuffer:{msg:t.i18n(["complete",t.i18n("cmdduplicate")])}}}})):a.reject()}},e}),e("skylark-elfinder/commands/edit",["../elFinder"],function(e){return e.prototype.commands.edit=function(){"use strict";var e,t=this,n=this.fm,i=n.res("class","editing"),a=[],o=[],r=!1,s=function(e){var i,a=$('<select class="ui-corner-all"/>');return e&&$.each(e,function(e,t){i=n.escape(t.value),a.append('<option value="'+i+'">'+(t.caption?n.escape(t.caption):i)+"</option>")}),$.each(t.options.encodings,function(e,t){a.append('<option value="'+t+'">'+t+"</option>")}),a},l=function(e){var i,s,l,c=e.length;return c>1&&(i=e[0].mime,s=e[0].name.replace(/^.*(\.[^.]+)$/,"$1")),$.grep(e,function(e){var d;return!l&&"directory"!==e.mime&&((d=e.read&&(r||n.mimeIsText(e.mime)||-1!==$.inArray(e.mime,1===c?a:o))&&(!t.onlyMimes.length||-1!==$.inArray(e.mime,t.onlyMimes))&&(1===c||e.mime===i&&e.name.substr(-1*s.length)===s)&&!!n.uploadMimeCheck(e.mime,e.phash)&&f(e,c)&&Object.keys(u).length)||(l=!0),d)})},c=function(e){var t,i=n.file(e);n.request({cmd:"info",targets:[e],preventDefault:!0}).done(function(e){var a;e&&e.files&&e.files.length&&(t=e.files[0],i.ts==t.ts&&i.size==t.size||(a={changed:[t]},n.updateCache(a),n.change(a)))})},d=function(e,a,o,r,l,d){var u,h,f,m,g,b,y=$.Deferred(),w=!1,x=function(){return!!w||(n.toast({mode:"warning",msg:n.i18n("nowLoading")}),!1)},k=function(){d&&Array.isArray(d)&&$.each(d,function(){this.msg&&n.toast(this)})},C=function(){var e,t,i,a=m?m.val():void 0,o=$.Deferred().fail(function(e){f.show().find("button.elfinder-btncnt-0,button.elfinder-btncnt-1").hide()});return x()?(u.editor&&(u.editor.save(u[0],u.editor.instance),(e=u.editor.confObj).info&&(e.info.schemeContent||e.info.arrayBufferContent)&&(a="scheme")),t=M(),S(t),t.promise?(i=setTimeout(function(){n.notify({type:"chkcontent",cnt:1,hideCnt:!0,cancel:function(){t.reject()}})},100),t.always(function(){i&&clearTimeout(i),n.notify({type:"chkcontent",cnt:-1})}).done(function(e){y.notifyWith(u,[a,u.data("hash"),h,o])}).fail(function(e){o.reject(e)})):y.notifyWith(u,[a,u.data("hash"),h,o]),o):o.resolve()},T=function(){x()&&C().fail(function(e){e&&n.error(e)})},z=function(){u.elfinderdialog("close")},j=function(){x()&&(f.hide(),C().done(function(){w=!1,f.show(),z()}).fail(function(e){f.show(),e&&n.error(e)}))},A=function(){if(x()){var e=h,o=a.phash,r=function(t){d.addClass(i).fadeIn(function(){t&&n.error(t)}),h=e,n.disable()},s=function(){t.mime=D.mime||a.mime,t.prefix=(D.name||a.name).replace(/ \d+(\.[^.]+)?$/,"$1"),t.requestCmd="mkfile",t.nextAction={},t.data={target:o},$.proxy(n.res("mixin","make"),t)().done(function(e){var t;e.added&&e.added.length?(t=u.data("hash"),u.data("hash",e.added[0].hash),C().done(function(){w=!1,f.show(),z(),d.fadeIn()}).fail(function(){n.exec("rm",[e.added[0].hash],{forceRm:!0,quiet:!0}),u.data("hash",t),f.find("button.elfinder-btncnt-2").hide(),r()})):r()}).progress(function(e){e&&"errUploadMime"===e&&u.trigger("saveAsFail")}).fail(r).always(function(){delete t.mime,delete t.prefix,delete t.nextAction,delete t.data}),n.trigger("unselectfiles",{files:[a.hash]})},l=null,c=null,d=n.getUI().children("."+t.dialogClass+":visible");f.is(":hidden")&&(d=d.add(f)),d.removeClass(i).fadeOut(),n.enable(),n.searchStatus.state<2&&o!==n.cwd().hash?l=n.exec("open",[o],{thash:o}):n.file(o)||(c=n.request({cmd:"info",targets:[o]})),$.when([l,c]).done(function(){c?n.one("infodone",function(){n.file(o)?s():r("errFolderNotFound")}):l?n.one("cwdrender",s):s()}).fail(r)}},O=function(){var e,t,i=$.Deferred();return w?(u.editor&&u.editor.save(u[0],u.editor.instance),(e=M())&&e.promise?(t=setTimeout(function(){n.notify({type:"chkcontent",cnt:1,hideCnt:!0,cancel:function(){e.reject()}})},100),e.always(function(){t&&clearTimeout(t),n.notify({type:"chkcontent",cnt:-1})}).done(function(e){i.resolve(h!==e)}).fail(function(e){i.resolve(e||void 0!==h)})):i.resolve(h!==e),i):i.resolve(!1)},I={title:n.escape(a.name),width:function(){var e,i,a=n.options.dialogContained?n.getUI():$(window);i="string"==typeof t.options.dialogWidth&&(e=t.options.dialogWidth.match(/(\d+)%/))?parseInt(a.width()*(e[1]/100)):parseInt(t.options.dialogWidth||650);return Math.min(i,a.width())}(),height:function(){if(!t.options.dialogHeight)return;var e,i,a=n.options.dialogContained?n.getUI():$(window);i="string"==typeof t.options.dialogHeight&&(e=t.options.dialogHeight.match(/(\d+)%/))?parseInt(a.height()*(e[1]/100)):parseInt(t.options.dialogHeight||a.height());return Math.min(i,a.height())}(),buttons:{},cssClass:i,maxWidth:"window",maxHeight:"window",allowMinimize:!0,allowMaximize:!0,openMaximized:v()||l&&l.info&&l.info.openMaximized,btnHoverFocus:!1,closeOnEscape:!1,propagationEvents:["mousemove","mouseup","click"],minimize:function(){var e;u.editor&&f.closest(".ui-dialog").is(":hidden")&&(e=u.editor.confObj).info&&e.info.syncInterval&&c(a.hash)},close:function(){var e=function(){var e;y.resolve(),u.editor&&(u.editor.close(u[0],u.editor.instance),(e=u.editor.confObj).info&&e.info.syncInterval&&c(a.hash)),u.elfinderdialog("destroy")},i=void 0!==D.name,o=i?{label:"btnSaveAs",callback:function(){requestAnimationFrame(A)}}:{label:"btnSaveClose",callback:function(){C().done(function(){e()})}};O().done(function(a){var r=["confirmNotSave"];a?("string"==typeof a&&r.unshift(a),n.confirm({title:t.title,text:r,accept:o,cancel:{label:"btnClose",callback:e},buttons:i?null:[{label:"btnSaveAs",callback:function(){requestAnimationFrame(A)}}]})):e()})},open:function(){var t,i,r;if(u.initEditArea.call(u,e,a,o,n),u.editor){if((t=u.editor.load(u[0])||null)&&t.done)t.always(function(){w=!0}).done(function(e){u.editor.instance=e,u.editor.focus(u[0],u.editor.instance),S(M()),requestAnimationFrame(function(){f.trigger("resize")})}).fail(function(e){e&&n.error(e),u.elfinderdialog("destroy")}).always(k);else{if(w=!0,t&&("string"==typeof t||Array.isArray(t)))return n.error(t),void u.elfinderdialog("destroy");u.editor.instance=t,u.editor.focus(u[0],u.editor.instance),S(M()),requestAnimationFrame(function(){f.trigger("resize")}),k()}(i=u.editor.confObj).info&&i.info.syncInterval&&(r=parseInt(i.info.syncInterval))&&setTimeout(function(){F(r)},r)}else w=!0,S(M())},resize:function(e,t){u.editor&&u.editor.resize(u[0],u.editor.instance,e,t||{})}},M=function(){var e=u.getContent.call(u,u[0]);return void 0!==e&&!1!==e&&null!==e||(e=$.Deferred().reject()),e},S=function(e){e&&e.promise?e.done(function(e){h=e}):h=e},F=function(e){f.is(":visible")&&(c(a.hash),setTimeout(function(){F(e)},e))},E=function(){m&&O().done(function(e){e?m.attr("title",n.i18n("saveAsEncoding")).addClass("elfinder-edit-changed"):m.attr("title",n.i18n("openAsEncoding")).removeClass("elfinder-edit-changed")})},D={};if(l&&(l.html&&(u=$(l.html)),g={init:l.init||null,load:l.load,getContent:l.getContent||null,save:l.save,beforeclose:"function"==typeof l.beforeclose?l.beforeclose:void 0,close:"function"==typeof l.close?l.close:function(){},focus:"function"==typeof l.focus?l.focus:function(){},resize:"function"==typeof l.resize?l.resize:function(){},instance:null,doSave:T,doCancel:z,doClose:j,file:a,fm:n,confObj:l,trigger:function(e,t){n.trigger("editEditor"+e,Object.assign({},l.info||{},t))}}),!u){if(!n.mimeIsText(a.mime))return y.reject("errEditorNotFound");u=$('<textarea class="elfinder-file-edit" rows="20" id="'+e+'-ta"></textarea>').on("input propertychange",E),l&&l.info&&!l.info.useTextAreaEvent||u.on("keydown",function(e){var t,n,i=e.keyCode;e.stopPropagation(),i==$.ui.keyCode.TAB&&(e.preventDefault(),this.setSelectionRange&&(t=this.value,n=this.selectionStart,this.value=t.substr(0,n)+"\t"+t.substr(this.selectionEnd),n+=1,this.setSelectionRange(n,n))),(e.ctrlKey||e.metaKey)&&(i!="Q".charCodeAt(0)&&i!="W".charCodeAt(0)||(e.preventDefault(),z()),i=="S".charCodeAt(0)&&(e.preventDefault(),T()))}).on("mouseenter",function(){this.focus()}),u.initEditArea=function(e,t,n){u.hide().val(n),this._setupSelEncoding(n)}}return u._setupSelEncoding=function(e){var t=r&&"unknown"!==r?[{value:r}]:[],i=$("<select/>").hide(),o=function(e){e&&i.appendTo(m.parent()),i.empty().append($("<option/>").text(m.val())),m.width(i.width())};""!==e&&r&&"UTF-8"===r||t.push({value:"UTF-8"}),m=s(t).on("touchstart",function(e){e.stopPropagation()}).on("change",function(){O().done(function(e){e||""===M()||(z(),p(a,m.val(),l).fail(function(e){e&&n.error(e)}))}),o()}).on("mouseover",E),u.parent().next().prepend($('<div class="ui-dialog-buttonset elfinder-edit-extras"/>').append(m)),o(!0)},u.data("hash",a.hash),g&&(u.editor=g,"function"==typeof g.beforeclose&&(I.beforeclose=function(){return g.beforeclose(u[0],g.instance)}),"function"==typeof g.init&&(u.initEditArea=g.init),"function"==typeof g.getContent&&(u.getContent=g.getContent)),u.initEditArea||(u.initEditArea=function(){}),u.getContent||(u.getContent=function(){return u.val().replace(/\s+$/,"")}),l&&l.info&&l.info.preventGet||(I.buttons[n.i18n("btnSave")]=T,I.buttons[n.i18n("btnSaveClose")]=j,I.buttons[n.i18n("btnSaveAs")]=A,I.buttons[n.i18n("btnCancel")]=z),l&&"function"==typeof l.prepare&&l.prepare(u,I,a),f=t.fmDialog(u,I).attr("id",e).on("keydown keyup keypress",function(e){e.stopPropagation()}).css({overflow:"hidden",minHeight:"7em"}).addClass("elfinder-edit-editor").closest(".ui-dialog").on("changeType",function(e,t){if(t.extention&&t.mime){t.extention,t.mime;var i=$(this).children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset");i.children(".elfinder-btncnt-0,.elfinder-btncnt-1").hide(),D.name=n.splitFileExtention(a.name)[0]+"."+t.extention,D.mime=t.mime,t.keepEditor||i.children(".elfinder-btncnt-2").trigger("click")}}),b=(n.options.dialogContained?n.getUI():$(window)).width(),f.width()>b&&f.width(b),y.promise()},p=function(e,i,a){var o,r,l,c=e.hash,u=(n.options,$.Deferred()),h="edit-"+n.namespace+"-"+e.hash,f=n.getUI().find("#"+h),m=i||0,g=!1;if(f.length)return f.elfinderdialog("toTop"),u.resolve();if(!(e.read&&(e.write||a.info&&a.info.converter)))return r=["errOpen",e.name,"errPerm"],u.reject(r);if(a&&a.info){if("function"==typeof a.info.edit)return(l=a.info.edit.call(n,e,a)).promise?l.done(function(){u.resolve()}).fail(function(e){u.reject(e)}):l?u.resolve():u.reject(),u;g=a.info.preventGet||a.info.noContent,a.info.urlAsContent||g?(o=$.Deferred(),a.info.urlAsContent?n.url(c,{async:!0,onetime:!0,temporary:!0}).done(function(e){o.resolve({content:e})}):o.resolve({})):(m&&(e.encoding=m,n.cache(e,"change")),o=n.request({data:{cmd:"get",target:c,conv:m,_t:e.ts},options:{type:"get",cache:!0},notify:{type:"file",cnt:1},preventDefault:!0})),o.done(function(i){var o,r,l;i.doconv?n.confirm({title:t.title,text:"unknown"===i.doconv?"confirmNonUTF8":"confirmConvUTF8",accept:{label:"btnConv",callback:function(){u=p(e,o.val(),a)}},cancel:{label:"btnCancel",callback:function(){u.reject()}},optionsCallback:function(e){e.create=function(){var e=$('<div class="elfinder-dialog-confirm-encoding"/>'),t={value:i.doconv};"unknown"===i.doconv&&(t.caption="-"),o=s([t]),$(this).next().find(".ui-dialog-buttonset").prepend(e.append($("<label>"+n.i18n("encoding")+" </label>").append(o)))}}}):(!g&&n.mimeIsText(e.mime)&&(r=new RegExp("^(data:"+e.mime.replace(/([.+])/g,"\\$1")+";base64,)","i"),a.info.dataScheme?window.btoa&&!i.content.match(r)&&(i.content="data:"+e.mime+";base64,"+btoa(i.content)):window.atob&&(l=i.content.match(r))&&(i.content=atob(i.content.substr(l[1].length)))),d(h,e,i.content,i.encoding,a,i.toasts).done(function(e){u.resolve(e)}).progress(function(e,t,i,a){var o=this;t&&(c=t),n.request({options:{type:"post"},data:{cmd:"put",target:c,encoding:e||i.encoding,content:i},notify:{type:"save",cnt:1},syncOnFail:!0,preventFail:!0,navigate:{target:"changed",toast:{inbuffer:{msg:n.i18n(["complete",n.i18n("btnSave")])}}}}).fail(function(e){u.reject(e),a.reject()}).done(function(e){requestAnimationFrame(function(){o.trigger("focus"),o.editor&&o.editor.focus(o[0],o.editor.instance)}),a.resolve()})}).fail(function(e){u.reject(e)}))}).fail(function(t){var i=n.parseError(t);i=Array.isArray(i)?i[0]:i,e.encoding&&(e.encoding="",n.cache(e,"change")),"errConvUTF8"!==i&&n.sync(),u.reject(t)})}return u.promise()},u={},h={info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}}),e.setSelectionRange&&e.setSelectionRange(0,0),$(e).trigger("focus").show()},save:function(){}},f=function(i,a){var o=t.options.editors||[],r=n.cwd().write;return e=n.storage("storedEditors")||{},u={},o.length||(o=[h]),$.each(o,function(e,t){var o;(1===a||!t.info.single)&&(t.info&&t.info.converter?r:i.write)&&(i.size>0||!t.info.converter&&!1!==t.info.canMakeEmpty&&n.mimesCanMakeEmpty[i.mime])&&(!t.info.maxSize||i.size<=t.info.maxSize)&&function(e,t){if(t){if("*"===t[0]||-1!==$.inArray(e,t))return!0;var i,a;for(a=t.length,i=0;i<a;i++)if(0===e.indexOf(t[i]))return!0;return!1}return n.mimeIsText(e)}(i.mime,t.mimes||null)&&function(e,t){if(!t||!t.length)return!0;var n,i,a=e.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase();for(i=t.length,n=0;n<i;n++)if(a===t[n].toLowerCase())return!0;return!1}(i.name,t.exts||null)&&"function"==typeof t.load&&"function"==typeof t.save&&(o=t.info.name?t.info.name:"Editor "+e,t.id=t.info.id?t.info.id:"editor"+e,t.name=o,t.i18n=n.i18n(o),u[t.id]=t)}),!!Object.keys(u).length},m=function(t,i){t&&i&&($.isPlainObject(e)||(e={}),e[t]=i.id,n.storage("storedEditors",e),n.trigger("selectfiles",{files:n.selected()}))},g=function(){var e=n.storage("useStoredEditor");return e?e>0:t.options.useStoredEditor},v=function(){var e=n.storage("editorMaximized");return e?e>0:t.options.editorMaximized},b=function(e,t){var i=[];return $.each(u,function(a,o){i.push({label:n.escape(o.i18n),icon:o.info&&o.info.icon?o.info.icon:"edit",options:{iconImg:o.info&&o.info.iconImg?n.baseUrl+o.info.iconImg:void 0},callback:function(){m(e[0].mime,o),t&&t.call(o)}})}),i},y=function(t){var n=e[t];return n&&Object.keys(u).length?u[function(e){return e.toLowerCase().replace(/ +/g,"")}(n)]:void 0};this.getEncSelect=s,this.shortcuts=[{pattern:"ctrl+e"}],this.init=function(){var e,t,n=this,i=this.fm,s=this.options,l=[];this.onlyMimes=this.options.mimes||[],i.one("open",function(){s.editors&&Array.isArray(s.editors)&&(i.trigger("canMakeEmptyFile",{mimes:Object.keys(i.storage("mkfileTextMimes")||{}).concat(s.makeTextMimes||["text/plain"])}),$.each(s.editors,function(e,t){t.info&&t.info.cmdCheck&&l.push(t.info.cmdCheck)}),l.length?i.api>=2.103?t=i.request({data:{cmd:"editor",name:l,method:"enabled"},preventDefault:!0}).done(function(t){e=t}).fail(function(){e={}}):(e={},t=$.Deferred().resolve()):t=$.Deferred().resolve(),t.always(function(){e&&(s.editors=$.grep(s.editors,function(t){return!t.info||!t.info.cmdCheck||!!e[t.info.cmdCheck]})),$.each(s.editors,function(e,t){t.setup&&"function"==typeof t.setup&&t.setup.call(t,s,i),t.disabled||(t.mimes&&Array.isArray(t.mimes)&&(a=a.concat(t.mimes),t.info&&t.info.single||(o=o.concat(t.mimes))),!r&&t.mimes&&"*"===t.mimes[0]&&(r=!0),t.info||(t.info={}),t.info.integrate&&i.trigger("helpIntegration",Object.assign({cmd:"edit"},t.info.integrate)),t.info.canMakeEmpty&&i.trigger("canMakeEmptyFile",{mimes:Array.isArray(t.info.canMakeEmpty)?t.info.canMakeEmpty:t.mimes}))}),a=($.uniqueSort||$.unique)(a),o=($.uniqueSort||$.unique)(o),s.editors=$.grep(s.editors,function(e){return!e.disabled})}))}).bind("select",function(){u=null}).bind("contextmenucreate",function(e){var t,a,o=function(e){var t=n.title;i.one("contextmenucreatedone",function(){n.title=t}),n.title=i.escape(e.i18n),e.info&&e.info.iconImg&&(n.contextmenuOpts={iconImg:i.baseUrl+e.info.iconImg}),delete n.variants};n.contextmenuOpts=void 0,"files"===e.data.type&&n.enabled()&&(t=i.file(e.data.targets[0]),f(t,e.data.targets.length)&&(Object.keys(u).length>1?g()&&(a=y(t.mime))?(o(a),n.extra={icon:"menu",node:$("<span/>").attr({title:i.i18n("select")}).on("click touchstart",function(e){if(!("touchstart"===e.type&&e.originalEvent.touches.length>1)){var t=$(this);e.stopPropagation(),e.preventDefault(),i.trigger("contextmenu",{raw:b(i.selectedFiles(),function(){var e=i.selected();i.exec("edit",e,{editor:this}),i.trigger("selectfiles",{files:e})}),x:t.offset().left,y:t.offset().top})}})}):(delete n.extra,n.variants=[],$.each(u,function(e,t){n.variants.push([{editor:t},t.i18n,t.info&&t.info.iconImg?i.baseUrl+t.info.iconImg:"edit"])})):(o(u[Object.keys(u)[0]]),delete n.extra)))}).bind("canMakeEmptyFile",function(e){if(e.data&&e.data.resetTexts){var t=i.arrayFlip(n.options.makeTextMimes||["text/plain"]),a=n.getMkfileHides();$.each(i.storage("mkfileTextMimes")||{},function(e,n){t[e]||(delete i.mimesCanMakeEmpty[e],delete a[e])}),i.storage("mkfileTextMimes",null),Object.keys(a).length?i.storage("mkfileHides",a):i.storage("mkfileHides",null)}})},this.getstate=function(e){var t=this.files(e),n=t.length;return n&&l(t).length==n?0:-1},this.exec=function(e,t){var n,i,a=this.fm,o=l(this.files(e)),r=$.map(o,function(e){return e.hash}),s=[],c=t&&t.editor?t.editor:null,d=$(t&&t._currentNode?t._currentNode:a.cwdHash2Elm(r[0])),h=$.Deferred();return null===u&&f(o[0],r.length),d.length||(d=a.getUI("cwd")),(i=$.Deferred(),!c&&Object.keys(u).length>1?g()&&(c=y(o[0].mime))?i.resolve(c):(a.trigger("contextmenu",{raw:b(o,function(){i.resolve(this)}),x:d.offset().left,y:d.offset().top+22,opened:function(){a.one("closecontextmenu",function(){requestAnimationFrame(function(){"pending"===i.state()&&i.reject()})})}}),a.trigger("selectfiles",{files:r}),i):(Object.keys(u).length>1&&c&&m(o[0].mime,c),i.resolve(c||(Object.keys(u).length?u[Object.keys(u)[0]]:null)))).done(function(e){for(;n=o.shift();)s.push(p(n,n.encoding||void 0,e).fail(function(e){e&&a.error(e)}));s.length?$.when.apply(null,s).done(function(){h.resolve()}).fail(function(){h.reject()}):h.reject()}).fail(function(){h.reject()}),h},this.getMkfileHides=function(){return n.storage("mkfileHides")||n.arrayFlip(t.options.mkfileHideMimes||[])}},e}),e("skylark-elfinder/commands/empty",["../elFinder"],function(e){return e.prototype.commands.empty=function(){"use strict";var e,t,n=function(n){var i=e.files(n);return i.length||(i=[t.cwd()]),i};this.linkedCmds=["rm"],this.init=function(){e=this,t=this.fm},this.getstate=function(e){var t,i=n(e);return t=i.length,$.grep(i,function(e){return!(!e.read||!e.write||"directory"!==e.mime)}).length==t?0:-1},this.exec=function(e){var i=n(e),a=i.length,o=$.Deferred().done(function(){var e={changed:{}};t.toast({msg:t.i18n(['"'+r.join('", ')+'"',"complete",t.i18n("cmdempty")])}),$.each(i,function(t,n){e.changed[n.hash]=n}),t.change(e)}).always(function(){var e=t.cwd().hash;t.trigger("selectfiles",{files:$.map(i,function(t){return e===t.phash?t.hash:null})})}),r=[],s=function(e){"number"==typeof e?(r.push(i[e].name),delete i[e].dirs):e&&t.error(e),--a<1&&o[r.length?"resolve":"reject"]()};return $.each(i,function(e,n){var i;return n.write&&"directory"===n.mime?t.isCommandEnabled("rm",n.hash)?(i=setTimeout(function(){t.notify({type:"search",cnt:1,hideCnt:!(a>1)})},t.notifyDelay),void t.request({data:{cmd:"open",target:n.hash},preventDefault:!0,asNotOpen:!0}).done(function(o){var r=[];i&&clearTimeout(i),t.ui.notify.children(".elfinder-notify-search").length&&t.notify({type:"search",cnt:-1,hideCnt:!(a>1)}),o&&o.files&&o.files.length?o.files.length>t.maxTargets?s(["errEmpty",n.name,"errMaxTargets",t.maxTargets]):(t.updateCache(o),$.each(o.files,function(e,t){if(!t.write||t.locked)return s(["errEmpty",n.name,"errRm",t.name,"errPerm"]),r=[],!1;r.push(t.hash)}),r.length&&t.exec("rm",r,{_userAction:!0,addTexts:[t.i18n("folderToEmpty",n.name)]}).fail(function(e){t.trigger("unselectfiles",{files:t.selected()}),s(t.parseError(e)||"")}).done(function(){s(e)})):(t.toast({mode:"warning",msg:t.i18n("filderIsEmpty",n.name)}),s(""))}).fail(function(e){s(t.parseError(e)||"")})):(s(["errCmdNoSupport",'"rm"']),null):(s(["errEmpty",n.name,"errPerm"]),null)}),o}},e}),e("skylark-elfinder/commands/extract",["../elFinder"],function(e){return e.prototype.commands.extract=function(){"use strict";var e=this,t=e.fm,n=[];this.variants=[],this.disableOnSearch=!0,t.bind("open reload",function(){n=t.option("archivers").extract||[],t.api>2?e.variants=[[{makedir:!0},t.i18n("cmdmkdir")],[{},t.i18n("btnCwd")]]:e.variants=[[{},t.i18n("btnCwd")]],e.change()}),this.getstate=function(e){var t,i=this.files(e),a=i.length;return a&&this.fm.cwd().write&&(t=i,$.grep(t,function(e){return!(!e.read||-1===$.inArray(e.mime,n))})).length==a?0:-1},this.exec=function(e,i){var a,o,r,s=this.files(e),l=$.Deferred(),c=s.length,d=i&&i.makedir?1:0,p=!1,u=!1,h=0,f=$.map(t.files(e),function(e){return e.name}),m={};$.grep(t.files(e),function(e){return m[e.name]=e,!1});var g=function(e){switch(e){case"overwrite_all":p=!0;break;case"omit_all":u=!0}},v=function(e){e.read&&t.file(e.phash).write?-1===$.inArray(e.mime,n)?(o=["errExtract",e.name,"errNoArchive"],t.error(o),l.reject(o)):t.request({data:{cmd:"extract",target:e.hash,makedir:d},notify:{type:"extract",cnt:1},syncOnFail:!0,navigate:{toast:d?{incwd:{msg:t.i18n(["complete",t.i18n("cmdextract")]),action:{cmd:"open",msg:"cmdopen"}},inbuffer:{msg:t.i18n(["complete",t.i18n("cmdextract")]),action:{cmd:"open",msg:"cmdopen"}}}:{inbuffer:{msg:t.i18n(["complete",t.i18n("cmdextract")])}}}}).fail(function(e){"rejected"!=l.state()&&l.reject(e)}).done(function(){}):(o=["errExtract",e.name,"errPerm"],t.error(o),l.reject(o))},b=function(e,n){var i=e[n],o=t.splitFileExtention(i.name)[0],s=$.inArray(o,f)>=0,y=function(){n+1<c?b(e,n+1):l.resolve()};!d&&s&&"directory"!=m[o].mime?t.confirm({title:t.i18n("ntfextract"),text:["errExists",o,"confirmRepl"],accept:{label:"btnYes",callback:function(t){if(g(r=t?"overwrite_all":"overwrite"),p||u){if(p){for(a=n;a<c;a++)v(e[a]);l.resolve()}}else"overwrite"==r&&v(i),n+1<c?b(e,n+1):l.resolve()}},reject:{label:"btnNo",callback:function(t){g(r=t?"omit_all":"omit"),!p&&!u&&n+1<c?b(e,n+1):u&&l.resolve()}},cancel:{label:"btnCancel",callback:function(){l.resolve()}},all:n+1<c}):d?(v(i),y()):0==h?t.confirm({title:t.i18n("cmdextract"),text:[t.i18n("cmdextract")+' "'+i.name+'"',"confirmRepl"],accept:{label:"btnYes",callback:function(e){e&&(h=1),v(i),y()}},reject:{label:"btnNo",callback:function(e){e&&(h=-1),y()}},cancel:{label:"btnCancel",callback:function(){l.resolve()}},all:n+1<c}):(h>0&&v(i),y())};return this.enabled()&&c&&n.length?(c>0&&b(s,0),l):l.reject()}},e}),e("skylark-elfinder/commands/forward",["../elFinder"],function(e){return(e.prototype.commands.forward=function(){"use strict";this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+right"}],this.getstate=function(){return this.fm.history.canForward()?0:-1},this.exec=function(){return this.fm.history.forward()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/fullscreen",["../elFinder"],function(e){return e.prototype.commands.fullscreen=function(){"use strict";var e=this,t=this.fm,n=function(t,n){t.preventDefault(),t.stopPropagation(),n&&n.fullscreen&&e.update(void 0,"on"===n.fullscreen)};this.alwaysEnabled=!0,this.updateOnSelect=!1,this.syncTitleOnChange=!0,this.value=!1,this.options={ui:"fullscreenbutton"},this.getstate=function(){return 0},this.exec=function(){var n=t.getUI().get(0),i=n===t.toggleFullscreen(n);return e.title=t.i18n(i?"reinstate":"cmdfullscreen"),e.update(void 0,i),$.Deferred().resolve()},t.bind("init",function(){t.getUI().off("resize."+t.namespace,n).on("resize."+t.namespace,n)})},e}),e("skylark-elfinder/commands/getfile",["../elFinder"],function(e){return(e.prototype.commands.getfile=function(){"use strict";var e=this,t=this.fm;this.alwaysEnabled=!0,this.callback=t.options.getFileCallback,this._disabled="function"==typeof this.callback,this.getstate=function(t){var n,i,a=this.files(t),o=a.length;return this.callback&&o&&(n=a,i=e.options,n=$.grep(n,function(e){return!("directory"==e.mime&&!i.folders||!e.read)}),i.multiple||1==n.length?n:[]).length==o?0:-1},this.exec=function(t){var n,i,a,o=this.fm,r=this.options,s=this.files(t),l=s.length,c=o.option("url"),d=o.option("tmbUrl"),p=$.Deferred().done(function(t){var n,i=function(){"close"==r.oncomplete?o.hide():"destroy"==r.oncomplete&&o.destroy()},a=function(e){"close"==r.onerror?o.hide():"destroy"==r.onerror?o.destroy():e&&o.error(e)};o.trigger("getfile",{files:t});try{n=e.callback(t,o)}catch(e){return void a(["Error in `getFileCallback`.",e.message])}"object"==typeof n&&"function"==typeof n.done?n.done(i).fail(a):i()}),u=function(e){return r.onlyURL?r.multiple?$.map(s,function(e){return e.url}):s[0].url:r.multiple?s:s[0]},h=[];for(n=0;n<l;n++){if("directory"==(i=s[n]).mime&&!r.folders)return p.reject();i.baseUrl=c,"1"==i.url?h.push(o.request({data:{cmd:"url",target:i.hash},notify:{type:"url",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){if(e.url){var t=o.file(this.hash);t.url=this.url=e.url}}.bind(i))):i.url=o.url(i.hash),r.onlyURL||(r.getPath&&(i.path=o.path(i.hash),""===i.path&&i.phash&&function(){var e=$.Deferred();h.push(e),o.path(i.hash,!1,{}).done(function(e){i.path=e}).fail(function(){i.path=""}).always(function(){e.resolve()})}()),i.tmb&&1!=i.tmb&&(i.tmb=d+i.tmb),i.width||i.height||(i.dim?(a=i.dim.split("x"),i.width=a[0],i.height=a[1]):r.getImgSize&&-1!==i.mime.indexOf("image")&&h.push(o.request({data:{cmd:"dim",target:i.hash},notify:{type:"dim",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){if(e.dim){var t=e.dim.split("x"),n=o.file(this.hash);n.width=this.width=t[0],n.height=this.height=t[1]}}.bind(i)))))}return h.length?($.when.apply(null,h).always(function(){p.resolve(u(s))}),p):p.resolve(u(s))}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/help",["../elFinder"],function(e){return(e.prototype.commands.help=function(){"use strict";var e,t,n,i,a,o,r=this.fm,s=this,l='<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}</a></div>',c='<div class="elfinder-help-team"><div>{author}</div>{work}</div>',d=/\{url\}/,p=/\{link\}/,u=/\{author\}/,h=/\{work\}/,f="replace",m="ui-priority-primary",g="ui-priority-secondary",v="elfinder-help-license",b='<li class="'+r.res("class","tabstab")+' elfinder-help-tab-{id}"><a href="#'+r.namespace+'-help-{id}" class="ui-tabs-anchor">{title}</a></li>',y=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'],w='<div class="elfinder-help-separator"/>',x=$("base").length?document.location.href.replace(/#.*$/,""):"",k=r.res("class","tabsactive"),C=function(){return r.theme&&r.theme.author?c[f]("elfinder-help-team","elfinder-help-team elfinder-help-term-theme")[f](u,r.i18n(r.theme.author)+(r.theme.email?" &lt;"+r.theme.email+"&gt;":""))[f](h,r.i18n("theme")+" ("+r.i18n(r.theme.name)+")"):'<div class="elfinder-help-team elfinder-help-term-theme" style="display:none"></div>'},T=!1,z=!1,j="";this.alwaysEnabled=!0,this.updateOnSelect=!1,this.state=-1,this.shortcuts=[{pattern:"f1",description:this.title}],r.bind("load",function(){var A,O,I,M,S,F,E=s.options.view||["about","shortcuts","help","integrations","debug"];-1!==(A=$.inArray("preference",E))&&E.splice(A,1),$.fn.tabs||-1!==(A=$.inArray(E,"debug"))&&E.splice(A,1),$.each(E,function(e,t){y.push(b[f](/\{id\}/g,t)[f](/\{title\}/,r.i18n(t)))}),y.push("</ul>"),-1!==$.inArray("about",E)&&function(){y.push('<div id="'+r.namespace+'-help-about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>'),y.push("<h3>elFinder</h3>"),y.push('<div class="'+m+'">'+r.i18n("webfm")+"</div>"),y.push('<div class="'+g+'">'+r.i18n("ver")+": "+r.version+"</div>"),y.push('<div class="'+g+'">'+r.i18n("protocolver")+': <span class="apiver"></span></div>'),y.push('<div class="'+g+'">jQuery/jQuery UI: '+$().jquery+"/"+$.ui.version+"</div>"),y.push(w),y.push(l[f](d,"https://studio-42.github.io/elFinder/")[f](p,r.i18n("homepage"))),y.push(l[f](d,"https://github.com/Studio-42/elFinder/wiki")[f](p,r.i18n("docs"))),y.push(l[f](d,"https://github.com/Studio-42/elFinder")[f](p,r.i18n("github"))),y.push(w),y.push('<div class="'+m+'">'+r.i18n("team")+"</div>"),y.push(c[f](u,'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[f](h,r.i18n("chiefdev"))),y.push(c[f](u,"Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;")[f](h,r.i18n("developer"))),y.push(c[f](u,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[f](h,r.i18n("maintainer"))),y.push(c[f](u,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[f](h,r.i18n("contributor"))),r.i18[r.lang].translator&&$.each(r.i18[r.lang].translator.split(", "),function(){y.push(c[f](u,$.trim(this))[f](h,r.i18n("translator")+" ("+r.i18[r.lang].language+")"))});y.push(C()),y.push(w),y.push('<div class="'+v+'">'+r.i18n("icons")+': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a>, <a href="https://icons8.com" target="_blank">Icons8</a></div>'),y.push(w),y.push('<div class="'+v+'">Licence: 3-clauses BSD Licence</div>'),y.push('<div class="'+v+'">Copyright  2009-2020, Studio 42</div>'),y.push('<div class="'+v+'"> '+r.i18n("dontforget")+" </div>"),y.push("</div>")}(),-1!==$.inArray("shortcuts",E)&&function(){var e=r.shortcuts();y.push('<div id="'+r.namespace+'-help-shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),e.length?(y.push('<div class="ui-widget-content elfinder-help-shortcuts">'),$.each(e,function(e,t){y.push('<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>'.replace(/\{pattern\}/,t[0]).replace(/\{descrip\}/,t[1]))}),y.push("</div>")):y.push('<div class="elfinder-help-disabled">'+r.i18n("shortcutsof")+"</div>");y.push("</div>")}(),-1!==$.inArray("help",E)&&(O=r.i18nBaseUrl+"help/%s.html.js",y.push('<div id="'+r.namespace+'-help-help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),y.push('<a href="https://github.com/Studio-42/elFinder/wiki" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>'),y.push("</div>")),-1!==$.inArray("integrations",E)&&(T=!0,y.push('<div id="'+r.namespace+'-help-integrations" class="ui-tabs-panel ui-widget-content ui-corner-bottom"/>')),-1!==$.inArray("debug",E)&&(z=!0,y.push('<div id="'+r.namespace+'-help-debug" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),y.push('<div class="ui-widget-content elfinder-help-debug"><ul></ul></div>'),y.push("</div>")),y.push("</div>"),(j=$(y.join(""))).find(".ui-tabs-nav li").on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"===e.type)}).on("focus blur","a",function(e){$(e.delegateTarget).toggleClass("ui-state-focus","focusin"===e.type)}).children().on("click",function(e){var t=$(this);e.preventDefault(),e.stopPropagation(),t.parent().addClass(k).siblings().removeClass(k),j.children(".ui-tabs-panel").hide().filter(t.attr("href")).show()}).filter(":first").trigger("click"),T&&(t=j.find(".elfinder-help-tab-integrations").hide(),n=j.find("#"+r.namespace+"-help-integrations").hide().append($('<div class="elfinder-help-integrations-desc"/>').html(r.i18n("integrationWith"))),r.bind("helpIntegration",function(e){var i,a,o,s,l=n.children("ul:first");e.data&&($.isPlainObject(e.data)?((i=Object.assign({link:"",title:"",banner:""},e.data)).title||i.link)&&(i.title||(i.title=i.link),a=i.link?$("<a/>").attr("href",i.link).attr("target","_blank").text(i.title):$("<span/>").text(i.title),i.banner&&(a=$("<span/>").append($("<img/>").attr(i.banner),a))):(a=$(e.data)).filter("a").each(function(){var e=$(this);e.attr("target")||e.attr("target","_blank")}),a&&(t.show(),l.length||(l=$('<ul class="elfinder-help-integrations"/>').appendTo(n)),i&&i.cmd?(s="elfinder-help-integration-"+i.cmd,(o=l.find("ul."+s)).length||(o=$('<ul class="'+s+'"/>'),l.append($("<li/>").append($("<span/>").html(r.i18n("cmd"+i.cmd))).append(o))),a=o.append($("<li/>").append(a))):l.append($("<li/>").append(a))))}).bind("themechange",function(){j.find("div.elfinder-help-term-theme").replaceWith(C())})),z&&(i=j.find(".elfinder-help-tab-debug").hide(),a=j.find("#"+r.namespace+"-help-debug").children("div:first"),o=a.children("ul:first").on("click",function(e){e.preventDefault(),e.stopPropagation()}),s.debug={},r.bind("backenddebug",function(t){var n,i,l,c,d,p,u,h;z&&t.data&&t.data.debug&&(s.debug={options:t.data.options,debug:Object.assign({cmd:r.currentReqCmd},t.data.debug)},s.dialog&&(u=function(e,t){return $.each(t,function(t,n){e.append($("<dt/>").text(t)),void 0===n?e.append($("<dd/>").append($("<span/>").text("undfined"))):"object"!=typeof n||n?"object"==typeof n&&($.isPlainObject(n)||n.length)?e.append($("<dd/>").append(u($("<dl/>"),n))):e.append($("<dd/>").append($("<span/>").text(n&&"object"==typeof n?"[]":n||'""'))):e.append($("<dd/>").append($("<span/>").text("null")))}),e},h=o.children("li").length,(s.debug.options||s.debug.debug)&&(h>=5&&(d=o.children("li:last"),(p=a.children("div:last")).is(":hidden")?(d.remove(),p.remove()):(d.prev().remove(),p.prev().remove())),l=r.namespace+"-help-debug-"+ +new Date,n=$("<li/>").html('<a href="'+x+"#"+l+'">'+s.debug.debug.cmd+"</a>").prependTo(o),i=$('<div id="'+l+'"/>').data("debug",s.debug),n.on("click.debugrender",function(){var e=i.data("debug");i.removeData("debug"),e&&(i.hide(),e.debug&&(c=$("<fieldset>").append($("<legend/>").text("debug"),u($("<dl/>"),e.debug)),i.append(c)),e.options&&(c=$("<fieldset>").append($("<legend/>").text("options"),u($("<dl/>"),e.options)),i.append(c)),i.show()),n.off("click.debugrender")}),o.after(i),e&&a.tabs("refresh"))))})),j.find("#"+r.namespace+"-help-about").find(".apiver").text(r.api),s.dialog=s.fmDialog(j,{title:s.title,width:530,maxWidth:"window",maxHeight:"window",autoOpen:!1,destroyOnClose:!1,close:function(){z&&(i.hide(),a.tabs("destroy")),e=!1}}).on("click",function(e){e.stopPropagation()}).css({overflow:"hidden"}),I=s.dialog.children(".ui-tabs"),M=I.children(".ui-tabs-nav:first"),S=I.children(".ui-tabs-panel"),F=s.dialog.outerHeight(!0)-s.dialog.height(),s.dialog.closest(".ui-dialog").on("resize",function(){S.height(s.dialog.height()-F-M.outerHeight(!0)-20)}),O&&s.dialog.one("initContents",function(){$.ajax({url:s.options.helpSource?s.options.helpSource:O.replace("%s",r.lang),dataType:"html"}).done(function(e){$("#"+r.namespace+"-help-help").html(e)}).fail(function(){$.ajax({url:O.replace("%s","en"),dataType:"html"}).done(function(e){$("#"+r.namespace+"-help-help").html(e)})})}),s.state=0,r.trigger("helpBuilded",s.dialog)}).one("open",function(){var e=!1;r.one("backenddebug",function(){e=!0}).one("opendone",function(){requestAnimationFrame(function(){!e&&z&&(z=!1,i.hide(),a.hide(),o.hide())})})}),this.getstate=function(){return 0},this.exec=function(t,n){var r=n?n.tab:void 0;return z&&(a.tabs(),o.find("a:first").trigger("click"),i.show(),e=!0),this.dialog.trigger("initContents").elfinderdialog("open").find((r?".elfinder-help-tab-"+r:".ui-tabs-nav li")+" a:first").trigger("click"),$.Deferred().resolve()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/hidden",["../elFinder"],function(e){return e.prototype.commands.hidden=function(){"use strict";this.hidden=!0,this.updateOnSelect=!1,this.getstate=function(){return-1}},e}),e("skylark-elfinder/commands/hide",["../elFinder"],function(e){return e.prototype.commands.hide=function(){"use strict";var e,t,n,i,a=this,o={};this.syncTitleOnChange=!0,this.shortcuts=[{pattern:"ctrl+shift+dot",description:this.fm.i18n("toggleHidden")}],this.init=function(){var n=this.fm;e=n.storage("hide")||{items:{}},t=Object.keys(e.items).length,this.title=n.i18n(e.show?"hideHidden":"showHidden"),a.update(void 0,a.title)},this.fm.bind("select contextmenucreate closecontextmenu",function(o,r){var s=(o.data?o.data.selected||o.data.targets:null)||r.selected();"select"===o.type&&o.data?i=o.data.origin:"contextmenucreate"===o.type&&(n=o.data.type),!s.length||("contextmenucreate"!==o.type&&"navbar"!==i||"cwd"===n)&&s[0]===r.cwd().hash?a.title=r.i18n(e.show?"hideHidden":"showHidden"):a.title=r.i18n("cmdhide"),"closecontextmenu"!==o.type?a.update("cwd"===n?t?0:-1:void 0,a.title):(n="",requestAnimationFrame(function(){a.update(void 0,a.title)}))}),this.getstate=function(e){return this.fm.cookieEnabled&&"cwd"!==n&&(e||this.fm.selected()).length||t?0:-1},this.exec=function(n,r){var s,l,c=this.fm,d=$.Deferred().done(function(){c.trigger("hide",{items:u,opts:r})}).fail(function(e){c.error(e)}),p=r||{},u=p.targets?p.targets:n||c.selected(),h=[];if(e=c.storage("hide")||{},$.isPlainObject(e)||(e={}),$.isPlainObject(e.items)||(e.items={}),("shortcut"===r._currentType||!u.length||"navbar"!==r._currentType&&"navbar"!==i&&u[0]===c.cwd().hash)&&(e.show?p.hide=!0:Object.keys(e.items).length&&(p.show=!0)),p.reset&&(p.show=!0,t=0),p.show||p.hide){if(p.show?e.show=!0:delete e.show,p.show)return c.storage("hide",p.reset?null:e),a.title=c.i18n("hideHidden"),a.update(p.reset?-1:void 0,a.title),$.each(e.items,function(e){var t=c.file(e,!0);t&&(c.searchStatus.state||!t.phash||c.file(t.phash))&&h.push(t)}),h.length&&(c.updateCache({added:h}),c.add({added:h})),p.reset&&(e={items:{}}),d.resolve();u=Object.keys(e.items)}return u.length&&($.each(u,function(t,n){var i;e.items[n]||((i=c.file(n))&&(o[n]=i.i18||i.name),e.items[n]=o[n]?o[n]:n)}),t=Object.keys(e.items).length,s=this.files(u),c.storage("hide",e),c.remove({removed:u}),e.show&&this.exec(void 0,{hide:!0}),p.hide||((l={}).undo={cmd:"hide",callback:function(){var e=c.storage("hide");e&&($.each(u,function(t,n){delete e.items[n]}),t=Object.keys(e.items).length,c.storage("hide",e),c.trigger("hide",{items:u,opts:{}}),a.update(t?0:-1)),c.updateCache({added:s}),c.add({added:s})}},l.redo={cmd:"hide",callback:function(){return c.exec("hide",void 0,{targets:u})}})),"rejected"==d.state()?d:d.resolve(l)}},e}),e("skylark-elfinder/commands/home",["../elFinder"],function(e){return(e.prototype.commands.home=function(){"use strict";this.title="Home",this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}],this.getstate=function(){var e=this.fm.root(),t=this.fm.cwd().hash;return e&&t&&e!=t?0:-1},this.exec=function(){return this.fm.exec("open",this.fm.root())}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/info",["../elFinder"],function(e){return(e.prototype.commands.info=function(){"use strict";var e=this.fm,t="elfinder-spinner",n={calc:e.i18n("calc"),size:e.i18n("size"),unknown:e.i18n("unknown"),path:e.i18n("path"),aliasfor:e.i18n("aliasfor"),modify:e.i18n("modify"),perms:e.i18n("perms"),locked:e.i18n("locked"),dim:e.i18n("dim"),kind:e.i18n("kind"),files:e.i18n("files"),folders:e.i18n("folders"),roots:e.i18n("volumeRoots"),items:e.i18n("items"),yes:e.i18n("yes"),no:e.i18n("no"),link:e.i18n("link"),owner:e.i18n("owner"),group:e.i18n("group"),perm:e.i18n("perm"),getlink:e.i18n("getLink")},i=function(e,t){return t?e.replace(/\u200B/g,""):e.replace(/(\/|\\)/g,"$1")};this.items=["size","aliasfor","path","link","dim","modify","perms","locked","owner","group","perm"],this.options.custom&&Object.keys(this.options.custom).length&&$.each(this.options.custom,function(e,t){t.label&&this.items.push(t.label)}),this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"{style}/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:'<tr><td class="elfinder-info-label">{label} : </td><td class="{class}">{value}</td></tr>',spinner:'<span>{text}</span> <span class="'+t+" "+t+'-{name}"/>'},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+i"}],this.init=function(){$.each(n,function(t,i){n[t]=e.i18n(i)})},this.getstate=function(){return 0},this.exec=function(e){var a=this.files(e);a.length||(a=this.files([this.fm.cwd().hash]));var o,r,s,l,c,d,p,u,h,f=this.fm,m=this.options,g=this.tpl,v=g.row,b=a.length,y=[],w=g.main,x="{label}",k="{value}",C=[],T=null,z={title:f.i18n("selectionInfo"),width:"auto",close:function(){$(this).elfinderdialog("destroy"),T&&"pending"===T.state()&&T.reject(),$.grep(C,function(e){e&&"pending"===e.state()&&e.reject()})}},j=[],A=function(e,n,i){I.find("."+t+"-"+n).parent().html(e).addClass(i||"")},O=f.namespace+"-info-"+$.map(a,function(e){return e.hash}).join("-"),I=f.getUI().find("#"+O),M=[],S="",F="elfinder-font-mono elfinder-info-hash",E=[],D=f.ui.notify;if(D.is(":hidden")&&D.children(".elfinder-notify").length&&D.elfinderdialog("open").height("auto"),!b)return $.Deferred().reject();if(I.length)return I.elfinderdialog("toTop"),$.Deferred().resolve();if(u=f.storage("infohides")||f.arrayFlip(m.hideItems,!0),1===b){if((s=a[0]).icon&&(S=" "+f.getIconStyle(s)),w=w.replace("{dirclass}",s.csscls?f.escape(s.csscls):"").replace("{class}",f.mime2class(s.mime)).replace("{style}",S),l=g.itemTitle.replace("{name}",f.escape(s.i18||s.name)).replace("{kind}",'<span title="'+f.escape(s.mime)+'">'+f.mime2kind(s)+"</span>"),r=f.tmb(s),s.read?"directory"!=s.mime||s.alias?o=f.formatSize(s.size):(o=g.spinner.replace("{text}",n.calc).replace("{name}","size"),j.push(s.hash)):o=n.unknown,!u.size&&y.push(v.replace(x,n.size).replace(k,o)),!u.aleasfor&&s.alias&&y.push(v.replace(x,n.aliasfor).replace(k,s.alias)),u.path||((p=f.path(s.hash,!0))?y.push(v.replace(x,n.path).replace(k,i(f.escape(p))).replace("{class}","elfinder-info-path")):(y.push(v.replace(x,n.path).replace(k,g.spinner.replace("{text}",n.calc).replace("{name}","path")).replace("{class}","elfinder-info-path")),C.push(f.path(s.hash,!0,{notify:null}).fail(function(){A(n.unknown,"path")}).done(function(e){A(i(e),"path")})))),!u.link&&s.read){var U,P=f.escape(s.name);if("1"==s.url)y.push(v.replace(x,n.link).replace(k,'<button class="elfinder-info-button '+t+'-url">'+n.getlink+"</button>"));else{if(s.url)U=s.url;else if("directory"===s.mime)if(m.nullUrlDirLinkSelf&&null===s.url){var q=window.location;U=q.pathname+q.search+"#elf_"+s.hash}else""!==s.url&&f.option("url",!f.isRoot(s)&&s.phash||s.hash)&&(U=f.url(s.hash));else U=f.url(s.hash);U&&y.push(v.replace(x,n.link).replace(k,'<a href="'+U+'" target="_blank">'+P+"</a>"))}}u.dim||(s.dim?y.push(v.replace(x,n.dim).replace(k,s.dim)):-1!==s.mime.indexOf("image")&&(s.width&&s.height?y.push(v.replace(x,n.dim).replace(k,s.width+"x"+s.height)):(y.push(v.replace(x,n.dim).replace(k,g.spinner.replace("{text}",n.calc).replace("{name}","dim"))),C.push(f.request({data:{cmd:"dim",target:s.hash},preventDefault:!0}).fail(function(){A(n.unknown,"dim")}).done(function(e){if(A(e.dim||n.unknown,"dim"),e.dim){var t=e.dim.split("x"),i=f.file(s.hash);i.width=t[0],i.height=t[1]}}))))),!u.modify&&y.push(v.replace(x,n.modify).replace(k,f.formatDate(s))),!u.perms&&y.push(v.replace(x,n.perms).replace(k,f.formatPermissions(s))),!u.locked&&y.push(v.replace(x,n.locked).replace(k,s.locked?n.yes:n.no)),!u.owner&&s.owner&&y.push(v.replace(x,n.owner).replace(k,s.owner)),!u.group&&s.group&&y.push(v.replace(x,n.group).replace(k,s.group)),!u.perm&&s.perm&&y.push(v.replace(x,n.perm).replace(k,f.formatFileMode(s.perm))),window.ArrayBuffer&&(f.options.cdns.sparkmd5||f.options.cdns.jssha)&&"directory"!==s.mime&&s.size>0&&(!m.showHashMaxsize||s.size<=m.showHashMaxsize)&&(E=[],$.each(f.storage("hashchekcer")||m.showHashAlgorisms,function(e,t){s[t]?y.push(v.replace(x,f.i18n(t)).replace(k,s[t]).replace("{class}",F)):(y.push(v.replace(x,f.i18n(t)).replace(k,g.spinner.replace("{text}",n.calc).replace("{name}",t))),E.push(t))}),E.length&&(h=$('<div class="elfinder-quicklook-info-progress"/>'),C.push(f.getContentsHashes(s.hash,E,m.showHashOpts,{progressBar:h}).progress(function(e){$.each(E,function(t,n){e[n]&&A(e[n],n,F)})}).always(function(){$.each(E,function(e,t){A(n.unknown,t)})})))),m.custom&&$.each(m.custom,function(e,t){u[t.label]||t.mimes&&!$.grep(t.mimes,function(e){return s.mime===e||0===s.mime.indexOf(e+"/")}).length||t.hashRegex&&!s.hash.match(t.hashRegex)||(y.push(v.replace(x,f.i18n(t.label)).replace(k,t.tpl.replace("{id}",O))),t.action&&"function"==typeof t.action&&M.push(t.action))})}else w=w.replace("{class}","elfinder-cwd-icon-group"),l=g.groupTitle.replace("{items}",n.items).replace("{num}",b),(c=$.grep(a,function(e){return"directory"==e.mime}).length)?(d=$.grep(a,function(e){return!("directory"!==e.mime||e.phash&&!e.isroot)}).length,c-=d,y.push(v.replace(x,n.kind).replace(k,d===b||c===b?n[d?"roots":"folders"]:$.map({roots:d,folders:c,files:b-d-c},function(e,t){return e?n[t]+" "+e:null}).join(", "))),!u.size&&y.push(v.replace(x,n.size).replace(k,g.spinner.replace("{text}",n.calc).replace("{name}","size"))),j=$.map(a,function(e){return e.hash})):(o=0,$.each(a,function(e,t){var n=parseInt(t.size);n>=0&&o>=0?o+=n:o="unknown"}),y.push(v.replace(x,n.kind).replace(k,n.files)),!u.size&&y.push(v.replace(x,n.size).replace(k,f.formatSize(o))));return w=w.replace("{title}",l).replace("{content}",y.join("").replace(/{class}/g,"")),(I=this.fmDialog(w,z)).attr("id",O).one("mousedown",".elfinder-info-path",function(){$(this).html(i($(this).html(),!0))}),E.length&&h.appendTo(I.find("."+t+"-"+E[0]).parent()),f.UA.Mobile&&$.fn.tooltip&&I.children(".ui-dialog-content .elfinder-info-title").tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0}),s&&"1"==s.url&&I.on("click","."+t+"-url",function(){$(this).parent().html(g.spinner.replace("{text}",f.i18n("ntfurl")).replace("{name}","url")),f.request({data:{cmd:"url",target:s.hash},preventDefault:!0}).fail(function(){A(P,"url")}).done(function(e){if(e.url){A('<a href="'+e.url+'" target="_blank">'+P+"</a>"||P,"url");var t=f.file(s.hash);t.url=e.url}else A(P,"url")})}),r&&$("<img/>").on("load",function(){I.find(".elfinder-cwd-icon").addClass(r.className).css("background-image","url('"+r.url+"')")}).attr("src",r.url),j.length&&(T=f.getSize(j).done(function(e){A(e.formated,"size")}).fail(function(){A(n.unknown,"size")})),M.length&&$.each(M,function(e,t){try{t(s,f,I)}catch(e){f.debug("error",e)}}),$.Deferred().resolve()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/mkdir",["../elFinder"],function(e){return e.prototype.commands.mkdir=function(){"use strict";var e,t=this.fm,n=this;this.value="",this.disableOnSearch=!0,this.updateOnSelect=!1,this.syncTitleOnChange=!0,this.mime="directory",this.prefix="untitled folder",this.exec=function(i,a){var o;return i&&i.length&&a&&a._currentType&&"navbar"===a._currentType?(this.origin=a._currentType,this.data={target:i[0]}):(o=t.cwd().hash===i[0],this.origin=e&&!o?e:"cwd",delete this.data),i||this.options.intoNewFolderToolbtn||t.getUI("cwd").trigger("unselectall"),this.move=this.value===t.i18n("cmdmkdirin"),$.proxy(t.res("mixin","make"),n)()},this.shortcuts=[{pattern:"ctrl+shift+n"}],this.init=function(){this.options.intoNewFolderToolbtn&&(this.syncTitleOnChange=!0)},t.bind("select contextmenucreate closecontextmenu",function(i){var a=(i.data?i.data.selected||i.data.targets:null)||t.selected();n.className="mkdir",e=i.data&&a.length&&(i.data.origin||i.data.type)||"",n.options.intoNewFolderToolbtn||""!==e||(e="cwd"),a.length&&"navbar"!==e&&"cwd"!==e&&t.cwd().hash!==a[0]?(n.title=t.i18n("cmdmkdirin"),n.className+=" elfinder-button-icon-mkdirin"):n.title=t.i18n("cmdmkdir"),"closecontextmenu"!==i.type?n.update(void 0,n.title):requestAnimationFrame(function(){n.update(void 0,n.title)})}),this.getstate=function(n){var i=t.cwd(),a="navbar"===e||n&&n[0]!==i.hash?this.files(n||t.selected()):[],o=a.length;return"navbar"===e?o&&a[0].write&&a[0].read?0:-1:!i.write||o&&$.grep(a,function(e){return!(!e.read||e.locked)}).length!=o?-1:0}},e}),e("skylark-elfinder/commands/mkfile",["../elFinder"],function(e){return e.prototype.commands.mkfile=function(){"use strict";var e=this;this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="text/plain",this.prefix="untitled file.txt",this.variants=[],this.getTypeName=function(t,n){var i,a=e.fm;return i=(i=a.messages["kind"+a.kinds[t]])?a.i18n(["extentiontype",n.toUpperCase(),i]):a.i18n(["extentionfile",n.toUpperCase()])},this.fm.bind("open reload canMakeEmptyFile",function(){var t=e.fm,n=t.getCommand("edit").getMkfileHides();e.variants=[],t.mimesCanMakeEmpty&&$.each(t.mimesCanMakeEmpty,function(i,a){a&&!n[i]&&t.uploadMimeCheck(i)&&e.variants.push([i,e.getTypeName(i,a)])}),e.change()}),this.getstate=function(){return this.fm.cwd().write?0:-1},this.exec=function(t,n){var i,a,o=e.fm;if(i=o.mimesCanMakeEmpty[n]){if(o.uploadMimeCheck(n))return this.mime=n,this.prefix=o.i18n(["untitled file",i]),$.proxy(o.res("mixin","make"),e)();a=["errMkfile",e.getTypeName(n,i)]}return $.Deferred().reject(a)}},e}),e("skylark-elfinder/commands/netmount",["../elFinder"],function(e){return e.prototype.commands.netmount=function(){"use strict";var e,t=this,n=!1;this.alwaysEnabled=!0,this.updateOnSelect=!1,this.drivers=[],this.handlers={load:function(){var e=t.fm;e.cookieEnabled&&e.one("open",function(){t.drivers=e.netDrivers,t.drivers.length&&$.each(t.drivers,function(){var i=t.options[this];i&&(n=!0,i.integrateInfo&&e.trigger("helpIntegration",Object.assign({cmd:"netmount"},i.integrateInfo)))})})}},this.getstate=function(){return n?0:-1},this.exec=function(){var n,i,a,o,r,s,l,c,d=t.fm,p=$.Deferred(),u=t.options;return t.dialog?t.dialog.elfinderdialog("open"):t.dialog=(a=function(){o.protocol.trigger("change","winfocus")},o={protocol:$("<select/>").on("change",function(t,i){var a=this.value;e.find(".elfinder-netmount-tr").hide(),e.find(".elfinder-netmount-tr-"+a).show(),n&&n.children(".ui-dialog-buttonpane:first").find("button").show(),"function"==typeof u[a].select&&u[a].select(d,t,i)}).addClass("ui-corner-all")},r={title:d.i18n("netMountDialogTitle"),resizable:!0,modal:!0,destroyOnClose:!1,open:function(){$(window).on("focus."+d.namespace,a),o.protocol.trigger("change")},close:function(){"pending"==p.state()&&p.reject(),$(window).off("focus."+d.namespace,a)},buttons:{}},s=function(){var n,i=o.protocol.val(),a={cmd:"netmount",protocol:i},r=u[i];if($.each(e.find("input.elfinder-netmount-inputs-"+i),function(e,t){var n,i;(i=$(t)).is(":radio,:checkbox")?i.is(":checked")&&(n=$.trim(i.val())):n=$.trim(i.val()),n&&(a[t.name]=n)}),!a.host)return d.trigger("error",{error:"errNetMountHostReq",opts:{modal:!0}});a.mnt2res&&(n=!0),d.request({data:a,notify:{type:"netmount",cnt:1,hideCnt:!0}}).done(function(e){var t;e.added&&e.added.length&&(n&&o.protocol.trigger("change","reset"),e.added[0].phash&&(t=d.file(e.added[0].phash))&&(t.dirs||(t.dirs=1,d.change({changed:[t]}))),d.one("netmountdone",function(){d.exec("open",e.added[0].hash)})),p.resolve()}).fail(function(e){r.fail&&"function"==typeof r.fail&&r.fail(d,d.parseError(e)),p.reject(e)}),t.dialog.elfinderdialog("close")},l=$('<form autocomplete="off"/>').on("keydown","input",function(e){var t,n=!0;e.keyCode===$.ui.keyCode.ENTER&&($.each(l.find("input:visible:not(.elfinder-input-optional)"),function(){if(""===$(this).val())return n=!1,t=$(this),!1}),n?s():t.trigger("focus"))}),c=$("<div/>"),e=$('<table class="elfinder-info-tb elfinder-netmount-tb"/>').append($("<tr/>").append($("<td>"+d.i18n("protocol")+"</td>")).append($("<td/>").append(o.protocol))),$.each(t.drivers,function(t,n){u[n]&&(o.protocol.append('<option value="'+n+'">'+d.i18n(u[n].name||n)+"</option>"),$.each(u[n].inputs,function(t,i){i.attr("name",t),"hidden"!=i.attr("type")?(i.addClass("ui-corner-all elfinder-netmount-inputs-"+n),e.append($("<tr/>").addClass("elfinder-netmount-tr elfinder-netmount-tr-"+n).append($("<td>"+d.i18n(t)+"</td>")).append($("<td/>").append(i)))):(i.addClass("elfinder-netmount-inputs-"+n),c.append(i))}),u[n].protocol=o.protocol)}),e.append(c),e.find(".elfinder-netmount-tr").hide(),e.find(".elfinder-netmount-tr-"+t.drivers[0]).show(),r.buttons[d.i18n("btnMount")]=s,r.buttons[d.i18n("btnCancel")]=function(){t.dialog.elfinderdialog("close")},e.find("select,input").addClass("elfinder-tabstop"),i=t.fmDialog(l.append(e),r).ready(function(){o.protocol.trigger("change"),i.elfinderdialog("posInit")}),n=i.closest(".ui-dialog"),i),p.promise()},t.fm.bind("netmount",function(n){var i=n.data||null,a=t.options;i&&i.protocol&&a[i.protocol]&&"function"==typeof a[i.protocol].done&&(a[i.protocol].done(t.fm,i),e.find("select,input").addClass("elfinder-tabstop"),t.dialog.elfinderdialog("tabstopsInit"))})},e.prototype.commands.netunmount=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.drivers=[],this.handlers={load:function(){this.drivers=this.fm.netDrivers}},this.getstate=function(e){var t,n=this.fm;return e&&this.drivers.length&&!this._disabled&&(t=n.file(e[0]))&&t.netkey?0:-1},this.exec=function(e){var t=this,n=this.fm,i=$.Deferred().fail(function(e){e&&n.error(e)}),a=n.file(e[0]);return this._disabled?i.reject():("pending"==i.state()&&n.confirm({title:t.title,text:n.i18n("confirmUnmount",a.name),accept:{label:"btnUnmount",callback:function(){var e,o=a.hash,r=function(e){var t,i=[];n.leafRoots&&(t=[],$.each(n.leafRoots,function(i,a){var o,r=n.parents(i);-1!==(o=$.inArray(e,r))&&(o=r.length-o,$.each(a,function(e,n){t.push({i:o,hash:n})}))}),t.length&&(t.sort(function(e,t){return e.i<t.i}),$.each(t,function(e,t){i.push(t.hash)})));return i}(o),s=[],l=[],c=function(){$.when(s).done(function(){n.request({data:{cmd:"netmount",protocol:"netunmount",host:a.netkey,user:o,pass:"dum"},notify:{type:"netunmount",cnt:1,hideCnt:!0},preventFail:!0}).fail(function(e){i.reject(e)}).done(function(e){a.volumeid&&delete n.volumeExpires[a.volumeid],i.resolve()})}).fail(function(e){l.length&&n.remove({removed:l}),i.reject(e)})};r.length?n.confirm({title:t.title,text:(e=["unmountChildren"],$.each(r,function(t,i){e.push([n.file(i).name])}),e),accept:{label:"btnUnmount",callback:function(){$.each(r,function(e,t){var i=n.file(t);i.netkey&&s.push(n.request({data:{cmd:"netmount",protocol:"netunmount",host:i.netkey,user:i.hash,pass:"dum"},notify:{type:"netunmount",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){e.removed&&(i.volumeid&&delete n.volumeExpires[i.volumeid],l=l.concat(e.removed))}))}),c()}},cancel:{label:"btnCancel",callback:function(){i.reject()}}}):(s=null,c())}},cancel:{label:"btnCancel",callback:function(){i.reject()}}}),i)}},e}),e("skylark-elfinder/commands/open",["../elFinder"],function(e){return(e.prototype.commands.open=function(){"use strict";var e=this.fm,t=this;this.alwaysEnabled=!0,this.noChangeDirOnRemovedCwd=!0,this._handlers={dblclick:function(n){var i=n.data&&n.data.file?[n.data.file]:void 0;0===t.getstate(i)&&(n.preventDefault(),e.exec("open",i))},"select enable disable reload":function(e){this.update("disable"==e.type?-1:void 0)}},this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=e.OS&&" enter")}],this.getstate=function(t){var n=this.files(t),i=n.length;return 1==i?n[0].read?0:-1:i&&!e.UA.Mobile&&$.grep(n,function(e){return!("directory"==e.mime||!e.read)}).length==i?0:-1},this.exec=function(t,n){var i,a,o,r,s,l,c,d,p,u,h,f,m=$.Deferred().fail(function(t){t&&e.error(t)}),g=this.files(t),v=g.length,b="object"==typeof n&&n.thash,y=this.options,w=y.into||"window";if(!v&&!b)return m.reject();if(b||1==v&&(i=g[0])&&"directory"==i.mime)return b||!i||i.read?e.keyState.ctrlKey&&(e.keyState.shiftKey||"function"!=typeof e.options.getFileCallback)&&e.getCommand("opennew")?e.exec("opennew",[b||i.hash]):e.request({data:{cmd:"open",target:b||i.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0,lazy:!1}):m.reject(["errOpen",i.name,"errPerm"]);if(g=$.grep(g,function(e){return"directory"!=e.mime}),v!=g.length)return m.reject();var x=function(){var n,h,f=function(t){var d=$("<a>").hide().appendTo($("body"));if(e.UA.Mobile||!u){if(p)u?d.attr("target","_blank"):d.attr("download",i.name),d.attr("href",t).get(0).click();else if(!(n=window.open(t)))return m.reject("errPopup")}else{if(!("string"==typeof y.method&&"get"===y.method.toLowerCase())&&0===t.indexOf(e.options.url)&&e.customData&&Object.keys(e.customData).length&&!i.mime.match(/^(?:video|audio)/)&&(t=""),"window"===w?(r=l=Math.round(2*screen.availWidth/3),s=c=Math.round(2*screen.availHeight/3),parseInt(i.width)&&parseInt(i.height)?(r=parseInt(i.width),s=parseInt(i.height)):i.dim&&(a=i.dim.split("x"),r=parseInt(a[0]),s=parseInt(a[1])),l>=r&&c>=s?(l=r,c=s):r-l>s-c?c=Math.round(s*(l/r)):l=Math.round(r*(c/s)),o="width="+l+",height="+c,n=window.open(t,h,o+",top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no")):("tabs"===w&&(h=i.hash),n=window.open("about:blank",h)),!n)return m.reject("errPopup");if(""===t){var f=document.createElement("form");f.action=e.options.url,f.method="POST",f.target=h,f.style.display="none";var g=Object.assign({},e.customData,{cmd:"file",target:i.hash,_t:i.ts||parseInt(+new Date/1e3)});$.each(g,function(e,t){var n=document.createElement("input");n.name=e,n.value=t,f.appendChild(n)}),document.body.appendChild(f),f.submit()}else"window"!==w&&(n.location=t);$(n).trigger("focus")}d.remove()};try{d=new RegExp(e.option("dispInlineRegex"),"i")}catch(e){d=!1}for(p="string"==typeof $("<a>").get(0).download,v=g.length;v--;){if(h="elf_open_window",!(i=g[v]).read)return m.reject(["errOpen",i.name,"errPerm"]);u=d&&i.mime.match(d),e.openUrl(i.hash,!u,f)}return m.resolve(t)};if(v>1)e.confirm({title:"openMulti",text:["openMultiConfirm",v+""],accept:{label:"cmdopen",callback:function(){x()}},cancel:{label:"btnCancel",callback:function(){m.reject()}},buttons:e.getCommand("zipdl")&&e.isCommandEnabled("zipdl",e.cwd().hash)?[{label:"cmddownload",callback:function(){e.exec("download",t),m.reject()}}]:[]});else{if((h=e.storage("selectAction")||y.selectAction)&&($.each(h.split("/"),function(){var t=this.valueOf();if("open"!==t&&(f=e.getCommand(t))&&f.enabled())return!1;f=null}),f))return e.exec(f.name);x()}return m}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/opendir",["../elFinder"],function(e){return e.prototype.commands.opendir=function(){"use strict";this.alwaysEnabled=!0,this.getstate=function(){var e=this.fm.selected(),t=e.length;return 1!==t?-1:this.fm.getUI("workzone").hasClass("elfinder-search-result")?0:-1},this.exec=function(e){var t,n=this.fm,i=$.Deferred(),a=this.files(e),o=a.length;return o&&a[0].phash?(t=a[0].phash,n.trigger("searchend",{noupdate:!0}),n.request({data:{cmd:"open",target:t},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!1}),i):i.reject()}},e}),e("skylark-elfinder/commands/opennew",["../elFinder"],function(e){return e.prototype.commands.opennew=function(){"use strict";var e=this.fm;this.shortcuts=[{pattern:("function"==typeof e.options.getFileCallback?"shift+":"")+"ctrl+enter"}],this.getstate=function(e){var t=this.files(e),n=t.length;return 1===n&&"directory"===t[0].mime&&t[0].read?0:-1},this.exec=function(e){var t,n,i,a,o=$.Deferred(),r=this.files(e),s=r.length,l=this.options;return 1===s&&(t=r[0])&&"directory"===t.mime?(n=window.location,i=l.url?l.url:n.pathname,l.useOriginQuery&&(i.match(/\?/)?n.search&&(i+="&"+n.search.substr(1)):i+=n.search),i+="#elf_"+t.hash,a=window.open(i,"_blank"),setTimeout(function(){a.focus()},1e3),o.resolve()):o.reject()}},e}),e("skylark-elfinder/commands/paste",["../elFinder"],function(e){return e.prototype.commands.paste=function(){"use strict";this.updateOnSelect=!1,this.handlers={changeclipboard:function(){this.update()}},this.shortcuts=[{pattern:"ctrl+v shift+insert"}],this.getstate=function(e){if(this._disabled)return-1;if(e){if(Array.isArray(e)){if(1!=e.length)return-1;e=this.fm.file(e[0])}}else e=this.fm.cwd();return this.fm.clipboard().length&&"directory"==e.mime&&e.write?0:-1},this.exec=function(e,t){var n,i,a,o=this,r=o.fm,s=t||{},l=e?this.files(e)[0]:r.cwd(),c=r.clipboard(),d=c.length,p=!!d&&c[0].cut,u=s._cmd?s._cmd:p?"move":"copy",h="err"+u.charAt(0).toUpperCase()+u.substr(1),f=[],m=[],g=$.Deferred().fail(function(e){e&&r.error(e)}).always(function(){r.unlockfiles({files:$.map(c,function(e){return e.hash})})});return d&&l&&"directory"==l.mime?l.write?(n=r.parents(l.hash),$.each(c,function(e,t){return t.read?p&&t.locked?!g.reject(["errLocked",t.name]):-1!==$.inArray(t.hash,n)?!g.reject(["errCopyInItself",t.name]):t.mime&&"directory"!==t.mime&&!r.uploadMimeCheck(t.mime,l.hash)?!g.reject([h,t.name,"errUploadMime"]):((i=r.parents(t.hash)).pop(),-1!==$.inArray(l.hash,i)&&$.grep(i,function(e){var n=r.file(e);return n.phash==l.hash&&n.name==t.name}).length?!g.reject(["errReplByChild",t.name]):void(t.phash==l.hash?m.push(t.hash):f.push({hash:t.hash,phash:t.phash,name:t.name}))):!g.reject([h,t.name,"errPerm"])}),"rejected"===g.state()?g:(a=$.Deferred(),p&&o.options.moveConfirm?r.confirm({title:"moveFiles",text:r.i18n("confirmMove",l.i18||l.name),accept:{label:"btnYes",callback:function(){a.resolve()}},cancel:{label:"btnCancel",callback:function(){a.reject()}}}):a.resolve(),a.done(function(){var e;$.when((e=m,e.length&&r._commands.duplicate?r.exec("duplicate",e):$.Deferred().resolve()),function(e){var t,n=$.Deferred(),i=[],a={},c=function(e,t){for(var n=[],i=e.length;i--;)-1!==$.inArray(e[i].name,t)&&n.unshift(i);return n},d=function(t){var a=i[t],o=e[a],s=t==i.length-1;o&&r.confirm({title:r.i18n(u+"Files"),text:["errExists",o.name,"restore"===u?"confirmRest":"confirmRepl"],all:!s,accept:{label:"btnYes",callback:function(n){s||n?f(e):d(++t)}},reject:{label:"btnNo",callback:function(n){var a;if(n)for(a=i.length;t<a--;)e[i[a]].remove=!0;else e[i[t]].remove=!0;s||n?f(e):d(++t)}},cancel:{label:"btnCancel",callback:function(){n.resolve()}},buttons:[{label:"btnBackup",callback:function(n){var a;if(n)for(a=i.length;t<a--;)e[i[a]].rename=!0;else e[i[t]].rename=!0;s||n?f(e):d(++t)}}]})},h=function(t){var n,o={};t&&(Array.isArray(t)?t.length&&("string"==typeof t[0]?i=c(e,t):($.each(t,function(e,t){o[t.name]=t.hash}),i=c(e,$.map(o,function(e,t){return t})),$.each(e,function(e,t){o[t.name]&&(a[o[t.name]]=t.name)}))):(n=[],i=$.map(t,function(e){return"string"==typeof e?e:(n=n.concat(e),!1)}),n.length&&(i=i.concat(n)),i=c(e,i),a=t)),i.length?d(0):f(e)},f=function(e){var t,i,o=[],c=$.grep(e,function(e){return e.rename&&o.push(e.name),!e.remove}),d=c.length;if(!d)return n.resolve();t=$.map(c,function(e){return e.hash}),i={cmd:"paste",dst:l.hash,targets:t,cut:p?1:0,renames:o,hashes:a,suffix:r.options.backupSuffix},r.api<2.1&&(i.src=c[0].phash),r.request({data:i,notify:{type:u,cnt:d},cancel:!0,navigate:{toast:s.noToast?{}:{inbuffer:{msg:r.i18n(["complete",r.i18n("cmd"+u)]),action:{cmd:"open",msg:"cmdopendir",data:[l.hash],done:"select",cwdNot:l.hash}}}}}).done(function(e){var t={},a=e.added&&e.added.length?e.added:null;p&&a&&($.each(c,function(e,n){var i,o,r=n.phash,s=(i=n.name,$.each(a,function(e,t){if(t.name===i)return o=t.hash,!1}),o);s&&(t[r]?t[r].push(s):t[r]=[s])}),Object.keys(t).length&&(e.undo={cmd:"move",callback:function(){var e=[];return $.each(t,function(t,n){e.push(r.request({data:{cmd:"paste",dst:t,targets:n,cut:1},notify:{type:"undo",cnt:n.length}}))}),$.when.apply(null,e)}},e.redo={cmd:"move",callback:function(){return r.request({data:i,notify:{type:"redo",cnt:d}})}})),n.resolve(e)}).fail(function(e){n.reject(),0===e&&r.sync()}).always(function(){r.unlockfiles({files:c})})};if(!r.isCommandEnabled(o.name,l.hash)||!e.length)return n.resolve();r.oldAPI?f(e):r.option("copyOverwrite",l.hash)?(t=$.map(e,function(e){return e.name}),l.hash==r.cwd().hash?h($.map(r.files(),function(e){return e.phash==l.hash?{hash:e.hash,name:e.name}:null})):r.request({data:{cmd:"ls",target:l.hash,intersect:t},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(e){h(e.list)})):f(e);return n}(f)).done(function(e,t){g.resolve(t&&t.undo?t:void 0)}).fail(function(){g.reject()}).always(function(){p&&r.clipboard([])})}).fail(function(){g.reject()}),g)):g.reject([h,c[0].name,"errPerm"]):g.reject()}},e}),e("skylark-elfinder/commands/places",["../elFinder"],function(e){return e.prototype.commands.places=function(){"use strict";var e=this,t=this.fm,n=null;this.getstate=function(t){var i,a=this.hashes(t),o=a.length;return n&&o&&o==(i=a,$.grep(e.files(i),function(e){return"directory"==e.mime})).length?0:-1},this.exec=function(e){var t=this.files(e);return n.trigger("regist",[t]),$.Deferred().resolve()},t.one("load",function(){n=t.ui.places})},e}),e("skylark-elfinder/commands/preference",["../elFinder"],function(e){return e.prototype.commands.preference=function(){var e,t,n=this,i=this.fm,a="replace",o='<li class="'+i.res("class","tabstab")+' elfinder-preference-tab-{id}"><a href="#'+i.namespace+'-preference-{id}" id="'+i.namespace+'-preference-tab-{id}" class="ui-tabs-anchor {class}">{title}</a></li>',r=$('<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-preference">'),s=$('<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top">'),l=$('<div class="elfinder-preference-tabs ui-tabs-panel ui-widget-content ui-corner-bottom"/>'),c=($("base").length&&document.location.href.replace(/#.*$/,""),function(e){$("#"+i.namespace+"-preference-tab-"+e).trigger("mouseover").trigger("click"),t=e}),d=i.res("class","tabsactive");this.shortcuts=[{pattern:"ctrl+comma",description:this.title}],this.alwaysEnabled=!0,this.getstate=function(){return 0},this.exec=function(p,u){return!e&&function(){var p=n.options.categories||{language:["language"],theme:["theme"],toolbar:["toolbarPref"],workspace:["iconSize","columnPref","selectAction","makefileTypes","useStoredEditor","editorMaximized","useFullscreen","showHidden"],dialog:["autoFocusDialog"],selectionInfo:["infoItems","hashChecker"],reset:["clearBrowserData"],all:!0},u=n.options.prefs||["language","theme","toolbarPref","iconSize","columnPref","selectAction","makefileTypes","useStoredEditor","editorMaximized","useFullscreen","showHidden","infoItems","hashChecker","autoFocusDialog","clearBrowserData"];i.cookieEnabled||delete p.language;u=i.arrayFlip(u,!0),i.options.getFileCallback&&delete u.selectAction;i.UA.Fullscreen||delete u.useFullscreen;u.language&&(u.language=(w=$("<select/>").on("change",function(){var e=$(this).val();i.storage("lang",e),$("#"+i.id).elfinder("reload")}),x=[],k=n.options.langs||{ar:"",bg:"",ca:"Catal",cs:"etina",da:"Dansk",de:"Deutsch",el:"",en:"English",es:"Espaol",fa:"",fo:"Froyskt",fr:"Franais",fr_CA:"Franais (Canada)",he:"",hr:"Hrvatski",hu:"Magyar",id:"Bahasa Indonesia",it:"Italiano",ja:"",ko:"",nl:"Nederlands",no:"Norsk",pl:"Polski",pt_BR:"Portugus",ro:"Romn",ru:"P",si:"",sk:"Slovenina",sl:"Slovenina",sr:"Srpski",sv:"Svenska",tr:"Trke",ug_CN:"",uk:"",vi:"Ting Vit",zh_CN:"",zh_TW:""},i.cookieEnabled?($.each(k,function(e,t){x.push('<option value="'+e+'">'+t+"</option>")}),w.append(x.join("")).val(i.lang)):$())),u.theme&&(u.theme=function(){var e=i.options.themes?Object.keys(i.options.themes).length:0;if(0===e||1===e&&i.options.themes.default)return null;var t=$("<select/>").on("change",function(){var e=$(this).val();i.changeTheme(e).storage("theme",e)}),n={image:'<img class="elfinder-preference-theme elfinder-preference-theme-image" src="$2" />',link:'<a href="$1" target="_blank" title="$3">$2</a>',data:'<dt>$1</dt><dd><span class="elfinder-preference-theme elfinder-preference-theme-$0">$2</span></dd>'},a=["image","description","author","email","license"],o=$('<button class="ui-button ui-corner-all ui-widget elfinder-preference-theme-default"/>').text(i.i18n("default")).on("click",function(e){t.val("default").trigger("change")}),r=$('<div class="elfinder-reference-hide-taball"/>').on("click","button",function(){var e=$(this).data("themeid");t.val(e).trigger("change")});return i.options.themes.default||t.append('<option value="default">'+i.i18n("default")+"</option>"),$.each(i.options.themes,function(e,o){var s,l=$('<option class="elfinder-theme-option-'+e+'" value="'+e+'">'+i.i18n(e)+"</option>"),c=$('<fieldset class="ui-widget ui-widget-content ui-corner-all elfinder-theme-list-'+e+'"><legend>'+i.i18n(e)+'</legend><div><span class="elfinder-spinner"/></div></fieldset>');t.append(l),r.append(c),s=setTimeout(function(){c.find("span.elfinder-spinner").replaceWith(i.i18n(["errRead",e]))},1e4),i.getTheme(e).always(function(){s&&clearTimeout(s)}).done(function(o){var r,s=$(),d=$("<dl/>");r=o.link?n.link.replace(/\$1/g,o.link).replace(/\$3/g,i.i18n("website")):"$2",o.name&&l.html(i.i18n(o.name)),c.children("legend").html(r.replace(/\$2/g,i.i18n(o.name)||e)),$.each(a,function(a,r){var s,l=n[r]||n.data;o[r]&&(s=l.replace(/\$0/g,i.escape(r)).replace(/\$1/g,i.i18n(r)).replace(/\$2/g,i.i18n(o[r])),"image"===r&&o.link&&(s=$(s).on("click",function(){t.val(e).trigger("change")}).attr("title",i.i18n("select"))),d.append(s))}),s=(s=s.add(d)).add($('<div class="elfinder-preference-theme-btn"/>').append($('<button class="ui-button ui-corner-all ui-widget"/>').data("themeid",e).html(i.i18n("select")))),c.find("span.elfinder-spinner").replaceWith(s)}).fail(function(){c.find("span.elfinder-spinner").replaceWith(i.i18n(["errRead",e]))})}),$("<div/>").append(t.val(i.theme&&i.theme.id?i.theme.id:"default"),o,r)}()),u.toolbarPref&&(u.toolbarPref=(v=$.map(i.options.uiOptions.toolbar,function(e){return $.isArray(e)?e:null}),b=[],y=i.storage("toolbarhides")||{},$.each(v,function(){var e=i.i18n("cmd"+this);e==="cmd"+this&&(e=i.i18n(this)),b.push('<span class="elfinder-preference-toolbar-item"><label><input type="checkbox" value="'+this+'" '+(y[this]?"":"checked")+"/>"+e+"</label></span>")}),$(b.join(" ")).on("change","input",function(){var e=$(this).val(),t=$(this).is(":checked");t||y[e]?t&&y[e]&&delete y[e]:y[e]=!0,i.storage("toolbarhides",y),i.trigger("toolbarpref")}))),u.iconSize&&(u.iconSize=(f=i.options.uiOptions.cwd.iconsView.sizeMax||3,m=i.storage("iconsize")||i.options.uiOptions.cwd.iconsView.size||0,g=$('<div class="touch-punch"/>').slider({classes:{"ui-slider-handle":"elfinder-tabstop"},value:m,max:f,slide:function(e,t){i.getUI("cwd").trigger("iconpref",{size:t.value})},change:function(e,t){i.storage("iconsize",t.value)}}),i.getUI("cwd").on("iconpref",function(e,t){g.slider("option","value",t.size)}),g)),u.columnPref&&(u.columnPref=function(){var e=i.options.uiOptions.cwd.listView.columns,t=[],n=i.storage("columnhides")||{};return $.each(e,function(){var e=i.getColumnName(this);t.push('<span class="elfinder-preference-column-item"><label><input type="checkbox" value="'+this+'" '+(n[this]?"":"checked")+"/>"+e+"</label></span>")}),$(t.join(" ")).on("change","input",function(){var e=$(this).val(),t=$(this).is(":checked");t||n[e]?t&&n[e]&&delete n[e]:n[e]=!0,i.storage("columnhides",n),i.trigger("columnpref",{repaint:!0})})}()),u.selectAction&&(u.selectAction=function(){var e=$("<select/>").on("change",function(){var e=$(this).val();i.storage("selectAction","default"===e?null:e)}),t=[],a=n.options.selectActions,o=i.getCommand("open").options.selectAction||"open";return-1===$.inArray(o,a)&&a.unshift(o),$.each(a,function(e,n){var a=$.map(n.split("/"),function(e){var t=i.i18n("cmd"+e);return t==="cmd"+e&&(t=i.i18n(e)),t});t.push('<option value="'+n+'">'+a.join("/")+"</option>")}),e.append(t.join("")).val(i.storage("selectAction")||o)}()),u.makefileTypes&&(u.makefileTypes=function(){var e=i.getCommand("edit").getMkfileHides(),t=function(){var t=[];return e=i.getCommand("edit").getMkfileHides(),$.each(i.mimesCanMakeEmpty,function(n,a){var o=i.getCommand("mkfile").getTypeName(n,a);t.push('<span class="elfinder-preference-column-item" title="'+i.escape(o)+'"><label><input type="checkbox" value="'+n+'" '+(e[n]?"":"checked")+"/>"+a+"</label></span>")}),t.join(" ")},n=$("<div/>").on("change","input",function(){var t=$(this).val(),n=$(this).is(":checked");n||e[t]?n&&e[t]&&delete e[t]:e[t]=!0,i.storage("mkfileHides",e),i.trigger("canMakeEmptyFile")}).append(t()),a=$("<div/>").append($('<input type="text" placeholder="'+i.i18n("typeOfTextfile")+'"/>').on("keydown",function(e){e.keyCode===$.ui.keyCode.ENTER&&$(this).next().trigger("click")}),$('<button class="ui-button"/>').html(i.i18n("add")).on("click",function(){var e,t=$(this).prev(),n=t.val(),a=i.getUI("toast"),o=function(){return a.appendTo(t.closest(".ui-dialog")),i.toast({msg:i.i18n("errUsupportType"),mode:"warning",onHidden:function(){1===a.children().length&&a.appendTo(i.getUI())}}),t.trigger("focus"),!1};if(!n.match(/\//)){if(!(n=i.arrayFlip(i.mimeTypes)[n]))return o();t.val(n)}if(!i.mimeIsText(n)||!i.mimeTypes[n])return o();i.trigger("canMakeEmptyFile",{mimes:[n],unshift:!0}),(e={})[n]=i.mimeTypes[n],i.storage("mkfileTextMimes",Object.assign(e,i.storage("mkfileTextMimes")||{})),t.val(""),a.appendTo(t.closest(".ui-dialog")),i.toast({msg:i.i18n(["complete",n+" ("+e[n]+")"]),onHidden:function(){1===a.children().length&&a.appendTo(i.getUI())}})}),$('<button class="ui-button"/>').html(i.i18n("reset")).on("click",function(){i.one("canMakeEmptyFile",{done:function(){n.empty().append(t())}}),i.trigger("canMakeEmptyFile",{resetTexts:!0})}));return i.bind("canMakeEmptyFile",{done:function(e){e.data&&e.data.mimes&&e.data.mimes.length&&n.empty().append(t())}}),$("<div/>").append(n,a)}()),u.useStoredEditor&&(u.useStoredEditor=$('<input type="checkbox"/>').prop("checked",(h=i.storage("useStoredEditor"),h?h>0:i.options.commandsOptions.edit.useStoredEditor)).on("change",function(e){i.storage("useStoredEditor",$(this).is(":checked")?1:-1)})),u.editorMaximized&&(u.editorMaximized=$('<input type="checkbox"/>').prop("checked",function(){var e=i.storage("editorMaximized");return e?e>0:i.options.commandsOptions.edit.editorMaximized}()).on("change",function(e){i.storage("editorMaximized",$(this).is(":checked")?1:-1)})),u.useFullscreen&&(u.useFullscreen=$('<input type="checkbox"/>').prop("checked",function(){var e=i.storage("useFullscreen");return e?e>0:"screen"===i.options.commandsOptions.fullscreen.mode}()).on("change",function(e){i.storage("useFullscreen",$(this).is(":checked")?1:-1)})),u.showHidden&&function(){var e,t,n=function(){var t,n=i.storage("hide"),a=[];n&&n.items&&$.each(n.items,function(e,t){a.push(i.escape(t))}),r.prop("disabled",!a.length)[a.length?"removeClass":"addClass"]("ui-state-disabled"),t=a.length?a.join("\n"):"",u.showHidden.attr("title",t),e&&u.showHidden.tooltip("option","content",t.replace(/\n/g,"<br>")).tooltip("close")},a=$('<input type="checkbox"/>').prop("checked",(t=i.storage("hide"),t&&t.show)).on("change",function(e){var t={};t[$(this).is(":checked")?"show":"hide"]=!0,i.exec("hide",void 0,t)}),o=$('<button class="ui-button ui-corner-all ui-widget"/>').append(i.i18n("reset")).on("click",function(){i.exec("hide",void 0,{reset:!0}),$(this).parent().find("input:first").prop("checked",!1),n()}),r=$().add(a).add(o);u.showHidden=$("<div/>").append(a,o),i.bind("hide",function(e){var t=e.data;t.opts&&(t.opts.show||t.opts.hide)||n()}),i.UA.Mobile&&$.fn.tooltip&&(e=!0,u.showHidden.tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0}).css("user-select","none"),o.css("user-select","none")),n()}();var h;var f,m,g;var v,b,y;var w,x,k;u.infoItems&&(u.infoItems=function(){var e=i.getCommand("info").items,t=[],n=i.storage("infohides")||i.arrayFlip(i.options.commandsOptions.info.hideItems,!0);return $.each(e,function(){var e=i.i18n(this);t.push('<span class="elfinder-preference-info-item"><label><input type="checkbox" value="'+this+'" '+(n[this]?"":"checked")+"/>"+e+"</label></span>")}),$(t.join(" ")).on("change","input",function(){var e=$(this).val(),t=$(this).is(":checked");t||n[e]?t&&n[e]&&delete n[e]:n[e]=!0,i.storage("infohides",n),i.trigger("infopref",{repaint:!0})})}()),u.hashChecker&&i.hashCheckers.length&&(u.hashChecker=function(){var e=[],t=i.arrayFlip(i.storage("hashchekcer")||i.options.commandsOptions.info.showHashAlgorisms,!0);return $.each(i.hashCheckers,function(){var n=i.i18n(this);e.push('<span class="elfinder-preference-hashchecker-item"><label><input type="checkbox" value="'+this+'" '+(t[this]?"checked":"")+"/>"+n+"</label></span>")}),$(e.join(" ")).on("change","input",function(){var e=$(this).val(),n=$(this).is(":checked");n?t[e]=!0:t[e]&&delete t[e],i.storage("hashchekcer",$.grep(i.hashCheckers,function(e){return t[e]}))})}()),u.autoFocusDialog&&(u.autoFocusDialog=$('<input type="checkbox"/>').prop("checked",function(){var e=i.storage("autoFocusDialog");return e?e>0:i.options.uiOptions.dialog.focusOnMouseOver}()).on("change",function(e){i.storage("autoFocusDialog",$(this).is(":checked")?1:-1)})),u.clearBrowserData&&(u.clearBrowserData=$("<button/>").text(i.i18n("reset")).button().on("click",function(e){e.preventDefault(),i.storage(),$("#"+i.id).elfinder("reload")})),$.each(p,function(e,n){var r,c;!0===n?c=1:n&&(r=$(),$.each(n,function(e,t){var n,a,o,s="";(n=u[t])&&(c=2,a=i.i18n(t),(o=$(n).filter('input[type="checkbox"]')).length||(o=$(n).find('input[type="checkbox"]')),1===o.length?(o.attr("id")||o.attr("id","elfinder-preference-"+t+"-checkbox"),a='<label for="'+o.attr("id")+'">'+a+"</label>"):o.length>1&&(s=" elfinder-preference-checkboxes"),r=r.add($('<dt class="elfinder-preference-'+t+s+'">'+a+"</dt>")).add($('<dd class="elfinder-preference-'+t+s+'"/>').append(n)))})),c&&(s.append(o[a](/\{id\}/g,e)[a](/\{title\}/,i.i18n(e))[a](/\{class\}/,t===e?"elfinder-focus":"")),2===c&&l.append($('<div id="'+i.namespace+"-preference-"+e+'" class="elfinder-preference-content"/>').hide().append($("<dl/>").append(r))))}),s.on("click","a",function(e){var t=$(e.target),n=t.attr("href");e.preventDefault(),e.stopPropagation(),s.children().removeClass(d),t.removeClass("ui-state-hover").parent().addClass(d),n.match(/all$/)?l.addClass("elfinder-preference-taball").children().show():(l.removeClass("elfinder-preference-taball").children().hide(),$(n).show())}).on("focus blur","a",function(e){$(this).parent().toggleClass("ui-state-focus","focusin"===e.type)}).on("mouseenter mouseleave","li",function(e){$(this).toggleClass("ui-state-hover","mouseenter"===e.type)}),l.find("a,input,select,button").addClass("elfinder-tabstop"),r.append(s,l),(e=n.fmDialog(r,{title:n.title,width:n.options.width||600,height:n.options.height||400,maxWidth:"window",maxHeight:"window",autoOpen:!1,destroyOnClose:!1,allowMinimize:!1,open:function(){t&&c(t),t=null},resize:function(){l.height(e.height()-s.outerHeight(!0)-(l.outerHeight(!0)-l.height())-5)}}).on("click",function(e){e.stopPropagation()}).css({overflow:"hidden"})).closest(".ui-dialog").css({overflow:"hidden"}).addClass("elfinder-bg-translucent"),t="all"}(),u&&(u.tab?c(u.tab):"cwd"===u._currentType&&c("workspace")),e.elfinderdialog("open"),$.Deferred().resolve()}},e}),e("skylark-elfinder/commands/quicklook",["../elFinder"],function(e){return(e.prototype.commands.quicklook=function(){"use strict";var e,t,n,i,a,o,r,s,l,c,d=this,p=d.fm,u=0,h=Element.update?"quicklookupdate":"update",f="elfinder-quicklook-navbar-icon",m="elfinder-quicklook-fullscreen",g="elfinder-quicklook-info-wrapper",v=function(e){$(document).trigger($.Event("keydown",{keyCode:e,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},b=function(e){var t,n=p.getUI().offset(),i=(t=e.find(".elfinder-cwd-file-wrapper")).length?t:e,a=i.offset()||{top:0,left:0};return{opacity:0,width:i.width(),height:i.height()-30,top:a.top-n.top,left:a.left-n.left}},y={},w=function(e,t){var n=t||e.substr(0,e.indexOf("/")),i=y[n]?y[n]:y[n]=document.createElement(n),a=!1;try{a=i.canPlayType&&i.canPlayType(e)}catch(e){}return!(!a||""===a||"no"==a)},x=-1!=window.navigator.platform.indexOf("Win"),k=!1,C=!1,T=!1,z=null,j=$.ui.keyCode.LEFT,A=$.ui.keyCode.RIGHT,O="mousemove touchstart "+("onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll"),I=$('<span class="elfinder-dialog-title elfinder-quicklook-title"/>'),M=$("<div/>"),S=$('<div class="elfinder-quicklook-info"/>'),F=$('<div class="ui-front elfinder-quicklook-cover"/>'),E=$('<div class="'+f+" "+f+'-fullscreen"/>').on("click touchstart",function(e){if(!T){var t=d.window,n=t.hasClass(m),a=$(window),o=function(){d.preview.trigger("changesize")};e.stopPropagation(),e.preventDefault(),n?(B="",U(),t.toggleClass(m).css(t.data("position")),a.trigger(d.resize).off(d.resize,o),H.off("mouseenter mouseleave"),F.off(O)):(t.toggleClass(m).data("position",{left:t.css("left"),top:t.css("top"),width:t.width(),height:t.height(),display:"block"}).removeAttr("style"),$(window).on(d.resize,o).trigger(d.resize),F.on(O,function(e){C||("mousemove"!==e.type&&"touchstart"!==e.type||(U(),z=setTimeout(function(){(p.UA.Mobile||H.parent().find(".elfinder-quicklook-navbar:hover").length<1)&&H.fadeOut("slow",function(){F.show()})},3e3)),F.is(":visible")&&(P(),F.data("tm",setTimeout(function(){F.show()},3e3))))}).show().trigger("mousemove"),H.on("mouseenter mouseleave",function(e){C||("mouseenter"===e.type?U():F.trigger("mousemove"))})),p.zIndex&&t.css("z-index",p.zIndex+1),p.UA.Mobile?H.attr("style",B):H.attr("style",B).draggable(n?"destroy":{start:function(){C=!0,T=!0,F.show(),U()},stop:function(){C=!1,B=d.navbar.attr("style"),requestAnimationFrame(function(){T=!1})}}),$(this).toggleClass(f+"-fullscreen-off");var r=t;i.is(".ui-resizable")&&(r=r.add(i)),r.resizable(n?"enable":"disable").removeClass("ui-state-disabled"),t.trigger("viewchange")}}),D=function(){d.update(void 0,function(){var e,t=d.fm,n=t.selectedFiles(),i=n.length;d.docked();return i||(i=1,n=[t.cwd()]),1===i?n[0]:(e=0,$.each(n,function(t,n){var i=parseInt(n.ts);e>=0?i>e&&(e=i):e="unknown"}),{hash:n[0].hash+"/"+ +new Date,name:t.i18n("items")+": "+i,mime:"group",size:L,ts:e,files:$.map(n,function(e){return e.hash}),getSize:!0})}())},U=function(){d.window.hasClass(m)&&(z&&clearTimeout(z),z=null,H.stop(!0,!0).css("display","block"),P())},P=function(){F.data("tm")&&clearTimeout(F.data("tm")),F.removeData("tm"),F.hide()},q=$('<div class="'+f+" "+f+'-prev"/>').on("click touchstart",function(e){return!T&&v(j),!1}),R=$('<div class="'+f+" "+f+'-next"/>').on("click touchstart",function(e){return!T&&v(A),!1}),H=$('<div class="elfinder-quicklook-navbar"/>').append(q).append(E).append(R).append('<div class="elfinder-quicklook-navbar-separator"/>').append($('<div class="'+f+" "+f+'-close"/>').on("click touchstart",function(e){return!T&&d.window.trigger("close"),!1})),_=$('<span class="ui-front ui-icon elfinder-icon-close ui-icon-closethick"/>').on("mousedown",function(e){e.stopPropagation(),d.window.trigger("close")}),N=$('<span class="ui-front ui-icon elfinder-icon-minimize ui-icon-minusthick"/>').on("mousedown",function(e){e.stopPropagation(),d.docked()?d.window.trigger("navdockout"):d.window.trigger("navdockin")}),L='<span class="elfinder-spinner-text">'+p.i18n("calc")+'</span><span class="elfinder-spinner"/>',B="",W=!0;this.flags={},this.cover=F,this.evUpdate=h,(this.navbar=H)._show=U,this.resize="resize."+p.namespace,this.info=$("<div/>").addClass(g).append(M).append(S),this.autoPlay=function(){return!!d.opened()&&!!d.options[d.docked()?"dockAutoplay":"autoplay"]},this.preview=$('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').on("change",function(){U(),H.attr("style",B),d.docked()&&H.hide(),d.preview.attr("style","").removeClass("elfinder-overflow-auto"),d.info.attr("style","").hide(),d.cover.removeClass("elfinder-quicklook-coverbg"),M.removeAttr("class").attr("style",""),S.html("")}).on(h,function(e){d.preview;var t,n,i=e.file,o='<div class="elfinder-quicklook-info-data">{value}</div>',r=[];i&&!Object.keys(i).length&&(i=p.cwd()),i&&s&&"pending"===s.state()&&s._hash!==i.hash&&s.reject(),i&&(e.forceUpdate||d.window.data("hash")!==i.hash)?function(){var l=d.window.css("overflow","hidden");n=p.escape(i.i18||i.name),!i.read&&e.stopImmediatePropagation(),d.window.data("hash",i.hash),d.preview.off("changesize").trigger("change").children().remove(),I.html(n),q.css("visibility",""),R.css("visibility",""),i.hash===p.cwdId2Hash(a.find("[id]:not(.elfinder-cwd-parent):first").attr("id"))&&q.css("visibility","hidden");i.hash===p.cwdId2Hash(a.find("[id]:last").attr("id"))&&R.css("visibility","hidden");"directory"===i.mime?r=[i.hash]:"group"===i.mime&&i.getSize&&(r=i.files);S.html(o.replace(/\{value\}/,n)+o.replace(/\{value\}/,p.mime2kind(i))+o.replace(/\{value\}/,r.length?L:p.formatSize(i.size))+o.replace(/\{value\}/,p.i18n("modify")+": "+p.formatDate(i))),r.length&&((s=p.getSize(r).done(function(e){S.find("span.elfinder-spinner").parent().html(e.formated)}).fail(function(){S.find("span.elfinder-spinner").parent().html(p.i18n("unknown"))}).always(function(){s=null}))._hash=i.hash);M.addClass("elfinder-cwd-icon ui-corner-all "+p.mime2class(i.mime)),i.icon&&M.css(p.getIconStyle(i,!0));d.info.attr("class",g),i.csscls&&d.info.addClass(i.csscls);i.read&&(t=p.tmb(i))&&$("<img/>").hide().appendTo(d.preview).on("load",function(){M.addClass(t.className).css("background-image","url('"+t.url+"')"),$(this).remove()}).attr("src",t.url);d.info.delay(100).fadeIn(10),d.window.hasClass(m)&&F.trigger("mousemove");l.css("overflow","")}():e.stopImmediatePropagation()}),this.window=$('<div class="ui-front ui-helper-reset ui-widget elfinder-quicklook touch-punch" style="position:absolute"/>').hide().addClass(p.UA.Touch?"elfinder-touch":"").on("click",function(e){var t=this;e.stopPropagation(),2===u&&requestAnimationFrame(function(){2===u&&p.toFront(t)})}).append($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix elfinder-quicklook-titlebar"/>').append($('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button elfinder-quicklook-titlebar-icon'+(x?" elfinder-titlebar-button-right":"")+'"/>').append(_,N),I),this.preview,d.info.hide(),F.hide(),H).draggable({handle:"div.elfinder-quicklook-titlebar"}).on("open",function(n,i){var a=d.window,r=d.value,s=p.getUI("cwd"),c=function(e){u=e,d.update(1,d.value),d.change(),a.trigger("resize."+p.namespace)};W||0!==u?4===u&&(p.getUI("navdock").data("addNode")(l),c(3),d.preview.trigger("changesize"),p.storage("previewDocked","1"),0===p.getUI("navdock").width()&&a.trigger("navdockout")):(r&&r.hash!==o&&(s=p.cwdHash2Elm(r.hash.split("/",2)[0])),B="",H.attr("style",""),u=1,s.trigger("scrolltoview"),P(),a.css(i||b(s)).show().animate(function(){var n=d.options.contain||p.options.dialogContained,i=n?p.getUI():$(window),a=p.getUI().offset(),o=Math.min(e,i.width()-10),r=Math.min(t,i.height()-80);return{opacity:1,width:o,height:r,top:parseInt((i.height()-r-60)/2+(n?0:i.scrollTop()-a.top)),left:parseInt((i.width()-o)/2+(n?0:i.scrollLeft()-a.left))}}(),550,function(){c(2),U()}),p.toFront(a))}).on("close",function(e,t){var n,i=d.window,o=d.preview.trigger("change"),r=(d.value,(i.data("hash")||"").split("/",2)[0]),c=function(e,n){u=e,n&&p.toHide(i),o.children().remove(),d.update(0,d.value),i.data("hash",""),t&&t.resolve()};d.opened()&&(s&&"pending"===s.state()&&s.reject(),d.docked()?(l=p.getUI("navdock").data("removeNode")(d.window.attr("id"),"detach"),c(4),p.storage("previewDocked","2")):(u=1,i.hasClass(m)&&E.click(),r&&(n=a.find("#"+r)).length?i.animate(b(n),500,function(){o.off("changesize"),c(0,!0)}):c(0,!0)))}).on("navdockin",function(e,t){var i=d.window,a=p.getUI("navdock"),o=r||a.width(),s=t||{};W&&(s.init=!0),u=3,n=i.attr("style"),i.toggleClass("ui-front").removeClass("ui-widget").draggable("disable").resizable("disable").removeAttr("style").css({width:"100%",height:o,boxSizing:"border-box",paddingBottom:0,zIndex:"unset"}),H.hide(),N.toggleClass("ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize"),p.toHide(i,!0),a.data("addNode")(i,s),d.preview.trigger("changesize"),p.storage("previewDocked","1")}).on("navdockout",function(e){var t=d.window,i=p.getUI("navdock"),a=($.Deferred(),b(d.preview));r=t.outerHeight(),i.data("removeNode")(t.attr("id"),p.getUI()),t.toggleClass("ui-front").addClass("ui-widget").draggable("enable").resizable("enable").attr("style",n),N.toggleClass("ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize"),u=0,t.trigger("open",a),p.storage("previewDocked","0")}).on("resize."+p.namespace,function(){d.preview.trigger("changesize")}),this.alwaysEnabled=!0,this.value=null,this.handlers={select:function(e,t){c&&cancelAnimationFrame(c),e.data&&e.data.selected&&e.data.selected.length?d.opened()&&D():c=requestAnimationFrame(function(){d.opened()&&D()})},error:function(){d.window.is(":visible")&&d.window.trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")},navbarshow:function(){requestAnimationFrame(function(){d.docked()&&d.preview.trigger("changesize")})},destroy:function(){d.window.remove()}},this.shortcuts=[{pattern:"space"}],this.support={audio:{ogg:w("audio/ogg;"),webm:w("audio/webm;"),mp3:w("audio/mpeg;"),wav:w("audio/wav;"),m4a:w("audio/mp4;")||w("audio/x-m4a;")||w("audio/aac;"),flac:w("audio/flac;"),amr:w("audio/amr;")},video:{ogg:w("video/ogg;"),webm:w("video/webm;"),mp4:w("video/mp4;"),mkv:w("video/x-matroska;")||w("video/webm;"),"3gp":w("video/3gpp;")||w("video/mp4;"),m3u8:w("application/x-mpegURL","video")||w("application/vnd.apple.mpegURL","video"),mpd:w("application/dash+xml","video")}},y={},this.closed=function(){return 0==u||4==u},this.opened=function(){return 2==u||3==u},this.docked=function(){return 3==u},this.addIntegration=function(e){requestAnimationFrame(function(){p.trigger("helpIntegration",Object.assign({cmd:"quicklook"},e))})},this.init=function(){var n,s=this.options,l=this.window,c=this.preview;e=s.width>0?parseInt(s.width):450,t=s.height>0?parseInt(s.height):300,"auto"!==s.dockHeight&&((r=parseInt(s.dockHeight))||(r=void 0)),p.one("load",function(){!(k=p.getUI("navdock").data("dockEnabled"))&&N.hide(),i=p.getUI(),a=p.getUI("cwd"),p.zIndex&&l.css("z-index",p.zIndex+1),l.appendTo(i),$(document).on("keydown."+p.namespace,function(e){e.keyCode==$.ui.keyCode.ESCAPE&&d.opened()&&!d.docked()&&l.hasClass("elfinder-frontmost")&&l.trigger("close")}),l.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){c.trigger("changesize")}}),d.change(function(){d.opened()&&d.value&&(d.value.tmb&&1==d.value.tmb&&(d.value=Object.assign({},p.file(d.value.hash))),c.trigger($.Event(h,{file:d.value})))}),c.on(h,function(e){var t,i,a;if(t=e.file){if(i=t.hash,a=p.searchStatus.mixed&&p.searchStatus.state>1,"directory"!==t.mime)if(parseInt(t.size)||t.mime.match(s.mimeRegexNotEmptyCheck)){if(d.dispInlineRegex=n,a||p.optionsByHashes[i])try{d.dispInlineRegex=new RegExp(p.option("dispInlineRegex",i),"i")}catch(e){try{d.dispInlineRegex=new RegExp(p.isRoot(t)?p.options.dispInlineRegex:p.option("dispInlineRegex",t.phash),"i")}catch(e){d.dispInlineRegex=/^$/}}}else e.stopImmediatePropagation();else d.dispInlineRegex=/^$/;d.info.show()}else e.stopImmediatePropagation()}),$.each(p.commands.quicklook.plugins||[],function(e,t){"function"==typeof t&&new t(d)})}).one("open",function(){var e,t=Number(p.storage("previewDocked")||s.docked);k&&t>=1&&(e=d.window,d.exec(),e.trigger("navdockin",{init:!0}),2===t?e.trigger("close"):(d.update(void 0,p.cwd()),d.change())),W=!1}).bind("open",function(){o=p.cwd().hash,d.value=p.cwd();try{n=new RegExp(p.option("dispInlineRegex"),"i")}catch(e){n=/^$/}}).bind("change",function(e){e.data&&e.data.changed&&d.opened()&&$.each(e.data.changed,function(){if(d.window.data("hash")===this.hash)return d.window.data("hash",null),d.preview.trigger(h),!1})}).bind("navdockresizestart navdockresizestop",function(e){F["navdockresizestart"===e.type?"show":"hide"]()})},this.getstate=function(){return d.opened()?1:0},this.exec=function(){return d.closed()&&D(),d.enabled()&&d.window.trigger(d.opened()?"close":"open"),$.Deferred().resolve()},this.hideinfo=function(){this.info.stop(!0,!0).hide()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/quicklook.plugins",["../elFinder"],function(e){return e.prototype.commands.quicklook.plugins=[function(e){"use strict";var t,n,i=["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],a=e.fm.returnBytes(e.options.getDimThreshold||0),o=e.preview;(t=new Image).onload=t.onerror=function(){2==t.height&&i.push("image/webp")},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",$.each(navigator.mimeTypes,function(e,t){var n=t.type;0===n.indexOf("image/")&&$.inArray(n,i)&&i.push(n)}),o.on(e.evUpdate,function(t){var r,s,l,c,d=e.fm,p=t.file,u=!1,h=null,f=function(e){var t=d.file(p.hash);t.width=e[0],t.height=e[1]},m=function(){var e,t,n,i,a;h&&h.state&&"pending"===h.state()&&h.reject(),u||(u=!0,e=r.get(0),(t=p.width&&p.height?{w:p.width,h:p.height}:e.naturalWidth?null:{w:r.width(),h:r.height()})&&r.removeAttr("width").removeAttr("height"),n=p.width||e.naturalWidth||e.width||r.width(),i=p.height||e.naturalHeight||e.height||r.height(),p.width&&p.height||f([n,i]),t&&r.width(t.w).height(t.h),a=(n/i).toFixed(2),o.on("changesize",function(){var e,t,n=parseInt(o.width()),i=parseInt(o.height());a<(n/i).toFixed(2)?(t=i,e=Math.floor(t*a)):(e=n,t=Math.floor(e/a)),r.width(e).height(t).css("margin-top",t<i?Math.floor((i-t)/2):0)}).trigger("changesize"),r.fadeIn(100))};n||(n=d.arrayFlip(i)),n[p.mime]&&e.dispInlineRegex.test(p.mime)&&(t.stopImmediatePropagation(),s=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+d.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),l=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(s),r=$("<img/>").hide().appendTo(o).on("load",function(){s.remove(),e.hideinfo(),m()}).on("error",function(){s.remove()}),c=d.openUrl(p.hash,!1,function(e){r.attr("src",e)},{progressBar:l}),o.one("change",function(){c&&c.state&&"pending"===c.state()&&c.reject()}),p.width&&p.height?m():p.size>a&&(h=d.request({data:{cmd:"dim",target:p.hash},preventDefault:!0}).done(function(e){if(e.dim){var t=e.dim.split("x");p.width=t[0],p.height=t[1],f(t),m()}})))})},function(e){"use strict";var t=e.fm,n=e.preview;window.Worker&&window.Uint8Array&&n.on(e.evUpdate,function(i){var a,o,r,s,l,c=i.file,d=function(e){s&&s.terminate(),a.remove(),t.debug("error",e)};"image/tiff"===c.mime&&(i.stopImmediatePropagation(),a=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+t.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),o=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(a),n.one("change",function(){s&&s.terminate(),a.remove()}),l=t.getContents(c.hash,"arraybuffer",{progressBar:o}).done(function(i){if(i){r=$("<div/>").css({width:"100%",height:"100%"}).hide().appendTo(n);try{(s=t.getWorker()).onmessage=function(i){var o,l,d,p,u,h,f=i.data;s&&s.terminate(),o=document.createElement("canvas"),l=o.getContext("2d"),o.width=f.width,o.height=f.height,(d=l.createImageData(f.width,f.height)).data.set(new Uint8Array(f.image)),l.putImageData(d,0,0),r.append(o).show(),a.remove(),p=(f.width/f.height).toFixed(2),n.on("changesize",function(){var e,t,i=parseInt(n.width()),a=parseInt(n.height());p<(i/a).toFixed(2)?(t=a,e=Math.floor(t*p)):(e=i,t=Math.floor(e/p)),$(o).width(e).height(t).css("margin-top",t<a?Math.floor((a-t)/2):0)}).trigger("changesize"),c.width&&c.height||(u=[f.width,f.height],(h=t.file(c.hash)).width=u[0],h.height=u[1]),e.hideinfo()},s.onerror=d,s.postMessage({scripts:[t.options.cdns.tiff,t.getWorkerUrl("quicklook.tiff.js")],data:{data:i}})}catch(e){d(e)}}else d()}),n.one("change",function(){l&&l.state&&"pending"===l.state()&&l.reject()}))})},function(e){"use strict";var t,n=e.fm,i=n.arrayFlip(["image/vnd.adobe.photoshop","image/x-photoshop"]),a=e.preview,o=function(i,o,r){try{n.replaceXhrSend(),t.fromURL(i).then(function(t){var n;o.attr("src",t.image.toBase64()),requestAnimationFrame(function(){n=(o.width()/o.height()).toFixed(2),a.on("changesize",function(){var e,t,i=parseInt(a.width()),r=parseInt(a.height());n<(i/r).toFixed(2)?(t=r,e=Math.floor(t*n)):(e=i,t=Math.floor(e/n)),o.width(e).height(t).css("margin-top",t<r?Math.floor((r-t)/2):0)}).trigger("changesize"),r.remove(),e.hideinfo(),o.fadeIn(100)})},function(){r.remove(),o.remove()}),n.restoreXhrSend()}catch(e){n.restoreXhrSend(),r.remove(),o.remove()}};a.on(e.evUpdate,function(r){var s,l,c,d,p,u,h=r.file;i[h.mime]&&n.options.cdns.psd&&!n.UA.ltIE10&&e.dispInlineRegex.test(h.mime)&&(r.stopImmediatePropagation(),l=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+n.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),c=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(l),u=n.openUrl(h.hash,"sameorigin",function(e){e&&(s=$("<img/>").hide().appendTo(a),t?o(e,s,l):(d=window.define,p=window.require,window.require=null,window.define=null,n.loadScript([n.options.cdns.psd],function(){t=require("psd"),d?window.define=d:delete window.define,p?window.require=p:delete window.require,o(e,s,l)})))},{progressBar:c}),a.one("change",function(){u&&u.state&&"pending"===u.state()&&u.reject()}))})},function(e){"use strict";var t=e.fm,n=t.arrayFlip(["text/html","application/xhtml+xml"]),i=e.preview;i.on(e.evUpdate,function(a){var o,r,s,l=a.file;n[l.mime]&&e.dispInlineRegex.test(l.mime)&&(!e.options.getSizeMax||l.size<=e.options.getSizeMax)&&(a.stopImmediatePropagation(),r=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+t.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),s=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(r),i.one("change",function(){"pending"==o.state()&&o.reject()}).addClass("elfinder-overflow-auto"),o=t.request({data:{cmd:"get",target:l.hash,conv:1,_t:l.ts},options:{type:"get",cache:!0},preventDefault:!0,progressBar:s}).done(function(t){e.hideinfo();var n=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(i)[0].contentWindow.document;n.open(),n.write(t.content),n.close()}).always(function(){r.remove()}))})},function(e){"use strict";var t=e.fm,n=t.arrayFlip(["text/x-markdown"]),i=e.preview,a=null,o=function(t,n){e.hideinfo();var o=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(i)[0].contentWindow.document;o.open(),o.write(a(t.content)),o.close(),n.remove()},r=function(e){a=!1,e.remove()};i.on(e.evUpdate,function(s){var l,c,d,p=s.file;n[p.mime]&&t.options.cdns.marked&&!1!==a&&e.dispInlineRegex.test(p.mime)&&(!e.options.getSizeMax||p.size<=e.options.getSizeMax)&&(s.stopImmediatePropagation(),c=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+t.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),d=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(c),i.one("change",function(){"pending"==l.state()&&l.reject()}).addClass("elfinder-overflow-auto"),l=t.request({data:{cmd:"get",target:p.hash,conv:1,_t:p.ts},options:{type:"get",cache:!0},preventDefault:!0,progressBar:d}).done(function(e){a||window.marked?(a||(a=window.marked),o(e,c)):t.loadScript([t.options.cdns.marked],function(t){a=t||window.marked||!1,delete window.marked,a?o(e,c):r(c)},{tryRequire:!0,error:function(){r(c)}})}).fail(function(){r(c)}))})},function(e){if(e.options.viewerjs){var t=e.fm,n=e.preview,i=e.options.viewerjs,a=i.url?t.arrayFlip(i.mimes||[]):[],o=e.window,r=e.navbar,s=function(){r.css("bottom",o.hasClass("elfinder-quicklook-fullscreen")?"30px":"")};i.url&&n.on("update",function(r){var l,c,d,p,u=r.file;!a[u.mime]||"application/pdf"===u.mime&&i.pdfNative&&e.flags.pdfNative||(r.stopImmediatePropagation(),c=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+t.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),d=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(c),p=t.openUrl(u.hash,"sameorigin",function(t){t&&(l=$('<iframe class="elfinder-quicklook-preview-iframe"/>').css("background-color","transparent").on("load",function(){e.hideinfo(),c.remove(),l.css("background-color","#fff")}).on("error",function(){c.remove(),l.remove()}).appendTo(n).attr("src",i.url+"#"+t),o.on("viewchange.viewerjs",s),s(),n.one("change",function(){o.off("viewchange.viewerjs"),c.remove(),l.off("load").remove()}))},{progressBar:d}),n.one("change",function(){p&&p.state&&"pending"===p.state()&&p.reject()}))})}},function(e){"use strict";var t=e.fm,n="application/pdf",i=e.preview,a=!1,o="";t.UA.Safari&&"mac"===t.OS&&!t.UA.iOS||t.UA.IE||t.UA.Firefox?a=!0:$.each(navigator.plugins,function(e,t){$.each(t,function(e,t){if(t.type===n)return!(a=!0)})}),e.flags.pdfNative=a,a&&(void 0===e.options.pdfToolbar||e.options.pdfToolbar||(o="#toolbar=0"),i.on(e.evUpdate,function(r){var s,l=r.file;a&&l.mime===n&&e.dispInlineRegex.test(l.mime)&&(r.stopImmediatePropagation(),s=t.openUrl(l.hash,!1,function(n){n&&(e.hideinfo(),e.cover.addClass("elfinder-quicklook-coverbg"),$('<object class="elfinder-quicklook-preview-pdf" data="'+n+o+'" type="application/pdf" />').on("error",function(n){a=!1,e.update(void 0,t.cwd()),e.update(void 0,l)}).appendTo(i))}),i.one("change",function(){s&&s.state&&"pending"===s.state()&&s.reject()}))}))},function(e){"use strict";var t=e.fm,n="application/x-shockwave-flash",i=e.preview,a=!1;$.each(navigator.plugins,function(e,t){$.each(t,function(e,t){if(t.type===n)return!(a=!0)})}),a&&i.on(e.evUpdate,function(a){var o,r=a.file;r.mime===n&&e.dispInlineRegex.test(r.mime)&&(a.stopImmediatePropagation(),o=t.openUrl(r.hash,!1,function(t){t&&(e.hideinfo(),$('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t+'" quality="high" type="application/x-shockwave-flash" wmode="transparent" />').appendTo(i))}),i.one("change",function(){o&&o.state&&"pending"===o.state()&&o.reject()}))})},function(e){"use strict";var t,n,i,a,o,r,s=e.fm,l=e.preview,c={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg","audio/webm":"webm","audio/flac":"flac","audio/x-flac":"flac","audio/amr":"amr"},d=e.window,p=e.navbar,u="string"==typeof e.options.mediaControlsList&&e.options.mediaControlsList?' controlsList="'+s.escape(e.options.mediaControlsList)+'"':"",h=function(){p.css("bottom",d.hasClass("elfinder-quicklook-fullscreen")?"50px":"")},f=function(e,n){return $('<audio class="elfinder-quicklook-preview-audio ui-front" controls'+u+' preload="auto" autobuffer><source src="'+e+'" /></audio>').on("change",function(e){e.stopPropagation()}).on("error",function(e){t&&t.data("hash")===n&&g()}).data("hash",n).appendTo(l)},m=function(e){var n,i=t.data("hash");a&&(n=e.play()),n&&n.catch&&n.catch(function(n){e.paused||t&&t.data("hash")===i&&g()})},g=function(){if(t&&t.parent().length){var e=t[0],n=t.children("source").attr("src");d.off("viewchange.audio");try{e.pause(),t.empty(),n.match(/^blob:/)&&URL.revokeObjectURL(n),e.src="",e.load()}catch(e){}t.remove(),t=null}};l.on(e.evUpdate,function(p){var u,g,v=p.file,b=c[v.mime];c[v.mime]&&e.dispInlineRegex.test(v.mime)&&((u=e.support.audio[b])||"amr"===b)&&(a=e.autoPlay(),n=v.hash,u?(p.stopImmediatePropagation(),o=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+s.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),r=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(o),g=s.openUrl(n,!1,function(e){o.remove(),e?(t=f(e,n),m(t[0]),d.on("viewchange.audio",h),h()):t.remove()},{progressBar:r}),l.one("change",function(){g&&g.state&&"pending"===g.state()&&g.reject()})):s.options.cdns.amr&&"amr"===b&&!1!==i&&(p.stopImmediatePropagation(),o=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+s.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),r=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(o),t=f("",n),function(e){var t,n=$.Deferred(),a=$.Deferred().done(function(){var t;t=s.getContents(e,"arraybuffer",{progressBar:r}).done(function(e){try{var t=i.toWAV(new Uint8Array(e));t?n.resolve(URL.createObjectURL(new Blob([t],{type:"audio/x-wav"}))):n.reject()}catch(e){n.reject()}}).fail(function(){n.reject()}),l.one("change",function(){t&&t.state&&"pending"===t.state()&&t.reject()})}).fail(function(){i=!1,n.reject()});window.TextEncoder&&window.URL&&URL.createObjectURL&&void 0===i?(t=window.AMR,delete window.AMR,s.loadScript([s.options.cdns.amr],function(){i=!!window.AMR&&window.AMR,window.AMR=t,a[i?"resolve":"reject"]()},{error:function(){a.reject()}})):a[i?"resolve":"reject"]();return n}(v.hash).done(function(e){if(o.remove(),n===v.hash){var i=t[0];try{t.children("source").attr("src",e),i.pause(),i.load(),m(i),d.on("viewchange.audio",h),h()}catch(n){URL.revokeObjectURL(e),t.remove()}}else URL.revokeObjectURL(e)}).fail(function(){t.remove()})))}).one("change",g)},function(e){"use strict";var t,n,i,a,o,r,s,l,c,d,p=e.fm,u=e.preview,h={"video/mp4":"mp4","video/x-m4v":"mp4","video/quicktime":"mp4","video/mpeg":"mpeg","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm","video/x-matroska":"mkv","video/3gpp":"3gp","application/vnd.apple.mpegurl":"m3u8","application/x-mpegurl":"m3u8","application/dash+xml":"mpd","video/x-flv":"flv","video/x-msvideo":"avi"},f=e.window,m=e.navbar,g="string"==typeof e.options.mediaControlsList&&e.options.mediaControlsList?' controlsList="'+p.escape(e.options.mediaControlsList)+'"':"",v=function(){p.UA.iOS?f.hasClass("elfinder-quicklook-fullscreen")?(u.css("height","-webkit-calc(100% - 50px)"),m._show()):u.css("height",""):m.css("bottom",f.hasClass("elfinder-quicklook-fullscreen")?"50px":"")},b=function(n,i){var o,r=function(e){s>1&&(l&&clearTimeout(l),l=setTimeout(function(){!o&&T(!0)},800))},s=0;a=null,i=i||{},e.hideinfo(),(t=$('<video class="elfinder-quicklook-preview-video" controls'+g+' preload="auto" autobuffer playsinline></video>').on("change",function(e){e.stopPropagation()}).on("timeupdate progress",r).on("canplay",function(){o=!0}).data("hash",n.hash))[0].addEventListener("error",function(e){i.src&&p.convAbsUrl(i.src)===p.convAbsUrl(e.target.src)&&(++s,r())},!0),i.src&&t.append('<source src="'+i.src+'" type="'+n.mime+'"/><source src="'+i.src+'"/>'),t.appendTo(u),f.on("viewchange.video",v),v()},y=function(e){var i,a;a=p.openUrl(e.hash,!1,function(a){c.remove(),a&&(b(e),(i=new n).loadSource(a),i.attachMedia(t[0]),s&&i.on(n.Events.MANIFEST_PARSED,function(){C(t[0])}))},{progressBar:d}),u.one("change",function(){a&&a.state&&"pending"===a.state()&&a.reject()})},w=function(e){var n;n=p.openUrl(e.hash,!1,function(n){var i;c.remove(),n&&(b(e),a=window.dashjs.MediaPlayer().create(),(i=a.getDebug()).setLogLevel?i.setLogLevel(dashjs.Debug.LOG_LEVEL_FATAL):i.setLogToBrowserConsole&&i.setLogToBrowserConsole(!1),a.initialize(t[0],n,s),a.on("error",function(e){T(!0)}))},{progressBar:d}),u.one("change",function(){n&&n.state&&"pending"===n.state()&&n.reject()})},x=function(e){var n;o.isSupported()?(n=p.openUrl(e.hash,!1,function(n){if(c.remove(),n){var i=o.createPlayer({type:"flv",url:n});b(e),i.on(o.Events.ERROR,function(){i.destroy(),T(!0)}),i.attachMediaElement(t[0]),i.load(),C(i)}},{progressBar:d}),u.one("change",function(){n&&n.state&&"pending"===n.state()&&n.reject()})):o=!1},k=function(e){var n;n=p.openUrl(e.hash,!1,function(n){c.remove(),n&&(b(e),t[0].src=n,r(t[0],{src:n}))},{progressBar:d}),u.one("change",function(){n&&n.state&&"pending"===n.state()&&n.reject()})},C=function(e){var n,i=t.data("hash");s&&(n=e.play()),n&&n.catch&&n.catch(function(n){e.paused||t&&t.data("hash")===i&&T(!0)})},T=function(n){if(l&&clearTimeout(l),t&&t.parent().length){var i=t[0];f.off("viewchange.video"),a&&a.reset();try{i.pause(),t.empty(),i.src="",i.load()}catch(e){}t.remove(),t=null}n&&e.info.show()};u.on(e.evUpdate,function(a){var l,f,m=a.file,g=m.mime.toLowerCase(),v=h[g];h[g]&&e.dispInlineRegex.test(m.mime)&&(s=e.autoPlay(),c=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+p.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>'),d=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(c),e.support.video[v]&&("m3u8"!==v||p.UA.Safari)?(a.stopImmediatePropagation(),c.appendTo(e.info.find(".elfinder-quicklook-info")),f=p.openUrl(m.hash,!1,function(e){c.remove(),e&&(b(m,{src:e}),C(t[0]))},{progressBar:d}),u.one("change",function(){f&&f.state&&"pending"===f.state()&&f.reject()})):!1!==n&&p.options.cdns.hls&&"m3u8"===v?(a.stopImmediatePropagation(),c.appendTo(e.info.find(".elfinder-quicklook-info")),n?y(m):(l=window.Hls,delete window.Hls,p.loadScript([p.options.cdns.hls],function(e){n=e||window.Hls||!1,window.Hls=l,n&&y(m)},{tryRequire:!0,error:function(){n=!1}}))):!1!==i&&p.options.cdns.dash&&"mpd"===v?(a.stopImmediatePropagation(),c.appendTo(e.info.find(".elfinder-quicklook-info")),i?w(m):p.loadScript([p.options.cdns.dash],function(){(i=!!window.dashjs)&&w(m)},{tryRequire:!0,error:function(){i=!1}})):!1!==o&&p.options.cdns.flv&&"flv"===v?(a.stopImmediatePropagation(),c.appendTo(e.info.find(".elfinder-quicklook-info")),o?x(m):(l=window.flvjs,delete window.flvjs,p.loadScript([p.options.cdns.flv],function(e){o=e||window.flvjs||!1,window.flvjs=l,o&&x(m)},{tryRequire:!0,error:function(){o=!1}}))):p.options.cdns.videojs&&(a.stopImmediatePropagation(),c.appendTo(e.info.find(".elfinder-quicklook-info")),r?k(m):p.loadScript([p.options.cdns.videojs+"/video.min.js"],function(e){(r=e||window.videojs||!1)&&k(m)},{tryRequire:!0,error:function(){r=!1}}).loadCss([p.options.cdns.videojs+"/video-js.min.css"])))}).one("change",T)},function(e){"use strict";var t,n=e.preview,i=[],a=e.window,o=e.navbar;$.each(navigator.plugins,function(e,t){$.each(t,function(e,t){(0===t.type.indexOf("audio/")||0===t.type.indexOf("video/"))&&i.push(t.type)})}),i=e.fm.arrayFlip(i),n.on(e.evUpdate,function(r){var s,l,c,d,p=r.file,u=p.mime,h=function(){o.css("bottom",a.hasClass("elfinder-quicklook-fullscreen")?"50px":"")};i[p.mime]&&e.dispInlineRegex.test(p.mime)&&(r.stopImmediatePropagation(),c=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+fm.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),d=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(c),l=e.fm.openUrl(p.hash,!1,function(i){c.remove(),i&&((s=0===u.indexOf("video/"))&&e.hideinfo(),t=$('<embed src="'+i+'" type="'+u+'" class="elfinder-quicklook-preview-'+(s?"video":"audio")+'"/>').appendTo(n),a.on("viewchange.embed",h),h())},{progressBar:d}),n.one("change",function(){l&&l.state&&"pending"===l.state()&&l.reject()}))}).one("change",function(){t&&t.parent().length&&(a.off("viewchange.embed"),t.remove(),t=null)})},function(e){"use strict";var t=e.fm,n=t.arrayFlip(["application/zip","application/x-gzip","application/x-tar","application/x-bzip2"]),i=e.preview,a=t.returnBytes(e.options.unzipMaxSize||0),o=!(!t.options.cdns.zlibUnzip||!t.options.cdns.zlibGunzip),r=!!t.options.cdns.bzip2;window.Worker&&window.Uint8Array&&window.DataView&&i.on(e.evUpdate,function(s){var l=s.file,c="application/x-tar"===l.mime,d="application/x-bzip2"===l.mime,p="application/zip"===l.mime||"application/x-gzip"===l.mime;if(n[l.mime]&&(!a||l.size<=a)&&(c||d&&r||p&&o)){var u,h,f,m,g=function(n){var a,o,r=0;n&&n.length&&((n=$.map(n,function(e){return t.decodeRawString(e)})).sort(),o=t.escape(n.join("\n").replace(/\{formatSize\((\d+)\)\}/g,function(e,n){return r+=parseInt(n),t.formatSize(n)})),a="<strong>"+t.escape(l.mime)+"</strong> ("+t.formatSize(l.size)+" / "+t.formatSize(r)+")<hr/>",$('<div class="elfinder-quicklook-preview-archive-wrapper">'+a+'<pre class="elfinder-quicklook-preview-text">'+o+"</pre></div>").on("touchstart",function(e){$(this)["scroll"+("ltr"===t.direction?"Right":"Left")]()>5&&(e.originalEvent._preventSwipeX=!0)}).appendTo(i),e.hideinfo()),f.remove()};s.stopImmediatePropagation(),f=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+t.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),m=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(f),i.one("change",function(){"pending"===u.state()&&u.reject(),h&&h.terminate(),f.remove()}),u=t.getContents(l.hash,"arraybuffer",{progressBar:m}).fail(function(){f.remove()}).done(function(e){var n=function(e){h&&h.terminate(),f.remove(),p?o=!1:d&&(r=!1),t.debug("error",e)};try{(h=t.getWorker()).onmessage=function(e){h&&h.terminate(),f.remove(),!e.data||e.data.error?new Error(e.data&&e.data.error?e.data.error:""):g(e.data.files)},h.onerror=n,"application/x-tar"===l.mime?h.postMessage({scripts:[t.getWorkerUrl("quicklook.unzip.js")],data:{type:"tar",bin:e}}):"application/zip"===l.mime?h.postMessage({scripts:[t.options.cdns.zlibUnzip,t.getWorkerUrl("quicklook.unzip.js")],data:{type:"zip",bin:e}}):"application/x-gzip"===l.mime?h.postMessage({scripts:[t.options.cdns.zlibGunzip,t.getWorkerUrl("quicklook.unzip.js")],data:{type:"gzip",bin:e}}):"application/x-bzip2"===l.mime&&h.postMessage({scripts:[t.options.cdns.bzip2,t.getWorkerUrl("quicklook.unzip.js")],data:{type:"bzip2",bin:e}})}catch(e){n(e)}})}})},function(e){"use strict";var t,n=e.fm,i=n.arrayFlip(["application/x-rar"]),a=e.preview;window.DataView&&a.on(e.evUpdate,function(o){var r=o.file;if(i[r.mime]&&n.options.cdns.rar&&!1!==t){var s,l,c,d,p,u,h=function(i){if(d)s.remove();else try{c=t({file:i,type:2,xhrHeaders:n.customHeaders,xhrFields:n.xhrFields},function(t){s.remove();var i,o=[];d||t?t&&n.debug("error",t):($.each(c.entries,function(){o.push(this.path+(this.size?" ("+n.formatSize(this.size)+")":""))}),o.length&&((o=$.map(o,function(e){return n.decodeRawString(e)})).sort(),i="<strong>"+n.escape(r.mime)+"</strong> ("+n.formatSize(r.size)+")<hr/>",$('<div class="elfinder-quicklook-preview-archive-wrapper">'+i+'<pre class="elfinder-quicklook-preview-text">'+n.escape(o.join("\n"))+"</pre></div>").on("touchstart",function(e){$(this)["scroll"+("ltr"===n.direction?"Right":"Left")]()>5&&(e.originalEvent._preventSwipeX=!0)}).appendTo(a),e.hideinfo()))})}catch(e){s.remove()}},f=function(){t=!1,s.remove()};o.stopImmediatePropagation(),s=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+n.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),l=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(s),a.one("change",function(){c&&(c.abort=!0),s.remove(),d=!0}),u=n.openUrl(r.hash,"sameorigin",function(e){e&&(t?h(e):(window.RarArchive&&(p=window.RarArchive,delete window.RarArchive),n.loadScript([n.options.cdns.rar],function(){n.hasRequire?require(["rar"],function(n){t=n,h(e)},f):(t=window.RarArchive)?(p?window.RarArchive=p:delete window.RarArchive,h(e)):f()},{tryRequire:!0,error:f})))},{progressBar:l,temporary:!0}),a.one("change",function(){u&&u.state&&"pending"===u.state()&&u.reject()})}})},function(e){"use strict";var t,n=e.fm,i=n.arrayFlip(e.options.sharecadMimes||[]),a=e.preview;e.window;e.options.sharecadMimes.length&&e.addIntegration({title:"ShareCAD.org CAD and 3D-Models viewer",link:"https://sharecad.org/DWGOnlinePlugin"}),a.on(e.evUpdate,function(o){var r=o.file;if(i[r.mime.toLowerCase()]&&!n.option("onetimeUrl",r.hash)){var s,l,c;e.window;o.stopImmediatePropagation(),"1"==r.url&&(a.hide(),$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+n.i18n("getLink")+"</button></div>").appendTo(e.info.find(".elfinder-quicklook-info")).on("click",function(){var t=$(this);t.html('<span class="elfinder-spinner">'),n.request({data:{cmd:"url",target:r.hash},preventDefault:!0,progressBar:l}).always(function(){t.html("")}).done(function(t){var i=n.file(r.hash);r.url=i.url=t.url||"",r.url&&a.trigger({type:e.evUpdate,file:r,forceUpdate:!0})})})),""!==r.url&&"1"!=r.url&&(a.one("change",function(){s.remove(),t.off("load").remove(),t=null}).addClass("elfinder-overflow-auto"),s=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+n.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),l=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(s),c=n.convAbsUrl(n.url(r.hash)),t=$('<iframe class="elfinder-quicklook-preview-iframe" scrolling="no"/>').css("background-color","transparent").appendTo(a).on("load",function(){e.hideinfo(),s.remove(),e.preview.after(e.info),$(this).css("background-color","#fff").show()}).on("error",function(){s.remove(),e.preview.after(e.info)}).attr("src","//sharecad.org/cadframe/load?url="+encodeURIComponent(c)),e.info.after(e.preview))}})},function(e){"use strict";var t,n,i,a,o,r=e.fm,s={"application/vnd.google-earth.kml+xml":!0,"application/vnd.google-earth.kmz":!0},l=e.preview;e.options.googleMapsApiKey&&(e.addIntegration({title:"Google Maps",link:"https://www.google.com/intl/"+r.lang.replace("_","-")+"/help/terms_maps.html"}),t=window.google&&google.maps,n=function(n,i,o){var s=e.options.googleMapsOpts.maps;r.forExternalUrl(n.hash,{progressBar:o}).done(function(n){if(n)try{new t.KmlLayer(n,Object.assign({map:new t.Map(i.get(0),s)},e.options.googleMapsOpts.kml)),e.hideinfo()}catch(e){a()}else a()})},i=window.gm_authFailure,a=function(){o=null},o="https://maps.googleapis.com/maps/api/js?key="+e.options.googleMapsApiKey,window.gm_authFailure=function(){a(),i&&i()},l.on(e.evUpdate,function(i){var a=i.file;if(o&&s[a.mime.toLowerCase()]){e.window;var c,d,p,u="1"==a.url&&!r.option("onetimeUrl",a.hash);i.stopImmediatePropagation(),c=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+r.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),d=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(c),u&&(l.hide(),$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+r.i18n("getLink")+"</button></div>").appendTo(e.info.find(".elfinder-quicklook-info")).on("click",function(){var t=$(this);t.html('<span class="elfinder-spinner">'),r.request({data:{cmd:"url",target:a.hash},preventDefault:!0,progressBar:d}).always(function(){c.remove(),t.html("")}).done(function(t){var n=r.file(a.hash);a.url=n.url=t.url||"",a.url&&l.trigger({type:e.evUpdate,file:a,forceUpdate:!0})})})),""===a.url||u||(p=$('<div style="width:100%;height:100%;"/>').appendTo(l),l.one("change",function(){p.remove(),p=null}),t?n(a,p,d):r.loadScript([o],function(){(t=window.google&&google.maps)&&n(a,p,d)}))}}))},function(e){"use strict";var t,n,i=e.fm,a=Object.assign(i.arrayFlip(e.options.googleDocsMimes||[],"g"),i.arrayFlip(e.options.officeOnlineMimes||[],"m")),o=e.preview,r=(e.window,e.navbar),s={g:"docs.google.com/gview?embedded=true&url=",m:"view.officeapps.live.com/op/embed.aspx?wdStartOn=0&src="},l={g:"56px",m:"24px"},c={xls:5242880,xlsb:5242880,xlsx:5242880,xlsm:5242880,other:10485760};e.options.googleDocsMimes.length&&(n=!0,e.addIntegration({title:"Google Docs Viewer",link:"https://docs.google.com/"})),e.options.officeOnlineMimes.length&&(n=!0,e.addIntegration({title:"MS Online Doc Viewer",link:"https://products.office.com/office-online/view-office-documents-online"})),n&&o.on(e.evUpdate,function(n){var d,p,u=n.file;if(u.size<=26214400&&(d=a[u.mime])){var h,f,m,g=e.window,v=function(){r.css("bottom",g.hasClass("elfinder-quicklook-fullscreen")?l[d]:"")},b=i.mimeTypes[u.mime],y="1"==u.url&&!i.option("onetimeUrl",u.hash);"m"===d&&(c[b]&&u.size>c[b]||u.size>c.other)&&(d="g"),y&&(o.hide(),$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+i.i18n("getLink")+"</button></div>").appendTo(e.info.find(".elfinder-quicklook-info")).on("click",function(){var t=$(this);t.html('<span class="elfinder-spinner">'),i.request({data:{cmd:"url",target:u.hash},preventDefault:!0}).always(function(){t.html("")}).done(function(t){var n=i.file(u.hash);u.url=n.url=t.url||"",u.url&&o.trigger({type:e.evUpdate,file:u,forceUpdate:!0})})})),""===u.url||y||(n.stopImmediatePropagation(),o.one("change",function(){p&&p.status&&"pending"===p.status()&&p.reject(),g.off("viewchange.googledocs"),h.remove(),t.off("load").remove(),t=null}).addClass("elfinder-overflow-auto"),h=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),f=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(h),t=$('<iframe class="elfinder-quicklook-preview-iframe"/>').css("background-color","transparent").appendTo(o),p=i.forExternalUrl(u.hash,{progressBar:f}).done(function(n){var i=function(){try{!t||t.attr("src")&&!t.get(0).contentWindow.document||(t.attr("src","https://"+s[d]+encodeURIComponent(n)),m=setTimeout(i,2e3))}catch(e){}};n?(u.ts&&(n+=(n.match(/\?/)?"&":"?")+"_t="+u.ts),t.on("load",function(){m&&clearTimeout(m),e.hideinfo(),h.remove(),e.preview.after(e.info),$(this).css("background-color","#fff").show()}).on("error",function(){m&&clearTimeout(m),h.remove(),e.preview.after(e.info)}),i()):(h.remove(),t.remove())}),g.on("viewchange.googledocs",v),v(),e.info.after(e.preview))}})},function(e){"use strict";var t,n,i=e.fm,a=e.preview,o=parseInt(e.options.textInitialLines)||150,r=parseInt(e.options.prettifyMaxLines)||500,s=function(){l=function(){return!1},n&&(window.PR=n),t=!1},l=function(e){i.options.cdns.prettify?(l=function(e){return setTimeout(function(){d(e)},100),"pending"},window.PR&&(n=window.PR),i.loadScript([i.options.cdns.prettify+(i.options.cdns.prettify.match(/\?/)?"&":"?")+"autorun=false"],function(i){"object"==typeof(t=i||window.PR)?(l=function(){return!0},n?window.PR=n:delete window.PR,c(e)):s()},{tryRequire:!0,error:s})):s()},c=function(e){e&&!e.hasClass("prettyprinted")&&(e.css("cursor","wait"),requestAnimationFrame(function(){t.prettyPrint&&t.prettyPrint(null,e.get(0)),e.css("cursor","")}))},d=function(e){var t=l(e);!0===t&&c(e)};a.on(e.evUpdate,function(n){var s,l,c,p,u=n.file;u.mime;i.mimeIsText(u.mime)&&(!e.options.getSizeMax||u.size<=e.options.getSizeMax)&&!1!==t&&(n.stopImmediatePropagation(),l=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),c=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(l),a.one("change",function(){"pending"==s.state()&&s.reject(),p&&p.remove()}),s=i.request({data:{cmd:"get",target:u.hash,conv:u.encoding||1,_t:u.ts},options:{type:"get",cache:!0},preventDefault:!0,progressBar:c}).done(function(t){var n,s,l,c,p,h=new RegExp("^(data:"+u.mime.replace(/([.+])/g,"\\$1")+";base64,)","i"),f=t.content;"string"==typeof f&&(e.hideinfo(),window.atob&&(p=f.match(h))&&(f=atob(f.substr(p[1].length))),c=f.match(/([^\r\n]{1,100}[\r\n]*)/g),(s=c.length-o)>10?n=c.splice(0,o).join(""):s=0,l=$('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text prettyprint"></pre></div>'),s&&l.append($('<div class="elfinder-quicklook-preview-charsleft"><hr/><span>'+i.i18n("linesLeft",i.toLocaleString(s))+"</span></div>").on("click",function(){var e=l.scrollTop();$(this).remove(),l.children("pre").removeClass("prettyprinted").text(f).scrollTop(e),c.length<=r&&d(l)})),l.children("pre").text(n||f),l.on("touchstart",function(e){$(this)["scroll"+("ltr"===i.direction?"Right":"Left")]()>5&&(e.originalEvent._preventSwipeX=!0)}).appendTo(a),t.toasts&&Array.isArray(t.toasts)&&$.each(t.toasts,function(){this.msg&&i.toast(this)}),d(l))}).always(function(t){var n,o,r;(n=i.getCommand("edit"))&&(r=[],t&&t.encoding&&r.push({value:t.encoding}),r.push({value:"UTF-8"}),(o=n.getEncSelect(r)).on("change",function(){u.encoding=o.val(),i.cache(u,"change"),a.trigger({type:e.evUpdate,file:u,forceUpdate:!0})}),p=$('<div class="elfinder-quicklook-encoding"/>').append(o),e.window.append(p)),l.remove()}))})}],e}),e("skylark-elfinder/commands/reload",["../elFinder"],function(e){return(e.prototype.commands.reload=function(){"use strict";var e=this,t=!1;this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+shift+r f5"}],this.getstate=function(){return 0},this.init=function(){this.fm.bind("search searchend",function(){t="search"==this.type})},this.fm.bind("contextmenu",function(){var t=e.fm;t.options.sync>=1e3&&(e.extra={icon:"accept",node:$("<span/>").attr({title:t.i18n("autoSync")}).on("click touchstart",function(e){"touchstart"===e.type&&e.originalEvent.touches.length>1||(e.stopPropagation(),e.preventDefault(),$(this).parent().toggleClass("ui-state-disabled",t.options.syncStart).parent().removeClass("ui-state-hover"),t.options.syncStart=!t.options.syncStart,t.autoSync(t.options.syncStart?null:"stop"))}).on("ready",function(){$(this).parent().toggleClass("ui-state-disabled",!t.options.syncStart).css("pointer-events","auto")})})}),this.exec=function(){var e=this.fm;if(!t){var n=e.sync(),i=setTimeout(function(){e.notify({type:"reload",cnt:1,hideCnt:!0}),n.always(function(){e.notify({type:"reload",cnt:-1})})},e.notifyDelay);return n.always(function(){clearTimeout(i),e.trigger("reload")})}$("div.elfinder-toolbar > div."+e.res("class","searchbtn")+" > span.ui-icon-search").click()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/rename",["../elFinder"],function(e){return e.prototype.commands.rename=function(){"use strict";this.alwaysEnabled=!0,this.syncTitleOnChange=!0;var e=this,t=e.fm,n=function(e,n,i,a){var o,r=n?[i.hash].concat(n):[i.hash],s=r.length,l={};if(t.lockfiles({files:r}),t.isRoot(i)&&!i.netkey){if((o=t.storage("rootNames"))||(o={}),""===a){if(!o[i.hash])return e&&e.reject(),void t.unlockfiles({files:r}).trigger("selectfiles",{files:r});i.name=i._name,i.i18=i._i18,delete o[i.hash],delete i._name,delete i._i18}else void 0===i._name&&(i._name=i.name,i._i18=i.i18),i.name=o[i.hash]=a,delete i.i18;return t.storage("rootNames",o),l={changed:[i]},t.updateCache(l),t.change(l),e&&e.resolve(l),void t.unlockfiles({files:r}).trigger("selectfiles",{files:r})}l={cmd:"rename",name:a,target:i.hash},s>1&&(l.targets=n,a.match(/\*/)&&(l.q=a)),t.request({data:l,notify:{type:"rename",cnt:s},navigate:{}}).fail(function(n){var i=t.parseError(n);e&&e.reject(),i&&Array.isArray(i)&&"errRename"===i[0]||t.sync()}).done(function(n){var o;n.added&&n.added.length&&1===s&&(n.undo={cmd:"rename",callback:function(){return t.request({data:{cmd:"rename",target:n.added[0].hash,name:i.name},notify:{type:"undo",cnt:1}})}},n.redo={cmd:"rename",callback:function(){return t.request({data:{cmd:"rename",target:i.hash,name:a},notify:{type:"rename",cnt:1}})}}),e&&e.resolve(n),(o=t.cwd().hash)&&o!==i.hash||t.exec("open",$.map(n.added,function(e){return"directory"===e.mime?e.hash:null})[0])}).always(function(){t.unlockfiles({files:r}).trigger("selectfiles",{files:r})})},i=function(e,n){var i,a,o,r=n||t.selected(),s=t.splitFileExtention(e),l=t.file(r[0]),c=t.file(r[1]);return i=s[1]?"."+s[1]:"",s[1]&&"*"===s[0]?(a='"'+t.splitFileExtention(l.name)[0]+i+'", ',a+='"'+t.splitFileExtention(c.name)[0]+i+'"'):s[0].length>1&&("*"===s[0].substr(-1)?(o=s[0].substr(0,s[0].length-1),a='"'+o+l.name+'", ',a+='"'+o+c.name+'"'):"*"===s[0].substr(0,1)&&(o=s[0].substr(1),a='"'+t.splitFileExtention(l.name)[0]+o+i+'", ',a+='"'+t.splitFileExtention(c.name)[0]+o+i+'"')),a||(a='"'+s[0]+"1"+i+'", "'+s[0]+"2"+i+'"'),r.length>2&&(a+=" ..."),a},a=function(){var a,o=t.selected(),r='<input name="type" type="radio" class="elfinder-tabstop">',s=function(e,n){return $('<label class="elfinder-rename-batch-checks">'+t.i18n(n)+"</label>").prepend(e)},l=$('<input type="text" class="ui-corner-all elfinder-tabstop">'),c=$(r),d=$(r),p=$(r),u=$(r),h=$("<div/>").append(s(c,"plusNumber"),s(d,"asPrefix"),s(p,"asSuffix"),s(u,"changeExtention")),f=$('<div class="elfinder-rename-batch-preview"/>'),m=$('<div class="elfinder-rename-batch"/>').append($('<div class="elfinder-rename-batch-name"/>').append(l),$('<div class="elfinder-rename-batch-type"/>').append(h),f),g={title:t.i18n("batchRename"),modal:!0,destroyOnClose:!0,width:Math.min(380,t.getUI().width()-20),buttons:{},open:function(){l.on("input",b).trigger("focus")}},v=function(){var e=l.val(),n=t.splitFileExtention(t.file(o[0]).name)[1];return(""!==e||c.is(":checked"))&&(d.is(":checked")?e+="*":p.is(":checked")?e="*"+e+"."+n:u.is(":checked")?e="*."+e:n&&(e+="."+n)),e},b=function(){var e=v();""!==e?f.html(t.i18n(["renameMultiple",o.length,i(e)])):f.empty()},y=h.find("input:radio").on("change",b);g.buttons[t.i18n("btnApply")]=function(){var e,i,r=v();""!==r&&(a.elfinderdialog("close"),i=o,e=t.file(i.shift()),n(void 0,i,e,r))},g.buttons[t.i18n("btnCancel")]=function(){a.elfinderdialog("close")},$.fn.checkboxradio?y.checkboxradio({create:function(e,t){this===c.get(0)&&c.prop("checked",!0).change()}}):h.buttonset({create:function(e,t){c.prop("checked",!0).change()}}),a=e.fmDialog(m,g)};this.noChangeDirOnRemovedCwd=!0,this.shortcuts=[{pattern:"f2"+("mac"==t.OS?" enter":"")},{pattern:"shift+f2",description:"batchRename",callback:function(){t.selected().length>1&&a()}}],this.getstate=function(n){var i,o,r,s,l,c,d=this.files(n),p=d.length;return p?(p>1&&d[0].phash&&(i=d[0].phash,o=t.splitFileExtention(d[0].name)[1].toLowerCase(),r=d[0].mime),1===p&&(c=t.isRoot(d[0])),l=1===p&&(t.cookieEnabled&&c||!d[0].locked)||t.api>2.103&&p===$.grep(d,function(e){return!(s||e.locked||e.phash!==i||t.isRoot(e)||r!==e.mime&&o!==t.splitFileExtention(e.name)[1].toLowerCase())||(s&&(s=!0),!1)}).length?0:-1,!c&&0===l&&t.option("disabledFlip",d[0].hash).rename&&(l=-1),-1!==l&&p>1?e.extra={icon:"preference",node:$("<span/>").attr({title:t.i18n("batchRename")}).on("click touchstart",function(e){"touchstart"===e.type&&e.originalEvent.touches.length>1||(e.stopPropagation(),e.preventDefault(),t.getUI().trigger("click"),a())})}:delete e.extra,l):-1},this.exec=function(e,a){t.getUI("cwd");var o,r=e||!!t.selected().length&&t.selected()||[t.cwd().hash],s=r.length,l=t.file(r.shift()),c=a||{},d=t.cwd().hash==l.hash,p="navbar"===c._currentType||"files"===c._currentType?c._currentType:d?"navbar":"files",u="files"!==p,h=t[u?"navHash2Elm":"cwdHash2Elm"](l.hash),f=!u&&"list"!=t.storage("view"),m=function(){requestAnimationFrame(function(){y&&y.trigger("blur")})},g=function(){C.is(":hidden")||C.elfinderoverlay("hide").off("click close",T),k.removeClass("ui-front").css("position","").off("unselect."+t.namespace,m),f?x&&x.css("max-height",""):u||k.css("width","").parent("td").css("overflow","")},v=$.Deferred().fail(function(e){var n=y.parent(),i=t.escape(l.i18||l.name);y.off(),f&&(i=i.replace(/([_.])/g,"&#8203;$1")),requestAnimationFrame(function(){u?y.replaceWith(i):n.length?(y.remove(),n.html(i)):h.find(".elfinder-cwd-filename").html(i)}),e&&t.error(e)}).always(function(){g(),t.unbind("resize",z),t.enable()}),b=function(e){var a=$.trim(y.val()),o=(t.splitFileExtention(a),!0),c=function(){y.off(),g(),u?y.replaceWith(t.escape(a)):x.html(t.escape(a)),n(v,r,l,a)};if(C.is(":hidden")||k.css("z-index",""),""===a){if(!t.isRoot(l))return T();u?y.replaceWith(t.escape(l.name)):x.html(t.escape(l.name))}if(!j&&k.length){if(y.off("blur"),1===s&&a===l.name)return v.reject();if(t.options.validName&&t.options.validName.test)try{o=t.options.validName.test(a)}catch(e){o=!1}if("."===a||".."===a||!o)return j=!0,t.error("directory"===l.mime?"errInvDirname":"errInvName",{modal:!0,close:function(){setTimeout(w,120)}}),!1;if(1===s&&t.fileByName(a,l.phash))return j=!0,t.error(["errExists",a],{modal:!0,close:function(){setTimeout(w,120)}}),!1;1===s?c():(t.confirm({title:"cmdrename",text:["renameMultiple",s,i(a,[l.hash].concat(r))],accept:{label:"btnYes",callback:c},cancel:{label:"btnCancel",callback:function(){setTimeout(function(){j=!0,w()},120)}}}),setTimeout(function(){t.trigger("unselectfiles",{files:t.selected()}).trigger("selectfiles",{files:[l.hash].concat(r)})},120))}},y=$(f?"<textarea/>":'<input type="text"/>').on("keyup text",function(){f?(this.style.height="1px",this.style.height=this.scrollHeight+"px"):o&&(this.style.width=o+"px",this.scrollWidth>o&&(this.style.width=this.scrollWidth+10+"px"))}).on("keydown",function(e){e.stopImmediatePropagation(),e.keyCode==$.ui.keyCode.ESCAPE?v.reject():e.keyCode==$.ui.keyCode.ENTER&&(e.preventDefault(),y.trigger("blur"))}).on("mousedown click dblclick",function(e){e.stopPropagation(),"dblclick"===e.type&&e.preventDefault()}).on("blur",b).on("dragenter dragleave dragover drop",function(e){e.stopPropagation()}),w=function(){var e=t.splitFileExtention(y.val())[0];j||!t.UA.Mobile||t.UA.iOS||(C.on("click close",T).elfinderoverlay("show"),k.css("z-index",C.css("z-index")+1)),!t.enabled()&&t.enable(),j&&(j=!1,y.on("blur",b)),y.trigger("focus").trigger("select"),y[0].setSelectionRange&&y[0].setSelectionRange(0,e.length)},x=u?h.contents().filter(function(){return 3==this.nodeType&&$(this).parent().attr("id")===t.navHash2Id(l.hash)}):h.find(".elfinder-cwd-filename"),k=x.parent(),C=t.getUI("overlay"),T=function(e){C.is(":hidden")||k.css("z-index",""),j||(v.reject(),e&&(e.stopPropagation(),e.preventDefault()))},z=function(){h.trigger("scrolltoview",{blink:!1})},j=!1;return k.addClass("ui-front").css("position","relative").on("unselect."+t.namespace,m),t.bind("resize",z),u?x.replaceWith(y.val(l.name)):(f?x.css("max-height","none"):u||(o=k.width(),k.width(o-15).parent("td").css("overflow","visible")),x.empty().append(y.val(l.name))),s>1&&t.api<=2.103?v.reject():l&&x.length?l.locked&&!t.isRoot(l)?v.reject(["errLocked",l.name]):(t.one("select",function(){y.parent().length&&l&&-1===$.inArray(l.hash,t.selected())&&y.trigger("blur")}),y.trigger("keyup"),w(),v):v.reject("errCmdParams",this.title)},t.bind("select contextmenucreate closecontextmenu",function(n){var i,a=(n.data?n.data.selected||n.data.targets:null)||t.selected();a&&1===a.length&&(i=t.file(a[0]))&&t.isRoot(i)?e.title=t.i18n("kindAlias")+" ("+t.i18n("preference")+")":e.title=t.i18n("cmdrename"),"closecontextmenu"!==n.type?e.update(void 0,e.title):requestAnimationFrame(function(){e.update(void 0,e.title)})}).remove(function(e){var n;e.data&&e.data.removed&&(n=t.storage("rootNames"))&&($.each(e.data.removed,function(e,t){n[t]&&delete n[t]}),t.storage("rootNames",n))})},e}),e("skylark-elfinder/commands/resize",["../elFinder"],function(e){return e.prototype.commands.resize=function(){"use strict";var e=this.fm,t=0;this.updateOnSelect=!1,this.getstate=function(){var t=e.selectedFiles();return 1==t.length&&t[0].read&&t[0].write&&-1!==t[0].mime.indexOf("image/")?0:-1},this.resizeRequest=function(t,n,i){var a,o=n||e.file(t.target),r=(o&&o.tmb,e.isCommandEnabled("resize",t.target));return r&&(!o||o&&o.read&&o.write&&-1!==o.mime.indexOf("image/"))?e.request({data:Object.assign(t,{cmd:"resize"}),notify:{type:"resize",cnt:1}}).fail(function(e){i&&i.reject(e)}).done(function(){t.quality&&e.storage("jpgQuality",t.quality===e.option("jpgQuality")?null:t.quality),i&&i.resolve()}):(a=o?-1===o.mime.indexOf("image/")?["errResize",o.name,"errUsupportType"]:["errResize",o.name,"errPerm"]:["errResize",t.target,"errPerm"],i?i.reject(a):e.error(a),$.Deferred().reject(a))},this.exec=function(n){var i,a,o=this,r=this.files(n),s=$.Deferred(),l=e.api>1,c=this.options,d=e.getUI(),p=$().controlgroup?"controlgroup":"buttonset",u=void 0===c.grid8px||"disable"!==c.grid8px,h=Array.isArray(c.presetSize)?c.presetSize:[],f=e.res("class","editing"),m=function(n,i,a){var r,m,g,v,b,y,w,x="image/jpeg"===n.mime,k=$('<div class="elfinder-resize-container"/>'),C='<input type="number" class="ui-corner-all"/>',T='<div class="elfinder-resize-row"/>',z='<div class="elfinder-resize-label"/>',j=null,A=!1,O=function(){A=!0},I=function(){A&&(A=!1,M.trigger("change"))},M=$('<div class="elfinder-resize-control"/>').on("focus","input[type=text],input[type=number]",function(){$(this).trigger("select")}).on("change",function(){j&&cancelAnimationFrame(j),j=requestAnimationFrame(function(){var t,n,i,a,o,r,s,l,c,d,p,u;Ze&&!A&&(i=Ze.data("canvas"))&&(t=M.children("div.elfinder-resize-control-panel:visible"),(n=t.find("input.elfinder-resize-quality")).is(":visible")&&(a=Ze.data("ctx"),o=Ze.get(0),t.hasClass("elfinder-resize-uiresize")?(l=i.width=W.val(),c=i.height=V.val(),a.drawImage(o,0,0,l,c)):t.hasClass("elfinder-resize-uicrop")?(r=K.val(),s=X.val(),l=G.val(),c=J.val(),i.width=l,i.height=c,a.drawImage(o,r,s,l,c,0,0,l,c)):(d=Q.val(),p=Q.val()*Math.PI/180,u=function(e,t,n){var i=[{x:e/2,y:t/2},{x:-e/2,y:t/2},{x:-e/2,y:-t/2},{x:e/2,y:-t/2}],a=[],o={x:Number.MAX_VALUE,y:Number.MAX_VALUE},r={x:Number.MIN_VALUE,y:Number.MIN_VALUE};return $.each(i,function(e,t){a.push({x:t.x*Math.cos(n)-t.y*Math.sin(n),y:t.x*Math.sin(n)+t.y*Math.cos(n)})}),$.each(a,function(e,t){o.x=Math.min(o.x,t.x),o.y=Math.min(o.y,t.y),r.x=Math.max(r.x,t.x),r.y=Math.max(r.y,t.y)}),{width:r.x-o.x,height:r.y-o.y}}(pe,ue,p),l=i.width=u.width,c=i.height=u.height,a.save(),d%90!=0&&(a.fillStyle=se.val()||"#FFF",a.fillRect(0,0,l,c)),a.translate(l/2,c/2),a.rotate(p),a.drawImage(o,-o.width/2,-o.height/2,pe,ue),a.restore()),i.toBlob(function(t){t&&n.next("span").text(" ("+e.formatSize(t.size)+")")},"image/jpeg",Math.max(Math.min(n.val(),100),1)/100)))})}).on("mouseup","input",function(e){$(e.target).trigger("change")}),S=$('<div class="elfinder-resize-preview"/>').on("touchmove",function(e){$(e.target).hasClass("touch-punch")&&(e.stopPropagation(),e.preventDefault())}),F=$('<div class="elfinder-resize-loading">'+e.i18n("ntfloadimg")+"</div>"),E=$('<div class="elfinder-resize-handle touch-punch"/>'),D=$('<div class="elfinder-resize-handle touch-punch"/>'),U=$('<div class="elfinder-resize-uiresize elfinder-resize-control-panel"/>'),P=$('<div class="elfinder-resize-uicrop elfinder-resize-control-panel"/>'),q=$('<div class="elfinder-resize-rotate elfinder-resize-control-panel"/>'),R=$("<button/>").attr("title",e.i18n("rotate-cw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>')),H=$("<button/>").attr("title",e.i18n("rotate-ccw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>')),_=$("<span />"),N=$('<button class="elfinder-resize-reset">').text(e.i18n("reset")).on("click",function(){qe()}).button({icons:{primary:"ui-icon-arrowrefresh-1-n"},text:!1}),L=$('<div class="elfinder-resize-type"/>').append('<input type="radio" name="type" id="'+i+'-resize" value="resize" checked="checked" /><label for="'+i+'-resize">'+e.i18n("resize")+"</label>",'<input class="api2" type="radio" name="type" id="'+i+'-crop" value="crop" /><label class="api2" for="'+i+'-crop">'+e.i18n("crop")+"</label>",'<input class="api2" type="radio" name="type" id="'+i+'-rotate" value="rotate" /><label class="api2" for="'+i+'-rotate">'+e.i18n("rotate")+"</label>"),B="resize",W=(L[p]()[p]("disable").find("input").on("change",function(){B=$(this).val(),qe(),Ne(!0),Le(!0),Be(!0),"resize"==B?(U.show(),q.hide(),P.hide(),Ne(),x&&$e.insertAfter(U.find(".elfinder-resize-grid8"))):"crop"==B?(q.hide(),U.hide(),P.show(),Le(),x&&$e.insertAfter(P.find(".elfinder-resize-grid8"))):"rotate"==B&&(U.hide(),P.hide(),q.show(),Be())}),$(C).on("change",function(){var e=Pe(parseInt(W.val())),t=Pe(he?e/ce:parseInt(V.val()));e>0&&t>0&&(Re.updateView(e,t),W.val(e),V.val(t))}).addClass("elfinder-focus")),V=$(C).on("change",function(){var e=Pe(parseInt(V.val())),t=Pe(he?e*ce:parseInt(W.val()));t>0&&e>0&&(Re.updateView(t,e),W.val(t),V.val(e))}),K=$(C).on("change",function(){He.updateView()}),X=$(C).on("change",function(){He.updateView()}),G=$(C).on("change",function(){He.updateView("w")}),J=$(C).on("change",function(){He.updateView("h")}),Y=x&&l?$(C).val(e.storage("jpgQuality")>0?e.storage("jpgQuality"):e.option("jpgQuality")).addClass("elfinder-resize-quality").attr("min","1").attr("max","100").attr("title","1 - 100").on("blur",function(){var e=Math.min(100,Math.max(1,parseInt(this.value)));M.find("input.elfinder-resize-quality").val(e)}):null,Q=$('<input type="number" class="ui-corner-all" maxlength="3" value="0" />').on("change",function(){_e.update()}),Z=$('<div class="elfinder-resize-rotate-slider touch-punch"/>').slider({min:0,max:360,value:Q.val(),animate:!0,start:O,stop:I,change:function(e,t){t.value!=Z.slider("value")&&_e.update(t.value)},slide:function(e,t){_e.update(t.value,!1)}}).find(".ui-slider-handle").addClass("elfinder-tabstop").off("keydown").on("keydown",function(e){e.keyCode!=$.ui.keyCode.LEFT&&e.keyCode!=$.ui.keyCode.RIGHT||(e.stopPropagation(),e.preventDefault(),_e.update(Number(Q.val())+(e.keyCode==$.ui.keyCode.RIGHT?1:-1),!1))}).end(),ee={},te=function(e){var t,n,i,a;try{t=ee[Math.round(e.offsetX)][Math.round(e.offsetY)]}catch(e){}t&&(n=t[0],i=t[1],a=t[2],t[3],t[4],t[5],ie(n,i,a,"click"===e.type))},ne=function(e){ie($(this).css("backgroundColor"),"","","click"===e.type)},ie=function(e,t,n,i){var a,o,r;"string"==typeof e&&(t="",e&&(a=$("<span>").css("backgroundColor",e).css("backgroundColor"))&&(o=a.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i))&&(e=Number(o[1]),t=Number(o[2]),n=Number(o[3]))),r=""===t?e:"#"+ae(e,t,n),se.val(r).css({backgroundColor:r,backgroundImage:"none",color:e+t+n<384?"#fff":"#000"}),S.css("backgroundColor",r),i&&(Ue.off(".picker").removeClass("elfinder-resize-picking"),le.off(".picker").removeClass("elfinder-resize-picking"))},ae=function(e,t,n){return $.map([e,t,n],function(e){return("0"+parseInt(e).toString(16)).slice(-2)}).join("")},oe=$("<button>").text(e.i18n("colorPicker")).on("click",function(){Ue.on("mousemove.picker click.picker",te).addClass("elfinder-resize-picking"),le.on("mousemove.picker click.picker","span",ne).addClass("elfinder-resize-picking")}).button({icons:{primary:"ui-icon-pin-s"},text:!1}),re=$("<button>").text(e.i18n("reset")).on("click",function(){ie("","","",!0)}).button({icons:{primary:"ui-icon-arrowrefresh-1-n"},text:!1}),se=$('<input class="ui-corner-all elfinder-resize-bg" type="text">').on("focus",function(){$(this).attr("style","")}).on("blur",function(){ie($(this).val())}),le=$('<div class="elfinder-resize-pallet">').on("click","span",function(){ie($(this).css("backgroundColor"))}),ce=1,de=1,pe=0,ue=0,he=!0,fe=!1,me=0,ge=0,ve=0,be=0,ye=0,we=!!x&&u,xe=$("<button>").html(e.i18n("aspectRatio")).on("click",function(){he=!he,xe.button("option",{icons:{primary:he?"ui-icon-locked":"ui-icon-unlocked"}}),Re.fixHeight(),E.resizable("option","aspectRatio",he).data("uiResizable")._aspectRatio=he}).button({icons:{primary:he?"ui-icon-locked":"ui-icon-unlocked"},text:!1}),ke=$("<button>").html(e.i18n("aspectRatio")).on("click",function(){fe=!fe,ke.button("option",{icons:{primary:fe?"ui-icon-locked":"ui-icon-unlocked"}}),D.resizable("option","aspectRatio",fe).data("uiResizable")._aspectRatio=fe}).button({icons:{primary:fe?"ui-icon-locked":"ui-icon-unlocked"},text:!1}),$e=$("<button>").html(e.i18n(we?"enabled":"disabled")).toggleClass("ui-state-active",we).on("click",function(){we=!we,$e.html(e.i18n(we?"enabled":"disabled")).toggleClass("ui-state-active",we),Ce()}).button(),Ce=function(){var e=we?8:1;$.each([W,V,G,J,K,X],function(){this.attr("step",e)}),we&&(W.val(Pe(W.val())),V.val(Pe(V.val())),G.val(Pe(G.val())),J.val(Pe(J.val())),K.val(Pe(K.val())),X.val(Pe(X.val())),U.is(":visible")?Re.updateView(W.val(),V.val()):P.is(":visible")&&He.updateView())},Te=function(){var t,i=function(){se.parent().hide(),le.hide()};t=Math.min(me,ge)/Math.sqrt(Math.pow(pe,2)+Math.pow(ue,2)),ve=Math.ceil(pe*t),be=Math.ceil(ue*t),Ue.width(ve).height(be).css("margin-top",(ge-be)/2+"px").css("margin-left",(me-ve)/2+"px"),Ue.is(":visible")&&se.is(":visible")&&("image/png"!==n.mime?(S.css("backgroundColor",se.val()),r=$("<img>"),e.isCORS&&r.attr("crossorigin","use-credentials"),r.on("load",function(){m&&m.width!==ve&&je()}).on("error",i).attr("src",Qe)):i())},ze=function(){Re.updateView(pe,ue),Te(),Fe.width(Se.width()).height(Se.height()),Ee.width(Se.width()).height(Se.height()),He.updateView(),et()},je=function(){if(g){var e,t,n,i,a,o,s,l,c,d,p,u,h,f,v,b,y,w,x={},k=[],C=function(e,t,n){var i,a=Math.max(Math.max(e,t),n),o=Math.min(Math.min(e,t),n);return a===o?i=0:e===a?i=((t-n)/(a-o)*60+360)%360:t===a?i=(n-e)/(a-o)*60+120:n===a&&(i=(e-t)/(a-o)*60+240),[i,(a-o)/a,(.3*e+.59*t+.11*n)/255,"hsl"]},T=function(e){return 8*Math.round(e/8)};e:try{t=m.width=Ue.width(),n=m.height=Ue.height(),u=t/pe,g.scale(u,u),g.drawImage(r.get(0),0,0),p=g.getImageData(0,0,t,n).data,h=.1*t,f=.9*t,v=.1*n,b=.9*n;for(var z=0;z<n-1;z++)for(var j=0;j<t-1;j++){if(i=p[e=4*j+z*t*4],a=p[e+1],o=p[e+2],255!==p[e+3]){se.parent().hide(),le.hide();break e}c=C(i,a,o),d=Math.round(c[0]),s=Math.round(100*c[1]),l=Math.round(100*c[2]),ee[j]||(ee[j]={}),ee[j][z]=[i,a,o,d,s,l],(j<h||j>f)&&(z<v||z>b)&&(y=T(i)+","+T(a)+","+T(o),x[y]?++x[y]:x[y]=1)}le.children(":first").length||(w=1,$.each(x,function(e,t){k.push({c:e,v:t})}),$.each(k.sort(function(e,t){return e.v>t.v?-1:1}),function(){if(this.v<2||w>10)return!1;le.append($('<span style="width:20px;height:20px;display:inline-block;background-color:rgb('+this.c+');">')),++w}))}catch(e){oe.hide(),le.hide()}}},Ae=null,Oe=!1,Ie=function(t){var i=e.file(n.hash);i.width=t[0],i.height=t[1]},Me=function(){var i,a,o;Oe||(Oe=!0,Ae&&Ae.state&&"pending"===Ae.state()&&Ae.reject(),e.api>=2.103?0===t&&e.request({data:{cmd:"resize",target:n.hash,degree:0,mode:"rotate"},preventDefault:!0}).done(function(e){1===(t=e.losslessRotate?1:-1)&&Q.val()%90==0&&q.children("div.elfinder-resize-quality").hide()}).fail(function(){t=-1}):t=-1,i=Se.get(0),(a=n.width&&n.height?{w:n.width,h:n.height}:i.naturalWidth?null:{w:Se.width(),h:Se.height()})&&Se.removeAttr("width").removeAttr("height"),pe=n.width||i.naturalWidth||i.width||Se.width(),ue=n.height||i.naturalHeight||i.height||Se.height(),n.width&&n.height||Ie([pe,ue]),a&&Se.width(a.w).height(a.h),v.show(),(o=ue/pe)<1&&S.height()>S.width()*o&&S.height(S.width()*o),S.height()>Se.height()+20&&S.height(Se.height()+20),ge=S.height()-(E.outerHeight()-E.height()),F.remove(),ce=pe/ue,E.append(Se.show()).show(),W.val(pe),V.val(ue),function(){try{m=document.createElement("canvas"),g=m.getContext("2d")}catch(e){oe.hide(),le.hide()}}(),nt.on("click","span.elfinder-resize-preset",function(){var e=$(this),t=e.data("s")[0],n=e.data("s")[1],i=pe/ue;e.data("s",[n,t]).text(n+"x"+t),pe>t||ue>n?pe<=t?t=Pe(n*i):ue<=n?n=Pe(t/i):pe-t>ue-n?n=Pe(t/i):t=Pe(n*i):(t=pe,n=ue),W.val(t),V.val(n),Re.updateView(t,n),et()}),it.on("click","span.elfinder-resize-preset",function(){var e=$(this),t=e.data("s")[0],n=e.data("s")[1],i=K.val(),a=X.val();e.data("s",[n,t]).text(n+"x"+t),pe>=t&&ue>=n&&(pe-t-i<0&&(i=pe-t),ue-n-a<0&&(a=ue-n),K.val(i),X.val(a),G.val(t),J.val(n),He.updateView(),et())}),it.children("span.elfinder-resize-preset").each(function(){var e=$(this),t=e.data("s")[0],n=e.data("s")[1];e[pe>=t&&ue>=n?"show":"hide"]()}),ze(),L[p]("enable"),M.find("input,select").prop("disabled",!1).filter(":text").on("keydown",function(t){var n;if(t.keyCode==$.ui.keyCode.ENTER)return t.stopPropagation(),t.preventDefault(),n={title:$("input:checked",L).val(),text:"confirmReq",accept:{label:"btnApply",callback:function(){Ve()}},cancel:{label:"btnCancel",callback:function(){$(this).trigger("focus")}}},at&&(n.buttons=[{label:"btnSaveAs",callback:function(){requestAnimationFrame(Ke)}}]),void e.confirm(n)}).on("keyup",function(){var e=$(this);e.hasClass("elfinder-resize-bg")||requestAnimationFrame(function(){e.val(e.val().replace(/[^0-9]/g,""))})}).filter(":first"),Ce(),!e.UA.Mobile&&W.trigger("focus"),Ne())},Se=$("<img/>").on("load",Me).on("error",function(){F.html(e.i18n("ntfsmth")).css("background","transparent")}),Fe=$("<div/>"),Ee=$("<img/>"),De=$("<div/>"),Ue=$('<img class="elfinder-resize-imgrotate" />'),Pe=function(e,t){return e=we?8*Math.round(e/8):Math.round(e),e=Math.max(0,e),t&&e>t&&(e=we?8*Math.floor(t/8):t),e},qe=function(){W.val(pe),V.val(ue),Re.updateView(pe,ue),K.val(0),X.val(0),G.val(pe),J.val(ue),He.updateView(),et()},Re={update:function(){W.val(Pe(Se.width()/de)),V.val(Pe(Se.height()/de)),et()},updateView:function(e,t){e>me||t>ge?e/me>t/ge?(de=me/e,Se.width(me).height(Pe(t*de))):(de=ge/t,Se.height(ge).width(Pe(e*de))):Se.width(Pe(e)).height(Pe(t)),de=Se.width()/e,_.text("1 : "+(1/de).toFixed(2)),Re.updateHandle()},updateHandle:function(){E.width(Se.width()).height(Se.height())},fixHeight:function(){var e,t;he&&(e=W.val(),t=Pe(e/ce),Re.updateView(e,t),V.val(t))}},He={update:function(e){K.val(Pe((D.data("x")||D.position().left)/de,pe)),X.val(Pe((D.data("y")||D.position().top)/de,ue)),"xy"!==e&&(G.val(Pe((D.data("w")||D.width())/de,pe-K.val())),J.val(Pe((D.data("h")||D.height())/de,ue-X.val()))),et()},updateView:function(e){var t,n,i,a,o;K.val(Pe(K.val(),pe-(we?8:1))),X.val(Pe(X.val(),ue-(we?8:1))),G.val(Pe(G.val(),pe-K.val())),J.val(Pe(J.val(),ue-X.val())),fe&&(t=De.width()/De.height(),"w"===e?J.val(Pe(parseInt(G.val())/t)):"h"===e&&G.val(Pe(parseInt(J.val())*t))),n=Math.round(parseInt(K.val())*de),i=Math.round(parseInt(X.val())*de),"xy"!==e?(a=Math.round(parseInt(G.val())*de),o=Math.round(parseInt(J.val())*de)):(a=D.data("w"),o=D.data("h")),D.data({x:n,y:i,w:a,h:o}).width(a).height(o).css({left:n,top:i}),De.width(a).height(o)},resize_update:function(e,t){D.data({x:t.position.left,y:t.position.top,w:t.size.width,h:t.size.height}),He.update(),He.updateView()},drag_update:function(e,t){D.data({x:t.position.left,y:t.position.top}),He.update("xy")}},_e={mouseStartAngle:0,imageStartAngle:0,imageBeingRotated:!1,setQuality:function(){q.children("div.elfinder-resize-quality")[t>0&&Q.val()%90==0?"hide":"show"]()},update:function(t,n){void 0===t&&(ye=t=parseInt(Q.val())),void 0===n&&(n=!0),!n||e.UA.Opera||e.UA.ltIE8?Ue.rotate(t):Ue.animate({rotate:t+"deg"}),(t%=360)<0&&(t+=360),Q.val(parseInt(t)),Z.slider("value",Q.val()),_e.setQuality()},execute:function(e){if(_e.imageBeingRotated){var t=_e.getCenter(Ue),n=e.originalEvent.touches?e.originalEvent.touches[0]:e,i=n.pageX-t[0],a=n.pageY-t[1],o=Math.atan2(a,i),r=o-_e.mouseStartAngle+_e.imageStartAngle;return r=Math.round(180*parseFloat(r)/Math.PI),e.shiftKey&&(r=15*Math.round((r+6)/15)),Ue.rotate(r),(r%=360)<0&&(r+=360),Q.val(r),Z.slider("value",Q.val()),_e.setQuality(),!1}},start:function(e){if(!Ue.hasClass("elfinder-resize-picking")){O(),_e.imageBeingRotated=!0;var t=_e.getCenter(Ue),n=e.originalEvent.touches?e.originalEvent.touches[0]:e,i=n.pageX-t[0],a=n.pageY-t[1];return _e.mouseStartAngle=Math.atan2(a,i),_e.imageStartAngle=parseFloat(Ue.rotate())*Math.PI/180,$(document).on("mousemove",_e.execute),Ue.on("touchmove",_e.execute),!1}},stop:function(e){if(_e.imageBeingRotated)return $(document).off("mousemove",_e.execute),Ue.off("touchmove",_e.execute),requestAnimationFrame(function(){_e.imageBeingRotated=!1}),I(),!1},getCenter:function(e){var t=Ue.rotate();Ue.rotate(0);var n=Ue.offset(),i=n.left+Ue.width()/2,a=n.top+Ue.height()/2;return Ue.rotate(t),Array(i,a)}},Ne=function(e){e?(E.filter(":ui-resizable").resizable("destroy"),E.hide()):(E.show(),E.resizable({alsoResize:Se,aspectRatio:he,resize:Re.update,start:O,stop:function(e){Re.fixHeight,Re.updateView(W.val(),V.val()),I()}}),tt())},Le=function(e){e?(D.filter(":ui-resizable").resizable("destroy").filter(":ui-draggable").draggable("destroy"),Fe.hide()):(Fe.show(),D.resizable({containment:Fe,aspectRatio:fe,resize:He.resize_update,start:O,stop:I,handles:"all"}).draggable({handle:De,containment:Ee,drag:He.drag_update,start:O,stop:function(){He.updateView("xy"),I()}}),tt(),He.update())},Be=function(e){e?Ue.hide():(Ue.show(),tt())},We=function(){var t,n,i,a,o,r,s="";if("resize"==B)t=parseInt(W.val())||0,n=parseInt(V.val())||0;else if("crop"==B)t=parseInt(G.val())||0,n=parseInt(J.val())||0,i=parseInt(K.val())||0,a=parseInt(X.val())||0;else if("rotate"==B){if(t=pe,n=ue,(o=parseInt(Q.val())||0)<0||o>360)return e.error("Invalid rotate degree"),!1;if(0==o||360==o)return e.error("errResizeNoChange"),!1;s=se.val()}if(r=Y?parseInt(Y.val()):0,"rotate"!=B){if(t<=0||n<=0)return e.error("Invalid image size"),!1;if(t==pe&&n==ue)return e.error("errResizeNoChange"),!1}return{w:t,h:n,x:i,y:a,d:o,q:r,b:s}},Ve=function(){var e;(e=We())&&(k.elfinderdialog("close"),o.resizeRequest({target:n.hash,width:e.w,height:e.h,x:e.x,y:e.y,degree:e.d,quality:e.q,bg:e.b,mode:B},n,s))},Ke=function(){var t,i=function(){t.addClass(f).fadeIn(function(){b.addClass("elfinder-dialog-active")}),e.disable()},a=function(){o.mime=n.mime,o.prefix=n.name.replace(/ \d+(\.[^.]+)?$/,"$1"),o.requestCmd="mkfile",o.nextAction={},o.data={target:n.phash},$.proxy(e.res("mixin","make"),o)().done(function(a){var o,r;a.added&&a.added.length?(o=a.added[0].hash,r=e.api<2.1032?e.url(n.hash,{async:!0,temporary:!0}):null,$.when(r).done(function(a){e.request({options:{type:"post"},data:{cmd:"put",target:o,encoding:r?"scheme":"hash",content:r?e.convAbsUrl(a):n.hash},notify:{type:"copy",cnt:1},syncOnFail:!0}).fail(i).done(function(i){i=e.normalize(i),e.updateCache(i),n=e.file(o),i.changed&&i.changed.length&&e.change(i),b.show().find(".elfinder-dialog-title").html(e.escape(n.name)),Ve(),t.fadeIn()})}).fail(i)):i()}).fail(i).always(function(){delete o.mime,delete o.prefix,delete o.nextAction,delete o.data}),e.trigger("unselectfiles",{files:[n.hash]})},r=null;We()&&(t=d.children("."+o.dialogClass+":visible").removeClass(f).fadeOut(),b.removeClass("elfinder-dialog-active"),e.enable(),e.searchStatus.state<2&&n.phash!==e.cwd().hash&&(r=e.exec("open",[n.phash],{thash:n.phash})),$.when([r]).done(function(){r?e.one("cwdrender",a):a()}).fail(i))},Xe={},Ge="elfinder-resize-handle-hline",Je="elfinder-resize-handle-vline",Ye="elfinder-resize-handle-point",Qe=a,Ze=Y?$("<img>").attr("crossorigin",e.isCORS?"use-credentials":"").attr("src",Qe).on("load",function(){try{var e=document.createElement("canvas");Ze.data("canvas",e).data("ctx",e.getContext("2d")),et()}catch(e){Ze.removeData("canvas").removeData("ctx")}}):null,et=function(){M.find("input.elfinder-resize-quality:visible").trigger("change")},tt=function(t){if(!b.hasClass("elfinder-dialog-minimized")&&!b.is(":hidden")){nt.hide(),it.hide();var n,i,a,o=e.options.dialogContained?d:$(window),r=o.height(),s=o.width(),l="auto",c=!0;b.width(Math.min(650,s-30)),S.attr("style",""),pe&&ue&&(me=S.width()-(E.outerWidth()-E.width()),ge=S.height()-(E.outerHeight()-E.height()),Re.updateView(pe,ue)),i=k.find("div.elfinder-resize-control").width(),a=S.width(),n=k.width()-20,a>n?(S.width(n),c=!1):n-a<i&&(s>r?S.width(n-i-20):(S.css({float:"none",marginLeft:"auto",marginRight:"auto"}),c=!1)),c&&(l=i),me=S.width()-(E.outerWidth()-E.width()),d.hasClass("elfinder-fullscreen")?b.height()>r&&(r-=2,S.height(r-b.height()+S.height()),b.css("top",0-d.offset().top)):(r-=30,S.height()>r&&S.height(r)),ge=S.height()-(E.outerHeight()-E.height()),pe&&ue&&ze(),Se.height()&&S.height()>Se.height()+20&&(S.height(Se.height()+20),ge=S.height()-(E.outerHeight()-E.height()),Te()),nt.css("width",l).show(),it.css("width",l).show(),it.children("span.elfinder-resize-preset:visible").length||it.hide(),k.elfinderdialog("posInit")}},nt=(w=$('<fieldset class="elfinder-resize-preset-container">').append($("<legend>").html(e.i18n("presets"))).css("box-sizing","border-box").hide(),$.each(h,function(e,t){2===t.length&&(y=!0,w.append($('<span class="elfinder-resize-preset"/>').data("s",t).text(t[0]+"x"+t[1]).button()))}),y?w:$()),it=nt.clone(!0),at=e.uploadMimeCheck(n.mime,n.phash);U.append($(T).append($(z).text(e.i18n("width")),W),$(T).append($(z).text(e.i18n("height")),V,$('<div class="elfinder-resize-whctrls">').append(xe,N)),Y?$(T).append($(z).text(e.i18n("quality")),Y,$("<span/>")):$(),x?$(T).append($(z).text(e.i18n("8pxgrid")).addClass("elfinder-resize-grid8"),$e):$(),$(T).append($(z).text(e.i18n("scale")),_),$(T).append(nt)),l&&(P.append($(T).append($(z).text("X"),K),$(T).append($(z).text("Y")).append(X),$(T).append($(z).text(e.i18n("width")),G),$(T).append($(z).text(e.i18n("height")),J,$('<div class="elfinder-resize-whctrls">').append(ke,N.clone(!0))),Y?$(T).append($(z).text(e.i18n("quality")),Y.clone(!0),$("<span/>")):$(),x?$(T).append($(z).text(e.i18n("8pxgrid")).addClass("elfinder-resize-grid8")):$(),$(T).append(it)),q.append($(T).addClass("elfinder-resize-degree").append($(z).text(e.i18n("rotate")),Q,$("<span/>").text(e.i18n("degree")),$("<div/>").append(R,H)[p]()),$(T).css("height","20px").append(Z),Y?$(T)[t<1?"show":"hide"]().addClass("elfinder-resize-quality").append($(z).text(e.i18n("quality")),Y.clone(!0),$("<span/>")):$(),$(T).append($(z).text(e.i18n("bgcolor")),se,oe,re),$(T).css("height","20px").append(le)),R.on("click",function(){ye-=90,_e.update(ye)}),H.on("click",function(){ye+=90,_e.update(ye)})),k.append(L).on("resize",function(e){e.stopPropagation()}),l?M.append(U,P.hide(),q.hide()):M.append(U),E.append('<div class="'+Ge+" "+Ge+'-top"/>','<div class="'+Ge+" "+Ge+'-bottom"/>','<div class="'+Je+" "+Je+'-left"/>','<div class="'+Je+" "+Je+'-right"/>','<div class="'+Ye+" "+Ye+'-e"/>','<div class="'+Ye+" "+Ye+'-se"/>','<div class="'+Ye+" "+Ye+'-s"/>'),S.append(F).append(E.hide()).append(Se.hide()),l&&(D.css("position","absolute").append('<div class="'+Ge+" "+Ge+'-top"/>','<div class="'+Ge+" "+Ge+'-bottom"/>','<div class="'+Je+" "+Je+'-left"/>','<div class="'+Je+" "+Je+'-right"/>','<div class="'+Ye+" "+Ye+'-n"/>','<div class="'+Ye+" "+Ye+'-e"/>','<div class="'+Ye+" "+Ye+'-s"/>','<div class="'+Ye+" "+Ye+'-w"/>','<div class="'+Ye+" "+Ye+'-ne"/>','<div class="'+Ye+" "+Ye+'-se"/>','<div class="'+Ye+" "+Ye+'-sw"/>','<div class="'+Ye+" "+Ye+'-nw"/>'),S.append(Fe.css("position","absolute").hide().append(Ee,D.append(De))),S.append(Ue.hide())),S.css("overflow","hidden"),k.append(S,M),Xe[e.i18n("btnApply")]=Ve,at&&(Xe[e.i18n("btnSaveAs")]=function(){requestAnimationFrame(Ke)}),Xe[e.i18n("btnCancel")]=function(){k.elfinderdialog("close")},k.find("input,button").addClass("elfinder-tabstop"),b=o.fmDialog(k,{title:e.escape(n.name),width:650,resizable:!1,buttons:Xe,open:function(){var t=function(t){Ae=e.request({data:{cmd:"dim",target:n.hash,substitute:o?400:""},preventDefault:!0}).done(function(t){if(!t.url&&i)k.elfinderdialog("close"),e.error(["errOpen",n.name]);else if(t.dim){var a=t.dim.split("x");return n.width=a[0],n.height=a[1],Ie(a),t.url&&(Se.attr("src",t.url),Ee.attr("src",t.url),Ue.attr("src",t.url)),Me()}})},i=!{"image/jpeg":!0,"image/png":!0,"image/gif":!0}[n.mime],o=!(!e.option("substituteImg",n.hash)||!(i||n.size>c.dimSubImgSize)),r=!(!n.width||!n.height);if(v=b.find(".ui-dialog-titlebar .elfinder-titlebar-minimize").hide(),e.bind("resize",tt),Se.attr("src",a).one("error.dimreq",function(){t(!0)}),Ee.attr("src",a),Ue.attr("src",a),l&&(Ue.on("mousedown touchstart",_e.start).on("touchend",_e.stop),b.on("mouseup",_e.stop)),r&&!o)return Me();if(n.size>(c.getDimThreshold||0))Se.off("error.dimreq"),t();else if(r)return Me()},close:function(){l&&(Ue.off("mousedown touchstart",_e.start).off("touchend",_e.stop),$(document).off("mouseup",_e.stop)),e.unbind("resize",tt),$(this).elfinderdialog("destroy")},resize:function(e,t){t&&"off"===t.minimize&&tt()}}).attr("id",i).closest(".ui-dialog").addClass(f),e.UA.ltIE8&&$(".elfinder-dialog").css("filter",""),De.css({opacity:.2,"background-color":"#fff",position:"absolute"}),D.css("cursor","move"),D.find(".elfinder-resize-handle-point").css({"background-color":"#fff",opacity:.5,"border-color":"#000"}),l||L.find(".api2").remove(),M.find("input,select").prop("disabled",!0),M.find("input.elfinder-resize-quality").next("span").addClass("elfinder-resize-jpgsize").attr("title",e.i18n("roughFileSize"))};return r.length&&-1!==r[0].mime.indexOf("image/")?(i="resize-"+e.namespace+"-"+r[0].hash,(a=d.find("#"+i)).length?(a.elfinderdialog("toTop"),s.resolve()):(e.openUrl(r[0].hash,"sameorigin",function(e){m(r[0],i,e)}),s)):s.reject()}},function(e){var t=function(e,t){var n=0;for(n in t)if(void 0!==e[t[n]])return t[n];return e[t[n]]="",t[n]};if(e.cssHooks.rotate={get:function(t,n,i){return e(t).rotate()},set:function(t,n){return e(t).rotate(n),n}},e.cssHooks.transform={get:function(e,n,i){var a=t(e.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return e.style[a]},set:function(e,n){var i=t(e.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return e.style[i]=n,n}},e.fn.rotate=function(e){var t;return void 0===e?window.opera?(t=this.css("transform").match(/rotate\((.*?)\)/))&&t[1]?Math.round(180*parseFloat(t[1])/Math.PI):0:(t=this.css("transform").match(/rotate\((.*?)\)/))&&t[1]?parseInt(t[1]):0:(this.css("transform",this.css("transform").replace(/none|rotate\(.*?\)/,"")+"rotate("+parseInt(e)+"deg)"),this)},e.fx.step.rotate=function(t){0==t.state&&(t.start=e(t.elem).rotate(),t.now=t.start),e(t.elem).rotate(t.now)},void 0===window.addEventListener&&void 0===document.getElementsByClassName){var n=function(e){if("static"==e.currentStyle.position){var t=function(e){var t=e,n=t.offsetLeft,i=t.offsetTop;for(;t.offsetParent&&((t=t.offsetParent)==document.body||"static"==t.currentStyle.position);)t!=document.body&&t!=document.documentElement&&(n-=t.scrollLeft,i-=t.scrollTop),n+=t.offsetLeft,i+=t.offsetTop;return{x:n,y:i}}(e);e.style.position="absolute",e.style.left=t.x+"px",e.style.top=t.y+"px"}},i=e.cssHooks.transform.set;e.cssHooks.transform.set=function(e,t){return i.apply(this,[e,t]),function(e,t){var i,a=1,o=1,r=1,s=1;if(void 0!==e.style.msTransform)return!0;n(e);var l=(i=t.match(/rotate\((.*?)\)/))&&i[1]?parseInt(i[1]):0;(l%=360)<0&&(l=360+l);var c=l*Math.PI/180,d=Math.cos(c),p=Math.sin(c);a*=d,o*=-p,r*=p,s*=d,e.style.filter=(e.style.filter||"").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/,"")+"progid:DXImageTransform.Microsoft.Matrix(M11="+a+",M12="+o+",M21="+r+",M22="+s+",FilterType='bilinear',sizingMethod='auto expand')";var u=parseInt(e.style.width||e.width||0),h=parseInt(e.style.height||e.height||0);c=l*Math.PI/180;var f=Math.abs(Math.cos(c)),m=Math.abs(Math.sin(c)),g=(u-(u*f+h*m))/2,v=(h-(u*m+h*f))/2;e.style.marginLeft=Math.floor(g)+"px",e.style.marginTop=Math.floor(v)+"px"}(e,t),t}}}(jQuery),e}),e("skylark-elfinder/commands/restore",["../elFinder"],function(e){return(e.prototype.commands.restore=function(){"use strict";var e=this,t=this.fm,n=0,i=function(e){var a,o=$.Deferred(),r=[],s=[],l=[],c=[];return o._xhrReject=function(){$.each(l,function(){this&&this.reject&&this.reject()}),a&&a._xhrReject()},$.each(e,function(e,t){"directory"===t.mime?r.push(t):s.push(t)}),r.length?($.each(r,function(e,n){l.push(t.request({data:{cmd:"open",target:n.hash},preventDefault:!0,asNotOpen:!0})),c[e]=n.hash}),$.when.apply($,l).fail(function(){o.reject()}).done(function(){var e=[];$.each(arguments,function(t,i){i.files&&(i.files.length?e=e.concat(i.files):e.push({hash:"fakefile_"+n++,phash:c[t],mime:"fakefile",name:"fakefile",ts:0}))}),t.cache(e),a=i(e).done(function(e){s=s.concat(e),o.resolve(s)})})):o.resolve(s),o};this.restore=function(e,a,o,r){var s,l,c={},d=[],p=!1,u=[],h=r||{},f=+new Date;t.lockfiles({files:o}),u=$.map(a,function(e){return"directory"===e.mime?e.hash:null}),e.done(function(){u&&t.exec("rm",u,{forceRm:!0,quiet:!0})}).always(function(){t.unlockfiles({files:o})}),s=setTimeout(function(){t.notify({type:"search",id:f,cnt:1,hideCnt:!0,cancel:function(){l&&l._xhrReject(),e.reject()}})},t.notifyDelay),n=0,l=i(a).always(function(){s&&clearTimeout(s),t.notify({type:"search",id:f,cnt:-1,hideCnt:!0})}).fail(function(){e.reject("errRestore","errFileNotFound")}).done(function(n){var i=["errRestore","errFolderNotFound"],a="";n.length?($.each(n,function(e,n){for(var i,o,r,s=n.phash;s;){if(o=t.trashes[s]){if(!c[o]){if(p)return d.push(n.hash),null;c[o]={},p=!0}""===(r=(r=t.path(n.hash).substr(t.path(s).length).replace(/\\/g,"/")).replace(/\/[^\/]+?$/,""))&&(r="/"),c[o][r]||(c[o][r]=[]),"fakefile"===n.mime?t.updateCache({removed:[n.hash]}):c[o][r].push(n.hash),(!a||a.length>r.length)&&(a=r);break}(i=t.file(s))?s=i.phash:(s=!1,$.each(t.trashes,function(e){var i=t.file(e),a=t.path(e);if((!i.volumeid||0===n.hash.indexOf(i.volumeid))&&0===t.path(n.hash).indexOf(a))return s=e,!1}))}}),p?$.each(c,function(n,r){var s=Object.keys(r),l=s.length;t.request({data:{cmd:"mkdir",target:n,dirs:s},notify:{type:"chkdir",cnt:l},preventFail:!0}).fail(function(n){e.reject(n),t.unlockfiles({files:o})}).done(function(n){var o;(o=n.hashes)?t.getCommand("paste")?t.one("mkdirdone",function(){var n=!1;$.each(r,function(r,s){o[r]&&(s.length?t.file(o[r])?(t.clipboard(s,!0),t.exec("paste",[o[r]],{_cmd:"restore",noToast:h.noToast||r!==a}).done(function(e){e&&(e.error||e.warning)&&(n=!0)}).fail(function(){n=!0}).always(function(){--l<1&&(e[n?"reject":"resolve"](),d.length&&t.exec("restore",d))})):e.reject(i):--l<1&&(e.resolve(),d.length&&t.exec("restore",d)))})}):e.reject(["errRestore","errCmdNoSupport","(paste)"]):e.reject(i)})}):e.reject(i)):(e.reject("errFileNotFound"),u&&t.exec("rm",u,{forceRm:!0,quiet:!0}))})},this.linkedCmds=["copy","paste","mkdir","rm"],this.updateOnSelect=!1,this.init=function(){e=this,t=this.fm},this.getstate=function(e,n){return(e=e||t.selected()).length&&$.grep(e,function(e){var n=t.file(e);return!(!n||n.locked||t.isRoot(n))}).length==e.length?0:-1},this.exec=function(n,i){var a=$.Deferred().fail(function(e){e&&t.error(e)}),o=e.files(n);return o.length?($.each(o,function(e,n){return t.isRoot(n)?!a.reject(["errRestore",n.name]):n.locked?!a.reject(["errLocked",n.name]):void 0}),"pending"===a.state()&&this.restore(a,o,n,i),a):a.reject()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/rm",["../elFinder"],function(e){return e.prototype.commands.rm=function(){"use strict";var e=this,t=this.fm,n='<div class="ui-helper-clearfix elfinder-rm-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}<div class="elfinder-rm-desc">{desc}</div></div>',i=function(e,n,i){var a=i?{}:{type:"rm",cnt:n.length};t.request({data:{cmd:"rm",targets:n},notify:a,preventFail:!0}).fail(function(t){e.reject(t)}).done(function(t){(t.error||t.warning)&&(t.sync=!0),e.resolve(t)}).always(function(){t.unlockfiles({files:n})})},a=function(e){var n,i=null;return e&&e.length&&(e.length>1&&2===t.searchStatus.state?(n=t.file(t.root(e[0])).volumeid,$.grep(e,function(e){return 0!==e.indexOf(n)}).length||(i=t.option("trashHash",e[0]))):i=t.option("trashHash",e[0])),i},o=!1;this.confirm=function(a,r,s,l,c){var d,p,u,h,f,m,g=r.length,v=t.cwd().hash,b=[],y=t.i18n("calc")+'<span class="elfinder-spinner"/>';g>1?(h=0,$.each(s,function(e,t){if(!t.size||"unknown"==t.size||"directory"===t.mime)return h="unknown",!1;var n=parseInt(t.size);n>=0&&h>=0&&(h+=n)}),o="unknown"===h,b.push(t.i18n("size")+": "+(o?y:t.formatSize(h))),p=[$(n.replace("{class}","elfinder-cwd-icon-group").replace("{title}","<strong>"+t.i18n("items")+": "+g+"</strong>").replace("{desc}",b.join("<br>")))]):(f=s[0],u=t.tmb(f),o="directory"===f.mime,b.push(t.i18n("size")+": "+(o?y:t.formatSize(f.size))),b.push(t.i18n("modify")+": "+t.formatDate(f)),m=t.escape(f.i18||f.name).replace(/([_.])/g,"&#8203;$1"),p=[$(n.replace("{class}",t.mime2class(f.mime)).replace("{title}","<strong>"+m+"</strong>").replace("{desc}",b.join("<br>")))]);c&&(p=p.concat(c));p.push(l?"confirmTrash":"confirmRm"),d=t.confirm({title:e.title,text:p,accept:{label:"btnRm",callback:function(){l?e.toTrash(a,r,l):i(a,r)}},cancel:{label:"btnCancel",callback:function(){t.unlockfiles({files:r}),1===r.length&&t.file(r[0]).phash!==v?t.select({selected:r}):t.selectfiles({files:r}),a.reject()}}}),u&&$("<img/>").on("load",function(){d.find(".elfinder-cwd-icon").addClass(u.className).css("background-image","url('"+u.url+"')")}).attr("src",u.url);o&&(o=t.getSize($.map(s,function(e){return"directory"===e.mime?e.hash:null})).done(function(e){d.find("span.elfinder-spinner").parent().html(t.i18n("size")+": "+e.formated)}).fail(function(){d.find("span.elfinder-spinner").parent().html(t.i18n("size")+": "+t.i18n("unknown"))}).always(function(){o=!1}))},this.toTrash=function(n,i,a){var o,r,s,l={},c=i.length,d=e.options.toTrashMaxItems,p=[],u=$.Deferred();if(c>d)return void e.confirm(n,i,e.files(i),null,[t.i18n("tooManyToTrash")]);$.each(i,function(e,n){var i=t.file(n),a=t.path(n).replace(/\\/g,"/").match(/^[^\/]+?(\/(?:[^\/]+?\/)*)[^\/]+?$/);i&&(a&&(a[1]=a[1].replace(/(^\/.*?)\/?$/,"$1"),l[a[1]]||(l[a[1]]=[]),l[a[1]].push(n)),"directory"===i.mime&&p.push(n))}),p.length?(o=t.request({data:{cmd:"size",targets:p},notify:{type:"readdir",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){var t=0;e.fileCnt&&(t+=parseInt(e.fileCnt)),e.dirCnt&&(t+=parseInt(e.dirCnt)),u[t>d?"reject":"resolve"]()}).fail(function(){u.reject()}),setTimeout(function(){var e=o&&o.xhr?o.xhr:null;e&&"pending"==e.state()&&(o.syncOnFail(!1),o.reject(),u.reject())},1e3*e.options.infoCheckWait)):u.resolve();u.done(function(){r=Object.keys(l),(s=r.length)?t.request({data:{cmd:"mkdir",target:a,dirs:r},notify:{type:"chkdir",cnt:s},preventFail:!0}).fail(function(e){n.reject(e),t.unlockfiles({files:i})}).done(function(e){var a,o,r,c,d=["errTrash"],p={},u=function(){return t.ui.notify.children(".elfinder-notify-trash").length};(a=e.hashes)?(r=1/s*100,c=1===s?100:5,o=setTimeout(function(){t.notify({type:"trash",cnt:1,hideCnt:!0,progress:c})},t.notifyDelay),$.each(l,function(e,l){var h;t.file(l[0]).phash;a[e]&&(h={cmd:"paste",dst:a[e],targets:l,cut:1},t.request({data:h,preventDefault:!0}).fail(function(e){e&&(d=d.concat(e))}).done(function(e){e=t.normalize(e),t.updateCache(e),function(e,n,a){var o,r,s,l;$.each(e,function(e,t){Array.isArray(t)&&(p[e]?p[e]=p[e].concat(t):p[e]=t)}),e.sync&&(p.sync=1);e.added&&e.added.length&&(o=function(){var n=[],i=$.map(e.added,function(e){return"directory"===e.mime?e.hash:null});return $.each(e.added,function(e,t){-1===$.inArray(t.phash,i)&&n.push(t.hash)}),t.exec("restore",n,{noToast:!0})},s=function(){return t.request({data:a,notify:{type:"redo",cnt:i.length}})},p.undo?(r=p.undo,p.undo=function(){o(),r()}):p.undo=o,p.redo?(l=p.redo,p.redo=function(){s(),l()}):p.redo=s)}(e,0,h),e.warning&&(d=d.concat(e.warning),delete e.warning),e.removed&&e.removed.length&&t.remove(e),e.added&&e.added.length&&t.add(e),e.changed&&e.changed.length&&t.change(e),t.trigger("paste",e),t.trigger("pastedone"),e.sync&&t.sync()}).always(function(){var e=[],a=2;u()?t.notify({type:"trash",cnt:0,hideCnt:!0,progress:r}):c+=r,--s<1&&(o&&clearTimeout(o),u()&&t.notify({type:"trash",cnt:-1}),t.unlockfiles({files:i}),Object.keys(p).length?(d.length>1&&((p.removed||p.removed.length)&&(e=$.grep(i,function(e){return-1===$.inArray(e,p.removed)})),e.length?(d.length>a&&(a=-1===(t.messages[d[a-1]]||"").indexOf("$")?a:a+1),n.reject(),t.exec("rm",e,{addTexts:d.slice(0,a),forceRm:!0})):t.error(d)),p._noSound=!0,p.undo&&p.redo&&(p.undo={cmd:"trash",callback:p.undo},p.redo={cmd:"trash",callback:p.redo}),n.resolve(p)):n.reject(d))}))})):(n.reject("errFolderNotFound"),t.unlockfiles({files:i}))}):(n.reject(["error","The folder hierarchy to be deleting can not be determined."]),t.unlockfiles({files:i}))}).fail(function(){e.confirm(n,i,e.files(i),null,[t.i18n("tooManyToTrash")])})},this.remove=i,this.syncTitleOnChange=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"delete ctrl+backspace shift+delete"}],this.value="rm",this.init=function(){e=this,t=this.fm,e.change(function(){delete e.extra,e.title=t.i18n("cmd"+e.value),e.className=e.value,e.button&&e.button.children("span.elfinder-button-icon")["trash"===e.value?"addClass":"removeClass"]("elfinder-button-icon-trash"),"trash"===e.value&&(e.extra={icon:"rm",node:$("<span/>").attr({title:t.i18n("cmdrm")}).on("ready",function(e,t){}).on("click touchstart",function(e){"touchstart"===e.type&&e.originalEvent.touches.length>1||(e.stopPropagation(),e.preventDefault(),t.getUI().trigger("click"),t.exec("rm",void 0,{_userAction:!0,forceRm:!0}))})})})},this.getstate=function(e){var n=this.hashes(e);return n.length&&$.grep(n,function(e){var n=t.file(e);return!(!n||n.locked||t.isRoot(n))}).length==n.length?0:-1},this.exec=function(n,r){var s,l=r||{},c=$.Deferred().always(function(){o&&o.state&&"pending"===o.state()&&o.reject()}).fail(function(e){e&&t.error(e)}).done(function(e){!l.quiet&&!e._noSound&&e.removed&&e.removed.length&&t.trigger("playsound",{soundFile:"rm.wav"})}),d=e.files(n),p=d.length,u=null,h=l.addTexts?l.addTexts:null,f=l.forceRm,m=l.quiet;return p?($.each(d,function(e,n){return t.isRoot(n)?!c.reject(["errRm",n.name,"errPerm"]):n.locked?!c.reject(["errLocked",n.name]):void 0}),"pending"===c.state()&&(s=e.hashes(n),p=d.length,(f||e.event&&e.event.originalEvent&&e.event.originalEvent.shiftKey)&&(u="",e.title=t.i18n("cmdrm")),null===u&&(u=a(s)),t.lockfiles({files:s}),u&&e.options.quickTrash?e.toTrash(c,s,u):m?i(c,s,m):e.confirm(c,s,d,u,h)),c):c.reject()},t.bind("select contextmenucreate closecontextmenu",function(n){var i=(n.data?n.data.selected||n.data.targets:null)||t.selected();i&&i.length&&e.update(void 0,(i?a(i):t.option("trashHash"))?"trash":"rm")})},e}),e("skylark-elfinder/commands/search",["../elFinder"],function(e){return e.prototype.commands.search=function(){"use strict";this.title="Find files",this.options={ui:"searchbutton"},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return 0},this.exec=function(e,t,n,i){var a,o,r=this.fm,s=[],l=i||"",c=r.options.onlyMimes,d=[],p=function(e){return l&&"SearchName"!==l&&"SearchMime"!==l&&(e.type=l),e};return"string"==typeof e&&e?("object"==typeof t&&(n=t.mime||"",t=t.target||""),t=t||"",n?(n=$.trim(n).replace(","," ").split(" "),c.length&&(n=$.map(n,function(e){return(e=$.trim(e))&&(-1!==$.inArray(e,c)||$.grep(c,function(t){return 0===e.indexOf(t)}).length)?e:null}))):n=[].concat(c),r.trigger("searchstart",p({query:e,target:t,mimes:n})),!c.length||n.length?""===t&&r.api>=2.1?(o=Object.keys(r.roots).length,$.each(r.roots,function(t,i){s.push(r.request({data:p({cmd:"search",q:e,target:i,mimes:n}),notify:{type:"search",cnt:1,hideCnt:!(o>1)},cancel:!0,preventDone:!0}))})):(s.push(r.request({data:p({cmd:"search",q:e,target:t,mimes:n}),notify:{type:"search",cnt:1,hideCnt:!0},cancel:!0,preventDone:!0})),""!==t&&r.api>=2.1&&Object.keys(r.leafRoots).length&&$.each(r.leafRoots,function(i,o){for(a=i;a;)t===a&&$.each(o,function(){var t=r.file(this);t&&t.volumeid&&d.push(t.volumeid),s.push(r.request({data:p({cmd:"search",q:e,target:this,mimes:n}),notify:{type:"search",cnt:1,hideCnt:!1},cancel:!0,preventDone:!0}))}),a=(r.file(a)||{}).phash})):s=[$.Deferred().resolve({files:[]})],r.searchStatus.mixed=s.length>1&&d,$.when.apply($,s).done(function(e){var t,n=arguments.length;if(e.warning&&r.error(e.warning),n>1)for(e.files=e.files||[],t=1;t<n;t++)arguments[t].warning&&r.error(arguments[t].warning),arguments[t].files&&e.files.push.apply(e.files,arguments[t].files);e.files&&e.files.length&&r.cache(e.files),r.lazy(function(){r.trigger("search",e)}).then(function(){return r.lazy(function(){r.trigger("searchdone")})}).then(function(){e.sync&&r.sync()})})):(r.getUI("toolbar").find("."+r.res("class","searchbtn")+" :text").trigger("focus"),$.Deferred().reject())}},e}),e("skylark-elfinder/commands/selectall",["../elFinder"],function(e){return e.prototype.commands.selectall=function(){"use strict";var e=0;this.fm.bind("select",function(t){e=t.data&&t.data.selectall?-1:0}),this.state=0,this.updateOnSelect=!1,this.getstate=function(){return e},this.exec=function(){return $(document).trigger($.Event("keydown",{keyCode:65,ctrlKey:!0,shiftKey:!1,altKey:!1,metaKey:!1})),$.Deferred().resolve()}},e}),e("skylark-elfinder/commands/selectinvert",["../elFinder"],function(e){return e.prototype.commands.selectinvert=function(){"use strict";this.updateOnSelect=!1,this.getstate=function(){return 0},this.exec=function(){return $(document).trigger($.Event("keydown",{keyCode:73,ctrlKey:!0,shiftKey:!0,altKey:!1,metaKey:!1})),$.Deferred().resolve()}},e}),e("skylark-elfinder/commands/selectnone",["../elFinder"],function(e){return e.prototype.commands.selectnone=function(){"use strict";var e=this.fm,t=-1;e.bind("select",function(e){t=e.data&&e.data.unselectall?-1:0}),this.state=-1,this.updateOnSelect=!1,this.getstate=function(){return t},this.exec=function(){return e.getUI("cwd").trigger("unselectall"),$.Deferred().resolve()}},e}),e("skylark-elfinder/commands/sort",["../elFinder"],function(e){return e.prototype.commands.sort=function(){"use strict";var e=this,t=e.fm,n=function(){e.variants=[],$.each(t.sortRules,function(n,i){if(t.sorters[n]){var a=n===t.sortType?"asc"===t.sortOrder?"n":"s":"";e.variants.push([n,(a?'<span class="ui-icon ui-icon-arrowthick-1-'+a+'"></span>':"")+"&nbsp;"+t.i18n("sort"+n)])}}),e.variants.push("|"),e.variants.push(["stick",(t.sortStickFolders?'<span class="ui-icon ui-icon-check"/>':"")+"&nbsp;"+t.i18n("sortFoldersFirst")]),t.ui.tree&&null!==t.options.sortAlsoTreeview&&(e.variants.push("|"),e.variants.push(["tree",(t.sortAlsoTreeview?'<span class="ui-icon ui-icon-check"/>':"")+"&nbsp;"+t.i18n("sortAlsoTreeview")])),i()},i=function(){var e,n,i=t.getUI("contextmenu");i.is(":visible")&&(e=i.find("span.elfinder-button-icon-sort"),(n=e.siblings("div.elfinder-contextmenu-sub")).find("span.ui-icon").remove(),n.children("div.elfinder-contextsubmenu-item").each(function(){var e,n=$(this).children("span"),i=n.text().trim();i===(a.stick||(a.stick=t.i18n("sortFoldersFirst")))?t.sortStickFolders&&n.prepend('<span class="ui-icon ui-icon-check"/>'):i===(a.tree||(a.tree=t.i18n("sortAlsoTreeview")))?t.sortAlsoTreeview&&n.prepend('<span class="ui-icon ui-icon-check"/>'):i===(a[t.sortType]||(a[t.sortType]=t.i18n("sort"+t.sortType)))&&(e="asc"===t.sortOrder?"n":"s",n.prepend('<span class="ui-icon ui-icon-arrowthick-1-'+e+'"></span>'))}))},a={};this.options={ui:"sortbutton"},this.keepContextmenu=!0,t.bind("sortchange",n).bind("sorterupdate",function(){n(),t.getUI().children(".elfinder-button-sort-menu").children(".elfinder-button-menu-item").each(function(){var e=$(this),n=e.attr("rel");e.toggle(!(n&&!t.sorters[n]))})}).bind("cwdrender",function(){var e=$(t.cwd).find("div.elfinder-cwd-wrapper-list table");e.length&&$.each(t.sortRules,function(n,i){var a=e.find("thead tr td.elfinder-cwd-view-th-"+n);if(a.length){var o,r=n==t.sortType,s={type:n,order:r?"asc"==t.sortOrder?"desc":"asc":t.sortOrder};r&&(a.addClass("ui-state-active"),o="asc"==t.sortOrder?"n":"s",$('<span class="ui-icon ui-icon-triangle-1-'+o+'"/>').appendTo(a)),$(a).on("click",function(e){$(this).data("dragging")||(e.stopPropagation(),t.getUI("cwd").data("longtap")||t.exec("sort",[],s))}).on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"===e.type)})}})}),this.getstate=function(){return 0},this.exec=function(e,t){var n,i=this.fm,a=$.isPlainObject(t)?t:(n={},"stick"==(t+="")?n.stick=!i.sortStickFolders:"tree"===t?n.tree=!i.sortAlsoTreeview:i.sorters[t]&&(i.sortType===t?n.order="asc"===i.sortOrder?"desc":"asc":n.type=t),n),o=Object.assign({type:i.sortType,order:i.sortOrder,stick:i.sortStickFolders,tree:i.sortAlsoTreeview},a);return i.lazy(function(){i.setSort(o.type,o.order,o.stick,o.tree),this.resolve()})}},e}),e("skylark-elfinder/commands/undo",["../elFinder"],function(e){return e.prototype.commands.undo=function(){"use strict";var e=this,t=this.fm,n=function(n){n?(e.title=t.i18n("cmdundo")+" "+t.i18n("cmd"+n.cmd),e.state=0):(e.title=t.i18n("cmdundo"),e.state=-1),e.change()},i=[];this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+z"}],this.syncTitleOnChange=!0,this.getstate=function(){return i.length?0:-1},this.setUndo=function(e,a){var o={};e&&$.isPlainObject(e)&&e.cmd&&e.callback&&(Object.assign(o,e),a?(delete a.undo,o.redo=a):t.getCommand("redo").setRedo(null),i.push(o),n(o))},this.exec=function(){var e,a,o=t.getCommand("redo"),r=$.Deferred(),s={};return i.length?((e=i.pop()).redo?(Object.assign(s,e.redo),delete e.redo):s=null,r.done(function(){s&&o.setRedo(s,e)}),n(i.length?i[i.length-1]:void 0),(a=e.callback())&&a.done?a.done(function(){r.resolve()}).fail(function(){r.reject()}):r.resolve(),i.length?this.update(0,i[i.length-1].name):this.update(-1,"")):r.reject(),r},t.bind("exec",function(t){var n=t.data||{};n.opts&&n.opts._userAction&&n.dfrd&&n.dfrd.done&&n.dfrd.done(function(t){t&&t.undo&&t.redo&&(t.undo.redo=t.redo,e.setUndo(t.undo))})})},e.prototype.commands.redo=function(){"use strict";var e=this,t=this.fm,n=function(n){n&&n.callback?(e.title=t.i18n("cmdredo")+" "+t.i18n("cmd"+n.cmd),e.state=0):(e.title=t.i18n("cmdredo"),e.state=-1),e.change()},i=[];this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"shift+ctrl+z ctrl+y"}],this.syncTitleOnChange=!0,this.getstate=function(){return i.length?0:-1},this.setRedo=function(e,t){null===e?(i=[],n()):e&&e.cmd&&e.callback&&(t&&(e.undo=t),i.push(e),n(e))},this.exec=function(){var e,a,o=t.getCommand("undo"),r=$.Deferred(),s={},l={};return i.length?((e=i.pop()).undo&&(Object.assign(s,e.undo),Object.assign(l,e),delete l.undo,r.done(function(){o.setUndo(s,l)})),n(i.length?i[i.length-1]:void 0),(a=e.callback())&&a.done?a.done(function(){r.resolve()}).fail(function(){r.reject()}):r.resolve(),r):r.reject()}},e}),e("skylark-elfinder/commands/up",["../elFinder"],function(e){return(e.prototype.commands.up=function(){"use strict";this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+up"}],this.getstate=function(){return this.fm.cwd().phash?0:-1},this.exec=function(){var e=this.fm,t=e.cwd().hash;return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash).done(function(){e.one("opendone",function(){e.selectfiles({files:[t]})})}):$.Deferred().reject()}}).prototype={forceLoad:!0},e}),e("skylark-elfinder/commands/upload",["../elFinder"],function(e){return e.prototype.commands.upload=function(){"use strict";var e=this.fm.res("class","hover");this.disableOnSearch=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+u"}],this.getstate=function(e){var t,n=this.fm,i=e||[n.cwd().hash];return this._disabled||1!=i.length||(t=n.file(i[0])),t&&"directory"==t.mime&&t.write?0:-1},this.exec=function(t){var n,i,a,o,r,s,l=this.fm,c=l.cwd().hash,d=function(){var e,n=t&&t instanceof Array?t:null;(!t||t instanceof Array)&&(n||1!==(e=l.selected()).length||"directory"!==l.file(e[0]).mime?n&&1===n.length&&"directory"===l.file(n[0]).mime||(n=[c]):n=e);return n}(),p=d?d[0]:t&&t.target?t.target:null,u=p?l.file(p):l.cwd(),h=function(e){l.upload(e).fail(function(e){v.reject(e)}).done(function(e){var t;l.getUI("cwd");if(v.resolve(e),e&&e.added&&e.added[0]&&!l.ui.notify.children(".elfinder-notify-upload").length){var n=l.findCwdNodes(e.added);n.length?n.trigger("scrolltoview"):(u.hash!==c?t=$("<div/>").append($('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+l.i18n("cmdopendir")+"</span></button>").on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){l.exec("open",p).done(function(){l.one("opendone",function(){l.trigger("selectfiles",{files:$.map(e.added,function(e){return e.hash})})})})})):l.trigger("selectfiles",{files:$.map(e.added,function(e){return e.hash})}),l.toast({msg:l.i18n(["complete",l.i18n("cmdupload")]),extNode:t}))}}).progress(function(){v.notifyWith(this,Array.from(arguments))})},f=function(e){n.elfinderdialog("close"),d&&(e.target=d[0]),h(e)},m=function(){var e=u.hash,t=$.map(l.files(e),function(e){return"directory"===e.mime&&e.write?e:null});return t.length?$('<div class="elfinder-upload-dirselect elfinder-tabstop" title="'+l.i18n("folders")+'"/>').on("click",function(e){e.stopPropagation(),e.preventDefault(),t=l.sortFiles(t);var i=$(this),a=(l.cwd(),n.closest("div.ui-dialog")),o=function(e,t){return{label:l.escape(e.i18||e.name),icon:t,remain:!1,callback:function(){var t=a.children(".ui-dialog-titlebar:first").find("span.elfinder-upload-target");d=[e.hash],t.html(" - "+l.escape(e.i18||e.name)),i.trigger("focus")},options:{className:d&&d.length&&e.hash===d[0]?"ui-state-active":"",iconClass:e.csscls||"",iconImg:e.icon||""}}},r=[o(u,"opendir"),"|"];$.each(t,function(e,t){r.push(o(t,"dir"))}),i.trigger("blur"),l.trigger("contextmenu",{raw:r,x:e.pageX||$(this).offset().left,y:e.pageY||$(this).offset().top,prevNode:a,fitHeight:!0})}).append('<span class="elfinder-button-icon elfinder-button-icon-dir" />'):$()},g=function(t,n){var i=$('<input type="file" '+t+"/>").on("click",function(){l.UA.IE&&setTimeout(function(){a.css("display","none").css("position","relative"),requestAnimationFrame(function(){a.css("display","").css("position","")})},100)}).on("change",function(){f({input:i.get(0),type:"files"})}).on("dragover",function(e){e.originalEvent.dataTransfer.dropEffect="copy"}),a=$("<form/>").append(i).on("click",function(e){e.stopPropagation()});return $('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus"><span class="ui-button-text">'+l.i18n(n)+"</span></div>").append(a).on("click",function(e){e.stopPropagation(),e.preventDefault(),i.trigger("click")}).on("mouseenter mouseleave",function(t){$(this).toggleClass(e,"mouseenter"===t.type)})},v=$.Deferred();return i=function(e){e.stopPropagation(),e.preventDefault();var t,n=!1,i="",a=null,o="",r=null,s=e._target||null,c=e.dataTransfer||null,d=c.items&&c.items.length&&c.items[0].kind?c.items[0].kind:"";if(c){try{if((a=c.getData("elfinderfrom"))&&(o=window.location.href+l.cwd().hash,!s&&a===o||s===o))return void v.reject()}catch(e){}if("file"===d&&(c.items[0].getAsEntry||c.items[0].webkitGetAsEntry))n=c,i="data";else if("string"!==d&&c.files&&c.files.length&&-1===$.inArray("Text",c.types))n=c.files,i="files";else{try{(r=c.getData("text/html"))&&r.match(/<(?:img|a)/i)&&(n=[r],i="html")}catch(e){}n||((r=c.getData("text"))?(n=[r],i="text"):c&&c.files&&(d="file"))}}n?h({files:n,type:i,target:s,dropEvt:e}):(t=["errUploadNoFiles"],"file"===d&&t.push("errFolderUpload"),l.error(t),v.reject())},!d&&t?(t.input||t.files?(t.type="files",h(t)):t.dropEvt&&i(t.dropEvt),v):(a=function(e){var t,n=e.originalEvent||e,i=[],a=[];if(n.clipboardData){if(n.clipboardData.items&&n.clipboardData.items.length){a=n.clipboardData.items;for(var o=0;o<a.length;o++)"file"==n.clipboardData.items[o].kind&&(t=n.clipboardData.items[o].getAsFile(),i.push(t))}else n.clipboardData.files&&n.clipboardData.files.length&&(i=n.clipboardData.files);if(i.length)return void f({files:i,type:"files",clipdata:!0})}var r=n.target||n.srcElement;requestAnimationFrame(function(){var e,t="text";r.innerHTML&&($(r).find("img").each(function(e,t){t.src.match(/^webkit-fake-url:\/\//)&&$(t).remove()}),$(r).find("a,img").length&&(t="html"),e=r.innerHTML,r.innerHTML="",f({files:[e],type:t}))})},n=$('<div class="elfinder-upload-dialog-wrapper"/>').append(g("multiple","selectForUpload")),l.UA.Mobile||void 0===(s=document.createElement("input")).webkitdirectory&&void 0===s.directory||n.append(g("multiple webkitdirectory directory","selectFolder")),u.dirs&&(u.hash===c||l.navHash2Elm(u.hash).hasClass("elfinder-subtree-loaded")?m().appendTo(n):(o=$('<div class="elfinder-upload-dirselect" title="'+l.i18n("nowLoading")+'"/>').append('<span class="elfinder-button-icon elfinder-button-icon-spinner" />').appendTo(n),l.request({cmd:"tree",target:u.hash}).done(function(){l.one("treedone",function(){o.replaceWith(m()),r.elfinderdialog("tabstopsInit")})}).fail(function(){o.remove()}))),l.dragUpload?$('<div class="ui-corner-all elfinder-upload-dropbox elfinder-tabstop" contenteditable="true" data-ph="'+l.i18n("dropPasteFiles")+'"></div>').on("paste",function(e){a(e)}).on("mousedown click",function(){$(this).trigger("focus")}).on("focus",function(){this.innerHTML=""}).on("mouseover",function(){$(this).addClass(e)}).on("mouseout",function(){$(this).removeClass(e)}).on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),$(this).addClass(e)}).on("dragleave",function(t){t.stopPropagation(),t.preventDefault(),$(this).removeClass(e)}).on("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy",$(this).addClass(e)}).on("drop",function(e){n.elfinderdialog("close"),d&&(e.originalEvent._target=d[0]),i(e.originalEvent)}).prependTo(n).after('<div class="elfinder-upload-dialog-or">'+l.i18n("or")+"</div>")[0]:$('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable="true">'+l.i18n("dropFilesBrowser")+"</div>").on("paste drop",function(e){a(e)}).on("mousedown click",function(){$(this).trigger("focus")}).on("focus",function(){this.innerHTML=""}).on("dragenter mouseover",function(){$(this).addClass(e)}).on("dragleave mouseout",function(){$(this).removeClass(e)}).prependTo(n).after('<div class="elfinder-upload-dialog-or">'+l.i18n("or")+"</div>")[0],r=this.fmDialog(n,{title:this.title+'<span class="elfinder-upload-target">'+(u?" - "+l.escape(u.i18||u.name):"")+"</span>",modal:!0,resizable:!1,destroyOnClose:!0,propagationEvents:["mousemove","mouseup","click"],close:function(){var e=l.getUI("contextmenu");e.is(":visible")&&e.click()}}),v)}},e}),e("skylark-elfinder/commands/view",["../elFinder"],function(e){return e.prototype.commands.view=function(){"use strict";var e,t=this,n=this.fm;this.value=n.viewType,this.alwaysEnabled=!0,this.updateOnSelect=!1,this.options={ui:"viewbutton"},this.getstate=function(){return 0},this.extra={icon:"menu",node:$("<span/>").attr({title:n.i18n("viewtype")}).on("click touchstart",function(e){if(!("touchstart"===e.type&&e.originalEvent.touches.length>1)){var t=$(this);e.stopPropagation(),e.preventDefault(),n.trigger("contextmenu",{raw:getSubMenuRaw(),x:t.offset().left,y:t.offset().top})}})},this.exec=function(){var e=this,t="list"==this.value?"icons":"list";return n.storage("view",t),n.lazy(function(){n.viewchange(),e.update(void 0,t),this.resolve()})},n.bind("init",function(){e=function(){var e,i=n.getUI("cwd"),a=[],o=n.options.uiOptions.cwd.iconsView.sizeNames,r=n.options.uiOptions.cwd.iconsView.sizeMax;for(e=0;e<=r;e++)a.push({label:n.i18n(o[e]||"Size-"+e+" icons"),icon:"view",callback:function(e){return function(){i.trigger("iconpref",{size:e}),n.storage("iconsize",e),"list"===t.value&&t.exec()}}(e)});return a.push("|"),a.push({label:n.i18n("viewlist"),icon:"view-list",callback:function(){"list"!==t.value&&t.exec()}}),a}()}).bind("contextmenucreate",function(){t.extra={icon:"menu",node:$("<span/>").attr({title:n.i18n("cmdview")}).on("click touchstart",function(i){if(!("touchstart"===i.type&&i.originalEvent.touches.length>1)){var a,o,r=$(this);e.concat();for(a="list"===t.value?e.length-1:parseInt(n.storage("iconsize")||0),o=0;o<e.length;o++)"|"!==e[o]&&(e[o].options=o===a?{className:"ui-state-active"}:void 0);i.stopPropagation(),i.preventDefault(),n.trigger("contextmenu",{raw:e,x:r.offset().left,y:r.offset().top})}})}})},e}),e("skylark-elfinder/proxy/elFinderSupportVer1",[],function(){window.elFinderSupportVer1=function(e){"use strict";var t,n,i,a=this,o=function(e){return e.replace("Today",n).replace("Yesterday",i)};t=new Date,n=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),t=new Date(Date.now()-864e5),i=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),this.upload=e||"auto",this.init=function(e){this.fm=e,this.fm.parseUploadData=function(e){var t;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{t=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return a.normalize("upload",t)}},this.send=function(e){var t,n,i=this,a=this.fm,o=$.Deferred(),r=e.data.cmd,s={};switch(o.abort=function(){"pending"==n.state()&&(n.quiet=!0,n.abort())},r){case"open":e.data.tree=1;break;case"parents":case"tree":return o.resolve({tree:[]});case"get":e.data.cmd="read",e.data.current=a.file(e.data.target).phash;break;case"put":e.data.cmd="edit",e.data.current=a.file(e.data.target).phash;break;case"archive":case"rm":e.data.current=a.file(e.data.targets[0]).phash;break;case"extract":case"rename":case"resize":e.data.current=a.file(e.data.target).phash;break;case"duplicate":return s=$.extend(!0,{},e),$.each(e.data.targets,function(e,t){$.ajax(Object.assign(s,{data:{cmd:"duplicate",target:t,current:a.file(t).phash}})).fail(function(e){a.error(a.res("error","connect"))}).done(function(e){(e=i.normalize("duplicate",e)).error?a.error(e.error):e.added&&a.trigger("add",{added:e.added})})}),o.resolve({});case"mkdir":case"mkfile":e.data.current=e.data.target;break;case"paste":e.data.current=e.data.dst,e.data.tree||$.each(e.data.targets,function(t,n){if(a.file(n)&&"directory"===a.file(n).mime)return e.data.tree="1",!1});break;case"size":case"search":return o.resolve({error:a.res("error","cmdsupport")});case"file":e.data.cmd="open",e.data.current=a.file(e.data.target).phash}return n=$.ajax(e).fail(function(e){o.reject(e)}).done(function(e){t=i.normalize(r,e),o.resolve(t)}),o},this.normalize=function(e,t){var n,i,a,r,s=this,l=this.fm,c={},d=function(e){return $.grep(e,function(e){return!(!e||!e.mime||"directory"!==e.mime)})};return"tmb"==e||"get"==e?t:("upload"==e&&t.error&&t.cwd&&(t.warning=Object.assign({},t.error),t.error=!1),t.error?t:"put"==e?(n=l.file(t.target.hash).phash,{changed:[this.normalizeFile(t.target,n)]}):(n=t.cwd.hash,a=n==l.cwd().hash,t.tree&&$.each(this.normalizeTree(t.tree),function(e,t){c[t.hash]=t}),$.each(t.cdc||[],function(e,i){var a,r=i.hash;c[r]?(i.date&&((a=Date.parse(o(i.date)))&&!isNaN(a)?c[r].ts=Math.floor(a/1e3):c[r].date=i.date||l.formatDate(i)),c[r].locked=i.hash==n||void 0!==i.rm&&!i.rm):c[r]=s.normalizeFile(i,n,t.tmb)}),t.tree||$.each(l.files(),function(e,t){c[e]||t.phash==n||"directory"!=t.mime||(c[e]=t)}),"open"==e?{cwd:c[n]||this.normalizeFile(t.cwd),files:$.map(c,function(e){return e}),options:s.normalizeOptions(t),init:!!t.params,debug:t.debug}:(a?i=l.diff($.map(c,function(e){return e&&e.hash&&e.name&&e.mime?e:null})):t.tree&&"paste"!==e?i=function(e){var t=d(e);(r=l.diff(t,null,["date","ts"])).added.length&&(r.added=d(r.added));r.changed.length&&(r.changed=d(r.changed));if(r.removed.length){var n=[];$.each(r.removed,function(e,t){var i;(i=l.file(t))&&"directory"===i.mime&&n.push(t)}),r.removed=n}return r}(c):(i={added:[],removed:[],changed:[]},"paste"===e&&(i.sync=!0)),Object.assign({current:t.cwd.hash,error:t.error,warning:t.warning,options:{tmb:!!t.tmb}},i))))},this.normalizeTree=function(e){var t=this,n=[],i=function(e,a){var o,r;for(o=0;o<e.length;o++)r=e[o],n.push(t.normalizeFile(r,a)),r.dirs.length&&i(r.dirs,r.hash)};return i([e]),n},this.normalizeFile=function(e,t,n){var i=e.mime||"directory",a="directory"!=i||e.linkTo?e.size:0,r=e.date?Date.parse(o(e.date)):void 0,s={url:e.url,hash:e.hash,phash:t,name:e.name,mime:i,ts:e.ts,size:a,read:e.read,write:e.write,locked:!t||void 0!==e.rm&&!e.rm};return s.ts||(r&&!isNaN(r)?s.ts=Math.floor(r/1e3):s.date=e.date||this.fm.formatDate(e)),"application/x-empty"!=e.mime&&"inode/x-empty"!=e.mime||(s.mime="text/plain"),e.linkTo&&(s.alias=e.linkTo),e.linkTo&&(s.linkTo=e.linkTo),e.tmb?s.tmb=e.tmb:0===s.mime.indexOf("image/")&&n&&(s.tmb=1),e.dirs&&e.dirs.length&&(s.dirs=!0),e.dim&&(s.dim=e.dim),e.resize&&(s.resize=e.resize),s},this.normalizeOptions=function(e){var t={path:e.cwd.rel,disabled:$.merge(e.disabled||[],["search","netmount","zipdl"]),tmb:!!e.tmb,copyOverwrite:!0};return e.params&&(t.api=1,t.url=e.params.url,t.archivers={create:e.params.archives||[],extract:e.params.extract||[]}),-1!==t.path.indexOf("/")?t.separator="/":-1!==t.path.indexOf("\\")&&(t.separator="\\"),t}}}),e("skylark-elfinder/extras/editors.default",["../elFinder"],function(e){"use strict";var t,n=window.location.search.match(/getfile=([a-z]+)/),i=e.prototype.hasRequire,a=function(){var e;try{e=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){e=!!(void 0===window.orientation||navigator&&navigator.mimeTypes["application/x-shockwave-flash"])}return e}(),o={bmp:"image/x-ms-bmp",dng:"image/x-adobe-dng",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",pdf:"application/pdf",png:"image/png",ppm:"image/x-portable-pixmap",psd:"image/vnd.adobe.photoshop",pxd:"image/x-pixlr-data",svg:"image/svg+xml",tiff:"image/tiff",webp:"image/webp",xcf:"image/x-xcf",sketch:"application/x-sketch",ico:"image/x-icon",dds:"image/vnd-ms.dds",emf:"application/x-msmetafile"},r=function(e,n,i){t||(t=n.arrayFlip(o));var a=t[e]||n.mimeTypes[e];return i?"jpg"===a&&(a="jpeg"):"jpeg"===a&&(a="jpg"),a},s=function(e,t){var n=$.Deferred();try{var i=document.createElement("canvas"),a=i.getContext("2d"),o=new Image;return o.src=e,$(o).on("load",function(){try{i.width=o.width,i.height=o.height,a.drawImage(o,0,0),function(){var e,a,o=i.toDataURL(t);e=(a=o.match(/^data:([a-z0-9]+\/[a-z0-9.+-]+)/i))?a[1]:"";e.toLowerCase()===t.toLowerCase()?n.resolve(i.toDataURL(t),i):n.reject()}()}catch(e){n.reject()}}).on("error",function(){n.reject()}),n}catch(e){return n.reject()}},l=function(e,t,n,i){var a,o=$(this).children("img:first").data("ext",r(t.mime,i)),s=$('<div class="elfinder-edit-spinner elfinder-edit-image"/>').html('<span class="elfinder-spinner-text">'+i.i18n("ntfloadimg")+'</span><span class="elfinder-spinner"/>').hide().appendTo(this),l=function(){o.attr("id",e+"-img").attr("src",a||n).css({height:"","max-width":"100%","max-height":"100%",cursor:"pointer"}).data("loading",function(e){var t=o.closest(".elfinder-dialog").find("button,.elfinder-titlebar-button");return t.prop("disabled",!e)[e?"removeClass":"addClass"]("ui-state-disabled"),o.css("opacity",e?"":"0.3"),s[e?"hide":"show"](),o})};n.match(/^data:/)?l():i.openUrl(t.hash,!1,function(e){a=e,o.attr("_src",n),l()})};return function(){if(!a||window.parent===window)return;var e,t,n,i,r,s=window.location.search.match(/[?&]pixlr=([^&]+)/),l=window.location.search.match(/[?&]image=([^&]+)/);s&&(e=window.parent,t=e.$("#"+s[1]+"iframe").hide(),i=e.$("#"+s[1]).data("resizeoff")(),"http"===l[1].substr(0,4)?(n=l[1],r=n.replace(/.+\.([^.]+)$/,"$1"),i.data("ext")!==r&&i.closest(".ui-dialog").trigger("changeType",{extention:r,mime:o[r]}),"https:"===window.location.protocol&&(n=n.replace(/^http:/,"https:")),i.on("load error",function(){i.data("loading")(!0)}).attr("src",n).data("loading")()):i.data("loading")(!0),t.trigger("destroy").remove())}(),n&&"ckeditor"===(n=n[1])&&(e.prototype._options.getFileCallback=function(e,t){var n,i;window.opener.CKEDITOR.tools.callFunction((n=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),(i=window.location.search.match(n))&&i.length>1?i[1]:""),t.convAbsUrl(e.url)),t.destroy(),window.close()}),[{info:{id:"tuiimgedit",name:"TUI Image Editor",iconImg:"img/editor-icons.png 0 -48",dataScheme:!0,schemeContent:!0,openMaximized:!0,canMakeEmpty:!1,integrate:{title:"TOAST UI Image Editor",link:"http://ui.toast.com/tui-image-editor/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><canvas></canvas></div>',setup:function(e,t){t.UA.ltIE8||t.UA.Mobile?this.disabled=!0:(this.opts=Object.assign({version:"v3.9.0"},e.extraOptions.tuiImgEditOpts||{},{iconsPath:t.baseUrl+"img/tui-",theme:{}}),t.isSameOrigin(this.opts.iconsPath)||(this.disabled=!0,t.debug("warning","Setting `commandOptions.edit.extraOptions.tuiImgEditOpts.iconsPath` MUST follow the same origin policy.")))},init:function(e,t,n,i){this.data("url",n)},load:function(e){var t,n=this,i=this.fm,a=$.Deferred(),o=i.options.cdns,r=n.confObj.opts.version,s=function(t){var o,r,s,l,c=$(e),d=c.parent(),p=n.confObj.opts,u=p.iconsPath,h=$('<div class="tui-image-editor-container">').appendTo(d),f=[$('<div class="tui-image-editor-submenu"/>').appendTo(h),$('<div class="tui-image-editor-controls"/>').appendTo(h)],m=new t(e,{includeUI:{loadImage:{path:c.data("url"),name:n.file.name},theme:Object.assign(p.theme,{"menu.normalIcon.path":u+"icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":u+"icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":u+"icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":u+"icon-c.svg","menu.hoverIcon.name":"icon-c","submenu.normalIcon.path":u+"icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":u+"icon-c.svg","submenu.activeIcon.name":"icon-c"}),initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:Math.max(300,d.width()),cssMaxHeight:Math.max(200,d.height()-(f[0].height()+f[1].height()+3)),usageStatistics:!1}),g=c.find("canvas:first").get(0),v=function(e){if(void 0!==e){var t,n,i=$(g),a=parseInt(i.attr("width")),o=parseInt(i.attr("height")),r=a/o;0===e?(t=a,n=o):(t=parseInt(i.css("max-width"))+Number(e),n=t/r,t>a&&n>o&&(t=a,n=o)),w.text(Math.round(t/a*100)+"%"),m.resizeCanvasDimension({width:t,height:n}),l&&setTimeout(function(){l&&v(e)},50)}},b=$('<span class="ui-icon ui-icon-plusthick"/>').data("val",10),y=$('<span class="ui-icon ui-icon-minusthick"/>').data("val",-10),w=$("<button/>").css("width","4em").text("%").attr("title","100%").data("val",0);h.remove(),c.removeData("url").data("mime",n.file.mime),"image/jpeg"===n.file.mime?(c.data("quality",i.storage("jpgQuality")||i.option("jpgQuality")),o=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=o.val();c.data("quality",e),r&&cancelAnimationFrame(r),r=requestAnimationFrame(function(){g.toBlob(function(e){e&&o.next("span").text(" ("+i.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(c.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(i.i18n("quality")+" : "),o,$("<span/>")).prependTo(c.parent().next())):"image/svg+xml"===n.file.mime&&c.closest(".ui-dialog").trigger("changeType",{extention:"png",mime:"image/png",keepEditor:!0}),$('<div class="ui-dialog-buttonset elfinder-edit-extras"/>').append(y,w,b).attr("title",i.i18n("scale")).on("click","span,button",function(){v($(this).data("val"))}).on("mousedown mouseup mouseleave","span",function(e){l=!1,s&&clearTimeout(s),"mousedown"===e.type&&(s=setTimeout(function(){l=!0,v($(e.target).data("val"))},500))}).prependTo(c.parent().next()),setTimeout(function(){a.resolve(m),o&&(o.trigger("change"),m.on("redoStackChanged undoStackChanged",function(){o.trigger("change")})),v(null)},100),c.find(".tui-colorpicker-palette-container").on("click",".tui-colorpicker-palette-preview",function(){$(this).closest(".color-picker-control").height("auto").find(".tui-colorpicker-slider-container").toggle()}),c.on("click",function(){c.find(".tui-colorpicker-slider-container").hide()})};return n.confObj.editor?s(n.confObj.editor):(t=$.Deferred(),i.loadCss([o.tui+"/tui-color-picker/latest/tui-color-picker.css",o.tui+"/tui-image-editor/"+r+"/tui-image-editor.css"]),i.hasRequire?(require.config({paths:{"fabric/dist/fabric.require":o.fabric+"/fabric.require.min",fabric:o.fabric+"/fabric.min","tui-code-snippet":o.tui+"/tui.code-snippet/latest/tui-code-snippet.min","tui-color-picker":o.tui+"/tui-color-picker/latest/tui-color-picker.min","tui-image-editor":o.tui+"/tui-image-editor/"+r+"/tui-image-editor.min"}}),require(["tui-image-editor"],function(e){t.resolve(e)})):i.loadScript([o.fabric+"/fabric.min.js",o.tui+"/tui.code-snippet/latest/tui-code-snippet.min.js"],function(){i.loadScript([o.tui+"/tui-color-picker/latest/tui-color-picker.min.js"],function(){i.loadScript([o.tui+"/tui-image-editor/"+r+"/tui-image-editor.min.js"],function(){t.resolve(window.tui.ImageEditor)},{loadType:"tag"})},{loadType:"tag"})},{loadType:"tag"}),t.done(function(e){n.confObj.editor=e,s(e)})),a},getContent:function(e){var t=this.editor,n=t.fm,i=$(e),a=i.data("quality");if(t.instance)return"image/jpeg"===i.data("mime")&&(a=a||n.storage("jpgQuality")||n.option("jpgQuality"),a=Math.max(.1,Math.min(1,a/100))),t.instance.toDataURL({format:r(i.data("mime"),n,!0),quality:a})},save:function(e){var t,n=$(e),i=n.data("quality"),a=n.data("hash");this.instance.deactivateAll(),void 0!==i&&this.fm.storage("jpgQuality",i),a&&(t=this.fm.file(a),n.data("mime",t.mime))}},{info:{id:"pixlreditor",name:"Pixlr Editor",iconImg:"img/editor-icons.png 0 -128",urlAsContent:!0,schemeContent:!0,single:!0,canMakeEmpty:!0,integrate:{title:"PIXLR EDITOR",link:"https://pixlr.com/editor/"}},mimes:["image/jpeg","image/png","image/gif","image/x-ms-bmp","image/x-pixlr-data"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(e,t){(function(e,t){a&&!t.UA.ltIE8||(this.disabled=!0)}).call(this,e,t)},init:function(e,t,n,i){l.call(this,e,t,t.size>0?i.convAbsUrl(n):"",i)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){(function(e,t){if(navigator&&!navigator.mimeTypes["application/x-shockwave-flash"]){var n="data:application/x-shockwave-flash;base64,Q1dTCJUCAAB42kxSTW/TQBB9Xjv1hkLamoIvEeJaQBUHjvQjVEUKImnkIK7BjTapi5u1dlfQ/gJ6KjdLCHHl9/CPyszaRexhdt/sm3kzs3uJ+A+QVsCTAEfillZ3DbQmAZmD3jZZOk1ms0k+/5wvld0d5cUKt71QMOv6Nx7De2bLUp/mJZbKfVTGFnoFq9zbMrdnd3jBAOrSKbMi5nF7GK5oX+RzhXlelqiMdtpdVQoXnHd6ZZ26oKsqPy3KwhXK4kub8ClsRS7s4gXONZGPjdEGyhhgMJ0qNzG6ohKWFrWARD9Jfgm8CxgEfe+6kdxtuINXqLuIGUSBFNm3ACKt1xEJGcbcqox8QGfMds3bOEuJhpM6QgQpxwSCtAHdmy0eXLQDYb8uMq0dNlHHjYDEIVHD1AeS2L8afuK7ROcTXjJmhXtec92r3R/f1SQfxPw6VFovqzvwoL1MIDc8lpv/cSh6q+1IkGv/hyAJ9iacP8Lz9zVdDmk2iXc/HL3mbZuJMXwQnp3UG42UiII4ZIlHeykOwjd0vO4TY/RhMD2ajQbDMdxZYZtv4d/QT5pHlbaTj5tMUvj+wizFIcG/AAAA//8DAFw0fxk=";return void $(t).empty().append('<object data="'+n+'" type="application/x-shockwave-flash" style="width:100%;height:100%"><param name="movie" value="'+n+'"></object>')}var i,a=this,o=this.fm,r=o.res("class","preventback"),s=$(t).children("img:first").data("loading")().data("resizeoff",function(){return $(window).off("resize."+s.attr("id")),l.addClass(r),s}).on("click",function(){f()}),l=$(t).closest(".ui-dialog"),c=o.getUI(),d=o.getUI("toast"),p=$('<iframe class="ui-front" allowtransparency="true">'),u=this.file,h=function(e){e?(p.trigger("destroy").remove(),s.data("loading")(!0),o.error(e)):(d.appendTo(l.closest(".ui-dialog")),o.toast({mode:"info",msg:"Can not launch Pixlr yet. Waiting 15 seconds.",button:{text:"Abort",click:function(){p.trigger("destroy").remove(),s.data("loading")(!0)}},onHidden:function(){1===d.children().length&&d.appendTo(o.getUI())}}),i=setTimeout(e,15e3))},f=function(){var n="https://pixlr.com/"+e+"/?s=c",d=window.location.href.toString().replace(/#.*$/,""),f={};i=setTimeout(h,15e3),d+=(-1===d.indexOf("?")?"?":"&")+"pixlr="+s.attr("id"),n+="&referrer=elFinder&locktitle=true",n+="&exit="+encodeURIComponent(d+"&image=0"),n+="&target="+encodeURIComponent(d),n+="&title="+encodeURIComponent(u.name),n+="&image="+encodeURIComponent(s.attr("_src")),f.src=n,f.css={width:"100%",height:$(window).height()+"px",position:"fixed",display:"block",backgroundColor:"transparent",border:"none",top:0,right:0},a.trigger("Prepare",{node:t,editorObj:void 0,instance:p,opts:f}),p.attr("id",s.attr("id")+"iframe").attr("src",f.src).css(f.css).one("load",function(){i&&clearTimeout(i),setTimeout(function(){p.is(":hidden")&&h("Please disable your ad blocker.")},1e3),l.addClass(r),o.toggleMaximize(p,!0),o.toFront(p)}).on("destroy",function(){o.toggleMaximize(p,!1)}).on("error",h).appendTo(c.hasClass("elfinder-fullscreen")?c:"body")};$(t).on("saveAsFail",f),f()}).call(this,"editor",e)},save:function(e){},close:function(e){}},{info:{id:"photopea",name:"Photopea",iconImg:"img/editor-icons.png 0 -160",single:!0,noContent:!0,arrayBufferContent:!0,openMaximized:!0,canMakeEmpty:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/tiff","image/webp","image/vnd.adobe.photoshop","application/pdf","image/x-portable-pixmap","image/x-sketch","image/x-icon","image/vnd-ms.dds"],integrate:{title:"Photopea",link:"https://www.photopea.com/learn/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp","image/tiff","image/x-adobe-dng","image/webp","image/x-xcf","image/vnd.adobe.photoshop","application/pdf","image/x-portable-pixmap","image/x-sketch","image/x-icon","image/vnd-ms.dds","application/x-msmetafile"],html:'<iframe style="width:100%;height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.IE||t.UA.Mobile)&&(this.disabled=!0)},init:function(e,t,n,i){var a,s,l="https://www.photopea.com",c=$(this).hide().on("load",function(){c.show()}).on("error",function(){u.remove(),c.show()}),d=this.editor,p=d.confObj,u=$('<div class="elfinder-edit-spinner elfinder-edit-photopea"/>').html('<span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(c.parent()),h=i.arrayFlip(p.info.canMakeEmpty),f=function(e){var t=r(e,i),n=o[t];return p.mimesFlip[n]?"jpeg"===t&&(t="jpg"):t="",t&&h[n]||(n=o[t="psd"],c.closest(".ui-dialog").trigger("changeType",{extention:t,mime:n,keepEditor:!0})),t},m=t.mime;p.mimesFlip||(p.mimesFlip=i.arrayFlip(p.mimes,!0)),p.liveMsg||(p.liveMsg=function(e,t,n){var a,o=e.get(0).contentWindow,r=0,s=null,c=$.Deferred().done(function(){t.remove(),r=1,o.postMessage(s,l)});this.load=function(){return i.getContents(n.hash,"arraybuffer").done(function(e){s=e})},this.receive=function(t){var n=t.originalEvent;n.origin===l&&n.source===o&&("done"===n.data?0===r?c.resolve():1===r?(r=2,e.trigger("contentsloaded")):a&&"pending"===a.state()&&a.reject("errDataEmpty"):"Save"===n.data?d.doSave():a&&"pending"===a.state()&&("object"==typeof n.data?a.resolve("data:"+m+";base64,"+i.arrayBufferToBase64(n.data)):a.reject("errDataEmpty")))},this.getContent=function(){var t,n;if(r>1)return a&&"pending"===a.state()&&a.reject(),a=null,a=$.Deferred(),2===r?(r=3,a.resolve("data:"+m+";base64,"+i.arrayBufferToBase64(s)),s=null,a):(e.data("mime")&&(m=e.data("mime"),t=f(m)),(n=e.data("quality"))&&(t+=":"+n/100),o.postMessage('app.activeDocument.saveToOE("'+t+'")',l),a)}}),c.parent().css("padding",0),f(t.mime),a=d.liveMsg=new p.liveMsg(c,u,t),$(window).on("message."+i.namespace,a.receive),a.load().done(function(){var e=JSON.stringify({files:[],environment:{lang:i.lang.replace(/_/g,"-"),customIO:{save:'app.echoToOE("Save");'}}});c.attr("src",l+"/#"+encodeURI(e))}).fail(function(e){e&&i.error(e),d.initFail=!0}),"image/jpeg"!==t.mime&&"image/webp"!==t.mime||(c.data("quality",i.storage("jpgQuality")||i.option("jpgQuality")),s=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=s.val();c.data("quality",e)}).val(c.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(i.i18n("quality")+" : "),s,$("<span/>")).prependTo(c.parent().next()))},load:function(e){var t=$.Deferred(),n=this,i=(this.fm,$(e));return n.initFail?t.reject():i.on("contentsloaded",function(){t.resolve(n.liveMsg)}),t},getContent:function(){return this.editor.liveMsg?this.editor.liveMsg.getContent():void 0},save:function(e,t){var n,i=$(e),a=i.data("quality"),o=i.data("hash");void 0!==a&&this.fm.storage("jpgQuality",a),o?(n=this.fm.file(o),i.data("mime",n.mime)):i.removeData("mime")},close:function(e,t){$(e).attr("src",""),t&&$(window).off("message."+this.fm.namespace,t.receive)}},{info:{id:"pixo",name:"Pixo Editor",iconImg:"img/editor-icons.png 0 -208",dataScheme:!0,schemeContent:!0,single:!0,canMakeEmpty:!1,integrate:{title:"Pixo Editor",link:"https://pixoeditor.com/privacy-policy/"}},mimes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-ms-bmp"],html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(e,t){!t.UA.ltIE8&&e.extraOptions&&e.extraOptions.pixo&&e.extraOptions.pixo.apikey?this.editorOpts=e.extraOptions.pixo:this.disabled=!0},init:function(e,t,n,i){l.call(this,e,t,n,i)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(e){var t,n,i,a,o,l=this,c=this.fm,d=$(e),p=d.children("img:first"),u=d.closest(".ui-dialog"),h=c.getUI(),f=$.Deferred(),m=$("#elfinder-pixo-container"),g=function(i){var g;m.length?m.appendTo(m.parent()):(m=$('<div id="elfinder-pixo-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"hidden"}).hide().appendTo(h.hasClass("elfinder-fullscreen")?h:"body"),h.on("resize."+c.namespace,function(e,t){e.preventDefault(),e.stopPropagation(),t&&t.fullscreen&&m.appendTo("on"===t.fullscreen?h:"body")}),c.bind("destroy",function(){o&&o.cancelEditing(),m.remove()})),p.on("click",v),g=Object.assign({type:"child",parent:m.get(0),output:{format:"png"},onSave:function(i){var o=i.toBlob().type,d=r(o,c),h=function(e){p.one("load error",function(){p.data("loading")&&p.data("loading")(!0)}).attr("crossorigin","anonymous").attr("src",e)},f=i.toDataURL();p.data("loading")(),delete e._canvas,p.data("ext")!==d?s(f,l.file.mime).done(function(i,o){o&&(e._canvas=a=o,n.trigger("change"),t&&t.show()),h(i)}).fail(function(){u.trigger("changeType",{extention:d,mime:o}),h(f)}):h(f)},onClose:function(){u.removeClass(c.res("class","preventback")),c.toggleMaximize(m,!1),m.hide(),c.toFront(u)}},l.confObj.editorOpts),l.trigger("Prepare",{node:e,editorObj:Pixo,instance:void 0,opts:g}),o=new Pixo.Bridge(g),f.resolve(o),d.on("saveAsFail",v),i&&i()},v=function(){u.addClass(c.res("class","preventback")),c.toggleMaximize(m,!0),c.toFront(m),m.show().data("curhash",l.file.hash),o.edit(p.get(0)),p.data("loading")(!0)};return p.data("loading")(),"image/jpeg"===l.file.mime&&(n=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=n.val();i&&cancelAnimationFrame(i),i=requestAnimationFrame(function(){a&&a.toBlob(function(e){e&&n.next("span").text(" ("+c.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(c.storage("jpgQuality")||c.option("jpgQuality")),t=$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').hide().append($("<span>").html(c.i18n("quality")+" : "),n,$("<span/>")).prependTo(d.parent().next()),d.data("quty",n)),"undefined"==typeof Pixo?c.loadScript(["https://pixoeditor.com:8443/editor/scripts/bridge.m.js"],function(){g(v)},{loadType:"tag"}):(g(),v()),f},save:function(e){var t,n=$(e),i=n.children("img:first");e._canvas?(n.data("quty")&&(t=n.data("quty").val())&&this.fm.storage("jpgQuality",t),i.attr("src",e._canvas.toDataURL(this.file.mime,t?Math.max(Math.min(t,100),1)/100:void 0))):"data:"!==i.attr("src").substr(0,5)&&i.attr("src",function(e,t){var n,i,a,o=e.attr("style");try{e.attr("style",""),n=e.get(0),(i=document.createElement("canvas")).width=n.width,i.height=n.height,e.attr("style",o),i.getContext("2d").drawImage(n,0,0),a=i.toDataURL(t)}catch(t){a=e.attr("src")}return a}(i,this.file.mime))},close:function(e,t){t&&t.destroy()}},{setup:function(e,t){!t.UA.ltIE8&&t.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"ACE Editor",iconImg:"img/editor-icons.png 0 -96"},load:function(e){var t=this,n=this.fm,i=$.Deferred(),a=n.options.cdns.ace;return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadScript([a+"/ace.js"],function(){t.confObj.loader.resolve()},void 0,{obj:window,name:"ace"})),t.confObj.loader.done(function(){var n,o,r,s=$(e),l=s.parent(),c=l.parent(),d=e.id+"_ace",p=(t.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),{"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"});l.height(l.height()),ace.config.set("basePath",a),o=$('<div id="'+d+'" style="width:100%; height:100%;"/>').text(s.val()).insertBefore(s.hide()),s.data("ace",!0),(n=ace.edit(d)).$blockScrolling=1/0,n.setOptions({theme:"ace/theme/monokai",fontSize:"14px",wrap:!0}),ace.config.loadModule("ace/ext/modelist",function(){"text"===(r=ace.require("ace/ext/modelist").getModeForPath("/"+t.file.name).name)&&p[t.file.mime]&&(r=p[t.file.mime]),l.prev().children(".elfinder-dialog-title").append(" ("+t.file.mime+" : "+r.split(/[\/\\]/).pop()+")"),n.setOptions({mode:"ace/mode/"+r}),"resolved"===i.state()&&c.trigger("resize")}),ace.config.loadModule("ace/ext/language_tools",function(){ace.require("ace/ext/language_tools"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),ace.config.loadModule("ace/ext/settings_menu",function(){ace.require("ace/ext/settings_menu").init(n)}),n.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(e){t.doSave()}}),n.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(e){t.doCancel()}}),n.resize(),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(t.fm.i18n("TextArea")).button().on("click",function(){s.data("ace")?(s.removeData("ace"),o.hide(),s.val(n.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(s.data("ace",!0),o.show(),n.setValue(s.hide().val(),-1),n.focus(),$(this).html(t.fm.i18n("TextArea")))})).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){n.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().appendTo($("#elfinder"))})).prependTo(l.next()),t.trigger("Prepare",{node:e,editorObj:ace,instance:n,opts:{}}),i.resolve(n)}),i},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&$(e).data("ace")&&(e.value=t.session.getValue())},focus:function(e,t){t&&$(e).data("ace")&&t.focus()},resize:function(e,t,n,i){t&&t.resize()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.codemirror||(this.disabled=!0)},info:{id:"codemirror",name:"CodeMirror",iconImg:"img/editor-icons.png 0 -176"},load:function(e){var t=this.fm,n=t.convAbsUrl(t.options.cdns.codemirror),a=$.Deferred(),o=this;return o.confObj.loader||(o.confObj.loader=$.Deferred(),i?(require.config({packages:[{name:"codemirror",location:n,main:"codemirror.min"}],map:{codemirror:{"codemirror/lib/codemirror":"codemirror"}}}),require(["codemirror","codemirror/addon/mode/loadmode.min","codemirror/mode/meta.min"],function(e){o.confObj.loader.resolve(e)})):o.fm.loadScript([n+"/codemirror.min.js"],function(){o.fm.loadScript([n+"/addon/mode/loadmode.min.js",n+"/mode/meta.min.js"],function(){o.confObj.loader.resolve(CodeMirror)})},{loadType:"tag"}),o.fm.loadCss(n+"/codemirror.css")),o.confObj.loader.done(function(t){var r,s,l,c,d,p,u,h=$(e),f=h.parent();f.height(f.height()),l={lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-S":function(){o.doSave()},"Ctrl-Q":function(){o.doCancel()},"Ctrl-W":function(){o.doCancel()}}},o.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:l}),r=t.fromTextArea(e,l),a.resolve(r),c||(c=t.findModeByMIME(o.file.mime));!c&&(d=o.file.name.match(/.+\.([^.]+)$/))&&(c=t.findModeByExtension(d[1]));c&&(t.modeURL=i?"codemirror/mode/%N/%N.min":n+"/mode/%N/%N.min.js",p=c.mode,u=c.mime,r.setOption("mode",u),t.autoLoadMode(r,p),f.prev().children(".elfinder-dialog-title").append(" ("+u+("null"!=p?" : "+p:"")+")"));s=$(r.getWrapperElement()).css({padding:0,border:"none"}),h.data("cm",!0),s.height("100%"),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(o.fm.i18n("TextArea")).button().on("click",function(){h.data("cm")?(h.removeData("cm"),s.hide(),h.val(r.getValue()).show().trigger("focus"),$(this).text("CodeMirror")):(h.data("cm",!0),s.show(),r.setValue(h.hide().val()),r.refresh(),r.focus(),$(this).html(o.fm.i18n("TextArea")))})).prependTo(f.next())}),a},close:function(e,t){t&&t.toTextArea()},save:function(e,t){t&&$(e).data("cm")&&(e.value=t.getValue())},focus:function(e,t){t&&$(e).data("cm")&&t.focus()},resize:function(e,t,n,i){t&&t.refresh()}},{setup:function(e,t){!t.UA.ltIE10&&t.options.cdns.simplemde||(this.disabled=!0)},info:{id:"simplemde",name:"SimpleMDE",iconImg:"img/editor-icons.png 0 -80"},exts:["md"],load:function(e){var t=this,n=this.fm,a=$(e).parent(),o=$.Deferred(),r=n.options.cdns.simplemde;return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadCss(r+"/simplemde.min.css"),i?require([r+"/simplemde.min.js"],function(e){t.confObj.loader.resolve(e)}):t.fm.loadScript([r+"/simplemde.min.js"],function(){t.confObj.loader.resolve(SimpleMDE)},{loadType:"tag"})),t.confObj.loader.done(function(n){var i,r,s,l=a.height(),c=a.outerHeight(!0)-l+14;e._setHeight=function(e){var t,n=e||a.height(),o=0;return a.children(".editor-toolbar,.editor-statusbar").each(function(){o+=$(this).outerHeight(!0)}),t=n-o-c,r.height(t),i.codemirror.refresh(),t},a.height(l),s={element:e,autofocus:!0},t.trigger("Prepare",{node:e,editorObj:n,instance:void 0,opts:s}),i=new n(s),o.resolve(i),(r=$(i.codemirror.getWrapperElement())).css("min-height","50px").children(".CodeMirror-scroll").css("min-height","50px"),e._setHeight(l)}),o},close:function(e,t){t&&t.toTextArea(),t=null},save:function(e,t){t&&(e.value=t.value())},focus:function(e,t){t&&t.codemirror.focus()},resize:function(e,t,n,i){t&&e._setHeight()}},{info:{id:"ckeditor",name:"CKEditor",iconImg:"img/editor-icons.png 0 0"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.ckeditor?(this.ckeOpts={},e.extraOptions&&(this.ckeOpts=Object.assign({},e.extraOptions.ckeditor||{}),e.extraOptions.managerUrl&&(this.managerUrl=e.extraOptions.managerUrl))):this.disabled=!0},load:function(e){var t=this,n=this.fm,i=$.Deferred();return t.confObj.loader||(t.confObj.loader=$.Deferred(),window.CKEDITOR_BASEPATH=n.options.cdns.ckeditor+"/",$.getScript(n.options.cdns.ckeditor+"/ckeditor.js",function(){t.confObj.loader.resolve()})),t.confObj.loader.done(function(){var a,o=$(e).parent(),r=o.closest(".elfinder-dialog"),s=o.height(),l=/([&?]getfile=)[^&]+/,c=t.confObj.managerUrl||window.location.href.replace(/#.*$/,"");l.test(c)?c=c.replace(l,"$1ckeditor"):c+="?getfile=ckeditor";o.height(s),a={startupFocus:!0,fullPage:!0,allowedContent:!0,filebrowserBrowseUrl:c,toolbarCanCollapse:!0,toolbarStartupExpanded:!n.UA.Mobile,removePlugins:"resize",extraPlugins:"colorbutton,justify,docprops",on:{instanceReady:function(a){var o=a.editor;o.resize("100%",s),r.one("beforedommove."+n.namespace,function(){o.destroy()}).one("dommove."+n.namespace,function(){t.load(e).done(function(e){t.instance=e})}),i.resolve(a.editor)}}},t.trigger("Prepare",{node:e,editorObj:CKEDITOR,instance:void 0,opts:a}),CKEDITOR.replace(e.id,Object.assign(a,t.confObj.ckeOpts)),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.definition.dialog;t.on("show",function(e){n.getUI().append($(".cke_dialog_background_cover")).append(this.getElement().$)}),t.on("hide",function(e){$("body:first").append($(".cke_dialog_background_cover")).append(this.getElement().$)})})}),i},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&(e.value=t.getData())},focus:function(e,t){t&&t.focus()},resize:function(e,t,n,i){t&&"ready"===t.status&&t.resize("100%",$(e).parent().height())}},{info:{id:"ckeditor5",name:"CKEditor5",iconImg:"img/editor-icons.png 0 -16"},exts:["htm","html","xhtml"],html:'<div class="edit-editor-ckeditor5"></div>',setup:function(e,t){var n=this;t.options.cdns.ckeditor5&&"function"==typeof window.Symbol&&"symbol"==typeof Symbol()?(n.ckeOpts={},e.extraOptions&&(e.extraOptions.ckeditor5Mode&&(n.ckeditor5Mode=e.extraOptions.ckeditor5Mode),n.ckeOpts=Object.assign({},e.extraOptions.ckeditor5||{}),n.ckeOpts.mode&&(n.ckeditor5Mode=n.ckeOpts.mode,delete n.ckeOpts.mode),e.extraOptions.managerUrl&&(n.managerUrl=e.extraOptions.managerUrl))):n.disabled=!0,t.bind("destroy",function(){n.editor=null})},prepare:function(e,t,n){$(e).height(e.editor.fm.getUI().height()-100)},init:function(e,t,n,i){var a=n.match(/^([\s\S]*<body[^>]*>)([\s\S]+)(<\/body>[\s\S]*)$/i),o="",r="",s="";this.css({width:"100%",height:"100%","box-sizing":"border-box"}),a?(o=a[1],r=a[2],s=a[3]):r=n,this.data("data",{header:o,body:r,footer:s}),this._setupSelEncoding(n)},load:function(e){var t,n,i=this,a=this.fm,o=$.Deferred(),r=i.confObj.ckeditor5Mode||"decoupled-document",s=("zh"===(n=a.lang.toLowerCase().replace("_","-")).substr(0,2)&&"zh-cn"!==n&&(n="zh"),n),l=function(t){var n,l=$(e).parent();l.height(a.getUI().height()-100),n=Object.assign({toolbar:["heading","|","fontSize","fontFamily","|","bold","italic","underline","strikethrough","highlight","|","alignment","|","numberedList","bulletedList","blockQuote","indent","outdent","|","ckfinder","link","imageUpload","insertTable","mediaEmbed","|","undo","redo"],language:s},i.confObj.ckeOpts),i.trigger("Prepare",{node:e,editorObj:t,instance:void 0,opts:n}),t.create(e,n).then(function(t){var n,i,s=t.commands.get("ckfinder"),d=t.plugins.get("FileRepository"),p={};!t.ui.view.toolbar||"classic"!==r&&"decoupled-document"!==r||$(e).closest(".elfinder-dialog").children(".ui-widget-header").append($(t.ui.view.toolbar.element).css({marginRight:"-1em",marginLeft:"-1em"})),"classic"===r&&$(e).closest(".elfinder-edit-editor").css("overflow","auto"),s&&(n=function(e){return e&&e.mime.match(/^image\//i)},i=function(e){var n=t.commands.get("imageUpload");if(n.isEnabled)t.execute("imageInsert",{source:e});else{var i=t.plugins.get("Notification"),a=t.locale.t;i.showWarning(a("Could not insert image at the current position."),{title:a("Inserting image failed"),namespace:"ckfinder"})}},s.execute=function(){var e=l.closest(".elfinder-dialog"),o=a.getCommand("getfile"),r=function(){p.hasVar&&(e.off("resize close",r),o.callback=p.callback,o.options.folders=p.folders,o.options.multiple=p.multi,a.commandMap.open=p.open,p.hasVar=!1)};e.trigger("togleminimize").one("resize close",r),p.callback=o.callback,p.folders=o.options.folders,p.multi=o.options.multiple,p.open=a.commandMap.open,p.hasVar=!0,o.callback=function(o){var r=[];1!==o.length||"directory"!==o[0].mime?(a.getUI("cwd").trigger("unselectall"),$.each(o,function(e,i){n(i)?r.push(a.convAbsUrl(i.url)):t.execute("link",a.convAbsUrl(i.url))}),r.length&&i(r),e.trigger("togleminimize")):a.one("open",function(){a.commandMap.open="getfile"}).getCommand("open").exec(o[0].hash)},o.options.folders=!0,o.options.multiple=!0,a.commandMap.open="getfile",a.toast({mode:"info",msg:a.i18n("dblclickToSelect")})}),d.createUploadAdapter=function(e){return new c(e)},t.setData($(e).data("data").body),a.getUI().append($("body > div.ck-body")),$("div.ck-balloon-panel").css({"z-index":a.getMaximizeCss().zIndex+1}),o.resolve(t)}).catch(function(e){a.error(e)})},c=function(e){var t=function(t,n,i){a.exec("upload",{files:[t]},void 0,a.cwd().hash).done(function(e){e.added&&e.added.length?a.url(e.added[0].hash,{async:!0}).done(function(e){n({default:a.convAbsUrl(e)})}).fail(function(){i("errFileNotFound")}):i(a.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=a.parseError(e);i(a.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))}).progress(function(t){e.uploadTotal=t.total,e.uploaded=t.progress})};this.upload=function(){return new Promise(function(n,i){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then(function(e){t(e,n,i)}):t(e.file,n,i)})},this.abort=function(){a.getUI().trigger("uploadabort")}};return i.confObj.editor?l(i.confObj.editor):(t=$.Deferred(),i.fm.loadScript([a.options.cdns.ckeditor5+"/"+r+"/ckeditor.js"],function(e){e||(e=window.BalloonEditor||window.InlineEditor||window.ClassicEditor||window.DecoupledEditor),"en"!==a.lang?i.fm.loadScript([a.options.cdns.ckeditor5+"/"+r+"/translations/"+s+".js"],function(n){t.resolve(e)},{tryRequire:!0,loadType:"tag",error:function(n){s="en",t.resolve(e)}}):t.resolve(e)},{tryRequire:!0,loadType:"tag"}),t.done(function(e){i.confObj.editor=e,l(e)})),o},getContent:function(){var e=$(this).data("data");return e.header+e.body+e.footer},close:function(e,t){t&&t.destroy()},save:function(e,t){var n=$(e),i=n.data("data");t&&(i.body=t.getData(),n.data("data",i))},focus:function(e,t){$(e).trigger("focus")}},{info:{id:"tinymce",name:"TinyMCE",iconImg:"img/editor-icons.png 0 -64"},exts:["htm","html","xhtml"],setup:function(e,t){t.options.cdns.tinymce?(this.mceOpts={},e.extraOptions?(this.uploadOpts=Object.assign({},e.extraOptions.uploadOpts||{}),this.mceOpts=Object.assign({},e.extraOptions.tinymce||{})):this.uploadOpts={}):this.disabled=!0},load:function(e){var t=this,n=this.fm,i=$.Deferred();return t.confObj.loader||(t.confObj.loader=$.Deferred(),t.fm.loadScript([n.options.cdns.tinymce+(n.options.cdns.tinymce.match(/\.js/)?"":"/tinymce.min.js")],function(){t.confObj.loader.resolve()},{loadType:"tag"})),t.confObj.loader.done(function(){var a,o,r,s=$(e).show().parent(),l=s.closest(".elfinder-dialog"),c=s.height(),d=s.outerHeight(!0)-c,p=function(){var e;tinymce.activeEditor.windowManager.windows?(e=tinymce.activeEditor.windowManager.windows[0],o=$(e?e.getEl():void 0).hide(),r=$("#mce-modal-block").hide()):o=$(".tox-dialog-wrap").hide()},u=function(){r&&r.show(),o&&o.show()},h=tinymce.majorVersion;s.height(c),e._setHeight=function(e){if(h<5){var t,n=$(this).parent(),i=e||n.innerHeight(),a=0;n.find(".mce-container-body:first").children(".mce-top-part,.mce-statusbar").each(function(){a+=$(this).outerHeight(!0)}),t=i-a-d,n.find(".mce-edit-area iframe:first").height(t)}},a={selector:"#"+e.id,resize:!1,plugins:"print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image media | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat",image_advtab:!0,init_instance_callback:function(a){e._setHeight(c),l.one("beforedommove."+n.namespace,function(){tinymce.execCommand("mceRemoveEditor",!1,e.id)}).one("dommove."+n.namespace,function(){t.load(e).done(function(e){t.instance=e})}),i.resolve(a)},file_picker_callback:function(e,t,i){var a=n.getCommand("getfile"),o=function(){r.hasVar&&(a.callback=r.callback,a.options.folders=r.folders,a.options.multiple=r.multi,n.commandMap.open=r.open,r.hasVar=!1),l.off("resize close",o),u()},r={};return r.callback=a.callback,r.folders=a.options.folders,r.multi=a.options.multiple,r.open=n.commandMap.open,r.hasVar=!0,a.callback=function(t){var a,o;"directory"!==t.mime?(a=n.convAbsUrl(t.url),o=t.name+" ("+n.formatSize(t.size)+")","file"==i.filetype&&e(a,{text:o,title:o}),"image"==i.filetype&&e(a,{alt:o}),"media"==i.filetype&&e(a),l.trigger("togleminimize")):n.one("open",function(){n.commandMap.open="getfile"}).getCommand("open").exec(t.hash)},a.options.folders=!0,a.options.multiple=!1,n.commandMap.open="getfile",p(),l.trigger("togleminimize").one("resize close",o),n.toast({mode:"info",msg:n.i18n("dblclickToSelect")}),!1},images_upload_handler:function(e,i,a){var o=e.blob(),r=function(e){var t=e.data.dialog||{};(t.hasClass("elfinder-dialog-error")||t.hasClass("elfinder-confirm-upload"))&&(p(),t.trigger("togleminimize").one("resize close",s),n.unbind("dialogopened",r))},s=function(){l.off("resize close",s),u()},c=!0;o.name&&(c=void 0),n.bind("dialogopened",r).exec("upload",Object.assign({files:[o],clipdata:c},t.confObj.uploadOpts),void 0,n.cwd().hash).done(function(e){e.added&&e.added.length?n.url(e.added[0].hash,{async:!0}).done(function(e){u(),i(n.convAbsUrl(e))}).fail(function(){a(n.i18n("errFileNotFound"))}):a(n.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=n.parseError(e);t&&("errUnknownCmd"===t?t="errPerm":"userabort"===t&&(t="errAbort")),a(n.i18n(t||"errUploadNoFiles"))})}},h>=5&&(a.height="100%");t.trigger("Prepare",{node:e,editorObj:tinymce,instance:void 0,opts:a}),tinymce.init(Object.assign(a,t.confObj.mceOpts))}),i},close:function(e,t){t&&tinymce.execCommand("mceRemoveEditor",!1,e.id)},save:function(e,t){t&&t.save()},focus:function(e,t){t&&t.focus()},resize:function(e,t,n,i){t&&e._setHeight()}},{info:{id:"zohoeditor",name:"Zoho Editor",iconImg:"img/editor-icons.png 0 -32",cmdCheck:"ZohoOffice",preventGet:!0,hideButtons:!0,syncInterval:15e3,canMakeEmpty:!0,integrate:{title:"Zoho Office API",link:"https://www.zoho.com/officeapi/"}},mimes:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/rtf","text/html","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","application/vnd.sun.xml.calc","text/csv","text/tab-separated-values","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.oasis.opendocument.presentation","application/vnd.sun.xml.impress"],html:'<iframe style="width:100%;max-height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.Mobile||t.UA.ltIE8)&&(this.disabled=!0)},prepare:function(e,t,n){var i=e.editor.fm.getUI();$(e).height(i.height()),t.width=Math.max(t.width||0,.8*i.width())},init:function(e,t,n,i){var a,o=this,r=$(this).hide(),s=i.getUI("toast"),l=$('<div class="elfinder-edit-spinner elfinder-edit-zohoeditor"/>').html('<span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(r.parent());$(o).data("xhr",i.request({data:{cmd:"editor",name:o.editor.confObj.info.cmdCheck,method:"init","args[target]":t.hash,"args[lang]":i.lang,"args[cdata]":(a="",$.each(i.customData,function(e,t){a+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),a)},preventDefault:!0}).done(function(e){var t;e.zohourl?(t={css:{height:"100%"}},o.editor.trigger("Prepare",{node:o,editorObj:void 0,instance:r,opts:t}),r.attr("src",e.zohourl).show().css(t.css),e.warning&&(s.appendTo(o.closest(".ui-dialog")),i.toast({msg:i.i18n(e.warning),mode:"warning",timeOut:0,onHidden:function(){1===s.children().length&&s.appendTo(i.getUI())},button:{text:"btnYes"}}))):(e.error&&i.error(e.error),o.elfinderdialog("destroy"))}).fail(function(e){e&&i.error(e),o.elfinderdialog("destroy")}).always(function(){l.remove()}))},load:function(){},getContent:function(){},save:function(){},beforeclose:function(e){var t,n=$(e),i=$.Deferred().always(function(){n.off("load",r)}),a="about:blank",o=function(){t=setTimeout(function(){var e;try{e=base.contentWindow.location.href}catch(t){e=null}e===a?i.resolve():--s>0?o():i.reject()},500)},r=function(){t&&clearTimeout(t),i.resolve()},s=20;return n.one("load",r),e.src=a,o(),i},close:function(e){this.fm;var t=$(e).data("xhr");"pending"===t.state()&&t.reject()}},{info:{id:"ziparchive",name:"btnMount",iconImg:"img/toolbar.png 0 -416",cmdCheck:"ZipArchive",edit:function(e,t){var n=this,i=$.Deferred();return n.request({data:{cmd:"netmount",protocol:"ziparchive",host:e.hash,path:e.phash},preventFail:!0,notify:{type:"netmount",cnt:1,hideCnt:!0}}).done(function(e){var t;e.added&&e.added.length&&(e.added[0].phash&&(t=n.file(e.added[0].phash))&&(t.dirs||(t.dirs=1,n.change({changed:[t]}))),n.one("netmountdone",function(){n.exec("open",e.added[0].hash),n.one("opendone",function(){e.toast&&n.toast(e.toast)})})),i.resolve()}).fail(function(e){i.reject(e)}),i}},mimes:["application/zip"],load:function(){},save:function(){}},{info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}}),e.setSelectionRange&&e.setSelectionRange(0,0),$(e).trigger("focus").show()},save:function(){}},{info:{id:"onlineconvert",name:"Online Convert",iconImg:"img/editor-icons.png 0 -144",cmdCheck:"OnlineConvert",preventGet:!0,hideButtons:!0,single:!0,converter:!0,canMakeEmpty:!1,integrate:{title:"ONLINE-CONVERT.COM",link:"https://online-convert.com"}},mimes:["*"],html:'<div style="width:100%;max-height:100%;"></div>',setup:function(e,t){var n=e.extraOptions.onlineConvert||{maxSize:100,showLink:!0};n.maxSize&&(this.info.maxSize=1048576*n.maxSize),this.set=Object.assign({url:"https://%s.online-convert.com%s?external_url=",conv:{Archive:{"7Z":{},BZ2:{ext:"bz"},GZ:{},ZIP:{}},Audio:{MP3:{},OGG:{ext:"oga"},WAV:{},WMA:{},AAC:{},AIFF:{ext:"aif"},FLAC:{},M4A:{},MMF:{},OPUS:{ext:"oga"}},Document:{DOC:{},DOCX:{},HTML:{},ODT:{},PDF:{},PPT:{},PPTX:{},RTF:{},SWF:{},TXT:{}},eBook:{AZW3:{ext:"azw"},ePub:{},FB2:{ext:"xml"},LIT:{},LRF:{},MOBI:{},PDB:{},PDF:{},"PDF-eBook":{ext:"pdf"},TCR:{}},Hash:{Adler32:{},"Apache-htpasswd":{},Blowfish:{},CRC32:{},CRC32B:{},Gost:{},Haval128:{},MD4:{},MD5:{},RIPEMD128:{},RIPEMD160:{},SHA1:{},SHA256:{},SHA384:{},SHA512:{},Snefru:{},"Std-DES":{},Tiger128:{},"Tiger128-calculator":{},"Tiger128-converter":{},Tiger160:{},Tiger192:{},Whirlpool:{}},Image:{BMP:{},EPS:{ext:"ai"},GIF:{},EXR:{},ICO:{},JPG:{},PNG:{},SVG:{},TGA:{},TIFF:{ext:"tif"},WBMP:{},WebP:{}},Video:{"3G2":{},"3GP":{},AVI:{},FLV:{},HLS:{ext:"m3u8"},MKV:{},MOV:{},MP4:{},"MPEG-1":{ext:"mpeg"},"MPEG-2":{ext:"mpeg"},OGG:{ext:"ogv"},OGV:{},WebM:{},WMV:{},Android:{link:"/convert-video-for-%s",ext:"mp4"},Blackberry:{link:"/convert-video-for-%s",ext:"mp4"},DPG:{link:"/convert-video-for-%s",ext:"avi"},iPad:{link:"/convert-video-for-%s",ext:"mp4"},iPhone:{link:"/convert-video-for-%s",ext:"mp4"},iPod:{link:"/convert-video-for-%s",ext:"mp4"},"Nintendo-3DS":{link:"/convert-video-for-%s",ext:"avi"},"Nintendo-DS":{link:"/convert-video-for-%s",ext:"avi"},PS3:{link:"/convert-video-for-%s",ext:"mp4"},Wii:{link:"/convert-video-for-%s",ext:"avi"},Xbox:{link:"/convert-video-for-%s",ext:"wmv"}}},catExts:{Hash:"txt"},link:'<div class="elfinder-edit-onlineconvert-link"><a href="https://www.online-convert.com" target="_blank"><span class="elfinder-button-icon"></span>ONLINE-CONVERT.COM</a></div>',useTabs:!(!$.fn.tabs||t.UA.iOS)},n)},prepare:function(e,t,n){var i=e.editor.fm.getUI();$(e).height(i.height()),t.width=Math.max(t.width||0,.8*i.width())},init:function(e,t,n,i){var a,r,s=this,l=s.editor.confObj,c=l.set,d=i.getUI("toast"),p={},u=i.uploadMimeCheck("application/zip",t.phash),h=$("base").length?document.location.href.replace(/#.*$/,""):"",f=function(e,t){var n;return c.catExts[e]?c.catExts[e]:c.conv[e]&&(n=c.conv[e][t])?(n.ext||t).toLowerCase():t.toLowerCase()},m=function(e,t){var n,a;a=void 0===l.api?i.request({data:{cmd:"editor",name:"OnlineConvert",method:"init"},preventDefault:!0}):$.Deferred().resolve({api:l.api}),e=e.toLowerCase(),a.done(function(i){l.api=i.api,l.api&&(e?n="?category="+e:(n="",e="all"),l.conversions||(l.conversions={}),(l.conversions[e]?$.Deferred().resolve(l.conversions[e]):$.getJSON("https://api2.online-convert.com/conversions"+n)).done(function(n){l.conversions[e]=n,$.each(n,function(e,t){g[c.useTabs?"children":"find"](".onlineconvert-category-"+t.category).children(".onlineconvert-"+t.target).trigger("makeoption",t)}),t&&t()}))})},g=function(){var e=$("<div/>").on("click","button",function(){var e=$(this),t=e.data("opts")||null,n=e.closest(".onlineconvert-category").data("cname"),i=e.data("conv");!0===l.api&&x({category:n,convert:i,options:t})}).on("change",function(e){var t=$(e.target),n=t.parent(),a=t.closest(".elfinder-edit-onlineconvert-button").children("button:first"),o=a.data("opts")||{},r="boolean"===n.data("type")?t.is(":checked"):t.val();if(e.stopPropagation(),r&&("integer"===n.data("type")&&(r=parseInt(r)),n.data("pattern"))){var s=new RegExp(n.data("pattern"));s.test(r)||(requestAnimationFrame(function(){i.error('"'+i.escape(r)+'" is not match to "/'+i.escape(n.data("pattern"))+'/"')}),r=null)}r?o[t.parent().data("optkey")]=r:delete o[n.data("optkey")],a.data("opts",o)}),n=$("<ul/>"),a=function(e){var t=this,n=$('<span class="elfinder-button-icon elfinder-button-icon-preference"/>').on("click",function(){a.toggle()}),a=$('<div class="elfinder-edit-onlinconvert-options"/>').hide();e.options&&$.each(e.options,function(e,n){"download_password"!==e&&a.append(function(e,t){var n,a,o,r=$("<p/>").data("optkey",e).data("type",t.type),s="",l="",c=!1;t.description&&r.attr("title",i.i18n(t.description));t.pattern&&r.data("pattern",t.pattern);r.append($("<span/>").text(i.i18n(e)+" : ")),"boolean"===t.type?((t.default||(c="allow_multiple_outputs"===e&&!u))&&(s=" checked",c&&(l=" disabled"),a=this.children("button:first"),(n=a.data("opts")||{})[e]=!0,a.data("opts",n)),r.append($('<input type="checkbox" value="true"'+s+l+"/>"))):t.enum?(o=$("<select/>").append($('<option value=""/>').text("Select...")),$.each(t.enum,function(e,t){o.append($('<option value="'+t+'"/>').text(t))}),r.append(o)):r.append($('<input type="text" value=""/>'));return r}.call(t,e,n))}),t.append(n,a)},r=+new Date,s=0;return l.ext2mime||(l.ext2mime=Object.assign(i.arrayFlip(i.mimeTypes),o)),$.each(c.conv,function(o,c){var d=o.toLowerCase(),u="elfinder-edit-onlineconvert-"+d+r,m=$('<div id="'+u+'" class="onlineconvert-category onlineconvert-category-'+d+'"/>').data("cname",o);$.each(c,function(e,n){var r=e.toLowerCase(),s=f(o,e);l.ext2mime[s]||(l.ext2mime[s]="audio"===d||"image"===d||"video"===d?d+"/x-"+r:"application/octet-stream"),i.uploadMimeCheck(l.ext2mime[s],t.phash)&&m.append($('<div class="elfinder-edit-onlineconvert-button onlineconvert-'+r+'"/>').on("makeoption",function(e,t){var n=$(this);n.children(".elfinder-button-icon-preference").length||a.call(n,t)}).append($("<button/>").text(e).data("conv",e)))}),m.children().length&&(n.append($("<li/>").append($("<a/>").attr("href",h+"#"+u).text(o))),e.append(m),p[d]=s++)}),c.useTabs?e.prepend(n).tabs({beforeActivate:function(e,t){m(t.newPanel.data("cname"))}}):$.each(c.conv,function(t){var n=t.toLowerCase();e.append($('<fieldset class="onlineconvert-fieldset-'+n+'"/>').append($("<legend/>").text(t)).append(e.children(".onlineconvert-category-"+n)))}),e}(),v=$(this).append(g,c.showLink?$(c.link):null),b=$('<div class="elfinder-edit-spinner elfinder-edit-onlineconvert"/>').hide().html('<span class="elfinder-spinner-text">'+i.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(v.parent()),y=$('<div class="elfinder-quicklook-info-progress"/>').appendTo(b),w=null,x=function(e){$(s).data("dfrd",(w?$.Deferred().resolve(w):(b.show(),i.forExternalUrl(t.hash,{progressBar:y}).done(function(e){w=e}).fail(function(e){e&&i.error(e),s.elfinderdialog("destroy")}).always(function(){b.hide()}))).done(function(n){v.fadeOut(),C({info:"Start conversion request."}),i.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[category]":e.category.toLowerCase(),"args[convert]":e.convert.toLowerCase(),"args[options]":JSON.stringify(e.options),"args[source]":i.convAbsUrl(n),"args[filename]":i.splitFileExtention(t.name)[0]+"."+f(e.category,e.convert),"args[mime]":t.mime},preventDefault:!0}).done(function(t){k(t.apires,e.category,e.convert)}).fail(function(e){e&&i.error(e),s.elfinderdialog("destroy")})}))},k=function(e,t,n){var a,o=[];e&&e.id?"failed"===(a=e.status).code?(b.hide(),e.errors&&e.errors.length&&$.each(e.errors,function(e,t){t.message&&o.push(t.message)}),i.error(o.length?o:a.info),v.fadeIn()):"completed"===a.code?z(e):(C(a),setTimeout(function(){T(e.id)},1e3)):(d.appendTo(s.closest(".ui-dialog")),e.message&&i.toast({msg:i.i18n(e.message),mode:"error",timeOut:5e3,onHidden:function(){1===d.children().length&&d.appendTo(i.getUI())}}),i.toast({msg:i.i18n("editorConvNoApi"),mode:"error",timeOut:3e3,onHidden:function(){1===d.children().length&&d.appendTo(i.getUI())}}),b.hide(),v.show())},C=function(e){b.show().children(".elfinder-spinner-text").text(e.info)},T=function(e){i.request({data:{cmd:"editor",name:"OnlineConvert",method:"api","args[jobid]":e},preventDefault:!0}).done(function(e){k(e.apires)}).fail(function(e){e&&i.error(e),s.elfinderdialog("destroy")})},z=function(e){var n=e.output,a=(e.id,"");b.hide(),n&&n.length&&(s.elfinderdialog("destroy"),$.each(n,function(e,t){t.uri&&(a+=t.uri+"\n")}),i.upload({target:t.phash,files:[a],type:"text",extraData:{contentSaveId:"OnlineConvert-"+e.id}}))},j="document";v.parent().css({overflow:"auto"}).addClass("overflow-scrolling-touch"),(r=t.mime.match(/^(audio|image|video)/))&&(j=r[1]),c.useTabs?p[j]&&g.tabs("option","active",p[j]):(a=Object.keys(c.conv).length,$.each(c.conv,function(e){if(e.toLowerCase()===j)return m(e,function(){$.each(c.conv,function(e){e.toLowerCase()!==j&&m(e)})}),!1;a--}),a||$.each(c.conv,function(e){m(e)}),v.parent().scrollTop(g.children(".onlineconvert-fieldset-"+j).offset().top))},load:function(){},getContent:function(){},save:function(){},close:function(e){this.fm;var t=$(e).data("dfrd");t&&"pending"===t.state()&&t.reject()}}]}),e("skylark-elfinder/extras/quicklook.googledocs",["../elFinder","../commands/quicklook"],function(e){"use strict";try{e.prototype.commands.quicklook.plugins||(e.prototype.commands.quicklook.plugins=[]),e.prototype.commands.quicklook.plugins.push(function(e){var t=e.fm,n=e.preview;n.on("update",function(i){e.window;var a,o,r=i.file;0===r.mime.indexOf("application/vnd.google-apps.")&&("1"==r.url&&(n.hide(),$('<div class="elfinder-quicklook-info-data"><button class="elfinder-info-button">'+t.i18n("getLink")+"</button></div>").appendTo(e.info.find(".elfinder-quicklook-info")).on("click",function(){$(this).html('<span class="elfinder-spinner">'),t.request({data:{cmd:"url",target:r.hash},preventDefault:!0}).always(function(){n.show(),$(this).html("")}).done(function(i){var a=t.file(r.hash);e.value.url=a.url=i.url||"",e.value.url&&n.trigger($.Event("update",{file:e.value}))})})),""!==r.url&&"1"!=r.url&&(i.stopImmediatePropagation(),o=$('<div class="elfinder-quicklook-info-data"><span class="elfinder-spinner-text">'+t.i18n("nowLoading")+'</span><span class="elfinder-spinner"/></div>').appendTo(e.info.find(".elfinder-quicklook-info")),a=$('<iframe class="elfinder-quicklook-preview-iframe"/>').css("background-color","transparent").on("load",function(){e.hideinfo(),o.remove(),a.css("background-color","#fff")}).on("error",function(){o.remove(),a.remove()}).appendTo(n).attr("src",t.url(r.hash)),n.one("change",function(){o.remove(),a.off("load").remove()})))})})}catch(e){}return e}),e("skylark-elfinder/main",["skylark-jqueryui","./elFinder","./version","./jquery.elfinder","./mimetypes","./options","./options.netmount","./history","./command","./resources","./jquery.dialogelfinder","./i18n/elfinder.en","./ui/button","./ui/contextmenu","./ui/cwd","./ui/dialog","./ui/fullscreenbutton","./ui/navbar","./ui/navdock","./ui/overlay","./ui/panel","./ui/path","./ui/places","./ui/searchbutton","./ui/sortbutton","./ui/stat","./ui/toast","./ui/toolbar","./ui/tree","./ui/uploadButton","./ui/viewbutton","./ui/workzone","./commands/archive","./commands/back","./commands/chmod","./commands/colwidth","./commands/copy","./commands/cut","./commands/download","./commands/duplicate","./commands/edit","./commands/empty","./commands/extract","./commands/forward","./commands/fullscreen","./commands/getfile","./commands/help","./commands/hidden","./commands/hide","./commands/home","./commands/info","./commands/mkdir","./commands/mkfile","./commands/netmount","./commands/open","./commands/opendir","./commands/opennew","./commands/paste","./commands/places","./commands/preference","./commands/quicklook","./commands/quicklook.plugins","./commands/reload","./commands/rename","./commands/resize","./commands/restore","./commands/rm","./commands/search","./commands/selectall","./commands/selectinvert","./commands/selectnone","./commands/sort","./commands/undo","./commands/up","./commands/upload","./commands/view","./proxy/elFinderSupportVer1","./extras/editors.default","./extras/quicklook.googledocs"],function(e,t){return t}),e("skylark-elfinder",["skylark-elfinder/main"],function(e){return e})}(n,require),!i){var r=require("skylark-langx/skylark");a?module.exports=r:t.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-elfinder.js.map
