/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(e){return e.prototype.commands.empty=function(){"use strict";var e,t,n=function(n){var r=e.files(n);return r.length||(r=[t.cwd()]),r};this.linkedCmds=["rm"],this.init=function(){e=this,t=this.fm},this.getstate=function(e){var t,r=n(e);return t=r.length,$.grep(r,function(e){return!(!e.read||!e.write||"directory"!==e.mime)}).length==t?0:-1},this.exec=function(e){var r=n(e),i=r.length,a=$.Deferred().done(function(){var e={changed:{}};t.toast({msg:t.i18n(['"'+o.join('", ')+'"',"complete",t.i18n("cmdempty")])}),$.each(r,function(t,n){e.changed[n.hash]=n}),t.change(e)}).always(function(){var e=t.cwd().hash;t.trigger("selectfiles",{files:$.map(r,function(t){return e===t.phash?t.hash:null})})}),o=[],s=function(e){"number"==typeof e?(o.push(r[e].name),delete r[e].dirs):e&&t.error(e),--i<1&&a[o.length?"resolve":"reject"]()};return $.each(r,function(e,n){var r;return n.write&&"directory"===n.mime?t.isCommandEnabled("rm",n.hash)?(r=setTimeout(function(){t.notify({type:"search",cnt:1,hideCnt:!(i>1)})},t.notifyDelay),void t.request({data:{cmd:"open",target:n.hash},preventDefault:!0,asNotOpen:!0}).done(function(a){var o=[];r&&clearTimeout(r),t.ui.notify.children(".elfinder-notify-search").length&&t.notify({type:"search",cnt:-1,hideCnt:!(i>1)}),a&&a.files&&a.files.length?a.files.length>t.maxTargets?s(["errEmpty",n.name,"errMaxTargets",t.maxTargets]):(t.updateCache(a),$.each(a.files,function(e,t){if(!t.write||t.locked)return s(["errEmpty",n.name,"errRm",t.name,"errPerm"]),o=[],!1;o.push(t.hash)}),o.length&&t.exec("rm",o,{_userAction:!0,addTexts:[t.i18n("folderToEmpty",n.name)]}).fail(function(e){t.trigger("unselectfiles",{files:t.selected()}),s(t.parseError(e)||"")}).done(function(){s(e)})):(t.toast({mode:"warning",msg:t.i18n("filderIsEmpty",n.name)}),s(""))}).fail(function(e){s(t.parseError(e)||"")})):(s(["errCmdNoSupport",'"rm"']),null):(s(["errEmpty",n.name,"errPerm"]),null)}),a}},e});
//# sourceMappingURL=../sourcemaps/commands/empty.js.map
