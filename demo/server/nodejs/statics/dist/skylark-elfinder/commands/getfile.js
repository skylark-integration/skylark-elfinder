/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(t){return(t.prototype.commands.getfile=function(){"use strict";var t=this,e=this.fm;this.alwaysEnabled=!0,this.callback=e.options.getFileCallback,this._disabled="function"==typeof this.callback,this.getstate=function(e){var i,n,r=this.files(e),o=r.length;return this.callback&&o&&(i=r,n=t.options,i=$.grep(i,function(t){return!("directory"==t.mime&&!n.folders||!t.read)}),n.multiple||1==i.length?i:[]).length==o?0:-1},this.exec=function(e){var i,n,r,o=this.fm,l=this.options,h=this.files(e),a=h.length,s=o.option("url"),u=o.option("tmbUrl"),c=$.Deferred().done(function(e){var i,n=function(){"close"==l.oncomplete?o.hide():"destroy"==l.oncomplete&&o.destroy()},r=function(t){"close"==l.onerror?o.hide():"destroy"==l.onerror?o.destroy():t&&o.error(t)};o.trigger("getfile",{files:e});try{i=t.callback(e,o)}catch(t){return void r(["Error in `getFileCallback`.",t.message])}"object"==typeof i&&"function"==typeof i.done?i.done(n).fail(r):n()}),f=function(t){return l.onlyURL?l.multiple?$.map(h,function(t){return t.url}):h[0].url:l.multiple?h:h[0]},d=[];for(i=0;i<a;i++){if("directory"==(n=h[i]).mime&&!l.folders)return c.reject();n.baseUrl=s,"1"==n.url?d.push(o.request({data:{cmd:"url",target:n.hash},notify:{type:"url",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(t){t.url&&(o.file(this.hash).url=this.url=t.url)}.bind(n))):n.url=o.url(n.hash),l.onlyURL||(l.getPath&&(n.path=o.path(n.hash),""===n.path&&n.phash&&function(){var t=$.Deferred();d.push(t),o.path(n.hash,!1,{}).done(function(t){n.path=t}).fail(function(){n.path=""}).always(function(){t.resolve()})}()),n.tmb&&1!=n.tmb&&(n.tmb=u+n.tmb),n.width||n.height||(n.dim?(r=n.dim.split("x"),n.width=r[0],n.height=r[1]):l.getImgSize&&-1!==n.mime.indexOf("image")&&d.push(o.request({data:{cmd:"dim",target:n.hash},notify:{type:"dim",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(t){if(t.dim){var e=t.dim.split("x"),i=o.file(this.hash);i.width=this.width=e[0],i.height=this.height=e[1]}}.bind(n)))))}return d.length?($.when.apply(null,d).always(function(){c.resolve(f())}),c):c.resolve(f())}}).prototype={forceLoad:!0},t});
//# sourceMappingURL=../sourcemaps/commands/getfile.js.map
