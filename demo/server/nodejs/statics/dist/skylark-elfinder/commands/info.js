/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(e){return(e.prototype.commands.info=function(){"use strict";var e=this.fm,i="elfinder-spinner",n={calc:e.i18n("calc"),size:e.i18n("size"),unknown:e.i18n("unknown"),path:e.i18n("path"),aliasfor:e.i18n("aliasfor"),modify:e.i18n("modify"),perms:e.i18n("perms"),locked:e.i18n("locked"),dim:e.i18n("dim"),kind:e.i18n("kind"),files:e.i18n("files"),folders:e.i18n("folders"),roots:e.i18n("volumeRoots"),items:e.i18n("items"),yes:e.i18n("yes"),no:e.i18n("no"),link:e.i18n("link"),owner:e.i18n("owner"),group:e.i18n("group"),perm:e.i18n("perm"),getlink:e.i18n("getLink")},t=function(e,i){return i?e.replace(/\u200B/g,""):e.replace(/(\/|\\)/g,"$1â€‹")};this.items=["size","aliasfor","path","link","dim","modify","perms","locked","owner","group","perm"],this.options.custom&&Object.keys(this.options.custom).length&&$.each(this.options.custom,function(e,i){i.label&&this.items.push(i.label)}),this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title {dirclass}"><span class="elfinder-cwd-icon {class} ui-corner-all"{style}/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:'<tr><td class="elfinder-info-label">{label} : </td><td class="{class}">{value}</td></tr>',spinner:'<span>{text}</span> <span class="'+i+" "+i+'-{name}"/>'},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+i"}],this.init=function(){$.each(n,function(i,t){n[i]=e.i18n(t)})},this.getstate=function(){return 0},this.exec=function(e){var a=this.files(e);a.length||(a=this.files([this.fm.cwd().hash]));var r,l,s,o,c,p,h,u,f,d=this.fm,m=this.options,g=this.tpl,k=g.row,w=a.length,y=[],z=g.main,b="{label}",v="{value}",x=[],j=null,D={title:d.i18n("selectionInfo"),width:"auto",close:function(){$(this).elfinderdialog("destroy"),j&&"pending"===j.state()&&j.reject(),$.grep(x,function(e){e&&"pending"===e.state()&&e.reject()})}},S=[],T=function(e,n,t){I.find("."+i+"-"+n).parent().html(e).addClass(t||"")},H=d.namespace+"-info-"+$.map(a,function(e){return e.hash}).join("-"),I=d.getUI().find("#"+H),O=[],C="",M="elfinder-font-mono elfinder-info-hash",R=[],q=d.ui.notify;if(q.is(":hidden")&&q.children(".elfinder-notify").length&&q.elfinderdialog("open").height("auto"),!w)return $.Deferred().reject();if(I.length)return I.elfinderdialog("toTop"),$.Deferred().resolve();if(u=d.storage("infohides")||d.arrayFlip(m.hideItems,!0),1===w){if((s=a[0]).icon&&(C=" "+d.getIconStyle(s)),z=z.replace("{dirclass}",s.csscls?d.escape(s.csscls):"").replace("{class}",d.mime2class(s.mime)).replace("{style}",C),o=g.itemTitle.replace("{name}",d.escape(s.i18||s.name)).replace("{kind}",'<span title="'+d.escape(s.mime)+'">'+d.mime2kind(s)+"</span>"),l=d.tmb(s),s.read?"directory"!=s.mime||s.alias?r=d.formatSize(s.size):(r=g.spinner.replace("{text}",n.calc).replace("{name}","size"),S.push(s.hash)):r=n.unknown,!u.size&&y.push(k.replace(b,n.size).replace(v,r)),!u.aleasfor&&s.alias&&y.push(k.replace(b,n.aliasfor).replace(v,s.alias)),u.path||((h=d.path(s.hash,!0))?y.push(k.replace(b,n.path).replace(v,t(d.escape(h))).replace("{class}","elfinder-info-path")):(y.push(k.replace(b,n.path).replace(v,g.spinner.replace("{text}",n.calc).replace("{name}","path")).replace("{class}","elfinder-info-path")),x.push(d.path(s.hash,!0,{notify:null}).fail(function(){T(n.unknown,"path")}).done(function(e){T(t(e),"path")})))),!u.link&&s.read){var A,B=d.escape(s.name);if("1"==s.url)y.push(k.replace(b,n.link).replace(v,'<button class="elfinder-info-button '+i+'-url">'+n.getlink+"</button>"));else{if(s.url)A=s.url;else if("directory"===s.mime)if(m.nullUrlDirLinkSelf&&null===s.url){var F=window.location;A=F.pathname+F.search+"#elf_"+s.hash}else""!==s.url&&d.option("url",!d.isRoot(s)&&s.phash||s.hash)&&(A=d.url(s.hash));else A=d.url(s.hash);A&&y.push(k.replace(b,n.link).replace(v,'<a href="'+A+'" target="_blank">'+B+"</a>"))}}u.dim||(s.dim?y.push(k.replace(b,n.dim).replace(v,s.dim)):-1!==s.mime.indexOf("image")&&(s.width&&s.height?y.push(k.replace(b,n.dim).replace(v,s.width+"x"+s.height)):(y.push(k.replace(b,n.dim).replace(v,g.spinner.replace("{text}",n.calc).replace("{name}","dim"))),x.push(d.request({data:{cmd:"dim",target:s.hash},preventDefault:!0}).fail(function(){T(n.unknown,"dim")}).done(function(e){if(T(e.dim||n.unknown,"dim"),e.dim){var i=e.dim.split("x"),t=d.file(s.hash);t.width=i[0],t.height=i[1]}}))))),!u.modify&&y.push(k.replace(b,n.modify).replace(v,d.formatDate(s))),!u.perms&&y.push(k.replace(b,n.perms).replace(v,d.formatPermissions(s))),!u.locked&&y.push(k.replace(b,n.locked).replace(v,s.locked?n.yes:n.no)),!u.owner&&s.owner&&y.push(k.replace(b,n.owner).replace(v,s.owner)),!u.group&&s.group&&y.push(k.replace(b,n.group).replace(v,s.group)),!u.perm&&s.perm&&y.push(k.replace(b,n.perm).replace(v,d.formatFileMode(s.perm))),window.ArrayBuffer&&(d.options.cdns.sparkmd5||d.options.cdns.jssha)&&"directory"!==s.mime&&s.size>0&&(!m.showHashMaxsize||s.size<=m.showHashMaxsize)&&(R=[],$.each(d.storage("hashchekcer")||m.showHashAlgorisms,function(e,i){s[i]?y.push(k.replace(b,d.i18n(i)).replace(v,s[i]).replace("{class}",M)):(y.push(k.replace(b,d.i18n(i)).replace(v,g.spinner.replace("{text}",n.calc).replace("{name}",i))),R.push(i))}),R.length&&(f=$('<div class="elfinder-quicklook-info-progress"/>'),x.push(d.getContentsHashes(s.hash,R,m.showHashOpts,{progressBar:f}).progress(function(e){$.each(R,function(i,n){e[n]&&T(e[n],n,M)})}).always(function(){$.each(R,function(e,i){T(n.unknown,i)})})))),m.custom&&$.each(m.custom,function(e,i){u[i.label]||i.mimes&&!$.grep(i.mimes,function(e){return s.mime===e||0===s.mime.indexOf(e+"/")}).length||i.hashRegex&&!s.hash.match(i.hashRegex)||(y.push(k.replace(b,d.i18n(i.label)).replace(v,i.tpl.replace("{id}",H))),i.action&&"function"==typeof i.action&&O.push(i.action))})}else z=z.replace("{class}","elfinder-cwd-icon-group"),o=g.groupTitle.replace("{items}",n.items).replace("{num}",w),(c=$.grep(a,function(e){return"directory"==e.mime}).length)?(c-=p=$.grep(a,function(e){return!("directory"!==e.mime||e.phash&&!e.isroot)}).length,y.push(k.replace(b,n.kind).replace(v,p===w||c===w?n[p?"roots":"folders"]:$.map({roots:p,folders:c,files:w-p-c},function(e,i){return e?n[i]+" "+e:null}).join(", "))),!u.size&&y.push(k.replace(b,n.size).replace(v,g.spinner.replace("{text}",n.calc).replace("{name}","size"))),S=$.map(a,function(e){return e.hash})):(r=0,$.each(a,function(e,i){var n=parseInt(i.size);n>=0&&r>=0?r+=n:r="unknown"}),y.push(k.replace(b,n.kind).replace(v,n.files)),!u.size&&y.push(k.replace(b,n.size).replace(v,d.formatSize(r))));return z=z.replace("{title}",o).replace("{content}",y.join("").replace(/{class}/g,"")),(I=this.fmDialog(z,D)).attr("id",H).one("mousedown",".elfinder-info-path",function(){$(this).html(t($(this).html(),!0))}),R.length&&f.appendTo(I.find("."+i+"-"+R[0]).parent()),d.UA.Mobile&&$.fn.tooltip&&I.children(".ui-dialog-content .elfinder-info-title").tooltip({classes:{"ui-tooltip":"elfinder-ui-tooltip ui-widget-shadow"},tooltipClass:"elfinder-ui-tooltip ui-widget-shadow",track:!0}),s&&"1"==s.url&&I.on("click","."+i+"-url",function(){$(this).parent().html(g.spinner.replace("{text}",d.i18n("ntfurl")).replace("{name}","url")),d.request({data:{cmd:"url",target:s.hash},preventDefault:!0}).fail(function(){T(B,"url")}).done(function(e){e.url?(T('<a href="'+e.url+'" target="_blank">'+B+"</a>"||B,"url"),d.file(s.hash).url=e.url):T(B,"url")})}),l&&$("<img/>").on("load",function(){I.find(".elfinder-cwd-icon").addClass(l.className).css("background-image","url('"+l.url+"')")}).attr("src",l.url),S.length&&(j=d.getSize(S).done(function(e){T(e.formated,"size")}).fail(function(){T(n.unknown,"size")})),O.length&&$.each(O,function(e,i){try{i(s,d,I)}catch(e){d.debug("error",e)}}),$.Deferred().resolve()}}).prototype={forceLoad:!0},e});
//# sourceMappingURL=../sourcemaps/commands/info.js.map
