/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(e){return e.prototype.commands.paste=function(){"use strict";this.updateOnSelect=!1,this.handlers={changeclipboard:function(){this.update()}},this.shortcuts=[{pattern:"ctrl+v shift+insert"}],this.getstate=function(e){if(this._disabled)return-1;if(e){if(Array.isArray(e)){if(1!=e.length)return-1;e=this.fm.file(e[0])}}else e=this.fm.cwd();return this.fm.clipboard().length&&"directory"==e.mime&&e.write?0:-1},this.exec=function(e,n){var t,a,r,c=this,i=c.fm,o=n||{},s=e?this.files(e)[0]:i.cwd(),h=i.clipboard(),l=h.length,u=!!l&&h[0].cut,f=o._cmd?o._cmd:u?"move":"copy",m="err"+f.charAt(0).toUpperCase()+f.substr(1),d=[],p=[],v=$.Deferred().fail(function(e){e&&i.error(e)}).always(function(){i.unlockfiles({files:$.map(h,function(e){return e.hash})})});return l&&s&&"directory"==s.mime?s.write?(t=i.parents(s.hash),$.each(h,function(e,n){return n.read?u&&n.locked?!v.reject(["errLocked",n.name]):-1!==$.inArray(n.hash,t)?!v.reject(["errCopyInItself",n.name]):n.mime&&"directory"!==n.mime&&!i.uploadMimeCheck(n.mime,s.hash)?!v.reject([m,n.name,"errUploadMime"]):((a=i.parents(n.hash)).pop(),-1!==$.inArray(s.hash,a)&&$.grep(a,function(e){var t=i.file(e);return t.phash==s.hash&&t.name==n.name}).length?!v.reject(["errReplByChild",n.name]):void(n.phash==s.hash?p.push(n.hash):d.push({hash:n.hash,phash:n.phash,name:n.name}))):!v.reject([m,n.name,"errPerm"])}),"rejected"===v.state()?v:(r=$.Deferred(),u&&c.options.moveConfirm?i.confirm({title:"moveFiles",text:i.i18n("confirmMove",s.i18||s.name),accept:{label:"btnYes",callback:function(){r.resolve()}},cancel:{label:"btnCancel",callback:function(){r.reject()}}}):r.resolve(),r.done(function(){var e;$.when((e=p,e.length&&i._commands.duplicate?i.exec("duplicate",e):$.Deferred().resolve()),function(e){var n,t=$.Deferred(),a=[],r={},h=function(e,n){for(var t=[],a=e.length;a--;)-1!==$.inArray(e[a].name,n)&&t.unshift(a);return t},l=function(n){var r=a[n],c=e[r],o=n==a.length-1;c&&i.confirm({title:i.i18n(f+"Files"),text:["errExists",c.name,"restore"===f?"confirmRest":"confirmRepl"],all:!o,accept:{label:"btnYes",callback:function(t){o||t?d(e):l(++n)}},reject:{label:"btnNo",callback:function(t){var r;if(t)for(r=a.length;n<r--;)e[a[r]].remove=!0;else e[a[n]].remove=!0;o||t?d(e):l(++n)}},cancel:{label:"btnCancel",callback:function(){t.resolve()}},buttons:[{label:"btnBackup",callback:function(t){var r;if(t)for(r=a.length;n<r--;)e[a[r]].rename=!0;else e[a[n]].rename=!0;o||t?d(e):l(++n)}}]})},m=function(n){var t,c={};n&&(Array.isArray(n)?n.length&&("string"==typeof n[0]?a=h(e,n):($.each(n,function(e,n){c[n.name]=n.hash}),a=h(e,$.map(c,function(e,n){return n})),$.each(e,function(e,n){c[n.name]&&(r[c[n.name]]=n.name)}))):(t=[],a=$.map(n,function(e){return"string"==typeof e?e:(t=t.concat(e),!1)}),t.length&&(a=a.concat(t)),a=h(e,a),r=n)),a.length?l(0):d(e)},d=function(e){var n,a,c=[],h=$.grep(e,function(e){return e.rename&&c.push(e.name),!e.remove}),l=h.length;if(!l)return t.resolve();n=$.map(h,function(e){return e.hash}),a={cmd:"paste",dst:s.hash,targets:n,cut:u?1:0,renames:c,hashes:r,suffix:i.options.backupSuffix},i.api<2.1&&(a.src=h[0].phash),i.request({data:a,notify:{type:f,cnt:l},cancel:!0,navigate:{toast:o.noToast?{}:{inbuffer:{msg:i.i18n(["complete",i.i18n("cmd"+f)]),action:{cmd:"open",msg:"cmdopendir",data:[s.hash],done:"select",cwdNot:s.hash}}}}}).done(function(e){var n={},r=e.added&&e.added.length?e.added:null;u&&r&&($.each(h,function(e,t){var a,c,i=t.phash,o=(a=t.name,$.each(r,function(e,n){if(n.name===a)return c=n.hash,!1}),c);o&&(n[i]?n[i].push(o):n[i]=[o])}),Object.keys(n).length&&(e.undo={cmd:"move",callback:function(){var e=[];return $.each(n,function(n,t){e.push(i.request({data:{cmd:"paste",dst:n,targets:t,cut:1},notify:{type:"undo",cnt:t.length}}))}),$.when.apply(null,e)}},e.redo={cmd:"move",callback:function(){return i.request({data:a,notify:{type:"redo",cnt:l}})}})),t.resolve(e)}).fail(function(e){t.reject(),0===e&&i.sync()}).always(function(){i.unlockfiles({files:h})})};return i.isCommandEnabled(c.name,s.hash)&&e.length?(i.oldAPI?d(e):i.option("copyOverwrite",s.hash)?(n=$.map(e,function(e){return e.name}),s.hash==i.cwd().hash?m($.map(i.files(),function(e){return e.phash==s.hash?{hash:e.hash,name:e.name}:null})):i.request({data:{cmd:"ls",target:s.hash,intersect:n},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(e){m(e.list)})):d(e),t):t.resolve()}(d)).done(function(e,n){v.resolve(n&&n.undo?n:void 0)}).fail(function(){v.reject()}).always(function(){u&&i.clipboard([])})}).fail(function(){v.reject()}),v)):v.reject([m,h[0].name,"errPerm"]):v.reject()}},e});
//# sourceMappingURL=../sourcemaps/commands/paste.js.map
