/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define([],function(){window.elFinderSupportVer1=function(e){"use strict";var r,a,t,i=this,n=function(e){return e.replace("Today",a).replace("Yesterday",t)};r=new Date,a=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate(),r=new Date(Date.now()-864e5),t=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate(),this.upload=e||"auto",this.init=function(e){this.fm=e,this.fm.parseUploadData=function(e){var r;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{r=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return i.normalize("upload",r)}},this.send=function(e){var r,a,t=this,i=this.fm,n=$.Deferred(),d=e.data.cmd,s={};switch(n.abort=function(){"pending"==a.state()&&(a.quiet=!0,a.abort())},d){case"open":e.data.tree=1;break;case"parents":case"tree":return n.resolve({tree:[]});case"get":e.data.cmd="read",e.data.current=i.file(e.data.target).phash;break;case"put":e.data.cmd="edit",e.data.current=i.file(e.data.target).phash;break;case"archive":case"rm":e.data.current=i.file(e.data.targets[0]).phash;break;case"extract":case"rename":case"resize":e.data.current=i.file(e.data.target).phash;break;case"duplicate":return s=$.extend(!0,{},e),$.each(e.data.targets,function(e,r){$.ajax(Object.assign(s,{data:{cmd:"duplicate",target:r,current:i.file(r).phash}})).fail(function(e){i.error(i.res("error","connect"))}).done(function(e){(e=t.normalize("duplicate",e)).error?i.error(e.error):e.added&&i.trigger("add",{added:e.added})})}),n.resolve({});case"mkdir":case"mkfile":e.data.current=e.data.target;break;case"paste":e.data.current=e.data.dst,e.data.tree||$.each(e.data.targets,function(r,a){if(i.file(a)&&"directory"===i.file(a).mime)return e.data.tree="1",!1});break;case"size":case"search":return n.resolve({error:i.res("error","cmdsupport")});case"file":e.data.cmd="open",e.data.current=i.file(e.data.target).phash}return a=$.ajax(e).fail(function(e){n.reject(e)}).done(function(e){r=t.normalize(d,e),n.resolve(r)}),n},this.normalize=function(e,r){var a,t,i,d,s=this,o=this.fm,c={},h=function(e){return $.grep(e,function(e){return!(!e||!e.mime||"directory"!==e.mime)})};return"tmb"==e||"get"==e?r:("upload"==e&&r.error&&r.cwd&&(r.warning=Object.assign({},r.error),r.error=!1),r.error?r:"put"==e?(a=o.file(r.target.hash).phash,{changed:[this.normalizeFile(r.target,a)]}):(i=(a=r.cwd.hash)==o.cwd().hash,r.tree&&$.each(this.normalizeTree(r.tree),function(e,r){c[r.hash]=r}),$.each(r.cdc||[],function(e,t){var i,d=t.hash;c[d]?(t.date&&((i=Date.parse(n(t.date)))&&!isNaN(i)?c[d].ts=Math.floor(i/1e3):c[d].date=t.date||o.formatDate(t)),c[d].locked=t.hash==a||void 0!==t.rm&&!t.rm):c[d]=s.normalizeFile(t,a,r.tmb)}),r.tree||$.each(o.files(),function(e,r){c[e]||r.phash==a||"directory"!=r.mime||(c[e]=r)}),"open"==e?{cwd:c[a]||this.normalizeFile(r.cwd),files:$.map(c,function(e){return e}),options:s.normalizeOptions(r),init:!!r.params,debug:r.debug}:(i?t=o.diff($.map(c,function(e){return e&&e.hash&&e.name&&e.mime?e:null})):r.tree&&"paste"!==e?t=function(e){var r=h(e);if((d=o.diff(r,null,["date","ts"])).added.length&&(d.added=h(d.added)),d.changed.length&&(d.changed=h(d.changed)),d.removed.length){var a=[];$.each(d.removed,function(e,r){var t;(t=o.file(r))&&"directory"===t.mime&&a.push(r)}),d.removed=a}return d}(c):(t={added:[],removed:[],changed:[]},"paste"===e&&(t.sync=!0)),Object.assign({current:r.cwd.hash,error:r.error,warning:r.warning,options:{tmb:!!r.tmb}},t))))},this.normalizeTree=function(e){var r=this,a=[],t=function(e,i){var n,d;for(n=0;n<e.length;n++)d=e[n],a.push(r.normalizeFile(d,i)),d.dirs.length&&t(d.dirs,d.hash)};return t([e]),a},this.normalizeFile=function(e,r,a){var t=e.mime||"directory",i="directory"!=t||e.linkTo?e.size:0,d=e.date?Date.parse(n(e.date)):void 0,s={url:e.url,hash:e.hash,phash:r,name:e.name,mime:t,ts:e.ts,size:i,read:e.read,write:e.write,locked:!r||void 0!==e.rm&&!e.rm};return s.ts||(d&&!isNaN(d)?s.ts=Math.floor(d/1e3):s.date=e.date||this.fm.formatDate(e)),"application/x-empty"!=e.mime&&"inode/x-empty"!=e.mime||(s.mime="text/plain"),e.linkTo&&(s.alias=e.linkTo),e.linkTo&&(s.linkTo=e.linkTo),e.tmb?s.tmb=e.tmb:0===s.mime.indexOf("image/")&&a&&(s.tmb=1),e.dirs&&e.dirs.length&&(s.dirs=!0),e.dim&&(s.dim=e.dim),e.resize&&(s.resize=e.resize),s},this.normalizeOptions=function(e){var r={path:e.cwd.rel,disabled:$.merge(e.disabled||[],["search","netmount","zipdl"]),tmb:!!e.tmb,copyOverwrite:!0};return e.params&&(r.api=1,r.url=e.params.url,r.archivers={create:e.params.archives||[],extract:e.params.extract||[]}),-1!==r.path.indexOf("/")?r.separator="/":-1!==r.path.indexOf("\\")&&(r.separator="\\"),r}}});
//# sourceMappingURL=../sourcemaps/proxy/elFinderSupportVer1.js.map
