{"version":3,"sources":["commands/download.js"],"names":["define","elFinder","prototype","commands","zipdl","download","self","this","fm","czipdl","zipOn","mixed","dlntf","cpath","window","location","pathname","filter","hashes","inExec","volumeid","mixedCmd","searchStatus","state","leafRoots","cwd","hash","$","each","i","h","indexOf","isCommandEnabled","grep","f","file","res","mime","cwdHash2Elm","trigger","length","files","read","linkedCmds","shortcuts","pattern","getstate","select","sel","cnt","maxReq","options","maxRequests","UA","IE","Mobile","bind","e","targets","node","helper","getExtra","link","url","icon","attr","href","target","title","i18n","text","name","on","stopPropagation","tmb","dt","dataTransfer","originalEvent","effectAllowed","setDragImage","append","mime2class","addClass","className","css","get","outerHTML","appendTo","document","body","setData","phash","getData","remove","extra","data","draggable","type","touches","parent","preventDefault","removeClass","request","cmd","always","replaceWith","ready","requestAnimationFrame","one","api","getCommand","cookieEnabled","isCORS","exec","html5dl","fileCnt","ntftm","reqid","getUrlDfrd","urls","dfrd","Deferred","iframes","linkdl","click","a","clickEv","MouseEvent","createEvent","initMouseEvent","pauseUnloadCheck","dispatchEvent","checkCookie","id","cookie","split","clearTimeout","closeNotify","setTimeout","ui","notify","children","reqids","reject","hide","minFilesZipdl","p","push","Object","keys","map","sequence","t","dir","dlName","dfd","root","single","volName","i18","d","hideCnt","msg","cancel","eachCancel","done","dialog","dllink","form","iframe","m","btn","uniq","Date","zipdlFn","escape","resolve","elfinderdialog","fmDialog","buttons","width","destroyOnClose","close","error","splitFileExtention","Safari","isSameOrigin","key","val","encodeURIComponent","customData","hasParrotHeaders","getBinaryByUrl","blob","Blob","URL","webkitURL","createObjectURL","submit","fail","promise","substr","getRequestId","Edge","notifyDelay","open","cleaerTimeout","openUrl","v"],"mappings":"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","file":"../../commands/download.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.zipdl = function() {};\n\telFinder.prototype.commands.download = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\t\tfm     = this.fm,\n\t\t\tczipdl = null,\n\t\t\tzipOn  = false,\n\t\t\tmixed  = false,\n\t\t\tdlntf  = false,\n\t\t\tcpath  = window.location.pathname || '/',\n\t\t\tfilter = function(hashes, inExec) {\n\t\t\t\tvar volumeid, mixedCmd;\n\t\t\t\t\n\t\t\t\tif (czipdl !== null) {\n\t\t\t\t\tif (fm.searchStatus.state > 1) {\n\t\t\t\t\t\tmixed = fm.searchStatus.mixed;\n\t\t\t\t\t} else if (fm.leafRoots[fm.cwd().hash]) {\n\t\t\t\t\t\tvolumeid = fm.cwd().volumeid;\n\t\t\t\t\t\t$.each(hashes, function(i, h) {\n\t\t\t\t\t\t\tif (h.indexOf(volumeid) !== 0) {\n\t\t\t\t\t\t\t\tmixed = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tzipOn = (fm.isCommandEnabled('zipdl', hashes[0]));\n\t\t\t\t}\n\n\t\t\t\tif (mixed) {\n\t\t\t\t\tmixedCmd = czipdl? 'zipdl' : 'download';\n\t\t\t\t\thashes = $.grep(hashes, function(h) {\n\t\t\t\t\t\tvar f = fm.file(h),\n\t\t\t\t\t\t\tres = (! f || (! czipdl && f.mime === 'directory') || ! fm.isCommandEnabled(mixedCmd, h))? false : true;\n\t\t\t\t\t\tif (f && inExec && ! res) {\n\t\t\t\t\t\t\tfm.cwdHash2Elm(f.hash).trigger('unselect');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t});\n\t\t\t\t\tif (! hashes.length) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!fm.isCommandEnabled('download', hashes[0])) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn $.grep(self.files(hashes), function(f) { \n\t\t\t\t\tvar res = (! f.read || (! zipOn && f.mime == 'directory')) ? false : true;\n\t\t\t\t\tif (inExec && ! res) {\n\t\t\t\t\t\tfm.cwdHash2Elm(f.hash).trigger('unselect');\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t});\n\t\t\t};\n\t\t\n\t\tthis.linkedCmds = ['zipdl'];\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'shift+enter'\n\t\t}];\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel    = this.hashes(select),\n\t\t\t\tcnt    = sel.length,\n\t\t\t\tmaxReq = this.options.maxRequests || 10,\n\t\t\t\tmixed  = false,\n\t\t\t\tcroot  = '';\n\t\t\t\n\t\t\tif (cnt < 1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tcnt = filter(sel).length;\n\t\t\t\n\t\t\treturn  (cnt && (zipOn || (cnt <= maxReq && ((!fm.UA.IE && !fm.UA.Mobile) || cnt == 1))) ? 0 : -1);\n\t\t};\n\t\t\n\t\tfm.bind('contextmenu', function(e){\n\t\t\tvar fm = self.fm,\n\t\t\t\thelper = null,\n\t\t\t\ttargets, file, link,\n\t\t\t\tgetExtra = function(file) {\n\t\t\t\t\tvar link = file.url || fm.url(file.hash);\n\t\t\t\t\treturn {\n\t\t\t\t\t\ticon: 'link',\n\t\t\t\t\t\tnode: $('<a/>')\n\t\t\t\t\t\t\t.attr({href: link, target: '_blank', title: fm.i18n('link')})\n\t\t\t\t\t\t\t.text(file.name)\n\t\t\t\t\t\t\t.on('mousedown click touchstart touchmove touchend contextmenu', function(e){\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragstart', function(e) {\n\t\t\t\t\t\t\t\tvar dt = e.dataTransfer || e.originalEvent.dataTransfer || null;\n\t\t\t\t\t\t\t\thelper = null;\n\t\t\t\t\t\t\t\tif (dt) {\n\t\t\t\t\t\t\t\t\tvar icon  = function(f) {\n\t\t\t\t\t\t\t\t\t\t\tvar mime = f.mime, i, tmb = fm.tmb(f);\n\t\t\t\t\t\t\t\t\t\t\ti = '<div class=\"elfinder-cwd-icon '+fm.mime2class(mime)+' ui-corner-all\"/>';\n\t\t\t\t\t\t\t\t\t\t\tif (tmb) {\n\t\t\t\t\t\t\t\t\t\t\t\ti = $(i).addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\").get(0).outerHTML;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tdt.effectAllowed = 'copyLink';\n\t\t\t\t\t\t\t\t\tif (dt.setDragImage) {\n\t\t\t\t\t\t\t\t\t\thelper = $('<div class=\"elfinder-drag-helper html5-native\">').append(icon(file)).appendTo($(document.body));\n\t\t\t\t\t\t\t\t\t\tdt.setDragImage(helper.get(0), 50, 47);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!fm.UA.IE) {\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom', window.location.href + file.phash);\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom:' + dt.getData('elfinderfrom'), '');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragend', function(e) {\n\t\t\t\t\t\t\t\thelper && helper.remove();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\tself.extra = null;\n\t\t\tif (e.data) {\n\t\t\t\ttargets = e.data.targets || [];\n\t\t\t\tif (targets.length === 1 && (file = fm.file(targets[0])) && file.mime !== 'directory') {\n\t\t\t\t\tif (file.url != '1') {\n\t\t\t\t\t\tself.extra = getExtra(file);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Get URL ondemand\n\t\t\t\t\t\tvar node;\n\t\t\t\t\t\tself.extra = {\n\t\t\t\t\t\t\ticon: 'link',\n\t\t\t\t\t\t\tnode: $('<a/>')\n\t\t\t\t\t\t\t\t.attr({href: '#', title: fm.i18n('getLink'), draggable: 'false'})\n\t\t\t\t\t\t\t\t.text(file.name)\n\t\t\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tvar parent = node.parent();\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\tparent.removeClass('ui-state-disabled').addClass('elfinder-button-icon-spinner');\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\t\tparent.removeClass('elfinder-button-icon-spinner');\n\t\t\t\t\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\t\t\t\trfile.url = data.url;\n\t\t\t\t\t\t\t\t\t\t\tnode.replaceWith(getExtra(file).node);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tparent.addClass('ui-state-disabled');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t};\n\t\t\t\t\t\tnode = self.extra.node;\n\t\t\t\t\t\tnode.ready(function(){\n\t\t\t\t\t\t\trequestAnimationFrame(function(){\n\t\t\t\t\t\t\t\tnode.parent().addClass('ui-state-disabled').css('pointer-events', 'auto');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}).one('open', function() {\n\t\t\tif (fm.api >= 2.1012) {\n\t\t\t\tczipdl = fm.getCommand('zipdl');\n\t\t\t}\n\t\t\tdlntf = fm.cookieEnabled && fm.api > 2.1038 && !fm.isCORS;\n\t\t});\n\t\t\n\t\tthis.exec = function(select) {\n\t\t\tvar hashes  = this.hashes(select),\n\t\t\t\tfm      = this.fm,\n\t\t\t\tbase    = fm.options.url,\n\t\t\t\tfiles   = filter(hashes, true),\n\t\t\t\tdfrd    = $.Deferred(),\n\t\t\t\tiframes = '',\n\t\t\t\tcdata   = '',\n\t\t\t\ttargets = {},\n\t\t\t\ti, url,\n\t\t\t\tlinkdl  = false,\n\t\t\t\tgetTask = function(hashes) {\n\t\t\t\t\treturn function() {\n\t\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\t\troot = fm.file(fm.root(hashes[0])),\n\t\t\t\t\t\t\tsingle = (hashes.length === 1),\n\t\t\t\t\t\t\tvolName = root? (root.i18 || root.name) : null,\n\t\t\t\t\t\t\tdir, dlName, phash;\n\t\t\t\t\t\tif (single) {\n\t\t\t\t\t\t\tif (dir = fm.file(hashes[0])) {\n\t\t\t\t\t\t\t\tdlName = (dir.i18 || dir.name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$.each(hashes, function() {\n\t\t\t\t\t\t\t\tvar d = fm.file(this);\n\t\t\t\t\t\t\t\tif (d && (!phash || phash === d.phash)) {\n\t\t\t\t\t\t\t\t\tphash = d.phash;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tphash = null;\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (phash && (dir = fm.file(phash))) {\n\t\t\t\t\t\t\t\tdlName = (dir.i18 || dir.name) + '-' + hashes.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dlName) {\n\t\t\t\t\t\t\tvolName = dlName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvolName && (volName = ' (' + volName + ')');\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'zipdl', targets : hashes},\n\t\t\t\t\t\t\tnotify : {type : 'zipdl', cnt : 1, hideCnt : true, msg : fm.i18n('ntfzipdl') + volName},\n\t\t\t\t\t\t\tcancel : true,\n\t\t\t\t\t\t\teachCancel : true,\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t}).done(function(e) {\n\t\t\t\t\t\t\tvar zipdl, dialog, btn = {}, dllink, form, iframe, m,\n\t\t\t\t\t\t\t\tuniq = 'dlw' + (+new Date()),\n\t\t\t\t\t\t\t\tzipdlFn = function(url) {\n\t\t\t\t\t\t\t\t\tdllink = $('<a/>')\n\t\t\t\t\t\t\t\t\t\t.attr('href', url)\n\t\t\t\t\t\t\t\t\t\t.attr('download', fm.escape(dlName))\n\t\t\t\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\tdialog && dialog.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (linkdl) {\n\t\t\t\t\t\t\t\t\t\tdllink.attr('target', '_blank')\n\t\t\t\t\t\t\t\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-download\"></span>'+fm.escape(dlName));\n\t\t\t\t\t\t\t\t\t\tbtn[fm.i18n('btnCancel')] = function() {\n\t\t\t\t\t\t\t\t\t\t\tdialog.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tdialog = self.fmDialog(dllink, {\n\t\t\t\t\t\t\t\t\t\t\ttitle: fm.i18n('link'),\n\t\t\t\t\t\t\t\t\t\t\tbuttons: btn,\n\t\t\t\t\t\t\t\t\t\t\twidth: '200px',\n\t\t\t\t\t\t\t\t\t\t\tdestroyOnClose: true,\n\t\t\t\t\t\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t(dfd.state() !== 'resolved') && dfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tclick(dllink.hide().appendTo('body').get(0));\n\t\t\t\t\t\t\t\t\t\tdllink.remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (e.error) {\n\t\t\t\t\t\t\t\tfm.error(e.error);\n\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t} else if (e.zipdl) {\n\t\t\t\t\t\t\t\tzipdl = e.zipdl;\n\t\t\t\t\t\t\t\tif (dlName) {\n\t\t\t\t\t\t\t\t\tm = fm.splitFileExtention(zipdl.name || '');\n\t\t\t\t\t\t\t\t\tdlName += m[1]? ('.' + m[1]) : '.zip';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdlName = zipdl.name;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ((html5dl && (!fm.UA.Safari || fm.isSameOrigin(fm.options.url))) || linkdl) {\n\t\t\t\t\t\t\t\t\turl = fm.options.url + (fm.options.url.indexOf('?') === -1 ? '?' : '&')\n\t\t\t\t\t\t\t\t\t+ 'cmd=zipdl&download=1';\n\t\t\t\t\t\t\t\t\t$.each([hashes[0], zipdl.file, dlName, zipdl.mime], function(key, val) {\n\t\t\t\t\t\t\t\t\t\turl += '&targets%5B%5D='+encodeURIComponent(val);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$.each(fm.customData, function(key, val) {\n\t\t\t\t\t\t\t\t\t\turl += '&'+encodeURIComponent(key)+'='+encodeURIComponent(val);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\turl += '&'+encodeURIComponent(dlName);\n\t\t\t\t\t\t\t\t\tif (fm.hasParrotHeaders()) {\n\t\t\t\t\t\t\t\t\t\tfm.getBinaryByUrl({url: url}, function(blob) {\n\t\t\t\t\t\t\t\t\t\t\tif (blob instanceof Blob) {\n\t\t\t\t\t\t\t\t\t\t\t\turl = (window.URL || window.webkitURL).createObjectURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\tzipdlFn(url);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.error(['errUploadTransfer', fm.i18n('kindZIP')]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tzipdlFn(url);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tform = $('<form action=\"'+fm.options.url+'\" method=\"post\" target=\"'+uniq+'\" style=\"display:none\"/>')\n\t\t\t\t\t\t\t\t\t.append('<input type=\"hidden\" name=\"cmd\" value=\"zipdl\"/>')\n\t\t\t\t\t\t\t\t\t.append('<input type=\"hidden\" name=\"download\" value=\"1\"/>');\n\t\t\t\t\t\t\t\t\t$.each([hashes[0], zipdl.file, dlName, zipdl.mime], function(key, val) {\n\t\t\t\t\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"targets[]\" value=\"'+fm.escape(val)+'\"/>');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$.each(fm.customData, function(key, val) {\n\t\t\t\t\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"'+key+'\" value=\"'+fm.escape(val)+'\"/>');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tform.attr('target', uniq).appendTo('body');\n\t\t\t\t\t\t\t\t\tiframe = $('<iframe style=\"display:none\" name=\"'+uniq+'\">')\n\t\t\t\t\t\t\t\t\t\t.appendTo('body')\n\t\t\t\t\t\t\t\t\t\t.ready(function() {\n\t\t\t\t\t\t\t\t\t\t\tform.submit().remove();\n\t\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tiframe.remove();\n\t\t\t\t\t\t\t\t\t\t\t}, 20000); // give 20 sec file to be saved\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn dfd.promise();\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t// use MouseEvent to click element for Safari etc\n\t\t\t\tclick = function(a) {\n\t\t\t\t\tvar clickEv;\n\t\t\t\t\tif (typeof MouseEvent === 'function') {\n\t\t\t\t\t\tclickEv = new MouseEvent('click');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclickEv = document.createEvent('MouseEvents');\n\t\t\t\t\t\tclickEv.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n\t\t\t\t\t}\n\t\t\t\t\tfm.pauseUnloadCheck(true);\n\t\t\t\t\ta.dispatchEvent(clickEv);\n\t\t\t\t},\n\t\t\t\tcheckCookie = function(id) {\n\t\t\t\t\tvar name = 'elfdl' + id,\n\t\t\t\t\t\tparts;\n\t\t\t\t\tparts = document.cookie.split(name + \"=\");\n\t\t\t\t\tif (parts.length === 2) {\n\t\t\t\t\t\tntftm && clearTimeout(ntftm);\n\t\t\t\t\t\tdocument.cookie = name + '=; path=' + cpath + '; max-age=0';\n\t\t\t\t\t\tcloseNotify();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(function() { checkCookie(id); }, 200);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcloseNotify = function() {\n\t\t\t\t\tif (fm.ui.notify.children('.elfinder-notify-download').length) {\n\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\ttype : 'download',\n\t\t\t\t\t\t\tcnt : -1\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treqids = [],\n\t\t\t\tlink, html5dl, fileCnt, clickEv, cid, ntftm, reqid, getUrlDfrd, urls;\n\t\t\t\t\n\t\t\tif (!files.length) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tfileCnt = $.grep(files, function(f) { return f.mime === 'directory'? false : true; }).length;\n\t\t\tlink = $('<a>').hide().appendTo('body');\n\t\t\thtml5dl = (typeof link.get(0).download === 'string');\n\t\t\t\n\t\t\tif (zipOn && (fileCnt !== files.length || fileCnt >= (this.options.minFilesZipdl || 1))) {\n\t\t\t\tlink.remove();\n\t\t\t\tlinkdl = (!html5dl && fm.UA.Mobile);\n\t\t\t\tif (mixed) {\n\t\t\t\t\ttargets = {};\n\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\tvar p = f.hash.split('_', 2);\n\t\t\t\t\t\tif (! targets[p[0]]) {\n\t\t\t\t\t\t\ttargets[p[0]] = [ f.hash ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttargets[p[0]].push(f.hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (!linkdl && fm.UA.Mobile && Object.keys(targets).length > 1) {\n\t\t\t\t\t\tlinkdl = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttargets = [ $.map(files, function(f) { return f.hash; }) ];\n\t\t\t\t}\n\t\t\t\tdfrd = fm.sequence($.map(targets, function(t) { return getTask(t); })).always(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tfm.trigger('download', {files : files});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn dfrd;\n\t\t\t} else {\n\t\t\t\treqids = [];\n\t\t\t\tgetUrlDfrd = $.Deferred().done(function(urls) {\n\t\t\t\t\tfor (i = 0; i < urls.length; i++) {\n\t\t\t\t\t\turl = urls[i];\n\t\t\t\t\t\tif (dlntf && url.substr(0, fm.options.url.length) === fm.options.url) {\n\t\t\t\t\t\t\treqid = fm.getRequestId();\n\t\t\t\t\t\t\treqids.push(reqid);\n\t\t\t\t\t\t\turl += '&cpath=' + cpath + '&reqid=' + reqid;\n\t\t\t\t\t\t\tntftm = setTimeout(function() {\n\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\ttype : 'download',\n\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\tcancel : (fm.UA.IE || fm.UA.Edge)? void(0) : function() {\n\t\t\t\t\t\t\t\t\t\tif (reqids.length) {\n\t\t\t\t\t\t\t\t\t\t\t$.each(reqids, function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd: 'abort',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: this\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault: true\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treqids = [];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, fm.notifyDelay);\n\t\t\t\t\t\t\tcheckCookie(reqid);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (html5dl && (!fm.UA.Safari || fm.isSameOrigin(url))) {\n\t\t\t\t\t\t\tclick(link.attr('href', url)\n\t\t\t\t\t\t\t\t.attr('download', fm.escape(files[i].name))\n\t\t\t\t\t\t\t\t.get(0)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (fm.UA.Mobile) {\n\t\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\t\tif (! window.open(url)) {\n\t\t\t\t\t\t\t\t\t\tfm.error('errPopup');\n\t\t\t\t\t\t\t\t\t\tntftm && cleaerTimeout(ntftm);\n\t\t\t\t\t\t\t\t\t\tcloseNotify();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tiframes += '<iframe class=\"downloader\" id=\"downloader-' + files[i].hash+'\" style=\"display:none\" src=\"'+url+'\"/>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlink.remove();\n\t\t\t\t\t$(iframes)\n\t\t\t\t\t\t.appendTo('body')\n\t\t\t\t\t\t.ready(function() {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t$(iframes).each(function() {\n\t\t\t\t\t\t\t\t\t$('#' + $(this).attr('id')).remove();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 20000 + (10000 * i)); // give 20 sec + 10 sec for each file to be saved\n\t\t\t\t\t\t});\n\t\t\t\t\tfm.trigger('download', {files : files});\n\t\t\t\t\tdfrd.resolve();\n\t\t\t\t});\n\t\t\t\tfileCnt = files.length;\n\t\t\t\turls = [];\n\t\t\t\tfor (i = 0; i < files.length; i++) {\n\t\t\t\t\tfm.openUrl(files[i].hash, true, function(v) {\n\t\t\t\t\t\tv && urls.push(v);\n\t\t\t\t\t\tif (--fileCnt < 1) {\n\t\t\t\t\t\t\tgetUrlDfrd.resolve(urls);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});"]}