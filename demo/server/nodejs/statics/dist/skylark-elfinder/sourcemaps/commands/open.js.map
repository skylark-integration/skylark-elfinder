{"version":3,"sources":["commands/open.js"],"names":["define","elFinder","prototype","commands","open","fm","this","self","alwaysEnabled","noChangeDirOnRemovedCwd","_handlers","dblclick","e","arg","data","file","getstate","preventDefault","exec","select enable disable reload","update","type","shortcuts","pattern","OS","select","sel","files","cnt","length","read","UA","Mobile","$","grep","mime","hashes","cOpts","s","w","imgW","imgH","winW","winH","reg","html5dl","inline","selAct","cmd","dfrd","Deferred","fail","error","thash","opts","options","into","reject","keyState","ctrlKey","shiftKey","getFileCallback","getCommand","hash","request","target","notify","hideCnt","syncOnFail","lazy","name","doOpen","wnd","openCB","url","link","hide","appendTo","attr","get","click","window","method","toLowerCase","indexOf","customData","Object","keys","match","Math","round","screen","availWidth","availHeight","parseInt","width","height","dim","split","form","document","createElement","action","style","display","params","assign","_t","ts","Date","each","key","val","input","value","appendChild","body","submit","location","trigger","remove","RegExp","option","download","openUrl","resolve","confirm","title","text","accept","label","callback","cancel","buttons","isCommandEnabled","cwd","storage","selectAction","cmdName","valueOf","enabled","forceLoad"],"mappings":"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","file":"../../commands/open.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"open\"\n\t * Enter folder or open files in new windows\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/  \n\t(elFinder.prototype.commands.open = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm,\n\t\t\tself = this;\n\t\tthis.alwaysEnabled = true;\n\t\tthis.noChangeDirOnRemovedCwd = true;\n\t\t\n\t\tthis._handlers = {\n\t\t\tdblclick : function(e) {\n\t\t\t\tvar arg = e.data && e.data.file? [ e.data.file ]: void(0);\n\t\t\t\tif (self.getstate(arg) === 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfm.exec('open', arg);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'select enable disable reload' : function(e) { this.update(e.type == 'disable' ? -1 : void(0));  }\n\t\t};\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+down numpad_enter'+(fm.OS != 'mac' && ' enter')\n\t\t}];\n\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\t\t\t\n\t\t\treturn cnt == 1 \n\t\t\t\t? (sel[0].read ? 0 : -1)\n\t\t\t\t: (cnt && !fm.UA.Mobile) ? ($.grep(sel, function(file) { return file.mime == 'directory' || ! file.read ? false : true;}).length == cnt ? 0 : -1) : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpts) {\n\t\t\tvar dfrd  = $.Deferred().fail(function(error) { error && fm.error(error); }),\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tcnt   = files.length,\n\t\t\t\tthash = (typeof cOpts == 'object')? cOpts.thash : false,\n\t\t\t\topts  = this.options,\n\t\t\t\tinto  = opts.into || 'window',\n\t\t\t\tfile, url, s, w, imgW, imgH, winW, winH, reg, link, html5dl, inline,\n\t\t\t\tselAct, cmd;\n\n\t\t\tif (!cnt && !thash) {\n\t\t\t\t{\n\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// open folder\n\t\t\tif (thash || (cnt == 1 && (file = files[0]) && file.mime == 'directory')) {\n\t\t\t\tif (!thash && file && !file.read) {\n\t\t\t\t\treturn dfrd.reject(['errOpen', file.name, 'errPerm']);\n\t\t\t\t} else {\n\t\t\t\t\tif (fm.keyState.ctrlKey && (fm.keyState.shiftKey || typeof fm.options.getFileCallback !== 'function')) {\n\t\t\t\t\t\tif (fm.getCommand('opennew')) {\n\t\t\t\t\t\t\treturn fm.exec('opennew', [thash? thash : file.hash]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\tdata   : {cmd  : 'open', target : thash || file.hash},\n\t\t\t\t\t\tnotify : {type : 'open', cnt : 1, hideCnt : true},\n\t\t\t\t\t\tsyncOnFail : true,\n\t\t\t\t\t\tlazy : false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfiles = $.grep(files, function(file) { return file.mime != 'directory' ? true : false; });\n\t\t\t\n\t\t\t// nothing to open or files and folders selected - do nothing\n\t\t\tif (cnt != files.length) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tvar doOpen = function() {\n\t\t\t\tvar openCB = function(url) {\n\t\t\t\t\t\tvar link = $('<a>').hide().appendTo($('body'));\n\t\t\t\t\t\tif (fm.UA.Mobile || !inline) {\n\t\t\t\t\t\t\tif (html5dl) {\n\t\t\t\t\t\t\t\tif (!inline) {\n\t\t\t\t\t\t\t\t\tlink.attr('download', file.name);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlink.attr('target', '_blank');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tlink.attr('href', url).get(0).click();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twnd = window.open(url);\n\t\t\t\t\t\t\t\tif (!wnd) {\n\t\t\t\t\t\t\t\t\treturn dfrd.reject('errPopup');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgetOnly = (typeof opts.method === 'string' && opts.method.toLowerCase() === 'get');\n\t\t\t\t\t\t\tif (!getOnly\n\t\t\t\t\t\t\t\t&& url.indexOf(fm.options.url) === 0\n\t\t\t\t\t\t\t\t&& fm.customData\n\t\t\t\t\t\t\t\t&& Object.keys(fm.customData).length\n\t\t\t\t\t\t\t\t// Since playback by POST request can not be done in Chrome, media allows GET request\n\t\t\t\t\t\t\t\t&& !file.mime.match(/^(?:video|audio)/)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// Send request as 'POST' method to hide custom data at location bar\n\t\t\t\t\t\t\t\turl = '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (into === 'window') {\n\t\t\t\t\t\t\t\t// set window size for image if set\n\t\t\t\t\t\t\t\timgW = winW = Math.round(2 * screen.availWidth / 3);\n\t\t\t\t\t\t\t\timgH = winH = Math.round(2 * screen.availHeight / 3);\n\t\t\t\t\t\t\t\tif (parseInt(file.width) && parseInt(file.height)) {\n\t\t\t\t\t\t\t\t\timgW = parseInt(file.width);\n\t\t\t\t\t\t\t\t\timgH = parseInt(file.height);\n\t\t\t\t\t\t\t\t} else if (file.dim) {\n\t\t\t\t\t\t\t\t\ts = file.dim.split('x');\n\t\t\t\t\t\t\t\t\timgW = parseInt(s[0]);\n\t\t\t\t\t\t\t\t\timgH = parseInt(s[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (winW >= imgW && winH >= imgH) {\n\t\t\t\t\t\t\t\t\twinW = imgW;\n\t\t\t\t\t\t\t\t\twinH = imgH;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ((imgW - winW) > (imgH - winH)) {\n\t\t\t\t\t\t\t\t\t\twinH = Math.round(imgH * (winW / imgW));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\twinW = Math.round(imgW * (winH / imgH));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tw = 'width='+winW+',height='+winH;\n\t\t\t\t\t\t\t\twnd = window.open(url, target, w + ',top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (into === 'tabs') {\n\t\t\t\t\t\t\t\t\ttarget = file.hash;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twnd = window.open('about:blank', target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!wnd) {\n\t\t\t\t\t\t\t\treturn dfrd.reject('errPopup');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (url === '') {\n\t\t\t\t\t\t\t\tvar form = document.createElement(\"form\");\n\t\t\t\t\t\t\t\tform.action = fm.options.url;\n\t\t\t\t\t\t\t\tform.method = 'POST';\n\t\t\t\t\t\t\t\tform.target = target;\n\t\t\t\t\t\t\t\tform.style.display = 'none';\n\t\t\t\t\t\t\t\tvar params = Object.assign({}, fm.customData, {\n\t\t\t\t\t\t\t\t\tcmd: 'file',\n\t\t\t\t\t\t\t\t\ttarget: file.hash,\n\t\t\t\t\t\t\t\t\t_t: file.ts || parseInt(+new Date()/1000)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$.each(params, function(key, val)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar input = document.createElement(\"input\");\n\t\t\t\t\t\t\t\t\tinput.name = key;\n\t\t\t\t\t\t\t\t\tinput.value = val;\n\t\t\t\t\t\t\t\t\tform.appendChild(input);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdocument.body.appendChild(form);\n\t\t\t\t\t\t\t\tform.submit();\n\t\t\t\t\t\t\t} else if (into !== 'window') {\n\t\t\t\t\t\t\t\twnd.location = url;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$(wnd).trigger('focus');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlink.remove();\n\t\t\t\t\t},\n\t\t\t\t\twnd, target, getOnly;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\treg = new RegExp(fm.option('dispInlineRegex'), 'i');\n\t\t\t\t} catch(e) {\n\t\t\t\t\treg = false;\n\t\t\t\t}\n\t\t\n\t\t\t\t// open files\n\t\t\t\thtml5dl  = (typeof $('<a>').get(0).download === 'string');\n\t\t\t\tcnt = files.length;\n\t\t\t\twhile (cnt--) {\n\t\t\t\t\ttarget = 'elf_open_window';\n\t\t\t\t\tfile = files[cnt];\n\t\t\t\t\t\n\t\t\t\t\tif (!file.read) {\n\t\t\t\t\t\treturn dfrd.reject(['errOpen', file.name, 'errPerm']);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tinline = (reg && file.mime.match(reg));\n\t\t\t\t\tfm.openUrl(file.hash, !inline, openCB);\n\t\t\t\t}\n\t\t\t\treturn dfrd.resolve(hashes);\n\t\t\t};\n\t\t\t\n\t\t\tif (cnt > 1) {\n\t\t\t\tfm.confirm({\n\t\t\t\t\ttitle: 'openMulti',\n\t\t\t\t\ttext : ['openMultiConfirm', cnt + ''],\n\t\t\t\t\taccept : {\n\t\t\t\t\t\tlabel : 'cmdopen',\n\t\t\t\t\t\tcallback : function() { doOpen(); }\n\t\t\t\t\t},\n\t\t\t\t\tcancel : {\n\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\tcallback : function() { \n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tbuttons : (fm.getCommand('zipdl') && fm.isCommandEnabled('zipdl', fm.cwd().hash))? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel : 'cmddownload',\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\tfm.exec('download', hashes);\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t] : []\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tselAct = fm.storage('selectAction') || opts.selectAction;\n\t\t\t\tif (selAct) {\n\t\t\t\t\t$.each(selAct.split('/'), function() {\n\t\t\t\t\t\tvar cmdName = this.valueOf();\n\t\t\t\t\t\tif (cmdName !== 'open' && (cmd = fm.getCommand(cmdName)) && cmd.enabled()) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcmd = null;\n\t\t\t\t\t});\n\t\t\t\t\tif (cmd) {\n\t\t\t\t\t\treturn fm.exec(cmd.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdoOpen();\n\t\t\t}\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});"]}