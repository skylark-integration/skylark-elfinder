{"version":3,"sources":["commands/rename.js"],"names":["define","elFinder","prototype","commands","rename","this","alwaysEnabled","syncTitleOnChange","self","fm","request","dfrd","targtes","file","name","rootNames","sel","hash","concat","cnt","length","data","lockfiles","files","isRoot","netkey","storage","reject","unlockfiles","trigger","_name","i18","_i18","changed","updateCache","change","resolve","cmd","target","match","notify","type","navigate","fail","error","err","parseError","Array","isArray","sync","done","cwdHash","added","undo","callback","redo","cwd","exec","$","map","f","mime","always","getHint","ext","hint","add","selected","splits","splitFileExtention","f1","f2","substr","batchRename","dialog","tplr","mkChk","node","label","i18n","prepend","num","prefix","suffix","extention","checks","append","preview","opts","title","modal","destroyOnClose","width","Math","min","getUI","buttons","open","on","mkPrev","getName","vName","val","is","html","empty","radios","find","targets","elfinderdialog","shift","fn","checkboxradio","create","e","ui","get","prop","buttonset","fmDialog","noChangeDirOnRemovedCwd","shortcuts","pattern","OS","description","getstate","select","phash","brk","state","toLowerCase","cookieEnabled","locked","api","grep","option","extra","icon","attr","originalEvent","touches","stopPropagation","preventDefault","hashes","cOpts","colwidth","incwd","navbar","_currentType","tarea","unselect","requestAnimationFrame","input","rest","overlay","elfinderoverlay","off","cancel","pnode","removeClass","css","namespace","parent","Deferred","escape","replace","replaceWith","remove","unbind","resize","enable","blur","trim","valid","req","inError","options","validName","test","close","setTimeout","fileByName","confirm","text","accept","style","height","scrollHeight","scrollWidth","stopImmediatePropagation","keyCode","ESCAPE","ENTER","UA","Mobile","iOS","enabled","setSelectionRange","contents","filter","nodeType","navHash2Id","blink","addClass","bind","one","inArray","update","removed","each","i","h"],"mappings":";;;;;;;AAAAA,QACC,eACC,SAASC,GAykBV,OAjkBAA,EAASC,UAAUC,SAASC,OAAS,WACpC,aAGAC,KAAKC,eAAgB,EAErBD,KAAKE,mBAAoB,EAEzB,IAAIC,EAAOH,KACVI,EAAKD,EAAKC,GACVC,EAAU,SAASC,EAAMC,EAASC,EAAMC,GACvC,IAEYC,EAFRC,EAAMJ,GAAUC,EAAKI,MAAMC,OAAON,IAAYC,EAAKI,MACtDE,EAAMH,EAAII,OACVC,KAID,GAFAZ,EAAGa,WAAWC,MAAQP,IAElBP,EAAGe,OAAOX,KAAUA,EAAKY,OAAQ,CAIpC,IAHMV,EAAYN,EAAGiB,QAAQ,gBAC5BX,MAEY,KAATD,EAAa,CAChB,IAAIC,EAAUF,EAAKI,MASlB,OAFAN,GAAQA,EAAKgB,cACblB,EAAGmB,aAAaL,MAAQP,IAAMa,QAAQ,eAAgBN,MAAQP,IAP9DH,EAAKC,KAAOD,EAAKiB,MACjBjB,EAAKkB,IAAMlB,EAAKmB,YACTjB,EAAUF,EAAKI,aACfJ,EAAKiB,aACLjB,EAAKmB,eAOa,IAAfnB,EAAKiB,QACfjB,EAAKiB,MAAQjB,EAAKC,KAClBD,EAAKmB,KAAOnB,EAAKkB,KAElBlB,EAAKC,KAAOC,EAAUF,EAAKI,MAAQH,SAC5BD,EAAKkB,IAQb,OANAtB,EAAGiB,QAAQ,YAAaX,GACxBM,GAASY,SAAUpB,IACnBJ,EAAGyB,YAAYb,GACfZ,EAAG0B,OAAOd,GACVV,GAAQA,EAAKyB,QAAQf,QACrBZ,EAAGmB,aAAaL,MAAQP,IAAMa,QAAQ,eAAgBN,MAAQP,IAI/DK,GACCgB,IAAM,SACNvB,KAAOA,EACPwB,OAASzB,EAAKI,MAGXE,EAAM,IACTE,EAAc,QAAIT,EACdE,EAAKyB,MAAM,QACdlB,EAAQ,EAAIP,IAIdL,EAAGC,SACDW,KAASA,EACTmB,QAAUC,KAAO,SAAUtB,IAAMA,GACjCuB,cAEAC,KAAK,SAASC,GACd,IAAIC,EAAMpC,EAAGqC,WAAWF,GACxBjC,GAAQA,EAAKgB,SACPkB,GAASE,MAAMC,QAAQH,IAAmB,cAAXA,EAAI,IACxCpC,EAAGwC,SAGJC,KAAK,SAAS7B,GACd,IAAI8B,EACA9B,EAAK+B,OAAS/B,EAAK+B,MAAMhC,QAAkB,IAARD,IACtCE,EAAKgC,MACJhB,IAAM,SACNiB,SAAW,WACV,OAAO7C,EAAGC,SACTW,MAAUgB,IAAM,SAAUC,OAASjB,EAAK+B,MAAM,GAAGnC,KAAMH,KAAOD,EAAKC,MACnE0B,QAAUC,KAAO,OAAQtB,IAAM,OAIlCE,EAAKkC,MACJlB,IAAM,SACNiB,SAAW,WACV,OAAO7C,EAAGC,SACTW,MAAUgB,IAAM,SAAUC,OAASzB,EAAKI,KAAMH,KAAOA,GACrD0B,QAAUC,KAAO,SAAUtB,IAAM,QAKrCR,GAAQA,EAAKyB,QAAQf,IACf8B,EAAU1C,EAAG+C,MAAMvC,OAASkC,IAAYtC,EAAKI,MAClDR,EAAGgD,KAAK,OAAQC,EAAEC,IAAItC,EAAK+B,MAAO,SAASQ,GAC1C,MAAmB,cAAXA,EAAEC,KAAuBD,EAAE3C,KAAO,OACxC,MAGJ6C,OAAO,WACPrD,EAAGmB,aAAaL,MAAQP,IAAMa,QAAQ,eAAgBN,MAAQP,OAIjE+C,EAAU,SAASjD,EAAMwB,GACxB,IAIC0B,EAAKC,EAAMC,EAJRlD,EAAMsB,GAAU7B,EAAG0D,WACtBC,EAAS3D,EAAG4D,mBAAmBvD,GAC/BwD,EAAK7D,EAAGI,KAAKG,EAAI,IACjBuD,EAAK9D,EAAGI,KAAKG,EAAI,IA2BlB,OAxBAgD,EAAMI,EAAO,GAAK,IAAMA,EAAO,GAAM,GACjCA,EAAO,IAAoB,MAAdA,EAAO,IAEvBH,EAAQ,IAAMxD,EAAG4D,mBAAmBC,EAAGxD,MAAM,GAAKkD,EAAM,MACxDC,GAAQ,IAAMxD,EAAG4D,mBAAmBE,EAAGzD,MAAM,GAAKkD,EAAM,KAC9CI,EAAO,GAAGhD,OAAS,IACA,MAAzBgD,EAAO,GAAGI,QAAQ,IAGrBP,EAAQ,KADRC,EAAME,EAAO,GAAGI,OAAO,EAAGJ,EAAO,GAAGhD,OAAS,IACzBkD,EAAGxD,KAAK,MAC5BmD,GAAQ,IAAMC,EAAMK,EAAGzD,KAAK,KACS,MAA3BsD,EAAO,GAAGI,OAAO,EAAG,KAE9BN,EAAME,EAAO,GAAGI,OAAO,GACvBP,EAAQ,IAAIxD,EAAG4D,mBAAmBC,EAAGxD,MAAM,GAAKoD,EAAMF,EAAM,MAC5DC,GAAQ,IAAIxD,EAAG4D,mBAAmBE,EAAGzD,MAAM,GAAKoD,EAAMF,EAAM,MAGzDC,IACJA,EAAO,IAAIG,EAAO,GAAK,IAAMJ,EAAM,OAASI,EAAO,GAAK,IAAMJ,EAAM,KAEjEhD,EAAII,OAAS,IAChB6C,GAAQ,QAEFA,GAERQ,EAAc,WACb,IAyDCC,EAzDG1D,EAAMP,EAAG0D,WACZQ,EAAO,4DACPC,EAAQ,SAASC,EAAMC,GACtB,OAAOpB,EAAE,+CAAiDjD,EAAGsE,KAAKD,GAAS,YAAYE,QAAQH,IAEhG/D,EAAO4C,EAAE,8DACTuB,EAAOvB,EAAEiB,GACTO,EAAUxB,EAAEiB,GACZQ,EAAUzB,EAAEiB,GACZS,EAAa1B,EAAEiB,GACfU,EAAS3B,EAAE,UAAU4B,OACpBV,EAAMK,EAAK,cACXL,EAAMM,EAAQ,YACdN,EAAMO,EAAQ,YACdP,EAAMQ,EAAW,oBAElBG,EAAU7B,EAAE,gDACZmB,EAAOnB,EAAE,wCAAwC4B,OAC/C5B,EAAE,6CAA6C4B,OAAOxE,GACtD4C,EAAE,6CAA6C4B,OAAOD,GACtDE,GAEFC,GACCC,MAAQhF,EAAGsE,KAAK,eAChBW,OAAQ,EACRC,gBAAiB,EACjBC,MAAOC,KAAKC,IAAI,IAAKrF,EAAGsF,QAAQH,QAAU,IAC1CI,WACAC,KAAO,WACNnF,EAAKoF,GAAG,QAASC,GAAQtE,QAAQ,WAGnCuE,EAAU,WACT,IAAIC,EAAQvF,EAAKwF,MAChBtC,EAAMvD,EAAG4D,mBAAmB5D,EAAGI,KAAKG,EAAI,IAAIF,MAAM,GAYnD,OAXc,KAAVuF,GAAgBpB,EAAIsB,GAAG,eACtBrB,EAAOqB,GAAG,YACbF,GAAS,IACClB,EAAOoB,GAAG,YACpBF,EAAQ,IAAMA,EAAQ,IAAMrC,EAClBoB,EAAUmB,GAAG,YACvBF,EAAQ,KAAOA,EACLrC,IACVqC,GAAS,IAAMrC,IAGVqC,GAERF,EAAS,WACR,IAAIE,EAAQD,IACE,KAAVC,EACHd,EAAQiB,KAAK/F,EAAGsE,MAAM,iBAAkB/D,EAAII,OAAQ2C,EAAQsC,MAE5Dd,EAAQkB,SAGVC,EAASrB,EAAOsB,KAAK,eAAeT,GAAG,SAAUC,GAGlDX,EAAKQ,QAAQvF,EAAGsE,KAAK,aAAe,WACnC,IACClE,EAAM+F,EADHP,EAAQD,IAEE,KAAVC,IACH3B,EAAOmC,eAAe,SACtBD,EAAU5F,EACVH,EAAOJ,EAAGI,KAAK+F,EAAQE,SACvBpG,OAAQ,EAASkG,EAAS/F,EAAMwF,KAGlCb,EAAKQ,QAAQvF,EAAGsE,KAAK,cAAgB,WACpCL,EAAOmC,eAAe,UAEnBnD,EAAEqD,GAAGC,cACRN,EAAOM,eACNC,OAAQ,SAASC,EAAGC,GACf9G,OAAS4E,EAAImC,IAAI,IACpBnC,EAAIoC,KAAK,WAAW,GAAMlF,YAK7BkD,EAAOiC,WACNL,OAAQ,SAASC,EAAGC,GACnBlC,EAAIoC,KAAK,WAAW,GAAMlF,YAI7BuC,EAASlE,EAAK+G,SAAS1C,EAAMW,IAG/BnF,KAAKmH,yBAA0B,EAE/BnH,KAAKoH,YACJC,QAAU,MAAiB,OAATjH,EAAGkH,GAAc,SAAW,MAE9CD,QAAU,WACVE,YAAc,cACdtE,SAAW,WACV7C,EAAG0D,WAAW/C,OAAS,GAAKqD,OAI9BpE,KAAKwH,SAAW,SAASC,GACxB,IAECC,EAAO/D,EAAKH,EAAMmE,EAAKC,EAAOzG,EAF3BR,EAAMX,KAAKkB,MAAMuG,GACpB3G,EAAMH,EAAII,OAGX,OAAKD,GAIDA,EAAM,GAAKH,EAAI,GAAG+G,QACrBA,EAAQ/G,EAAI,GAAG+G,MACf/D,EAAMvD,EAAG4D,mBAAmBrD,EAAI,GAAGF,MAAM,GAAGoH,cAC5CrE,EAAO7C,EAAI,GAAG6C,MAEH,IAAR1C,IACHK,EAASf,EAAGe,OAAOR,EAAI,KAGxBiH,EAAiB,IAAR9G,IAAeV,EAAG0H,eAAiB3G,IAAYR,EAAI,GAAGoH,SAAY3H,EAAG4H,IAAM,OAAUlH,IAAQuC,EAAE4E,KAAKtH,EAAK,SAAS4C,GAC1H,QAAKoE,GAAQpE,EAAEwE,QAAUxE,EAAEmE,QAAUA,GAAUtH,EAAGe,OAAOoC,IAAOC,IAASD,EAAEC,MAAQG,IAAQvD,EAAG4D,mBAAmBT,EAAE9C,MAAM,GAAGoH,iBAG3HF,IAAQA,GAAM,IACP,KAEN5G,OAAW,GAAK,GAGdI,GAAoB,IAAVyG,GAAexH,EAAG8H,OAAO,eAAgBvH,EAAI,GAAGC,MAAc,SAC5EgH,GAAS,IAGK,IAAXA,GAAgB9G,EAAM,EACzBX,EAAKgI,OACJC,KAAM,aACN5D,KAAMnB,EAAE,WACNgF,MAAMjD,MAAOhF,EAAGsE,KAAK,iBACrBmB,GAAG,mBAAoB,SAASgB,GACjB,eAAXA,EAAEzE,MAAyByE,EAAEyB,cAAcC,QAAQxH,OAAS,IAGhE8F,EAAE2B,kBACF3B,EAAE4B,iBACFrI,EAAGsF,QAAQlE,QAAQ,SACnB4C,eAIIjE,EAAKgI,MAGNP,IA7CE,GAgDV5H,KAAKoD,KAAO,SAASsF,EAAQC,GACbvI,EAAGsF,MAAM,OAAxB,IAiCIkD,EAhCHjI,EAAW+H,KAAWtI,EAAG0D,WAAW/C,QAAQX,EAAG0D,aAAwB1D,EAAG+C,MAAMvC,MAChFE,EAAWH,EAAII,OACfP,EAAWJ,EAAGI,KAAKG,EAAI8F,SAEvBtB,EAAWwD,MACXE,EAAYzI,EAAG+C,MAAMvC,MAAQJ,EAAKI,KAElCkI,EAAqB,WADa,WAAtB3D,EAAK4D,cAAmD,UAAtB5D,EAAK4D,aAA2B5D,EAAK4D,aAAgBF,EAAO,SAAW,SAErH5G,EAAW7B,EAAG0I,EAAQ,cAAgB,eAAetI,EAAKI,MAC1DoI,GAAaF,GAAgC,QAAtB1I,EAAGiB,QAAQ,QAKlC4H,EAAW,WACVC,sBAAsB,WACrBC,GAASA,EAAM3H,QAAQ,WAGzB4H,EAAW,WACLC,EAAQnD,GAAG,YACfmD,EAAQC,gBAAgB,QAAQC,IAAI,cAAeC,GAEpDC,EAAMC,YAAY,YAChBC,IAAI,WAAY,IAChBJ,IAAI,YAAYnJ,EAAGwJ,UAAWX,GAC5BD,EACHxE,GAAQA,EAAKmF,IAAI,aAAc,IACpBb,GACXW,EAAME,IAAI,QAAS,IACjBE,OAAO,MAAMF,IAAI,WAAY,KAGjCrJ,EAAW+C,EAAEyG,WACXxH,KAAK,SAASC,GACd,IAAIsH,EAASV,EAAMU,SAClBpJ,EAASL,EAAG2J,OAAOvJ,EAAKkB,KAAOlB,EAAKC,MAErC0I,EAAMI,MACFP,IACHvI,EAAOA,EAAKuJ,QAAQ,UAAW,cAEhCd,sBAAsB,WACjBJ,EACHK,EAAMc,YAAYxJ,GAEdoJ,EAAO9I,QACVoI,EAAMe,SACNL,EAAO1D,KAAK1F,IAEZwB,EAAOqE,KA/CD,0BA+CgBH,KAAK1F,KAI9B8B,GAASnC,EAAGmC,MAAMA,KAElBkB,OAAO,WACP2F,IACAhJ,EAAG+J,OAAO,SAAUC,GACpBhK,EAAGiK,WAELC,EAAO,SAASzD,GACf,IAAIpG,EAAS4C,EAAEkH,KAAKpB,EAAMlD,OAE1BuE,GADSpK,EAAG4D,mBAAmBvD,IACtB,GACTgK,EAAM,WACLtB,EAAMI,MACNH,IACIN,EACHK,EAAMc,YAAY7J,EAAG2J,OAAOtJ,IAE5B+D,EAAK2B,KAAK/F,EAAG2J,OAAOtJ,IAErBJ,EAAQC,EAAMK,EAAKH,EAAMC,IAM1B,GAHK4I,EAAQnD,GAAG,YACfuD,EAAME,IAAI,UAAW,IAET,KAATlJ,EAAa,CAChB,IAAKL,EAAGe,OAAOX,GACd,OAAOgJ,IAEJV,EACHK,EAAMc,YAAY7J,EAAG2J,OAAOvJ,EAAKC,OAEjC+D,EAAK2B,KAAK/F,EAAG2J,OAAOvJ,EAAKC,OAG3B,IAAKiK,GAAWjB,EAAM1I,OAAQ,CAI7B,GAFAoI,EAAMI,IAAI,QAEE,IAARzI,GAAaL,IAASD,EAAKC,KAC9B,OAAOH,EAAKgB,SAEb,GAAIlB,EAAGuK,QAAQC,WAAaxK,EAAGuK,QAAQC,UAAUC,KAChD,IACCL,EAAQpK,EAAGuK,QAAQC,UAAUC,KAAKpK,GACjC,MAAMoG,GACP2D,GAAQ,EAGV,GAAa,MAAT/J,GAAyB,OAATA,IAAkB+J,EAGrC,OAFAE,GAAU,EACVtK,EAAGmC,MAAoB,cAAd/B,EAAKgD,KAAsB,gBAAkB,cAAe6B,OAAO,EAAMyF,MAAO,WAAWC,WAAWtD,EAAQ,SAChH,EAER,GAAY,IAAR3G,GAAaV,EAAG4K,WAAWvK,EAAMD,EAAKkH,OAGzC,OAFAgD,GAAU,EACVtK,EAAGmC,OAAO,YAAa9B,IAAQ4E,OAAO,EAAMyF,MAAO,WAAWC,WAAWtD,EAAQ,SAC1E,EAGI,IAAR3G,EACH2J,KAEArK,EAAG6K,SACF7F,MAAQ,YACR8F,MAAS,iBAAkBpK,EAAK4C,EAAQjD,GAAOD,EAAKI,MAAMC,OAAOF,KACjEwK,QACC1G,MAAQ,SACRxB,SAAWwH,GAEZjB,QACC/E,MAAQ,YACRxB,SAAW,WACV8H,WAAW,WACVL,GAAU,EACVjD,KACE,SAINsD,WAAW,WACV3K,EAAGoB,QAAQ,iBAAkBN,MAAOd,EAAG0D,aACrCtC,QAAQ,eAAgBN,OAASV,EAAKI,MAAMC,OAAOF,MACnD,QAINwI,EAAQ9F,EAAE2F,EAAO,cAAgB,wBAC/BnD,GAAG,aAAc,WACbmD,GACHhJ,KAAKoL,MAAMC,OAAS,MACpBrL,KAAKoL,MAAMC,OAASrL,KAAKsL,aAAe,MAC9B1C,IACV5I,KAAKoL,MAAM7F,MAAQqD,EAAW,KAC1B5I,KAAKuL,YAAc3C,IACtB5I,KAAKoL,MAAM7F,MAAQvF,KAAKuL,YAAc,GAAK,SAI7C1F,GAAG,UAAW,SAASgB,GACvBA,EAAE2E,2BACE3E,EAAE4E,SAAWpI,EAAEyD,GAAG2E,QAAQC,OAC7BpL,EAAKgB,SACKuF,EAAE4E,SAAWpI,EAAEyD,GAAG2E,QAAQE,QACpC9E,EAAE4B,iBACFU,EAAM3H,QAAQ,WAGfqE,GAAG,2BAA4B,SAASgB,GACxCA,EAAE2B,kBACa,aAAX3B,EAAEzE,MACLyE,EAAE4B,mBAGH5C,GAAG,OAAQyE,GACXzE,GAAG,oCAAqC,SAASgB,GAEjDA,EAAE2B,oBAEJf,EAAS,WACR,IAAIhH,EAAOL,EAAG4D,mBAAmBmF,EAAMlD,OAAO,GACzCyE,IAAWtK,EAAGwL,GAAGC,QAAWzL,EAAGwL,GAAGE,MACtCzC,EAAQxD,GAAG,cAAe2D,GAAQF,gBAAgB,QAClDG,EAAME,IAAI,UAAWN,EAAQM,IAAI,WAAa,KAE7CvJ,EAAG2L,WAAa3L,EAAGiK,SACjBK,IACHA,GAAU,EACVvB,EAAMtD,GAAG,OAAQyE,IAElBnB,EAAM3H,QAAQ,SAASA,QAAQ,UAC/B2H,EAAM,GAAG6C,mBAAqB7C,EAAM,GAAG6C,kBAAkB,EAAGvL,EAAKM,SAElEyD,EAAOsE,EAAQ7G,EAAOgK,WAAWC,OAAO,WAAY,OAAsB,GAAflM,KAAKmM,UAAe9I,EAAErD,MAAM6J,SAASxB,KAAK,QAAUjI,EAAGgM,WAAW5L,EAAKI,QAC9HqB,EAAOqE,KAzLA,0BA0LXmD,EAAQjF,EAAKqF,SACbR,EAAUjJ,EAAGsF,MAAM,WACnB8D,EAAS,SAAS3C,GACZwC,EAAQnD,GAAG,YACfuD,EAAME,IAAI,UAAW,IAEhBe,IACLpK,EAAKgB,SACDuF,IACHA,EAAE2B,kBACF3B,EAAE4B,oBAIL2B,EAAS,WACRnI,EAAOT,QAAQ,gBAAiB6K,OAAQ,KAEzC3B,GAAU,EAmBX,OAjBAjB,EAAM6C,SAAS,YACb3C,IAAI,WAAY,YAChB9D,GAAG,YAAYzF,EAAGwJ,UAAWX,GAC/B7I,EAAGmM,KAAK,SAAUnC,GACdtB,EACHtE,EAAKyF,YAAYd,EAAMlD,IAAIzF,EAAKC,QAE5BuI,EACHxE,EAAKmF,IAAI,aAAc,QACZb,IACXF,EAAWa,EAAMlE,QACjBkE,EAAMlE,MAAMqD,EAAW,IACrBiB,OAAO,MAAMF,IAAI,WAAY,YAEhCnF,EAAK4B,QAAQnB,OAAOkE,EAAMlD,IAAIzF,EAAKC,QAGhCK,EAAM,GAAKV,EAAG4H,KAAO,MACjB1H,EAAKgB,SAGRd,GAASgE,EAAKzD,OAIfP,EAAKuH,SAAW3H,EAAGe,OAAOX,GACtBF,EAAKgB,QAAQ,YAAad,EAAKC,QAGvCL,EAAGoM,IAAI,SAAU,WAChBrD,EAAMU,SAAS9I,QAAUP,IAAiD,IAAzC6C,EAAEoJ,QAAQjM,EAAKI,KAAMR,EAAG0D,aAAsBqF,EAAM3H,QAAQ,UAG9F2H,EAAM3H,QAAQ,SAEdiG,IAEOnH,GAfCA,EAAKgB,OAAO,eAAgBtB,KAAKoF,QAkB1ChF,EAAGmM,KAAK,4CAA6C,SAAS1F,GAC7D,IACCrG,EADGG,GAAOkG,EAAE7F,KAAO6F,EAAE7F,KAAK8C,UAAY+C,EAAE7F,KAAKuF,QAAW,OAASnG,EAAG0D,WAEjEnD,GAAsB,IAAfA,EAAII,SAAiBP,EAAOJ,EAAGI,KAAKG,EAAI,MAAQP,EAAGe,OAAOX,GACpEL,EAAKiF,MAAQhF,EAAGsE,KAAK,aAAe,KAAOtE,EAAGsE,KAAK,cAAgB,IAEnEvE,EAAKiF,MAAQhF,EAAGsE,KAAK,aAEP,qBAAXmC,EAAEzE,KACLjC,EAAKuM,YAAO,EAASvM,EAAKiF,OAE1B8D,sBAAsB,WACrB/I,EAAKuM,YAAO,EAASvM,EAAKiF,WAG1B8E,OAAO,SAASrD,GAClB,IAAInG,EACAmG,EAAE7F,MAAQ6F,EAAE7F,KAAK2L,UAAYjM,EAAYN,EAAGiB,QAAQ,gBACvDgC,EAAEuJ,KAAK/F,EAAE7F,KAAK2L,QAAS,SAASE,EAAGC,GAC9BpM,EAAUoM,WACNpM,EAAUoM,KAGnB1M,EAAGiB,QAAQ,YAAaX,OAKpBd","file":"../../commands/rename.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"rename\". \n\t * Rename selected file.\n\t *\n\t * @author Dmitry (dio) Levashov, dio@std42.ru\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.rename = function() {\n\t\t\"use strict\";\n\n\t\t// set alwaysEnabled to allow root rename on client size\n\t\tthis.alwaysEnabled = true;\n\n\t\tthis.syncTitleOnChange = true;\n\n\t\tvar self = this,\n\t\t\tfm = self.fm,\n\t\t\trequest = function(dfrd, targtes, file, name) {\n\t\t\t\tvar sel = targtes? [file.hash].concat(targtes) : [file.hash],\n\t\t\t\t\tcnt = sel.length,\n\t\t\t\t\tdata = {}, rootNames;\n\t\t\t\t\n\t\t\t\tfm.lockfiles({files : sel});\n\t\t\t\t\n\t\t\t\tif (fm.isRoot(file) && !file.netkey) {\n\t\t\t\t\tif (!(rootNames = fm.storage('rootNames'))) {\n\t\t\t\t\t\trootNames = {};\n\t\t\t\t\t}\n\t\t\t\t\tif (name === '') {\n\t\t\t\t\t\tif (rootNames[file.hash]) {\n\t\t\t\t\t\t\tfile.name = file._name;\n\t\t\t\t\t\t\tfile.i18 = file._i18;\n\t\t\t\t\t\t\tdelete rootNames[file.hash];\n\t\t\t\t\t\t\tdelete file._name;\n\t\t\t\t\t\t\tdelete file._i18;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd && dfrd.reject();\n\t\t\t\t\t\t\tfm.unlockfiles({files : sel}).trigger('selectfiles', {files : sel});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (typeof file._name === 'undefined') {\n\t\t\t\t\t\t\tfile._name = file.name;\n\t\t\t\t\t\t\tfile._i18 = file.i18;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfile.name = rootNames[file.hash] = name;\n\t\t\t\t\t\tdelete file.i18;\n\t\t\t\t\t}\n\t\t\t\t\tfm.storage('rootNames', rootNames);\n\t\t\t\t\tdata = { changed: [file] };\n\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\tfm.change(data);\n\t\t\t\t\tdfrd && dfrd.resolve(data);\n\t\t\t\t\tfm.unlockfiles({files : sel}).trigger('selectfiles', {files : sel});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdata = {\n\t\t\t\t\tcmd : 'rename',\n\t\t\t\t\tname : name,\n\t\t\t\t\ttarget : file.hash\n\t\t\t\t};\n\n\t\t\t\tif (cnt > 1) {\n\t\t\t\t\tdata['targets'] = targtes;\n\t\t\t\t\tif (name.match(/\\*/)) {\n\t\t\t\t\t\tdata['q'] = name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.request({\n\t\t\t\t\t\tdata   : data,\n\t\t\t\t\t\tnotify : {type : 'rename', cnt : cnt},\n\t\t\t\t\t\tnavigate : {}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tvar err = fm.parseError(error);\n\t\t\t\t\t\tdfrd && dfrd.reject();\n\t\t\t\t\t\tif (! err || ! Array.isArray(err) || err[0] !== 'errRename') {\n\t\t\t\t\t\t\tfm.sync();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tvar cwdHash;\n\t\t\t\t\t\tif (data.added && data.added.length && cnt === 1) {\n\t\t\t\t\t\t\tdata.undo = {\n\t\t\t\t\t\t\t\tcmd : 'rename',\n\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'rename', target : data.added[0].hash, name : file.name},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'undo', cnt : 1}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdata.redo = {\n\t\t\t\t\t\t\t\tcmd : 'rename',\n\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'rename', target : file.hash, name : name},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'rename', cnt : 1}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdfrd && dfrd.resolve(data);\n\t\t\t\t\t\tif (!(cwdHash = fm.cwd().hash) || cwdHash === file.hash) {\n\t\t\t\t\t\t\tfm.exec('open', $.map(data.added, function(f) {\n\t\t\t\t\t\t\t\treturn (f.mime === 'directory')? f.hash : null;\n\t\t\t\t\t\t\t})[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tfm.unlockfiles({files : sel}).trigger('selectfiles', {files : sel});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tgetHint = function(name, target) {\n\t\t\t\tvar sel = target || fm.selected(),\n\t\t\t\t\tsplits = fm.splitFileExtention(name),\n\t\t\t\t\tf1 = fm.file(sel[0]),\n\t\t\t\t\tf2 = fm.file(sel[1]),\n\t\t\t\t\text, hint, add;\n\t\t\t\t\n\t\t\t\text = splits[1]? ('.' + splits[1]) : '';\n\t\t\t\tif (splits[1] && splits[0] === '*') {\n\t\t\t\t\t// change extention\n\t\t\t\t\thint =  '\"' + fm.splitFileExtention(f1.name)[0] + ext + '\", ';\n\t\t\t\t\thint += '\"' + fm.splitFileExtention(f2.name)[0] + ext + '\"';\n\t\t\t\t} else if (splits[0].length > 1) {\n\t\t\t\t\tif (splits[0].substr(-1) === '*') {\n\t\t\t\t\t\t// add prefix\n\t\t\t\t\t\tadd = splits[0].substr(0, splits[0].length - 1);\n\t\t\t\t\t\thint =  '\"' + add + f1.name+'\", ';\n\t\t\t\t\t\thint += '\"' + add + f2.name+'\"';\n\t\t\t\t\t} else if (splits[0].substr(0, 1) === '*') {\n\t\t\t\t\t\t// add suffix\n\t\t\t\t\t\tadd = splits[0].substr(1);\n\t\t\t\t\t\thint =  '\"'+fm.splitFileExtention(f1.name)[0] + add + ext + '\", ';\n\t\t\t\t\t\thint += '\"'+fm.splitFileExtention(f2.name)[0] + add + ext + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!hint) {\n\t\t\t\t\thint = '\"'+splits[0] + '1' + ext + '\", \"' + splits[0] + '2' + ext + '\"';\n\t\t\t\t}\n\t\t\t\tif (sel.length > 2) {\n\t\t\t\t\thint += ' ...';\n\t\t\t\t}\n\t\t\t\treturn hint;\n\t\t\t},\n\t\t\tbatchRename = function() {\n\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\ttplr = '<input name=\"type\" type=\"radio\" class=\"elfinder-tabstop\">',\n\t\t\t\t\tmkChk = function(node, label) {\n\t\t\t\t\t\treturn $('<label class=\"elfinder-rename-batch-checks\">' + fm.i18n(label) + '</label>').prepend(node);\n\t\t\t\t\t},\n\t\t\t\t\tname = $('<input type=\"text\" class=\"ui-corner-all elfinder-tabstop\">'),\n\t\t\t\t\tnum  = $(tplr),\n\t\t\t\t\tprefix  = $(tplr),\n\t\t\t\t\tsuffix  = $(tplr),\n\t\t\t\t\textention  = $(tplr),\n\t\t\t\t\tchecks = $('<div/>').append(\n\t\t\t\t\t\tmkChk(num, 'plusNumber'),\n\t\t\t\t\t\tmkChk(prefix, 'asPrefix'),\n\t\t\t\t\t\tmkChk(suffix, 'asSuffix'),\n\t\t\t\t\t\tmkChk(extention, 'changeExtention')\n\t\t\t\t\t),\n\t\t\t\t\tpreview = $('<div class=\"elfinder-rename-batch-preview\"/>'),\n\t\t\t\t\tnode = $('<div class=\"elfinder-rename-batch\"/>').append(\n\t\t\t\t\t\t\t$('<div class=\"elfinder-rename-batch-name\"/>').append(name),\n\t\t\t\t\t\t\t$('<div class=\"elfinder-rename-batch-type\"/>').append(checks),\n\t\t\t\t\t\t\tpreview\n\t\t\t\t\t\t),\n\t\t\t\t\topts = {\n\t\t\t\t\t\ttitle : fm.i18n('batchRename'),\n\t\t\t\t\t\tmodal : true,\n\t\t\t\t\t\tdestroyOnClose : true,\n\t\t\t\t\t\twidth: Math.min(380, fm.getUI().width() - 20),\n\t\t\t\t\t\tbuttons : {},\n\t\t\t\t\t\topen : function() {\n\t\t\t\t\t\t\tname.on('input', mkPrev).trigger('focus');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgetName = function() {\n\t\t\t\t\t\tvar vName = name.val(),\n\t\t\t\t\t\t\text = fm.splitFileExtention(fm.file(sel[0]).name)[1];\n\t\t\t\t\t\tif (vName !== '' || num.is(':checked')) {\n\t\t\t\t\t\t\tif (prefix.is(':checked')) {\n\t\t\t\t\t\t\t\tvName += '*';\n\t\t\t\t\t\t\t} else if (suffix.is(':checked')) {\n\t\t\t\t\t\t\t\tvName = '*' + vName + '.' + ext;\n\t\t\t\t\t\t\t} else if (extention.is(':checked')) {\n\t\t\t\t\t\t\t\tvName = '*.' + vName;\n\t\t\t\t\t\t\t} else if (ext) {\n\t\t\t\t\t\t\t\tvName += '.' + ext;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn vName;\n\t\t\t\t\t},\n\t\t\t\t\tmkPrev = function() {\n\t\t\t\t\t\tvar vName = getName();\n\t\t\t\t\t\tif (vName !== '') {\n\t\t\t\t\t\t\tpreview.html(fm.i18n(['renameMultiple', sel.length, getHint(vName)]));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpreview.empty();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tradios = checks.find('input:radio').on('change', mkPrev),\n\t\t\t\t\tdialog;\n\t\t\t\t\n\t\t\t\topts.buttons[fm.i18n('btnApply')] = function() {\n\t\t\t\t\tvar vName = getName(),\n\t\t\t\t\t\tfile, targets;\n\t\t\t\t\tif (vName !== '') {\n\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\ttargets = sel;\n\t\t\t\t\t\tfile = fm.file(targets.shift());\n\t\t\t\t\t\trequest(void(0), targets, file, vName);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\topts.buttons[fm.i18n('btnCancel')] = function() {\n\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t};\n\t\t\t\tif ($.fn.checkboxradio) {\n\t\t\t\t\tradios.checkboxradio({\n\t\t\t\t\t\tcreate: function(e, ui) {\n\t\t\t\t\t\t\tif (this === num.get(0)) {\n\t\t\t\t\t\t\t\tnum.prop('checked', true).change();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tchecks.buttonset({\n\t\t\t\t\t\tcreate: function(e, ui) {\n\t\t\t\t\t\t\tnum.prop('checked', true).change();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tdialog = self.fmDialog(node, opts);\n\t\t\t};\n\t\t\n\t\tthis.noChangeDirOnRemovedCwd = true;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern : 'f2' + (fm.OS == 'mac' ? ' enter' : '')\n\t\t}, {\n\t\t\tpattern : 'shift+f2',\n\t\t\tdescription : 'batchRename',\n\t\t\tcallback : function() {\n\t\t\t\tfm.selected().length > 1 && batchRename();\n\t\t\t}\n\t\t}];\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length,\n\t\t\t\tphash, ext, mime, brk, state, isRoot;\n\t\t\t\n\t\t\tif (!cnt) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t\n\t\t\tif (cnt > 1 && sel[0].phash) {\n\t\t\t\tphash = sel[0].phash;\n\t\t\t\text = fm.splitFileExtention(sel[0].name)[1].toLowerCase();\n\t\t\t\tmime = sel[0].mime;\n\t\t\t}\n\t\t\tif (cnt === 1) {\n\t\t\t\tisRoot = fm.isRoot(sel[0]);\n\t\t\t}\n\n\t\t\tstate = (cnt === 1 && ((fm.cookieEnabled && isRoot) || !sel[0].locked) || (fm.api > 2.1030 && cnt === $.grep(sel, function(f) {\n\t\t\t\tif (!brk && !f.locked && f.phash === phash && !fm.isRoot(f) && (mime === f.mime || ext === fm.splitFileExtention(f.name)[1].toLowerCase())) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tbrk && (brk = true);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}).length)) ? 0 : -1;\n\t\t\t\n\t\t\t// because alwaysEnabled = true, it need check disabled on connector \n\t\t\tif (!isRoot && state === 0 && fm.option('disabledFlip', sel[0].hash)['rename']) {\n\t\t\t\tstate = -1;\n\t\t\t}\n\n\t\t\tif (state !== -1 && cnt > 1) {\n\t\t\t\tself.extra = {\n\t\t\t\t\ticon: 'preference',\n\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t.attr({title: fm.i18n('batchRename')})\n\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tfm.getUI().trigger('click'); // to close the context menu immediately\n\t\t\t\t\t\t\tbatchRename();\n\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tdelete self.extra;\n\t\t\t}\n\t\t\t\t\n\t\t\treturn state;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpts) {\n\t\t\tvar cwd      = fm.getUI('cwd'),\n\t\t\t\tsel      = hashes || (fm.selected().length? fm.selected() : false) || [fm.cwd().hash],\n\t\t\t\tcnt      = sel.length,\n\t\t\t\tfile     = fm.file(sel.shift()),\n\t\t\t\tfilename = '.elfinder-cwd-filename',\n\t\t\t\topts     = cOpts || {},\n\t\t\t\tincwd    = (fm.cwd().hash == file.hash),\n\t\t\t\ttype     = (opts._currentType === 'navbar' || opts._currentType === 'files')? opts._currentType : (incwd? 'navbar' : 'files'),\n\t\t\t\tnavbar   = (type !== 'files'),\n\t\t\t\ttarget   = fm[navbar? 'navHash2Elm' : 'cwdHash2Elm'](file.hash),\n\t\t\t\ttarea    = (!navbar && fm.storage('view') != 'list'),\n\t\t\t\tsplit    = function(name) {\n\t\t\t\t\tvar ext = fm.splitFileExtention(name)[1];\n\t\t\t\t\treturn [name.substr(0, name.length - ext.length - 1), ext];\n\t\t\t\t},\n\t\t\t\tunselect = function() {\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tinput && input.trigger('blur');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\trest     = function(){\n\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\toverlay.elfinderoverlay('hide').off('click close', cancel);\n\t\t\t\t\t}\n\t\t\t\t\tpnode.removeClass('ui-front')\n\t\t\t\t\t\t.css('position', '')\n\t\t\t\t\t\t.off('unselect.'+fm.namespace, unselect);\n\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\tnode && node.css('max-height', '');\n\t\t\t\t\t} else if (!navbar) {\n\t\t\t\t\t\tpnode.css('width', '')\n\t\t\t\t\t\t\t.parent('td').css('overflow', '');\n\t\t\t\t\t}\n\t\t\t\t}, colwidth,\n\t\t\t\tdfrd     = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tvar parent = input.parent(),\n\t\t\t\t\t\t\tname   = fm.escape(file.i18 || file.name);\n\n\t\t\t\t\t\tinput.off();\n\t\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\t\tname = name.replace(/([_.])/g, '&#8203;$1');\n\t\t\t\t\t\t}\n\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\t\tinput.replaceWith(name);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (parent.length) {\n\t\t\t\t\t\t\t\t\tinput.remove();\n\t\t\t\t\t\t\t\t\tparent.html(name);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttarget.find(filename).html(name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\trest();\n\t\t\t\t\t\tfm.unbind('resize', resize);\n\t\t\t\t\t\tfm.enable();\n\t\t\t\t\t}),\n\t\t\t\tblur = function(e) {\n\t\t\t\t\tvar name   = $.trim(input.val()),\n\t\t\t\t\tsplits = fm.splitFileExtention(name),\n\t\t\t\t\tvalid  = true,\n\t\t\t\t\treq = function() {\n\t\t\t\t\t\tinput.off();\n\t\t\t\t\t\trest();\n\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\tinput.replaceWith(fm.escape(name));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.html(fm.escape(name));\n\t\t\t\t\t\t}\n\t\t\t\t\t\trequest(dfrd, sel, file, name);\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\tpnode.css('z-index', '');\n\t\t\t\t\t}\n\t\t\t\t\tif (name === '') {\n\t\t\t\t\t\tif (!fm.isRoot(file)) {\n\t\t\t\t\t\t\treturn cancel();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\tinput.replaceWith(fm.escape(file.name));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.html(fm.escape(file.name));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!inError && pnode.length) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tinput.off('blur');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cnt === 1 && name === file.name) {\n\t\t\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (fm.options.validName && fm.options.validName.test) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvalid = fm.options.validName.test(name);\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (name === '.' || name === '..' || !valid) {\n\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\tfm.error(file.mime === 'directory'? 'errInvDirname' : 'errInvName', {modal: true, close: function(){setTimeout(select, 120);}});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cnt === 1 && fm.fileByName(name, file.phash)) {\n\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\tfm.error(['errExists', name], {modal: true, close: function(){setTimeout(select, 120);}});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cnt === 1) {\n\t\t\t\t\t\t\treq();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\ttitle : 'cmdrename',\n\t\t\t\t\t\t\t\ttext  : ['renameMultiple', cnt, getHint(name, [file.hash].concat(sel))],\n\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\tlabel : 'btnYes',\n\t\t\t\t\t\t\t\t\tcallback : req\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\t\t\t\t\tselect();\n\t\t\t\t\t\t\t\t\t\t}, 120);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', {files: fm.selected()})\n\t\t\t\t\t\t\t\t\t.trigger('selectfiles', {files : [file.hash].concat(sel)});\n\t\t\t\t\t\t\t}, 120);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinput = $(tarea? '<textarea/>' : '<input type=\"text\"/>')\n\t\t\t\t\t.on('keyup text', function(){\n\t\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\t\tthis.style.height = '1px';\n\t\t\t\t\t\t\tthis.style.height = this.scrollHeight + 'px';\n\t\t\t\t\t\t} else if (colwidth) {\n\t\t\t\t\t\t\tthis.style.width = colwidth + 'px';\n\t\t\t\t\t\t\tif (this.scrollWidth > colwidth) {\n\t\t\t\t\t\t\t\tthis.style.width = this.scrollWidth + 10 + 'px';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t} else if (e.keyCode == $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tinput.trigger('blur');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('mousedown click dblclick', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (e.type === 'dblclick') {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('blur', blur)\n\t\t\t\t\t.on('dragenter dragleave dragover drop', function(e) {\n\t\t\t\t\t\t// stop bubbling to prevent upload with native drop event\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}),\n\t\t\t\tselect = function() {\n\t\t\t\t\tvar name = fm.splitFileExtention(input.val())[0];\n\t\t\t\t\tif (!inError && fm.UA.Mobile && !fm.UA.iOS) { // since iOS has a bug? (z-index not effect) so disable it\n\t\t\t\t\t\toverlay.on('click close', cancel).elfinderoverlay('show');\n\t\t\t\t\t\tpnode.css('z-index', overlay.css('z-index') + 1);\n\t\t\t\t\t}\n\t\t\t\t\t! fm.enabled() && fm.enable();\n\t\t\t\t\tif (inError) {\n\t\t\t\t\t\tinError = false;\n\t\t\t\t\t\tinput.on('blur', blur);\n\t\t\t\t\t}\n\t\t\t\t\tinput.trigger('focus').trigger('select');\n\t\t\t\t\tinput[0].setSelectionRange && input[0].setSelectionRange(0, name.length);\n\t\t\t\t},\n\t\t\t\tnode = navbar? target.contents().filter(function(){ return this.nodeType==3 && $(this).parent().attr('id') === fm.navHash2Id(file.hash); })\n\t\t\t\t\t\t: target.find(filename),\n\t\t\t\tpnode = node.parent(),\n\t\t\t\toverlay = fm.getUI('overlay'),\n\t\t\t\tcancel = function(e) { \n\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\tpnode.css('z-index', '');\n\t\t\t\t\t}\n\t\t\t\t\tif (! inError) {\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresize = function() {\n\t\t\t\t\ttarget.trigger('scrolltoview', {blink : false});\n\t\t\t\t},\n\t\t\t\tinError = false;\n\t\t\t\n\t\t\tpnode.addClass('ui-front')\n\t\t\t\t.css('position', 'relative')\n\t\t\t\t.on('unselect.'+fm.namespace, unselect);\n\t\t\tfm.bind('resize', resize);\n\t\t\tif (navbar) {\n\t\t\t\tnode.replaceWith(input.val(file.name));\n\t\t\t} else {\n\t\t\t\tif (tarea) {\n\t\t\t\t\tnode.css('max-height', 'none');\n\t\t\t\t} else if (!navbar) {\n\t\t\t\t\tcolwidth = pnode.width();\n\t\t\t\t\tpnode.width(colwidth - 15)\n\t\t\t\t\t\t.parent('td').css('overflow', 'visible');\n\t\t\t\t}\n\t\t\t\tnode.empty().append(input.val(file.name));\n\t\t\t}\n\t\t\t\n\t\t\tif (cnt > 1 && fm.api <= 2.1030) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tif (!file || !node.length) {\n\t\t\t\treturn dfrd.reject('errCmdParams', this.title);\n\t\t\t}\n\t\t\t\n\t\t\tif (file.locked && !fm.isRoot(file)) {\n\t\t\t\treturn dfrd.reject(['errLocked', file.name]);\n\t\t\t}\n\t\t\t\n\t\t\tfm.one('select', function() {\n\t\t\t\tinput.parent().length && file && $.inArray(file.hash, fm.selected()) === -1 && input.trigger('blur');\n\t\t\t});\n\t\t\t\n\t\t\tinput.trigger('keyup');\n\t\t\t\n\t\t\tselect();\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t\tfm.bind('select contextmenucreate closecontextmenu', function(e) {\n\t\t\tvar sel = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected(),\n\t\t\t\tfile;\n\t\t\tif (sel && sel.length === 1 && (file = fm.file(sel[0])) && fm.isRoot(file)) {\n\t\t\t\tself.title = fm.i18n('kindAlias') + ' (' + fm.i18n('preference') + ')';\n\t\t\t} else {\n\t\t\t\tself.title = fm.i18n('cmdrename');\n\t\t\t}\n\t\t\tif (e.type !== 'closecontextmenu') {\n\t\t\t\tself.update(void(0), self.title);\n\t\t\t} else {\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.update(void(0), self.title);\n\t\t\t\t});\n\t\t\t}\n\t\t}).remove(function(e) {\n\t\t\tvar rootNames;\n\t\t\tif (e.data && e.data.removed && (rootNames = fm.storage('rootNames'))) {\n\t\t\t\t$.each(e.data.removed, function(i, h) {\n\t\t\t\t\tif (rootNames[h]) {\n\t\t\t\t\t\tdelete rootNames[h];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tfm.storage('rootNames', rootNames);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn elFinder;\n\n});"]}