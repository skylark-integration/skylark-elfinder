{"version":3,"sources":["commands/rm.js"],"names":["define","elFinder","prototype","commands","rm","self","this","fm","tpl","remove","dfrd","targets","quiet","notify","type","cnt","length","request","data","cmd","preventFail","fail","error","reject","done","warning","sync","resolve","always","unlockfiles","files","getTHash","root1st","thash","searchStatus","state","file","root","volumeid","$","grep","h","indexOf","option","getSize","confirm","tHash","addTexts","dialog","text","tmb","size","f","fname","cwd","hash","descs","spinner","i18n","each","mime","s","parseInt","push","formatSize","replace","join","formatDate","escape","i18","name","mime2class","concat","title","accept","label","callback","toTrash","cancel","phash","select","selected","selectfiles","on","find","addClass","className","css","url","attr","map","parent","html","formated","req","dirs","dsts","itemCnt","maxCnt","options","toTrashMaxItems","checkDirs","reqDfd","Deferred","i","m","path","match","hideCnt","preventDefault","fileCnt","dirCnt","setTimeout","xhr","syncOnFail","infoCheckWait","Object","keys","target","hashes","tm","prg","prgSt","err","res","hasNtf","ui","children","progress","notifyDelay","dir","reqData","dst","cut","normalize","updateCache","undo","prevUndo","redo","prevRedo","k","v","Array","isArray","added","inArray","exec","noToast","margeRes","removed","add","changed","change","trigger","end","clearTimeout","messages","slice","forceRm","_noSound","syncTitleOnChange","updateOnSelect","shortcuts","pattern","value","init","extra","button","icon","node","e","originalEvent","touches","stopPropagation","getUI","_userAction","getstate","sel","locked","isRoot","cOpts","opts","soundFile","event","shiftKey","lockfiles","quickTrash","bind","update"],"mappings":"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","file":"../../commands/rm.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"rm\"\n\t * Delete files\n\t *\n\t * @author Dmitry (dio) Levashov\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.rm = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\ttpl = '<div class=\"ui-helper-clearfix elfinder-rm-title\"><span class=\"elfinder-cwd-icon {class} ui-corner-all\"/>{title}<div class=\"elfinder-rm-desc\">{desc}</div></div>',\n\t\t\tconfirm = function(dfrd, targets, files, tHash, addTexts) {\n\t\t\t\tvar cnt = targets.length,\n\t\t\t\t\tcwd = fm.cwd().hash,\n\t\t\t\t\tdescs = [],\n\t\t\t\t\tspinner = fm.i18n('calc') + '<span class=\"elfinder-spinner\"/>',\n\t\t\t\t\tdialog, text, tmb, size, f, fname;\n\t\t\t\t\n\t\t\t\tif (cnt > 1) {\n\t\t\t\t\tsize = 0;\n\t\t\t\t\t$.each(files, function(h, f) { \n\t\t\t\t\t\tif (f.size && f.size != 'unknown' && f.mime !== 'directory') {\n\t\t\t\t\t\t\tvar s = parseInt(f.size);\n\t\t\t\t\t\t\tif (s >= 0 && size >= 0) {\n\t\t\t\t\t\t\t\tsize += s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsize = 'unknown';\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tgetSize = (size === 'unknown');\n\t\t\t\t\tdescs.push(fm.i18n('size')+': '+(getSize? spinner : fm.formatSize(size)));\n\t\t\t\t\ttext = [$(tpl.replace('{class}', 'elfinder-cwd-icon-group').replace('{title}', '<strong>' + fm.i18n('items')+ ': ' + cnt + '</strong>').replace('{desc}', descs.join('<br>')))];\n\t\t\t\t} else {\n\t\t\t\t\tf = files[0];\n\t\t\t\t\ttmb = fm.tmb(f);\n\t\t\t\t\tgetSize = (f.mime === 'directory');\n\t\t\t\t\tdescs.push(fm.i18n('size')+': '+(getSize? spinner : fm.formatSize(f.size)));\n\t\t\t\t\tdescs.push(fm.i18n('modify')+': '+fm.formatDate(f));\n\t\t\t\t\tfname = fm.escape(f.i18 || f.name).replace(/([_.])/g, '&#8203;$1');\n\t\t\t\t\ttext = [$(tpl.replace('{class}', fm.mime2class(f.mime)).replace('{title}', '<strong>' + fname + '</strong>').replace('{desc}', descs.join('<br>')))];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (addTexts) {\n\t\t\t\t\ttext = text.concat(addTexts);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttext.push(tHash? 'confirmTrash' : 'confirmRm');\n\t\t\t\t\n\t\t\t\tdialog = fm.confirm({\n\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\ttext   : text,\n\t\t\t\t\taccept : {\n\t\t\t\t\t\tlabel    : 'btnRm',\n\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\tif (tHash) {\n\t\t\t\t\t\t\t\tself.toTrash(dfrd, targets, tHash);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tremove(dfrd, targets);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcancel : {\n\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\tif (targets.length === 1 && fm.file(targets[0]).phash !== cwd) {\n\t\t\t\t\t\t\t\tfm.select({selected : targets});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.selectfiles({files : targets});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// load thumbnail\n\t\t\t\tif (tmb) {\n\t\t\t\t\t$('<img/>')\n\t\t\t\t\t\t.on('load', function() { dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\"); })\n\t\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (getSize) {\n\t\t\t\t\tgetSize = fm.getSize($.map(files, function(f) { return f.mime === 'directory'? f.hash : null; })).done(function(data) {\n\t\t\t\t\t\tdialog.find('span.elfinder-spinner').parent().html(fm.i18n('size')+': '+data.formated);\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdialog.find('span.elfinder-spinner').parent().html(fm.i18n('size')+': '+fm.i18n('unknown'));\n\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\tgetSize = false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ttoTrash = function(dfrd, targets, tHash) {\n\t\t\t\tvar dsts = {},\n\t\t\t\t\titemCnt = targets.length,\n\t\t\t\t\tmaxCnt = self.options.toTrashMaxItems,\n\t\t\t\t\tcheckDirs = [],\n\t\t\t\t\treqDfd = $.Deferred(),\n\t\t\t\t\treq, dirs, cnt;\n\t\t\t\t\n\t\t\t\tif (itemCnt > maxCnt) {\n\t\t\t\t\tself.confirm(dfrd, targets, self.files(targets), null, [fm.i18n('tooManyToTrash')]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Directory preparation preparation and directory enumeration\n\t\t\t\t$.each(targets, function(i, h) {\n\t\t\t\t\tvar file = fm.file(h),\n\t\t\t\t\t\tpath = fm.path(h).replace(/\\\\/g, '/'),\n\t\t\t\t\t\tm = path.match(/^[^\\/]+?(\\/(?:[^\\/]+?\\/)*)[^\\/]+?$/);\n\t\t\t\t\t\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tif (m) {\n\t\t\t\t\t\t\tm[1] = m[1].replace(/(^\\/.*?)\\/?$/, '$1');\n\t\t\t\t\t\t\tif (! dsts[m[1]]) {\n\t\t\t\t\t\t\t\tdsts[m[1]] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdsts[m[1]].push(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (file.mime === 'directory') {\n\t\t\t\t\t\t\tcheckDirs.push(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Check directory information\n\t\t\t\tif (checkDirs.length) {\n\t\t\t\t\treq = fm.request({\n\t\t\t\t\t\tdata : {cmd : 'size', targets : checkDirs},\n\t\t\t\t\t\tnotify : {type: 'readdir', cnt: 1, hideCnt: true},\n\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\tvar cnt = 0;\n\t\t\t\t\t\tdata.fileCnt && (cnt += parseInt(data.fileCnt));\n\t\t\t\t\t\tdata.dirCnt && (cnt += parseInt(data.dirCnt));\n\t\t\t\t\t\treqDfd[cnt > maxCnt ? 'reject' : 'resolve']();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\treqDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tvar xhr = (req && req.xhr)? req.xhr : null;\n\t\t\t\t\t\tif (xhr && xhr.state() == 'pending') {\n\t\t\t\t\t\t\treq.syncOnFail(false);\n\t\t\t\t\t\t\treq.reject();\n\t\t\t\t\t\t\treqDfd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, self.options.infoCheckWait * 1000);\n\t\t\t\t} else {\n\t\t\t\t\treqDfd.resolve();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Directory creation and paste command execution\n\t\t\t\treqDfd.done(function() {\n\t\t\t\t\tdirs = Object.keys(dsts);\n\t\t\t\t\tcnt = dirs.length;\n\t\t\t\t\tif (cnt) {\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata   : {cmd  : 'mkdir', target : tHash, dirs : dirs}, \n\t\t\t\t\t\t\tnotify : {type : 'chkdir', cnt : cnt},\n\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar margeRes = function(data, phash, reqData) {\n\t\t\t\t\t\t\t\t\tvar undo, prevUndo, redo, prevRedo;\n\t\t\t\t\t\t\t\t\t$.each(data, function(k, v) {\n\t\t\t\t\t\t\t\t\t\tif (Array.isArray(v)) {\n\t\t\t\t\t\t\t\t\t\t\tif (res[k]) {\n\t\t\t\t\t\t\t\t\t\t\t\tres[k] = res[k].concat(v);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tres[k] = v;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (data.sync) {\n\t\t\t\t\t\t\t\t\t\tres.sync = 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tundo = function() {\n\t\t\t\t\t\t\t\t\t\t\tvar targets = [],\n\t\t\t\t\t\t\t\t\t\t\t\tdirs    = $.map(data.added, function(f) { return f.mime === 'directory'? f.hash : null; });\n\t\t\t\t\t\t\t\t\t\t\t$.each(data.added, function(i, f) {\n\t\t\t\t\t\t\t\t\t\t\t\tif ($.inArray(f.phash, dirs) === -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttargets.push(f.hash);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\treturn fm.exec('restore', targets, {noToast: true});\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tredo = function() {\n\t\t\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata   : reqData,\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'redo', cnt : targets.length}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tif (res.undo) {\n\t\t\t\t\t\t\t\t\t\t\tprevUndo = res.undo;\n\t\t\t\t\t\t\t\t\t\t\tres.undo = function() {\n\t\t\t\t\t\t\t\t\t\t\t\tundo();\n\t\t\t\t\t\t\t\t\t\t\t\tprevUndo();\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tres.undo = undo;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (res.redo) {\n\t\t\t\t\t\t\t\t\t\t\tprevRedo = res.redo;\n\t\t\t\t\t\t\t\t\t\t\tres.redo = function() {\n\t\t\t\t\t\t\t\t\t\t\t\tredo();\n\t\t\t\t\t\t\t\t\t\t\t\tprevRedo();\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tres.redo = redo;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terr = ['errTrash'],\n\t\t\t\t\t\t\t\tres = {},\n\t\t\t\t\t\t\t\thasNtf = function() {\n\t\t\t\t\t\t\t\t\treturn fm.ui.notify.children('.elfinder-notify-trash').length;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\thashes, tm, prg, prgSt;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (hashes = data.hashes) {\n\t\t\t\t\t\t\t\tprg = 1 / cnt * 100;\n\t\t\t\t\t\t\t\tprgSt = cnt === 1? 100 : 5;\n\t\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\t\tfm.notify({type : 'trash', cnt : 1, hideCnt : true, progress : prgSt});\n\t\t\t\t\t\t\t\t}, fm.notifyDelay);\n\t\t\t\t\t\t\t\t$.each(dsts, function(dir, files) {\n\t\t\t\t\t\t\t\t\tvar phash = fm.file(files[0]).phash,\n\t\t\t\t\t\t\t\t\t\treqData;\n\t\t\t\t\t\t\t\t\tif (hashes[dir]) {\n\t\t\t\t\t\t\t\t\t\treqData = {cmd : 'paste', dst : hashes[dir], targets : files, cut : 1};\n\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\tdata : reqData,\n\t\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\t\terr = err.concat(error);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\tdata = fm.normalize(data);\n\t\t\t\t\t\t\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\t\t\t\t\t\t\tmargeRes(data, phash, reqData);\n\t\t\t\t\t\t\t\t\t\t\tif (data.warning) {\n\t\t\t\t\t\t\t\t\t\t\t\terr = err.concat(data.warning);\n\t\t\t\t\t\t\t\t\t\t\t\tdelete data.warning;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// fire some event to update cache/ui\n\t\t\t\t\t\t\t\t\t\t\tdata.removed && data.removed.length && fm.remove(data);\n\t\t\t\t\t\t\t\t\t\t\tdata.added   && data.added.length   && fm.add(data);\n\t\t\t\t\t\t\t\t\t\t\tdata.changed && data.changed.length && fm.change(data);\n\t\t\t\t\t\t\t\t\t\t\t// fire event with command name\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('paste', data);\n\t\t\t\t\t\t\t\t\t\t\t// fire event with command name + 'done'\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('pastedone');\n\t\t\t\t\t\t\t\t\t\t\t// force update content\n\t\t\t\t\t\t\t\t\t\t\tdata.sync && fm.sync();\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\tvar hashes = [], addTexts, end = 2;\n\t\t\t\t\t\t\t\t\t\t\tif (hasNtf()) {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.notify({type : 'trash', cnt : 0, hideCnt : true, progress : prg});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tprgSt+= prg;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (--cnt < 1) {\n\t\t\t\t\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\t\t\t\t\thasNtf() && fm.notify({type : 'trash', cnt  : -1});\n\t\t\t\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\t\t\t\t\t\tif (Object.keys(res).length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (err.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.removed || res.removed.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thashes = $.grep(targets, function(h) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn $.inArray(h, res.removed) === -1? true : false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (err.length > end) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend = (fm.messages[err[end-1]] || '').indexOf('$') === -1? end : end + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('rm', hashes, { addTexts: err.slice(0, end), forceRm: true });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.error(err);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tres._noSound = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.undo && res.redo) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tres.undo = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd : 'trash',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcallback : res.undo,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tres.redo = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd : 'trash',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcallback : res.redo\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve(res);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(err);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.reject('errFolderNotFound');\n\t\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfrd.reject(['error', 'The folder hierarchy to be deleting can not be determined.']);\n\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t}\n\t\t\t\t}).fail(function() {\n\t\t\t\t\tself.confirm(dfrd, targets, self.files(targets), null, [fm.i18n('tooManyToTrash')]);\n\t\t\t\t});\n\t\t\t},\n\t\t\tremove = function(dfrd, targets, quiet) {\n\t\t\t\tvar notify = quiet? {} : {type : 'rm', cnt : targets.length};\n\t\t\t\tfm.request({\n\t\t\t\t\tdata   : {cmd  : 'rm', targets : targets}, \n\t\t\t\t\tnotify : notify,\n\t\t\t\t\tpreventFail : true\n\t\t\t\t})\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tif (data.error || data.warning) {\n\t\t\t\t\t\tdata.sync = true;\n\t\t\t\t\t}\n\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t})\n\t\t\t\t.always(function() {\n\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetTHash = function(targets) {\n\t\t\t\tvar thash = null,\n\t\t\t\t\troot1st;\n\t\t\t\t\n\t\t\t\tif (targets && targets.length) {\n\t\t\t\t\tif (targets.length > 1 && fm.searchStatus.state === 2) {\n\t\t\t\t\t\troot1st = fm.file(fm.root(targets[0])).volumeid;\n\t\t\t\t\t\tif (!$.grep(targets, function(h) { return h.indexOf(root1st) !== 0? true : false ; }).length) {\n\t\t\t\t\t\t\tthash = fm.option('trashHash', targets[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthash = fm.option('trashHash', targets[0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn thash;\n\t\t\t},\n\t\t\tgetSize = false;\n\t\t\n\t\t// for to be able to overwrite\n\t\tthis.confirm = confirm;\n\t\tthis.toTrash = toTrash;\n\t\tthis.remove = remove;\n\n\t\tthis.syncTitleOnChange = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'delete ctrl+backspace shift+delete'\n\t\t}];\n\t\tthis.value = 'rm';\n\t\t\n\t\tthis.init = function() {\n\t\t\t// re-assign for extended command\n\t\t\tself = this;\n\t\t\tfm = this.fm;\n\t\t\t// bind function of change\n\t\t\tself.change(function() {\n\t\t\t\tvar targets;\n\t\t\t\tdelete self.extra;\n\t\t\t\tself.title = fm.i18n('cmd' + self.value);\n\t\t\t\tself.className = self.value;\n\t\t\t\tself.button && self.button.children('span.elfinder-button-icon')[self.value === 'trash'? 'addClass' : 'removeClass']('elfinder-button-icon-trash');\n\t\t\t\tif (self.value === 'trash') {\n\t\t\t\t\tself.extra = {\n\t\t\t\t\t\ticon: 'rm',\n\t\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t\t.attr({title: fm.i18n('cmdrm')})\n\t\t\t\t\t\t\t.on('ready', function(e, data) {\n\t\t\t\t\t\t\t\t//targets = data.targets; // modified by lwf\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tfm.getUI().trigger('click'); // to close the context menu immediately\n\t\t\t\t\t\t\t\tfm.exec('rm', targets, {_userAction: true, forceRm : true});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel   = this.hashes(select);\n\t\t\t\n\t\t\treturn sel.length && $.grep(sel, function(h) { var f = fm.file(h); return f && ! f.locked && ! fm.isRoot(f)? true : false; }).length == sel.length\n\t\t\t\t? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpts) {\n\t\t\tvar opts   = cOpts || {},\n\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tif (getSize && getSize.state && getSize.state() === 'pending') {\n\t\t\t\t\t\t\tgetSize.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t!opts.quiet && !data._noSound && data.removed && data.removed.length && fm.trigger('playsound', {soundFile : 'rm.wav'});\n\t\t\t\t\t}),\n\t\t\t\tfiles  = self.files(hashes),\n\t\t\t\tcnt    = files.length,\n\t\t\t\ttHash  = null,\n\t\t\t\taddTexts = opts.addTexts? opts.addTexts : null,\n\t\t\t\tforceRm = opts.forceRm,\n\t\t\t\tquiet = opts.quiet,\n\t\t\t\ttargets;\n\n\t\t\tif (! cnt) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\t$.each(files, function(i, file) {\n\t\t\t\tif (fm.isRoot(file)) {\n\t\t\t\t\treturn !dfrd.reject(['errRm', file.name, 'errPerm']);\n\t\t\t\t}\n\t\t\t\tif (file.locked) {\n\t\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (dfrd.state() === 'pending') {\n\t\t\t\ttargets = self.hashes(hashes);\n\t\t\t\tcnt     = files.length;\n\t\t\t\t\n\t\t\t\tif (forceRm || (self.event && self.event.originalEvent && self.event.originalEvent.shiftKey)) {\n\t\t\t\t\ttHash = '';\n\t\t\t\t\tself.title = fm.i18n('cmdrm');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (tHash === null) {\n\t\t\t\t\ttHash = getTHash(targets);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.lockfiles({files : targets});\n\t\t\t\t\n\t\t\t\tif (tHash && self.options.quickTrash) {\n\t\t\t\t\tself.toTrash(dfrd, targets, tHash);\n\t\t\t\t} else {\n\t\t\t\t\tif (quiet) {\n\t\t\t\t\t\tremove(dfrd, targets, quiet);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.confirm(dfrd, targets, files, tHash, addTexts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t\tfm.bind('select contextmenucreate closecontextmenu', function(e) {\n\t\t\tvar targets = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected();\n\t\t\tif (targets && targets.length) {\n\t\t\t\tself.update(void(0), (targets? getTHash(targets) : fm.option('trashHash'))? 'trash' : 'rm');\n\t\t\t}\n\t\t});\n\n\t};\n\n\treturn elFinder;\n\n});"]}