{"version":3,"sources":["commands/sort.js"],"names":["define","elFinder","prototype","commands","sort","self","this","fm","setVar","variants","$","each","sortRules","name","value","sorters","arr","sortType","sortOrder","push","i18n","sortStickFolders","ui","tree","options","sortAlsoTreeview","updateContextmenu","sub","cm","getUI","is","find","siblings","remove","children","tgt","text","trim","i18Name","stick","prepend","keepContextmenu","bind","rel","attr","toggle","cols","cwd","length","td","current","type","order","addClass","appendTo","on","e","data","stopPropagation","exec","toggleClass","getstate","hashes","cOpt","sOpts","sortopt","isPlainObject","Object","assign","lazy","setSort","resolve"],"mappings":"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","file":"../../commands/sort.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"sort\"\n\t * Change sort files rule\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.sort = function() {\n\t\t\"use strict\";\n\t\tvar self  = this,\n\t\t\tfm    = self.fm,\n\t\t\tsetVar = function() {\n\t\t\t\tself.variants = [];\n\t\t\t\t$.each(fm.sortRules, function(name, value) {\n\t\t\t\t\tif (fm.sorters[name]) {\n\t\t\t\t\t\tvar arr = (name === fm.sortType)? (fm.sortOrder === 'asc'? 'n' : 's') : '';\n\t\t\t\t\t\tself.variants.push([name, (arr? '<span class=\"ui-icon ui-icon-arrowthick-1-'+arr+'\"></span>' : '') + '&nbsp;' + fm.i18n('sort'+name)]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tself.variants.push('|');\n\t\t\t\tself.variants.push([\n\t\t\t\t\t'stick',\n\t\t\t\t\t(fm.sortStickFolders? '<span class=\"ui-icon ui-icon-check\"/>' : '') + '&nbsp;' + fm.i18n('sortFoldersFirst')\n\t\t\t\t]);\n\t\t\t\tif (fm.ui.tree && fm.options.sortAlsoTreeview !== null) {\n\t\t\t\t\tself.variants.push('|');\n\t\t\t\t\tself.variants.push([\n\t\t\t\t\t\t'tree',\n\t\t\t\t\t\t(fm.sortAlsoTreeview? '<span class=\"ui-icon ui-icon-check\"/>' : '') + '&nbsp;' + fm.i18n('sortAlsoTreeview')\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t\tupdateContextmenu();\n\t\t\t},\n\t\t\tupdateContextmenu = function() {\n\t\t\t\tvar cm = fm.getUI('contextmenu'),\n\t\t\t\t\ticon, sub;\n\t\t\t\tif (cm.is(':visible')) {\n\t\t\t\t\ticon = cm.find('span.elfinder-button-icon-sort');\n\t\t\t\t\tsub = icon.siblings('div.elfinder-contextmenu-sub');\n\t\t\t\t\tsub.find('span.ui-icon').remove();\n\t\t\t\t\tsub.children('div.elfinder-contextsubmenu-item').each(function() {\n\t\t\t\t\t\tvar tgt = $(this).children('span'),\n\t\t\t\t\t\t\tname = tgt.text().trim(),\n\t\t\t\t\t\t\tarr;\n\t\t\t\t\t\tif (name === (i18Name.stick || (i18Name.stick = fm.i18n('sortFoldersFirst')))) {\n\t\t\t\t\t\t\tif (fm.sortStickFolders) {\n\t\t\t\t\t\t\t\ttgt.prepend('<span class=\"ui-icon ui-icon-check\"/>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (name === (i18Name.tree || (i18Name.tree = fm.i18n('sortAlsoTreeview')))) {\n\t\t\t\t\t\t\tif (fm.sortAlsoTreeview) {\n\t\t\t\t\t\t\t\ttgt.prepend('<span class=\"ui-icon ui-icon-check\"/>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (name === (i18Name[fm.sortType] || (i18Name[fm.sortType] = fm.i18n('sort' + fm.sortType)))) {\n\t\t\t\t\t\t\tarr = fm.sortOrder === 'asc'? 'n' : 's';\n\t\t\t\t\t\t\ttgt.prepend('<span class=\"ui-icon ui-icon-arrowthick-1-'+arr+'\"></span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18Name = {};\n\t\t\n\t\t/**\n\t\t * Command options\n\t\t *\n\t\t * @type  Object\n\t\t */\n\t\tthis.options = {ui : 'sortbutton'};\n\t\t\n\t\tthis.keepContextmenu = true;\n\n\t\tfm.bind('sortchange', setVar)\n\t\t.bind('sorterupdate', function() {\n\t\t\tsetVar();\n\t\t\tfm.getUI().children('.elfinder-button-sort-menu').children('.elfinder-button-menu-item').each(function() {\n\t\t\t\tvar tgt = $(this),\n\t\t\t\t\trel = tgt.attr('rel');\n\t\t\t\ttgt.toggle(!!(! rel || fm.sorters[rel]));\n\t\t\t});\n\t\t})\n\t\t.bind('cwdrender', function() {\n\t\t\tvar cols = $(fm.cwd).find('div.elfinder-cwd-wrapper-list table');\n\t\t\tif (cols.length) {\n\t\t\t\t$.each(fm.sortRules, function(name, value) {\n\t\t\t\t\tvar td = cols.find('thead tr td.elfinder-cwd-view-th-'+name);\n\t\t\t\t\tif (td.length) {\n\t\t\t\t\t\tvar current = ( name == fm.sortType),\n\t\t\t\t\t\tsort = {\n\t\t\t\t\t\t\ttype  : name,\n\t\t\t\t\t\t\torder : current ? fm.sortOrder == 'asc' ? 'desc' : 'asc' : fm.sortOrder\n\t\t\t\t\t\t},arr;\n\t\t\t\t\t\tif (current) {\n\t\t\t\t\t\t\ttd.addClass('ui-state-active');\n\t\t\t\t\t\t\tarr = fm.sortOrder == 'asc' ? 'n' : 's';\n\t\t\t\t\t\t\t$('<span class=\"ui-icon ui-icon-triangle-1-'+arr+'\"/>').appendTo(td);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(td).on('click', function(e){\n\t\t\t\t\t\t\tif (! $(this).data('dragging')) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tif (! fm.getUI('cwd').data('longtap')) {\n\t\t\t\t\t\t\t\t\tfm.exec('sort', [], sort);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('mouseenter mouseleave', function(e) {\n\t\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type === 'mouseenter');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpt) {\n\t\t\tvar fm = this.fm,\n\t\t\t\tsortopt = $.isPlainObject(cOpt)? cOpt : (function() {\n\t\t\t\t\tcOpt += '';\n\t\t\t\t\tvar sOpts = {};\n\t\t\t\t\tif (cOpt === 'stick') {\n\t\t\t\t\t\tsOpts.stick = !fm.sortStickFolders;\n\t\t\t\t\t} else if (cOpt === 'tree') {\n\t\t\t\t\t\tsOpts.tree = !fm.sortAlsoTreeview;\n\t\t\t\t\t} else if (fm.sorters[cOpt]) {\n\t\t\t\t\t\tif (fm.sortType === cOpt) {\n\t\t\t\t\t\t\tsOpts.order = fm.sortOrder === 'asc'? 'desc' : 'asc';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsOpts.type = cOpt;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn sOpts;\n\t\t\t\t})(),\n\t\t\t\tsort = Object.assign({\n\t\t\t\t\ttype  : fm.sortType,\n\t\t\t\t\torder : fm.sortOrder,\n\t\t\t\t\tstick : fm.sortStickFolders,\n\t\t\t\t\ttree  : fm.sortAlsoTreeview\n\t\t\t\t}, sortopt);\n\n\t\t\treturn fm.lazy(function() {\n\t\t\t\tfm.setSort(sort.type, sort.order, sort.stick, sort.tree);\n\t\t\t\tthis.resolve();\n\t\t\t});\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});"]}