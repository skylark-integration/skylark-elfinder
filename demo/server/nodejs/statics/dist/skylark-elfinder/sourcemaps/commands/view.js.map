{"version":3,"sources":["commands/view.js"],"names":["define","elFinder","prototype","commands","view","subMenuRaw","self","this","fm","value","viewType","alwaysEnabled","updateOnSelect","options","ui","getstate","extra","icon","node","$","attr","title","i18n","on","e","type","originalEvent","touches","length","stopPropagation","preventDefault","trigger","raw","getSubMenuRaw","x","offset","left","y","top","exec","storage","lazy","viewchange","update","resolve","bind","i","cwd","getUI","raws","sizeNames","uiOptions","iconsView","max","sizeMax","push","label","callback","s","size","idx","concat","parseInt","className"],"mappings":";;;;;;;AAAAA,QACC,eACC,SAASC,GA+HV,OAxHAA,EAASC,UAAUC,SAASC,KAAO,WAClC,aACA,IAECC,EAFGC,EAAOC,KACVC,EAAKD,KAAKC,GAEXD,KAAKE,MAAiBD,EAAGE,SACzBH,KAAKI,eAAiB,EACtBJ,KAAKK,gBAAiB,EAEtBL,KAAKM,SAAYC,GAAK,cAEtBP,KAAKQ,SAAW,WACf,OAAO,GAGRR,KAAKS,OACJC,KAAM,OACNC,KAAMC,EAAE,WACNC,MAAMC,MAAOb,EAAGc,KAAK,cACrBC,GAAG,mBAAoB,SAASC,GAChC,KAAe,eAAXA,EAAEC,MAAyBD,EAAEE,cAAcC,QAAQC,OAAS,GAAhE,CAGA,IAAIV,EAAOC,EAAEZ,MACbiB,EAAEK,kBACFL,EAAEM,iBACFtB,EAAGuB,QAAQ,eACVC,IAAKC,gBACLC,EAAGhB,EAAKiB,SAASC,KACjBC,EAAGnB,EAAKiB,SAASG,UAKrB/B,KAAKgC,KAAO,WACX,IAAIjC,EAAQC,KACXE,EAAsB,QAAdF,KAAKE,MAAkB,QAAU,OAG1C,OADAD,EAAGgC,QAAQ,OAAQ/B,GACZD,EAAGiC,KAAK,WACdjC,EAAGkC,aACHpC,EAAKqC,YAAO,EAASlC,GACrBF,KAAKqC,aAIPpC,EAAGqC,KAAK,OAAQ,WACfxC,EAAa,WACZ,IAICyC,EAJGC,EAAMvC,EAAGwC,MAAM,OAClBC,KACAC,EAAY1C,EAAGK,QAAQsC,UAAUJ,IAAIK,UAAUF,UAC/CG,EAAM7C,EAAGK,QAAQsC,UAAUJ,IAAIK,UAAUE,QAE1C,IAAKR,EAAI,EAAGA,GAAKO,EAAKP,IACrBG,EAAKM,MAEHC,MAAWhD,EAAGc,KAAK4B,EAAUJ,IAAO,QAAUA,EAAI,UAClD7B,KAAW,OACXwC,SAAW,SAAUC,GACpB,OAAO,WACNX,EAAIhB,QAAQ,YAAa4B,KAAMD,IAC/BlD,EAAGgC,QAAQ,WAAYkB,GACJ,SAAfpD,EAAKG,OACRH,EAAKiC,QALG,CAQRO,KAgBN,OAZAG,EAAKM,KAAK,KACVN,EAAKM,MAEHC,MAAWhD,EAAGc,KAAK,YACnBL,KAAW,YACXwC,SAAW,WACS,SAAfnD,EAAKG,OACRH,EAAKiC,UAKFU,EAnCK,KAqCXJ,KAAK,oBAAqB,WAC5BvC,EAAKU,OACJC,KAAM,OACNC,KAAMC,EAAE,WACNC,MAAMC,MAAOb,EAAGc,KAAK,aACrBC,GAAG,mBAAoB,SAASC,GAChC,KAAe,eAAXA,EAAEC,MAAyBD,EAAEE,cAAcC,QAAQC,OAAS,GAAhE,CAGA,IAECgC,EAAKd,EAFF5B,EAAOC,EAAEZ,MACNF,EAAWwD,SAOlB,IAJCD,EADkB,SAAftD,EAAKG,MACFJ,EAAWuB,OAAS,EAEpBkC,SAAStD,EAAGgC,QAAQ,aAAe,GAErCM,EAAI,EAAGA,EAAIzC,EAAWuB,OAAQkB,IACZ,MAAlBzC,EAAWyC,KACdzC,EAAWyC,GAAGjC,QAAWiC,IAAMc,GAAMG,UAAa,wBAAqB,GAIzEvC,EAAEK,kBACFL,EAAEM,iBACFtB,EAAGuB,QAAQ,eACVC,IAAK3B,EACL6B,EAAGhB,EAAKiB,SAASC,KACjBC,EAAGnB,EAAKiB,SAASG,aAQhBrC","file":"../../commands/view.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"view\"\n\t * Change current directory view (icons/list)\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.view = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\tsubMenuRaw;\n\t\tthis.value          = fm.viewType;\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\n\t\tthis.options = { ui : 'viewbutton'};\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.extra = {\n\t\t\ticon: 'menu',\n\t\t\tnode: $('<span/>')\n\t\t\t\t.attr({title: fm.i18n('viewtype')})\n\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar node = $(this);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\traw: getSubMenuRaw(),\n\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\ty: node.offset().top\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t};\n\n\t\tthis.exec = function() {\n\t\t\tvar self  = this,\n\t\t\t\tvalue = this.value == 'list' ? 'icons' : 'list';\n\t\t\t\t\n\t\t\tfm.storage('view', value);\n\t\t\treturn fm.lazy(function() {\n\t\t\t\tfm.viewchange();\n\t\t\t\tself.update(void(0), value);\n\t\t\t\tthis.resolve();\n\t\t\t});\n\t\t};\n\n\t\tfm.bind('init', function() {\n\t\t\tsubMenuRaw = (function() {\n\t\t\t\tvar cwd = fm.getUI('cwd'),\n\t\t\t\t\traws = [],\n\t\t\t\t\tsizeNames = fm.options.uiOptions.cwd.iconsView.sizeNames,\n\t\t\t\t\tmax = fm.options.uiOptions.cwd.iconsView.sizeMax,\n\t\t\t\t\ti, size;\n\t\t\t\tfor (i = 0; i <= max; i++) {\n\t\t\t\t\traws.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel    : fm.i18n(sizeNames[i] || ('Size-' + i + ' icons')),\n\t\t\t\t\t\t\ticon     : 'view',\n\t\t\t\t\t\t\tcallback : (function(s) {\n\t\t\t\t\t\t\t\treturn function() {\n\t\t\t\t\t\t\t\t\tcwd.trigger('iconpref', {size: s});\n\t\t\t\t\t\t\t\t\tfm.storage('iconsize', s);\n\t\t\t\t\t\t\t\t\tif (self.value === 'list') {\n\t\t\t\t\t\t\t\t\t\tself.exec();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})(i)\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\traws.push('|');\n\t\t\t\traws.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel    : fm.i18n('viewlist'),\n\t\t\t\t\t\ticon     : 'view-list',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tif (self.value !== 'list') {\n\t\t\t\t\t\t\t\tself.exec();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\n\t\t\t\t);\n\t\t\t\treturn raws;\n\t\t\t})();\n\t\t}).bind('contextmenucreate', function() {\n\t\t\tself.extra = {\n\t\t\t\ticon: 'menu',\n\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t.attr({title: fm.i18n('cmdview')})\n\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar node = $(this),\n\t\t\t\t\t\t\traw = subMenuRaw.concat(),\n\t\t\t\t\t\t\tidx, i;\n\t\t\t\t\t\tif (self.value === 'list') {\n\t\t\t\t\t\t\tidx = subMenuRaw.length - 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tidx = parseInt(fm.storage('iconsize') || 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (i = 0; i < subMenuRaw.length; i++) {\n\t\t\t\t\t\t\tif (subMenuRaw[i] !== '|') {\n\t\t\t\t\t\t\t\tsubMenuRaw[i].options = (i === idx? {'className': 'ui-state-active'} : void(0))\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: subMenuRaw,\n\t\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\t\ty: node.offset().top\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t};\n\t\t});\n\n\t};\n\n\treturn elFinder;\n\n});"]}