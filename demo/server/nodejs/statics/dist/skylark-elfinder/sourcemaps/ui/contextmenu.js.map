{"version":3,"sources":["ui/contextmenu.js"],"names":["define","$","fn","elfindercontextmenu","fm","this","each","base","cwd","nodes","selected","subnodes","subselected","autoSyncStop","cmItem","smItem","exIcon","cHover","res","dragOpt","distance","start","menu","data","find","removeClass","stop","removeData","addClass","direction","hide","on","e","children","toggleClass","type","parent","sel","setIndex","target","sub","i","n","_cur","originalEvent","unHover","length","hasClass","setTimeout","draggable","ltr","subpos","types","Object","assign","options","contextmenu","tpl","item","label","icon","callback","opts","v","pos","className","style","iconClass","iconImg","split","escape","replace","stopPropagation","preventDefault","keyEvts","code","keyCode","ESC","ui","ESCAPE","ENT","ENTER","LEFT","RIGHT","UP","DOWN","subent","sublev","inArray","stopImmediatePropagation","trigger","close","eq","click","first","open","x","y","css","evts","evTouchStart","width","outerWidth","height","outerHeight","bstyle","attr","bpos","offset","bwidth","bheight","mw","UA","Mobile","mh","left","top","Math","max","opacity","autoSync","removeAttr","toFront","show","parseInt","iOS","document","namespace","_data","events","keydown","unshift","pop","clearTimeout","is","touches","off","one","tgt","pageX","pageY","fadeOut","duration","fail","done","toHide","requestAnimationFrame","getUI","currentType","currentTargets","empty","after","searchStatus","state","ininc","bind","prevNode","raw","targets","selcnt","cmdMap","sep","insSep","disabled","isCwd","option","getDisabledCmds","append","i18n","name","cmd","cmdName","useMap","node","submenu","hover","getCommand","disableOnSearch","__disabled","_disabled","alwaysEnabled","_commands","linkedCmds","c","getstate","variants","title","contextmenuOpts","appendTo","right","over","nodeOffset","nodeleft","nodetop","nodewidth","baseOffset","wwidth","wheight","cltr","overflowY","$this","keepContextmenu","_userAction","_currentType","_currentNode","exec","closest","variant","iconUrl","test","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize","prepend","extra","remove","extendsCmd","remain","prev","fitHeight","maxHeight","min","window","opened","call","toString","shortcut","pattern","OS","description","elm","cwdHash2Elm","hash"],"mappings":"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","file":"../../ui/contextmenu.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder contextmenu\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindercontextmenu = function(fm) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar self   = $(this),\n\t\t\t\tcmItem = 'elfinder-contextmenu-item',\n\t\t\t\tsmItem = 'elfinder-contextsubmenu-item',\n\t\t\t\texIcon = 'elfinder-contextmenu-extra-icon',\n\t\t\t\tcHover = fm.res('class', 'hover'),\n\t\t\t\tdragOpt = {\n\t\t\t\t\tdistance: 8,\n\t\t\t\t\tstart: function() {\n\t\t\t\t\t\tmenu.data('drag', true).data('touching') && menu.find('.'+cHover).removeClass(cHover);\n\t\t\t\t\t},\n\t\t\t\t\tstop: function() {\n\t\t\t\t\t\tmenu.data('draged', true).removeData('drag');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmenu = $(this).addClass('touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-'+fm.direction)\n\t\t\t\t\t.hide()\n\t\t\t\t\t.on('touchstart', function(e) {\n\t\t\t\t\t\tmenu.data('touching', true).children().removeClass(cHover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchend', function(e) {\n\t\t\t\t\t\tmenu.removeData('touching');\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+cmItem, function(e) {\n\t\t\t\t\t\t$(this).toggleClass(cHover, (e.type === 'mouseenter' || (! menu.data('draged') && menu.data('submenuKeep'))? true : false));\n\t\t\t\t\t\tif (menu.data('draged') && menu.data('submenuKeep')) {\n\t\t\t\t\t\t\tmenu.find('.elfinder-contextmenu-sub:visible').parent().addClass(cHover);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+exIcon, function(e) {\n\t\t\t\t\t\t$(this).parent().toggleClass(cHover, e.type === 'mouseleave');\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+cmItem+',.'+smItem, function(e) {\n\t\t\t\t\t\tvar setIndex = function(target, sub) {\n\t\t\t\t\t\t\t$.each(sub? subnodes : nodes, function(i, n) {\n\t\t\t\t\t\t\t\tif (target[0] === n) {\n\t\t\t\t\t\t\t\t\t(sub? subnodes : nodes)._cur = i;\n\t\t\t\t\t\t\t\t\tif (sub) {\n\t\t\t\t\t\t\t\t\t\tsubselected = target;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tselected = target;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (e.originalEvent) {\n\t\t\t\t\t\t\tvar target = $(this),\n\t\t\t\t\t\t\t\tunHover = function() {\n\t\t\t\t\t\t\t\t\tif (selected && !selected.children('div.elfinder-contextmenu-sub:visible').length) {\n\t\t\t\t\t\t\t\t\t\tselected.removeClass(cHover);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (e.type === 'mouseenter') {\n\t\t\t\t\t\t\t\t// mouseenter\n\t\t\t\t\t\t\t\tif (target.hasClass(smItem)) {\n\t\t\t\t\t\t\t\t\t// submenu\n\t\t\t\t\t\t\t\t\tif (subselected) {\n\t\t\t\t\t\t\t\t\t\tsubselected.removeClass(cHover);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (selected) {\n\t\t\t\t\t\t\t\t\t\tsubnodes = selected.find('div.'+smItem);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsetIndex(target, true);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// menu\n\t\t\t\t\t\t\t\t\tunHover();\n\t\t\t\t\t\t\t\t\tsetIndex(target);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// mouseleave\n\t\t\t\t\t\t\t\tif (target.hasClass(smItem)) {\n\t\t\t\t\t\t\t\t\t//submenu\n\t\t\t\t\t\t\t\t\tsubselected = null;\n\t\t\t\t\t\t\t\t\tsubnodes = null;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// menu\n\t\t\t\t\t\t\t\t\tunHover();\n\t\t\t\t\t\t\t\t\t(function(sel) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tif (sel === selected) {\n\t\t\t\t\t\t\t\t\t\t\t\tselected = null;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}, 250);\n\t\t\t\t\t\t\t\t\t})(selected);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu', function(){return false;})\n\t\t\t\t\t.on('mouseup', function() {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmenu.removeData('draged');\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t})\n\t\t\t\t\t.draggable(dragOpt),\n\t\t\t\tltr = fm.direction === 'ltr',\n\t\t\t\tsubpos = ltr? 'left' : 'right',\n\t\t\t\ttypes = Object.assign({}, fm.options.contextmenu),\n\t\t\t\t//tpl     = '<div class=\"'+cmItem+'{className}\"><span class=\"elfinder-button-icon {icon} elfinder-contextmenu-icon\"{style}/><span>{label}</span></div>',\n\t\t\t\ttpl     = '<div class=\"'+cmItem+'{className}\"><span class=\"elfinder-button-icon {icon} elfinder-contextmenu-icon\"{style}/><span>{label}</span></div>', //modified by lwf\n\t\t\t\titem = function(label, icon, callback, opts) {\n\t\t\t\t\tvar className = '',\n\t\t\t\t\t\tstyle = '',\n\t\t\t\t\t\ticonClass = '',\n\t\t\t\t\t\tv, pos;\n\t\t\t\t\tif (opts) {\n\t\t\t\t\t\tif (opts.className) {\n\t\t\t\t\t\t\tclassName = ' ' + opts.className;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.iconClass) {\n\t\t\t\t\t\t\ticonClass = opts.iconClass;\n\t\t\t\t\t\t\ticon = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.iconImg) {\n\t\t\t\t\t\t\tv = opts.iconImg.split(/ +/);\n\t\t\t\t\t\t\tpos = v[1] && v[2]? fm.escape(v[1] + 'px ' + v[2] + 'px') : '';\n\t\t\t\t\t\t\tstyle = ' style=\"background:url(\\''+fm.escape(v[0])+'\\') '+(pos? pos : '0 0')+' no-repeat;'+(pos? '' : 'posbackground-size:contain;')+'\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn $(tpl.replace('{icon}', icon ? 'elfinder-button-icon-'+icon : (iconClass? iconClass : ''))\n\t\t\t\t\t\t\t.replace('{label}', label)\n\t\t\t\t\t\t\t.replace('{style}', style)\n\t\t\t\t\t\t\t.replace('{className}', className))\n\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\turlIcon = function(iconUrl) {\n\t\t\t\t\tvar v = iconUrl.split(/ +/),\n\t\t\t\t\t\tpos = v[1] && v[2]? (v[1] + 'px ' + v[2] + 'px') : '';\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbackgroundImage: 'url(\"'+v[0]+'\")',\n\t\t\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t\t\t\tbackgroundPosition: pos? pos : '',\n\t\t\t\t\t\tbackgroundSize: pos? '' : 'contain'\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tbase, cwd,\n\t\t\t\tnodes, selected, subnodes, subselected, autoSyncStop, subHoverTm,\n\n\t\t\t\tautoToggle = function() {\n\t\t\t\t\tvar evTouchStart = 'touchstart.contextmenuAutoToggle';\n\t\t\t\t\tmenu.data('hideTm') && clearTimeout(menu.data('hideTm'));\n\t\t\t\t\tif (menu.is(':visible')) {\n\t\t\t\t\t\tmenu.on('touchstart', function(e) {\n\t\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmenu.stop();\n\t\t\t\t\t\t\tfm.toFront(menu);\n\t\t\t\t\t\t\tmenu.data('hideTm') && clearTimeout(menu.data('hideTm'));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.data('hideTm', setTimeout(function() {\n\t\t\t\t\t\t\tif (menu.is(':visible')) {\n\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file').off(evTouchStart);\n\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file.ui-selected')\n\t\t\t\t\t\t\t\t.one(evTouchStart, function(e) {\n\t\t\t\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tvar tgt = $(e.target);\n\t\t\t\t\t\t\t\t\tif (menu.first().length && !tgt.is('input:checkbox') && !tgt.hasClass('elfinder-cwd-select')) {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t//e.preventDefault();\n\t\t\t\t\t\t\t\t\t\topen(e.originalEvent.touches[0].pageX, e.originalEvent.touches[0].pageY);\n\t\t\t\t\t\t\t\t\t\tcwd.data('longtap', true)\n\t\t\t\t\t\t\t\t\t\ttgt.one('touchend', function() {\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tcwd.removeData('longtap');\n\t\t\t\t\t\t\t\t\t\t\t}, 80);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file').off(evTouchStart);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.one('unselect.'+fm.namespace, function() {\n\t\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file').off(evTouchStart);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tmenu.fadeOut({\n\t\t\t\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\t\t\t\tfail: function() {\n\t\t\t\t\t\t\t\t\t\tmenu.css('opacity', '1').show();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdone: function() {\n\t\t\t\t\t\t\t\t\t\tfm.toHide(menu);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 4500));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tkeyEvts = function(e) {\n\t\t\t\t\tvar code = e.keyCode,\n\t\t\t\t\t\tESC = $.ui.keyCode.ESCAPE,\n\t\t\t\t\t\tENT = $.ui.keyCode.ENTER,\n\t\t\t\t\t\tLEFT = $.ui.keyCode.LEFT,\n\t\t\t\t\t\tRIGHT = $.ui.keyCode.RIGHT,\n\t\t\t\t\t\tUP = $.ui.keyCode.UP,\n\t\t\t\t\t\tDOWN = $.ui.keyCode.DOWN,\n\t\t\t\t\t\tsubent = fm.direction === 'ltr'? RIGHT : LEFT,\n\t\t\t\t\t\tsublev = subent === RIGHT? LEFT : RIGHT;\n\t\t\t\t\t\n\t\t\t\t\tif ($.inArray(code, [ESC, ENT, LEFT, RIGHT, UP, DOWN]) !== -1) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tif (code == ESC || code === sublev) {\n\t\t\t\t\t\t\tif (selected && subnodes && subselected) {\n\t\t\t\t\t\t\t\tsubselected.trigger('mouseleave').trigger('submenuclose');\n\t\t\t\t\t\t\t\tselected.addClass(cHover);\n\t\t\t\t\t\t\t\tsubnodes = null;\n\t\t\t\t\t\t\t\tsubselected = null;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcode == ESC && close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (code == UP || code == DOWN) {\n\t\t\t\t\t\t\tif (subnodes) {\n\t\t\t\t\t\t\t\tif (subselected) {\n\t\t\t\t\t\t\t\t\tsubselected.trigger('mouseleave');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (code == DOWN && (! subselected || subnodes.length <= ++subnodes._cur)) {\n\t\t\t\t\t\t\t\t\tsubnodes._cur = 0;\n\t\t\t\t\t\t\t\t} else if (code == UP && (! subselected || --subnodes._cur < 0)) {\n\t\t\t\t\t\t\t\t\tsubnodes._cur = subnodes.length - 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tsubselected = subnodes.eq(subnodes._cur).trigger('mouseenter');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsubnodes = null;\n\t\t\t\t\t\t\t\tif (selected) {\n\t\t\t\t\t\t\t\t\tselected.trigger('mouseleave');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (code == DOWN && (! selected || nodes.length <= ++nodes._cur)) {\n\t\t\t\t\t\t\t\t\tnodes._cur = 0;\n\t\t\t\t\t\t\t\t} else if (code == UP && (! selected || --nodes._cur < 0)) {\n\t\t\t\t\t\t\t\t\tnodes._cur = nodes.length - 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tselected = nodes.eq(nodes._cur).addClass(cHover);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (selected && (code == ENT || code === subent)) {\n\t\t\t\t\t\t\tif (selected.hasClass('elfinder-contextmenu-group')) {\n\t\t\t\t\t\t\t\tif (subselected) {\n\t\t\t\t\t\t\t\t\tcode == ENT && subselected.click();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tselected.trigger('mouseenter');\n\t\t\t\t\t\t\t\t\tsubnodes = selected.find('div.'+smItem);\n\t\t\t\t\t\t\t\t\tsubnodes._cur = 0;\n\t\t\t\t\t\t\t\t\tsubselected = subnodes.first().addClass(cHover);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcode == ENT && selected.click();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\topen = function(x, y, css) {\n\t\t\t\t\tvar width      = menu.outerWidth(),\n\t\t\t\t\t\theight     = menu.outerHeight(),\n\t\t\t\t\t\tbstyle     = base.attr('style'),\n\t\t\t\t\t\tbpos       = base.offset(),\n\t\t\t\t\t\tbwidth     = base.width(),\n\t\t\t\t\t\tbheight    = base.height(),\n\t\t\t\t\t\tmw         = fm.UA.Mobile? 40 : 2,\n\t\t\t\t\t\tmh         = fm.UA.Mobile? 20 : 2,\n\t\t\t\t\t\tx          = x - (bpos? bpos.left : 0),\n\t\t\t\t\t\ty          = y - (bpos? bpos.top : 0),\n\t\t\t\t\t\tcss        = Object.assign(css || {}, {\n\t\t\t\t\t\t\ttop  : Math.max(0, y + mh + height < bheight ? y + mh : y - (y + height - bheight)),\n\t\t\t\t\t\t\tleft : Math.max(0, (x < width + mw || x + mw + width < bwidth)? x + mw : x - mw - width),\n\t\t\t\t\t\t\topacity : '1'\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tevts;\n\n\t\t\t\t\tautoSyncStop = true;\n\t\t\t\t\tfm.autoSync('stop');\n\t\t\t\t\tbase.width(bwidth);\n\t\t\t\t\tmenu.stop().removeAttr('style').css(css);\n\t\t\t\t\tfm.toFront(menu);\n\t\t\t\t\tmenu.show();\n\t\t\t\t\tbase.attr('style', bstyle);\n\t\t\t\t\t\n\t\t\t\t\tcss[subpos] = parseInt(menu.width());\n\t\t\t\t\tmenu.find('.elfinder-contextmenu-sub').css(css);\n\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t$('div.elfinder div.overflow-scrolling-touch').css('-webkit-overflow-scrolling', 'auto');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tselected = null;\n\t\t\t\t\tsubnodes = null;\n\t\t\t\t\tsubselected = null;\n\t\t\t\t\t$(document).on('keydown.' + fm.namespace, keyEvts);\n\t\t\t\t\tevts = $._data(document).events;\n\t\t\t\t\tif (evts && evts.keydown) {\n\t\t\t\t\t\tevts.keydown.unshift(evts.keydown.pop());\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfm.UA.Mobile && autoToggle();\n\t\t\t\t\t\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tfm.getUI().one('click.' + fm.namespace, close);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tclose = function() {\n\t\t\t\t\tfm.getUI().off('click.' + fm.namespace, close);\n\t\t\t\t\t$(document).off('keydown.' + fm.namespace, keyEvts);\n\n\t\t\t\t\tcurrentType = currentTargets = null;\n\t\t\t\t\t\n\t\t\t\t\tif (menu.is(':visible') || menu.children().length) {\n\t\t\t\t\t\tfm.toHide(menu.removeAttr('style').empty().removeData('submenuKeep'));\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (! menu.draggable('instance')) {\n\t\t\t\t\t\t\t\tmenu.draggable(dragOpt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tif (! menu.hasClass('ui-draggable')) {\n\t\t\t\t\t\t\t\tmenu.draggable(dragOpt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (menu.data('prevNode')) {\n\t\t\t\t\t\t\tmenu.data('prevNode').after(menu);\n\t\t\t\t\t\t\tmenu.removeData('prevNode');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.trigger('closecontextmenu');\n\t\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t\t$('div.elfinder div.overflow-scrolling-touch').css('-webkit-overflow-scrolling', 'touch');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tautoSyncStop && fm.searchStatus.state < 1 && ! fm.searchStatus.ininc && fm.autoSync();\n\t\t\t\t\tautoSyncStop = false;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcreate = function(type, targets) {\n\t\t\t\t\tvar sep    = false,\n\t\t\t\t\t\tinsSep = false,\n\t\t\t\t\t\tdisabled = [],\n\t\t\t\t\t\tisCwd = type === 'cwd',\n\t\t\t\t\t\tselcnt = 0,\n\t\t\t\t\t\tcmdMap;\n\n\t\t\t\t\tcurrentType = type;\n\t\t\t\t\tcurrentTargets = targets;\n\t\t\t\t\t\n\t\t\t\t\t// get current uiCmdMap option\n\t\t\t\t\tif (!(cmdMap = fm.option('uiCmdMap', isCwd? void(0) : targets[0]))) {\n\t\t\t\t\t\tcmdMap = {};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!isCwd) {\n\t\t\t\t\t\tdisabled = fm.getDisabledCmds(targets);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tselcnt = fm.selected().length;\n\t\t\t\t\tif (selcnt > 1) {\n\t\t\t\t\t\tmenu.append('<div class=\"ui-corner-top ui-widget-header elfinder-contextmenu-header\"><span>'\n\t\t\t\t\t\t + fm.i18n('selectedItems', ''+selcnt)\n\t\t\t\t\t\t + '</span></div>');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tnodes = $();\n\t\t\t\t\t$.each(types[type]||[], function(i, name) {\n\t\t\t\t\t\tvar cmd, cmdName, useMap, node, submenu, hover;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (name === '|') {\n\t\t\t\t\t\t\tif (sep) {\n\t\t\t\t\t\t\t\tinsSep = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cmdMap[name]) {\n\t\t\t\t\t\t\tcmdName = cmdMap[name];\n\t\t\t\t\t\t\tuseMap = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcmdName = name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcmd = fm.getCommand(cmdName);\n\n\t\t\t\t\t\tif (cmd && !isCwd && (!fm.searchStatus.state || !cmd.disableOnSearch)) {\n\t\t\t\t\t\t\tcmd.__disabled = cmd._disabled;\n\t\t\t\t\t\t\tcmd._disabled = !(cmd.alwaysEnabled || (fm._commands[cmdName] ? $.inArray(name, disabled) === -1 && (!useMap || !disabled[cmdName]) : false));\n\t\t\t\t\t\t\t$.each(cmd.linkedCmds, function(i, n) {\n\t\t\t\t\t\t\t\tvar c;\n\t\t\t\t\t\t\t\tif (c = fm.getCommand(n)) {\n\t\t\t\t\t\t\t\t\tc.__disabled = c._disabled;\n\t\t\t\t\t\t\t\t\tc._disabled = !(c.alwaysEnabled || (fm._commands[n] ? !disabled[n] : false));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cmd && !cmd._disabled && cmd.getstate(targets) != -1) {\n\t\t\t\t\t\t\tif (cmd.variants) {\n\t\t\t\t\t\t\t\tif (!cmd.variants.length) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tnode = item(cmd.title, cmd.className? cmd.className : cmd.name, function(){}, cmd.contextmenuOpts);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tsubmenu = $('<div class=\"ui-front ui-corner-all elfinder-contextmenu-sub\"/>')\n\t\t\t\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t\t\t\t.css('max-height', fm.getUI().height() - 30)\n\t\t\t\t\t\t\t\t\t.appendTo(node.append('<span class=\"elfinder-contextmenu-arrow\"/>'));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\thover = function(show){\n\t\t\t\t\t\t\t\t\tif (! show) {\n\t\t\t\t\t\t\t\t\t\tsubmenu.hide();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tvar bstyle = base.attr('style');\n\t\t\t\t\t\t\t\t\t\tbase.width(base.width());\n\t\t\t\t\t\t\t\t\t\t// top: '-1000px' to prevent visible scrollbar of window with the elFinder option `height: '100%'`\n\t\t\t\t\t\t\t\t\t\tsubmenu.css({ top: '-1000px', left: 'auto', right: 'auto' });\n\t\t\t\t\t\t\t\t\t\tvar nodeOffset = node.offset(),\n\t\t\t\t\t\t\t\t\t\t\tnodeleft   = nodeOffset.left,\n\t\t\t\t\t\t\t\t\t\t\tnodetop    = nodeOffset.top,\n\t\t\t\t\t\t\t\t\t\t\tnodewidth  = node.outerWidth(),\n\t\t\t\t\t\t\t\t\t\t\twidth      = submenu.outerWidth(true),\n\t\t\t\t\t\t\t\t\t\t\theight     = submenu.outerHeight(true),\n\t\t\t\t\t\t\t\t\t\t\tbaseOffset = base.offset(),\n\t\t\t\t\t\t\t\t\t\t\twwidth     = baseOffset.left + base.width(),\n\t\t\t\t\t\t\t\t\t\t\twheight    = baseOffset.top + base.height(),\n\t\t\t\t\t\t\t\t\t\t\tcltr       = ltr, \n\t\t\t\t\t\t\t\t\t\t\tx          = nodewidth,\n\t\t\t\t\t\t\t\t\t\t\ty, over;\n\t\t\n\t\t\t\t\t\t\t\t\t\tif (ltr) {\n\t\t\t\t\t\t\t\t\t\t\tover = (nodeleft + nodewidth + width) - wwidth;\n\t\t\t\t\t\t\t\t\t\t\tif (over > 10) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (nodeleft > width - 5) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tx = x - 5;\n\t\t\t\t\t\t\t\t\t\t\t\t\tcltr = false;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!fm.UA.Mobile) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx = nodewidth - over;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tover = width - nodeleft;\n\t\t\t\t\t\t\t\t\t\t\tif (over > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tif ((nodeleft + nodewidth + width - 15) < wwidth) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tx = x - 5;\n\t\t\t\t\t\t\t\t\t\t\t\t\tcltr = true;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!fm.UA.Mobile) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx = nodewidth - over;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tover = (nodetop + 5 + height) - wheight;\n\t\t\t\t\t\t\t\t\t\ty = (over > 0 && nodetop < wheight)? 5 - over : (over > 0? 30 - height : 5);\n\t\t\n\t\t\t\t\t\t\t\t\t\tmenu.find('.elfinder-contextmenu-sub:visible').hide();\n\t\t\t\t\t\t\t\t\t\tsubmenu.css({\n\t\t\t\t\t\t\t\t\t\t\ttop : y,\n\t\t\t\t\t\t\t\t\t\t\tleft : cltr? x : 'auto',\n\t\t\t\t\t\t\t\t\t\t\tright: cltr? 'auto' : x,\n\t\t\t\t\t\t\t\t\t\t\toverflowY: 'auto'\n\t\t\t\t\t\t\t\t\t\t}).show();\n\t\t\t\t\t\t\t\t\t\tbase.attr('style', bstyle);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tnode.addClass('elfinder-contextmenu-group')\n\t\t\t\t\t\t\t\t\t.on('mouseleave', '.elfinder-contextmenu-sub', function(e) {\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t\t\tmenu.removeData('submenuKeep');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('submenuclose', '.elfinder-contextmenu-sub', function(e) {\n\t\t\t\t\t\t\t\t\t\thover(false);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('click', '.'+smItem, function(e){\n\t\t\t\t\t\t\t\t\t\tvar opts, $this;\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t\t\t$this = $(this);\n\t\t\t\t\t\t\t\t\t\t\tif (!cmd.keepContextmenu) {\n\t\t\t\t\t\t\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t$this.removeClass(cHover);\n\t\t\t\t\t\t\t\t\t\t\t\tnode.addClass(cHover);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topts = $this.data('exec');\n\t\t\t\t\t\t\t\t\t\t\tif (typeof opts === 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\t\topts = {};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (typeof opts === 'object') {\n\t\t\t\t\t\t\t\t\t\t\t\topts._userAction = true;\n\t\t\t\t\t\t\t\t\t\t\t\topts._currentType = type;\n\t\t\t\t\t\t\t\t\t\t\t\topts._currentNode = $this;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t!cmd.keepContextmenu && close();\n\t\t\t\t\t\t\t\t\t\t\tfm.exec(cmd.name, targets, opts);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('touchend', function(e) {\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('drag')) {\n\t\t\t\t\t\t\t\t\t\t\thover(true);\n\t\t\t\t\t\t\t\t\t\t\tmenu.data('submenuKeep', true);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('mouseenter mouseleave', function(e){\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('touching')) {\n\t\t\t\t\t\t\t\t\t\t\tif (node.data('timer')) {\n\t\t\t\t\t\t\t\t\t\t\t\tclearTimeout(node.data('timer'));\n\t\t\t\t\t\t\t\t\t\t\t\tnode.removeData('timer');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (!$(e.target).closest('.elfinder-contextmenu-sub', menu).length) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.type === 'mouseleave') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (! menu.data('submenuKeep')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnode.data('timer', setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnode.removeData('timer');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thover(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, 250));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tnode.data('timer', setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnode.removeData('timer');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thover(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, nodes.find('div.elfinder-contextmenu-sub:visible').length? 250 : 0));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$.each(cmd.variants, function(i, variant) {\n\t\t\t\t\t\t\t\t\tvar item = variant === '|' ? '<div class=\"elfinder-contextmenu-separator\"/>' :\n\t\t\t\t\t\t\t\t\t\t$('<div class=\"'+cmItem+' '+smItem+'\"><span>'+variant[1]+'</span></div>').data('exec', variant[0]),\n\t\t\t\t\t\t\t\t\t\ticonClass, icon;\n\t\t\t\t\t\t\t\t\tif (typeof variant[2] !== 'undefined') {\n\t\t\t\t\t\t\t\t\t\ticon = $('<span/>').addClass('elfinder-button-icon elfinder-contextmenu-icon');\n\t\t\t\t\t\t\t\t\t\tif (! /\\//.test(variant[2])) {\n\t\t\t\t\t\t\t\t\t\t\ticon.addClass('elfinder-button-icon-'+variant[2]);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\ticon.css(urlIcon(variant[2]));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\titem.prepend(icon).addClass(smItem+'-icon');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsubmenu.append(item);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnode = item(cmd.title, cmd.className? cmd.className : cmd.name, function() {\n\t\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t\t!cmd.keepContextmenu && close();\n\t\t\t\t\t\t\t\t\t\tfm.exec(cmd.name, targets, {_userAction: true, _currentType: type, _currentNode: node});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, cmd.contextmenuOpts);\n\t\t\t\t\t\t\t\tif (cmd.extra && cmd.extra.node) {\n\t\t\t\t\t\t\t\t\t$('<span class=\"elfinder-button-icon elfinder-button-icon-'+(cmd.extra.icon || '')+' '+exIcon+'\"/>')\n\t\t\t\t\t\t\t\t\t\t.append(cmd.extra.node).appendTo(node);\n\t\t\t\t\t\t\t\t\t$(cmd.extra.node).trigger('ready', {targets: targets});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnode.remove('.'+exIcon);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (cmd.extendsCmd) {\n\t\t\t\t\t\t\t\tnode.children('span.elfinder-button-icon').addClass('elfinder-button-icon-' + cmd.extendsCmd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (insSep) {\n\t\t\t\t\t\t\t\tmenu.append('<div class=\"elfinder-contextmenu-separator\"/>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmenu.append(node);\n\t\t\t\t\t\t\tsep = true;\n\t\t\t\t\t\t\tinsSep = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cmd && typeof cmd.__disabled !== 'undefined') {\n\t\t\t\t\t\t\tcmd._disabled = cmd.__disabled;\n\t\t\t\t\t\t\tdelete cmd.__disabled;\n\t\t\t\t\t\t\t$.each(cmd.linkedCmds, function(i, n) {\n\t\t\t\t\t\t\t\tvar c;\n\t\t\t\t\t\t\t\tif (c = fm.getCommand(n)) {\n\t\t\t\t\t\t\t\t\tc._disabled = c.__disabled;\n\t\t\t\t\t\t\t\t\tdelete c.__disabled;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tnodes = menu.children('div.'+cmItem);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcreateFromRaw = function(raw) {\n\t\t\t\t\tcurrentType = 'raw';\n\t\t\t\t\t$.each(raw, function(i, data) {\n\t\t\t\t\t\tvar node;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (data === '|') {\n\t\t\t\t\t\t\tmenu.append('<div class=\"elfinder-contextmenu-separator\"/>');\n\t\t\t\t\t\t} else if (data.label && typeof data.callback == 'function') {\n\t\t\t\t\t\t\tnode = item(data.label, data.icon, function() {\n\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t!data.remain && close();\n\t\t\t\t\t\t\t\t\tdata.callback();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, data.options || null);\n\t\t\t\t\t\t\tmenu.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tnodes = menu.children('div.'+cmItem);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcurrentType = null,\n\t\t\t\tcurrentTargets = null;\n\t\t\t\n\t\t\tfm.one('load', function() {\n\t\t\t\tbase = fm.getUI();\n\t\t\t\tcwd = fm.getUI('cwd');\n\t\t\t\tfm.bind('contextmenu', function(e) {\n\t\t\t\t\tvar data = e.data,\n\t\t\t\t\t\tcss = {},\n\t\t\t\t\t\tprevNode;\n\n\t\t\t\t\tif (data.type && data.type !== 'files') {\n\t\t\t\t\t\tcwd.trigger('unselectall');\n\t\t\t\t\t}\n\t\t\t\t\tclose();\n\n\t\t\t\t\tif (data.type && data.targets) {\n\t\t\t\t\t\tfm.trigger('contextmenucreate', data);\n\t\t\t\t\t\tcreate(data.type, data.targets);\n\t\t\t\t\t\tfm.trigger('contextmenucreatedone', data);\n\t\t\t\t\t} else if (data.raw) {\n\t\t\t\t\t\tcreateFromRaw(data.raw);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menu.children().length) {\n\t\t\t\t\t\tprevNode = data.prevNode || null;\n\t\t\t\t\t\tif (prevNode) {\n\t\t\t\t\t\t\tmenu.data('prevNode', menu.prev());\n\t\t\t\t\t\t\tprevNode.after(menu);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.fitHeight) {\n\t\t\t\t\t\t\tcss = {maxHeight: Math.min(fm.getUI().height(), $(window).height()), overflowY: 'auto'};\n\t\t\t\t\t\t\tmenu.draggable('destroy').removeClass('ui-draggable');\n\t\t\t\t\t\t}\n\t\t\t\t\t\topen(data.x, data.y, css);\n\t\t\t\t\t\t// call opened callback function\n\t\t\t\t\t\tif (data.opened && typeof data.opened === 'function') {\n\t\t\t\t\t\t\tdata.opened.call(menu);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.one('destroy', function() { menu.remove(); })\n\t\t\t\t.bind('disable', close)\n\t\t\t\t.bind('select', function(e){\n\t\t\t\t\t(currentType === 'files' && (!e.data || e.data.selected.toString() !== currentTargets.toString())) && close();\n\t\t\t\t});\n\t\t\t})\n\t\t\t.shortcut({\n\t\t\t\tpattern     : fm.OS === 'mac' ? 'ctrl+m' : 'contextmenu shift+f10',\n\t\t\t\tdescription : 'contextmenu',\n\t\t\t\tcallback    : function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$(document).one('contextmenu.' + fm.namespace, function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\t\ttype, targets, pos, elm;\n\t\t\t\t\t\n\t\t\t\t\tif (sel.length) {\n\t\t\t\t\t\ttype = 'files';\n\t\t\t\t\t\ttargets = sel;\n\t\t\t\t\t\telm = fm.cwdHash2Elm(sel[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = 'cwd';\n\t\t\t\t\t\ttargets = [ fm.cwd().hash ];\n\t\t\t\t\t\tpos = fm.getUI('workzone').offset();\n\t\t\t\t\t}\n\t\t\t\t\tif (! elm || ! elm.length) {\n\t\t\t\t\t\telm = fm.getUI('workzone');\n\t\t\t\t\t}\n\t\t\t\t\tpos = elm.offset();\n\t\t\t\t\tpos.top += (elm.height() / 2);\n\t\t\t\t\tpos.left += (elm.width() / 2);\n\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t'type'    : type,\n\t\t\t\t\t\t'targets' : targets,\n\t\t\t\t\t\t'x'       : pos.left,\n\t\t\t\t\t\t'y'       : pos.top\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t});\n\t\t\n\t};\n\n});"]}