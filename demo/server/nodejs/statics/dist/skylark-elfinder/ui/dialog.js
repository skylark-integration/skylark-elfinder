/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["skylark-jquery"],function(e){e.fn.elfinderdialog=function(i,t){"use strict";var o,a,n,s,l,r=-1!=window.navigator.platform.indexOf("Win"),d={},h={enabled:!1,width:!1,height:!1,defaultSize:null},g=function(i){var o,a;h.enabled&&(a=t.options.dialogContained?s:e(window),o={maxWidth:h.width?a.width()-d.width:null,maxHeight:h.height?a.height()-d.height:null},Object.assign(l,o),i.css(o).trigger("resize"),i.data("hasResizable")&&(i.resizable("option","maxWidth")<o.maxWidth||i.resizable("option","maxHeight")<o.maxHeight)&&i.resizable("option",o))},u=function(e){var i=e.data;a&&cancelAnimationFrame(a),a=requestAnimationFrame(function(){h.enabled&&g(i)})},c=function(){var e=s.children(".elfinder-dialog."+t.res("class","editing")+":visible");t[e.length?"disable":"enable"]()};return t&&t.ui?s=t.getUI():(s=this.closest(".elfinder"),t||(t=s.elfinder("instance"))),"string"==typeof i?((n=this.closest(".ui-dialog")).length&&("open"===i?"none"===n.css("display")&&(n.trigger("posinit").show().trigger("open").hide(),n.fadeIn(120,function(){t.trigger("dialogopened",{dialog:n})})):"close"===i||"destroy"===i?(n.stop(!0),(n.is(":visible")||s.is(":hidden"))&&(n.trigger("close"),t.trigger("dialogclosed",{dialog:n})),"destroy"===i?(n.remove(),t.trigger("dialogremoved",{dialog:n})):n.data("minimized")&&n.data("minimized").close()):"toTop"===i?(n.trigger("totop"),t.trigger("dialogtotoped",{dialog:n})):"posInit"===i?(n.trigger("posinit"),t.trigger("dialogposinited",{dialog:n})):"tabstopsInit"===i?(n.trigger("tabstopsInit"),t.trigger("dialogtabstopsinited",{dialog:n})):"checkEditing"===i&&c()),this):((i=Object.assign({},e.fn.elfinderdialog.defaults,i)).allowMinimize&&"auto"===i.allowMinimize&&(i.allowMinimize=!!this.find("textarea,input").length),i.openMaximized=i.allowMinimize&&i.openMaximized,i.headerBtnPos&&"auto"===i.headerBtnPos&&(i.headerBtnPos=r?"right":"left"),i.headerBtnOrder&&"auto"===i.headerBtnOrder&&(i.headerBtnOrder=r?"close:maximize:minimize":"close:minimize:maximize"),i.modal&&i.allowMinimize&&(i.allowMinimize=!1),t.options.dialogContained?h.width=h.height=h.enabled=!0:(h.width="window"===i.maxWidth,h.height="window"===i.maxHeight,(h.width||h.height)&&(h.enabled=!0)),o=t.arrayFlip(i.propagationEvents,!0),this.filter(":not(.ui-dialog-content)").each(function(){var a,n,f=e(this).addClass("ui-dialog-content ui-widget-content"),m="elfinder-dialog",p="ui-state-hover",b="elfinder-tabstop",v=parseInt(1e6*Math.random()),w=e('<div class="ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix"><span class="elfinder-dialog-title">'+i.title+"</span></div>"),z=e('<div class="ui-dialog-buttonset"/>'),x=e('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(z),y=0,C=0,k=e(),M=e('<div style="width:100%;height:100%;position:absolute;top:0px;left:0px;"/>').hide(),H=function(){(k=I.find("."+b)).length&&(k.attr("tabindex","-1"),k.filter(".elfinder-focus").length||z.children("."+b+":"+(r?"first":"last")).addClass("elfinder-focus"))},W=function(i){var t=k.filter(":visible:enabled"),o=i?null:t.filter(".elfinder-focus:first");return o&&o.length||(o=t.first()),i&&e.each(t,function(e,a){if(a===i&&t[e+1])return o=t.eq(e+1),!1}),o},O={close:function(){w.prepend(e('<span class="ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button"><span class="ui-icon ui-icon-closethick"/></span>').on("mousedown",function(e){e.preventDefault(),e.stopPropagation(),f.elfinderdialog("close")}))},maximize:function(){i.allowMaximize&&(I.on("resize",function(e,i){var t,o;if(e.preventDefault(),e.stopPropagation(),i&&i.maximize){if(o=w.find(".elfinder-titlebar-full"),t="on"===i.maximize,o.children("span.ui-icon").toggleClass("ui-icon-plusthick",!t).toggleClass("ui-icon-arrowreturnthick-1-s",t),t){try{I.hasClass("ui-draggable")&&I.draggable("disable"),I.hasClass("ui-resizable")&&I.resizable("disable")}catch(e){}f.css("width","100%").css("height",I.height()-I.children(".ui-dialog-titlebar").outerHeight(!0)-x.outerHeight(!0))}else{f.attr("style",o.data("style")),o.removeData("style"),D();try{I.hasClass("ui-draggable")&&I.draggable("enable"),I.hasClass("ui-resizable")&&I.resizable("enable")}catch(e){}}I.trigger("resize",{init:!0})}}),w.prepend(e('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full"><span class="ui-icon ui-icon-plusthick"/></span>').on("mousedown",function(o){var a=e(this);o.preventDefault(),o.stopPropagation(),I.hasClass("elfinder-maximized")||void 0!==a.data("style")||(f.height(f.height()),a.data("style",f.attr("style")||"")),t.toggleMaximize(I),"function"==typeof i.maximize&&i.maximize.call(f[0])})))},minimize:function(){var o,a,n;i.allowMinimize&&(o=e('<span class="ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize"><span class="ui-icon ui-icon-minusthick"/></span>').on("mousedown",function(o){var s=e(this),l=t.getUI("bottomtray"),r={width:70,height:24},d=e("<div/>").css(r).addClass(I.get(0).className+" elfinder-dialog-minimized"),h=function(){a.remove(),I.removeData("minimized").show(),f.elfinderdialog("close")},g={};o.preventDefault(),o.stopPropagation(),I.data("minimized")?(I.removeData("minimized").before(a.css(Object.assign({position:"absolute"},a.offset()))),t.toFront(a),a.animate(Object.assign({width:I.width(),height:I.height()},n),function(){I.show(),t.toFront(I),a.remove(),D(),c(),I.trigger("resize",{init:!0}),"function"==typeof i.minimize&&i.minimize.call(f[0])})):(n=I.data("minimized",{dialog:function(){return a},show:function(){a.show()},hide:function(){a.hide()},close:h,title:function(e){a.children(".ui-dialog-titlebar").children(".elfinder-dialog-title").text(e)}}).position(),a=I.clone().on("mousedown",function(){s.trigger("mousedown")}).removeClass("ui-draggable ui-resizable elfinder-frontmost"),l.append(d),Object.assign(g,d.offset(),r),d.remove(),a.height(I.height()).children(".ui-dialog-content:first").empty(),t.toHide(I.before(a)),a.children(".ui-dialog-content:first,.ui-dialog-buttonpane,.ui-resizable-handle").remove(),a.find(".elfinder-titlebar-minimize,.elfinder-titlebar-full").remove(),a.find(".ui-dialog-titlebar-close").on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),h()}),a.animate(g,function(){a.attr("style","").css({maxWidth:I.width()}).addClass("elfinder-dialog-minimized").appendTo(l),c(),"function"==typeof i.minimize&&i.minimize.call(f[0])}))}),w.on("dblclick",function(i){e(this).children(".elfinder-titlebar-minimize").trigger("mousedown")}).prepend(o),I.on("togleminimize",function(){o.trigger("mousedown")}))}},I=e('<div class="ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+m+" "+i.cssClass+'"/>').hide().append(f).appendTo(s).draggable({containment:t.options.dialogContained?s:null,handle:".ui-dialog-titlebar",start:function(){M.show()},drag:function(e,i){var o=i.offset.top,a=i.offset.left;o<0&&(i.position.top=i.position.top-o),a<0&&(i.position.left=i.position.left-a),t.options.dialogContained&&(i.position.top<0&&(i.position.top=0),i.position.left<0&&(i.position.left=0))},stop:function(e,t){M.hide(),I.css({height:i.height}),f.data("draged",!0)}}).css({width:i.width,height:i.height,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight}).on("touchstart touchmove touchend click dblclick mouseup mouseenter mouseleave mouseout mouseover mousemove",function(e){!o[e.type]&&e.stopPropagation()}).on("mousedown",function(i){!o[i.type]&&i.stopPropagation(),requestAnimationFrame(function(){I.is(":visible")&&!I.hasClass("elfinder-frontmost")&&((n=e(":focus")).length||(n=void 0),I.trigger("totop"))})}).on("open",function(){I.data("margin-y",f.outerHeight(!0)-f.height()),h.enabled&&(i.height&&"auto"!==i.height&&I.trigger("resize",{init:!0}),h.defaultSize||(h.defaultSize={width:f.width(),height:f.height()}),g(I),I.trigger("resize").trigger("posinit"),s.on("resize."+t.namespace,I,u)),I.hasClass("elfinder-dialog-notify")||s.children("."+m+":visible:not(.elfinder-dialog-notify)").each(function(){var i=e(this),t=parseInt(i.css("top")),o=parseInt(i.css("left")),a=parseInt(I.css("top")),n=parseInt(I.css("left")),s=Math.abs(t-a)<10,l=Math.abs(o-n)<10;i[0]!=I[0]&&(s||l)&&I.css({top:s?t+10:a,left:l?o+10:n})}),I.data("modal")&&(I.addClass("elfinder-dialog-modal"),t.getUI("overlay").elfinderoverlay("show")),I.trigger("totop"),i.openMaximized&&t.toggleMaximize(I),t.trigger("dialogopen",{dialog:I}),"function"==typeof i.open&&e.proxy(i.open,f[0])(),i.closeOnEscape&&e(document).on("keydown."+v,function(i){i.keyCode==e.ui.keyCode.ESCAPE&&I.hasClass("elfinder-frontmost")&&f.elfinderdialog("close")}),I.hasClass(t.res("class","editing"))&&c()}).on("close",function(o){var a;i.beforeclose&&"function"==typeof i.beforeclose?(a=i.beforeclose())&&a.promise||(a=a?e.Deferred().resolve():e.Deferred().reject()):a=e.Deferred().resolve(),a.done(function(){h.enabled&&s.off("resize."+t.namespace,u),i.closeOnEscape&&e(document).off("keyup."+v),i.allowMaximize&&t.toggleMaximize(I,!1),t.toHide(I),I.data("modal")&&t.getUI("overlay").elfinderoverlay("hide"),"function"==typeof i.close&&e.proxy(i.close,f[0])(),i.destroyOnClose&&I.parent().length&&I.hide().remove(),s.children("."+m+":visible"),I.hasClass(t.res("class","editing"))&&c()})}).on("totop frontmost",function(){var e=t.storage("autoFocusDialog");I.data("focusOnMouseOver",e?e>0:t.options.uiOptions.dialog.focusOnMouseOver),I.data("minimized")&&w.children(".elfinder-titlebar-minimize").trigger("mousedown"),!I.data("modal")&&t.getUI("overlay").is(":visible")?t.getUI("overlay").before(I):t.toFront(I),s.children("."+m+":not(.elfinder-dialog-modal)").removeClass("elfinder-dialog-active"),I.addClass("elfinder-dialog-active"),!t.UA.Mobile&&(n||W()).trigger("focus"),n=void 0}).on("posinit",function(){var o,a,n,r,d,h,g,u=i.position;if(!I.hasClass("elfinder-maximized")){if(!u&&!I.data("resizing")){if(g=s.hasClass("elfinder-fullscreen")||t.options.enableAlways,I.css(g?{maxWidth:"100%",maxHeight:"100%",overflow:"auto"}:l),t.UA.Mobile&&!g&&I.data("rotated")===t.UA.Rotated)return;I.data("rotated",t.UA.Rotated),d=e(window),o=s.offset(),(r={width:I.outerWidth(!0),height:I.outerHeight(!0)}).right=o.left+r.width,r.bottom=o.top+r.height,(h={scrLeft:d.scrollLeft(),scrTop:d.scrollTop(),width:d.width(),height:d.height()}).right=h.scrLeft+h.width,h.bottom=h.scrTop+h.height,t.options.dialogContained||g?(a=0,n=0):(a=-1*o.top+h.scrTop,n=-1*o.left+h.scrLeft),u={top:r.height>=h.height?a:Math.max(a,parseInt((s.height()-r.height)/2-42)),left:r.width>=h.width?n:Math.max(n,parseInt((s.width()-r.width)/2))},r.right+u.left>h.right&&(u.left=Math.max(n,h.right-r.right)),r.bottom+u.top>h.bottom&&(u.top=Math.max(a,h.bottom-r.bottom))}i.absolute&&(u.position="absolute"),u&&I.css(u)}}).on("resize",function(t,o){var a,n,s,l,r=0,d=o&&o.init;o&&(o.minimize||o.maxmize)||I.data("minimized")||(t.stopPropagation(),t.preventDefault(),I.children(".ui-widget-header,.ui-dialog-buttonpane").each(function(){r+=e(this).outerHeight(!0)}),(l="auto"===i.height)&&f.css({"max-height":"",height:"auto"}),d||!h.enabled||t.originalEvent||I.hasClass("elfinder-maximized")?a=I.height()-r-I.data("margin-y"):(a=I.height(),n=I.css("min-height")||a,s=I.css("max-height")||a,n=n.match(/%/)?Math.floor(parseInt(n)/100*I.parent().height()):parseInt(n),s=s.match(/%/)?Math.floor(parseInt(s)/100*I.parent().height()):parseInt(s),a=Math.min(l?I.height():h.defaultSize.height,Math.max(s,n)-r-I.data("margin-y"))),f.css(l?"max-height":"height",a),d||(D(),n=a<(n=f.height())?n+r+I.data("margin-y"):i.minHeight,I.css("min-height",n),I.data("hasResizable")&&I.resizable("option",{minHeight:n}),"function"==typeof i.resize&&e.proxy(i.resize,f[0])(t,o)))}).on("tabstopsInit",H).on("focus","."+b,function(){e(this).addClass(p).parent("label").addClass(p),this.id&&e(this).parent().find("label[for="+this.id+"]").addClass(p)}).on("click","select."+b,function(){var i=e(this);i.data("keepFocus")?i.removeData("keepFocus"):i.data("keepFocus",!0)}).on("blur","."+b,function(){e(this).removeClass(p).removeData("keepFocus").parent("label").removeClass(p),this.id&&e(this).parent().find("label[for="+this.id+"]").removeClass(p)}).on("mouseenter mouseleave","."+b+",label",function(t){var o,a=e(this);("LABEL"!==this.nodeName||a.children("."+b).length||(o=a.attr("for"))&&e("#"+o).hasClass(b))&&(i.btnHoverFocus&&I.data("focusOnMouseOver")?"mouseenter"!==t.type||e(":focus").data("keepFocus")||a.trigger("focus"):a.toggleClass(p,"mouseenter"==t.type))}).on("keydown","."+b,function(i){var t,o,a=e(this);if(a.is(":focus")){if(t=i.keyCode===e.ui.keyCode.ESCAPE,i.keyCode===e.ui.keyCode.ENTER?(i.preventDefault(),a.trigger("click")):i.keyCode===e.ui.keyCode.TAB&&i.shiftKey||i.keyCode===e.ui.keyCode.LEFT||i.keyCode==e.ui.keyCode.UP?o="prev":i.keyCode!==e.ui.keyCode.TAB&&i.keyCode!=e.ui.keyCode.RIGHT&&i.keyCode!=e.ui.keyCode.DOWN||(o="next"),o&&(a.is("textarea")&&!i.ctrlKey&&!i.metaKey||a.is("select,span.ui-slider-handle")&&i.keyCode!==e.ui.keyCode.TAB||a.is("input:not(:checkbox,:radio)")&&!i.ctrlKey&&!i.metaKey&&i.keyCode===e.ui.keyCode["prev"===o?"LEFT":"RIGHT"]))return void i.stopPropagation();t?a.is("input:not(:checkbox,:radio),textarea")&&""!==a.val()&&(a.val(""),i.stopPropagation()):i.stopPropagation(),o&&(i.preventDefault(),("prev"===o?function(i){var t=k.filter(":visible:enabled"),o=t.last();return e.each(t,function(e,a){if(a===i&&t[e-1])return o=t.eq(e-1),!1}),o}:W)(this).trigger("focus"))}}).data({modal:i.modal}),D=function(){var e,i=t.getUI();i.hasClass("elfinder-fullscreen")&&(e=I.position(),I.css("top",Math.max(Math.min(Math.max(e.top,0),i.height()-100),0)),I.css("left",Math.max(Math.min(Math.max(e.left,0),i.width()-200),0)))};I.prepend(w),e.each(i.headerBtnOrder.split(":").reverse(),function(e,i){O[i]&&O[i]()}),r&&w.children(".elfinder-titlebar-button").addClass("elfinder-titlebar-button-right"),e.each(i.buttons,function(i,t){var o=e('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-btncnt-'+C+++" "+b+'"><span class="ui-button-text">'+i+"</span></button>").on("click",e.proxy(t,f[0]));t._cssClass&&o.addClass(t._cssClass),r?z.append(o):z.prepend(o)}),z.children().length&&(I.append(x),I.show(),x.find("button").each(function(i,t){y+=e(t).outerWidth(!0)}),I.hide(),y+=20,I.width()<y&&I.width(y)),I.append(M),h.enabled&&(d.width=I.outerWidth(!0)-I.width()+(I.outerWidth()-I.width())/2,d.height=I.outerHeight(!0)-I.height()+(I.outerHeight()-I.height())/2),t.options.dialogContained&&(a={maxWidth:s.width()-d.width,maxHeight:s.height()-d.height},i.maxWidth=i.maxWidth?Math.min(a.maxWidth,i.maxWidth):a.maxWidth,i.maxHeight=i.maxHeight?Math.min(a.maxHeight,i.maxHeight):a.maxHeight,I.css(a)),l={maxWidth:I.css("max-width"),maxHeight:I.css("max-height"),overflow:I.css("overflow")},i.resizable&&I.resizable({minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,start:function(){M.show(),!0!==I.data("resizing")&&I.data("resizing")&&clearTimeout(I.data("resizing")),I.data("resizing",!0)},stop:function(e,i){M.hide(),I.data("resizing",setTimeout(function(){I.data("resizing",!1)},200)),h.enabled&&(h.defaultSize={width:f.width(),height:f.height()})}}).data("hasResizable",!0),i.optimizeNumber&&I.find("input[type=number]").each(function(){e(this).attr("inputmode","numeric"),e(this).attr("pattern","[0-9]*")}),H(),"function"==typeof i.create&&e.proxy(i.create,this)(),i.autoOpen&&(i.open?requestAnimationFrame(function(){f.elfinderdialog("open")}):f.elfinderdialog("open")),i.resize&&t.bind("themechange",function(){setTimeout(function(){I.data("margin-y",f.outerHeight(!0)-f.height()),I.trigger("resize",{init:!0})},300)})}),this)},e.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},btnHoverFocus:!0,position:null,absolute:!1,width:320,height:"auto",minWidth:200,minHeight:70,maxWidth:null,maxHeight:null,allowMinimize:"auto",allowMaximize:!1,openMaximized:!1,headerBtnPos:"auto",headerBtnOrder:"auto",optimizeNumber:!0,propagationEvents:["mousemove","mouseup"]}});
//# sourceMappingURL=../sourcemaps/ui/dialog.js.map
