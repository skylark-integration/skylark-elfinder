/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(e){return e.prototype.commands.extract=function(){"use strict";var e=this,t=e.fm,n=[];this.variants=[],this.disableOnSearch=!0,t.bind("open reload",function(){n=t.option("archivers").extract||[],t.api>2?e.variants=[[{makedir:!0},t.i18n("cmdmkdir")],[{},t.i18n("btnCwd")]]:e.variants=[[{},t.i18n("btnCwd")]],e.change()}),this.getstate=function(e){var t,r=this.files(e),i=r.length;return i&&this.fm.cwd().write&&(t=r,$.grep(t,function(e){return!(!e.read||-1===$.inArray(e.mime,n))})).length==i?0:-1},this.exec=function(e,r){var i,c,a,l=this.files(e),o=$.Deferred(),m=l.length,s=r&&r.makedir?1:0,f=!1,d=!1,u=0,b=$.map(t.files(e),function(e){return e.name}),h={};$.grep(t.files(e),function(e){return h[e.name]=e,!1});var p=function(e){switch(e){case"overwrite_all":f=!0;break;case"omit_all":d=!0}},v=function(e){e.read&&t.file(e.phash).write?-1===$.inArray(e.mime,n)?(c=["errExtract",e.name,"errNoArchive"],t.error(c),o.reject(c)):t.request({data:{cmd:"extract",target:e.hash,makedir:s},notify:{type:"extract",cnt:1},syncOnFail:!0,navigate:{toast:s?{incwd:{msg:t.i18n(["complete",t.i18n("cmdextract")]),action:{cmd:"open",msg:"cmdopen"}},inbuffer:{msg:t.i18n(["complete",t.i18n("cmdextract")]),action:{cmd:"open",msg:"cmdopen"}}}:{inbuffer:{msg:t.i18n(["complete",t.i18n("cmdextract")])}}}}).fail(function(e){"rejected"!=o.state()&&o.reject(e)}).done(function(){}):(c=["errExtract",e.name,"errPerm"],t.error(c),o.reject(c))},x=function(e,n){var r=e[n],c=t.splitFileExtention(r.name)[0],l=$.inArray(c,b)>=0,g=function(){n+1<m?x(e,n+1):o.resolve()};!s&&l&&"directory"!=h[c].mime?t.confirm({title:t.i18n("ntfextract"),text:["errExists",c,"confirmRepl"],accept:{label:"btnYes",callback:function(t){if(p(a=t?"overwrite_all":"overwrite"),f||d){if(f){for(i=n;i<m;i++)v(e[i]);o.resolve()}}else"overwrite"==a&&v(r),n+1<m?x(e,n+1):o.resolve()}},reject:{label:"btnNo",callback:function(t){p(a=t?"omit_all":"omit"),!f&&!d&&n+1<m?x(e,n+1):d&&o.resolve()}},cancel:{label:"btnCancel",callback:function(){o.resolve()}},all:n+1<m}):s?(v(r),g()):0==u?t.confirm({title:t.i18n("cmdextract"),text:[t.i18n("cmdextract")+' "'+r.name+'"',"confirmRepl"],accept:{label:"btnYes",callback:function(e){e&&(u=1),v(r),g()}},reject:{label:"btnNo",callback:function(e){e&&(u=-1),g()}},cancel:{label:"btnCancel",callback:function(){o.resolve()}},all:n+1<m}):(u>0&&v(r),g())};return this.enabled()&&m&&n.length?(m>0&&x(l,0),o):o.reject()}},e});
//# sourceMappingURL=../sourcemaps/commands/extract.js.map
