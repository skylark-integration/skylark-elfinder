/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(e){return(e.prototype.commands.open=function(){"use strict";var e=this.fm,t=this;this.alwaysEnabled=!0,this.noChangeDirOnRemovedCwd=!0,this._handlers={dblclick:function(n){var a=n.data&&n.data.file?[n.data.file]:void 0;0===t.getstate(a)&&(n.preventDefault(),e.exec("open",a))},"select enable disable reload":function(e){this.update("disable"==e.type?-1:void 0)}},this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=e.OS&&" enter")}],this.getstate=function(t){var n=this.files(t),a=n.length;return 1==a?n[0].read?0:-1:a&&!e.UA.Mobile&&$.grep(n,function(e){return!("directory"==e.mime||!e.read)}).length==a?0:-1},this.exec=function(t,n){var a,r,i,o,l,c,d,s,h,p,u,f,m=$.Deferred().fail(function(t){t&&e.error(t)}),g=this.files(t),b=g.length,w="object"==typeof n&&n.thash,y=this.options,v=y.into||"window";if(!b&&!w)return m.reject();if(w||1==b&&(a=g[0])&&"directory"==a.mime)return w||!a||a.read?e.keyState.ctrlKey&&(e.keyState.shiftKey||"function"!=typeof e.options.getFileCallback)&&e.getCommand("opennew")?e.exec("opennew",[w||a.hash]):e.request({data:{cmd:"open",target:w||a.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0,lazy:!1}):m.reject(["errOpen",a.name,"errPerm"]);if(g=$.grep(g,function(e){return"directory"!=e.mime}),b!=g.length)return m.reject();var C=function(){var n,u,f=function(t){var s=$("<a>").hide().appendTo($("body"));if(e.UA.Mobile||!p){if(h)p?s.attr("target","_blank"):s.attr("download",a.name),s.attr("href",t).get(0).click();else if(!(n=window.open(t)))return m.reject("errPopup")}else{if(!("string"==typeof y.method&&"get"===y.method.toLowerCase())&&0===t.indexOf(e.options.url)&&e.customData&&Object.keys(e.customData).length&&!a.mime.match(/^(?:video|audio)/)&&(t=""),"window"===v?(o=c=Math.round(2*screen.availWidth/3),l=d=Math.round(2*screen.availHeight/3),parseInt(a.width)&&parseInt(a.height)?(o=parseInt(a.width),l=parseInt(a.height)):a.dim&&(r=a.dim.split("x"),o=parseInt(r[0]),l=parseInt(r[1])),c>=o&&d>=l?(c=o,d=l):o-c>l-d?d=Math.round(l*(c/o)):c=Math.round(o*(d/l)),i="width="+c+",height="+d,n=window.open(t,u,i+",top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no")):("tabs"===v&&(u=a.hash),n=window.open("about:blank",u)),!n)return m.reject("errPopup");if(""===t){var f=document.createElement("form");f.action=e.options.url,f.method="POST",f.target=u,f.style.display="none";var g=Object.assign({},e.customData,{cmd:"file",target:a.hash,_t:a.ts||parseInt(+new Date/1e3)});$.each(g,function(e,t){var n=document.createElement("input");n.name=e,n.value=t,f.appendChild(n)}),document.body.appendChild(f),f.submit()}else"window"!==v&&(n.location=t);$(n).trigger("focus")}s.remove()};try{s=new RegExp(e.option("dispInlineRegex"),"i")}catch(e){s=!1}for(h="string"==typeof $("<a>").get(0).download,b=g.length;b--;){if(u="elf_open_window",!(a=g[b]).read)return m.reject(["errOpen",a.name,"errPerm"]);p=s&&a.mime.match(s),e.openUrl(a.hash,!p,f)}return m.resolve(t)};if(b>1)e.confirm({title:"openMulti",text:["openMultiConfirm",b+""],accept:{label:"cmdopen",callback:function(){C()}},cancel:{label:"btnCancel",callback:function(){m.reject()}},buttons:e.getCommand("zipdl")&&e.isCommandEnabled("zipdl",e.cwd().hash)?[{label:"cmddownload",callback:function(){e.exec("download",t),m.reject()}}]:[]});else{if((u=e.storage("selectAction")||y.selectAction)&&($.each(u.split("/"),function(){var t=this.valueOf();if("open"!==t&&(f=e.getCommand(t))&&f.enabled())return!1;f=null}),f))return e.exec(f.name);C()}return m}}).prototype={forceLoad:!0},e});
//# sourceMappingURL=../sourcemaps/commands/open.js.map
