/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["../elFinder"],function(e){return e.prototype.commands.search=function(){"use strict";this.title="Find files",this.options={ui:"searchbutton"},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return 0},this.exec=function(e,t,n,r){var i,s,a=this.fm,c=[],o=r||"",h=a.options.onlyMimes,l=[],f=function(e){return o&&"SearchName"!==o&&"SearchMime"!==o&&(e.type=o),e};return"string"==typeof e&&e?("object"==typeof t&&(n=t.mime||"",t=t.target||""),t=t||"",n?(n=$.trim(n).replace(","," ").split(" "),h.length&&(n=$.map(n,function(e){return(e=$.trim(e))&&(-1!==$.inArray(e,h)||$.grep(h,function(t){return 0===e.indexOf(t)}).length)?e:null}))):n=[].concat(h),a.trigger("searchstart",f({query:e,target:t,mimes:n})),!h.length||n.length?""===t&&a.api>=2.1?(s=Object.keys(a.roots).length,$.each(a.roots,function(t,r){c.push(a.request({data:f({cmd:"search",q:e,target:r,mimes:n}),notify:{type:"search",cnt:1,hideCnt:!(s>1)},cancel:!0,preventDone:!0}))})):(c.push(a.request({data:f({cmd:"search",q:e,target:t,mimes:n}),notify:{type:"search",cnt:1,hideCnt:!0},cancel:!0,preventDone:!0})),""!==t&&a.api>=2.1&&Object.keys(a.leafRoots).length&&$.each(a.leafRoots,function(r,s){for(i=r;i;)t===i&&$.each(s,function(){var t=a.file(this);t&&t.volumeid&&l.push(t.volumeid),c.push(a.request({data:f({cmd:"search",q:e,target:this,mimes:n}),notify:{type:"search",cnt:1,hideCnt:!1},cancel:!0,preventDone:!0}))}),i=(a.file(i)||{}).phash})):c=[$.Deferred().resolve({files:[]})],a.searchStatus.mixed=c.length>1&&l,$.when.apply($,c).done(function(e){var t,n=arguments.length;if(e.warning&&a.error(e.warning),n>1)for(e.files=e.files||[],t=1;t<n;t++)arguments[t].warning&&a.error(arguments[t].warning),arguments[t].files&&e.files.push.apply(e.files,arguments[t].files);e.files&&e.files.length&&a.cache(e.files),a.lazy(function(){a.trigger("search",e)}).then(function(){return a.lazy(function(){a.trigger("searchdone")})}).then(function(){e.sync&&a.sync()})})):(a.getUI("toolbar").find("."+a.res("class","searchbtn")+" :text").trigger("focus"),$.Deferred().reject())}},e});
//# sourceMappingURL=../sourcemaps/commands/search.js.map
