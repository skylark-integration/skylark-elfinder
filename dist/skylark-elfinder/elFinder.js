/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define([],function(){var e,t,n,i,r,o,a,s,l,c,d,u=function(e,t,n){"use strict";var i,r,o,a,s,l,c,d,p,h,f,m,g,y,v,b,w,x,k,C,O=this,A=[],S=["button","tooltip"],T=$(e),j=$.extend(!0,{},$._data(T.get(0),"events")),D=$("<div/>").append(T.contents()).attr("class",T.attr("class")||"").attr("style",T.attr("style")||""),F=T.attr("id")||T.attr("id","elfauto"+$(".elfinder").length).attr("id"),z="elfinder-"+F,M="mousedown."+z,E="keydown."+z,U="keypress."+z,I="keyup."+z,R=!1,P=!1,_="",q={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,uploadOverwrite:!0,uploadMaxSize:0,jpgQuality:100,tmbCrop:!1,tmbReqCustomData:!1,tmb:!1},H={},N={},L={},B={},W=[],X={},J={},K=[],G={},V=[],Y=[],Q=new O.command(O),Z="auto",ee=400,te=null,ne="sounds/",ie="",re=!1,oe=$(document.createElement("audio")).hide().appendTo("body")[0],ae=0,se="",le=null,ce=function(e){var t,n,i,r,o,a,s,l={},c={};O.api>=2.1?(O.commandMap=e.options.uiCmdMap&&Object.keys(e.options.uiCmdMap).length?e.options.uiCmdMap:{},se!==JSON.stringify(O.commandMap)&&(se=JSON.stringify(O.commandMap))):O.options.sync=0,e.init?(N={},B={}):(o=_,t="elfinder-subtree-loaded "+O.res("class","navexpand"),O.res("class","navcollapse"),n=Object.keys(N),i=function(e){if(!N[e])return!0;var n="directory"===N[e].mime,i=N[e].phash;!(!n||l[i]||!c[i]&&O.navHash2Elm(N[e].hash).is(":hidden")&&O.navHash2Elm(i).next(".elfinder-navbar-subtree").children().length>100)||!n&&i===_||G[e]?n&&(c[i]=!0):(n&&!l[i]&&(l[i]=!0,O.navHash2Elm(i).removeClass(t).next(".elfinder-navbar-subtree").empty()),pe(N[e]))},r=function(){n.length&&(le&&le._abort(),le=O.asyncJob(i,n,{interval:20,numPerOnce:100}).done(function(){var e=O.storage("hide")||{items:{}};Object.keys(L).length&&$.each(L,function(t){e.items[t]||delete L[t]})}))},O.trigger("filesgc").one("filesgc",function(){n=[]}),O.one("opendone",function(){o!==_&&(T.data("lazycnt")?O.one("lazydone",r):r())})),O.sorters={},_=e.cwd.hash,de(e.files),N[_]?(s=O.diff([e.cwd],!0)).changed.length&&(de(s.changed,"change"),O.change({changed:s.changed})):de([e.cwd]),e.changed&&e.changed.length&&de(e.changed,"change"),a=JSON.stringify(O.sorters),ie!==a&&(O.trigger("sorterupdate"),ie=a),O.lastDir(_),O.autoSync()},de=function(e,t){t=t||"files";var n,i,r,o,a,s=["sizeInfo","encoding"],l={name:!0,perm:!0,date:!0,size:!0,kind:!0},c=!O.sorters._checked&&"files"===t,d=e.length,u=function(e){var t=e||{},n=[];$.each(O.sortRules,function(e){(l[e]||void 0!==t[e]||"mode"===e&&void 0!==t.perm)&&n.push(e)}),O.sorters=O.arrayFlip(n,!0),O.sorters._checked=!0},p={},h=O.storage("hide")||{},f=h.items||{};for(i=0;i<d;i++)if(n=Object.assign({},e[i]),a=!(h.show||!f[n.hash]),n.name&&n.hash&&n.mime){if(a||(c&&n.phash===_&&(u(n),c=!1),!n.phash||"add"!==t&&("change"!==t||N[n.hash]&&n.size===N[n.hash])||(o=O.parents(n.phash))&&$.each(o,function(){p[this]=!0})),N[n.hash]){for(r=0;r<s.length;r++)N[n.hash][s[r]]&&!n[s[r]]&&(n[s[r]]=N[n.hash][s[r]]);n.sizeInfo&&!n.size&&(n.size=n.sizeInfo.size),pe(N[n.hash],!0)}f[n.hash]&&(L[n.hash]=n),a?(d--,e.splice(i--,1)):(N[n.hash]=n,"directory"!==n.mime||B[n.hash]||(B[n.hash]={}),n.phash&&(B[n.phash]||(B[n.phash]={}),B[n.phash][n.hash]=!0))}$.each(Object.keys(p),function(){var e=N[this];e&&e.sizeInfo&&delete e.sizeInfo}),c&&u()},ue=function(e){var t,n=e.length,i={},r=function(e){var n=N[e];n&&("directory"===n.mime&&(i[e]&&delete O.roots[i[e]],$.each(O.leafRoots,function(t,n){var i,r;-1!==(i=$.inArray(e,n))&&(1===n.length?((r=Object.assign({},N[t]))&&r._realStats&&($.each(r._realStats,function(e,t){r[e]=t}),ue(N[t]._realStats),O.change({changed:[r]})),delete O.leafRoots[t]):O.leafRoots[t].splice(i,1))}),O.searchStatus.state<2&&$.each(N,function(t,n){n.phash==e&&r(t)})),n.phash&&(t=O.parents(n.phash))&&$.each(t,function(){o[this]=!0}),pe(N[e]))},o={};for($.each(O.roots,function(e,t){i[t]=e});n--;)r(e[n]);$.each(Object.keys(o),function(){var e=N[this];e&&e.sizeInfo&&delete e.sizeInfo})},pe=function(e,t){var n=e.hash,i=e.phash;i&&B[i]&&delete B[i][n],t||(B[n]&&delete B[n],O.optionsByHashes[n]&&delete O.optionsByHashes[n]),delete N[n]},he=0,fe=[],me=null,ge=function(e){var t,n=e.keyCode,i=!(!e.ctrlKey&&!e.metaKey),r="mousedown"===e.type;!r&&(O.keyState.keyCode=n),O.keyState.ctrlKey=i,O.keyState.shiftKey=e.shiftKey,O.keyState.metaKey=e.metaKey,O.keyState.altKey=e.altKey,r||("keyup"!==e.type?R&&($.each(J,function(t,r){r.type==e.type&&r.keyCode==n&&r.shiftKey==e.shiftKey&&r.ctrlKey==i&&r.altKey==e.altKey&&(e.preventDefault(),e.stopPropagation(),r.callback(e,O),O.debug("shortcut-exec",t+" : "+r.description))}),n!=$.ui.keyCode.TAB||$(e.target).is(":input")||e.preventDefault(),"keydown"===e.type&&n==$.ui.keyCode.ESCAPE&&(T.find(".ui-widget:visible").length||O.clipboard().length&&O.clipboard([]),$.ui.ddmanager&&(t=$.ui.ddmanager.current)&&t.helper&&t.cancel(),O.toHide(T.find(".ui-widget.elfinder-button-menu.elfinder-frontmost:visible")),O.trigger("keydownEsc",e))):O.keyState.keyCode=null)},ye=new Date,ve=window.parent!==window,be=function(){var e,t;if(ve)try{(t=$("iframe",window.parent.document)).length&&$.each(t,function(t,n){if(n.contentWindow===window)return e=$(n),!1})}catch(e){}return e}();t||(t={}),O.UA.Mobile&&$(window).on("orientationchange."+z,function(){var e=(screen&&screen.orientation&&screen.orientation.angle||window.orientation||0)+0;-90===e&&(e=270),O.UA.Angle=e,O.UA.Rotated=e%180!=0}).trigger("orientationchange."+z),t.bootCallback&&"function"==typeof t.bootCallback&&(d=n,p=t.bootCallback,n=function(e,t){d&&"function"==typeof d&&d.call(this,e,t),p.call(this,e,t)}),delete t.bootCallback,this.api=null,this.newAPI=!1,this.oldAPI=!1,this.netDrivers=[],this.baseUrl="",this.i18nBaseUrl="",this.cssloaded=!1,this.theme=null,this.mimesCanMakeEmpty={},this.bootCallback,this.reloadCallback,this.id=F,this.storage=function(){try{return"localStorage"in window&&null!==window.localStorage?(O.UA.Safari&&(window.localStorage.setItem("elfstoragecheck",1),window.localStorage.removeItem("elfstoragecheck")),O.localStorage):O.cookie}catch(e){return O.cookie}}(),this.pauseUnloadCheck=function(e,t){if(void 0===e)return re;re=!!e,e&&!t&&requestAnimationFrame(function(){re=!1})},this.options=Object.assign({},this._options),t.uiOptions&&t.uiOptions.toolbar&&Array.isArray(t.uiOptions.toolbar)&&$.isPlainObject(t.uiOptions.toolbar[t.uiOptions.toolbar.length-1])&&(O.options.uiOptions.toolbarExtra=Object.assign(O.options.uiOptions.toolbarExtra||{},t.uiOptions.toolbar.pop())),(h=function(e,t){$.isPlainObject(e)&&$.each(e,function(e,n){$.isPlainObject(n)?(t[e]||(t[e]={}),h(n,t[e])):t[e]=n})})(t,O.options),this.options.uiOptions.toolbar.push(this.options.uiOptions.toolbarExtra),delete this.options.uiOptions.toolbarExtra,this.toUnbindEvents={},this.bind=function(e,t,n){var i,r;if(t&&("function"==typeof t||"function"==typeof t.done))for(r=(e=(""+e).toLowerCase().replace(/^\s+|\s+$/g,"").split(/\s+/)).length,i=0;i<r;i++)void 0===X[e[i]]&&(X[e[i]]=[]),X[e[i]][n?"unshift":"push"](t);return this},this.unbind=function(e,t){var n,i,r,o;for(i=(e=(""+e).toLowerCase().split(/\s+/)).length,n=0;n<i;n++)(r=X[e[n]])&&(o=$.inArray(t,r))>-1&&r.splice(o,1);return t=null,this},this.trigger=function(e,t,n){var i,r,o,a,s=e.toLowerCase(),l="object"==typeof t,c=X[s]||[],d=[];if(this.debug("event-"+s,t),l&&void 0!==n||(n=!0),r=c.length){for(a=$.Event(s),t&&(t._getEvent=function(){return a}),n&&(a.data=t),i=0;i<r;i++)if(c[i])if(c[i].done)d.push(c[i].done);else{if(c[i].length&&!n){if(void 0===o)try{o=JSON.stringify(t)}catch(e){o=!1}a.data=o?JSON.parse(o):t}try{if(!1===c[i].call(a,a,this)||a.isDefaultPrevented()){this.debug("event-stoped",a.type);break}}catch(e){window.console&&window.console.log&&window.console.log(e)}}if(r=d.length)for(i=0;i<r;i++)try{if(!1===d[i].call(a,a,this)||a.isDefaultPrevented()){this.debug("event-stoped",a.type+"(done)");break}}catch(e){window.console&&window.console.log&&window.console.log(e)}this.toUnbindEvents[s]&&this.toUnbindEvents[s].length&&($.each(this.toUnbindEvents[s],function(e,t){O.unbind(t.type,t.callback)}),delete this.toUnbindEvents[s])}return this},this.getListeners=function(e){return e?X[e.toLowerCase()]:X},this.baseUrl=function(){var e,t,n;return O.options.baseUrl?O.options.baseUrl:(n="",e=null,$("head > script").each(function(){if(this.src&&this.src.match(/js\/elfinder(?:-[a-z0-9_-]+)?\.(?:min|full)\.js$/i))return e=$(this),!1}),e&&((n=e.attr("src").replace(/js\/[^\/]+$/,"")).match(/^(https?\/\/|\/)/)||(t=$("head > base[href]").attr("href"))&&(n=t.replace(/\/$/,"")+"/"+n)),""!==n?O.options.baseUrl=n:(O.options.baseUrl||(O.options.baseUrl="./"),n=O.options.baseUrl),n)}(),this.i18nBaseUrl=(this.options.i18nBaseUrl||this.baseUrl+"js/i18n").replace(/\/$/,"")+"/",this.options.maxErrorDialogs=Math.max(1,parseInt(this.options.maxErrorDialogs||5)),q.dispInlineRegex=this.options.dispInlineRegex,this.options.cssAutoLoad&&(f=O.baseUrl,m=function(){T.data("cssautoloadHide")&&(T.data("cssautoloadHide").remove(),T.removeData("cssautoloadHide"))},g=function(){O.cssloaded||(m(),O.cssloaded=!0,O.trigger("cssloaded"))},$('head > link[href$="css/elfinder.min.css"],link[href$="css/elfinder.full.css"]:first').length||(O.cssloaded=null),Array.isArray(O.options.cssAutoLoad)&&(O.options.themes.default?!0===O.cssloaded?O.loadCss(O.options.cssAutoLoad):O.bind("cssloaded",function(){O.loadCss(O.options.cssAutoLoad)}):(O.options.themes=Object.assign({default:{name:"default",cssurls:O.options.cssAutoLoad}},O.options.themes),O.options.theme||(O.options.theme="default"))),null===O.cssloaded&&(T.addClass("elfinder").data("cssautoloadHide",$("<style>.elfinder{visibility:hidden;overflow:hidden}</style>")),$("head").append(T.data("cssautoloadHide")),O.options.themes.default||(O.options.themes=Object.assign({default:{name:"default",cssurls:"css/theme.css",author:"elFinder Project",license:"3-clauses BSD"}},O.options.themes),O.options.theme||(O.options.theme="default")),requestAnimationFrame(function(){"hidden"===T.css("visibility")?O.loadCss([f+"css/elfinder.min.css"],{dfd:$.Deferred().done(function(){g()}).fail(function(){m(),O.cssloaded||(O.cssloaded=!1,O.bind("init",function(){O.cssloaded||O.error(["errRead","CSS (elfinder.min)"])}))})}):g()}))),v=O.options.themes,(b=Object.keys(v||{})).length&&(v[y=O.storage("theme")||O.options.theme]||(y=b[0]),O.cssloaded?O.changeTheme(y):O.bind("cssloaded",function(){O.changeTheme(y)})),this.optionProperties={icon:void 0,csscls:void 0,tmbUrl:void 0,uiCmdMap:{},netkey:void 0,disabled:[]},ve||this.options.enableAlways||2!==$("body").children().length||(this.options.enableAlways=!0),!0===this.options.debug?this.options.debug="all":Array.isArray(this.options.debug)?(w={},$.each(O.options.debug,function(){w[this]=!0}),O.options.debug=w):this.options.debug=!1,this.noConflicts={},this.noConflict=function(){$.each(S,function(e,t){$.fn[t]&&"function"==typeof $.fn[t].noConflict&&(O.noConflicts[t]=$.fn[t].noConflict())})},this.noConflict(),this.isCORS=!1,function(){if(void 0!==O.options.cors&&null!==O.options.cors)O.isCORS=!!O.options.cors;else{var e,n=document.createElement("a"),i=window.location.protocol,r=function(e){return"https:"===(e=e&&":"!==e?e:i)?/\:443$/:/\:80$/},o=window.location.host.replace(r(i),"");n.href=t.url,t.urlUpload&&t.urlUpload!==t.url&&((e=document.createElement("a")).href=t.urlUpload),(o!==n.host.replace(r(n.protocol),"")||":"!==n.protocol&&""!==n.protocol&&i!==n.protocol||e&&(o!==e.host.replace(r(e.protocol),"")||":"!==e.protocol&&""!==e.protocol&&i!==e.protocol))&&(O.isCORS=!0)}O.isCORS&&($.isPlainObject(O.options.customHeaders)||(O.options.customHeaders={}),$.isPlainObject(O.options.xhrFields)||(O.options.xhrFields={}),O.options.requestType="post",O.options.customHeaders["X-Requested-With"]="XMLHttpRequest",O.options.xhrFields.withCredentials=!0)}(),this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",o=Math.max(parseInt(this.options.requestMaxConn),1),this.optsCustomData=$.isPlainObject(this.options.customData)?this.options.customData:{},this.customData=Object.assign({},this.optsCustomData),this.prevCustomData=null,this.customHeaders=$.isPlainObject(this.options.customHeaders)?this.options.customHeaders:{},this.xhrFields=$.isPlainObject(this.options.xhrFields)?this.options.xhrFields:{},this.replaceXhrSend=function(){c||(c=XMLHttpRequest.prototype.send),XMLHttpRequest.prototype.send=function(){var e=this;return O.customHeaders&&$.each(O.customHeaders,function(t){e.setRequestHeader(t,this)}),O.xhrFields&&$.each(O.xhrFields,function(t){t in e&&(e[t]=this)}),c.apply(this,arguments)}},this.restoreXhrSend=function(){c&&(XMLHttpRequest.prototype.send=c)},this.abortCmdsOnOpen=this.options.abortCmdsOnOpen||["tmb","parents"],this.navPrefix="nav"+(u.prototype.uniqueid?u.prototype.uniqueid:"")+"-",this.cwdPrefix=u.prototype.uniqueid?"cwd"+u.prototype.uniqueid+"-":"",++u.prototype.uniqueid,this.uploadURL=t.urlUpload||t.url,this.namespace=z,this.today=new Date(ye.getFullYear(),ye.getMonth(),ye.getDate()).getTime()/1e3,this.yesterday=this.today-86400,a=this.options.UTCDate?"UTC":"",this.getHours="get"+a+"Hours",this.getMinutes="get"+a+"Minutes",this.getSeconds="get"+a+"Seconds",this.getDate="get"+a+"Date",this.getDay="get"+a+"Day",this.getMonth="get"+a+"Month",this.getFullYear="get"+a+"FullYear",this.zIndex,this.searchStatus={state:0,query:"",target:"",mime:"",mixed:!1,ininc:!1},this.lang=this.storage("lang")||this.options.lang,"jp"===this.lang&&(this.lang=this.options.lang="ja"),this.viewType=this.storage("view")||this.options.defaultView||"icons",this.sortType=this.storage("sortType")||this.options.sortType||"name",this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc",this.sortStickFolders=this.storage("sortStickFolders"),null===this.sortStickFolders?this.sortStickFolders=!!this.options.sortStickFolders:this.sortStickFolders=!!this.sortStickFolders,this.sortAlsoTreeview=this.storage("sortAlsoTreeview"),null===this.sortAlsoTreeview||null===this.options.sortAlsoTreeview?this.sortAlsoTreeview=!!this.options.sortAlsoTreeview:this.sortAlsoTreeview=!!this.sortAlsoTreeview,this.sortRules=$.extend(!0,{},this._sortRules,this.options.sortRules),$.each(this.sortRules,function(e,t){"function"!=typeof t&&delete O.sortRules[e]}),this.compare=$.proxy(this.compare,this),this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500,this.draggingUiHelper=null,this.droppable={greedy:!0,tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename",hoverClass:this.res("class","adroppable"),classes:{"ui-droppable-hover":this.res("class","adroppable")},autoDisable:!0,drop:function(e,t){var n,i,r,o=$(this),a=$.grep(t.helper.data("files")||[],function(e){return!!e}),s=[],l=[],c=[],d=t.helper.hasClass("elfinder-drag-helper-plus"),u="class";if(void 0===e.button||t.helper.data("namespace")!==z||!O.insideWorkzone(e.pageX,e.pageY))return!1;for(i=o.hasClass(O.res(u,"cwdfile"))?O.cwdId2Hash(o.attr("id")):o.hasClass(O.res(u,"navdir"))?O.navId2Hash(o.attr("id")):_,n=a.length;n--;)(r=a[n])!=i&&N[r].phash!=i?s.push(r):(d&&r!==i&&N[i].write?l:c).push(r);if(c.length)return!1;t.helper.data("droped",!0),l.length&&(t.helper.hide(),O.exec("duplicate",l,{_userAction:!0})),s.length&&(t.helper.hide(),O.clipboard(s,!d),O.exec("paste",i,{_userAction:!0},i).always(function(){O.clipboard([]),O.trigger("unlockfiles",{files:a})}),O.trigger("drop",{files:a}))}},this.enabled=function(){return R&&this.visible()},this.visible=function(){return T[0].elfinder&&T.is(":visible")},this.isRoot=function(e){return!(!e.isroot&&e.phash)},this.root=function(e,t){var n,i;if(e=e||_,!t&&($.each(O.roots,function(t,i){if(0===e.indexOf(t))return n=i,!1}),n))return n;for(n=N[e];n&&n.phash&&(t||!n.isroot);)n=N[n.phash];if(n)return n.hash;for(;i in N&&N.hasOwnProperty(i);)if("directory"===(n=N[i]).mime&&!n.phash&&n.read)return n.hash;return""},this.cwd=function(){return N[_]||{}},this.option=function(e,t){var n,i;return t=t||_,O.optionsByHashes[t]&&void 0!==O.optionsByHashes[t][e]?O.optionsByHashes[t][e]:!O.hasVolOptions||_===t||(i=O.file(t))&&i.phash===_?H[e]||"":(n="",$.each(O.volOptions,function(i,r){if(0===t.indexOf(i))return n=r[e]||"",!1}),n)},this.getDisabledCmds=function(e,t){var n={hidden:!0};return Array.isArray(e)||(e=[e]),$.each(e,function(e,t){var i=O.option("disabledFlip",t);i&&Object.assign(n,i)}),t?n:Object.keys(n)},this.file=function(e,t){return e?N[e]||(t?L[e]:void 0):void 0},this.files=function(e){var t={};return e?B[e]?($.each(B[e],function(n){N[n]?t[n]=N[n]:delete B[e][n]}),Object.assign({},t)):{}:Object.assign({},N)},this.parents=function(e){for(var t,n=[];e&&(t=this.file(e));)n.unshift(t.hash),e=t.phash;return n},this.path2array=function(e,t){for(var n,i=[];e;){if(!(n=N[e])||!n.hash){i=[];break}i.unshift(t&&n.i18?n.i18:n.name),e=n.isroot?null:n.phash}return i},this.path=function(e,t,n){var i=N[e]&&N[e].path?N[e].path:this.path2array(e,t).join(H.separator);if(n&&N[e]){n=Object.assign({notify:{type:"parents",cnt:1,hideCnt:!0}},n);var r,o=$.Deferred(),a=n.notify,s=!1,l=function(){O.request({data:{cmd:"parents",target:N[e].phash},notify:a,preventFail:!0}).done(c).fail(function(){o.reject()})},c=function(){O.one("parentsdone",function(){""===(i=O.path(e,t))&&s?(s=!1,l()):(a&&(clearTimeout(r),a.cnt=-parseInt(a.cnt||0),O.notify(a)),o.resolve(i))})};return i?o.resolve(i):(O.ui.tree?(a&&(r=setTimeout(function(){O.notify(a)},O.notifyDelay)),s=!0,c(!0)):l(),o)}return i},this.url=function(e,t){var n,i=N[e],r=t||{},o=r.async||!1,a=r.temporary||!1,s=r.onetime&&O.option("onetimeUrl",e)||!1,l=r.absurl||!1,c=o||s?$.Deferred():null,d=function(e){return e&&l&&(e=O.convAbsUrl(e)),e},u=function(t){if(t)return d(t);if(i.url)return d(i.url);if(void 0===n&&(n=p()),n)return d(n+$.map(O.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/"));var r=Object.assign({},O.customData,{cmd:"file",target:i.hash});return O.oldAPI&&(r.cmd="open",r.current=i.phash),d(O.options.url+(-1===O.options.url.indexOf("?")?"?":"&")+$.param(r,!0))},p=function(){return O.option("url",!O.isRoot(i)&&i.phash||i.hash)};if(!i||!i.read)return o?c.resolve(""):"";if(!s||i.url&&"1"!=i.url||(n=p()))if("1"==i.url||a&&!i.url&&!(n=p()))this.request({data:{cmd:"url",target:e,options:{temporary:a?1:0}},preventDefault:!0,options:{async:o},notify:o?{type:a?"file":"url",cnt:1,hideCnt:!0}:{},progressBar:r.progressBar}).done(function(e){i.url=e.url||""}).fail(function(){i.url=""}).always(function(){var e;if(i.url&&a&&(e=i.url,i.url="1"),!o)return u(e);c.resolve(u(e))});else{if(!o)return u();c.resolve(u())}else o=!0,this.request({data:{cmd:"url",target:e,options:{onetime:1}},preventDefault:!0,options:{async:o},notify:{type:"file",cnt:1,hideCnt:!0},progressBar:r.progressBar}).done(function(e){c.resolve(d(e.url||""))}).fail(function(){c.resolve("")});return o?c:void 0},this.forExternalUrl=function(e,t){var n={async:!0,absurl:!0};return n[O.option("onetimeUrl",e)?"onetime":"temporary"]=!0,O.url(e,Object.assign({},t,n))},this.openUrl=function(e,t,n,i){var r=N[e],o="",a=(i||{}).onetimeSize||5242880;return r&&r.read?t&&"sameorigin"!==t||(r.url?1!=r.url&&(o=r.url):H.url&&0===r.hash.indexOf(O.cwd().volumeid)&&(o=H.url+$.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/")),t&&!this.isSameOrigin(o)||!o)?n&&this.hasParrotHeaders()?(i?delete i.onetimeSize:i={},!i.onetime&&!i.temporary&&r.size>a&&(r.mime.match(/^video|audio/)?i.temporary=!0:i.onetime=!0),i.onetime||i.temporary?this.url(r.hash,Object.assign({async:!0},i)).done(function(e){n(e)}).fail(function(){n("")}):this.getContents(e,"blob",i).done(function(e){o=(window.URL||window.webkitURL).createObjectURL(e),n(o)}).fail(function(){n("")})):(o=(o=this.options.url)+(-1===o.indexOf("?")?"?":"&")+(this.oldAPI?"cmd=open&current="+r.phash:"cmd=file")+"&target="+r.hash+"&_t="+(r.ts||parseInt(+new Date/1e3)),!0===t&&(o+="&download=1"),$.each(this.customData,function(e,t){o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t)}),n?void n(o):o):(o+=(o.match(/\?/)?"&":"?")+"_".repeat((o.match(/[\?&](_+)t=/g)||["&t="]).sort().shift().match(/[\?&](_*)t=/)[1].length+1)+"t="+(r.ts||parseInt(+new Date/1e3)),n?void n(o):o):""},this.tmb=function(e){var t,n,i="elfinder-cwd-bgurl",r="",o={},a=0;return!(!$.isPlainObject(e)||(O.searchStatus.state&&0!==e.hash.indexOf(O.cwd().volumeid)?(t=O.option("tmbUrl",e.hash),n=O.option("tmbCrop",e.hash)):(t=H.tmbUrl,n=H.tmbCrop),n&&(i+=" elfinder-cwd-bgurl-crop"),"self"===t&&0===e.mime.indexOf("image/")?(r=O.openUrl(e.hash),i+=" elfinder-cwd-bgself"):(O.oldAPI||t)&&e&&e.tmb&&1!=e.tmb?r=t+e.tmb:O.newAPI&&e&&e.tmb&&1!=e.tmb&&(r=e.tmb),!r))&&("self"!==t&&(e.ts&&(o._t=e.ts),H.tmbReqCustomData&&Object.keys(this.customData).length&&(o=Object.assign(o,this.customData)),Object.keys(o).length&&(r+=r.match(/\?/)?"&":"?",$.each(o,function(e,t){r+=(0==a++?"":"&")+encodeURIComponent(e)+"="+encodeURIComponent(t)}))),{url:r,className:i})},this.selected=function(){return W.slice(0)},this.selectedFiles=function(){return $.map(W,function(e){return N[e]?Object.assign({},N[e]):null})},this.fileByName=function(e,t){var n;for(n in N)if(N.hasOwnProperty(n)&&N[n].phash==t&&N[n].name==e)return N[n]},this.validResponse=function(e,t){return t.error||this.rules[this.rules[e]?e:"defaults"](t)},this.returnBytes=function(e){var t;return isNaN(e)?(e||(e=""),t=(e=e.replace(/b$/i,"")).charAt(e.length-1).toLowerCase(),e=e.replace(/[tgmk]$/i,""),"t"==t?e=1024*e*1024*1024*1024:"g"==t?e=1024*e*1024*1024:"m"==t?e=1024*e*1024:"k"==t&&(e*=1024),e=isNaN(e)?0:parseInt(e)):(e=parseInt(e))<1&&(e=0),e},this.request=function(e){var t,n,i,r,a=this,s=this.options,l=$.Deferred(),c=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),d=Object.assign({},a.customData,{mimes:s.onlyMimes},e.data||e),u=d.cmd,p="binary"===(e.options||{}).dataType,h=!e.asNotOpen&&"open"===u,f=!(p||e.preventDefault||e.preventFail),m=!(p||e.preventDefault||e.preventDone),g=e.progressVal||20,y=null,v=!1,b=e.progressBar?{}:e.notify?Object.assign({progress:g*e.notify.cnt},e.notify):{},w=!!e.cancel,x=p||!!e.raw,k=e.syncOnFail,C=!!e.lazy,O=e.prepare,A=e.navigate,S=(e.options||{}).cache,T=Object.assign({url:s.url,async:!0,type:this.requestType,dataType:"json",cache:a.api>=2.1029,data:d,headers:this.customHeaders,xhrFields:this.xhrFields,progress:function(t){var n=t.loaded/t.total*100;if(y&&clearTimeout(y),e.progressBar)try{e.progressBar.width(n+"%")}catch(t){}else v&&b.type&&(n*=b.cnt,g<n&&(a.notify({type:b.type,progress:n-g,cnt:0,hideCnt:b.hideCnt}),g=n));if(e.progress)try{e.progress(t)}catch(t){}}},e.options||{}),j=function(e){e.warning&&a.error(e.warning),h?ce(e):a.updateCache(e),a.lazy(function(){e.removed&&e.removed.length&&a.remove(e),e.added&&e.added.length&&a.add(e),e.changed&&e.changed.length&&a.change(e)}).then(function(){return a.lazy(function(){a.trigger(u,e,!1)})}).then(function(){return a.lazy(function(){a.trigger(u+"done")})}).then(function(){e.toasts&&Array.isArray(e.toasts)&&$.each(e.toasts,function(){this.msg&&a.toast(this)}),e.sync&&a.sync()})},D=function(e,t){var n,i,r=a.options.debug;switch(t){case"abort":n=e.quiet?"":["errConnect","errAbort"];break;case"timeout":n=["errConnect","errTimeout"];break;case"parsererror":n=["errResponse","errDataNotJSON"],e.responseText&&(!_||r&&("all"===r||r["backend-error"]))&&n.push(e.responseText);break;default:if(e.responseText)try{(i=JSON.parse(e.responseText))&&i.error&&(n=i.error)}catch(e){}if(!n)if(403==e.status)n=["errConnect","errAccess","HTTP error "+e.status];else if(404==e.status)n=["errConnect","errNotFound","HTTP error "+e.status];else if(e.status>=500)n=["errResponse","errServerError","HTTP error "+e.status];else{if(414==e.status&&"get"===T.type)return T.type="post",a.abortXHR(e),void(l.xhr=e=a.transport.send(T).fail(n).done(F));n=e.quiet?"":["errConnect","HTTP error "+e.status]}}a.trigger(u+"done"),l.reject({error:n},e,t)},F=function(e){if(a.currentReqCmd=u,e.debug&&a.responseDebug(e),a.setCustomHeaderByXhr(n),x)return a.abortXHR(n),e&&e.debug&&a.debug("backend-debug",e),l.resolve(e);if(!e)return l.reject({error:["errResponse","errDataEmpty"]},n,e);if(!$.isPlainObject(e))return l.reject({error:["errResponse","errDataNotJSON"]},n,e);if(e.error)return h&&$.each(a.leafRoots,function(e,t){a.leafRoots[e]=$.grep(t,function(e){return e!==d.target})}),l.reject({error:e.error},n,e);var t=function(){var t,i=function(t){a.leafRoots[d.target]&&e[t]&&$.each(a.leafRoots[d.target],function(n,i){var r;(r=a.file(i))&&e[t].push(r)})},r=function(){a.textMimes={},$.each(a.res("mimes","text"),function(){a.textMimes[this.toLowerCase()]=!0})};if(h?i("files"):"tree"===u&&i("tree"),e=a.normalize(e),!a.validResponse(u,e))return l.reject({error:e.norError||"errResponse"},n,e);h&&(a.api||(a.api=e.api||1,"2.0"==a.api&&void 0!==e.options.uploadMaxSize&&(a.api="2.1"),a.newAPI=a.api>=2,a.oldAPI=!a.newAPI),e.textMimes&&Array.isArray(e.textMimes)&&(a.resources.mimes.text=e.textMimes,r()),!a.textMimes&&r(),e.options&&(H=Object.assign({},q,e.options)),e.netDrivers&&(a.netDrivers=e.netDrivers),e.maxTargets&&(a.maxTargets=e.maxTargets),d.init&&(a.uplMaxSize=a.returnBytes(e.uplMaxSize),a.uplMaxFile=e.uplMaxFile?Math.min(parseInt(e.uplMaxFile),50):20)),"function"==typeof O&&O(e),A&&(t=A.target||"added",e[t]&&e[t].length&&a.one(u+"done",function(){var n=e[t],i=a.findCwdNodes(n),r=function(){var e=a.cwd().hash;return $.map(n,function(t){return t.phash&&e===t.phash?t.hash:null})},o=r(),s=function(e){var t,n,i,s=void 0,l=e.action?e.action.data:void 0;return(l||o.length)&&e.action&&(n=e.action.msg)&&(t=e.action.cmd)&&(!e.action.cwdNot||e.action.cwdNot!==a.cwd().hash)&&(i=e.action.done,l=e.action.data,s=$("<div/>").append($('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop"><span class="ui-button-text">'+a.i18n(n)+"</span></button>").on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"==e.type)}).on("click",function(){a.exec(t,l||o,{_userAction:!0,_currentType:"toast",_currentNode:$(this)}),i&&a.one(t+"done",function(){"function"==typeof i?i():"select"===i&&a.trigger("selectfiles",{files:r()})})}))),delete e.action,e.extNode=s,e};A.toast||(A.toast={}),!A.noselect&&a.trigger("selectfiles",{files:a.searchStatus.state>1?$.map(n,function(e){return e.hash}):o}),i.length?(A.noscroll||(i.first().trigger("scrolltoview",{blink:!1}),a.resources.blink(i,"lookme")),$.isPlainObject(A.toast.incwd)&&a.toast(s(A.toast.incwd))):$.isPlainObject(A.toast.inbuffer)&&a.toast(s(A.toast.inbuffer))})),l.resolve(e),e.debug&&a.debug("backend-debug",e)};a.abortXHR(n),C?a.lazy(t):t()},z=function(e){n&&"pending"===n.state()&&(a.abortXHR(n,{quiet:!0,abort:!0}),(!e||"unload"!==e.type&&"destroy"!==e.type)&&a.autoSync())},M=function(e){if(a.trigger(u+"done"),"autosync"==e.type){if("stop"!=e.data.action)return}else if(!("unload"==e.type||"destroy"==e.type||"openxhrabort"==e.type||e.data.added&&e.data.added.length))return;z(e)},E=function(e){var t=function(){k=!1,l.reject()};if(e&&"cmd"===e)return u;if(h){if(me&&"pending"===me.state()){if(me._target===d.target)return l.reject("openabort");me.xhr?me.xhr.queueAbort():me.reject("openabort")}(me=l)._target=d.target}if(l.always(function(){delete T.headers["X-elFinderReqid"],h&&(me=null)}).fail(function(e,t,n){var i,o;h&&"openabort"===e&&(e="",k=!1),i={cmd:u,err:e,xhr:t,rc:n},0===e&&fe.length&&(fe=$.grep(fe,function(e){return e("cmd")!==u})),a.trigger("requestError",i),i._getEvent&&i._getEvent().isDefaultPrevented()&&(f=!1,k=!1,e&&(e.error="")),z(),h&&(r=a.file(d.target))&&r.volumeid&&a.isRoot(r)&&delete a.volumeExpires[r.volumeid],a.trigger(u+"fail",n),(o="object"==typeof e?e.error:e)&&(f?a.error(o):a.debug("error",a.i18n(o))),k&&a.sync()}),!u)return k=!1,l.reject({error:"errCmdReq"});if(a.maxTargets&&d.targets&&d.targets.length>a.maxTargets)return k=!1,l.reject({error:["errMaxTargets",a.maxTargets]});if(m&&l.done(j),h){for(;i=V.pop();)i.queueAbort();if(_!==d.target)for(;i=Y.pop();)i.queueAbort()}return-1!==$.inArray(u,(a.cmdsToAdd+" autosync").split(" "))&&("autosync"!==u&&(a.autoSync("stop"),l.always(function(){a.autoSync()})),a.trigger("openxhrabort")),delete T.preventFail,a.api>=2.1029&&(S?T.headers["X-elFinderReqid"]=c:Object.assign(T.data,{reqid:c})),l.syncOnFail=function(e){k=!!e},he++,l.xhr=n=a.transport.send(T).always(function(){T._xhr&&void 0!==T._xhr.responseURL&&(n.responseURL=T._xhr.responseURL||""),--he,fe.length&&fe.shift()()}).fail(D).done(F),a.api>=2.1029&&(n._requestId=c),h||d.compare&&"info"===u?(n.queueAbort=t,V.unshift(n),d.compare&&a.bind(a.cmdsToAdd+" autosync openxhrabort",M),l.always(function(){var e=$.inArray(n,V);d.compare&&a.unbind(a.cmdsToAdd+" autosync openxhrabort",M),-1!==e&&V.splice(e,1)})):-1!==$.inArray(u,a.abortCmdsOnOpen)&&(n.queueAbort=t,Y.unshift(n),l.always(function(){var e=$.inArray(n,Y);-1!==e&&Y.splice(e,1)})),a.bind("unload destroy",M),l.always(function(){a.unbind("unload destroy",M)}),l},U=function(){return b.type&&b.cnt&&(w&&(b.cancel=l,e.eachCancel&&(b.id=+new Date)),t=setTimeout(function(){y=setTimeout(I,1e3),a.notify(b),v=!0,l.always(function(){b.cnt=-(parseInt(b.cnt)||0),a.notify(b),v=!1})},a.notifyDelay),l.always(function(){clearTimeout(t)})),he<o?E():(h?fe.unshift(E):fe.push(E),l)},I=function(){var e;v&&y&&(e=1*b.cnt,y=null,a.notify({type:b.type,progress:e,cnt:0,hideCnt:b.hideCnt}),(g+=e)/b.cnt<80&&(y=setTimeout(I,500)))},R={opts:e,result:!0};return a.api||d.init?(a.trigger("request."+u,R,!0),R.result?"object"==typeof R.result&&R.result.promise?(R.result.done(U).fail(function(){a.trigger(u+"done"),l.reject()}),l):U():(a.trigger(u+"done"),l.reject())):(k=!1,l.reject())},this.cache=function(e,t){Array.isArray(e)||(e=[e]),de(e,t)},this.updateCache=function(e){$.isPlainObject(e)&&(e.files&&e.files.length&&de(e.files,"files"),e.tree&&e.tree.length&&de(e.tree,"tree"),e.removed&&e.removed.length&&ue(e.removed),e.added&&e.added.length&&de(e.added,"add"),e.changed&&e.changed.length&&de(e.changed,"change"))},this.diff=function(e,t,n){var i={},r=[],o=[],a=[],s=null;return $.each(e,function(e,t){i[t.hash]=t}),n&&n.length&&(s={},$.each(n,function(){s[this]=!0})),$.each(N,function(e,n){i[e]||t&&n.phash!==t||o.push(e)}),$.each(i,function(e,t){var n,i=N[e],o={};i?($.each(Object.keys(i),function(){o[this]=!0}),$.each(t,function(e){if(delete o[e],!(s&&s[e]||t[e]===i[e]))return a.push(t),o={},!1}),0!==(n=Object.keys(o).length)&&(s&&$.each(o,function(e){s[e]&&--n}),0!==n&&a.push(t))):r.push(t)}),$.each(o,function(e,t){var n=N[t],r=n.phash;r&&"directory"==n.mime&&-1===$.inArray(r,o)&&i[r]&&!function(e){for(var t=a.length;t--;)if(a[t].hash==e)return!0}(r)&&a.push(i[r])}),{added:r,removed:o,changed:a}},this.sync=function(e,t){this.autoSync("stop");var n,i,r,o,a=this,s=(i="",r=0,o=0,e&&t&&$.each(N,function(t,n){n.phash&&n.phash===e&&(++r,o=Math.max(o,n.ts)),i=r+":"+o}),i),l=$.Deferred().always(function(){!n&&a.trigger("sync")}),c=[this.request({data:{cmd:"open",reload:1,target:_,tree:!e&&this.ui.tree?1:0,compare:s},preventDefault:!0})];return!e&&a.api>=2&&(_!==this.root()&&c.push(this.request({data:{cmd:"parents",target:_},preventDefault:!0})),$.each(function(){for(var e,t=[],n=a.file(a.root(_)),i=n?n.volumeid:null,r=a.cwd().phash;r;)(e=a.file(r))?(0!==r.indexOf(i)&&(t.push({target:r,cmd:"tree"}),a.isRoot(e)||t.push({target:r,cmd:"parents"}),i=(n=a.file(a.root(r)))?n.volumeid:null),r=e.phash):r=null;return t}(),function(e,t){c.push(a.request({data:{cmd:t.cmd,target:t.target},preventDefault:!0}))})),$.when.apply($,c).fail(function(e,i){n=i&&200!=i.status,t&&-1===$.inArray("errOpen",e)?l.reject(e&&0!=i.status?e:void 0):(l.reject(e),a.parseError(e)&&a.request({data:{cmd:"open",target:a.lastDir("")||a.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}}))}).done(function(t){var n,i,r;if(t.cwd.compare&&s===t.cwd.compare)return l.reject();if(n={tree:[]},(i=arguments.length)>1)for(r=1;r<i;r++)arguments[r].tree&&arguments[r].tree.length&&n.tree.push.apply(n.tree,arguments[r].tree);if(a.api<2.1&&(n.tree||(n.tree=[]),n.tree.push(t.cwd)),t=a.normalize(t),!a.validResponse("open",t))return l.reject(t.norError||"errResponse");if(n=a.normalize(n),!a.validResponse("tree",n))return l.reject(n.norError||"errResponse");var o=a.diff(t.files.concat(n&&n.tree?n.tree:[]),e);return o.added.push(t.cwd),a.updateCache(o),o.removed.length&&a.remove(o),o.added.length&&a.add(o),o.changed.length&&a.change(o),l.resolve(o)}).always(function(){a.autoSync()}),l},this.upload=function(e){return this.transport.upload(e,this)},this.shortcut=function(e){var t,n,i,r,o;if(this.options.allowShortcuts&&e.pattern&&$.isFunction(e.callback))for(t=e.pattern.toUpperCase().split(/\s+/),r=0;r<t.length;r++)(i=1==(i=(o=(n=t[r]).split("+")).pop()).length?i>0?i:i.charCodeAt(0):i>0?i:$.ui.keyCode[i])&&!J[n]&&(J[n]={keyCode:i,altKey:-1!=$.inArray("ALT",o),ctrlKey:-1!=$.inArray("CTRL",o),shiftKey:-1!=$.inArray("SHIFT",o),type:e.type||"keydown",callback:e.callback,description:e.description,pattern:n});return this},this.shortcuts=function(){var e=[];return $.each(J,function(t,n){e.push([n.pattern,O.i18n(n.description)])}),e},this.clipboard=function(e,t){var n=function(){return $.map(K,function(e){return e.hash})};return void 0!==e&&(K.length&&this.trigger("unlockfiles",{files:n()}),G={},K=$.map(e||[],function(e){var n=N[e];return n?(G[e]=!0,{hash:e,phash:n.phash,name:n.name,mime:n.mime,read:n.read,locked:n.locked,cut:!!t}):null}),this.trigger("changeclipboard",{clipboard:K.slice(0,K.length)}),t&&this.trigger("lockfiles",{files:n()})),K.slice(0,K.length)},this.isCommandEnabled=function(e,t){var n,i,r=O.cwd().volumeid||"";return!t&&O.searchStatus.state>1&&O.selected().length&&(t=O.selected()[0]),n=!t||r&&0===t.indexOf(r)?H.disabledFlip:O.option("disabledFlip",t),!!(i=this._commands[e])&&(i.alwaysEnabled||!n[e])},this.exec=function(e,t,n,i){var r,o;return!i&&this.commandMap[e]&&"hidden"!==this.commandMap[e]&&(e=this.commandMap[e]),"open"===e&&((this.searchStatus.state||this.searchStatus.ininc)&&this.trigger("searchend",{noupdate:!0}),this.autoSync("stop")),!i&&t&&($.isArray(t)?t.length&&(i=t[0]):i=t),"object"===(o=typeof(r=this._commands[e]&&this.isCommandEnabled(e,i)?this._commands[e].exec(t,n):$.Deferred().reject("errUnknownCmd")))&&r.promise||(O.debug("warning",'"cmd.exec()" should be returned "$.Deferred" but cmd "'+e+'" returned "'+o+'"'),r=$.Deferred().resolve()),this.trigger("exec",{dfrd:r,cmd:e,files:t,opts:n,dstHash:i}),r},this.dialog=function(e,t){var n=$("<div/>").append(e).appendTo(T).elfinderdialog(t,O),i=n.closest(".ui-dialog"),r=function(){!n.data("draged")&&n.is(":visible")&&n.elfinderdialog("posInit")};return i.length&&(O.bind("resize",r),i.on("remove",function(){O.unbind("resize",r)})),n},this.toast=function(e){return $('<div class="ui-front"/>').appendTo(this.ui.toast).elfindertoast(e||{},this)},this.getUI=function(e){return e?this.ui[e]||$():T},this.getCommand=function(e){return void 0===e?this._commands:this._commands[e]},this.resize=function(e,t){var n,i=!T.hasClass("ui-resizable"),r=T.data("resizeSize")||{w:0,h:0},o={};te&&te.data("resizeTm")&&clearTimeout(te.data("resizeTm")),"string"==typeof t&&(n=t.match(/^([0-9.]+)%$/))&&(te&&te.length||(te=$(window)),te.data("marginToMyNode")||te.data("marginToMyNode",function(){for(var e=T.outerHeight(!0)-T.innerHeight(),t=T;t.get(0)!==te.get(0)&&(e+=(t=t.parent()).outerHeight(!0)-t.innerHeight(),t.parent().length););return e}()),te.data("fitToBaseFunc")||te.data("fitToBaseFunc",function(e){var t=te.data("resizeTm");e.preventDefault(),e.stopPropagation(),t&&cancelAnimationFrame(t),T.hasClass("elfinder-fullscreen")||O.UA.Mobile&&te.data("rotated")===O.UA.Rotated||(te.data("rotated",O.UA.Rotated),te.data("resizeTm",requestAnimationFrame(function(){O.restoreSize()})))}),void 0===te.data("rotated")&&te.data("rotated",O.UA.Rotated),t=te.height()*(n[1]/100)-te.data("marginToMyNode"),te.off("resize."+O.namespace,te.data("fitToBaseFunc")),i&&te.on("resize."+O.namespace,te.data("fitToBaseFunc"))),T.css({width:e,height:parseInt(t)}),o.w=Math.round(T.width()),o.h=Math.round(T.height()),T.data("resizeSize",o),o.w===r.w&&o.h===r.h||(T.trigger("resize"),this.trigger("resize",{width:o.w,height:o.h}))},this.restoreSize=function(){this.resize(Z,ee)},this.show=function(){T.show(),this.enable().trigger("show")},this.hide=function(){this.options.enableAlways&&(P=R,R=!1),this.disable(),this.trigger("hide"),T.hide()},this.lazy=function(e,t,n){var i=function(e){var t,i=T.data("lazycnt");e?(t=!T.data("lazyrepaint")&&n.repaint,i?T.data("lazycnt",++i):T.data("lazycnt",1).addClass("elfinder-processing"),t&&T.data("lazyrepaint",!0).css("display")):i&&i>1?T.data("lazycnt",--i):(t=T.data("lazyrepaint"),T.data("lazycnt",0).removeData("lazyrepaint").removeClass("elfinder-processing"),t&&T.css("display"),O.trigger("lazydone"))},r=$.Deferred(),o=function(){r.resolve(e.call(r)),i(!1)};return t=t||0,n=n||{},i(!0),t?setTimeout(o,t):requestAnimationFrame(o),r},this.destroy=function(){T&&T[0].elfinder&&(T.hasClass("elfinder-fullscreen")&&O.toggleFullscreen(T),this.options.syncStart=!1,this.autoSync("forcestop"),this.trigger("destroy").disable(),K=[],W=[],X={},J={},$(window).off("."+z),$(document).off("."+z),O.trigger=function(){},$(oe).remove(),T.off().removeData().empty().append(D.contents()).attr("class",D.attr("class")).attr("style",D.attr("style")),delete T[0].elfinder,$.each(j,function(e,t){$.each(t,function(e,t){T.on(t.type+(t.namespace?"."+t.namespace:""),t.selector,t.handler)})}))},this.autoSync=function(e){var t;if(O.options.sync>=1e3){if(r&&(clearTimeout(r),r=null,O.trigger("autosync",{action:"stop"})),"stop"===e?++ae:ae=Math.max(0,--ae),ae||"forcestop"===e||!O.options.syncStart)return;(t=function(e){var n;H.syncMinMs&&(e||r)&&(e&&O.trigger("autosync",{action:"start"}),n=Math.max(O.options.sync,H.syncMinMs),r&&clearTimeout(r),r=setTimeout(function(){var e,i=!0,o=_;H.syncChkAsTs&&N[o]&&(e=N[o].ts)?O.request({data:{cmd:"info",targets:[o],compare:e,reload:1},preventDefault:!0}).done(function(n){var r;i=!0,n.compare&&(r=n.compare)==e&&(i=!1),i?O.sync(o).always(function(){r&&(N[o].ts=r),t()}):t()}).fail(function(e,i){var o=O.parseError(e);o&&0!=i.status?(O.error(o),Array.isArray(o)&&-1!==$.inArray("errOpen",o)&&O.request({data:{cmd:"open",target:O.lastDir("")||O.root(),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0}})):r=setTimeout(function(){t()},n)}):O.sync(_,!0).always(function(){t()})},n))})(!0)}},this.insideWorkzone=function(e,t,n){var i=this.getUI("workzone").data("rectangle");return n=n||1,!(e<i.left+n||e>i.left+i.width+n||t<i.top+n||t>i.top+i.height+n)},this.toFront=function(e){var t=T.children(".ui-front").removeClass("elfinder-frontmost"),n=t.last();t.css("z-index",""),$(e).addClass("ui-front elfinder-frontmost").css("z-index",n.css("z-index")+1)},this.toHide=function(e,t){var n,i=$(e);!t&&i.hide(),i.hasClass("elfinder-frontmost")&&(i.removeClass("elfinder-frontmost"),(n=T.children(".ui-front:visible:not(.elfinder-frontmost)").last()).length&&requestAnimationFrame(function(){T.children(".elfinder-frontmost:visible").length||(O.toFront(n),n.trigger("frontmost"))}))},this.getMaximizeCss=function(){return{width:"100%",height:"100%",margin:0,top:0,left:0,display:"block",position:"fixed",zIndex:Math.max(O.zIndex?O.zIndex+1:0,1e3),maxWidth:"",maxHeight:""}},function(){ve&&O.UA.Fullscreen&&(O.UA.Fullscreen=!1,be&&void 0!==be.attr("allowfullscreen")&&(O.UA.Fullscreen=!0));var e,t,n,i,r="elfinder-fullscreen",o="elfinder-fullscreen-native",a=function(){var e=0,t=0;$.each(T.children(".ui-dialog,.ui-draggable"),function(n,i){var r=$(i),o=r.position();o.top<0&&(r.css("top",e),e+=20),o.left<0&&(r.css("left",t),t+=20)})},s=function(){var n=O.storage("useFullscreen");i=O.UA.Fullscreen&&(n?n>0:"screen"===O.options.commandsOptions.fullscreen.mode)?{fullElm:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null},exitFull:function(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():void 0},toFull:function(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():!!e.msRequestFullscreen&&e.msRequestFullscreen()}}:{fullElm:function(){var e;return T.hasClass(r)?T.get(0):(e=T.find("."+r)).length?e.get(0):null},exitFull:function(){var n;$(window).off("resize."+z,c),void 0!==t&&$("body").css("overflow",t),t=void 0,e&&(n=e.elm,l(n),$(n).trigger("resize",{fullscreen:"off"})),$(window).trigger("resize")},toFull:function(e){return t=$("body").css("overflow")||"",$("body").css("overflow","hidden"),$(e).css(O.getMaximizeCss()).addClass(r).trigger("resize",{fullscreen:"on"}),a(),$(window).on("resize."+z,c).trigger("resize"),!0}}},l=function(t){e&&e.elm==t&&($(t).removeClass(r+" "+o).attr("style",e.style),e=null)},c=function(e){var t;e.target===window&&(n&&cancelAnimationFrame(n),n=requestAnimationFrame(function(){(t=i.fullElm())&&$(t).trigger("resize",{fullscreen:"on"})}))};s(),$(document).on("fullscreenchange."+z+" webkitfullscreenchange."+z+" mozfullscreenchange."+z+" MSFullscreenChange."+z,function(t){if(O.UA.Fullscreen){var s=i.fullElm(),d=$(window);n&&cancelAnimationFrame(n),null===s?(d.off("resize."+z,c),e&&(s=e.elm,l(s),$(s).trigger("resize",{fullscreen:"off"}))):($(s).addClass(r+" "+o).attr("style","width:100%; height:100%; margin:0; padding:0;").trigger("resize",{fullscreen:"on"}),d.on("resize."+z,c),a()),d.trigger("resize")}}),O.toggleFullscreen=function(t,n){var r,o=$(t).get(0);if(r=i.fullElm()){if(r==o){if(!0===n)return r}else if(!1===n)return r;return i.exitFull(),null}return!1===n?null:(s(),e={elm:o,style:$(o).attr("style")},!1!==i.toFull(o)?o:(e=null,null))}}(),k="elfinder-maximized",C=function(e){if(e.target===window&&e.data&&e.data.elm){var t=e.data.elm;x&&cancelAnimationFrame(x),x=requestAnimationFrame(function(){t.trigger("resize",{maximize:"on"})})}},O.toggleMaximize=function(e,t){var n=$(e);if(n.hasClass(k)){if(!0===t)return;!function(e){$(window).off("resize."+z,C),$("body").css("overflow",e.data("bodyOvf")),e.removeClass(k).attr("style",e.data("orgStyle")).removeData("bodyOvf").removeData("orgStyle"),e.trigger("resize",{maximize:"off"})}(n)}else{if(!1===t)return;!function(e){e.data("bodyOvf",$("body").css("overflow")||"").data("orgStyle",e.attr("style")).addClass(k).css(O.getMaximizeCss()),$("body").css("overflow","hidden"),$(window).on("resize."+z,{elm:e},C),e.trigger("resize",{maximize:"on"})}(n)}},Object.assign($.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DIG0:48,DIG1:49,DIG2:50,DIG3:51,DIG4:52,DIG5:53,DIG6:54,DIG7:55,DIG8:56,DIG9:57,NUM0:96,NUM1:97,NUM2:98,NUM3:99,NUM4:100,NUM5:101,NUM6:102,NUM7:103,NUM8:104,NUM9:105,CONTEXTMENU:93,DOT:190}),this.dragUpload=!1,this.xhrUpload=("undefined"!=typeof XMLHttpRequestUpload||"undefined"!=typeof XMLHttpRequestEventTarget)&&"undefined"!=typeof File&&"undefined"!=typeof FormData,this.transport={},"object"==typeof this.options.transport&&(this.transport=this.options.transport,"function"==typeof this.transport.init&&this.transport.init(this)),"function"!=typeof this.transport.send&&(this.transport.send=function(e){return O.UA.IE||(e._xhr=new XMLHttpRequest,e.xhr=function(){return e.progress&&e._xhr.addEventListener("progress",e.progress),e._xhr}),$.ajax(e)}),"iframe"==this.transport.upload?this.transport.upload=$.proxy(this.uploads.iframe,this):"function"==typeof this.transport.upload?this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload&&this.options.dragUploadAllow?(this.transport.upload=$.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=$.proxy(this.uploads.iframe,this),this.decodeRawString=function(e){return function(e){var t,n,i,r,o=String.fromCharCode;for(t=0,n=e.length,r="";i=e[t],t<n;t++)r+=i<=127?o(i):i<=223&&i>=194?o((31&i)<<6|63&e[++t]):i<=239&&i>=224?o((15&i)<<12|(63&e[++t])<<6|63&e[++t]):i<=247&&i>=240?o(55296|((7&i)<<8|(63&e[++t])<<2|e[++t]>>>4&3)-64,56320|(15&e[t++])<<6|63&e[t]):o(65533);return r}(function(e){var t,n,i,r=[];for("string"==typeof e&&(e=function(e){var t,n,i;for(t=0,n=e.length,i=[];t<n;t++)i.push(e.charCodeAt(t));return i}(e)),t=0,n=e.length;i=e[t],t<n;t++)i>=55296&&i<=56319?r.push(64+(1023&i)<<10|1023&e[++t]):r.push(i);return r}(e))},this.getContents=function(e,t,n){var i,r,o=$.Deferred(),a=t||"arraybuffer";return o.fail(function(){r&&"pending"===r.state()&&r.reject()}),i=this.openUrl(e),this.isSameOrigin(i)||(i=this.openUrl(e,!0)),r=this.request(Object.assign({data:{cmd:"get"},options:{url:i,type:"get",cache:!0,dataType:"binary",responseType:a,processData:!1},notify:{type:"file",cnt:1,hideCnt:!0},cancel:!0},n||{})).fail(function(){o.reject()}).done(function(e){o.resolve(e)}),o},this.getBinaryByUrl=function(e,t,n){var i,r=$.Deferred();return r.fail(function(){i&&"pending"===i.state()&&i.reject()}),i=this.request(Object.assign({data:{cmd:"get"},options:Object.assign({type:"get",cache:!0,dataType:"binary",responseType:"blob",processData:!1},e)},n||{})).fail(function(){r.reject()}).done(function(e){t&&t(e),r.resolve(e)}),r},this.getMimetype=function(e,t){var n,r,o=t;return(r=(e+"").match(/\.([^.]+)$/))&&(n=r[1])&&(i||(i=O.arrayFlip(O.mimeTypes)),(o=i[n.toLowerCase()])||(o=t)),o},O.hashCheckers=[],function(e){var t={};window.Worker&&window.ArrayBuffer&&(e.options.cdns.sparkmd5&&(t.SparkMD5=!0,e.hashCheckers.push("md5")),e.options.cdns.jssha&&(t.jsSHA=!0,e.hashCheckers=e.hashCheckers.concat(["sha1","sha224","sha256","sha384","sha512","sha3-224","sha3-256","sha3-384","sha3-512","shake128","shake256"]))),e.getContentsHashes=function(n,i,r,o){var a,s=$.Deferred(),l=e.arrayFlip(i||["md5"],!0),c=[],d={},u=r||{shake128len:256,shake256len:512};return s.fail(function(){a&&a.reject()}),Object.keys(t).length?a=e.getContents(n,"arraybuffer",o).done(function(i){l.md5&&t.SparkMD5&&c.push(function(){var r=$.Deferred();try{var o=e.getWorker();r.fail(function(){o&&o.terminate()}),o.onmessage=function(t){var i;(o&&o.terminate(),t.data.hash)?(d.md5=t.data.hash,(i=e.file(n))&&(i.md5=d.md5)):t.data.error&&(d.md5=t.data.error);s.notify(d),r.resolve()},o.onerror=function(e){r.reject()},o.postMessage({scripts:[e.options.cdns.sparkmd5,e.getWorkerUrl("calcfilehash.js")],data:{type:"md5",bin:i}}),s.fail(function(){r.reject()})}catch(e){r.reject(),delete t.SparkMD5}return r}()),t.jsSHA&&$.each(["1","224","256","384","512","3-224","3-256","3-384","3-512","ke128","ke256"],function(r,o){l["sha"+o]&&c.push(function(){var r=$.Deferred();try{var a=e.getWorker();r.fail(function(){a&&a.terminate()}),a.onmessage=function(t){var i;(a&&a.terminate(),t.data.hash)?(d["sha"+o]=t.data.hash,(i=e.file(n))&&(i["sha"+o]=d["sha"+o])):t.data.error&&(d["sha"+o]=t.data.error);s.notify(d),r.resolve()},a.onerror=function(e){r.reject()},a.postMessage({scripts:[e.options.cdns.jssha,e.getWorkerUrl("calcfilehash.js")],data:{type:o,bin:i,hashOpts:u}}),s.fail(function(){r.reject()})}catch(e){r.reject(),delete t.jsSHA}return r}())}),c.length?$.when.apply(null,c).always(function(){s.resolve(d)}):s.reject()}).fail(function(){s.reject()}):s.reject(),s}}(this),this.parseError=function(e){var t=e;return $.isPlainObject(t)&&(t=t.error),t},this.error=function(){var e,t=arguments[0],n=arguments[1]||null;return 1==arguments.length&&"function"==typeof t?O.bind("error",t):!0!==(e=this.parseError(t))&&e?O.trigger("error",{error:e,opts:n}):this},$.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","selectfiles","unselectfiles","dragstart","dragstop","search","searchend","viewchange"],function(e,t){O[t]=function(){var e=arguments[0];return 1==arguments.length&&"function"==typeof e?O.bind(t,e):O.trigger(t,$.isPlainObject(e)?e:{})}}),this.enable(function(){!R&&O.api&&O.visible()&&O.ui.overlay.is(":hidden")&&!T.children(".elfinder-dialog."+O.res("class","editing")+":visible").length&&(R=!0,document.activeElement&&document.activeElement.blur(),T.removeClass("elfinder-disabled"))}).disable(function(){P=R,R=!1,T.addClass("elfinder-disabled")}).open(function(){W=[]}).select(function(e){var t=0,n=[];W=$.grep(e.data.selected||e.data.value||[],function(e){return n.length||O.maxTargets&&++t>O.maxTargets?(n.push(e),!1):!!N[e]}),n.length&&(O.trigger("unselectfiles",{files:n,inselect:!0}),O.toast({mode:"warning",msg:O.i18n(["errMaxTargets",O.maxTargets])}))}).error(function(e){var t,n,i={cssClass:"elfinder-dialog-error",title:O.i18n("error"),resizable:!1,destroyOnClose:!0,buttons:{}},r=O.getUI();r.children(".elfinder-dialog-error").length<O.options.maxErrorDialogs?(i.buttons[O.i18n(O.i18n("btnClose"))]=function(){$(this).elfinderdialog("close")},e.data.opts&&$.isPlainObject(e.data.opts)&&Object.assign(i,e.data.opts),O.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+O.i18n(e.data.error),i)):(n=(t=r.children(".elfinder-dialog-error:last").children(".ui-dialog-content:first")).children(".elfinder-error-counter")).length?n.data("cnt",parseInt(n.data("cnt"))+1).html(O.i18n(["moreErrors",n.data("cnt")])):(n=$('<span class="elfinder-error-counter">'+O.i18n(["moreErrors",1])+"</span>").data("cnt",1),t.append("<br/>",n))}).bind("tmb",function(e){$.each(e.data.images||[],function(e,t){N[e]&&(N[e].tmb=t)})}).bind("searchstart",function(e){Object.assign(O.searchStatus,e.data),O.searchStatus.state=1}).bind("search",function(e){O.searchStatus.state=2}).bind("searchend",function(){O.searchStatus.state=0,O.searchStatus.ininc=!1,O.searchStatus.mixed=!1}).bind("canMakeEmptyFile",function(e){var t=e.data,n={};t&&Array.isArray(t.mimes)&&(t.unshift||(n=O.mimesCanMakeEmpty),$.each(t.mimes,function(){n[this]||(n[this]=O.mimeTypes[this])}),t.unshift&&(O.mimesCanMakeEmpty=Object.assign(n,O.mimesCanMakeEmpty)))}).bind("themechange",function(){requestAnimationFrame(function(){O.trigger("uiresize")})}),!0===this.options.sound&&this.bind("playsound",function(e){var t=oe.canPlayType&&oe.canPlayType('audio/wav; codecs="1"'),n=e.data&&e.data.soundFile;t&&n&&""!=t&&"no"!=t&&$(oe).html('<source src="'+ne+n+'" type="audio/wav">')[0].play()}),$.each(this.options.handlers,function(e,t){O.bind(e,t)}),this.history=new this.history(this),this.roots={},this.leafRoots={},this.volumeExpires={},this._commands={},Array.isArray(this.options.commands)||(this.options.commands=[]),-1!==$.inArray("*",this.options.commands)&&(this.options.commands=Object.keys(this.commands)),this.commandMap={},this.volOptions={},this.hasVolOptions=!1,this.trashes={},this.optionsByHashes={},this.uiAutoHide=[],this.one("open",function(){O.uiAutoHide.length&&setTimeout(function(){O.trigger("uiautohide")},500)}),this.bind("uiautohide",function(){O.uiAutoHide.length&&O.uiAutoHide.shift()()}),this.options.width&&(Z=this.options.width),this.options.height&&(ee=this.options.height),this.options.heightBase&&(te=$(this.options.heightBase)),ne=this.options.soundPath?this.options.soundPath.replace(/\/+$/,"")+"/":this.baseUrl+ne,this.options.parrotHeaders&&Array.isArray(this.options.parrotHeaders)&&this.options.parrotHeaders.length?(this.parrotHeaders=this.options.parrotHeaders,$.each(this.parrotHeaders,function(e,t){var n=O.sessionStorage("core-ph:"+t);n&&(O.customHeaders[t]=n)})):this.parrotHeaders=[],O.one("opendone",function(){var e;$(document).on("click."+z,function(e){R&&!O.options.enableAlways&&!$(e.target).closest(T).length&&O.disable()}).on(E+" "+U+" "+I+" "+M,ge),O.options.useBrowserHistory&&$(window).on("popstate."+z,function(e){var t,n,i=e.originalEvent.state||{},r=!!i.thash,o=T.find(".elfinder-frontmost:visible"),a=T.find(".elfinder-navbar-dir,.elfinder-cwd-filename").find("input,textarea");r||(i={thash:O.cwd().hash},$("html,body").animate({scrollTop:T.offset().top})),o.length||a.length?(history.pushState(i,null,location.pathname+location.search+"#elf_"+i.thash),o.length?o.hasClass(O.res("class","preventback"))||(o.hasClass("elfinder-contextmenu")?$(document).trigger($.Event("keydown",{keyCode:$.ui.keyCode.ESCAPE,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1})):o.hasClass("elfinder-dialog")?o.elfinderdialog("close"):o.trigger("close")):a.trigger($.Event("keydown",{keyCode:$.ui.keyCode.ESCAPE,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))):r?!$.isEmptyObject(O.files())&&O.request({data:{cmd:"open",target:i.thash,onhistory:1},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0}):(t=function(){n.trigger("click")},O.one("open",t,!0),n=O.toast({msg:O.i18n("pressAgainToExit"),onHidden:function(){O.unbind("open",t),history.pushState(i,null,location.pathname+location.search+"#elf_"+i.thash)}}))}),$(window).on("resize."+z,function(t){t.target===this&&(e&&cancelAnimationFrame(e),e=requestAnimationFrame(function(){var e=T.data("resizeSize")||{w:0,h:0},t={w:Math.round(T.width()),h:Math.round(T.height())};T.data("resizeSize",t),t.w===e.w&&t.h===e.h||(T.trigger("resize"),O.trigger("resize",{width:t.w,height:t.h}))}))}).on("beforeunload."+z,function(e){var t,n;if(!O.pauseUnloadCheck()){if(T.is(":visible")&&(O.ui.notify.children().length&&-1!==$.inArray("hasNotifyDialog",O.options.windowCloseConfirm)?t=O.i18n("ntfsmth"):T.find("."+O.res("class","editing")).length&&-1!==$.inArray("editingFile",O.options.windowCloseConfirm)?t=O.i18n("editingFile"):(n=Object.keys(O.selected()).length)&&-1!==$.inArray("hasSelectedItem",O.options.windowCloseConfirm)?t=O.i18n("hasSelected",""+n):(n=Object.keys(O.clipboard()).length)&&-1!==$.inArray("hasClipboardData",O.options.windowCloseConfirm)&&(t=O.i18n("hasClipboard",""+n)),t))return e.returnValue=t,t;O.trigger("unload")}}),$(window).on("message."+z,function(e){var t,n,i=e.originalEvent||null;if(i&&(0===O.convAbsUrl(O.options.url).indexOf(i.origin)||0===O.convAbsUrl(O.uploadURL).indexOf(i.origin)))try{(n=(t=JSON.parse(i.data)).data||null)&&(n.error?(t.bind&&O.trigger(t.bind+"fail",n),O.error(n.error)):(n.warning&&O.error(n.warning),O.updateCache(n),n.removed&&n.removed.length&&O.remove(n),n.added&&n.added.length&&O.add(n),n.changed&&n.changed.length&&O.change(n),t.bind&&(O.trigger(t.bind,n),O.trigger(t.bind+"done")),n.sync&&O.sync()))}catch(e){O.sync()}}),O.options.enableAlways?($(window).on("focus."+z,function(e){e.target===this&&O.enable()}),ve&&$(window.top).on("focus."+z,function(){!O.enable()||be&&!be.is(":visible")||requestAnimationFrame(function(){$(window).trigger("focus")})})):ve&&$(window).on("blur."+z,function(e){R&&e.target===this&&O.disable()}),ve&&T.on("click",function(e){$(window).trigger("focus")}),O.options.enableByMouseOver&&T.on("mouseenter touchstart",function(e){ve&&$(window).trigger("focus"),!O.enabled()&&O.enable()}),$(window).on("visibilitychange."+z,function(e){var t=document.hidden||document.webkitHidden||document.msHidden;O.options.syncStart&&O.autoSync(t?"stop":void 0)})}),T[0].elfinder=this,A.push(function(){var e=O.lang,t=O.i18nBaseUrl+"elfinder."+e+".js",n=$.Deferred();n.done(function(){O.i18[e]&&(O.lang=e),O.trigger("i18load"),s="en"===O.lang?O.i18.en:$.extend(!0,{},O.i18.en,O.i18[O.lang])});return O.i18[e]?n.resolve():(O.lang="en",O.hasRequire?require([t],function(){n.resolve()},function(){n.resolve()}):O.loadScript([t],function(){n.resolve()},{loadType:"tag",error:function(){n.resolve()}})),n}()),l=function(){var e,t,n,i,r,o,a,l,c;return O.messages=s.messages,$.fn.selectable&&$.fn.draggable&&$.fn.droppable&&$.fn.resizable&&$.fn.button&&$.fn.slider?T.length?O.options.url?(e=Object.assign({name:O.i18n("name"),perm:O.i18n("perms"),date:O.i18n("modify"),size:O.i18n("size"),kind:O.i18n("kind"),modestr:O.i18n("mode"),modeoct:O.i18n("mode"),modeboth:O.i18n("mode")},O.options.uiOptions.cwd.listView.columnsCustomName),O.getColumnName=function(t){return e[t]||O.i18n(t)},O.direction=s.direction,O.dateFormat=O.options.dateFormat||s.dateFormat,O.fancyFormat=O.options.fancyDateFormat||s.fancyDateFormat,O.nonameDateFormat=(O.options.nonameDateFormat||s.nonameDateFormat).replace(/[\/\\]/g,"_"),O.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==O.direction?"rtl":"ltr")+(O.UA.Touch?" elfinder-touch"+(O.options.resizable?" touch-punch":""):"")+(O.UA.Mobile?" elfinder-mobile":"")+(O.UA.iOS?" elfinder-ios":"")+" "+O.options.cssClass,T.addClass(O.cssClass).on(M,function(){!R&&O.enable()}),a=E+"draggable keyup."+z+"draggable",O.draggable={appendTo:T,addClasses:!1,distance:4,revert:!0,refreshPositions:!1,cursor:"crosshair",cursorAt:{left:50,top:47},scroll:!1,start:function(e,a){var s,l,c=a.helper,d=$.grep(c.data("files")||[],function(e){return!!e&&(G[e]=!0,!0)}),u=!1;for(o=T.attr("style"),T.width(T.width()).height(T.height()),t="ltr"===O.direction,n=O.getUI("workzone").data("rectangle"),i=n.top+n.height,r=i-O.getUI("navdock").outerHeight(!0),O.draggingUiHelper=c,s=d.length;s--;)if(l=d[s],N[l].locked){u=!0,c.data("locked",!0);break}!u&&O.trigger("lockfiles",{files:d}),c.data("autoScrTm",setInterval(function(){c.data("autoScr")&&O.autoScroll[c.data("autoScr")](c.data("autoScrVal"))},50))},drag:function(e,o){var a,s,l,c=o.helper;((s=n.top>e.pageY)||r<e.pageY)&&(a=n.cwdEdge>e.pageX?(t?"navbar":"cwd")+(s?"Up":"Down"):(t?"cwd":"navbar")+(s?"Up":"Down"),s||("cwd"===a.substr(0,3)?i<e.pageY?l=i:a=null:l=r),a&&(c.data("autoScr",a),c.data("autoScrVal",Math.pow(s?n.top-e.pageY:e.pageY-l,1.3)))),a||c.data("autoScr")&&c.data("refreshPositions",1).data("autoScr",null),c.data("refreshPositions")&&$(this).elfUiWidgetInstance("draggable")&&(c.data("refreshPositions")>0?($(this).draggable("option",{refreshPositions:!0,elfRefresh:!0}),c.data("refreshPositions",-1)):($(this).draggable("option",{refreshPositions:!1,elfRefresh:!1}),c.data("refreshPositions",null)))},stop:function(e,t){var n,i=t.helper;$(document).off(a),$(this).elfUiWidgetInstance("draggable")&&$(this).draggable("option",{refreshPositions:!1}),O.draggingUiHelper=null,O.trigger("focus").trigger("dragstop"),i.data("droped")||(n=$.grep(i.data("files")||[],function(e){return!!e}),O.trigger("unlockfiles",{files:n}),O.trigger("selectfiles",{files:O.selected()})),O.enable(),T.attr("style",o),i.data("autoScrTm")&&clearInterval(i.data("autoScrTm"))},helper:function(e,t){var n,i,r,o=this.id?$(this):$(this).parents("[id]:first"),s=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-status"/></div>'),l=function(e){var t,n=e.mime,i=O.tmb(e);return t='<div class="elfinder-cwd-icon elfinder-cwd-icon-drag '+O.mime2class(n)+' ui-corner-all"/>',i?t=$(t).addClass(i.className).css("background-image","url('"+i.url+"')").get(0).outerHTML:e.icon&&(t=$(t).css(O.getIconStyle(e,!0)).get(0).outerHTML),e.csscls&&(t='<div class="'+e.csscls+'">'+t+"</div>"),t};return O.draggingUiHelper&&O.draggingUiHelper.stop(!0,!0),O.trigger("dragstart",{target:o[0],originalEvent:e},!0),n=o.hasClass(O.res("class","cwdfile"))?O.selected():[O.navId2Hash(o.attr("id"))],s.append(l(N[n[0]])).data("files",n).data("locked",!1).data("droped",!1).data("namespace",z).data("dropover",0),(i=n.length)>1&&s.append(l(N[n[i-1]])+'<span class="elfinder-drag-num">'+i+"</span>"),$(document).on(a,function(e){var t=e.shiftKey||e.ctrlKey||e.metaKey;r!==t&&(r=t,s.is(":visible")&&s.data("dropover")&&!s.data("droped")&&(s.toggleClass("elfinder-drag-helper-plus",!!s.data("locked")||r),O.trigger(r?"unlockfiles":"lockfiles",{files:n,helper:s})))}),s}},O.commands.getfile&&("function"==typeof O.options.getFileCallback?(O.bind("dblclick",function(e){e.preventDefault(),O.exec("getfile").fail(function(){O.exec("open",e.data&&e.data.file?[e.data.file]:void 0)})}),O.shortcut({pattern:"enter",description:O.i18n("cmdgetfile"),callback:function(){O.exec("getfile").fail(function(){O.exec("mac"==O.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:O.i18n("mac"==O.OS?"cmdrename":"cmdopen"),callback:function(){O.exec("mac"==O.OS?"rename":"open")}})):O.options.getFileCallback=null),$.each(O.commands,function(e,t){var n,i,r=Object.assign({},t.prototype);if($.isFunction(t)&&!O._commands[e]&&(t.prototype.forceLoad||-1!==$.inArray(e,O.options.commands))){if(n=t.prototype.extendsCmd||""){if(!$.isFunction(O.commands[n]))return!0;t.prototype=Object.assign({},Q,new O.commands[n],t.prototype)}else t.prototype=Object.assign({},Q,t.prototype);O._commands[e]=new t,t.prototype=r,i=O.options.commandsOptions[e]||{},n&&O.options.commandsOptions[n]&&(i=$.extend(!0,{},O.options.commandsOptions[n],i)),O._commands[e].setup(e,i),O._commands[e].linkedCmds.length&&$.each(O._commands[e].linkedCmds,function(e,t){var n=O.commands[t];$.isFunction(n)&&!O._commands[t]&&(n.prototype=Q,O._commands[t]=new n,O._commands[t].setup(t,O.options.commandsOptions[t]||{}))})}}),O.ui={workzone:$("<div/>").appendTo(T).elfinderworkzone(O),navbar:$("<div/>").appendTo(T).elfindernavbar(O,O.options.uiOptions.navbar||{}),navdock:$("<div/>").appendTo(T).elfindernavdock(O,O.options.uiOptions.navdock||{}),contextmenu:$("<div/>").appendTo(T).elfindercontextmenu(O),overlay:$("<div/>").appendTo(T).elfinderoverlay({show:function(){O.disable()},hide:function(){P&&O.enable()}}),cwd:$("<div/>").appendTo(T).elfindercwd(O,O.options.uiOptions.cwd||{}),notify:O.dialog("",{cssClass:"elfinder-dialog-notify"+(O.options.notifyDialog.canClose?"":" elfinder-titlebar-button-hide"),position:O.options.notifyDialog.position,absolute:!0,resizable:!1,autoOpen:!1,allowMinimize:!0,closeOnEscape:!!O.options.notifyDialog.canClose,title:"&nbsp;",width:O.options.notifyDialog.width?parseInt(O.options.notifyDialog.width):null,minHeight:null,minimize:function(){O.ui.notify.trigger("minimize")}}),statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(T),toast:$('<div class="elfinder-toast"/>').appendTo(T),bottomtray:$('<div class="elfinder-bottomtray">').appendTo(T),progressbar:$('<div class="elfinder-ui-progressbar">').appendTo(T)},O.trigger("uiready"),$.each(O.options.ui||[],function(e,t){var n="elfinder"+t,i=O.options.uiOptions[t]||{};!O.ui[t]&&$.fn[n]&&(O.ui[t]=$("<"+(i.tag||"div")+"/>").appendTo(T),O.ui[t][n](O,i))}),O.ui.progressbar.appendTo(O.ui.workzone),O.ui.notify.prev(".ui-dialog-titlebar").append('<div class="elfinder-ui-progressbar"></div>'),O.resize(Z,ee),O.options.resizable&&(T.resizable({resize:function(e,t){O.resize(t.size.width,t.size.height)},handles:"se",minWidth:300,minHeight:200}),O.UA.Touch&&T.addClass("touch-punch")),l=O.getUI("navbar"),c=O.getUI("cwd").parent(),O.autoScroll={navbarUp:function(e){l.scrollTop(Math.max(0,l.scrollTop()-e))},navbarDown:function(e){l.scrollTop(l.scrollTop()+e)},cwdUp:function(e){c.scrollTop(Math.max(0,c.scrollTop()-e))},cwdDown:function(e){c.scrollTop(c.scrollTop()+e)}},O.UA.Touch&&function(){var e,t,n,i,r,o,a,s,l=O.getUI("navbar"),c=O.getUI("toolbar"),d="touchmove.stopscroll",u=function(e){var n=(e.originalEvent.touches||[{}])[0].pageY||null;(!t||n<t)&&(e.preventDefault(),a&&clearTimeout(a))},p=function(e){e.preventDefault(),a&&clearTimeout(a)};l=l.children().length?l:null,c=c.length?c:null,T.on("touchstart touchmove touchend",function(h){if("touchend"===h.type)return e=!1,t=!1,void(a=setTimeout(function(){T.off(d)},100));var f,m,g,y,v=h.originalEvent.touches||[{}],b=v[0].pageX||null,w=v[0].pageY||null,$="ltr"===O.direction;null===b||null===w||"touchstart"===h.type&&v.length>1||("touchstart"===h.type?(n=T.offset(),i=T.width(),l&&(e=!1,l.is(":hidden")?(s||(s=Math.max(50,i/10)),($?b-n.left:i+n.left-b)<s&&(e=b)):h.originalEvent._preventSwipeX||(r=l.width(),($?b<n.left+r:b>n.left+i-r)?(s=Math.max(50,i/10),e=b):e=!1)),c&&(t=!1,h.originalEvent._preventSwipeY||(o=c.height(),w-n.top<(c.is(":hidden")?50:o+30)&&(t=w,T.on(d,c.is(":hidden")?p:u))))):(l&&!1!==e&&(f=($?e>b:e<b)?"navhide":"navshow",m=Math.abs(e-b),("navhide"===f&&m>.6*r||m>("navhide"===f?r/3:45)&&("navshow"===f||($?b<n.left+20:b>n.left+i-20)))&&(O.getUI("navbar").trigger(f,{handleW:s}),e=!1)),c&&!1!==t&&(g=c.offset().top,Math.abs(t-w)>Math.min(45,o/3)&&("slideDown"===(y=t>w?"slideUp":"slideDown")||g+20>w)&&(c.is("slideDown"===y?":hidden":":visible")&&c.stop(!0,!0).trigger("toggle",{duration:100,handleH:50}),t=!1))))})}(),O.dragUpload&&function(){var e,t,n=function(e){return"TEXTAREA"!==e.target.nodeName&&"INPUT"!==e.target.nodeName&&0===$(e.target).closest("div.ui-dialog-content").length},i="native-drag-enter",r="native-drag-disable",o="class",a=O.res(o,"navdir"),s=(O.res(o,"droppable"),O.res(o,"adroppable"),O.res(o,"navarrow"),O.res(o,"adroppable")),l=O.getUI("workzone"),c="ltr"===O.direction,d=function(){t&&cancelAnimationFrame(t),t=null};T.on("dragenter",function(t){d(),n(t)&&(t.preventDefault(),t.stopPropagation(),e=l.data("rectangle"))}).on("dragleave",function(e){d(),n(e)&&(e.preventDefault(),e.stopPropagation())}).on("dragover",function(i){var r;n(i)?(i.preventDefault(),i.stopPropagation(),i.originalEvent.dataTransfer.dropEffect="none",t||(t=requestAnimationFrame(function(){var n,o=e.top+e.height,a=o-O.getUI("navdock").outerHeight(!0);((r=i.pageY<e.top)||i.pageY>a)&&(n=e.cwdEdge>i.pageX?(c?"navbar":"cwd")+(r?"Up":"Down"):(c?"cwd":"navbar")+(r?"Up":"Down"),r||"cwd"===n.substr(0,3)&&(o<i.pageY?a=o:n=""),n&&O.autoScroll[n](Math.pow(r?e.top-i.pageY:i.pageY-a,1.3))),t=null}))):d()}).on("drop",function(e){d(),n(e)&&(e.stopPropagation(),e.preventDefault())}),T.on("dragenter",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t,n=$(e.currentTarget),o=null;if(!(e.currentTarget.id||null)){o=O.cwd(),n.data(r,!1);try{$.each(e.originalEvent.dataTransfer.types,function(e,n){"elfinderfrom:"===n.substr(0,13)&&(t=n.substr(13).toLowerCase())})}catch(e){}}o&&(!o.write||t&&t===(window.location.href+o.hash).toLowerCase())?n.data(r,!0):(e.preventDefault(),e.stopPropagation(),n.data(i,!0),n.addClass(s))}}).on("dragleave",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t=$(e.currentTarget);e.preventDefault(),e.stopPropagation(),t.data(i)?t.data(i,!1):t.removeClass(s)}}).on("dragover",".native-droppable",function(e){if(e.originalEvent.dataTransfer){var t=$(e.currentTarget);e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect=t.data(r)?"none":"copy",t.data(i,!1)}}).on("drop",".native-droppable",function(e){if(e.originalEvent&&e.originalEvent.dataTransfer){var t,n=$(e.currentTarget);e.preventDefault(),e.stopPropagation(),n.removeClass(s),t=e.currentTarget.id?n.hasClass(a)?O.navId2Hash(e.currentTarget.id):O.cwdId2Hash(e.currentTarget.id):O.cwd().hash,e.originalEvent._target=t,O.exec("upload",{dropEvt:e.originalEvent,target:t},void 0,t)}})}(),!1===O.cssloaded&&(O.cssloaded=!0,O.trigger("cssloaded")),O.zIndexCalc(),void O.trigger("init").request({data:{cmd:"open",target:O.startDir(),init:1,tree:1},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){O.trigger("fail").disable().lastDir(""),X={},J={},$(document).add(T).off("."+z),O.trigger=function(){}}).done(function(e){var t=function(e){var t=O.file(O.trashes[e]);O.options.debug;t&&t.volumeid&&delete O.volOptions[t.volumeid].trashHash,O.trashes[e]=!1,O.debug("backend-error",'Trash hash "'+e+'" was not found or not writable.')},n={};O.options.rawStringDecoder&&O.registRawStringDecoder(O.options.rawStringDecoder),O.zIndexCalc(),O.load().debug("api",O.api),T.trigger("resize"),ce(e),O.trigger("open",e,!1),O.trigger("opendone"),ve&&O.options.enableAlways&&$(window).trigger("focus"),$.each(O.trashes,function(e){var i=O.file(e);i?"directory"===i.mime&&i.write||t(e):n[e]=!0}),Object.keys(n).length&&O.request({data:{cmd:"info",targets:Object.keys(n)},preventDefault:!0}).done(function(e){e&&e.files&&$.each(e.files,function(e,t){"directory"===t.mime&&t.write&&delete n[t.hash]})}).always(function(){$.each(n,t)}),O[O.options.enableAlways?"enable":"disable"]()})):alert(O.i18n("errURL")):alert(O.i18n("errNode")):alert(O.i18n("errJqui"))},n&&"function"==typeof n&&(O.bootCallback=n,n.call(T.get(0),O,{dfrdsBeforeBootup:A})),$.when.apply(null,A).done(function(){l()}).fail(function(e){O.error(e)})};return("undefined"==typeof toGlobal||toGlobal)&&(window.elFinder=u),u.prototype={uniqueid:0,res:function(e,t){return this.resources[e]&&this.resources[e][t]},OS:-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other",UA:(o=!document.unqueID&&!window.opera&&!window.sidebar&&"localStorage"in window&&"WebkitAppearance"in document.documentElement.style,a=o&&window.chrome,{ltIE6:void 0===window.addEventListener&&void 0===document.documentElement.style.maxHeight,ltIE7:void 0===window.addEventListener&&void 0===document.querySelectorAll,ltIE8:void 0===window.addEventListener&&void 0===document.getElementsByClassName,ltIE9:document.uniqueID&&document.documentMode<=9,ltIE10:document.uniqueID&&document.documentMode<=10,gtIE11:document.uniqueID&&document.documentMode>=11,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:o,Chrome:a,Edge:!(!a||!window.msCredentials),Safari:o&&!window.chrome,Mobile:void 0!==window.orientation,Touch:void 0!==window.ontouchstart,iOS:navigator.platform.match(/^iP(?:[ao]d|hone)/),Mac:navigator.platform.match(/^Mac/),Fullscreen:void 0!==(document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen),Angle:0,Rotated:!1,CSS:(i=document.createElement("a").style,r=document.createElement("p").style,n="position:sticky;position:-webkit-sticky;",n+="width:-webkit-max-content;width:-moz-max-content;width:-ms-max-content;width:max-content;",i.cssText=n,{positionSticky:-1!==i.position.indexOf("sticky"),widthMaxContent:-1!==i.width.indexOf("max-content"),flex:void 0!==r.flex})}),cookieEnabled:(t="elftest=",document.cookie=t+"1",e=2===document.cookie.split(t).length,document.cookie=t+";max-age=0",e),hasRequire:"function"==typeof define&&define.amd,currentReqCmd:"",keyState:{},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",nonameDateFormat:"ymd-His",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["msJan","msFeb","msMar","msApr","msMay","msJun","msJul","msAug","msSep","msOct","msNov","msDec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",group:"Selects",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/msword":"MsWord","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/x-xz":"XZ","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","text/x-markdown":"Markdown","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},mimeTypes:{},rules:{defaults:function(e){return!(!e||e.added&&!Array.isArray(e.added)||e.removed&&!Array.isArray(e.removed)||e.changed&&!Array.isArray(e.changed))},open:function(e){return e&&e.cwd&&e.files&&$.isPlainObject(e.cwd)&&Array.isArray(e.files)},tree:function(e){return e&&e.tree&&Array.isArray(e.tree)},parents:function(e){return e&&e.tree&&Array.isArray(e.tree)},tmb:function(e){return e&&e.images&&($.isPlainObject(e.images)||Array.isArray(e.images))},upload:function(e){return e&&($.isPlainObject(e.added)||Array.isArray(e.added))},search:function(e){return e&&e.files&&Array.isArray(e.files)}},commands:{},cmdsToAdd:"archive duplicate extract mkdir mkfile paste rm upload",parseUploadData:function(e){var t,n=this;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{t=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return t=n.normalize(t),n.validResponse("upload",t)?(t.removed=$.merge(t.removed||[],$.map(t.added||[],function(e){return n.file(e.hash)?e.hash:null})),t):{error:t.norError||["errResponse"]}},iframeCnt:0,uploads:{xhrUploading:!1,failSyncTm:null,chunkfailReq:{},checkExists:function(e,t,n,i){var r,o,a,s,l,c=$.Deferred(),d=[],u={},p=function(){for(var t=e.length;--t>-1;)e[t]._remove=!0},h=function(){c.resolve(d,u)};return n.api>=2.1&&"object"==typeof e[0]?(o=[],a=[],s=t!==n.cwd().hash?n.path(t,!0)+n.option("separator",t):"",l=function(t){var r=t==a.length-1,o={cssClass:"elfinder-confirm-upload",title:n.i18n("cmdupload"),text:["errExists",s+a[t].name,"confirmRepl"],all:!r,accept:{label:"btnYes",callback:function(e){r||e?h():l(++t)}},reject:{label:"btnNo",callback:function(n){var i;if(n)for(i=a.length;t<i--;)e[a[i].i]._remove=!0;else e[a[t].i]._remove=!0;r||n?h():l(++t)}},cancel:{label:"btnCancel",callback:function(){p(),h()}},buttons:[{label:"btnBackup",cssClass:"elfinder-confirm-btn-backup",callback:function(e){var n;if(e)for(n=a.length;t<n--;)d.push(a[n].name);else d.push(a[t].name);r||e?h():l(++t)}}]};i||o.buttons.push({label:"btnRename"+(r?"":"All"),cssClass:"elfinder-confirm-btn-rename",callback:function(){d=null,h()}}),n.iframeCnt>0&&delete o.reject,n.confirm(o)},n.file(t).read?(r=$.map(e,function(e,t){return!e.name||n.UA.iOS&&"image.jpg"===e.name?null:{i:t,name:e.name}}),n.request({data:{cmd:"ls",target:t,intersect:$.map(r,function(e){return e.name})},notify:{type:"preupload",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(e){var i,s;e&&(e.error?p():n.options.overwriteUploadConfirm&&n.option("uploadOverwrite",t)&&e.list&&(Array.isArray(e.list)?o=e.list||[]:(i=[],o=$.map(e.list,function(e){return"string"==typeof e?e:(i=i.concat(e),!1)}),i.length&&(o=o.concat(i)),u=e.list),(a=$.grep(r,function(e){return-1!==$.inArray(e.name,o)})).length&&o.length&&t==n.cwd().hash&&(s=$.map(n.files(t),function(e){return e.name}),$.grep(o,function(e){return-1===$.inArray(e,s)}).length&&n.sync()))),a.length>0?l(0):h()}).fail(function(e){p(),h(),e&&n.error(e)})):h()):h(),c},checkFile:function(e,t,n){if(e.checked||"files"==e.type)return e.files;if("data"==e.type){var i,r,o=$.Deferred(),a=$.Deferred(),s=[],l=[],c=0,d=[],u=!1,p=function(e){var n,i=t.options.folderUploadExclude[t.OS]||null,r=e.length,o=function(){--c<1&&"pending"===a.state()&&a.resolve()},h=function(e){i&&e.name.match(i)||(l.push(n.fullPath||""),s.push(e)),o()},f=function(e){var t=[],n=function(){e.readEntries(function(e){if(u||!e.length){for(var i=0;i<t.length;i++){if(u){a.reject();break}p([t[i]])}o()}else t=t.concat((r=e,Array.prototype.slice.call(r||[],0))),n();var r},o)};n()};c++;for(var m=0;m<r;m++){if(u){a.reject();break}(n=e[m])&&(n.isFile?(c++,n.file(h,o)):n.isDirectory&&t.api>=2.1&&(c++,d.push(n.fullPath),f(n.createReader())))}return o(),a};return i=$.map(e.files.items,function(e){return e.getAsEntry?e.getAsEntry():e.webkitGetAsEntry()}),$.each(i,function(e,t){if(t.isDirectory)return r=!0,!1}),i.length>0?(t.uploads.checkExists(i,n,t,r).done(function(r,a){var c=[];t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",n)&&(null===r&&(e.overwrite=0,r=[]),i=$.grep(i,function(e){var i,o,s,l;return e.isDirectory&&r.length&&-1!==(i=$.inArray(e.name,r))&&(r.splice(i,1),o=t.uniqueName(e.name+t.options.backupSuffix,null,""),$.each(a,function(t,n){if(e.name==n)return s=t,!1}),s||(s=t.fileByName(e.name,n).hash),t.lockfiles({files:[s]}),l=t.request({data:{cmd:"rename",target:s,name:o},notify:{type:"rename",cnt:1}}).fail(function(){e._remove=!0,t.sync()}).always(function(){t.unlockfiles({files:[s]})}),c.push(l)),!e._remove})),$.when.apply($,c).done(function(){var e,n,c=+new Date;i.length>0?(n=t.escape(i[0].name),i.length>1&&(n+=" ... "+i.length+t.i18n("items")),e=setTimeout(function(){t.notify({type:"readdir",id:c,cnt:1,hideCnt:!0,msg:t.i18n("ntfreaddir")+" ("+n+")",cancel:function(){u=!0}})},t.options.notifyDelay),p(i).done(function(){e&&clearTimeout(e),t.notify({type:"readdir",id:c,cnt:-1}),u?o.reject():o.resolve([s,l,r,a,d])}).fail(function(){o.reject()})):o.reject()})}),o.promise()):o.reject()}var h=[],f=[],m=e.files[0];if("html"==e.type){var g,y=$("<html/>").append($.parseHTML(m.replace(/ src=/gi," _elfsrc=")));$("img[_elfsrc]",y).each(function(){var t,n,i=$(this),r=i.closest("a");r&&r.attr("href")&&r.attr("href").match(/\.(?:jpe?g|gif|bmp|png)/i)&&(n=r.attr("href")),(t=i.attr("_elfsrc"))&&(n?(-1==$.inArray(n,h)&&h.push(n),-1==$.inArray(t,f)&&f.push(t)):-1==$.inArray(t,h)&&h.push(t)),1===h.length&&h[0].match(/^data:image\/png/)&&(e.clipdata=!0)}),(g=$("a[href]",y)).each(function(){var e,t,n,i;(e=$(this).text())&&(n=$(this).attr("href"),(i=document.createElement("a")).href=n,(t=i).href&&t.href.match(/^(?:ht|f)tp/i)&&(1===g.length||!t.pathname.match(/(?:\.html?|\/[^\/.]*)$/i)||$.trim(e).match(/\.[a-z0-9-]{1,10}$/i))&&-1==$.inArray(t.href,h)&&-1==$.inArray(t.href,f)&&h.push(t.href))})}else{var v,b,w;for(v=/((?:ht|f)tps?:\/\/[-_.!~*\'()a-z0-9;/?:\@&=+\$,%#\*\[\]]+)/gi;b=v.exec(m);)w=b[1].replace(/&amp;/g,"&"),-1==$.inArray(w,h)&&h.push(w)}return h},xhr:function(e,t){var n=t||this,i=n.getUI(),r=new XMLHttpRequest,o=null,a=null,s=null,l=e.checked,c=e.isDataType||"data"==e.type,d=e.target||n.cwd().hash,u=e.dropEvt||null,p=e.extraData||null,h=-1!=n.option("uploadMaxConn",d),f=Math.min(5,Math.max(1,n.option("uploadMaxConn",d))),m=0,g=function(e){var t=$.Deferred();return e.promise?e.always(function(e){t.resolve(Array.isArray(e)&&e.length?c?e[0][0]:e[0]:{})}):t.resolve(e.length?c?e[0][0]:e[0]:{}),t},y=$.Deferred().fail(function(e){var i,r=n.parseError(e);"userabort"===r&&(i=!0,r=void 0),b&&(n.uploads.xhrUploading||i)?g(b).done(function(e){i||I(r,e),e._cid?n.uploads.chunkfailReq[e._cid]||(n.uploads.chunkfailReq[e._cid]=!0,setTimeout(function(){t.request({data:{cmd:"upload",target:d,chunk:e._chunk,cid:e._cid,upload:["chunkfail"],mimes:"chunkfail"},options:{type:"post",url:n.uploadURL},preventDefault:!0}).always(function(){delete n.uploads.chunkfailReq[e._chunk]})},1e3)):(n.uploads.failSyncTm&&clearTimeout(n.uploads.failSyncTm),n.uploads.failSyncTm=setTimeout(function(){n.sync(d)},1e3))}):I(r),!i&&n.sync(),n.uploads.xhrUploading=!1,b=null}).done(function(e){n.uploads.xhrUploading=!1,b=null,e&&(n.currentReqCmd="upload",e.warning&&I(e.warning),n.updateCache(e),e.removed&&e.removed.length&&n.remove(e),e.added&&e.added.length&&n.add(e),e.changed&&e.changed.length&&n.change(e),n.trigger("upload",e,!1),n.trigger("uploaddone"),e.toasts&&Array.isArray(e.toasts)&&$.each(e.toasts,function(){this.msg&&n.toast(this)}),e.sync&&n.sync(),e.debug&&(n.responseDebug(e),t.debug("backend-debug",e)))}).always(function(){n.abortXHR(r),i.off("uploadabort",z),$(window).off("unload",z),o&&clearTimeout(o),a&&clearTimeout(a),s&&clearTimeout(s),l&&!e.multiupload&&F()&&n.notify({type:"upload",cnt:-w,progress:0,size:0}),a&&j&&n.notify({type:"chunkmerge",cnt:-w}),H&&S.children(".elfinder-notify-chunkmerge").length&&n.notify({type:"chunkmerge",cnt:-1})}),v=new FormData,b=e.input?e.input.files:n.uploads.checkFile(e,n,d),w=e.checked&&c?b[0].length:b.length,x=!1,k=0,C=0,O=0,A=!1,S=n.ui.notify,T=!0,j=!1,D=!1,F=function(){return!A&&(N=S.children(".elfinder-notify-upload")).length&&(A=!0),A},z=function(e,t){D=!0,n.abortXHR(r,{quiet:!0,abort:!0}),y.reject(t),F()&&n.notify({type:"upload",cnt:-1*N.data("cnt"),progress:0,size:0})},M=function(e,t){N.children(".elfinder-notify-cancel")[e?"show":"hide"](),T=e},E=function(t){return t||(t=O),setTimeout(function(){A=!0,n.notify({type:"upload",cnt:w,progress:k-C,size:t,cancel:function(){i.trigger("uploadabort","userabort")}}),N=S.children(".elfinder-notify-upload"),C=k,e.multiupload?T&&M(!0):M(T&&k<t)},n.options.notifyDelay)},U=function(){A&&y.notifyWith(N,[{cnt:N.data("cnt"),progress:N.data("progress"),total:N.data("total")}])},I=function(e,t,i){e&&n.trigger("xhruploadfail",{error:e,file:t}),i?e&&(P<n.options.maxErrorDialogs&&(Array.isArray(e)?R=R.concat(e):R.push(e)),P++):e?n.error(e):(R.length&&(P>=n.options.maxErrorDialogs&&(R=R.concat("moreErrors",P-n.options.maxErrorDialogs)),n.error(R)),R=[],P=0)},R=[],P=0,_=e.renames||null,q=e.hashes||null,H=!1,N=$();if(i.one("uploadabort",z),$(window).one("unload."+t.namespace,z),!H&&(C=k),!c&&!w)return y.reject(["errUploadNoFiles"]);r.addEventListener("error",function(){0==r.status?D?y.reject():!c&&e.files&&$.grep(e.files,function(e){return!e.type&&e.size===(n.UA.Safari?1802:0)}).length?y.reject(["errAbort","errFolderUpload"]):e.input&&$.grep(e.input.files,function(e){return!e.type&&e.size===(n.UA.Safari?1802:0)}).length?y.reject(["errUploadNoFiles"]):m++<=30?(F()&&C&&n.notify({type:"upload",cnt:0,progress:0,size:C}),n.abortXHR(r,{quiet:!0}),C=k=0,setTimeout(function(){var e;D||(r.open("POST",n.uploadURL,!0),n.api>=2.1029&&(e=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),"function"==typeof v.delete&&v.delete("reqid"),v.append("reqid",e),r._requestId=e),r.send(v))},1e4)):i.trigger("uploadabort",["errAbort","errTimeout"]):i.trigger("uploadabort","errConnect")},!1),r.addEventListener("load",function(t){var a,l,d=r.status,u=0,p="";if(n.setCustomHeaderByXhr(r),d>=400?p=d>500?"errResponse":["errResponse","errServerError"]:r.responseText||(p=["errResponse","errDataEmpty"]),p&&(i.trigger("uploadabort"),g(b||{}).done(function(e){return y.reject(e._cid?null:p)})),k=O,F()&&(u=k-C)&&(n.notify({type:"upload",cnt:0,progress:u,size:0}),U()),(a=n.parseUploadData(r.responseText))._chunkmerged){v=new FormData;var h=[{_chunkmerged:a._chunkmerged,_name:a._name,_mtime:a._mtime}];return H=!0,i.off("uploadabort",z),s=setTimeout(function(){n.notify({type:"chunkmerge",cnt:1})},n.options.notifyDelay),void(c?W(h,b[1]):W(h))}a._multiupload=!!e.multiupload,a.error?(l={cmd:"upload",err:a,xhr:r,rc:r.status},n.trigger("uploadfail",a),n.trigger("requestError",l),l._getEvent&&l._getEvent().isDefaultPrevented()&&(a.error=""),a._chunkfailure||a._multiupload?(D=!0,n.uploads.xhrUploading=!1,o&&clearTimeout(o),N.length?(n.notify({type:"upload",cnt:-w,progress:0,size:0}),y.reject(a)):y.reject()):y.reject(a)):y.resolve(a)},!1),r.upload.addEventListener("loadstart",function(t){!H&&t.lengthComputable&&(k=t.loaded,m&&(k=0),O=t.total,k||(k=parseInt(.05*O)),F()&&(n.notify({type:"upload",cnt:0,progress:k-C,size:e.multiupload?0:O}),C=k,U()))},!1),r.upload.addEventListener("progress",function(t){var i;t.lengthComputable&&!H&&r.readyState<2&&(k=t.loaded,!e.checked&&k>0&&!o&&(o=E(r._totalSize-k)),O||(O=t.total,k||(k=parseInt(.05*O))),i=k-C,F()&&i/t.total>=.05&&(n.notify({type:"upload",cnt:0,progress:i,size:0}),C=k,U()),!j&&k>=O&&!x&&(j=!0,a=setTimeout(function(){n.notify({type:"chunkmerge",cnt:w})},n.options.notifyDelay)),T&&!e.multiupload&&k>=O&&F()&&M(!1))},!1);var L,B,W=function(i,a){var s,m,g,b,k,C,O,A,S,j,z,U,P,H,N,L=0,B=1,W=[],X=0,J=w,K=0,G=[],V=(new Date).getTime().toString().substr(-9),Y=Math.min((t.uplMaxSize?t.uplMaxSize:2097152)-8190,t.options.uploadMaxChunkSize),Q=!h&&"",Z=function(i,r){var a,s,l,p=[],h=0;if(!D){for(;i.length&&p.length<r;)p.push(i.shift());if(h=p.length){s=h;for(var f=0;f<h&&!D;f++)a=c?p[f][0][0]._cid||null:p[f][0]._cid||null,l=!(!l&&!a),H[a]?P--:t.exec("upload",{type:e.type,isDataType:c,files:p[f],checked:!0,target:d,dropEvt:u,renames:_,hashes:q,multiupload:!0,overwrite:0===e.overwrite?0:void 0,clipdata:e.clipdata},void 0,d).fail(function(e){e&&"No such command"===e&&(D=!0,t.error(["errUpload","errPerm"])),a&&(H[a]=!0)}).always(function(e){e&&e.added&&(z=$.merge(z,e.added)),P<=++U&&(t.trigger("multiupload",{added:z}),o&&clearTimeout(o),F()&&n.notify({type:"upload",cnt:-w,progress:0,size:0})),i.length?Z(i,1):(--s<=1&&T&&M(!1),y.resolve())})}}(p.length<1||D)&&(D?(o&&clearTimeout(o),a&&(H[a]=!0),y.reject()):(y.resolve(),n.uploads.xhrUploading=!1))},ee=function(){n.uploads.xhrUploading?setTimeout(ee,100):(n.uploads.xhrUploading=!0,Z(W,f))};if(!l&&(c||"files"==e.type)){for((s=t.option("uploadMaxSize",d))||(s=0),k=0;k<i.length;k++){try{m=(S=i[k]).size,!1===Q&&(Q="",n.api>=2.1&&("slice"in S?Q="slice":"mozSlice"in S?Q="mozSlice":"webkitSlice"in S&&(Q="webkitSlice")))}catch(e){w--,J--;continue}if(s&&m>s||!Q&&t.uplMaxSize&&m>t.uplMaxSize)I(["errUploadFile",S.name,"errUploadFileSize"],S,!0),w--,J--;else if(!S.type||n.uploadMimeCheck(S.type,d))if(Q&&m>Y){for(C=0,O=Y,A=-1,J=Math.floor((m-1)/Y),g=S.lastModified?Math.round(S.lastModified/1e3):0,b=e.clipdata?t.date(t.nonameDateFormat)+".png":S.name,K+=m,G[V]=0;C<m;)(j=S[Q](C,O))._chunk=b+"."+ ++A+"_"+J+".part",j._cid=V,j._range=C+","+j.size+","+m,j._mtime=g,G[V]++,L&&X++,void 0===W[X]&&(W[X]=[],c&&(W[X][0]=[],W[X][1]=[])),L=Y,B=1,c?(W[X][0].push(j),W[X][1].push(a[k])):W[X].push(j),O=(C=O)+Y;null==j?(I(["errUploadFile",S.name,"errUploadFileSize"],S,!0),w--,J--):(J+=A,L=0,B=1,X++)}else(t.uplMaxSize&&L+m>t.uplMaxSize||B>t.uplMaxFile)&&(L=0,B=1,X++),void 0===W[X]&&(W[X]=[],c&&(W[X][0]=[],W[X][1]=[])),c?(W[X][0].push(S),W[X][1].push(a[k])):W[X].push(S),L+=m,K+=m,B++;else I(["errUploadFile",S.name,"errUploadMime","("+S.type+")"],S,!0),w--,J--}if(R.length&&I(),0==W.length)return e.checked=!0,!1;if(W.length>1)return o=E(K),z=[],U=0,P=W.length,H=[],ee(),!0;c?(i=W[0][0],a=W[0][1]):i=W[0]}return l||(t.UA.Safari&&e.files?r._totalSize=K:o=E(K)),l=!0,i.length||y.reject(["errUploadNoFiles"]),r.open("POST",n.uploadURL,!0),t.customHeaders&&$.each(t.customHeaders,function(e){r.setRequestHeader(e,this)}),t.xhrFields&&$.each(t.xhrFields,function(e){e in r&&(r[e]=this)}),n.api>=2.1029&&(N=(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16),v.append("reqid",N),r._requestId=N),v.append("cmd","upload"),v.append(n.newAPI?"target":"current",d),_&&_.length&&($.each(_,function(e,t){v.append("renames[]",t)}),v.append("suffix",t.options.backupSuffix)),q&&$.each(q,function(e,t){v.append("hashes["+e+"]",t)}),$.each(n.customData,function(e,t){v.append(e,t)}),$.each(n.options.onlyMimes,function(e,t){v.append("mimes[]",t)}),$.each(i,function(n,i){var r;i._chunkmerged?(v.append("chunk",i._chunkmerged),v.append("upload[]",i._name),v.append("mtime[]",i._mtime),e.clipdata&&v.append("overwrite",0),x=!0):(i._chunkfail?(v.append("upload[]","chunkfail"),v.append("mimes","chunkfail")):(e.clipdata?i._chunk||(e.overwrite=0,r=t.date(t.nonameDateFormat)+".png"):i.name&&(r=i.name,t.UA.iOS&&(r.match(/^image\.jpe?g$/i)?(e.overwrite=0,r=t.date(t.nonameDateFormat)+".jpg"):r.match(/^capturedvideo\.mov$/i)&&(e.overwrite=0,r=t.date(t.nonameDateFormat)+".mov")),r=(i.webkitRelativePath||i.relativePath||i._relativePath||"").replace(/[^\/]+$/,"")+r),r?v.append("upload[]",i,r):v.append("upload[]",i)),i._chunk?(v.append("chunk",i._chunk),v.append("cid",i._cid),v.append("range",i._range),v.append("mtime[]",i._mtime),x=!0):v.append("mtime[]",i.lastModified?Math.round(i.lastModified/1e3):0))}),c&&$.each(a,function(e,t){v.append("upload_path[]",t)}),0===e.overwrite&&v.append("overwrite",0),u&&v.append("dropWith",parseInt((u.altKey?"1":"0")+(u.ctrlKey?"1":"0")+(u.metaKey?"1":"0")+(u.shiftKey?"1":"0"),2)),p&&$.each(p,function(e,t){v.append(e,t)}),r.send(v),!0};if(c)l?W(b[0],b[1]):b.done(function(e){if(_=[],w=e[0].length){if(e[4]&&e[4].length)return void t.request({data:{cmd:"mkdir",target:d,dirs:e[4]},notify:{type:"mkdir",cnt:e[4].length},preventFail:!0}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?f=1:(f=0,y.reject(e))}).done(function(t){var n=!1;t.hashes||(t.hashes={}),e[1]=$.map(e[1],function(i,r){return e[0][r]._relativePath=i.replace(/^\//,""),""===(i=i.replace(/\/[^\/]*$/,""))?d:t.hashes[i]?t.hashes[i]:(n=!0,e[0][r]._remove=!0,null)}),n&&(e[0]=$.grep(e[0],function(e){return!e._remove}))}).always(function(t){f&&(_=e[2],q=e[3],W(e[0],e[1]))});e[1]=$.map(e[1],function(){return d}),_=e[2],q=e[3],W(e[0],e[1])}else y.reject(["errUploadNoFiles"])}).fail(function(){y.reject()});else if(b.length>0)if(e.clipdata||null!=_)W(b)||y.reject();else{var X=[],J=[],K=t.options.folderUploadExclude[t.OS]||null;$.each(b,function(e,t){var n,i,r=t.webkitRelativePath||t.relativePath||"";if(!r)return!1;K&&t.name.match(K)?(t._remove=!0,r=void 0):(r="/"+r.replace(/\/[^\/]*$/,"").replace(/^\//,""))&&-1===$.inArray(r,X)&&(X.push(r),-1!==(n=r.substr(1).indexOf("/"))&&(i=r.substr(0,n+1))&&-1===$.inArray(i,X)&&X.unshift(i)),J.push(r)}),_=[],q={},X.length?(L=$.map(X,function(e){return-1===e.substr(1).indexOf("/")?{name:e.substr(1)}:null}),B=[],t.uploads.checkExists(L,d,t,!0).done(function(e,n){var i,r,o=[];t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",d)&&(B=$.map(L,function(e){return e._remove?e.name:null}),L=$.grep(L,function(e){return!e._remove})),B.length&&$.each(J.concat(),function(e,t){0===$.inArray(t,B)&&(b[e]._remove=!0,J[e]=void 0)}),b=$.grep(b,function(e){return!e._remove}),J=$.grep(J,function(e){return void 0!==e}),L.length?($.Deferred(),e.length?$.each(e,function(a,s){i=t.uniqueName(s+t.options.backupSuffix,null,""),$.each(n,function(t,n){if(e[0]==n)return r=t,!1}),r||(r=t.fileByName(e[0],d).hash),t.lockfiles({files:[r]}),o.push(t.request({data:{cmd:"rename",target:r,name:i},notify:{type:"rename",cnt:1}}).fail(function(e){y.reject(e),t.sync()}).always(function(){t.unlockfiles({files:[r]})}))}):o.push(null),$.when.apply($,o).done(function(){t.request({data:{cmd:"mkdir",target:d,dirs:X},notify:{type:"mkdir",cnt:X.length},preventFail:!0}).fail(function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?f=1:(f=0,y.reject(e))}).done(function(e){var t=!1;e.hashes||(e.hashes={}),J=$.map(J.concat(),function(n,i){return"/"===n?d:e.hashes[n]?e.hashes[n]:(t=!0,b[i]._remove=!0,null)}),t&&(b=$.grep(b,function(e){return!e._remove}))}).always(function(e){f&&(c=!0,W(b,J)||y.reject())})})):y.reject()})):t.uploads.checkExists(b,d,t).done(function(n,i){t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",d)&&(q=i,null===n?e.overwrite=0:_=n,b=$.grep(b,function(e){return!e._remove})),(w=b.length)>0&&W(b)||y.reject()})}else y.reject();return y},iframe:function(e,t){var n,i,r,o,a=t||this,s=!!e.input&&e.input,l=!s&&a.uploads.checkFile(e,a),c=$.Deferred().fail(function(e){e&&a.error(e)}),d="iframe-"+t.namespace+ ++a.iframeCnt,u=$('<form action="'+a.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+d+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),p=this.UA.IE,h=function(){o&&clearTimeout(o),r&&clearTimeout(r),i&&a.notify({type:"upload",cnt:-n}),setTimeout(function(){p&&$('<iframe src="javascript:false;"/>').appendTo(u),u.remove(),f.remove()},100)},f=$('<iframe src="'+(p?"javascript:false;":"about:blank")+'" name="'+d+'" style="position:absolute;left:-1000px;top:-1000px" />').on("load",function(){f.off("load").on("load",function(){h(),c.resolve()}),r=setTimeout(function(){i=!0,a.notify({type:"upload",cnt:n})},a.options.notifyDelay),a.options.iframeTimeout>0&&(o=setTimeout(function(){h(),c.reject(["errConnect","errTimeout"])},a.options.iframeTimeout)),u.submit()}),m=e.target||a.cwd().hash,g=[],y=[],v=[],b={};if(l&&l.length)$.each(l,function(e,t){u.append('<input type="hidden" name="upload[]" value="'+t+'"/>')}),n=1;else{if(!(s&&$(s).is(":file")&&$(s).val()))return c.reject();t.options.overwriteUploadConfirm&&t.option("uploadOverwrite",m)&&(g=s.files?s.files:[{name:$(s).val().replace(/^(?:.+[\\\/])?([^\\\/]+)$/,"$1")}],y.push(a.uploads.checkExists(g,m,a).done(function(t,i){b=i,null===t?e.overwrite=0:(v=t,(n=$.grep(g,function(e){return!e._remove}).length)!=g.length&&(n=0))}))),n=s.files?s.files.length:1,u.append(s)}return $.when.apply($,y).done(function(){if(n<1)return c.reject();u.append('<input type="hidden" name="'+(a.newAPI?"target":"current")+'" value="'+m+'"/>').append('<input type="hidden" name="html" value="1"/>').append('<input type="hidden" name="node" value="'+a.id+'"/>').append($(s).attr("name","upload[]")),v.length>0&&($.each(v,function(e,t){u.append('<input type="hidden" name="renames[]" value="'+a.escape(t)+'"/>')}),u.append('<input type="hidden" name="suffix" value="'+t.options.backupSuffix+'"/>')),b&&$.each(v,function(e,t){u.append('<input type="hidden" name="['+e+']" value="'+a.escape(t)+'"/>')}),0===e.overwrite&&u.append('<input type="hidden" name="overwrite" value="0"/>'),$.each(a.options.onlyMimes||[],function(e,t){u.append('<input type="hidden" name="mimes[]" value="'+a.escape(t)+'"/>')}),$.each(a.customData,function(e,t){u.append('<input type="hidden" name="'+e+'" value="'+a.escape(t)+'"/>')}),u.appendTo("body"),f.appendTo("body")}),c}},one:function(e,t,n){var i=this,r=e.toLowerCase(),o=function(e,n){return i.toUnbindEvents[r]||(i.toUnbindEvents[r]=[]),i.toUnbindEvents[r].push({type:r,callback:o}),(t.done?t.done:t).apply(this,arguments)};return t.done&&(o={done:o}),this.bind(r,o,n)},localStorage:function(e,t){var n,i,r,o,a,s=window.localStorage,l="elfinder-"+(e||"")+this.id,c=window.location.pathname+"-elfinder-",d=this.id,u=[];if(void 0===e)return o=c.length,a=-1*d.length,$.each(s,function(e){e.substr(0,o)===c&&e.substr(a)===d&&u.push(e)}),$.each(u,function(e,t){s.removeItem(t)}),!0;if(e=c+e+d,null===t)return s.removeItem(e);if(void 0===t&&!(n=s.getItem(e))&&(i=s.getItem(l))&&(t=i,s.removeItem(l)),void 0!==t){"string"!==(r=typeof t)&&"number"!==r&&(t=JSON.stringify(t));try{s.setItem(e,t)}catch(n){try{s.clear(),s.setItem(e,t)}catch(e){this.debug("error",e.toString())}}n=s.getItem(e)}if(n&&("{"===n.substr(0,1)||"["===n.substr(0,1)))try{return JSON.parse(n)}catch(e){}return n},sessionStorage:function(e,t){var n,i,r;try{n=window.sessionStorage}catch(e){}if(n){if(null===t)return n.removeItem(e);if(void 0!==t){"string"!==(r=typeof t)&&"number"!==r&&(t=JSON.stringify(t));try{n.setItem(e,t)}catch(i){try{n.clear(),n.setItem(e,t)}catch(e){this.debug("error",e.toString())}}}if((i=n.getItem(e))&&("{"===i.substr(0,1)||"["===i.substr(0,1)))try{return JSON.parse(i)}catch(e){}return i}},cookie:function(e,t){var n,i,r,o,a,s;if(e="elfinder-"+e+this.id,void 0===t){if(this.cookieEnabled&&document.cookie&&""!=document.cookie)for(r=document.cookie.split(";"),e+="=",o=0;o<r.length;o++)if(r[o]=$.trim(r[o]),r[o].substring(0,e.length)==e){if("{"===(a=decodeURIComponent(r[o].substring(e.length))).substr(0,1)||"["===a.substr(0,1))try{return JSON.parse(a)}catch(e){}return a}return null}if(!this.cookieEnabled)return"";if(i=Object.assign({},this.options.cookie),null===t?(t="",i.expires=-1):"string"!==(s=typeof t)&&"number"!==s&&(t=JSON.stringify(t)),"number"==typeof i.expires&&((n=new Date).setTime(n.getTime()+864e5*i.expires),i.expires=n),document.cookie=e+"="+encodeURIComponent(t)+"; expires="+i.expires.toUTCString()+(i.path?"; path="+i.path:"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":""),t&&("{"===t.substr(0,1)||"["===t.substr(0,1)))try{return JSON.parse(t)}catch(e){}return t},startDir:function(){var e=window.location.hash;return e&&e.match(/^#elf_/)?e.replace(/^#elf_/,""):this.options.startPathHash?this.options.startPathHash:this.lastDir()},lastDir:function(e){return this.options.rememberLastDir?this.storage("lastdir",e):""},_node:$("<span/>"),escape:function(e){return this._node.text(e).html().replace(/"/g,"&quot;").replace(/'/g,"&#039;")},normalize:function(e){var t,n,i,r,o,a,s,l=this,c=function(){var e,t;return(t=l.options.fileFilter)&&("function"==typeof t?e=function(e){return t.call(l,e)}:t instanceof RegExp&&(e=function(e){return t.test(e.name)})),e||null}(),d=function(e){var t=function(e){var t=typeof e;return"object"===t&&Array.isArray(e)&&(t="array"),t};return $.each(l.optionProperties,function(n,i){void 0!==i&&e[n]&&t(e[n])!==t(i)&&(e[n]=i)}),e.disabled?(e.disabledFlip=l.arrayFlip(e.disabled,!0),$.each(l.options.disabledCmdsRels,function(t,n){var i,r;e.disabledFlip[t]?r=!0:(i=t.match(/^([^&]+)&([^=]+)=(.*)$/))&&e.disabledFlip[i[1]]&&e[i[2]]==i[3]&&(r=!0),r&&$.each(n,function(t,n){e.disabledFlip[n]||(e.disabledFlip[n]=!0,e.disabled.push(n))})})):e.disabledFlip={},e},u=function(e,o,a){var s,u,p,f,m,g,y=!o||e,v=!!o&&null;if(e&&e.hash&&e.name&&e.mime){if("application/x-empty"===e.mime&&(e.mime="text/plain"),(p=l.isRoot(e))&&!e.volumeid&&l.debug("warning","The volume root statuses requires `volumeid` property."),p||"directory"===e.mime){if(e.phash){if(e.phash===e.hash)return h=h.concat(['Parent folder of "$1" is itself.',e.name]),v;if(p&&e.volumeid&&0===e.phash.indexOf(e.volumeid))return h=h.concat(['Parent folder of "$1" is inner itself.',e.name]),v}e.volumeid&&(s=e.volumeid,p&&(e.phash&&(l.leafRoots[e.phash]?-1===$.inArray(e.hash,l.leafRoots[e.phash])&&l.leafRoots[e.phash].push(e.hash):l.leafRoots[e.phash]=[e.hash]),l.hasVolOptions=!0,l.volOptions[s]||(l.volOptions[s]={dispInlineRegex:l.options.dispInlineRegex}),u=l.volOptions[s],e.options&&Object.assign(u,e.options),e.disabled&&(u.disabled=e.disabled,u.disabledFlip=l.arrayFlip(e.disabled,!0)),e.tmbUrl&&(u.tmbUrl=e.tmbUrl),u.url&&"/"!==u.url.substr(-1)&&(u.url+="/"),(m=u).uiCmdMap&&($.isPlainObject(m.uiCmdMap)&&Object.keys(m.uiCmdMap).length?(m.disabledFlip||(m.disabledFlip={}),g=m.disabledFlip,$.each(m.uiCmdMap,function(e,t){"hidden"!==t||g[e]||(m.disabled.push(e),m.disabledFlip[e]=!0)})):delete m.uiCmdMap),u.trashHash&&(!1===l.trashes[u.trashHash]?delete u.trashHash:l.trashes[u.trashHash]=e.hash),$.each(l.optionProperties,function(t){u[t]&&(e[t]=u[t])}),"cwd"!==a&&(l.roots[s]=e.hash),e.expires&&(l.volumeExpires[s]=e.expires)),r!==s&&(r=s,i=l.option("i18nFolderName",s))),p&&!e.i18&&(t="volume_"+e.name,n=l.i18n(!1,t),t!==n&&(e.i18=n)),i&&!e.i18&&(t="folder_"+e.name,n=l.i18n(!1,t),t!==n&&(e.i18=n)),p&&(f=l.storage("rootNames"))&&(f[e.hash]&&(e._name=e.name,e._i18=e.i18,e.name=f[e.hash]=f[e.hash],delete e.i18),l.storage("rootNames",f)),l.trashes[e.hash]&&(e.locked=!0)}else{if(c)try{if(!c(e))return v}catch(e){l.debug(e)}0==e.size&&(e.mime=l.getMimetype(e.name,e.mime))}return e.options&&(l.optionsByHashes[e.hash]=d(e.options)),delete e.options,y}return v},p=function(t,n){$.each(t,function(t,i){var r,o;l.leafRoots[i.hash]&&l.applyLeafRootStats(i),"change"!==n&&i.phash&&l.isRoot(i)&&(r=l.file(i.phash))&&(l.applyLeafRootStats(r),e.changed?($.each(e.changed,function(t,n){if(n.hash===r.hash)return e.changed[t]=r,o=!0,!1}),o||e.changed.push(r)):e.changed=[r])})},h=[];if(e.customData&&(!l.prevCustomData||JSON.stringify(e.customData)!==JSON.stringify(l.prevCustomData))){l.prevCustomData=e.customData;try{o=JSON.parse(e.customData),$.isPlainObject(o)&&(l.prevCustomData=o,$.each(Object.keys(o),function(e,t){null===o[t]&&(delete o[t],delete l.optsCustomData[t])}),l.customData=Object.assign({},l.optsCustomData,o))}catch(e){}}return e.options&&d(e.options),e.cwd&&(e.cwd.volumeid&&e.options&&Object.keys(e.options).length&&l.isRoot(e.cwd)&&(l.hasVolOptions=!0,l.volOptions[e.cwd.volumeid]=e.options),e.cwd=u(e.cwd,!0,"cwd")),e.files&&(e.files=$.grep(e.files,u)),e.tree&&(e.tree=$.grep(e.tree,u)),e.added&&(e.added=$.grep(e.added,u)),e.changed&&(e.changed=$.grep(e.changed,u)),e.removed&&e.removed.length&&2===l.searchStatus.state&&(e.removed=e.removed.concat((a=e.removed,s=[],$.each(l.files(),function(e,t){$.each(l.parents(e),function(t,n){if(-1!==$.inArray(n,a)&&-1===$.inArray(e,a))return s.push(e),!1})}),s))),e.api&&(e.init=!0),Object.keys(l.leafRoots).length&&(e.files&&p(e.files),e.tree&&p(e.tree),e.added&&p(e.added),e.changed&&p(e.changed,"change")),e.cwd&&e.cwd.options&&e.options&&Object.assign(e.options,d(e.cwd.options)),e.options&&e.options.url&&"/"!==e.options.url.substr(-1)&&(e.options.url+="/"),h.length&&(e.norError=["errResponse"].concat(h)),e},setSort:function(e,t,n,i){this.storage("sortType",this.sortType=this.sortRules[e]?e:"name"),this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc"),this.storage("sortStickFolders",(this.sortStickFolders=!!n)?1:""),this.storage("sortAlsoTreeview",(this.sortAlsoTreeview=!!i)?1:""),this.trigger("sortchange")},_sortRules:{name:function(e,t){return u.prototype.naturalCompare(e.i18||e.name,t.i18||t.name)},size:function(e,t){var n=parseInt(e.size)||0,i=parseInt(t.size)||0;return n===i?0:n>i?1:-1},kind:function(e,t){return u.prototype.naturalCompare(e.mime,t.mime)},date:function(e,t){var n=e.ts||e.date||0,i=t.ts||t.date||0;return n===i?0:n>i?1:-1},perm:function(e,t){var n=function(e){return(e.write?2:0)+(e.read?1:0)},i=n(e),r=n(t);return i===r?0:i>r?1:-1},mode:function(e,t){var n=e.mode||e.perm||"",i=t.mode||t.perm||"";return u.prototype.naturalCompare(n,i)},owner:function(e,t){var n=e.owner||"",i=t.owner||"";return u.prototype.naturalCompare(n,i)},group:function(e,t){var n=e.group||"",i=t.group||"";return u.prototype.naturalCompare(n,i)}},sorters:{},naturalCompare:function(e,t){var n=u.prototype.naturalCompare;return void 0===n.loc&&(n.loc=navigator.userLanguage||navigator.browserLanguage||navigator.language||"en-US"),void 0===n.sort&&("11".localeCompare("2",n.loc,{numeric:!0})>0?window.Intl&&window.Intl.Collator?n.sort=new Intl.Collator(n.loc,{numeric:!0}).compare:n.sort=function(e,t){return e.localeCompare(t,n.loc,{numeric:!0})}:(n.sort=function(e,t){var i,r,o=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,a=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,c=/^0/,d=/^[\x01\x21-\x2f\x3a-\x40\x5b-\x60\x7b-\x7e]/,u=function(e){return n.sort.insensitive&&(""+e).toLowerCase()||""+e},p=u(e).replace(a,"").replace(/^_/,"")||"",h=u(t).replace(a,"").replace(/^_/,"")||"",f=p.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=h.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(p.match(l))||1!=f.length&&p.match(s)&&Date.parse(p),y=parseInt(h.match(l))||g&&h.match(s)&&Date.parse(h)||null,v=0;if(y){if(g<y)return-1;if(g>y)return 1}for(var b=0,w=Math.max(f.length,m.length);b<w;b++){if(i=!(f[b]||"").match(c)&&parseFloat(f[b])||f[b]||0,r=!(m[b]||"").match(c)&&parseFloat(m[b])||m[b]||0,isNaN(i)!==isNaN(r)){if(isNaN(i)&&("string"!=typeof i||!i.match(d)))return 1;if("string"!=typeof r||!r.match(d))return-1}if(0===parseInt(i,10)&&(i=0),0===parseInt(r,10)&&(r=0),typeof i!=typeof r&&(i+="",r+=""),n.sort.insensitive&&"string"==typeof i&&"string"==typeof r&&0!==(v=i.localeCompare(r,n.loc)))return v;if(i<r)return-1;if(i>r)return 1}return 0},n.sort.insensitive=!0)),n.sort(e,t)},compare:function(e,t){var n,i=this.sortType,r="asc"==this.sortOrder,o=this.sortStickFolders,a=this.sortRules,s=a[i],l="directory"==e.mime,c="directory"==t.mime;if(o){if(l&&!c)return-1;if(!l&&c)return 1}return n=r?s(e,t):s(t,e),"name"!==i&&0===n?n=r?a.name(e,t):a.name(t,e):n},sortFiles:function(e){return e.sort(this.compare)},notify:function(e){var t,n,i,r=this,o=e.type,a=e.id?"elfinder-notify-"+e.id:"",s=this.i18n(void 0!==e.msg?e.msg:this.messages["ntf"+o]?"ntf"+o:"ntfsmth"),l=this.arrayFlip(this.options.notifyDialog.hiddens||[]),c=this.ui.notify,d=c.closest(".ui-dialog"),u=c.children(".elfinder-notify-"+o+(a?"."+a:"")),p=u.children("div.elfinder-notify-cancel").children("button"),h='<div class="elfinder-notify elfinder-notify-{type}'+(a?" "+a:"")+'"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div><div class="elfinder-notify-cancel"/></div>',f=e.cnt+0,m=void 0!==e.size?parseInt(e.size):null,g=void 0!==e.progress&&e.progress>=0?e.progress:null,y=e.fakeinterval||200,v=e.cancel,b=function(){var e=u.find(".elfinder-notify-progress"),t=function(){u.remove(),c.children(d.data("minimized")?void 0:":visible").length||(d.data("minimized")?d.data("minimized").hide():c.elfinderdialog("close")),x()};u._esc&&$(document).off("keydown",u._esc),u.data("cur")<100?e.animate({width:"100%"},50,function(){requestAnimationFrame(function(){t()})}):t()},w=function(e){var t;u.length&&(t=u.data("cur")+1)<=98&&(u.find(".elfinder-notify-progress").width(t+"%"),u.data("cur",t),x(),setTimeout(function(){w(e*=1.05)},e))},x=function(){var e,t=0,n=0,i=c.children(".elfinder-notify");i.length?(i.each(function(){t++,n+=Math.min($(this).data("cur"),100)}),e=t?Math.floor(n/(100*t)*100)+"%":0,r.ui.progressbar.width(e),d.data("minimized")&&(d.data("minimized").title(e),d.data("minimized").dialog().children(".ui-dialog-titlebar").children(".elfinder-ui-progressbar").width(e))):(r.ui.progressbar.width(0),d.data("minimized")&&d.data("minimized").hide())};return o?(u.length?void 0!==e.msg&&u.children("span.elfinder-notify-msg").html(s):(u=$(h.replace(/\{type\}/g,o).replace(/\{msg\}/g,s)),l[o]?u.hide():c.on("minimize",function(e){d.data("minimized")&&x()}),u.appendTo(c).data("cnt",0),null!=g?u.data({progress:0,total:0,cur:0}):(u.data({cur:0}),w(y)),v&&(p=$('<span class="elfinder-notify-button ui-icon ui-icon-close" title="'+this.i18n("btnCancel")+'"/>').on("mouseenter mouseleave",function(e){$(this).toggleClass("ui-state-hover","mouseenter"===e.type)}),u.children("div.elfinder-notify-cancel").append(p)),c.trigger("resize")),(t=f+parseInt(u.data("cnt")))>0?(v&&p.length&&($.isFunction(v)||"object"==typeof v&&v.promise)&&(u._esc=function(e){"keydown"==e.type&&e.keyCode!=$.ui.keyCode.ESCAPE||(e.preventDefault(),e.stopPropagation(),b(),v.promise?v.reject(0):v(e))},p.on("click",function(e){u._esc(e)}),$(document).on("keydown."+this.namespace,u._esc)),!e.hideCnt&&u.children(".elfinder-notify-cnt").text("("+t+")"),f>0&&c.is(":hidden")&&!l[o]&&(d.data("minimized")?d.data("minimized").show():c.elfinderdialog("open",this).height("auto")),u.data("cnt",t),null!=g&&(n=u.data("total"))>=0&&(i=u.data("progress"))>=0&&(n+=null!=m?m:f,i+=g,null==m&&f<0&&(i+=100*f),u.data({progress:i,total:n}),null!=m&&(i*=100,n=Math.max(1,n)),g=Math.min(parseInt(i/n),100),u.find(".elfinder-notify-progress").animate({width:(g<100?g:100)+"%"},20,function(){u.data("cur",g),x()}))):b(),this):this},confirm:function(e){var t,n,i=this,r=!1,o={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(e.title||"confirmReq"),buttons:{},close:function(){!r&&e.cancel.callback(),$(this).elfinderdialog("destroy")}},a=this.i18n("apllyAll");return e.cssClass&&(o.cssClass+=" "+e.cssClass),o.buttons[this.i18n(e.accept.label)]=function(){e.accept.callback(!(!t||!t.prop("checked"))),r=!0,$(this).elfinderdialog("close")},o.buttons[this.i18n(e.accept.label)]._cssClass="elfinder-confirm-accept",e.reject&&(o.buttons[this.i18n(e.reject.label)]=function(){e.reject.callback(!(!t||!t.prop("checked"))),r=!0,$(this).elfinderdialog("close")},o.buttons[this.i18n(e.reject.label)]._cssClass="elfinder-confirm-reject"),e.buttons&&e.buttons.length>0&&(n=1,$.each(e.buttons,function(e,a){o.buttons[i.i18n(a.label)]=function(){a.callback(!(!t||!t.prop("checked"))),r=!0,$(this).elfinderdialog("close")},o.buttons[i.i18n(a.label)]._cssClass="elfinder-confirm-extbtn"+n++,a.cssClass&&(o.buttons[i.i18n(a.label)]._cssClass+=" "+a.cssClass)})),o.buttons[this.i18n(e.cancel.label)]=function(){$(this).elfinderdialog("close")},o.buttons[this.i18n(e.cancel.label)]._cssClass="elfinder-confirm-cancel",e.all&&(o.create=function(){var e=$('<div class="elfinder-dialog-confirm-applyall"/>');t=$('<input type="checkbox" />'),$(this).next().find(".ui-dialog-buttonset").prepend(e.append($("<label>"+a+"</label>").prepend(t)))}),e.optionsCallback&&$.isFunction(e.optionsCallback)&&e.optionsCallback(o),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(e.text),o)},uniqueName:function(e,t,n){var i,r,o=0,a="";if(e=this.i18n(!1,e),t=t||this.cwd().hash,n=void 0===n?" ":n,(i=e.match(/^(.+)(\.[^.]+)$/))&&(a=i[2],e=i[1]),r=e+a,!this.fileByName(r,t))return r;for(;o<1e4;)if(r=e+n+ ++o+a,!this.fileByName(r,t))return r;return e+Math.random()+a},i18n:function(){var e,t,n,i,r,o=this,a=this.messages,s=[],l=[],c=function(e){var t;return 0===e.indexOf("#")&&(t=o.file(e.substr(1)))?t.name:e},d=0;for(arguments.length&&!1===arguments[0]&&(i=function(e){return e},d=1),e=d;e<arguments.length;e++)if(n=arguments[e],Array.isArray(n))for(t=0;t<n.length;t++)n[t]instanceof jQuery?s.push(n[t]):void 0!==n[t]&&s.push(c(""+n[t]));else n instanceof jQuery?s.push(n[t]):void 0!==n&&s.push(c(""+n));for(e=0;e<s.length;e++)-1===$.inArray(e,l)&&("string"==typeof(n=s[e])?(r=!(!a[n]||!n.match(/^err/)),n=(n=a[n]||(i?i(n):o.escape(n))).replace(/\$(\d+)/g,function(t,n){var a;return(n=e+parseInt(n))>0&&s[n]&&l.push(n),a=i?i(s[n]):o.escape(s[n]),r&&(a='<span class="elfinder-err-var elfinder-err-var'+n+'">'+a+"</span>"),a})):n=n.get(0).outerHTML,s[e]=n);return $.grep(s,function(e,t){return-1===$.inArray(t,l)}).join("<br>")},getIconStyle:function(e,t){var n=this,i="",r={},o=0;return e.icon&&(i='style="',$.each({background:"url('{url}') 0 0 no-repeat","background-size":"contain"},function(a,s){0==o++&&(s=s.replace("{url}",n.escape(e.icon))),t?r[a]=s:i+=a+":"+s+";"}),i+='"'),t?r:i},mime2class:function(e){var t="elfinder-cwd-icon-",n=e.toLowerCase(),i=this.textMimes[n];return n=n.split("/"),i?n[0]+=" "+t+"text":n[1]&&n[1].match(/\+xml$/)&&(n[0]+=" "+t+"xml"),t+n[0]+(n[1]?" "+t+n[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(e){var t,n="object"==typeof e,i=n?e.mime:e;return n&&e.alias&&"symlink-broken"!=i?t="Alias":this.kinds[i]&&(t=!n||"directory"!==i||e.phash&&!e.isroot?this.kinds[i]:"Root"),t||(t=0===i.indexOf("text")?"Text":0===i.indexOf("image")?"Image":0===i.indexOf("audio")?"Audio":0===i.indexOf("video")?"Video":0===i.indexOf("application")?"App":i),this.messages["kind"+t]?this.i18n("kind"+t):i},mimeIsText:function(e){return!!(this.textMimes[e.toLowerCase()]||0===e.indexOf("text/")&&"rtf"!==e.substr(5,3)||e.match(/^application\/.+\+xml$/))},date:function(e,t){var n,i,r,o,a,s,l,c,d=this;return t||(t=new Date),a=t[d.getHours](),s=a>12?a-12:a,l=t[d.getMinutes](),c=t[d.getSeconds](),n=t[d.getDate](),i=t[d.getDay](),r=t[d.getMonth]()+1,o=t[d.getFullYear](),e.replace(/[a-z]/gi,function(e){switch(e){case"d":return n>9?n:"0"+n;case"j":return n;case"D":return d.i18n(d.i18.daysShort[i]);case"l":return d.i18n(d.i18.days[i]);case"m":return r>9?r:"0"+r;case"n":return r;case"M":return d.i18n(d.i18.monthsShort[r-1]);case"F":return d.i18n(d.i18.months[r-1]);case"Y":return o;case"y":return(""+o).substr(2);case"H":return a>9?a:"0"+a;case"G":return a;case"g":return s;case"h":return s>9?s:"0"+s;case"a":return a>=12?"pm":"am";case"A":return a>=12?"PM":"AM";case"i":return l>9?l:"0"+l;case"s":return c>9?c:"0"+c}return e})},formatDate:function(e,t){var n,i,r,o=this,a=t||e.ts;o.i18;return o.options.clientFormatDate&&a>0?(n=new Date(1e3*a),i=a>=this.yesterday?this.fancyFormat:this.dateFormat,r=o.date(i,n),a>=this.yesterday?r.replace("$1",this.i18n(a>=this.today?"Today":"Yesterday")):r):e.date?e.date.replace(/([a-z]+)\s/i,function(e,t){return o.i18n(t)+" "}):o.i18n("dateUnknown")},toLocaleString:function(e){var t=new Number(e);return t?t.toLocaleString?t.toLocaleString():String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):e},perms2class:function(e){var t="";return e.read||e.write?e.read?e.write||(t="elfinder-ro"):t="elfinder-wo":t="elfinder-na",e.type&&(t+=" elfinder-"+this.escape(e.type)),t},formatPermissions:function(e){var t=[];return e.read&&t.push(this.i18n("read")),e.write&&t.push(this.i18n("write")),t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(e){var t=1,n="b";return"unknown"==e?this.i18n("unknown"):(e>1073741824?(t=1073741824,n="GB"):e>1048576?(t=1048576,n="MB"):e>1024&&(t=1024,n="KB"),((e/=t)>0?t>=1048576?e.toFixed(2):Math.round(e):0)+" "+n)},formatFileMode:function(e,t){var n,i,r,o,a,s,l,c;if(t||(t=this.options.fileModeStyle.toLowerCase()),(e=$.trim(e)).match(/[rwxs-]{9}$/i)){if(l=e=e.substr(-9),"string"==t)return l;for(c="",r=0,n=0;n<7;n+=3)o=0,(i=e.substr(n,3)).match(/[r]/i)&&(o+=4),i.match(/[w]/i)&&(o+=2),i.match(/[xs]/i)&&(i.match(/[xs]/)&&(o+=1),i.match(/[s]/i)&&(0==n?r+=4:3==n&&(r+=2))),c+=o.toString(8);r&&(c=r.toString(8)+c)}else{if(c=(e=parseInt(e,8))?e.toString(8):"",!e||"octal"==t)return c;for(r=0,(i=e.toString(8)).length>3&&(i=i.substr(-4),r=parseInt(i.substr(0,1),8),i=i.substr(1)),1==(1&r),s=2==(2&r),a=4==(4&r),l="",n=0;n<3;n++)4==(4&parseInt(i.substr(n,1),8))?l+="r":l+="-",2==(2&parseInt(i.substr(n,1),8))?l+="w":l+="-",1==(1&parseInt(i.substr(n,1),8))?l+=0==n&&a||1==n&&s?"s":"x":l+="-"}return"both"==t?l+" ("+c+")":"string"==t?l:c},registRawStringDecoder:function(e){$.isFunction(e)&&(this.decodeRawString=this.options.rawStringDecoder=e)},uploadMimeCheck:function(e,t){t=t||this.cwd().hash;var n,i,r=!0,o=this.option("uploadMime",t),a=function(t){var n=!1;return"string"==typeof t&&"all"===t.toLowerCase()?n=!0:Array.isArray(t)&&t.length&&$.each(t,function(t,i){if("all"===(i=i.toLowerCase())||0===e.indexOf(i))return n=!0,!1}),n};return e&&$.isPlainObject(o)&&(e=e.toLowerCase(),n=a(o.allow),i=a(o.deny),"allow"===o.firstOrder?(r=!1,i||!0!==n||(r=!0)):(r=!0,!0!==i||n||(r=!1))),r},sequence:function(e){var t=function(n,i){return e[++i]?t(n.then(e[i]),i):n};return e.length>1?t(e[0](),0):e[0]()},reloadContents:function(e){var t,n=$.Deferred();try{t=$('<iframe width="1" height="1" scrolling="no" frameborder="no" style="position:absolute; top:-1px; left:-1px" crossorigin="use-credentials">').attr("src",e).one("load",function(){var t=$(this);try{this.contentDocument.location.reload(!0),t.one("load",function(){t.remove(),n.resolve()})}catch(i){t.attr("src","").attr("src",e).one("load",function(){t.remove(),n.resolve()})}}).appendTo("body")}catch(e){t&&t.remove(),n.reject()}return n},makeNetmountOptionOauth:function(e,t,n,i){var r,o="boolean"==typeof i?i:null,a=Object.assign({noOffline:!1,root:"root",pathI18n:"folderId",folders:!0},null===o?i||{}:{noOffline:o}),s=function(t,i,o){var c,d=this,u=Object.keys($.isPlainObject(o)?o:{}).length;i.next().remove(),u&&(c=$('<select class="ui-corner-all elfinder-tabstop" style="max-width:200px;">').append($($.map(o,function(e,n){return'<option value="'+t.escape((n+"").trim())+'">'+t.escape(e)+"</option>"}).join(""))).on("change click",function(i){var o,c=$(this),u=c.val();d.inputs.path.val(u),!a.folders||"change"!==i.type&&c.data("current")===u||(c.next().remove(),c.data("current",u),u!=a.root&&(o=l(),r&&"pending"===r.state()&&t.abortXHR(r,{quiet:!0,abort:!0}),c.after(o),r=t.request({data:{cmd:"netmount",protocol:e,host:n,user:"init",path:u,pass:"folders"},preventDefault:!0}).done(function(e){s.call(d,t,c,e.folders)}).always(function(){t.abortXHR(r,{quiet:!0}),o.remove()}).xhr))}),i.after($("<div/>").append(c)).closest(".ui-dialog").trigger("tabstopsInit"),c.trigger("focus"))},l=function(){return $('<div class="elfinder-netmount-spinner"/>').append('<span class="elfinder-spinner"/>')};return{vars:{},name:t,inputs:{offline:$('<input type="checkbox"/>').on("change",function(){$(this).parents("table.elfinder-netmount-tb").find("select:first").trigger("change","reset")}),host:$('<span><span class="elfinder-spinner"/></span><input type="hidden"/>'),path:$('<input type="text" value="'+a.root+'"/>'),user:$('<input type="hidden"/>'),pass:$('<input type="hidden"/>'),mnt2res:$('<input type="hidden"/>')},select:function(t,i,r){var o=this.inputs,s=o.offline,l=$(o.host[0]),c=r||null;this.vars.mbtn=o.host.closest(".ui-dialog").children(".ui-dialog-buttonpane:first").find("button.elfinder-btncnt-0"),l.data("inrequest")||!l.find("span.elfinder-spinner").length&&"reset"!==c&&("winfocus"!==c||l.siblings("span.elfinder-button-icon-reload").length)?(s.closest("tr")[a.noOffline||o.user.val()?"hide":"show"](),l.data("funcexpup")&&l.data("funcexpup")()):(1===s.parent().children().length&&(o.path.parent().prev().html(t.i18n(a.pathI18n)),s.attr("title",t.i18n("offlineAccess")),s.uniqueId().after($("<label/>").attr("for",s.attr("id")).html(" "+t.i18n("offlineAccess")))),l.data("inrequest",!0).empty().addClass("elfinder-spinner").parent().find("span.elfinder-button-icon").remove(),t.request({data:{cmd:"netmount",protocol:e,host:n,user:"init",options:{id:t.id,offline:s.prop("checked")?1:0,pass:o.host[1].value}},preventDefault:!0}).done(function(e){l.removeClass("elfinder-spinner").html(e.body.replace(/\{msg:([^}]+)\}/g,function(e,i){return t.i18n(i,n)}))}),a.noOffline&&s.closest("tr").hide()),this.vars.mbtn[$(o.host[1]).val()?"show":"hide"]()},done:function(t,i){var r,o=this.inputs,l=this.protocol,c=$(o.host[0]),d=$(o.host[1]),u="&nbsp;",p=this.vars,h=function(){p.oauthW&&!document.hasFocus()&&--p.chkCnt&&(l.trigger("change","winfocus"),p.tm=setTimeout(h,3e3))};if(a.noOffline&&o.offline.closest("tr").hide(),"makebtn"==i.mode)c.removeClass("elfinder-spinner").removeData("expires").removeData("funcexpup"),r=o.host.find("input").on("mouseenter mouseleave",function(){$(this).toggleClass("ui-state-hover")}),i.url&&r.on("click",function(){p.tm&&clearTimeout(p.tm),p.oauthW=window.open(i.url),(t.UA.iOS||t.UA.Mac)&&t.isCORS&&!p.chkdone&&(p.chkCnt=60,p.tm=setTimeout(h,5e3))}),d.val(""),o.path.val(a.root).next().remove(),o.user.val(""),o.pass.val(""),!a.noOffline&&o.offline.closest("tr").show(),p.mbtn.hide();else if("folders"==i.mode)i.folders&&s.call(this,t,o.path.nextAll(":last"),i.folders);else{if(p.oauthW&&(p.tm&&clearTimeout(p.tm),p.oauthW.close(),delete p.oauthW,p.chkdone=!0),i.expires&&(u="()",c.data("expires",i.expires)),c.html(n+u).removeClass("elfinder-spinner"),i.expires&&(c.data("funcexpup",function(){var e=Math.floor((c.data("expires")-+new Date/1e3)/60);e<3?c.parent().children(".elfinder-button-icon-reload").click():(c.text(c.text().replace(/\(.*\)/,"("+t.i18n(["minsLeft",e])+")")),setTimeout(function(){c.is(":visible")&&c.data("funcexpup")()},6e4))}),c.data("funcexpup")()),i.reset)return void l.trigger("change","reset");c.parent().append($('<span class="elfinder-button-icon elfinder-button-icon-reload" title="'+t.i18n("reAuth")+'">').on("click",function(){d.val("reauth"),l.trigger("change","reset")})),d.val(e),p.mbtn.show(),i.folders&&s.call(this,t,o.path,i.folders),i.mnt2res&&o.mnt2res.val("1"),o.user.val("done"),o.pass.val("done"),o.offline.closest("tr").hide()}c.removeData("inrequest")},fail:function(e,t){$(this.inputs.host[0]).removeData("inrequest"),this.protocol.trigger("change","reset")},integrateInfo:a.integrate}},findCwdNodes:function(e,t){var n=this,i=(this.getUI("cwd"),this.cwd().hash),r=$();return t=t||{},$.each(e,function(e,o){if((o.phash===i||n.searchStatus.state>1)&&(r=r.add(n.cwdHash2Elm(o.hash)),t.firstOnly))return!1}),r},convAbsUrl:function(e){if(e.match(/^http/i))return e;if("//"===e.substr(0,2))return window.location.protocol+e;var t,n=window.location.protocol+"//"+window.location.host,i=/[^\/]+\/\.\.\//;for(t=(t="/"===e.substr(0,1)?n+e:n+window.location.pathname.replace(/\/[^\/]+$/,"/")+e).replace("/./","/");i.test(t);)t=t.replace(i,"");return t},isSameOrigin:function(e){var t;if(e=this.convAbsUrl(e),location.origin&&window.URL)try{return t=new URL(e),location.origin===t.origin}catch(e){}return(t=document.createElement("a")).href=e,location.protocol===t.protocol&&location.host===t.host&&location.port&&t.port},navHash2Id:function(e){return this.navPrefix+e},navId2Hash:function(e){return"string"==typeof e&&e.substr(this.navPrefix.length)},cwdHash2Id:function(e){return this.cwdPrefix+e},cwdId2Hash:function(e){return"string"==typeof e&&e.substr(this.cwdPrefix.length)},navHash2Elm:function(e){return $(document.getElementById(this.navHash2Id(e)))},cwdHash2Elm:function(e){return $(document.getElementById(this.cwdHash2Id(e)))},isInWindow:function(e,t){var n,i;return!!(n=e.get(0))&&(!(!t&&null===n.offsetParent)&&(i=n.getBoundingClientRect(),!!document.elementFromPoint(i.left,i.top)))},zIndexCalc:function(){var e=this,t=this.getUI(),n=t.css("z-index");n&&"auto"!==n&&"inherit"!==n?e.zIndex=n:t.parents().each(function(t,n){var i=$(n).css("z-index");if("auto"!==i&&"inherit"!==i&&(i=parseInt(i)))return e.zIndex=i,!1})},loadScript:function(e,t,n,i){var r,o,a={dataType:"script",cache:!0},s={},l={};return(n=n||{}).tryRequire&&this.hasRequire?require(e,t,n.error):(r=function(){var e,r,o;$.each(l,function(e,t){if("success"!==t&&"notmodified"!==t)return o=!0,!1}),o?n.error&&$.isFunction(n.error)&&n.error({loadResults:l}):$.isFunction(t)&&(i&&void 0===i.obj[i.name]?(e=i.timeout?i.timeout/10:1,r=setInterval(function(){(--e<0||void 0!==i.obj[i.name])&&(clearInterval(r),t())},10)):t())},"tag"===n.loadType?($("head > script").each(function(){s[this.src]=this}),o=e.length,$.each(e,function(e,t){var i,a=!1;s[t]?(l[e]=s[t]._error||"success",--o<1&&r()):((i=document.createElement("script")).charset=n.charset||"UTF-8",$("head").append(i),i.onload=i.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,l[e]="success",--o<1&&r())},i.onerror=function(t){l[e]=i._error=t&&t.type?t.type:"error",--o<1&&r()},i.src=t)})):(n=$.isPlainObject(n)?Object.assign(a,n):a,o=0,function t(i,a){void 0!==i&&(l[o++]=a),e.length?$.ajax(Object.assign({},n,{url:e.shift(),success:t,error:t})):r()}())),this},loadCss:function(e,t){var n,i,r=this;return"string"==typeof e&&(e=[e]),t&&(t.className&&(n=t.className),t.dfd&&t.dfd.promise&&(i=[])),$.each(e,function(e,t){var o;t=r.convAbsUrl(t).replace(/^https?:/i,""),i&&(i[e]=$.Deferred()),$('head > link[href="'+r.escape(t)+'"]').length?i&&i[e].resolve():((o=document.createElement("link")).type="text/css",o.rel="stylesheet",o.href=t,n&&(o.className=n),i&&(o.onload=function(){i[e].resolve()},o.onerror=function(){i[e].reject()}),$("head").append(o))}),i&&$.when.apply(null,i).done(function(){t.dfd.resolve()}).fail(function(){t.dfd.reject()}),this},asyncJob:function(e,t,n){var i,r,o=$.Deferred(),a=!1,s=Object.assign({interval:0,numPerOnce:1},n||{}),l=[],c=[],d=[];return o._abort=function(e){r&&clearTimeout(r),c=[],a=!0,"pending"===o.state()&&o[e?"resolve":"reject"](l)},o.fail(function(){o._abort()}).always(function(){o._abort=function(){}}),"function"==typeof e&&Array.isArray(t)?(c=t.concat(),i=function(){var t,n,u;if(!a){for(n=(d=c.splice(0,s.numPerOnce)).length,t=0;t<n&&!a;t++)null!==(u=e(d[t]))&&l.push(u);a||(c.length?r=setTimeout(i,s.interval):o.resolve(l))}},c.length?r=setTimeout(i,0):o.resolve(l)):o.reject(),o},getSize:function(e){var t,n,i=this,r=[],o=e.length,a=$.Deferred().fail(function(){$.each(r,function(e,t){t&&(t.syncOnFail&&t.syncOnFail(!1),t.reject())})});return i.autoSync("stop"),(t=$.Deferred(),n=Object.keys(i.leafRoots).length,n>0?$.each(i.leafRoots,function(e){(function(e){var t=$.Deferred(),n=i.file(e),r=n?n.phash:e;return r&&!i.file(r)?i.request({data:{cmd:"parents",target:r},preventFail:!0}).done(function(){i.one("parentsdone",function(){t.resolve()})}).fail(function(){t.resolve()}):t.resolve(),t})(e).done(function(){--n<1&&t.resolve()})}):t.resolve(),t).done(function(){var t=[],n={},s=[],l=[],c={};$.each(e,function(){var e,n;t.push.apply(t,(e=i.file(this),n=[],"directory"===e.mime&&$.each(i.leafRoots,function(t,r){var o;if(t===e.hash)n.push.apply(n,r);else for(o=(i.file(t)||{}).phash;o;)o===e.hash&&n.push.apply(n,r),o=(i.file(o)||{}).phash}),n))}),e.push.apply(e,t),$.each(e,function(){var e=i.root(this),t=i.file(this);t&&(t.sizeInfo||"directory"!==t.mime)?l.push($.Deferred().resolve(t.sizeInfo?t.sizeInfo:{size:t.size,dirCnt:0,fileCnt:1})):n[e]?n[e].push(this.toString()):n[e]=[this.toString()]}),$.each(n,function(){var e=s.length;1===this.length&&(c[e]=this[0]),s.push(i.request({data:{cmd:"size",targets:this},preventDefault:!0}))}),r.push.apply(r,s),s.push.apply(s,l),$.when.apply($,s).fail(function(){a.reject()}).done(function(){var e,t,n=function(e,t){var n;(n=i.file(e))&&(n.sizeInfo={isCache:!0},$.each(["size","dirCnt","fileCnt"],function(){n.sizeInfo[this]=t[this]||0}),n.size=parseInt(n.sizeInfo.size),h.push(n))},r=0,s=0,l=0,d=arguments.length,u=[],p="",h=[];for(e=0;e<d;e++)null,(t=arguments[e]).isCache||(c[e]&&i.file(c[e])?n(c[e],t):t.sizes&&$.isPlainObject(t.sizes)&&$.each(t.sizes,function(e,t){n(e,t)})),r+=parseInt(t.size),!1!==s&&(void 0===t.fileCnt?s=!1:s+=parseInt(t.fileCnt||0)),!1!==l&&(void 0===t.dirCnt?l=!1:l+=parseInt(t.dirCnt||0));h.length&&i.change({changed:h}),!1!==l&&u.push(i.i18n("folders")+": "+(l-(o>1?0:1))),!1!==s&&u.push(i.i18n("files")+": "+s),u.length&&(p="<br>"+u.join(", ")),a.resolve({size:r,fileCnt:s,dirCnt:l,formated:(r>=0?i.formatSize(r):i.i18n("unknown"))+p})}),i.autoSync()}),a},wkObjUrl:null,getWorker:function(e){var t;try{this.wkObjUrl||(this.wkObjUrl=(window.URL||window.webkitURL).createObjectURL(new Blob([function(){self.onmessage=function(e){var t=e.data;try{if(self.data=t.data,t.scripts)for(var n=0;n<t.scripts.length;n++)importScripts(t.scripts[n]);self.postMessage(self.res)}catch(e){self.postMessage({error:e.toString()})}}}.toString().replace(/\s+/g," ").replace(/ *([^\w]) */g,"$1").replace(/^function\b.+?\{|\}$/g,"")],{type:"text/javascript"}))),t=new Worker(this.wkObjUrl,e)}catch(e){this.debug("error",e.toString())}return t},getWorkerUrl:function(e){return this.convAbsUrl(this.baseUrl+"js/worker/"+e)},getTheme:function(e){var t,n,i=this,r=$.Deferred(),o=function(e,t){return t||(t=i.convAbsUrl(i.baseUrl)),Array.isArray(e)?$.map(e,function(e){return o(e,t)}):e.match(/^(?:http|\/\/)/i)?e:t+e.replace(/^(?:\.\/|\/)/,"")};return e&&(t=i.options.themes[e])?"string"==typeof t?(url=o(t),(n=url.match(/^(.+\/)[^/]+\.json$/i))?$.getJSON(url).done(function(i){(t=i).id=e,t.cssurls&&(t.cssurls=o(t.cssurls,n[1])),r.resolve(t)}).fail(function(){r.reject()}):r.resolve({id:e,name:e,cssurls:[url]})):$.isPlainObject(t)&&t.cssurls?(t.id=e,t.cssurls=o(t.cssurls),Array.isArray(t.cssurls)||(t.cssurls=[t.cssurls]),t.name||(t.name=e),r.resolve(t)):r.reject():r.reject(),r},changeTheme:function(e){var t=this;return e&&(!t.options.themes[e]||t.theme&&t.theme.id===e?"default"===e&&t.theme&&"default"!==t.theme.id&&($("head>link.elfinder-theme-ext").remove(),t.theme=null,t.trigger&&t.trigger("themechange")):t.getTheme(e).done(function(e){e.cssurls&&($("head>link.elfinder-theme-ext").remove(),t.loadCss(e.cssurls,{className:"elfinder-theme-ext",dfd:$.Deferred().done(function(){t.theme=e,t.trigger&&t.trigger("themechange")})}))})),this},applyLeafRootStats:function(e,t){var n=this,i=t?e:n.file(e.hash)||e,r=i.ts,o=!1;return!t&&e._realStats||(e._realStats={locked:e.locked||0,dirs:e.dirs||0,ts:e.ts}),e.locked=1,i.locked||(o=!0),e.dirs=1,i.dirs||(o=!0),$.each(n.leafRoots[e.hash],function(){var t=n.file(this);t&&t.ts&&(e.ts||0)<t.ts&&(e.ts=t.ts)}),r!==e.ts&&(o=!0),o},abortXHR:function(e,t){var n=t||{};e&&(n.quiet&&(e.quiet=!0),n.abort&&e._requestId&&this.request({data:{cmd:"abort",id:e._requestId},preventDefault:!0}),e=void 0)},setCustomHeaderByXhr:function(e){var t=this;e.getResponseHeader&&t.parrotHeaders&&t.parrotHeaders.length&&$.each(t.parrotHeaders,function(n,i){var r=e.getResponseHeader(i);r?(t.customHeaders[i]=r,t.sessionStorage("core-ph:"+i,r)):"string"==typeof r&&(delete t.customHeaders[i],t.sessionStorage("core-ph:"+i,null))})},hasParrotHeaders:function(){var e=!1,t=this.parrotHeaders;if(Object.keys(this.customHeaders).length)for(var n=0;n<t.length;n++)if(this.customHeaders[t[n]]){e=!0;break}return e},getRequestId:function(){return(+new Date).toString(16)+Math.floor(1e3*Math.random()).toString(16)},arrayFlip:function(e,t){var n,i={},r=$.isArray(e);for(n in e)(r||e.hasOwnProperty(n))&&(i[e[n]]=t||n);return i},splitFileExtention:function(e){var t;return(t=e.match(/^(.+?)?\.((?:tar\.(?:gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(?:gz|bz2)|[a-z0-9]{1,10})$/i))?(void 0===t[1]&&(t[1]=""),[t[1],t[2]]):[e,""]},sliceArrayBuffer:function(e,t){for(var n=[],i=0;i*t<e.byteLength;)n.push(e.slice(i*t,(i+1)*t)),i++;return n},arrayBufferToBase64:function(e){if(!window.btoa)return"";var t=new Uint8Array(e),n=Array.prototype.slice.call(t).map(function(e){return String.fromCharCode(e)});return window.btoa(n.join(""))},log:function(e){return window.console&&window.console.log&&window.console.log(e),this},debug:function(e,t){var n,i,r=this,o=this.options.debug,a=this.options.toastBackendWarn;return"backend-error"===e?(!this.cwd().hash||o&&("all"===o||o["backend-error"]))&&(t=Array.isArray(t)?t:[t],this.error(t)):"backend-warning"===e?(i=!0,a&&(n=$.isPlainObject(a)?a:{},$.each(Array.isArray(t)?t:[t],function(e,t){r.toast(Object.assign({mode:"warning",msg:t},n))}))):"backend-debug"===e&&this.trigger("backenddebug",t),(i||o&&("all"===o||o[e]))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+e+"] ["+this.id+"]",t),this},responseDebug:function(e){var t,n=e.debug;n&&((t=this.options.debug)&&"all"===t||(t||(t=this.options.debug={}),t["backend-error"]=!0,t.warning=!0),n.mountErrors&&("string"==typeof n.mountErrors||Array.isArray(n.mountErrors)&&n.mountErrors.length)&&this.debug("backend-error",n.mountErrors),n.backendErrors&&("string"==typeof n.backendErrors||Array.isArray(n.backendErrors)&&n.backendErrors.length)&&this.debug("backend-warning",n.backendErrors))},time:function(e){window.console&&window.console.time&&window.console.time(e)},timeEnd:function(e){window.console&&window.console.timeEnd&&window.console.timeEnd(e)}},Object.keys||(Object.keys=(s=Object.prototype.hasOwnProperty,l=!{toString:null}.propertyIsEnumerable("toString"),d=(c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)s.call(e,n)&&t.push(n);if(l)for(var i=0;i<d;i++)s.call(e,c[i])&&t.push(c[i]);return t})),Array.isArray||(Array.isArray=function(e){return jQuery.isArray(e)}),Object.assign||(Object.assign=function(){return jQuery.extend.apply(null,arguments)}),String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";if(null==this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var n="",i=0;i<e;i++)n+=t;return n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){try{return void Array.apply(null,{})}catch(e){}var e=Object.prototype.toString,t=Function.prototype.apply,n=Array.prototype.slice;Function.prototype.apply=function(i,r){return t.call(this,i,"[object Array]"===e.call(r)?r:n.call(r))}}(),Array.from||(Array.from=function(e){return 1===e.length?[e[0]]:Array.apply(null,e)}),window.cancelAnimationFrame||function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+r)},r);return e=i+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),u});
//# sourceMappingURL=sourcemaps/elFinder.js.map
