{"version":3,"sources":["commands/chmod.js"],"names":["define","elFinder","prototype","commands","chmod","this","updateOnSelect","fm","level","0","1","2","msg","read","i18n","write","execute","perm","kind","files","isPerm","isNaN","parseInt","match","tpl","main","itemTitle","groupTitle","dataTable","fieldset","shortcuts","getstate","sel","selected","length","cwd","hash","checkstate","cnt","chk","$","grep","f","isowner","mime","exec","select","hashes","title","dfrd","Deferred","always","enable","file","id","namespace","view","checked","save","reqData","trim","val","dialog","elfinderdialog","cmd","targets","mode","request","data","notify","type","fail","error","reject","done","changed","undo","callback","reqs","each","prevVals","push","when","apply","redo","resolve","setperm","_perm","i","is","toString","getPerm","mode_array","split","a","l","splice","b_array","join","c","j","m","p","opts","width","buttons","close","getUI","find","tmb","replace","mime2class","name","mime2kind","value","slice","makeDataTable","_chk","ret","len","i2","makeperm","fmDialog","attr","on","addClass","className","css","url","e","keyCode","ui","ENTER","stopPropagation","trigger","prop","setcheck"],"mappings":"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","file":"../../commands/chmod.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.chmod = function() {\n\t\t\"use strict\";\n\t\tthis.updateOnSelect = false;\n\t\tvar fm  = this.fm,\n\t\t\tlevel = {\n\t\t\t\t0 : 'owner',\n\t\t\t\t1 : 'group',\n\t\t\t\t2 : 'other'\n\t\t\t},\n\t\t\tmsg = {\n\t\t\t\tread     : fm.i18n('read'),\n\t\t\t\twrite    : fm.i18n('write'),\n\t\t\t\texecute  : fm.i18n('execute'),\n\t\t\t\tperm     : fm.i18n('perm'),\n\t\t\t\tkind     : fm.i18n('kind'),\n\t\t\t\tfiles    : fm.i18n('files')\n\t\t\t},\n\t\t\tisPerm = function(perm){\n\t\t\t\treturn (!isNaN(parseInt(perm, 8) && parseInt(perm, 8) <= 511) || perm.match(/^([r-][w-][x-]){3}$/i));\n\t\t\t};\n\n\t\tthis.tpl = {\n\t\t\tmain       : '<div class=\"ui-helper-clearfix elfinder-info-title\"><span class=\"elfinder-cwd-icon {class} ui-corner-all\"/>{title}</div>'\n\t\t\t\t\t\t+'{dataTable}',\n\t\t\titemTitle  : '<strong>{name}</strong><span id=\"elfinder-info-kind\">{kind}</span>',\n\t\t\tgroupTitle : '<strong>{items}: {num}</strong>',\n\t\t\tdataTable  : '<table id=\"{id}-table-perm\"><tr><td>{0}</td><td>{1}</td><td>{2}</td></tr></table>'\n\t\t\t\t\t\t+'<div class=\"\">'+msg.perm+': <input class=\"elfinder-tabstop elfinder-focus\" id=\"{id}-perm\" type=\"text\" size=\"4\" maxlength=\"3\" value=\"{value}\"></div>',\n\t\t\tfieldset   : '<fieldset id=\"{id}-fieldset-{level}\"><legend>{f_title}{name}</legend>'\n\t\t\t\t\t\t+'<input type=\"checkbox\" value=\"4\" class=\"elfinder-tabstop\" id=\"{id}-read-{level}-perm\"{checked-r}> <label for=\"{id}-read-{level}-perm\">'+msg.read+'</label><br>'\n\t\t\t\t\t\t+'<input type=\"checkbox\" value=\"6\" class=\"elfinder-tabstop\" id=\"{id}-write-{level}-perm\"{checked-w}> <label for=\"{id}-write-{level}-perm\">'+msg.write+'</label><br>'\n\t\t\t\t\t\t+'<input type=\"checkbox\" value=\"5\" class=\"elfinder-tabstop\" id=\"{id}-execute-{level}-perm\"{checked-x}> <label for=\"{id}-execute-{level}-perm\">'+msg.execute+'</label><br>'\n\t\t};\n\n\t\tthis.shortcuts = [{\n\t\t\t//pattern     : 'ctrl+p'\n\t\t}];\n\n\t\tthis.getstate = function(sel) {\n\t\t\tvar fm = this.fm;\n\t\t\tsel = sel || fm.selected();\n\t\t\tif (sel.length == 0) {\n\t\t\t\tsel = [ fm.cwd().hash ];\n\t\t\t}\n\t\t\treturn this.checkstate(this.files(sel)) ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.checkstate = function(sel) {\n\t\t\tvar cnt = sel.length;\n\t\t\tif (!cnt) return false;\n\t\t\tvar chk = $.grep(sel, function(f) {\n\t\t\t\treturn (f.isowner && f.perm && isPerm(f.perm) && (cnt == 1 || f.mime != 'directory')) ? true : false;\n\t\t\t}).length;\n\t\t\treturn (cnt == chk)? true : false;\n\t\t};\n\n\t\tthis.exec = function(select) {\n\t\t\tvar hashes  = this.hashes(select),\n\t\t\t\tfiles   = this.files(hashes);\n\t\t\tif (! files.length) {\n\t\t\t\thashes = [ this.fm.cwd().hash ];\n\t\t\t\tfiles   = this.files(hashes);\n\t\t\t}\n\t\t\tvar fm  = this.fm,\n\t\t\tdfrd    = $.Deferred().always(function() {\n\t\t\t\tfm.enable();\n\t\t\t}),\n\t\t\ttpl     = this.tpl,\n\t\t\tcnt     = files.length,\n\t\t\tfile    = files[0],\n\t\t\tid = fm.namespace + '-perm-' + file.hash,\n\t\t\tview    = tpl.main,\n\t\t\tchecked = ' checked=\"checked\"',\n\t\t\tbuttons = function() {\n\t\t\t\tvar buttons = {};\n\t\t\t\tbuttons[fm.i18n('btnApply')] = save;\n\t\t\t\tbuttons[fm.i18n('btnCancel')] = function() { dialog.elfinderdialog('close'); };\n\t\t\t\treturn buttons;\n\t\t\t},\n\t\t\tsave = function() {\n\t\t\t\tvar perm = $.trim($('#'+id+'-perm').val()),\n\t\t\t\t\treqData;\n\t\t\t\t\n\t\t\t\tif (!isPerm(perm)) return false;\n\t\t\t\t\n\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\n\t\t\t\treqData = {\n\t\t\t\t\tcmd     : 'chmod',\n\t\t\t\t\ttargets : hashes,\n\t\t\t\t\tmode    : perm\n\t\t\t\t};\n\t\t\t\tfm.request({\n\t\t\t\t\tdata : reqData,\n\t\t\t\t\tnotify : {type : 'chmod', cnt : cnt}\n\t\t\t\t})\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tif (data.changed && data.changed.length) {\n\t\t\t\t\t\tdata.undo = {\n\t\t\t\t\t\t\tcmd : 'chmod',\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\tvar reqs = [];\n\t\t\t\t\t\t\t\t$.each(prevVals, function(perm, hashes) {\n\t\t\t\t\t\t\t\t\treqs.push(fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'chmod', targets : hashes, mode : perm},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'undo', cnt : hashes.length}\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn $.when.apply(null, reqs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdata.redo = {\n\t\t\t\t\t\t\tcmd : 'chmod',\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\tdata : reqData,\n\t\t\t\t\t\t\t\t\tnotify : {type : 'redo', cnt : hashes.length}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetperm = function() {\n\t\t\t\tvar perm = '';\n\t\t\t\tvar _perm;\n\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t_perm = 0;\n\t\t\t\t\tif ($(\"#\"+id+\"-read-\"+level[i]+'-perm').is(':checked')) {\n\t\t\t\t\t\t_perm = (_perm | 4);\n\t\t\t\t\t}\n\t\t\t\t\tif ($(\"#\"+id+\"-write-\"+level[i]+'-perm').is(':checked')) {\n\t\t\t\t\t\t_perm = (_perm | 2);\n\t\t\t\t\t}\n\t\t\t\t\tif ($(\"#\"+id+\"-execute-\"+level[i]+'-perm').is(':checked')) {\n\t\t\t\t\t\t_perm = (_perm | 1);\n\t\t\t\t\t}\n\t\t\t\t\tperm += _perm.toString(8);\n\t\t\t\t}\n\t\t\t\t$('#'+id+'-perm').val(perm);\n\t\t\t},\n\t\t\tsetcheck = function(perm) {\n\t\t\t\tvar _perm;\n\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t_perm = parseInt(perm.slice(i, i+1), 8);\n\t\t\t\t\t$(\"#\"+id+\"-read-\"+level[i]+'-perm').prop(\"checked\", false);\n\t\t\t\t\t$(\"#\"+id+\"-write-\"+level[i]+'-perm').prop(\"checked\", false);\n\t\t\t\t\t$(\"#\"+id+\"-execute-\"+level[i]+'-perm').prop(\"checked\", false);\n\t\t\t\t\tif ((_perm & 4) == 4) {\n\t\t\t\t\t\t$(\"#\"+id+\"-read-\"+level[i]+'-perm').prop(\"checked\", true);\n\t\t\t\t\t}\n\t\t\t\t\tif ((_perm & 2) == 2) {\n\t\t\t\t\t\t$(\"#\"+id+\"-write-\"+level[i]+'-perm').prop(\"checked\", true);\n\t\t\t\t\t}\n\t\t\t\t\tif ((_perm & 1) == 1) {\n\t\t\t\t\t\t$(\"#\"+id+\"-execute-\"+level[i]+'-perm').prop(\"checked\", true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsetperm();\n\t\t\t},\n\t\t\tmakeperm = function(files) {\n\t\t\t\tvar perm = '777', ret = '', chk, _chk, _perm;\n\t\t\t\tvar len = files.length;\n\t\t\t\tfor (var i2 = 0; i2 < len; i2++) {\n\t\t\t\t\tchk = getPerm(files[i2].perm);\n\t\t\t\t\tif (! prevVals[chk]) {\n\t\t\t\t\t\tprevVals[chk] = [];\n\t\t\t\t\t}\n\t\t\t\t\tprevVals[chk].push(files[i2].hash);\n\t\t\t\t\tret = '';\n\t\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t\t_chk = parseInt(chk.slice(i, i+1), 8);\n\t\t\t\t\t\t_perm = parseInt(perm.slice(i, i+1), 8);\n\t\t\t\t\t\tif ((_chk & 4) != 4 && (_perm & 4) == 4) {\n\t\t\t\t\t\t\t_perm -= 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((_chk & 2) != 2 && (_perm & 2) == 2) {\n\t\t\t\t\t\t\t_perm -= 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((_chk & 1) != 1 && (_perm & 1) == 1) {\n\t\t\t\t\t\t\t_perm -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tret += _perm.toString(8);\n\t\t\t\t\t}\n\t\t\t\t\tperm = ret;\n\t\t\t\t}\n\t\t\t\treturn perm;\n\t\t\t},\n\t\t\tmakeName = function(name) {\n\t\t\t\treturn name? ':'+name : '';\n\t\t\t},\n\t\t\tmakeDataTable = function(perm, f) {\n\t\t\t\tvar _perm, fieldset;\n\t\t\t\tvar value = '';\n\t\t\t\tvar dataTable = tpl.dataTable;\n\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t_perm = parseInt(perm.slice(i, i+1), 8);\n\t\t\t\t\tvalue += _perm.toString(8);\n\t\t\t\t\tfieldset = tpl.fieldset.replace('{f_title}', fm.i18n(level[i])).replace('{name}', makeName(f[level[i]])).replace(/\\{level\\}/g, level[i]);\n\t\t\t\t\tdataTable = dataTable.replace('{'+i+'}', fieldset)\n\t\t\t\t\t                     .replace('{checked-r}', ((_perm & 4) == 4)? checked : '')\n\t\t\t\t\t                     .replace('{checked-w}', ((_perm & 2) == 2)? checked : '')\n\t\t\t\t\t                     .replace('{checked-x}', ((_perm & 1) == 1)? checked : '');\n\t\t\t\t}\n\t\t\t\tdataTable = dataTable.replace('{value}', value).replace('{valueCaption}', msg['perm']);\n\t\t\t\treturn dataTable;\n\t\t\t},\n\t\t\tgetPerm = function(perm){\n\t\t\t\tif (isNaN(parseInt(perm, 8))) {\n\t\t\t\t\tvar mode_array = perm.split('');\n\t\t\t\t\tvar a = [];\n\n\t\t\t\t\tfor (var i = 0, l = mode_array.length; i < l; i++) {\n\t\t\t\t\t\tif (i === 0 || i === 3 || i === 6) {\n\t\t\t\t\t\t\tif (mode_array[i].match(/[r]/i)) {\n\t\t\t\t\t\t\t\ta.push(1);\n\t\t\t\t\t\t\t} else if (mode_array[i].match(/[-]/)) {\n\t\t\t\t\t\t\t\ta.push(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ( i === 1 || i === 4 || i === 7) {\n\t\t\t\t\t\t\t if (mode_array[i].match(/[w]/i)) {\n\t\t\t\t\t\t\t\ta.push(1);\n\t\t\t\t\t\t\t} else if (mode_array[i].match(/[-]/)) {\n\t\t\t\t\t\t\t\ta.push(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (mode_array[i].match(/[x]/i)) {\n\t\t\t\t\t\t\t\ta.push(1);\n\t\t\t\t\t\t\t} else if (mode_array[i].match(/[-]/)) {\n\t\t\t\t\t\t\t\ta.push(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\ta.splice(3, 0, \",\");\n\t\t\t\t\ta.splice(7, 0, \",\");\n\n\t\t\t\t\tvar b = a.join(\"\");\n\t\t\t\t\tvar b_array = b.split(\",\");\n\t\t\t\t\tvar c = [];\n\t\t\t\t\n\t\t\t\t\tfor (var j = 0, m = b_array.length; j < m; j++) {\n\t\t\t\t\t\tvar p = parseInt(b_array[j], 2).toString(8);\n\t\t\t\t\t\tc.push(p);\n\t\t\t\t\t}\n\n\t\t\t\t\tperm = c.join('');\n\t\t\t\t} else {\n\t\t\t\t\tperm = parseInt(perm, 8).toString(8);\n\t\t\t\t}\n\t\t\t\treturn perm;\n\t\t\t},\n\t\t\topts    = {\n\t\t\t\ttitle : this.title,\n\t\t\t\twidth : 'auto',\n\t\t\t\tbuttons : buttons(),\n\t\t\t\tclose : function() { $(this).elfinderdialog('destroy'); }\n\t\t\t},\n\t\t\tdialog = fm.getUI().find('#'+id),\n\t\t\tprevVals = {},\n\t\t\ttmb = '', title, dataTable;\n\n\t\t\tif (dialog.length) {\n\t\t\t\tdialog.elfinderdialog('toTop');\n\t\t\t\treturn $.Deferred().resolve();\n\t\t\t}\n\n\t\t\tview  = view.replace('{class}', cnt > 1 ? 'elfinder-cwd-icon-group' : fm.mime2class(file.mime));\n\t\t\tif (cnt > 1) {\n\t\t\t\ttitle = tpl.groupTitle.replace('{items}', fm.i18n('items')).replace('{num}', cnt);\n\t\t\t} else {\n\t\t\t\ttitle = tpl.itemTitle.replace('{name}', file.name).replace('{kind}', fm.mime2kind(file));\n\t\t\t\ttmb = fm.tmb(file);\n\t\t\t}\n\n\t\t\tdataTable = makeDataTable(makeperm(files), files.length == 1? files[0] : {});\n\n\t\t\tview = view.replace('{title}', title).replace('{dataTable}', dataTable).replace(/{id}/g, id);\n\n\t\t\tdialog = this.fmDialog(view, opts);\n\t\t\tdialog.attr('id', id);\n\n\t\t\t// load thumbnail\n\t\t\tif (tmb) {\n\t\t\t\t$('<img/>')\n\t\t\t\t\t.on('load', function() { dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\"); })\n\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t}\n\n\t\t\t$('#' + id + '-table-perm :checkbox').on('click', function(){setperm('perm');});\n\t\t\t$('#' + id + '-perm').on('keydown', function(e) {\n\t\t\t\tvar c = e.keyCode;\n\t\t\t\tif (c == $.ui.keyCode.ENTER) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tsave();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}).on('focus', function(e){\n\t\t\t\t$(this).trigger('select');\n\t\t\t}).on('keyup', function(e) {\n\t\t\t\tif ($(this).val().length == 3) {\n\t\t\t\t\t$(this).trigger('select');\n\t\t\t\t\tsetcheck($(this).val());\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\t};\n\t\n\treturn elFinder;\n\n});"]}