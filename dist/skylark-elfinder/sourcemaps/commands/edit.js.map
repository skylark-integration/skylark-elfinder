{"version":3,"sources":["commands/edit.js"],"names":["define","elFinder","prototype","commands","edit","stored","self","this","fm","clsEditing","res","mimesSingle","mimes","allowAll","getEncSelect","heads","hval","sel","$","each","i","head","escape","value","append","caption","options","encodings","v","filter","files","mime","ext","skip","cnt","length","name","replace","grep","file","read","mimeIsText","inArray","onlyMimes","substr","uploadMimeCheck","phash","setEditors","Object","keys","editors","fileSync","hash","f","old","request","cmd","targets","preventDefault","done","data","changed","ts","size","updateCache","change","dialog","id","content","encoding","editor","toasts","ta","dialogNode","selEncoding","extEditor","maxW","m","width","win","dfrd","Deferred","_loaded","loaded","toast","mode","msg","i18n","makeToasts","Array","isArray","save","conf","tm","encord","val","saveDfd","fail","err","show","find","hide","instance","confObj","info","schemeContent","arrayBufferContent","getContent","setOld","promise","setTimeout","notify","type","hideCnt","cancel","reject","always","clearTimeout","notifyWith","resolve","saveon","error","elfinderdialog","savecl","saveAs","prevOld","dialogs","addClass","fadeIn","disable","make","saveAsFile","prefix","requestCmd","nextAction","target","proxy","oldHash","added","exec","forceRm","quiet","progress","trigger","reqOpen","reqInfo","getUI","children","dialogClass","is","add","removeClass","fadeOut","enable","searchStatus","state","cwd","thash","when","one","dfd","d","undefined","opts","title","dialogContained","window","dialogWidth","match","parseInt","Math","min","height","dialogHeight","getDlgHeight","buttons","cssClass","maxWidth","maxHeight","allowMinimize","allowMaximize","openMaximized","editorMaximized","btnHoverFocus","closeOnEscape","propagationEvents","minimize","closest","syncInterval","close","onlySaveAs","accept","label","callback","requestAnimationFrame","msgs","unshift","confirm","text","open","loadRes","interval","initEditArea","call","load","focus","autoSync","resize","e","stateChange","attr","html","init","beforeclose","doSave","doCancel","doClose","evName","assign","on","useTextAreaEvent","start","code","keyCode","stopPropagation","ui","TAB","setSelectionRange","selectionStart","selectionEnd","ctrlKey","metaKey","charCodeAt","_setupSelEncoding","wfake","setSelW","appendTo","parent","empty","push","next","prepend","preventGet","prepare","fmDialog","css","overflow","minHeight","extention","btnSet","splitFileExtention","keepEditor","convert","req","namespace","conv","noContent","write","converter","urlAsContent","url","async","onetime","temporary","cache","_t","reg","doconv","optionsCallback","create","base","RegExp","dataScheme","btoa","atob","newHash","syncOnFail","preventFail","navigate","inbuffer","parseError","sync","fallbackEditor","textarea","node","editorObj","optEditors","cwdWrite","storage","single","canMakeEmpty","mimesCanMakeEmpty","maxSize","fileMime","editorMimes","l","indexOf","mimeMatch","fileName","editorExts","toLowerCase","extMatch","exts","store","isPlainObject","selected","useStoredEditor","getSubMenuRaw","subMenuRaw","ed","icon","iconImg","baseUrl","getStoredEditor","getStoreId","shortcuts","pattern","ccData","cmdChecks","concat","makeTextMimes","cmdCheck","api","method","setup","disabled","integrate","uniqueSort","unique","bind","contextmenuOpts","variants","enabled","extra","originalEvent","touches","raw","selectedFiles","hashes","x","offset","left","y","top","resetTexts","defs","arrayFlip","hides","getMkfileHides","getstate","select","map","list","_currentNode","cwdHash2Elm","opened","shift","apply","mkfileHideMimes"],"mappings":"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","file":"../../commands/edit.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\n\telFinder.prototype.commands.edit = function() {\n\t\t\"use strict\";\n\t\tvar self  = this,\n\t\t\tfm    = this.fm,\n\t\t\tclsEditing = fm.res('class', 'editing'),\n\t\t\tmimesSingle = [],\n\t\t\tmimes = [],\n\t\t\tallowAll = false,\n\t\t\trtrim = function(str){\n\t\t\t\treturn str.replace(/\\s+$/, '');\n\t\t\t},\n\t\t\tgetEncSelect = function(heads) {\n\t\t\t\tvar sel = $('<select class=\"ui-corner-all\"/>'),\n\t\t\t\t\thval;\n\t\t\t\tif (heads) {\n\t\t\t\t\t$.each(heads, function(i, head) {\n\t\t\t\t\t\thval = fm.escape(head.value);\n\t\t\t\t\t\tsel.append('<option value=\"'+hval+'\">'+(head.caption? fm.escape(head.caption) : hval)+'</option>');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t$.each(self.options.encodings, function(i, v) {\n\t\t\t\t\tsel.append('<option value=\"'+v+'\">'+v+'</option>');\n\t\t\t\t});\n\t\t\t\treturn sel;\n\t\t\t},\n\t\t\tgetDlgWidth = function() {\n\t\t\t\tvar win = fm.options.dialogContained? fm.getUI() : $(window),\n\t\t\t\t\tm, width;\n\t\t\t\tif (typeof self.options.dialogWidth === 'string' && (m = self.options.dialogWidth.match(/(\\d+)%/))) {\n\t\t\t\t\twidth = parseInt(win.width() * (m[1] / 100));\n\t\t\t\t} else {\n\t\t\t\t\twidth = parseInt(self.options.dialogWidth || 650);\n\t\t\t\t}\n\t\t\t\treturn Math.min(width, win.width());\n\t\t\t},\n\t\t\tgetDlgHeight = function() {\n\t\t\t\tif (!self.options.dialogHeight) {\n\t\t\t\t\treturn void(0);\n\t\t\t\t}\n\t\t\t\tvar win = fm.options.dialogContained? fm.getUI() : $(window),\n\t\t\t\t\tm, height;\n\t\t\t\tif (typeof self.options.dialogHeight === 'string' && (m = self.options.dialogHeight.match(/(\\d+)%/))) {\n\t\t\t\t\theight = parseInt(win.height() * (m[1] / 100));\n\t\t\t\t} else {\n\t\t\t\t\theight = parseInt(self.options.dialogHeight || win.height());\n\t\t\t\t}\n\t\t\t\treturn Math.min(height, win.height());\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Return files acceptable to edit\n\t\t\t *\n\t\t\t * @param  Array  files hashes\n\t\t\t * @return Array\n\t\t\t **/\n\t\t\tfilter = function(files) {\n\t\t\t\tvar cnt = files.length,\n\t\t\t\t\tmime, ext, skip;\n\t\t\t\t\n\t\t\t\tif (cnt > 1) {\n\t\t\t\t\tmime = files[0].mime;\n\t\t\t\t\text = files[0].name.replace(/^.*(\\.[^.]+)$/, '$1');\n\t\t\t\t}\n\t\t\t\treturn $.grep(files, function(file) {\n\t\t\t\t\tvar res;\n\t\t\t\t\tif (skip || file.mime === 'directory') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tres = file.read\n\t\t\t\t\t\t&& (allowAll || fm.mimeIsText(file.mime) || $.inArray(file.mime, cnt === 1? mimesSingle : mimes) !== -1) \n\t\t\t\t\t\t&& (!self.onlyMimes.length || $.inArray(file.mime, self.onlyMimes) !== -1)\n\t\t\t\t\t\t&& (cnt === 1 || (file.mime === mime && file.name.substr(ext.length * -1) === ext))\n\t\t\t\t\t\t&& (fm.uploadMimeCheck(file.mime, file.phash)? true : false)\n\t\t\t\t\t\t&& setEditors(file, cnt)\n\t\t\t\t\t\t&& Object.keys(editors).length;\n\t\t\t\t\tif (!res) {\n\t\t\t\t\t\tskip = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tfileSync = function(hash) {\n\t\t\t\tvar old = fm.file(hash),\n\t\t\t\t\tf;\n\t\t\t\tfm.request({\n\t\t\t\t\tcmd: 'info',\n\t\t\t\t\ttargets: [hash],\n\t\t\t\t\tpreventDefault: true\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tvar changed;\n\t\t\t\t\tif (data && data.files && data.files.length) {\n\t\t\t\t\t\tf = data.files[0];\n\t\t\t\t\t\tif (old.ts != f.ts || old.size != f.size) {\n\t\t\t\t\t\t\tchanged = { changed: [ f ] };\n\t\t\t\t\t\t\tfm.updateCache(changed);\n\t\t\t\t\t\t\tfm.change(changed);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Open dialog with textarea to edit file\n\t\t\t *\n\t\t\t * @param  String  id       dialog id\n\t\t\t * @param  Object  file     file object\n\t\t\t * @param  String  content  file content\n\t\t\t * @return $.Deferred\n\t\t\t **/\n\t\t\tdialog = function(id, file, content, encoding, editor, toasts) {\n\n\t\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\t\t_loaded = false,\n\t\t\t\t\tloaded = function() {\n\t\t\t\t\t\tif (!_loaded) {\n\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\tmode: 'warning',\n\t\t\t\t\t\t\t\tmsg: fm.i18n('nowLoading')\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\tmakeToasts = function() {\n\t\t\t\t\t\t// make toast message\n\t\t\t\t\t\tif (toasts && Array.isArray(toasts)) {\n\t\t\t\t\t\t\t$.each(toasts, function() {\n\t\t\t\t\t\t\t\tthis.msg && fm.toast(this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsave = function() {\n\t\t\t\t\t\tvar encord = selEncoding? selEncoding.val():void(0),\n\t\t\t\t\t\t\tsaveDfd = $.Deferred().fail(function(err) {\n\t\t\t\t\t\t\t\tdialogNode.show().find('button.elfinder-btncnt-0,button.elfinder-btncnt-1').hide();\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tconf, res, tm;\n\t\t\t\t\t\tif (!loaded()) {\n\t\t\t\t\t\t\treturn saveDfd.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ta.editor) {\n\t\t\t\t\t\t\tta.editor.save(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\tif (conf.info && (conf.info.schemeContent || conf.info.arrayBufferContent)) {\n\t\t\t\t\t\t\t\tencord = 'scheme';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = getContent();\n\t\t\t\t\t\tsetOld(res);\n\t\t\t\t\t\tif (res.promise) {\n\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\ttype : 'chkcontent',\n\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\thideCnt: true,\n\t\t\t\t\t\t\t\t\tcancel : function() {\n\t\t\t\t\t\t\t\t\t\tres.reject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\tres.always(function() {\n\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\tfm.notify({ type : 'chkcontent', cnt: -1 });\n\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\tdfrd.notifyWith(ta, [encord, ta.data('hash'), old, saveDfd]);\n\t\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\t\tsaveDfd.reject(err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd.notifyWith(ta, [encord, ta.data('hash'), old, saveDfd]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn saveDfd;\n\t\t\t\t\t},\n\t\t\t\t\tsaveon = function() {\n\t\t\t\t\t\tif (!loaded()) { return; }\n\t\t\t\t\t\tsave().fail(function(err) {\n\t\t\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tcancel = function() {\n\t\t\t\t\t\tta.elfinderdialog('close');\n\t\t\t\t\t},\n\t\t\t\t\tsavecl = function() {\n\t\t\t\t\t\tif (!loaded()) { return; }\n\t\t\t\t\t\tdialogNode.hide();\n\t\t\t\t\t\tsave().done(function() {\n\t\t\t\t\t\t\t_loaded = false;\n\t\t\t\t\t\t\tdialogNode.show();\n\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\tdialogNode.show();\n\t\t\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tsaveAs = function() {\n\t\t\t\t\t\tif (!loaded()) { return; }\n\t\t\t\t\t\tvar prevOld = old,\n\t\t\t\t\t\t\tphash = file.phash,\n\t\t\t\t\t\t\tfail = function(err) {\n\t\t\t\t\t\t\t\tdialogs.addClass(clsEditing).fadeIn(function() {\n\t\t\t\t\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\told = prevOld;\n\t\t\t\t\t\t\t\tfm.disable();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmake = function() {\n\t\t\t\t\t\t\t\tself.mime = saveAsFile.mime || file.mime;\n\t\t\t\t\t\t\t\tself.prefix = (saveAsFile.name || file.name).replace(/ \\d+(\\.[^.]+)?$/, '$1');\n\t\t\t\t\t\t\t\tself.requestCmd = 'mkfile';\n\t\t\t\t\t\t\t\tself.nextAction = {};\n\t\t\t\t\t\t\t\tself.data = {target : phash};\n\t\t\t\t\t\t\t\t$.proxy(fm.res('mixin', 'make'), self)()\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\tvar oldHash;\n\t\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\t\toldHash = ta.data('hash');\n\t\t\t\t\t\t\t\t\t\t\tta.data('hash', data.added[0].hash);\n\t\t\t\t\t\t\t\t\t\t\tsave().done(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t_loaded = false;\n\t\t\t\t\t\t\t\t\t\t\t\tdialogNode.show();\n\t\t\t\t\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\t\t\t\t\tdialogs.fadeIn();\n\t\t\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('rm', [data.added[0].hash], { forceRm: true, quiet: true });\n\t\t\t\t\t\t\t\t\t\t\t\tta.data('hash', oldHash);\n\t\t\t\t\t\t\t\t\t\t\t\tdialogNode.find('button.elfinder-btncnt-2').hide();\n\t\t\t\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.progress(function(err) {\n\t\t\t\t\t\t\t\t\t\tif (err && err === 'errUploadMime') {\n\t\t\t\t\t\t\t\t\t\t\tta.trigger('saveAsFail');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.fail(fail)\n\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\tdelete self.mime;\n\t\t\t\t\t\t\t\t\t\tdelete self.prefix;\n\t\t\t\t\t\t\t\t\t\tdelete self.nextAction;\n\t\t\t\t\t\t\t\t\t\tdelete self.data;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', { files: [ file.hash ] });\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treqOpen = null,\n\t\t\t\t\t\t\treqInfo = null,\n\t\t\t\t\t\t\tdialogs = fm.getUI().children('.' + self.dialogClass + ':visible');\n\t\t\t\t\t\t\tif (dialogNode.is(':hidden')) {\n\t\t\t\t\t\t\t\tdialogs = dialogs.add(dialogNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialogs.removeClass(clsEditing).fadeOut();\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.enable();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (fm.searchStatus.state < 2 && phash !== fm.cwd().hash) {\n\t\t\t\t\t\t\treqOpen = fm.exec('open', [phash], {thash: phash});\n\t\t\t\t\t\t} else if (!fm.file(phash)) {\n\t\t\t\t\t\t\treqInfo = fm.request({cmd: 'info', targets: [phash]}); \n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$.when([reqOpen, reqInfo]).done(function() {\n\t\t\t\t\t\t\tif (reqInfo) {\n\t\t\t\t\t\t\t\tfm.one('infodone', function() {\n\t\t\t\t\t\t\t\t\tfm.file(phash)? make() : fail('errFolderNotFound');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treqOpen? fm.one('cwdrender', make) : make();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).fail(fail);\n\t\t\t\t\t},\n\t\t\t\t\tchanged = function() {\n\t\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\t\tres, tm;\n\t\t\t\t\t\tif (!_loaded) {\n\t\t\t\t\t\t\treturn dfd.resolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tta.editor && ta.editor.save(ta[0], ta.editor.instance);\n\t\t\t\t\t\tres = getContent();\n\t\t\t\t\t\tif (res && res.promise) {\n\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\ttype : 'chkcontent',\n\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\thideCnt: true,\n\t\t\t\t\t\t\t\t\tcancel : function() {\n\t\t\t\t\t\t\t\t\t\tres.reject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\tres.always(function() {\n\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\tfm.notify({ type : 'chkcontent', cnt: -1 });\n\t\t\t\t\t\t\t}).done(function(d) {\n\t\t\t\t\t\t\t\tdfd.resolve(old !== d);\n\t\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\t\tdfd.resolve(err || (old === undefined? false : true));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd.resolve(old !== res);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t},\n\t\t\t\t\topts = {\n\t\t\t\t\t\ttitle   : fm.escape(file.name),\n\t\t\t\t\t\twidth   : getDlgWidth(),\n\t\t\t\t\t\theight  : getDlgHeight(),\n\t\t\t\t\t\tbuttons : {},\n\t\t\t\t\t\tcssClass  : clsEditing,\n\t\t\t\t\t\tmaxWidth  : 'window',\n\t\t\t\t\t\tmaxHeight : 'window',\n\t\t\t\t\t\tallowMinimize : true,\n\t\t\t\t\t\tallowMaximize : true,\n\t\t\t\t\t\topenMaximized : editorMaximized() || (editor && editor.info && editor.info.openMaximized),\n\t\t\t\t\t\tbtnHoverFocus : false,\n\t\t\t\t\t\tcloseOnEscape : false,\n\t\t\t\t\t\tpropagationEvents : ['mousemove', 'mouseup', 'click'],\n\t\t\t\t\t\tminimize : function() {\n\t\t\t\t\t\t\tvar conf;\n\t\t\t\t\t\t\tif (ta.editor && dialogNode.closest('.ui-dialog').is(':hidden')) {\n\t\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\t\tif (conf.info && conf.info.syncInterval) {\n\t\t\t\t\t\t\t\t\tfileSync(file.hash);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclose   : function() {\n\t\t\t\t\t\t\tvar close = function() {\n\t\t\t\t\t\t\t\t\tvar conf;\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\tif (ta.editor) {\n\t\t\t\t\t\t\t\t\t\tta.editor.close(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\t\t\t\tif (conf.info && conf.info.syncInterval) {\n\t\t\t\t\t\t\t\t\t\t\tfileSync(file.hash);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonlySaveAs = (typeof saveAsFile.name !== 'undefined'),\n\t\t\t\t\t\t\t\taccept = onlySaveAs? {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveAs',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(saveAs);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveClose',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\tsave().done(function() {\n\t\t\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tchanged().done(function(change) {\n\t\t\t\t\t\t\t\tvar msgs = ['confirmNotSave'];\n\t\t\t\t\t\t\t\tif (change) {\n\t\t\t\t\t\t\t\t\tif (typeof change === 'string') {\n\t\t\t\t\t\t\t\t\t\tmsgs.unshift(change);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\t\t\t\t\t\ttext   : msgs,\n\t\t\t\t\t\t\t\t\t\taccept : accept,\n\t\t\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnClose',\n\t\t\t\t\t\t\t\t\t\t\tcallback : close\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tbuttons : onlySaveAs? null : [{\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveAs',\n\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(saveAs);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\topen    : function() {\n\t\t\t\t\t\t\tvar loadRes, conf, interval;\n\t\t\t\t\t\t\tta.initEditArea.call(ta, id, file, content, fm);\n\t\t\t\t\t\t\tif (ta.editor) {\n\t\t\t\t\t\t\t\tloadRes = ta.editor.load(ta[0]) || null;\n\t\t\t\t\t\t\t\tif (loadRes && loadRes.done) {\n\t\t\t\t\t\t\t\t\tloadRes.always(function() {\n\t\t\t\t\t\t\t\t\t\t_loaded = true;\n\t\t\t\t\t\t\t\t\t}).done(function(instance) {\n\t\t\t\t\t\t\t\t\t\tta.editor.instance = instance;\n\t\t\t\t\t\t\t\t\t\tta.editor.focus(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\t\tsetOld(getContent());\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\t\tdialogNode.trigger('resize');\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}).always(makeToasts);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t_loaded = true;\n\t\t\t\t\t\t\t\t\tif (loadRes && (typeof loadRes === 'string' || Array.isArray(loadRes))) {\n\t\t\t\t\t\t\t\t\t\tfm.error(loadRes);\n\t\t\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tta.editor.instance = loadRes;\n\t\t\t\t\t\t\t\t\tta.editor.focus(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\tsetOld(getContent());\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\tdialogNode.trigger('resize');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tmakeToasts();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\t\tif (conf.info && conf.info.syncInterval) {\n\t\t\t\t\t\t\t\t\tif (interval = parseInt(conf.info.syncInterval)) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tautoSync(interval);\n\t\t\t\t\t\t\t\t\t\t}, interval);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t_loaded = true;\n\t\t\t\t\t\t\t\tsetOld(getContent());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresize : function(e, data) {\n\t\t\t\t\t\t\tta.editor && ta.editor.resize(ta[0], ta.editor.instance, e, data || {});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgetContent = function() {\n\t\t\t\t\t\tvar res = ta.getContent.call(ta, ta[0]);\n\t\t\t\t\t\tif (res === undefined || res === false || res === null) {\n\t\t\t\t\t\t\tres = $.Deferred().reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t},\n\t\t\t\t\tsetOld = function(res) {\n\t\t\t\t\t\tif (res && res.promise) {\n\t\t\t\t\t\t\tres.done(function(d) {\n\t\t\t\t\t\t\t\told = d;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\told = res;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tautoSync = function(interval) {\n\t\t\t\t\t\tif (dialogNode.is(':visible')) {\n\t\t\t\t\t\t\tfileSync(file.hash);\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tautoSync(interval);\n\t\t\t\t\t\t\t}, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tstateChange = function() {\n\t\t\t\t\t\tif (selEncoding) {\n\t\t\t\t\t\t\tchanged().done(function(change) {\n\t\t\t\t\t\t\t\tif (change) {\n\t\t\t\t\t\t\t\t\tselEncoding.attr('title', fm.i18n('saveAsEncoding')).addClass('elfinder-edit-changed');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tselEncoding.attr('title', fm.i18n('openAsEncoding')).removeClass('elfinder-edit-changed');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsaveAsFile = {},\n\t\t\t\t\tta, old, dialogNode, selEncoding, extEditor, maxW, syncInterval;\n\t\t\t\t\t\n\t\t\t\tif (editor) {\n\t\t\t\t\tif (editor.html) {\n\t\t\t\t\t\tta = $(editor.html);\n\t\t\t\t\t}\n\t\t\t\t\textEditor = {\n\t\t\t\t\t\tinit     : editor.init || null,\n\t\t\t\t\t\tload     : editor.load,\n\t\t\t\t\t\tgetContent : editor.getContent || null,\n\t\t\t\t\t\tsave     : editor.save,\n\t\t\t\t\t\tbeforeclose : typeof editor.beforeclose == 'function' ? editor.beforeclose : void 0,\n\t\t\t\t\t\tclose    : typeof editor.close == 'function' ? editor.close : function() {},\n\t\t\t\t\t\tfocus    : typeof editor.focus == 'function' ? editor.focus : function() {},\n\t\t\t\t\t\tresize   : typeof editor.resize == 'function' ? editor.resize : function() {},\n\t\t\t\t\t\tinstance : null,\n\t\t\t\t\t\tdoSave   : saveon,\n\t\t\t\t\t\tdoCancel : cancel,\n\t\t\t\t\t\tdoClose  : savecl,\n\t\t\t\t\t\tfile     : file,\n\t\t\t\t\t\tfm       : fm,\n\t\t\t\t\t\tconfObj  : editor,\n\t\t\t\t\t\ttrigger  : function(evName, data) {\n\t\t\t\t\t\t\tfm.trigger('editEditor' + evName, Object.assign({}, editor.info || {}, data));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!ta) {\n\t\t\t\t\tif (!fm.mimeIsText(file.mime)) {\n\t\t\t\t\t\treturn dfrd.reject('errEditorNotFound');\n\t\t\t\t\t}\n\t\t\t\t\t(function() {\n\t\t\t\t\t\tta = $('<textarea class=\"elfinder-file-edit\" rows=\"20\" id=\"'+id+'-ta\"></textarea>')\n\t\t\t\t\t\t\t.on('input propertychange', stateChange);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!editor || !editor.info || editor.info.useTextAreaEvent) {\n\t\t\t\t\t\t\tta.on('keydown', function(e) {\n\t\t\t\t\t\t\t\tvar code = e.keyCode,\n\t\t\t\t\t\t\t\t\tvalue, start;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tif (code == $.ui.keyCode.TAB) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t// insert tab on tab press\n\t\t\t\t\t\t\t\t\tif (this.setSelectionRange) {\n\t\t\t\t\t\t\t\t\t\tvalue = this.value;\n\t\t\t\t\t\t\t\t\t\tstart = this.selectionStart;\n\t\t\t\t\t\t\t\t\t\tthis.value = value.substr(0, start) + \"\\t\" + value.substr(this.selectionEnd);\n\t\t\t\t\t\t\t\t\t\tstart += 1;\n\t\t\t\t\t\t\t\t\t\tthis.setSelectionRange(start, start);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\t\t\t\t// close on ctrl+w/q\n\t\t\t\t\t\t\t\t\tif (code == 'Q'.charCodeAt(0) || code == 'W'.charCodeAt(0)) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (code == 'S'.charCodeAt(0)) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tsaveon();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('mouseenter', function(){this.focus();});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tta.initEditArea = function(id, file, content) {\n\t\t\t\t\t\t\t// ta.hide() for performance tune. Need ta.show() in `load()` if use textarea node.\n\t\t\t\t\t\t\tta.hide().val(content);\n\t\t\t\t\t\t\tthis._setupSelEncoding(content);\n\t\t\t\t\t\t};\n\t\t\t\t\t})();\n\t\t\t\t}\n\n\t\t\t\t// extended function to setup selector of encoding for text editor\n\t\t\t\tta._setupSelEncoding = function(content) {\n\t\t\t\t\tvar heads = (encoding && encoding !== 'unknown')? [{value: encoding}] : [],\n\t\t\t\t\t\twfake = $('<select/>').hide(),\n\t\t\t\t\t\tsetSelW = function(init) {\n\t\t\t\t\t\t\tinit && wfake.appendTo(selEncoding.parent());\n\t\t\t\t\t\t\twfake.empty().append($('<option/>').text(selEncoding.val()));\n\t\t\t\t\t\t\tselEncoding.width(wfake.width());\n\t\t\t\t\t\t};\n\t\t\t\t\tif (content === '' || ! encoding || encoding !== 'UTF-8') {\n\t\t\t\t\t\theads.push({value: 'UTF-8'});\n\t\t\t\t\t}\n\t\t\t\t\tselEncoding = getEncSelect(heads).on('touchstart', function(e) {\n\t\t\t\t\t\t// for touch punch event handler\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}).on('change', function() {\n\t\t\t\t\t\t// reload to change encoding if not edited\n\t\t\t\t\t\tchanged().done(function(change) {\n\t\t\t\t\t\t\tif (! change && getContent() !== '') {\n\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\tedit(file, selEncoding.val(), editor).fail(function(err) { err && fm.error(err); });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetSelW();\n\t\t\t\t\t}).on('mouseover', stateChange);\n\t\t\t\t\tta.parent().next().prepend($('<div class=\"ui-dialog-buttonset elfinder-edit-extras\"/>').append(selEncoding));\n\t\t\t\t\tsetSelW(true);\n\t\t\t\t};\n\n\t\t\t\tta.data('hash', file.hash);\n\t\t\t\t\n\t\t\t\tif (extEditor) {\n\t\t\t\t\tta.editor = extEditor;\n\t\t\t\t\t\n\t\t\t\t\tif (typeof extEditor.beforeclose === 'function') {\n\t\t\t\t\t\topts.beforeclose = function() {\n\t\t\t\t\t\t\treturn extEditor.beforeclose(ta[0], extEditor.instance);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (typeof extEditor.init === 'function') {\n\t\t\t\t\t\tta.initEditArea = extEditor.init;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (typeof extEditor.getContent === 'function') {\n\t\t\t\t\t\tta.getContent = extEditor.getContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (! ta.initEditArea) {\n\t\t\t\t\tta.initEditArea = function() {};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (! ta.getContent) {\n\t\t\t\t\tta.getContent = function() {\n\t\t\t\t\t\treturn rtrim(ta.val());\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!editor || !editor.info || !editor.info.preventGet) {\n\t\t\t\t\topts.buttons[fm.i18n('btnSave')]      = saveon;\n\t\t\t\t\topts.buttons[fm.i18n('btnSaveClose')] = savecl;\n\t\t\t\t\topts.buttons[fm.i18n('btnSaveAs')]    = saveAs;\n\t\t\t\t\topts.buttons[fm.i18n('btnCancel')]    = cancel;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (editor && typeof editor.prepare === 'function') {\n\t\t\t\t\teditor.prepare(ta, opts, file);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdialogNode = self.fmDialog(ta, opts)\n\t\t\t\t\t.attr('id', id)\n\t\t\t\t\t.on('keydown keyup keypress', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.css({ overflow: 'hidden', minHeight: '7em' })\n\t\t\t\t\t.addClass('elfinder-edit-editor')\n\t\t\t\t\t.closest('.ui-dialog')\n\t\t\t\t\t.on('changeType', function(e, data) {\n\t\t\t\t\t\tif (data.extention && data.mime) {\n\t\t\t\t\t\t\tvar ext = data.extention,\n\t\t\t\t\t\t\t\tmime = data.mime,\n\t\t\t\t\t\t\t\tbtnSet = $(this).children('.ui-dialog-buttonpane').children('.ui-dialog-buttonset');\n\t\t\t\t\t\t\tbtnSet.children('.elfinder-btncnt-0,.elfinder-btncnt-1').hide();\n\t\t\t\t\t\t\tsaveAsFile.name = fm.splitFileExtention(file.name)[0] + '.' + data.extention;\n\t\t\t\t\t\t\tsaveAsFile.mime = data.mime;\n\t\t\t\t\t\t\tif (!data.keepEditor) {\n\t\t\t\t\t\t\t\tbtnSet.children('.elfinder-btncnt-2').trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// care to viewport scale change with mobile devices\n\t\t\t\tmaxW = (fm.options.dialogContained? fm.getUI() : $(window)).width();\n\t\t\t\t(dialogNode.width() > maxW) && dialogNode.width(maxW);\n\t\t\t\t\n\t\t\t\treturn dfrd.promise();\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Get file content and\n\t\t\t * open dialog with textarea to edit file content\n\t\t\t *\n\t\t\t * @param  String  file hash\n\t\t\t * @return jQuery.Deferred\n\t\t\t **/\n\t\t\tedit = function(file, convert, editor) {\n\t\t\t\tvar hash   = file.hash,\n\t\t\t\t\topts   = fm.options,\n\t\t\t\t\tdfrd   = $.Deferred(), \n\t\t\t\t\tid     = 'edit-'+fm.namespace+'-'+file.hash,\n\t\t\t\t\td      = fm.getUI().find('#'+id),\n\t\t\t\t\tconv   = !convert? 0 : convert,\n\t\t\t\t\tnoContent = false,\n\t\t\t\t\treq, error, res;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (d.length) {\n\t\t\t\t\td.elfinderdialog('toTop');\n\t\t\t\t\treturn dfrd.resolve();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!file.read || (!file.write && (!editor.info || !editor.info.converter))) {\n\t\t\t\t\terror = ['errOpen', file.name, 'errPerm'];\n\t\t\t\t\treturn dfrd.reject(error);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (editor && editor.info) {\n\t\t\t\t\tif (typeof editor.info.edit === 'function') {\n\t\t\t\t\t\tres = editor.info.edit.call(fm, file, editor);\n\t\t\t\t\t\tif (res.promise) {\n\t\t\t\t\t\t\tres.done(function() {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres? dfrd.resolve() : dfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfrd;\n\t\t\t\t\t}\n\n\t\t\t\t\tnoContent = editor.info.preventGet || editor.info.noContent;\n\t\t\t\t\tif (editor.info.urlAsContent || noContent) {\n\t\t\t\t\t\treq = $.Deferred();\n\t\t\t\t\t\tif (editor.info.urlAsContent) {\n\t\t\t\t\t\t\tfm.url(hash, { async: true, onetime: true, temporary: true }).done(function(url) {\n\t\t\t\t\t\t\t\treq.resolve({content: url});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treq.resolve({});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (conv) {\n\t\t\t\t\t\t\tfile.encoding = conv;\n\t\t\t\t\t\t\tfm.cache(file, 'change');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treq = fm.request({\n\t\t\t\t\t\t\tdata           : {cmd : 'get', target : hash, conv : conv, _t : file.ts},\n\t\t\t\t\t\t\toptions        : {type: 'get', cache : true},\n\t\t\t\t\t\t\tnotify         : {type : 'file', cnt : 1},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treq.done(function(data) {\n\t\t\t\t\t\tvar selEncoding, reg, m, res;\n\t\t\t\t\t\tif (data.doconv) {\n\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\t\t\t\ttext   : data.doconv === 'unknown'? 'confirmNonUTF8' : 'confirmConvUTF8',\n\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnConv',\n\t\t\t\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\t\t\t\tdfrd = edit(file, selEncoding.val(), editor);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\t\t\t\tcallback : function() { dfrd.reject(); }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\toptionsCallback : function(options) {\n\t\t\t\t\t\t\t\t\toptions.create = function() {\n\t\t\t\t\t\t\t\t\t\tvar base = $('<div class=\"elfinder-dialog-confirm-encoding\"/>'),\n\t\t\t\t\t\t\t\t\t\t\thead = {value: data.doconv},\n\t\t\t\t\t\t\t\t\t\t\tdetected;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (data.doconv === 'unknown') {\n\t\t\t\t\t\t\t\t\t\t\thead.caption = '-';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tselEncoding = getEncSelect([head]);\n\t\t\t\t\t\t\t\t\t\t$(this).next().find('.ui-dialog-buttonset')\n\t\t\t\t\t\t\t\t\t\t\t.prepend(base.append($('<label>'+fm.i18n('encoding')+' </label>').append(selEncoding)));\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!noContent && fm.mimeIsText(file.mime)) {\n\t\t\t\t\t\t\t\treg = new RegExp('^(data:'+file.mime.replace(/([.+])/g, '\\\\$1')+';base64,)', 'i');\n\t\t\t\t\t\t\t\tif (!editor.info.dataScheme) {\n\t\t\t\t\t\t\t\t\tif (window.atob && (m = data.content.match(reg))) {\n\t\t\t\t\t\t\t\t\t\tdata.content = atob(data.content.substr(m[1].length));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (window.btoa && !data.content.match(reg)) {\n\t\t\t\t\t\t\t\t\t\tdata.content = 'data:'+file.mime+';base64,'+btoa(data.content);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog(id, file, data.content, data.encoding, editor, data.toasts)\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.progress(function(encoding, newHash, data, saveDfd) {\n\t\t\t\t\t\t\t\t\tvar ta = this;\n\t\t\t\t\t\t\t\t\tif (newHash) {\n\t\t\t\t\t\t\t\t\t\thash = newHash;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\toptions : {type : 'post'},\n\t\t\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\t\t\tcmd     : 'put',\n\t\t\t\t\t\t\t\t\t\t\ttarget  : hash,\n\t\t\t\t\t\t\t\t\t\t\tencoding : encoding || data.encoding,\n\t\t\t\t\t\t\t\t\t\t\tcontent : data\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'save', cnt : 1},\n\t\t\t\t\t\t\t\t\t\tsyncOnFail : true,\n\t\t\t\t\t\t\t\t\t\tpreventFail : true,\n\t\t\t\t\t\t\t\t\t\tnavigate : {\n\t\t\t\t\t\t\t\t\t\t\ttarget : 'changed',\n\t\t\t\t\t\t\t\t\t\t\ttoast : {\n\t\t\t\t\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('btnSave')])}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\tsaveDfd.reject();\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function(){\n\t\t\t\t\t\t\t\t\t\t\tta.trigger('focus');\n\t\t\t\t\t\t\t\t\t\t\tta.editor && ta.editor.focus(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tsaveDfd.resolve();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tvar err = fm.parseError(error);\n\t\t\t\t\t\terr = Array.isArray(err)? err[0] : err;\n\t\t\t\t\t\tif (file.encoding) {\n\t\t\t\t\t\t\tfile.encoding = '';\n\t\t\t\t\t\t\tfm.cache(file, 'change');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t(err !== 'errConvUTF8') && fm.sync();\n\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn dfrd.promise();\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Current editors of selected files\n\t\t\t * \n\t\t\t * @type Object\n\t\t\t */\n\t\t\teditors = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Fallback editor (Simple text editor)\n\t\t\t * \n\t\t\t * @type Object\n\t\t\t */\n\t\t\tfallbackEditor = {\n\t\t\t\t// Simple Text (basic textarea editor)\n\t\t\t\tinfo : {\n\t\t\t\t\tid : 'textarea',\n\t\t\t\t\tname : 'TextArea',\n\t\t\t\t\tuseTextAreaEvent : true\n\t\t\t\t},\n\t\t\t\tload : function(textarea) {\n\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\tthis.trigger('Prepare', {\n\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\teditorObj: void(0),\n\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\topts: {}\n\t\t\t\t\t});\n\t\t\t\t\ttextarea.setSelectionRange && textarea.setSelectionRange(0, 0);\n\t\t\t\t\t$(textarea).trigger('focus').show();\n\t\t\t\t},\n\t\t\t\tsave : function(){}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Set current editors\n\t\t\t * \n\t\t\t * @param  Object  file object\n\t\t\t * @param  Number  cnt  count of selected items\n\t\t\t * @return Void\n\t\t\t */\n\t\t\tsetEditors = function(file, cnt) {\n\t\t\t\tvar mimeMatch = function(fileMime, editorMimes){\n\t\t\t\t\t\tif (!editorMimes) {\n\t\t\t\t\t\t\treturn fm.mimeIsText(fileMime);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (editorMimes[0] === '*' || $.inArray(fileMime, editorMimes) !== -1) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar i, l;\n\t\t\t\t\t\t\tl = editorMimes.length;\n\t\t\t\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\t\t\t\tif (fileMime.indexOf(editorMimes[i]) === 0) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\textMatch = function(fileName, editorExts){\n\t\t\t\t\t\tif (!editorExts || !editorExts.length) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar ext = fileName.replace(/^.+\\.([^.]+)|(.+)$/, '$1$2').toLowerCase(),\n\t\t\t\t\t\ti, l;\n\t\t\t\t\t\tl = editorExts.length;\n\t\t\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\t\t\tif (ext === editorExts[i].toLowerCase()) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\toptEditors = self.options.editors || [],\n\t\t\t\t\tcwdWrite = fm.cwd().write;\n\t\t\t\t\n\t\t\t\tstored = fm.storage('storedEditors') || {};\n\t\t\t\teditors = {};\n\t\t\t\tif (!optEditors.length) {\n\t\t\t\t\toptEditors = [fallbackEditor];\n\t\t\t\t}\n\t\t\t\t$.each(optEditors, function(i, editor) {\n\t\t\t\t\tvar name;\n\t\t\t\t\tif ((cnt === 1 || !editor.info.single)\n\t\t\t\t\t\t\t&& ((!editor.info || !editor.info.converter)? file.write : cwdWrite)\n\t\t\t\t\t\t\t&& (file.size > 0 || (!editor.info.converter && editor.info.canMakeEmpty !== false && fm.mimesCanMakeEmpty[file.mime]))\n\t\t\t\t\t\t\t&& (!editor.info.maxSize || file.size <= editor.info.maxSize)\n\t\t\t\t\t\t\t&& mimeMatch(file.mime, editor.mimes || null)\n\t\t\t\t\t\t\t&& extMatch(file.name, editor.exts || null)\n\t\t\t\t\t\t\t&& typeof editor.load == 'function'\n\t\t\t\t\t\t\t&& typeof editor.save == 'function') {\n\t\t\t\t\t\t\n\t\t\t\t\t\tname = editor.info.name? editor.info.name : ('Editor ' + i);\n\t\t\t\t\t\teditor.id = editor.info.id? editor.info.id : ('editor' + i),\n\t\t\t\t\t\teditor.name = name;\n\t\t\t\t\t\teditor.i18n = fm.i18n(name);\n\t\t\t\t\t\teditors[editor.id] = editor;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn Object.keys(editors).length? true : false;\n\t\t\t},\n\t\t\tstore = function(mime, editor) {\n\t\t\t\tif (mime && editor) {\n\t\t\t\t\tif (!$.isPlainObject(stored)) {\n\t\t\t\t\t\tstored = {};\n\t\t\t\t\t}\n\t\t\t\t\tstored[mime] = editor.id;\n\t\t\t\t\tfm.storage('storedEditors', stored);\n\t\t\t\t\tfm.trigger('selectfiles', {files : fm.selected()});\n\t\t\t\t}\n\t\t\t},\n\t\t\tuseStoredEditor = function() {\n\t\t\t\tvar d = fm.storage('useStoredEditor');\n\t\t\t\treturn d? (d > 0) : self.options.useStoredEditor;\n\t\t\t},\n\t\t\teditorMaximized = function() {\n\t\t\t\tvar d = fm.storage('editorMaximized');\n\t\t\t\treturn d? (d > 0) : self.options.editorMaximized;\n\t\t\t},\n\t\t\tgetSubMenuRaw = function(files, callback) {\n\t\t\t\tvar subMenuRaw = [];\n\t\t\t\t$.each(editors, function(id, ed) {\n\t\t\t\t\tsubMenuRaw.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel    : fm.escape(ed.i18n),\n\t\t\t\t\t\t\ticon     : ed.info && ed.info.icon? ed.info.icon : 'edit',\n\t\t\t\t\t\t\toptions  : { iconImg: ed.info && ed.info.iconImg? fm.baseUrl + ed.info.iconImg : void(0) },\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\tstore(files[0].mime, ed);\n\t\t\t\t\t\t\t\tcallback && callback.call(ed);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\t\t\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\treturn subMenuRaw;\n\t\t\t},\n\t\t\tgetStoreId = function(name) {\n\t\t\t\t// for compatibility to previous version\n\t\t\t\treturn name.toLowerCase().replace(/ +/g, '');\n\t\t\t},\n\t\t\tgetStoredEditor = function(mime) {\n\t\t\t\tvar name = stored[mime];\n\t\t\t\treturn name && Object.keys(editors).length? editors[getStoreId(name)] : void(0);\n\t\t\t},\n\t\t\tinfoRequest = function() {\n\n\t\t\t},\n\t\t\tstored;\n\t\t\n\t\t// make public method\n\t\tthis.getEncSelect = getEncSelect;\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+e'\n\t\t}];\n\t\t\n\t\tthis.init = function() {\n\t\t\tvar self = this,\n\t\t\t\tfm   = this.fm,\n\t\t\t\topts = this.options,\n\t\t\t\tcmdChecks = [],\n\t\t\t\tccData, dfd;\n\t\t\t\n\t\t\tthis.onlyMimes = this.options.mimes || [];\n\t\t\t\n\t\t\tfm.one('open', function() {\n\t\t\t\t// editors setup\n\t\t\t\tif (opts.editors && Array.isArray(opts.editors)) {\n\t\t\t\t\tfm.trigger('canMakeEmptyFile', {mimes: Object.keys(fm.storage('mkfileTextMimes') || {}).concat(opts.makeTextMimes || ['text/plain'])});\n\t\t\t\t\t$.each(opts.editors, function(i, editor) {\n\t\t\t\t\t\tif (editor.info && editor.info.cmdCheck) {\n\t\t\t\t\t\t\tcmdChecks.push(editor.info.cmdCheck);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (cmdChecks.length) {\n\t\t\t\t\t\tif (fm.api >= 2.1030) {\n\t\t\t\t\t\t\tdfd = fm.request({\n\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\tcmd: 'editor',\n\t\t\t\t\t\t\t\t\tname: cmdChecks,\n\t\t\t\t\t\t\t\t\tmethod: 'enabled'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t}).done(function(d) {\n\t\t\t\t\t\t\t\tccData = d;\n\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\tccData = {};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tccData = {};\n\t\t\t\t\t\t\tdfd = $.Deferred().resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfd = $.Deferred().resolve();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdfd.always(function() {\n\t\t\t\t\t\tif (ccData) {\n\t\t\t\t\t\t\topts.editors = $.grep(opts.editors, function(e) {\n\t\t\t\t\t\t\t\tif (e.info && e.info.cmdCheck) {\n\t\t\t\t\t\t\t\t\treturn ccData[e.info.cmdCheck]? true : false;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.each(opts.editors, function(i, editor) {\n\t\t\t\t\t\t\tif (editor.setup && typeof editor.setup === 'function') {\n\t\t\t\t\t\t\t\teditor.setup.call(editor, opts, fm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!editor.disabled) {\n\t\t\t\t\t\t\t\tif (editor.mimes && Array.isArray(editor.mimes)) {\n\t\t\t\t\t\t\t\t\tmimesSingle = mimesSingle.concat(editor.mimes);\n\t\t\t\t\t\t\t\t\tif (!editor.info || !editor.info.single) {\n\t\t\t\t\t\t\t\t\t\tmimes = mimes.concat(editor.mimes);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!allowAll && editor.mimes && editor.mimes[0] === '*') {\n\t\t\t\t\t\t\t\t\tallowAll = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!editor.info) {\n\t\t\t\t\t\t\t\t\teditor.info = {};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (editor.info.integrate) {\n\t\t\t\t\t\t\t\t\tfm.trigger('helpIntegration', Object.assign({cmd: 'edit'}, editor.info.integrate));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (editor.info.canMakeEmpty) {\n\t\t\t\t\t\t\t\t\tfm.trigger('canMakeEmptyFile', {mimes: Array.isArray(editor.info.canMakeEmpty)? editor.info.canMakeEmpty : editor.mimes});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tmimesSingle = ($.uniqueSort || $.unique)(mimesSingle);\n\t\t\t\t\t\tmimes = ($.uniqueSort || $.unique)(mimes);\n\t\t\t\t\t\t\n\t\t\t\t\t\topts.editors = $.grep(opts.editors, function(e) {\n\t\t\t\t\t\t\treturn e.disabled? false : true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('select', function() {\n\t\t\t\teditors = null;\n\t\t\t})\n\t\t\t.bind('contextmenucreate', function(e) {\n\t\t\t\tvar file, editor,\n\t\t\t\t\tsingle = function(editor) {\n\t\t\t\t\t\tvar title = self.title;\n\t\t\t\t\t\tfm.one('contextmenucreatedone', function() {\n\t\t\t\t\t\t\tself.title = title;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tself.title = fm.escape(editor.i18n);\n\t\t\t\t\t\tif (editor.info && editor.info.iconImg) {\n\t\t\t\t\t\t\tself.contextmenuOpts = {\n\t\t\t\t\t\t\t\ticonImg: fm.baseUrl + editor.info.iconImg\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete self.variants;\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tself.contextmenuOpts = void(0);\n\t\t\t\tif (e.data.type === 'files' && self.enabled()) {\n\t\t\t\t\tfile = fm.file(e.data.targets[0]);\n\t\t\t\t\tif (setEditors(file, e.data.targets.length)) {\n\t\t\t\t\t\tif (Object.keys(editors).length > 1) {\n\t\t\t\t\t\t\tif (!useStoredEditor() || !(editor = getStoredEditor(file.mime))) {\n\t\t\t\t\t\t\t\tdelete self.extra;\n\t\t\t\t\t\t\t\tself.variants = [];\n\t\t\t\t\t\t\t\t$.each(editors, function(id, editor) {\n\t\t\t\t\t\t\t\t\tself.variants.push([{ editor: editor }, editor.i18n, editor.info && editor.info.iconImg? fm.baseUrl + editor.info.iconImg : 'edit']);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsingle(editor);\n\t\t\t\t\t\t\t\tself.extra = {\n\t\t\t\t\t\t\t\t\ticon: 'menu',\n\t\t\t\t\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t\t\t\t\t.attr({title: fm.i18n('select')})\n\t\t\t\t\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(this);\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t\t\t\traw: getSubMenuRaw(fm.selectedFiles(), function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar hashes = fm.selected();\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('edit', hashes, {editor: this});\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.trigger('selectfiles', {files : hashes});\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\t\t\t\t\t\t\ty: node.offset().top\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsingle(editors[Object.keys(editors)[0]]);\n\t\t\t\t\t\t\tdelete self.extra;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('canMakeEmptyFile', function(e) {\n\t\t\t\tif (e.data && e.data.resetTexts) {\n\t\t\t\t\tvar defs = fm.arrayFlip(self.options.makeTextMimes || ['text/plain']),\n\t\t\t\t\t\thides = self.getMkfileHides();\n\n\t\t\t\t\t$.each((fm.storage('mkfileTextMimes') || {}), function(mime, type) {\n\t\t\t\t\t\tif (!defs[mime]) {\n\t\t\t\t\t\t\tdelete fm.mimesCanMakeEmpty[mime];\n\t\t\t\t\t\t\tdelete hides[mime];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfm.storage('mkfileTextMimes', null);\n\t\t\t\t\tif (Object.keys(hides).length) {\n\t\t\t\t\t\tfm.storage('mkfileHides', hides);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.storage('mkfileHides', null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\n\t\t\treturn cnt && filter(sel).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(select, opts) {\n\t\t\tvar fm    = this.fm, \n\t\t\t\tfiles = filter(this.files(select)),\n\t\t\t\thashes = $.map(files, function(f) { return f.hash; }),\n\t\t\t\tlist  = [],\n\t\t\t\teditor = opts && opts.editor? opts.editor : null,\n\t\t\t\tnode = $(opts && opts._currentNode? opts._currentNode : fm.cwdHash2Elm(hashes[0])),\n\t\t\t\tgetEditor = function() {\n\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\tstoredId;\n\t\t\t\t\t\n\t\t\t\t\tif (!editor && Object.keys(editors).length > 1) {\n\t\t\t\t\t\tif (useStoredEditor() && (editor = getStoredEditor(files[0].mime))) {\n\t\t\t\t\t\t\treturn dfd.resolve(editor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: getSubMenuRaw(files, function() {\n\t\t\t\t\t\t\t\tdfd.resolve(this);\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\t\ty: node.offset().top + 22,\n\t\t\t\t\t\t\topened: function() {\n\t\t\t\t\t\t\t\tfm.one('closecontextmenu',function() {\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\tif (dfd.state() === 'pending') {\n\t\t\t\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.trigger('selectfiles', {files : hashes});\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tObject.keys(editors).length > 1 && editor && store(files[0].mime, editor);\n\t\t\t\t\t\treturn dfd.resolve(editor? editor : (Object.keys(editors).length? editors[Object.keys(editors)[0]] : null));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\tfile;\n\n\t\t\tif (editors === null) {\n\t\t\t\tsetEditors(files[0], hashes.length);\n\t\t\t}\n\t\t\t\n\t\t\tif (!node.length) {\n\t\t\t\tnode = fm.getUI('cwd');\n\t\t\t}\n\t\t\t\n\t\t\tgetEditor().done(function(editor) {\n\t\t\t\twhile ((file = files.shift())) {\n\t\t\t\t\tlist.push(edit(file, (file.encoding || void(0)), editor).fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (list.length) { \n\t\t\t\t\t$.when.apply(null, list).done(function() {\n\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfrd.reject();\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\tdfrd.reject();\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t\tthis.getMkfileHides = function() {\n\t\t\treturn fm.storage('mkfileHides') || fm.arrayFlip(self.options.mkfileHideMimes || []);\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});"]}