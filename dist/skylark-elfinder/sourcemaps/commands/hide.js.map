{"version":3,"sources":["commands/hide.js"],"names":["define","elFinder","prototype","commands","hide","hideData","hideCnt","cMenuType","sOrigin","self","this","nameCache","syncTitleOnChange","shortcuts","pattern","description","fm","i18n","init","storage","items","Object","keys","length","title","show","update","bind","e","sel","data","selected","targets","type","origin","cwd","hash","requestAnimationFrame","getstate","cookieEnabled","exec","hashes","opts","files","res","dfrd","$","Deferred","done","trigger","fail","error","o","added","isPlainObject","_currentType","reset","each","h","f","file","searchStatus","state","phash","push","updateCache","add","resolve","i","i18","name","remove","removed","undo","cmd","callback","nData","redo"],"mappings":"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","file":"../../commands/hide.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"hide\".\n\t * folders/files to hide as personal setting.\n\t *\n\t * @type  elFinder.command\n\t * @author  Naoki Sawada\n\t */\n\telFinder.prototype.commands.hide = function() {\n\t\t\"use strict\";\n\n\t\tvar self = this,\n\t\t\tnameCache = {},\n\t\t\thideData, hideCnt, cMenuType, sOrigin;\n\n\t\tthis.syncTitleOnChange = true;\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern : 'ctrl+shift+dot',\n\t\t\tdescription : this.fm.i18n('toggleHidden')\n\t\t}];\n\n\t\tthis.init = function() {\n\t\t\tvar fm = this.fm;\n\t\t\t\n\t\t\thideData = fm.storage('hide') || {items: {}};\n\t\t\thideCnt = Object.keys(hideData.items).length;\n\n\t\t\tthis.title = fm.i18n(hideData.show? 'hideHidden' : 'showHidden');\n\t\t\tself.update(void(0), self.title);\n\t\t};\n\n\t\tthis.fm.bind('select contextmenucreate closecontextmenu', function(e, fm) {\n\t\t\tvar sel = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected();\n\t\t\tif (e.type === 'select' && e.data) {\n\t\t\t\tsOrigin = e.data.origin;\n\t\t\t} else if (e.type === 'contextmenucreate') {\n\t\t\t\tcMenuType = e.data.type;\n\t\t\t}\n\t\t\tif (!sel.length || (((e.type !== 'contextmenucreate' && sOrigin !== 'navbar') || cMenuType === 'cwd') && sel[0] === fm.cwd().hash)) {\n\t\t\t\tself.title = fm.i18n(hideData.show? 'hideHidden' : 'showHidden');\n\t\t\t} else {\n\t\t\t\tself.title = fm.i18n('cmdhide');\n\t\t\t}\n\t\t\tif (e.type !== 'closecontextmenu') {\n\t\t\t\tself.update(cMenuType === 'cwd'? (hideCnt? 0 : -1) : void(0), self.title);\n\t\t\t} else {\n\t\t\t\tcMenuType = '';\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.update(void(0), self.title);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.getstate = function(sel) {\n\t\t\treturn (this.fm.cookieEnabled && cMenuType !== 'cwd' && (sel || this.fm.selected()).length) || hideCnt? 0 : -1;\n\t\t};\n\n\t\tthis.exec = function(hashes, opts) {\n\t\t\tvar fm = this.fm,\n\t\t\t\tdfrd = $.Deferred()\n\t\t\t\t\t.done(function() {\n\t\t\t\t\t\tfm.trigger('hide', {items: items, opts: opts});\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tfm.error(error);\n\t\t\t\t\t}),\n\t\t\t\to = opts || {},\n\t\t\t\titems = o.targets? o.targets : (hashes || fm.selected()),\n\t\t\t\tadded = [],\n\t\t\t\tremoved = [],\n\t\t\t\tnotifyto, files, res;\n\n\t\t\thideData = fm.storage('hide') || {};\n\t\t\tif (!$.isPlainObject(hideData)) {\n\t\t\t\thideData = {};\n\t\t\t}\n\t\t\tif (!$.isPlainObject(hideData.items)) {\n\t\t\t\thideData.items = {};\n\t\t\t}\n\t\t\tif (opts._currentType === 'shortcut' || !items.length || (opts._currentType !== 'navbar' && sOrigin !=='navbar' && items[0] === fm.cwd().hash)) {\n\t\t\t\tif (hideData.show) {\n\t\t\t\t\to.hide = true;\n\t\t\t\t} else if (Object.keys(hideData.items).length) {\n\t\t\t\t\to.show = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (o.reset) {\n\t\t\t\to.show = true;\n\t\t\t\thideCnt = 0;\n\t\t\t}\n\t\t\tif (o.show || o.hide) {\n\t\t\t\tif (o.show) {\n\t\t\t\t\thideData.show = true;\n\t\t\t\t} else {\n\t\t\t\t\tdelete hideData.show;\n\t\t\t\t}\n\t\t\t\tif (o.show) {\n\t\t\t\t\tfm.storage('hide', o.reset? null : hideData);\n\t\t\t\t\tself.title = fm.i18n('hideHidden');\n\t\t\t\t\tself.update(o.reset? -1 : void(0), self.title);\n\t\t\t\t\t$.each(hideData.items, function(h) {\n\t\t\t\t\t\tvar f = fm.file(h, true);\n\t\t\t\t\t\tif (f && (fm.searchStatus.state || !f.phash || fm.file(f.phash))) {\n\t\t\t\t\t\t\tadded.push(f);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (added.length) {\n\t\t\t\t\t\tfm.updateCache({added: added});\n\t\t\t\t\t\tfm.add({added: added});\n\t\t\t\t\t}\n\t\t\t\t\tif (o.reset) {\n\t\t\t\t\t\thideData = {items: {}};\n\t\t\t\t\t}\n\t\t\t\t\treturn dfrd.resolve();\n\t\t\t\t}\n\t\t\t\titems = Object.keys(hideData.items);\n\t\t\t}\n\n\t\t\tif (items.length) {\n\t\t\t\t$.each(items, function(i, h) {\n\t\t\t\t\tvar f;\n\t\t\t\t\tif (!hideData.items[h]) {\n\t\t\t\t\t\tf = fm.file(h);\n\t\t\t\t\t\tif (f) {\n\t\t\t\t\t\t\tnameCache[h] = f.i18 || f.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thideData.items[h] = nameCache[h]? nameCache[h] : h;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thideCnt = Object.keys(hideData.items).length;\n\t\t\t\tfiles = this.files(items);\n\t\t\t\tfm.storage('hide', hideData);\n\t\t\t\tfm.remove({removed: items});\n\t\t\t\tif (hideData.show) {\n\t\t\t\t\tthis.exec(void(0), {hide: true});\n\t\t\t\t}\n\t\t\t\tif (!o.hide) {\n\t\t\t\t\tres = {};\n\t\t\t\t\tres.undo = {\n\t\t\t\t\t\tcmd : 'hide',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tvar nData = fm.storage('hide');\n\t\t\t\t\t\t\tif (nData) {\n\t\t\t\t\t\t\t\t$.each(items, function(i, h) {\n\t\t\t\t\t\t\t\t\tdelete nData.items[h];\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\thideCnt = Object.keys(nData.items).length;\n\t\t\t\t\t\t\t\tfm.storage('hide', nData);\n\t\t\t\t\t\t\t\tfm.trigger('hide', {items: items, opts: {}});\n\t\t\t\t\t\t\t\tself.update(hideCnt? 0 : -1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.updateCache({added: files});\n\t\t\t\t\t\t\tfm.add({added: files});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tres.redo = {\n\t\t\t\t\t\tcmd : 'hide',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\treturn fm.exec('hide', void(0), {targets: items});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn dfrd.state() == 'rejected' ? dfrd : dfrd.resolve(res);\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});"]}