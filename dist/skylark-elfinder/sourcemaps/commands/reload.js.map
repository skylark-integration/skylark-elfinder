{"version":3,"sources":["commands/reload.js"],"names":["define","elFinder","prototype","commands","reload","self","this","search","alwaysEnabled","updateOnSelect","shortcuts","pattern","getstate","init","fm","bind","type","options","sync","extra","icon","node","$","attr","title","i18n","on","e","originalEvent","touches","length","stopPropagation","preventDefault","parent","toggleClass","syncStart","removeClass","autoSync","css","exec","dfrd","timeout","setTimeout","notify","cnt","hideCnt","always","notifyDelay","clearTimeout","trigger","res","click","forceLoad"],"mappings":";;;;;;;AAAAA,QACC,eACC,SAASC,GA0EV,OAnECA,EAASC,UAAUC,SAASC,OAAS,WACrC,aACA,IAAIC,EAASC,KACZC,GAAS,EAEVD,KAAKE,eAAgB,EACrBF,KAAKG,gBAAiB,EAEtBH,KAAKI,YACJC,QAAc,oBAGfL,KAAKM,SAAW,WACf,OAAO,GAGRN,KAAKO,KAAO,WACXP,KAAKQ,GAAGC,KAAK,mBAAoB,WAChCR,EAAsB,UAAbD,KAAKU,QAIhBV,KAAKQ,GAAGC,KAAK,cAAe,WAC3B,IAAID,EAAKT,EAAKS,GACVA,EAAGG,QAAQC,MAAQ,MACtBb,EAAKc,OACJC,KAAM,SACNC,KAAMC,EAAE,WACNC,MAAMC,MAAOV,EAAGW,KAAK,cACrBC,GAAG,mBAAoB,SAASC,GACjB,eAAXA,EAAEX,MAAyBW,EAAEC,cAAcC,QAAQC,OAAS,IAGhEH,EAAEI,kBACFJ,EAAEK,iBACFV,EAAEhB,MAAM2B,SACNC,YAAY,oBAAqBpB,EAAGG,QAAQkB,WAC5CF,SAASG,YAAY,kBACvBtB,EAAGG,QAAQkB,WAAarB,EAAGG,QAAQkB,UACnCrB,EAAGuB,SAASvB,EAAGG,QAAQkB,UAAW,KAAO,WACvCT,GAAG,QAAS,WACdJ,EAAEhB,MAAM2B,SAASC,YAAY,qBAAsBpB,EAAGG,QAAQkB,WAAWG,IAAI,iBAAkB,cAMpGhC,KAAKiC,KAAO,WACX,IAAIzB,EAAKR,KAAKQ,GACd,IAAKP,EAAQ,CACZ,IAAIiC,EAAU1B,EAAGI,OAChBuB,EAAUC,WAAW,WACpB5B,EAAG6B,QAAQ3B,KAAO,SAAU4B,IAAM,EAAGC,SAAU,IAC/CL,EAAKM,OAAO,WAAahC,EAAG6B,QAAQ3B,KAAO,SAAU4B,KAAQ,OAC3D9B,EAAGiC,aAEP,OAAOP,EAAKM,OAAO,WAClBE,aAAaP,GACb3B,EAAGmC,QAAQ,YAGZ3B,EAAE,8BAA8BR,EAAGoC,IAAI,QAAS,aAAe,0BAA0BC,WAIzFjD,WAAckD,WAAY,GAEtBnD","file":"../../commands/reload.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"reload\"\n\t * Sync files and folders\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t(elFinder.prototype.commands.reload = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\t\tsearch = false;\n\t\t\n\t\tthis.alwaysEnabled = true;\n\t\tthis.updateOnSelect = true;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+shift+r f5'\n\t\t}];\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.init = function() {\n\t\t\tthis.fm.bind('search searchend', function() {\n\t\t\t\tsearch = this.type == 'search';\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.fm.bind('contextmenu', function(){\n\t\t\tvar fm = self.fm;\n\t\t\tif (fm.options.sync >= 1000) {\n\t\t\t\tself.extra = {\n\t\t\t\t\ticon: 'accept',\n\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t.attr({title: fm.i18n('autoSync')})\n\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t$(this).parent()\n\t\t\t\t\t\t\t\t.toggleClass('ui-state-disabled', fm.options.syncStart)\n\t\t\t\t\t\t\t\t.parent().removeClass('ui-state-hover');\n\t\t\t\t\t\t\tfm.options.syncStart = !fm.options.syncStart;\n\t\t\t\t\t\t\tfm.autoSync(fm.options.syncStart? null : 'stop');\n\t\t\t\t\t\t}).on('ready', function(){\n\t\t\t\t\t\t\t$(this).parent().toggleClass('ui-state-disabled', !fm.options.syncStart).css('pointer-events', 'auto');\n\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar fm = this.fm;\n\t\t\tif (!search) {\n\t\t\t\tvar dfrd    = fm.sync(),\n\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\tfm.notify({type : 'reload', cnt : 1, hideCnt : true});\n\t\t\t\t\t\tdfrd.always(function() { fm.notify({type : 'reload', cnt  : -1}); });\n\t\t\t\t\t}, fm.notifyDelay);\n\t\t\t\t\t\n\t\t\t\treturn dfrd.always(function() { \n\t\t\t\t\tclearTimeout(timeout); \n\t\t\t\t\tfm.trigger('reload');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t$('div.elfinder-toolbar > div.'+fm.res('class', 'searchbtn') + ' > span.ui-icon-search').click();\n\t\t\t}\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});"]}