{"version":3,"sources":["commands/resize.js"],"names":["define","elFinder","prototype","commands","resize","fm","this","losslessRotate","updateOnSelect","getstate","sel","selectedFiles","length","read","write","mime","indexOf","resizeRequest","data","f","dfrd","error","file","target","tmb","isCommandEnabled","request","Object","assign","cmd","notify","type","cnt","fail","reject","done","quality","storage","option","resolve","name","$","Deferred","exec","hashes","id","dialog","self","files","api2","api","options","fmnode","getUI","ctrgrup","controlgroup","grid8Def","grid8px","presetSize","Array","isArray","clsediting","res","open","src","pickimg","pickcanv","pickctx","dMinBtn","base","hasC","sets","isJpeg","input","row","label","changeTm","operate","opStart","opStop","control","trigger","on","cancelAnimationFrame","requestAnimationFrame","panel","quty","canvas","ctx","img","sx","sy","sw","sh","deg","theta","bb","sizeImg","children","find","is","get","hasClass","width","val","height","drawImage","pointX","pointY","offsetX","offsetY","degree","Math","PI","w","h","srcPts","x","y","dstPts","min","Number","MAX_VALUE","max","MIN_VALUE","each","i","srcPt","push","cos","sin","pt","getBounceBox","owidth","oheight","save","fillStyle","bg","fillRect","translate","rotate","restore","toBlob","blob","next","text","formatSize","size","e","preview","stopPropagation","preventDefault","spinner","i18n","rhandle","rhandlec","uiresize","uicrop","uirotate","uideg270","attr","append","uideg90","uiprop","reset","resetView","button","icons","primary","uitype","mode","resizable","croppable","rotateable","show","hide","insertAfter","round","parseInt","cratio","ratio","updateView","addClass","crop","q","value","update","uidegslider","slider","animate","start","stop","change","event","ui","slide","off","keyCode","LEFT","RIGHT","end","pickc","pick","color","r","g","b","setbg","palpick","css","s","m","cc","match","getColorCode","backgroundColor","backgroundImage","imgr","removeClass","pallet","map","c","toString","slice","join","picker","reseter","prop","cratioc","pwidth","pheight","rwidth","rheight","rdegree","grid8","constr","html","fixHeight","_aspectRatio","constrc","toggleClass","setStep8","step","setuprimg","r_scale","parent","sqrt","pow","ceil","isCORS","setColorData","canvSrc","setupimg","basec","imgc","jpgCalc","n","l","hsl","hue","scale","tx1","tx2","ty1","ty2","rgb","palc","domi","domic","rgbToHsl","rgbRound","calc","getImageData","v","sort","a","dimreq","inited","setdim","dim","rfile","hash","init","elm","memSize","imgRatio","state","naturalWidth","removeAttr","naturalHeight","outerHeight","remove","document","createElement","getContext","setupPicker","preset","btn","presetc","filter","cOpts","ENTER","title","accept","callback","cancel","useSaveAs","saveAs","confirm","$this","replace","UA","Mobile","coverc","floor","toFixed","updateHandle","position","left","top","resize_update","drag_update","mouseStartAngle","imageStartAngle","imageBeingRotated","setQuality","Opera","ltIE8","execute","imageCentre","getCenter","ev","originalEvent","touches","mouseXFromCentre","pageX","mouseYFromCentre","pageY","rotateAngle","atan2","parseFloat","shiftKey","mouseStartXFromCentre","mouseStartYFromCentre","image","currentRotation","imageOffset","offset","imageCentreX","imageCentreY","destroy","alsoResize","aspectRatio","dinit","draggable","containment","handles","handle","drag","checkVals","d","vals","elfinderdialog","dialogs","fadeIn","disable","make","prefix","requestCmd","nextAction","phash","proxy","dfd","added","url","async","temporary","when","encoding","content","convAbsUrl","syncOnFail","normalize","updateCache","changed","escape","always","reqOpen","dialogClass","fadeOut","enable","searchStatus","cwd","thash","one","buttons","hline","vline","rpoint","canv","removeData","dw","ctrW","prvW","win","dialogContained","window","winH","winW","presW","presIn","outerWidth","float","marginLeft","marginRight","clone","uploadMimeCheck","fmDialog","doDimReq","force","substitute","substituteImg","needPng","split","image/jpeg","image/png","image/gif","dimSubImgSize","hasSize","bind","getDimThreshold","close","unbind","minimize","closest","opacity","background-color","border-color","namespace","openUrl","findProperty","styleObject","styleArgs","cssHooks","elem","computed","extra","set","transform","style","fn","opera","fx","now","addEventListener","getElementsByClassName","StaticToAbsolute","element","currentStyle","xy","pnode","offsetLeft","offsetTop","offsetParent","body","documentElement","scrollLeft","scrollTop","GetAbsoluteXY","transform_set","apply","m11","m12","m21","m22","radian","cosX","sinY","ow","oh","absCosX","abs","absSinY","dx","dy","marginTop","IETransform","jQuery"],"mappings":"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","file":"../../commands/resize.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"resize\"\n\t * Open dialog to resize image\n\t *\n\t * @author Dmitry (dio) Levashov\n\t * @author Alexey Sukhotin\n\t * @author Naoki Sawada\n\t * @author Sergio Jovani\n\t **/\n\telFinder.prototype.commands.resize = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm,\n\t\t\tlosslessRotate = 0,\n\t\t\tgetBounceBox = function(w, h, theta) {\n\t\t\t\tvar srcPts = [\n\t\t\t\t\t\t{x: w/2, y: h/2},\n\t\t\t\t\t\t{x: -w/2, y: h/2},\n\t\t\t\t\t\t{x: -w/2, y: -h/2},\n\t\t\t\t\t\t{x: w/2, y: -h/2}\n\t\t\t\t\t],\n\t\t\t\t\tdstPts = [],\n\t\t\t\t\tmin = {x: Number.MAX_VALUE, y: Number.MAX_VALUE},\n\t\t\t\t\tmax = {x: Number.MIN_VALUE, y: Number.MIN_VALUE};\n\t\t\t\t$.each(srcPts, function(i, srcPt){\n\t\t\t\t\tdstPts.push({\n\t\t\t\t\t\tx: srcPt.x * Math.cos(theta) - srcPt.y * Math.sin(theta),\n\t\t\t\t\t\ty: srcPt.x * Math.sin(theta) + srcPt.y * Math.cos(theta)\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t$.each(dstPts, function(i, pt) {\n\t\t\t\t\tmin.x = Math.min(min.x, pt.x);\n\t\t\t\t\tmin.y = Math.min(min.y, pt.y);\n\t\t\t\t\tmax.x = Math.max(max.x, pt.x);\n\t\t\t\t\tmax.y = Math.max(max.y, pt.y);\n\t\t\t\t});\n\t\t\t\treturn {\n\t\t\t\t\twidth: max.x - min.x, height: max.y - min.y\n\t\t\t\t};\n\t\t\t};\n\t\t\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\tvar sel = fm.selectedFiles();\n\t\t\treturn sel.length == 1 && sel[0].read && sel[0].write && sel[0].mime.indexOf('image/') !== -1 ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.resizeRequest = function(data, f, dfrd) {\n\t\t\tvar file = f || fm.file(data.target),\n\t\t\t\ttmb  = file? file.tmb : null,\n\t\t\t\tenabled = fm.isCommandEnabled('resize', data.target);\n\t\t\t\n\t\t\tif (enabled && (! file || (file && file.read && file.write && file.mime.indexOf('image/') !== -1 ))) {\n\t\t\t\treturn fm.request({\n\t\t\t\t\tdata : Object.assign(data, {\n\t\t\t\t\t\tcmd : 'resize'\n\t\t\t\t\t}),\n\t\t\t\t\tnotify : {type : 'resize', cnt : 1}\n\t\t\t\t})\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tif (dfrd) {\n\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.done(function() {\n\t\t\t\t\tif (data.quality) {\n\t\t\t\t\t\tfm.storage('jpgQuality', data.quality === fm.option('jpgQuality')? null : data.quality);\n\t\t\t\t\t}\n\t\t\t\t\tdfrd && dfrd.resolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar error;\n\t\t\t\t\n\t\t\t\tif (file) {\n\t\t\t\t\tif (file.mime.indexOf('image/') === -1) {\n\t\t\t\t\t\terror = ['errResize', file.name, 'errUsupportType'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror = ['errResize', file.name, 'errPerm'];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terror = ['errResize', data.target, 'errPerm'];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (dfrd) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t} else {\n\t\t\t\t\tfm.error(error);\n\t\t\t\t}\n\t\t\t\treturn $.Deferred().reject(error);\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar self  = this,\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tdfrd  = $.Deferred(),\n\t\t\t\tapi2  = (fm.api > 1),\n\t\t\t\toptions = this.options,\n\t\t\t\tdialogWidth = 650,\n\t\t\t\tfmnode = fm.getUI(),\n\t\t\t\tctrgrup = $().controlgroup? 'controlgroup' : 'buttonset',\n\t\t\t\tgrid8Def = typeof options.grid8px === 'undefined' || options.grid8px !== 'disable'? true : false,\n\t\t\t\tpresetSize = Array.isArray(options.presetSize)? options.presetSize : [],\n\t\t\t\tclactive = 'elfinder-dialog-active',\n\t\t\t\tclsediting = fm.res('class', 'editing'),\n\t\t\t\topen = function(file, id, src) {\n\t\t\t\t\tvar isJpeg   = (file.mime === 'image/jpeg'),\n\t\t\t\t\t\tdialog   = $('<div class=\"elfinder-resize-container\"/>'),\n\t\t\t\t\t\tinput    = '<input type=\"number\" class=\"ui-corner-all\"/>',\n\t\t\t\t\t\trow      = '<div class=\"elfinder-resize-row\"/>',\n\t\t\t\t\t\tlabel    = '<div class=\"elfinder-resize-label\"/>',\n\t\t\t\t\t\tchangeTm = null,\n\t\t\t\t\t\toperate  = false,\n\t\t\t\t\t\topStart  = function() { operate = true; },\n\t\t\t\t\t\topStop   = function() {\n\t\t\t\t\t\t\tif (operate) {\n\t\t\t\t\t\t\t\toperate = false;\n\t\t\t\t\t\t\t\tcontrol.trigger('change');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcontrol  = $('<div class=\"elfinder-resize-control\"/>')\n\t\t\t\t\t\t\t.on('focus', 'input[type=text],input[type=number]', function() {\n\t\t\t\t\t\t\t\t$(this).trigger('select');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tchangeTm && cancelAnimationFrame(changeTm);\n\t\t\t\t\t\t\t\tchangeTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tvar panel, quty, canvas, ctx, img, sx, sy, sw, sh, deg, theta, bb;\n\t\t\t\t\t\t\t\t\tif (sizeImg && ! operate && (canvas = sizeImg.data('canvas'))) {\n\t\t\t\t\t\t\t\t\t\tpanel = control.children('div.elfinder-resize-control-panel:visible');\n\t\t\t\t\t\t\t\t\t\tquty = panel.find('input.elfinder-resize-quality');\n\t\t\t\t\t\t\t\t\t\tif (quty.is(':visible')) {\n\t\t\t\t\t\t\t\t\t\t\tctx = sizeImg.data('ctx');\n\t\t\t\t\t\t\t\t\t\t\timg = sizeImg.get(0);\n\t\t\t\t\t\t\t\t\t\t\tif (panel.hasClass('elfinder-resize-uiresize')) {\n\t\t\t\t\t\t\t\t\t\t\t\t// resize\n\t\t\t\t\t\t\t\t\t\t\t\tsw = canvas.width = width.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsh = canvas.height = height.val();\n\t\t\t\t\t\t\t\t\t\t\t\tctx.drawImage(img, 0, 0, sw, sh);\n\t\t\t\t\t\t\t\t\t\t\t} else if (panel.hasClass('elfinder-resize-uicrop')) {\n\t\t\t\t\t\t\t\t\t\t\t\t// crop\n\t\t\t\t\t\t\t\t\t\t\t\tsx = pointX.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsy = pointY.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsw = offsetX.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsh = offsetY.val();\n\t\t\t\t\t\t\t\t\t\t\t\tcanvas.width = sw;\n\t\t\t\t\t\t\t\t\t\t\t\tcanvas.height = sh;\n\t\t\t\t\t\t\t\t\t\t\t\tctx.drawImage(img, sx, sy, sw, sh, 0, 0, sw, sh);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t// rotate\n\t\t\t\t\t\t\t\t\t\t\t\tdeg = degree.val();\n\t\t\t\t\t\t\t\t\t\t\t\ttheta = (degree.val() * Math.PI) / 180;\n\t\t\t\t\t\t\t\t\t\t\t\tbb = getBounceBox(owidth, oheight, theta);\n\t\t\t\t\t\t\t\t\t\t\t\tsw = canvas.width = bb.width;\n\t\t\t\t\t\t\t\t\t\t\t\tsh = canvas.height = bb.height;\n\t\t\t\t\t\t\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t\t\t\t\t\t\tif (deg % 90 !== 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tctx.fillStyle = bg.val() || '#FFF';\n\t\t\t\t\t\t\t\t\t\t\t\t\tctx.fillRect(0, 0, sw, sh);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tctx.translate(sw / 2, sh / 2);\n\t\t\t\t\t\t\t\t\t\t\t\tctx.rotate(theta);\n\t\t\t\t\t\t\t\t\t\t\t\tctx.drawImage(img, -img.width/2, -img.height/2, owidth, oheight);\n\t\t\t\t\t\t\t\t\t\t\t\tctx.restore();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tcanvas.toBlob(function(blob) {\n\t\t\t\t\t\t\t\t\t\t\t\tblob && quty.next('span').text(' (' + fm.formatSize(blob.size) + ')');\n\t\t\t\t\t\t\t\t\t\t\t}, 'image/jpeg', Math.max(Math.min(quty.val(), 100), 1) / 100);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('mouseup', 'input', function(e) {\n\t\t\t\t\t\t\t\t$(e.target).trigger('change');\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tpreview  = $('<div class=\"elfinder-resize-preview\"/>')\n\t\t\t\t\t\t\t.on('touchmove', function(e) {\n\t\t\t\t\t\t\t\tif ($(e.target).hasClass('touch-punch')) {\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tspinner  = $('<div class=\"elfinder-resize-loading\">'+fm.i18n('ntfloadimg')+'</div>'),\n\t\t\t\t\t\trhandle  = $('<div class=\"elfinder-resize-handle touch-punch\"/>'),\n\t\t\t\t\t\trhandlec = $('<div class=\"elfinder-resize-handle touch-punch\"/>'),\n\t\t\t\t\t\tuiresize = $('<div class=\"elfinder-resize-uiresize elfinder-resize-control-panel\"/>'),\n\t\t\t\t\t\tuicrop   = $('<div class=\"elfinder-resize-uicrop elfinder-resize-control-panel\"/>'),\n\t\t\t\t\t\tuirotate = $('<div class=\"elfinder-resize-rotate elfinder-resize-control-panel\"/>'),\n\t\t\t\t\t\tuideg270 = $('<button/>').attr('title',fm.i18n('rotate-cw')).append($('<span class=\"elfinder-button-icon elfinder-button-icon-rotate-l\"/>')),\n\t\t\t\t\t\tuideg90  = $('<button/>').attr('title',fm.i18n('rotate-ccw')).append($('<span class=\"elfinder-button-icon elfinder-button-icon-rotate-r\"/>')),\n\t\t\t\t\t\tuiprop   = $('<span />'),\n\t\t\t\t\t\treset    = $('<button class=\"elfinder-resize-reset\">').text(fm.i18n('reset'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tresetView();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\tprimary: 'ui-icon-arrowrefresh-1-n'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tuitype   = $('<div class=\"elfinder-resize-type\"/>')\n\t\t\t\t\t\t\t.append('<input type=\"radio\" name=\"type\" id=\"'+id+'-resize\" value=\"resize\" checked=\"checked\" /><label for=\"'+id+'-resize\">'+fm.i18n('resize')+'</label>',\n\t\t\t\t\t\t\t'<input class=\"api2\" type=\"radio\" name=\"type\" id=\"'+id+'-crop\" value=\"crop\" /><label class=\"api2\" for=\"'+id+'-crop\">'+fm.i18n('crop')+'</label>',\n\t\t\t\t\t\t\t'<input class=\"api2\" type=\"radio\" name=\"type\" id=\"'+id+'-rotate\" value=\"rotate\" /><label class=\"api2\" for=\"'+id+'-rotate\">'+fm.i18n('rotate')+'</label>'),\n\t\t\t\t\t\tmode     = 'resize',\n\t\t\t\t\t\ttype     = uitype[ctrgrup]()[ctrgrup]('disable').find('input')\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tmode = $(this).val();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tresetView();\n\t\t\t\t\t\t\t\tresizable(true);\n\t\t\t\t\t\t\t\tcroppable(true);\n\t\t\t\t\t\t\t\trotateable(true);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (mode == 'resize') {\n\t\t\t\t\t\t\t\t\tuiresize.show();\n\t\t\t\t\t\t\t\t\tuirotate.hide();\n\t\t\t\t\t\t\t\t\tuicrop.hide();\n\t\t\t\t\t\t\t\t\tresizable();\n\t\t\t\t\t\t\t\t\tisJpeg && grid8px.insertAfter(uiresize.find('.elfinder-resize-grid8'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (mode == 'crop') {\n\t\t\t\t\t\t\t\t\tuirotate.hide();\n\t\t\t\t\t\t\t\t\tuiresize.hide();\n\t\t\t\t\t\t\t\t\tuicrop.show();\n\t\t\t\t\t\t\t\t\tcroppable();\n\t\t\t\t\t\t\t\t\tisJpeg && grid8px.insertAfter(uicrop.find('.elfinder-resize-grid8'));\n\t\t\t\t\t\t\t\t} else if (mode == 'rotate') {\n\t\t\t\t\t\t\t\t\tuiresize.hide();\n\t\t\t\t\t\t\t\t\tuicrop.hide();\n\t\t\t\t\t\t\t\t\tuirotate.show();\n\t\t\t\t\t\t\t\t\trotateable();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\twidth   = $(input)\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tvar w = round(parseInt(width.val())),\n\t\t\t\t\t\t\t\t\th = round(cratio ? w/ratio : parseInt(height.val()));\n\n\t\t\t\t\t\t\t\tif (w > 0 && h > 0) {\n\t\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\t\twidth.val(w);\n\t\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).addClass('elfinder-focus'),\n\t\t\t\t\t\theight  = $(input)\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tvar h = round(parseInt(height.val())),\n\t\t\t\t\t\t\t\t\tw = round(cratio ? h*ratio : parseInt(width.val()));\n\n\t\t\t\t\t\t\t\tif (w > 0 && h > 0) {\n\t\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\t\twidth.val(w);\n\t\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tpointX  = $(input).on('change', function(){crop.updateView();}),\n\t\t\t\t\t\tpointY  = $(input).on('change', function(){crop.updateView();}),\n\t\t\t\t\t\toffsetX = $(input).on('change', function(){crop.updateView('w');}),\n\t\t\t\t\t\toffsetY = $(input).on('change', function(){crop.updateView('h');}),\n\t\t\t\t\t\tquality = isJpeg && api2?\n\t\t\t\t\t\t\t$(input).val(fm.storage('jpgQuality') > 0? fm.storage('jpgQuality') : fm.option('jpgQuality'))\n\t\t\t\t\t\t\t\t.addClass('elfinder-resize-quality')\n\t\t\t\t\t\t\t\t.attr('min', '1').attr('max', '100').attr('title', '1 - 100')\n\t\t\t\t\t\t\t\t.on('blur', function(){\n\t\t\t\t\t\t\t\t\tvar q = Math.min(100, Math.max(1, parseInt(this.value)));\n\t\t\t\t\t\t\t\t\tcontrol.find('input.elfinder-resize-quality').val(q);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tdegree = $('<input type=\"number\" class=\"ui-corner-all\" maxlength=\"3\" value=\"0\" />')\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\trotate.update();\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tuidegslider = $('<div class=\"elfinder-resize-rotate-slider touch-punch\"/>')\n\t\t\t\t\t\t\t.slider({\n\t\t\t\t\t\t\t\tmin: 0,\n\t\t\t\t\t\t\t\tmax: 360,\n\t\t\t\t\t\t\t\tvalue: degree.val(),\n\t\t\t\t\t\t\t\tanimate: true,\n\t\t\t\t\t\t\t\tstart: opStart,\n\t\t\t\t\t\t\t\tstop: opStop,\n\t\t\t\t\t\t\t\tchange: function(event, ui) {\n\t\t\t\t\t\t\t\t\tif (ui.value != uidegslider.slider('value')) {\n\t\t\t\t\t\t\t\t\t\trotate.update(ui.value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tslide: function(event, ui) {\n\t\t\t\t\t\t\t\t\trotate.update(ui.value, false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).find('.ui-slider-handle')\n\t\t\t\t\t\t\t\t.addClass('elfinder-tabstop')\n\t\t\t\t\t\t\t\t.off('keydown')\n\t\t\t\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.LEFT || e.keyCode == $.ui.keyCode.RIGHT) {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\trotate.update(Number(degree.val()) + (e.keyCode == $.ui.keyCode.RIGHT? 1 : -1), false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.end(),\n\t\t\t\t\t\tpickimg,\n\t\t\t\t\t\tpickcanv,\n\t\t\t\t\t\tpickctx,\n\t\t\t\t\t\tpickc = {},\n\t\t\t\t\t\tpick = function(e) {\n\t\t\t\t\t\t\tvar color, r, g, b, h, s, l;\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tcolor = pickc[Math.round(e.offsetX)][Math.round(e.offsetY)];\n\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\tif (!color) return;\n\n\t\t\t\t\t\t\tr = color[0]; g = color[1]; b = color[2];\n\t\t\t\t\t\t\th = color[3]; s = color[4]; l = color[5];\n\n\t\t\t\t\t\t\tsetbg(r, g, b, (e.type === 'click'));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpalpick = function(e) {\n\t\t\t\t\t\t\tsetbg($(this).css('backgroundColor'), '', '', (e.type === 'click'));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetbg = function(r, g, b, off) {\n\t\t\t\t\t\t\tvar s, m, cc;\n\t\t\t\t\t\t\tif (typeof r === 'string') {\n\t\t\t\t\t\t\t\tg = '';\n\t\t\t\t\t\t\t\tif (r && (s = $('<span>').css('backgroundColor', r).css('backgroundColor')) && (m = s.match(/rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/i))) {\n\t\t\t\t\t\t\t\t\tr = Number(m[1]);\n\t\t\t\t\t\t\t\t\tg = Number(m[2]);\n\t\t\t\t\t\t\t\t\tb = Number(m[3]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcc = (g === '')? r : '#' + getColorCode(r, g, b);\n\t\t\t\t\t\t\tbg.val(cc).css({ backgroundColor: cc, backgroundImage: 'none', color: (r+g+b < 384? '#fff' : '#000') });\n\t\t\t\t\t\t\tpreview.css('backgroundColor', cc);\n\t\t\t\t\t\t\tif (off) {\n\t\t\t\t\t\t\t\timgr.off('.picker').removeClass('elfinder-resize-picking');\n\t\t\t\t\t\t\t\tpallet.off('.picker').removeClass('elfinder-resize-picking');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetColorCode = function(r, g, b) {\n\t\t\t\t\t\t\treturn $.map([r,g,b], function(c){return ('0'+parseInt(c).toString(16)).slice(-2);}).join('');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpicker = $('<button>').text(fm.i18n('colorPicker'))\n\t\t\t\t\t\t.on('click', function() { \n\t\t\t\t\t\t\timgr.on('mousemove.picker click.picker', pick).addClass('elfinder-resize-picking');\n\t\t\t\t\t\t\tpallet.on('mousemove.picker click.picker', 'span', palpick).addClass('elfinder-resize-picking');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\tprimary: 'ui-icon-pin-s'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t}),\n\t\t\t\t\t\treseter = $('<button>').text(fm.i18n('reset'))\n\t\t\t\t\t\t\t.on('click', function() { \n\t\t\t\t\t\t\t\tsetbg('', '', '', true);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\tprimary: 'ui-icon-arrowrefresh-1-n'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tbg = $('<input class=\"ui-corner-all elfinder-resize-bg\" type=\"text\">')\n\t\t\t\t\t\t\t.on('focus', function() {\n\t\t\t\t\t\t\t\t$(this).attr('style', '');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('blur', function() {\n\t\t\t\t\t\t\t\tsetbg($(this).val());\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tpallet  = $('<div class=\"elfinder-resize-pallet\">').on('click', 'span', function() {\n\t\t\t\t\t\t\tsetbg($(this).css('backgroundColor'));\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tratio   = 1,\n\t\t\t\t\t\tprop    = 1,\n\t\t\t\t\t\towidth  = 0,\n\t\t\t\t\t\toheight = 0,\n\t\t\t\t\t\tcratio  = true,\n\t\t\t\t\t\tcratioc = false,\n\t\t\t\t\t\tpwidth  = 0,\n\t\t\t\t\t\tpheight = 0,\n\t\t\t\t\t\trwidth  = 0,\n\t\t\t\t\t\trheight = 0,\n\t\t\t\t\t\trdegree = 0,\n\t\t\t\t\t\tgrid8   = isJpeg? grid8Def : false,\n\t\t\t\t\t\tconstr  = $('<button>').html(fm.i18n('aspectRatio'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tcratio = ! cratio;\n\t\t\t\t\t\t\t\tconstr.button('option', {\n\t\t\t\t\t\t\t\t\ticons : { primary: cratio? 'ui-icon-locked' : 'ui-icon-unlocked'}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tresize.fixHeight();\n\t\t\t\t\t\t\t\trhandle.resizable('option', 'aspectRatio', cratio).data('uiResizable')._aspectRatio = cratio;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons : {\n\t\t\t\t\t\t\t\t\tprimary: cratio? 'ui-icon-locked' : 'ui-icon-unlocked'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tconstrc = $('<button>').html(fm.i18n('aspectRatio'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tcratioc = ! cratioc;\n\t\t\t\t\t\t\t\tconstrc.button('option', {\n\t\t\t\t\t\t\t\t\ticons : { primary: cratioc? 'ui-icon-locked' : 'ui-icon-unlocked'}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\trhandlec.resizable('option', 'aspectRatio', cratioc).data('uiResizable')._aspectRatio = cratioc;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons : {\n\t\t\t\t\t\t\t\t\tprimary: cratioc? 'ui-icon-locked' : 'ui-icon-unlocked'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tgrid8px = $('<button>').html(fm.i18n(grid8? 'enabled' : 'disabled')).toggleClass('ui-state-active', grid8)\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tgrid8 = ! grid8;\n\t\t\t\t\t\t\t\tgrid8px.html(fm.i18n(grid8? 'enabled' : 'disabled')).toggleClass('ui-state-active', grid8);\n\t\t\t\t\t\t\t\tsetStep8();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button(),\n\t\t\t\t\t\tsetStep8 = function() {\n\t\t\t\t\t\t\tvar step = grid8? 8 : 1;\n\t\t\t\t\t\t\t$.each([width, height, offsetX, offsetY, pointX, pointY], function() {\n\t\t\t\t\t\t\t\tthis.attr('step', step);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (grid8) {\n\t\t\t\t\t\t\t\twidth.val(round(width.val()));\n\t\t\t\t\t\t\t\theight.val(round(height.val()));\n\t\t\t\t\t\t\t\toffsetX.val(round(offsetX.val()));\n\t\t\t\t\t\t\t\toffsetY.val(round(offsetY.val()));\n\t\t\t\t\t\t\t\tpointX.val(round(pointX.val()));\n\t\t\t\t\t\t\t\tpointY.val(round(pointY.val()));\n\t\t\t\t\t\t\t\tif (uiresize.is(':visible')) {\n\t\t\t\t\t\t\t\t\tresize.updateView(width.val(), height.val());\n\t\t\t\t\t\t\t\t} else if (uicrop.is(':visible')) {\n\t\t\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetuprimg = function() {\n\t\t\t\t\t\t\tvar r_scale,\n\t\t\t\t\t\t\t\tfail = function() {\n\t\t\t\t\t\t\t\t\tbg.parent().hide();\n\t\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tr_scale = Math.min(pwidth, pheight) / Math.sqrt(Math.pow(owidth, 2) + Math.pow(oheight, 2));\n\t\t\t\t\t\t\trwidth = Math.ceil(owidth * r_scale);\n\t\t\t\t\t\t\trheight = Math.ceil(oheight * r_scale);\n\t\t\t\t\t\t\timgr.width(rwidth)\n\t\t\t\t\t\t\t\t.height(rheight)\n\t\t\t\t\t\t\t\t.css('margin-top', (pheight-rheight)/2 + 'px')\n\t\t\t\t\t\t\t\t.css('margin-left', (pwidth-rwidth)/2 + 'px');\n\t\t\t\t\t\t\tif (imgr.is(':visible') && bg.is(':visible')) {\n\t\t\t\t\t\t\t\tif (file.mime !== 'image/png') {\n\t\t\t\t\t\t\t\t\tpreview.css('backgroundColor', bg.val());\n\t\t\t\t\t\t\t\t\tpickimg = $('<img>');\n\t\t\t\t\t\t\t\t\tif (fm.isCORS) {\n\t\t\t\t\t\t\t\t\t\tpickimg.attr('crossorigin', 'use-credentials');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tpickimg.on('load', function() {\n\t\t\t\t\t\t\t\t\t\tif (pickcanv && pickcanv.width !== rwidth) {\n\t\t\t\t\t\t\t\t\t\t\tsetColorData();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('error', fail)\n\t\t\t\t\t\t\t\t\t.attr('src', canvSrc);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetupimg = function() {\n\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\n\t\t\t\t\t\t\tsetuprimg();\n\t\t\t\t\t\t\tbasec\n\t\t\t\t\t\t\t\t.width(img.width())\n\t\t\t\t\t\t\t\t.height(img.height());\n\t\t\t\t\t\t\timgc\n\t\t\t\t\t\t\t\t.width(img.width())\n\t\t\t\t\t\t\t\t.height(img.height());\n\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetColorData = function() {\n\t\t\t\t\t\t\tif (pickctx) {\n\t\t\t\t\t\t\t\tvar n, w, h, r, g, b, a, s, l, hsl, hue,\n\t\t\t\t\t\t\t\t\tdata, scale, tx1, tx2, ty1, ty2, rgb,\n\t\t\t\t\t\t\t\t\tdomi = {},\n\t\t\t\t\t\t\t\t\tdomic = [],\n\t\t\t\t\t\t\t\t\tdomiv, palc,\n\t\t\t\t\t\t\t\t\trgbToHsl = function (r, g, b) {\n\t\t\t\t\t\t\t\t\t\tvar h, s, l,\n\t\t\t\t\t\t\t\t\t\t\tmax = Math.max(Math.max(r, g), b),\n\t\t\t\t\t\t\t\t\t\t\tmin = Math.min(Math.min(r, g), b);\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t// Hue, 0 ~ 359\n\t\t\t\t\t\t\t\t\t\tif (max === min) {\n\t\t\t\t\t\t\t\t\t\t\th = 0;\n\t\t\t\t\t\t\t\t\t\t} else if (r === max) {\n\t\t\t\t\t\t\t\t\t\t\th = ((g - b) / (max - min) * 60 + 360) % 360;\n\t\t\t\t\t\t\t\t\t\t} else if (g === max) {\n\t\t\t\t\t\t\t\t\t\t\th = (b - r) / (max - min) * 60 + 120;\n\t\t\t\t\t\t\t\t\t\t} else if (b === max) {\n\t\t\t\t\t\t\t\t\t\t\th = (r - g) / (max - min) * 60 + 240;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// Saturation, 0 ~ 1\n\t\t\t\t\t\t\t\t\t\ts = (max - min) / max;\n\t\t\t\t\t\t\t\t\t\t// Lightness, 0 ~ 1\n\t\t\t\t\t\t\t\t\t\tl = (r *  0.3 + g * 0.59 + b * 0.11) / 255;\n\t\t\t\n\t\t\t\t\t\t\t\t\t\treturn [h, s, l, 'hsl'];\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trgbRound = function(c) {\n\t\t\t\t\t\t\t\t\t\treturn Math.round(c / 8) * 8;\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tcalc:\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tw = pickcanv.width = imgr.width();\n\t\t\t\t\t\t\t\t\th = pickcanv.height = imgr.height();\n\t\t\t\t\t\t\t\t\tscale = w / owidth;\n\t\t\t\t\t\t\t\t\tpickctx.scale(scale, scale);\n\t\t\t\t\t\t\t\t\tpickctx.drawImage(pickimg.get(0), 0, 0);\n\t\t\t\t\n\t\t\t\t\t\t\t\t\tdata = pickctx.getImageData(0, 0, w, h).data;\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Range to detect the dominant color\n\t\t\t\t\t\t\t\t\ttx1 = w * 0.1;\n\t\t\t\t\t\t\t\t\ttx2 = w * 0.9;\n\t\t\t\t\t\t\t\t\tty1 = h * 0.1;\n\t\t\t\t\t\t\t\t\tty2 = h * 0.9;\n\t\t\t\t\n\t\t\t\t\t\t\t\t\tfor (var y = 0; y < h - 1; y++) {\n\t\t\t\t\t\t\t\t\t\tfor (var x = 0; x < w - 1; x++) {\n\t\t\t\t\t\t\t\t\t\t\tn = x * 4 + y * w * 4;\n\t\t\t\t\t\t\t\t\t\t\t// RGB\n\t\t\t\t\t\t\t\t\t\t\tr = data[n]; g = data[n + 1]; b = data[n + 2]; a = data[n + 3];\n\t\t\t\t\t\t\t\t\t\t\t// check alpha ch\n\t\t\t\t\t\t\t\t\t\t\tif (a !== 255) {\n\t\t\t\t\t\t\t\t\t\t\t\tbg.parent().hide();\n\t\t\t\t\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t\t\t\t\t\tbreak calc;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// HSL\n\t\t\t\t\t\t\t\t\t\t\thsl = rgbToHsl(r, g, b);\n\t\t\t\t\t\t\t\t\t\t\thue = Math.round(hsl[0]); s = Math.round(hsl[1] * 100); l = Math.round(hsl[2] * 100);\n\t\t\t\t\t\t\t\t\t\t\tif (! pickc[x]) {\n\t\t\t\t\t\t\t\t\t\t\t\tpickc[x] = {};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// set pickc\n\t\t\t\t\t\t\t\t\t\t\tpickc[x][y] = [r, g, b, hue, s, l];\n\t\t\t\t\t\t\t\t\t\t\t// detect the dominant color\n\t\t\t\t\t\t\t\t\t\t\tif ((x < tx1 || x > tx2) && (y < ty1 || y > ty2)) {\n\t\t\t\t\t\t\t\t\t\t\t\trgb = rgbRound(r) + ',' + rgbRound(g) + ',' + rgbRound(b);\n\t\t\t\t\t\t\t\t\t\t\t\tif (! domi[rgb]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdomi[rgb] = 1;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t++domi[rgb];\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (! pallet.children(':first').length) {\n\t\t\t\t\t\t\t\t\t\tpalc = 1;\n\t\t\t\t\t\t\t\t\t\t$.each(domi, function(c, v) {\n\t\t\t\t\t\t\t\t\t\t\tdomic.push({c: c, v: v});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t$.each(domic.sort(function(a, b) {\n\t\t\t\t\t\t\t\t\t\t\treturn (a.v > b.v)? -1 : 1;\n\t\t\t\t\t\t\t\t\t\t}), function() {\n\t\t\t\t\t\t\t\t\t\t\tif (this.v < 2 || palc > 10) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tpallet.append($('<span style=\"width:20px;height:20px;display:inline-block;background-color:rgb('+this.c+');\">'));\n\t\t\t\t\t\t\t\t\t\t\t++palc;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetupPicker = function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tpickcanv = document.createElement('canvas');\n\t\t\t\t\t\t\t\tpickctx = pickcanv.getContext('2d');\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetupPreset = function() {\n\t\t\t\t\t\t\tpreset.on('click', 'span.elfinder-resize-preset', function() {\n\t\t\t\t\t\t\t\tvar btn = $(this),\n\t\t\t\t\t\t\t\t\tw = btn.data('s')[0],\n\t\t\t\t\t\t\t\t\th = btn.data('s')[1],\n\t\t\t\t\t\t\t\t\tr = owidth / oheight;\n\t\t\t\t\t\t\t\tbtn.data('s', [h, w]).text(h + 'x' + w);\n\t\t\t\t\t\t\t\tif (owidth > w || oheight > h) {\n\t\t\t\t\t\t\t\t\tif (owidth <= w) {\n\t\t\t\t\t\t\t\t\t\tw = round(h * r);\n\t\t\t\t\t\t\t\t\t} else if (oheight <= h) {\n\t\t\t\t\t\t\t\t\t\th = round(w / r);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (owidth - w > oheight - h) {\n\t\t\t\t\t\t\t\t\t\t\th = round(w / r);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tw = round(h * r);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tw = owidth;\n\t\t\t\t\t\t\t\t\th = oheight;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twidth.val(w);\n\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpresetc.on('click', 'span.elfinder-resize-preset', function() {\n\t\t\t\t\t\t\t\tvar btn = $(this),\n\t\t\t\t\t\t\t\t\tw = btn.data('s')[0],\n\t\t\t\t\t\t\t\t\th = btn.data('s')[1],\n\t\t\t\t\t\t\t\t\tx = pointX.val(),\n\t\t\t\t\t\t\t\t\ty = pointY.val();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tbtn.data('s', [h, w]).text(h + 'x' + w);\n\t\t\t\t\t\t\t\tif (owidth >= w && oheight >= h) {\n\t\t\t\t\t\t\t\t\tif (owidth - w - x < 0) {\n\t\t\t\t\t\t\t\t\t\tx = owidth - w;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (oheight - h - y < 0) {\n\t\t\t\t\t\t\t\t\t\ty = oheight - h;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tpointX.val(x);\n\t\t\t\t\t\t\t\t\tpointY.val(y);\n\t\t\t\t\t\t\t\t\toffsetX.val(w);\n\t\t\t\t\t\t\t\t\toffsetY.val(h);\n\t\t\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpresetc.children('span.elfinder-resize-preset').each(function() {\n\t\t\t\t\t\t\t\tvar btn = $(this),\n\t\t\t\t\t\t\t\t\tw = btn.data('s')[0],\n\t\t\t\t\t\t\t\t\th = btn.data('s')[1];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tbtn[(owidth >= w && oheight >= h)? 'show' : 'hide']();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdimreq  = null,\n\t\t\t\t\t\tinited  = false,\n\t\t\t\t\t\tsetdim  = function(dim) {\n\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\trfile.width = dim[0];\n\t\t\t\t\t\t\trfile.height = dim[1];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinit    = function() {\n\t\t\t\t\t\t\tvar elm, memSize, r_scale, imgRatio;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (inited) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinited = true;\n\t\t\t\t\t\t\tdimreq && dimreq.state && dimreq.state() === 'pending' && dimreq.reject();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// check lossless rotete\n\t\t\t\t\t\t\tif (fm.api >= 2.1030) {\n\t\t\t\t\t\t\t\tif (losslessRotate === 0) {\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\tcmd    : 'resize',\n\t\t\t\t\t\t\t\t\t\t\ttarget : file.hash,\n\t\t\t\t\t\t\t\t\t\t\tdegree : 0,\n\t\t\t\t\t\t\t\t\t\t\tmode   : 'rotate'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\t\t\tlosslessRotate = data.losslessRotate? 1 : -1;\n\t\t\t\t\t\t\t\t\t\tif (losslessRotate === 1 && (degree.val() % 90 === 0)) {\n\t\t\t\t\t\t\t\t\t\t\tuirotate.children('div.elfinder-resize-quality').hide();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\tlosslessRotate = -1;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlosslessRotate = -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\telm = img.get(0);\n\t\t\t\t\t\t\tmemSize = file.width && file.height? {w: file.width, h: file.height} : (elm.naturalWidth? null : {w: img.width(), h: img.height()});\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tmemSize && img.removeAttr('width').removeAttr('height');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\towidth  = file.width || elm.naturalWidth || elm.width || img.width();\n\t\t\t\t\t\t\toheight = file.height || elm.naturalHeight || elm.height || img.height();\n\t\t\t\t\t\t\tif (!file.width || !file.height) {\n\t\t\t\t\t\t\t\tsetdim([owidth, oheight]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tmemSize && img.width(memSize.w).height(memSize.h);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdMinBtn.show();\n\t\t\n\t\t\t\t\t\t\timgRatio = oheight / owidth;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (imgRatio < 1 && preview.height() > preview.width() * imgRatio) {\n\t\t\t\t\t\t\t\tpreview.height(preview.width() * imgRatio);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (preview.height() > img.height() + 20) {\n\t\t\t\t\t\t\t\tpreview.height(img.height() + 20);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tratio = owidth/oheight;\n\t\t\n\t\t\t\t\t\t\trhandle.append(img.show()).show();\n\t\t\t\t\t\t\twidth.val(owidth);\n\t\t\t\t\t\t\theight.val(oheight);\n\t\t\n\t\t\t\t\t\t\tsetupPicker();\n\t\t\t\t\t\t\tsetupPreset();\n\t\t\t\t\t\t\tsetupimg();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tuitype[ctrgrup]('enable');\n\t\t\t\t\t\t\tcontrol.find('input,select').prop('disabled', false)\n\t\t\t\t\t\t\t\t.filter(':text').on('keydown', function(e) {\n\t\t\t\t\t\t\t\t\tvar cOpts;\n\t\t\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tcOpts = {\n\t\t\t\t\t\t\t\t\t\t\ttitle  : $('input:checked', uitype).val(),\n\t\t\t\t\t\t\t\t\t\t\ttext   : 'confirmReq',\n\t\t\t\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnApply',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function(){\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).trigger('focus');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (useSaveAs) {\n\t\t\t\t\t\t\t\t\t\t\tcOpts['buttons'] = [{\n\t\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveAs',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(saveAs);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfm.confirm(cOpts);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.on('keyup', function() {\n\t\t\t\t\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t\t\t\t\tif (! $this.hasClass('elfinder-resize-bg')) {\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\t\t$this.val($this.val().replace(/[^0-9]/g, ''));\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.filter(':first');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsetStep8();\n\t\t\t\t\t\t\t!fm.UA.Mobile && width.trigger('focus');\n\t\t\t\t\t\t\tresizable();\n\t\t\t\t\t\t},\n\t\t\t\t\t\timg     = $('<img/>')\n\t\t\t\t\t\t\t.on('load', init)\n\t\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\t\tspinner.html(fm.i18n('ntfsmth')).css('background', 'transparent');\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tbasec = $('<div/>'),\n\t\t\t\t\t\timgc = $('<img/>'),\n\t\t\t\t\t\tcoverc = $('<div/>'),\n\t\t\t\t\t\timgr = $('<img class=\"elfinder-resize-imgrotate\" />'),\n\t\t\t\t\t\tround = function(v, max) {\n\t\t\t\t\t\t\tv = grid8? Math.round(v/8)*8 : Math.round(v);\n\t\t\t\t\t\t\tv = Math.max(0, v);\n\t\t\t\t\t\t\tif (max && v > max) {\n\t\t\t\t\t\t\t\tv = grid8? Math.floor(max/8)*8 : max;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn v;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresetView = function() {\n\t\t\t\t\t\t\twidth.val(owidth);\n\t\t\t\t\t\t\theight.val(oheight);\n\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\n\t\t\t\t\t\t\tpointX.val(0);\n\t\t\t\t\t\t\tpointY.val(0);\n\t\t\t\t\t\t\toffsetX.val(owidth);\n\t\t\t\t\t\t\toffsetY.val(oheight);\n\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresize = {\n\t\t\t\t\t\t\tupdate : function() {\n\t\t\t\t\t\t\t\twidth.val(round(img.width()/prop));\n\t\t\t\t\t\t\t\theight.val(round(img.height()/prop));\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdateView : function(w, h) {\n\t\t\t\t\t\t\t\tif (w > pwidth || h > pheight) {\n\t\t\t\t\t\t\t\t\tif (w / pwidth > h / pheight) {\n\t\t\t\t\t\t\t\t\t\tprop = pwidth / w;\n\t\t\t\t\t\t\t\t\t\timg.width(pwidth).height(round(h*prop));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tprop = pheight / h;\n\t\t\t\t\t\t\t\t\t\timg.height(pheight).width(round(w*prop));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\timg.width(round(w)).height(round(h));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tprop = img.width()/w;\n\t\t\t\t\t\t\t\tuiprop.text('1 : '+(1/prop).toFixed(2));\n\t\t\t\t\t\t\t\tresize.updateHandle();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdateHandle : function() {\n\t\t\t\t\t\t\t\trhandle.width(img.width()).height(img.height());\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfixHeight : function() {\n\t\t\t\t\t\t\t\tvar w, h;\n\t\t\t\t\t\t\t\tif (cratio) {\n\t\t\t\t\t\t\t\t\tw = width.val();\n\t\t\t\t\t\t\t\t\th = round(w/ratio);\n\t\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcrop = {\n\t\t\t\t\t\t\tupdate : function(change) {\n\t\t\t\t\t\t\t\tpointX.val(round(((rhandlec.data('x')||rhandlec.position().left))/prop, owidth));\n\t\t\t\t\t\t\t\tpointY.val(round(((rhandlec.data('y')||rhandlec.position().top))/prop, oheight));\n\t\t\t\t\t\t\t\tif (change !== 'xy') {\n\t\t\t\t\t\t\t\t\toffsetX.val(round((rhandlec.data('w')||rhandlec.width())/prop, owidth - pointX.val()));\n\t\t\t\t\t\t\t\t\toffsetY.val(round((rhandlec.data('h')||rhandlec.height())/prop, oheight - pointY.val()));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdateView : function(change) {\n\t\t\t\t\t\t\t\tvar r, x, y, w, h;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tpointX.val(round(pointX.val(), owidth - (grid8? 8 : 1)));\n\t\t\t\t\t\t\t\tpointY.val(round(pointY.val(), oheight - (grid8? 8 : 1)));\n\t\t\t\t\t\t\t\toffsetX.val(round(offsetX.val(), owidth - pointX.val()));\n\t\t\t\t\t\t\t\toffsetY.val(round(offsetY.val(), oheight - pointY.val()));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (cratioc) {\n\t\t\t\t\t\t\t\t\tr = coverc.width() / coverc.height();\n\t\t\t\t\t\t\t\t\tif (change === 'w') {\n\t\t\t\t\t\t\t\t\t\toffsetY.val(round(parseInt(offsetX.val()) / r));\n\t\t\t\t\t\t\t\t\t} else if (change === 'h') {\n\t\t\t\t\t\t\t\t\t\toffsetX.val(round(parseInt(offsetY.val()) * r));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tx = Math.round(parseInt(pointX.val()) * prop);\n\t\t\t\t\t\t\t\ty = Math.round(parseInt(pointY.val()) * prop);\n\t\t\t\t\t\t\t\tif (change !== 'xy') {\n\t\t\t\t\t\t\t\t\tw = Math.round(parseInt(offsetX.val()) * prop);\n\t\t\t\t\t\t\t\t\th = Math.round(parseInt(offsetY.val()) * prop);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tw = rhandlec.data('w');\n\t\t\t\t\t\t\t\t\th = rhandlec.data('h');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\trhandlec.data({x: x, y: y, w: w, h: h})\n\t\t\t\t\t\t\t\t\t.width(w)\n\t\t\t\t\t\t\t\t\t.height(h)\n\t\t\t\t\t\t\t\t\t.css({left: x, top: y});\n\t\t\t\t\t\t\t\tcoverc.width(w)\n\t\t\t\t\t\t\t\t\t.height(h);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresize_update : function(e, ui) {\n\t\t\t\t\t\t\t\trhandlec.data({x: ui.position.left, y: ui.position.top, w: ui.size.width, h: ui.size.height});\n\t\t\t\t\t\t\t\tcrop.update();\n\t\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdrag_update : function(e, ui) {\n\t\t\t\t\t\t\t\trhandlec.data({x: ui.position.left, y: ui.position.top});\n\t\t\t\t\t\t\t\tcrop.update('xy');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trotate = {\n\t\t\t\t\t\t\tmouseStartAngle : 0,\n\t\t\t\t\t\t\timageStartAngle : 0,\n\t\t\t\t\t\t\timageBeingRotated : false,\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsetQuality : function() {\n\t\t\t\t\t\t\t\tuirotate.children('div.elfinder-resize-quality')[(losslessRotate > 0 && (degree.val() % 90) === 0)? 'hide' : 'show']();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdate : function(value, animate) {\n\t\t\t\t\t\t\t\tif (typeof value == 'undefined') {\n\t\t\t\t\t\t\t\t\trdegree = value = parseInt(degree.val());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (typeof animate == 'undefined') {\n\t\t\t\t\t\t\t\t\tanimate = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (! animate || fm.UA.Opera || fm.UA.ltIE8) {\n\t\t\t\t\t\t\t\t\timgr.rotate(value);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\timgr.animate({rotate: value + 'deg'});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvalue = value % 360;\n\t\t\t\t\t\t\t\tif (value < 0) {\n\t\t\t\t\t\t\t\t\tvalue += 360;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdegree.val(parseInt(value));\n\n\t\t\t\t\t\t\t\tuidegslider.slider('value', degree.val());\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotate.setQuality();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\texecute : function ( e ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ( !rotate.imageBeingRotated ) return;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar imageCentre = rotate.getCenter( imgr );\n\t\t\t\t\t\t\t\tvar ev = e.originalEvent.touches? e.originalEvent.touches[0] : e;\n\t\t\t\t\t\t\t\tvar mouseXFromCentre = ev.pageX - imageCentre[0];\n\t\t\t\t\t\t\t\tvar mouseYFromCentre = ev.pageY - imageCentre[1];\n\t\t\t\t\t\t\t\tvar mouseAngle = Math.atan2( mouseYFromCentre, mouseXFromCentre );\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar rotateAngle = mouseAngle - rotate.mouseStartAngle + rotate.imageStartAngle;\n\t\t\t\t\t\t\t\trotateAngle = Math.round(parseFloat(rotateAngle) * 180 / Math.PI);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ( e.shiftKey ) {\n\t\t\t\t\t\t\t\t\trotateAngle = Math.round((rotateAngle + 6)/15) * 15;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\timgr.rotate(rotateAngle);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotateAngle = rotateAngle % 360;\n\t\t\t\t\t\t\t\tif (rotateAngle < 0) {\n\t\t\t\t\t\t\t\t\trotateAngle += 360;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdegree.val(rotateAngle);\n\n\t\t\t\t\t\t\t\tuidegslider.slider('value', degree.val());\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotate.setQuality();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tstart : function ( e ) {\n\t\t\t\t\t\t\t\tif (imgr.hasClass('elfinder-resize-picking')) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\topStart();\n\t\t\t\t\t\t\t\trotate.imageBeingRotated = true;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar imageCentre = rotate.getCenter( imgr );\n\t\t\t\t\t\t\t\tvar ev = e.originalEvent.touches? e.originalEvent.touches[0] : e;\n\t\t\t\t\t\t\t\tvar mouseStartXFromCentre = ev.pageX - imageCentre[0];\n\t\t\t\t\t\t\t\tvar mouseStartYFromCentre = ev.pageY - imageCentre[1];\n\t\t\t\t\t\t\t\trotate.mouseStartAngle = Math.atan2( mouseStartYFromCentre, mouseStartXFromCentre );\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotate.imageStartAngle = parseFloat(imgr.rotate()) * Math.PI / 180.0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$(document).on('mousemove', rotate.execute);\n\t\t\t\t\t\t\t\timgr.on('touchmove', rotate.execute);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tstop : function ( e ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ( !rotate.imageBeingRotated ) return;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$(document).off('mousemove', rotate.execute);\n\t\t\t\t\t\t\t\timgr.off('touchmove', rotate.execute);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() { rotate.imageBeingRotated = false; });\n\t\t\t\t\t\t\t\topStop();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tgetCenter : function ( image ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar currentRotation = imgr.rotate();\n\t\t\t\t\t\t\t\timgr.rotate(0);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar imageOffset = imgr.offset();\n\t\t\t\t\t\t\t\tvar imageCentreX = imageOffset.left + imgr.width() / 2;\n\t\t\t\t\t\t\t\tvar imageCentreY = imageOffset.top + imgr.height() / 2;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\timgr.rotate(currentRotation);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn Array( imageCentreX, imageCentreY );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresizable = function(destroy) {\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\trhandle.filter(':ui-resizable').resizable('destroy');\n\t\t\t\t\t\t\t\trhandle.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\trhandle.show();\n\t\t\t\t\t\t\t\trhandle.resizable({\n\t\t\t\t\t\t\t\t\talsoResize  : img,\n\t\t\t\t\t\t\t\t\taspectRatio : cratio,\n\t\t\t\t\t\t\t\t\tresize      : resize.update,\n\t\t\t\t\t\t\t\t\tstart       : opStart,\n\t\t\t\t\t\t\t\t\tstop        : function(e) {\n\t\t\t\t\t\t\t\t\t\tresize.fixHeight;\n\t\t\t\t\t\t\t\t\t\tresize.updateView(width.val(), height.val());\n\t\t\t\t\t\t\t\t\t\topStop();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcroppable = function(destroy) {\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\trhandlec.filter(':ui-resizable').resizable('destroy')\n\t\t\t\t\t\t\t\t\t.filter(':ui-draggable').draggable('destroy');\n\t\t\t\t\t\t\t\tbasec.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tbasec.show();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trhandlec\n\t\t\t\t\t\t\t\t\t.resizable({\n\t\t\t\t\t\t\t\t\t\tcontainment : basec,\n\t\t\t\t\t\t\t\t\t\taspectRatio : cratioc,\n\t\t\t\t\t\t\t\t\t\tresize      : crop.resize_update,\n\t\t\t\t\t\t\t\t\t\tstart       : opStart,\n\t\t\t\t\t\t\t\t\t\tstop        : opStop,\n\t\t\t\t\t\t\t\t\t\thandles     : 'all'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.draggable({\n\t\t\t\t\t\t\t\t\t\thandle      : coverc,\n\t\t\t\t\t\t\t\t\t\tcontainment : imgc,\n\t\t\t\t\t\t\t\t\t\tdrag        : crop.drag_update,\n\t\t\t\t\t\t\t\t\t\tstart       : opStart,\n\t\t\t\t\t\t\t\t\t\tstop        : function() {\n\t\t\t\t\t\t\t\t\t\t\tcrop.updateView('xy');\n\t\t\t\t\t\t\t\t\t\t\topStop();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t\tcrop.update();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trotateable = function(destroy) {\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\timgr.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\timgr.show();\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcheckVals = function() {\n\t\t\t\t\t\t\tvar w, h, x, y, d, q, b = '';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (mode == 'resize') {\n\t\t\t\t\t\t\t\tw = parseInt(width.val()) || 0;\n\t\t\t\t\t\t\t\th = parseInt(height.val()) || 0;\n\t\t\t\t\t\t\t} else if (mode == 'crop') {\n\t\t\t\t\t\t\t\tw = parseInt(offsetX.val()) || 0;\n\t\t\t\t\t\t\t\th = parseInt(offsetY.val()) || 0;\n\t\t\t\t\t\t\t\tx = parseInt(pointX.val()) || 0;\n\t\t\t\t\t\t\t\ty = parseInt(pointY.val()) || 0;\n\t\t\t\t\t\t\t} else if (mode == 'rotate') {\n\t\t\t\t\t\t\t\tw = owidth;\n\t\t\t\t\t\t\t\th = oheight;\n\t\t\t\t\t\t\t\td = parseInt(degree.val()) || 0;\n\t\t\t\t\t\t\t\tif (d < 0 || d > 360) {\n\t\t\t\t\t\t\t\t\tfm.error('Invalid rotate degree');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (d == 0 || d == 360) {\n\t\t\t\t\t\t\t\t\tfm.error('errResizeNoChange');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tb = bg.val();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tq = quality? parseInt(quality.val()) : 0;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (mode != 'rotate') {\n\t\t\t\t\t\t\t\tif (w <= 0 || h <= 0) {\n\t\t\t\t\t\t\t\t\tfm.error('Invalid image size');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (w == owidth && h == oheight) {\n\t\t\t\t\t\t\t\t\tfm.error('errResizeNoChange');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn {w: w, h: h, x: x, y: y, d: d, q: q, b: b};\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsave = function() {\n\t\t\t\t\t\t\tvar vals;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (vals = checkVals()) {\n\t\t\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\t\t\tself.resizeRequest({\n\t\t\t\t\t\t\t\t\ttarget : file.hash,\n\t\t\t\t\t\t\t\t\twidth  : vals.w,\n\t\t\t\t\t\t\t\t\theight : vals.h,\n\t\t\t\t\t\t\t\t\tx      : vals.x,\n\t\t\t\t\t\t\t\t\ty      : vals.y,\n\t\t\t\t\t\t\t\t\tdegree : vals.d,\n\t\t\t\t\t\t\t\t\tquality: vals.q,\n\t\t\t\t\t\t\t\t\tbg     : vals.b,\n\t\t\t\t\t\t\t\t\tmode   : mode\n\t\t\t\t\t\t\t\t}, file, dfrd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsaveAs = function() {\n\t\t\t\t\t\t\tvar fail = function() {\n\t\t\t\t\t\t\t\t\tdialogs.addClass(clsediting).fadeIn(function() {\n\t\t\t\t\t\t\t\t\t\tbase.addClass(clactive);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfm.disable();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmake = function() {\n\t\t\t\t\t\t\t\t\tself.mime = file.mime;\n\t\t\t\t\t\t\t\t\tself.prefix = file.name.replace(/ \\d+(\\.[^.]+)?$/, '$1');\n\t\t\t\t\t\t\t\t\tself.requestCmd = 'mkfile';\n\t\t\t\t\t\t\t\t\tself.nextAction = {};\n\t\t\t\t\t\t\t\t\tself.data = {target : file.phash};\n\t\t\t\t\t\t\t\t\t$.proxy(fm.res('mixin', 'make'), self)()\n\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\tvar hash, dfd;\n\t\t\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\t\t\thash = data.added[0].hash;\n\t\t\t\t\t\t\t\t\t\t\t\tdfd = fm.api < 2.1032? fm.url(file.hash, { async: true, temporary: true }) : null;\n\t\t\t\t\t\t\t\t\t\t\t\t$.when(dfd).done(function(url) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toptions : {type : 'post'},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd     : 'put',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget  : hash,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tencoding: dfd? 'scheme' : 'hash', \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent : dfd? fm.convAbsUrl(url) : file.hash\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'copy', cnt : 1},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsyncOnFail : true\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t.fail(fail)\n\t\t\t\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata = fm.normalize(data);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfile = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata.changed && data.changed.length && fm.change(data);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbase.show().find('.elfinder-dialog-title').html(fm.escape(file.name));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdialogs.fadeIn();\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}).fail(fail);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.fail(fail)\n\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\tdelete self.mime;\n\t\t\t\t\t\t\t\t\t\t\tdelete self.prefix;\n\t\t\t\t\t\t\t\t\t\t\tdelete self.nextAction;\n\t\t\t\t\t\t\t\t\t\t\tdelete self.data;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', { files: [ file.hash ] });\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\treqOpen = null,\n\t\t\t\t\t\t\t\tdialogs;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (checkVals()) {\n\t\t\t\t\t\t\t\tdialogs = fmnode.children('.' + self.dialogClass + ':visible').removeClass(clsediting).fadeOut();\n\t\t\t\t\t\t\t\tbase.removeClass(clactive);\n\t\t\t\t\t\t\t\tfm.enable();\n\t\t\t\t\t\t\t\tif (fm.searchStatus.state < 2 && file.phash !== fm.cwd().hash) {\n\t\t\t\t\t\t\t\t\treqOpen = fm.exec('open', [file.phash], {thash: file.phash});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$.when([reqOpen]).done(function() {\n\t\t\t\t\t\t\t\t\treqOpen? fm.one('cwdrender', make) : make();\n\t\t\t\t\t\t\t\t}).fail(fail);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons = {},\n\t\t\t\t\t\thline   = 'elfinder-resize-handle-hline',\n\t\t\t\t\t\tvline   = 'elfinder-resize-handle-vline',\n\t\t\t\t\t\trpoint  = 'elfinder-resize-handle-point',\n\t\t\t\t\t\tcanvSrc = src,\n\t\t\t\t\t\tsizeImg = quality? $('<img>').attr('crossorigin', fm.isCORS? 'use-credentials' : '').attr('src', canvSrc).on('load', function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvar canv = document.createElement('canvas');\n\t\t\t\t\t\t\t\tsizeImg.data('canvas', canv).data('ctx', canv.getContext('2d'));\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tsizeImg.removeData('canvas').removeData('ctx');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}) : null,\n\t\t\t\t\t\tjpgCalc = function() {\n\t\t\t\t\t\t\tcontrol.find('input.elfinder-resize-quality:visible').trigger('change');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdinit   = function(e) {\n\t\t\t\t\t\t\tif (base.hasClass('elfinder-dialog-minimized') || base.is(':hidden')) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpreset.hide();\n\t\t\t\t\t\t\tpresetc.hide();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar win   = fm.options.dialogContained? fmnode : $(window),\n\t\t\t\t\t\t\t\twinH  = win.height(),\n\t\t\t\t\t\t\t\twinW  = win.width(),\n\t\t\t\t\t\t\t\tpresW = 'auto',\n\t\t\t\t\t\t\t\tpresIn = true,\n\t\t\t\t\t\t\t\tdw, ctrW, prvW;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbase.width(Math.min(dialogWidth, winW - 30));\n\t\t\t\t\t\t\tpreview.attr('style', '');\n\t\t\t\t\t\t\tif (owidth && oheight) {\n\t\t\t\t\t\t\t\tpwidth  = preview.width()  - (rhandle.outerWidth()  - rhandle.width());\n\t\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tctrW  = dialog.find('div.elfinder-resize-control').width();\n\t\t\t\t\t\t\tprvW  = preview.width();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdw = dialog.width() - 20;\n\t\t\t\t\t\t\tif (prvW > dw) {\n\t\t\t\t\t\t\t\tpreview.width(dw);\n\t\t\t\t\t\t\t\tpresIn = false;\n\t\t\t\t\t\t\t} else if ((dw - prvW) < ctrW) {\n\t\t\t\t\t\t\t\tif (winW > winH) {\n\t\t\t\t\t\t\t\t\tpreview.width(dw - ctrW - 20);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tpreview.css({ float: 'none', marginLeft: 'auto', marginRight: 'auto'});\n\t\t\t\t\t\t\t\t\tpresIn = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (presIn) {\n\t\t\t\t\t\t\t\tpresW = ctrW;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpwidth  = preview.width()  - (rhandle.outerWidth()  - rhandle.width());\n\t\t\t\t\t\t\tif (fmnode.hasClass('elfinder-fullscreen')) {\n\t\t\t\t\t\t\t\tif (base.height() > winH) {\n\t\t\t\t\t\t\t\t\twinH -= 2;\n\t\t\t\t\t\t\t\t\tpreview.height(winH - base.height() + preview.height());\n\t\t\t\t\t\t\t\t\tbase.css('top', 0 - fmnode.offset().top);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twinH -= 30;\n\t\t\t\t\t\t\t\t(preview.height() > winH) && preview.height(winH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\tif (owidth && oheight) {\n\t\t\t\t\t\t\t\tsetupimg();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (img.height() && preview.height() > img.height() + 20) {\n\t\t\t\t\t\t\t\tpreview.height(img.height() + 20);\n\t\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\t\tsetuprimg();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpreset.css('width', presW).show();\n\t\t\t\t\t\t\tpresetc.css('width', presW).show();\n\t\t\t\t\t\t\tif (!presetc.children('span.elfinder-resize-preset:visible').length) {\n\t\t\t\t\t\t\t\tpresetc.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.elfinderdialog('posInit');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreset = (function() {\n\t\t\t\t\t\t\tvar sets = $('<fieldset class=\"elfinder-resize-preset-container\">').append($('<legend>').html(fm.i18n('presets'))).css('box-sizing', 'border-box').hide(),\n\t\t\t\t\t\t\t\thasC;\n\t\t\t\t\t\t\t$.each(presetSize, function(i, s) {\n\t\t\t\t\t\t\t\tif (s.length === 2) {\n\t\t\t\t\t\t\t\t\thasC = true;\n\t\t\t\t\t\t\t\t\tsets.append($('<span class=\"elfinder-resize-preset\"/>')\n\t\t\t\t\t\t\t\t\t\t.data('s', s)\n\t\t\t\t\t\t\t\t\t\t.text(s[0]+'x'+s[1])\n\t\t\t\t\t\t\t\t\t\t.button()\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (!hasC) {\n\t\t\t\t\t\t\t\treturn $();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn sets;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tpresetc = preset.clone(true),\n\t\t\t\t\t\tuseSaveAs = fm.uploadMimeCheck(file.mime, file.phash),\n\t\t\t\t\t\tdMinBtn, base;\n\t\t\t\t\t\n\t\t\t\t\tuiresize.append(\n\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('width')), width),\n\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('height')), height, $('<div class=\"elfinder-resize-whctrls\">').append(constr, reset)),\n\t\t\t\t\t\t(quality? $(row).append($(label).text(fm.i18n('quality')), quality, $('<span/>')) : $()),\n\t\t\t\t\t\t(isJpeg? $(row).append($(label).text(fm.i18n('8pxgrid')).addClass('elfinder-resize-grid8'), grid8px) : $()),\n\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('scale')), uiprop),\n\t\t\t\t\t\t$(row).append(preset)\n\t\t\t\t\t);\n\n\t\t\t\t\tif (api2) {\n\t\t\t\t\t\tuicrop.append(\n\t\t\t\t\t\t\t$(row).append($(label).text('X'), pointX),\n\t\t\t\t\t\t\t$(row).append($(label).text('Y')).append(pointY),\n\t\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('width')), offsetX),\n\t\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('height')), offsetY, $('<div class=\"elfinder-resize-whctrls\">').append(constrc, reset.clone(true))),\n\t\t\t\t\t\t\t(quality? $(row).append($(label).text(fm.i18n('quality')), quality.clone(true), $('<span/>')) : $()),\n\t\t\t\t\t\t\t(isJpeg? $(row).append($(label).text(fm.i18n('8pxgrid')).addClass('elfinder-resize-grid8')) : $()),\n\t\t\t\t\t\t\t$(row).append(presetc)\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tuirotate.append(\n\t\t\t\t\t\t\t$(row).addClass('elfinder-resize-degree').append(\n\t\t\t\t\t\t\t\t$(label).text(fm.i18n('rotate')),\n\t\t\t\t\t\t\t\tdegree,\n\t\t\t\t\t\t\t\t$('<span/>').text(fm.i18n('degree')),\n\t\t\t\t\t\t\t\t$('<div/>').append(uideg270, uideg90)[ctrgrup]()\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$(row).css('height', '20px').append(uidegslider),\n\t\t\t\t\t\t\t((quality)? $(row)[losslessRotate < 1? 'show' : 'hide']().addClass('elfinder-resize-quality').append(\n\t\t\t\t\t\t\t\t$(label).text(fm.i18n('quality')),\n\t\t\t\t\t\t\t\tquality.clone(true),\n\t\t\t\t\t\t\t\t$('<span/>')) : $()\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('bgcolor')), bg, picker, reseter),\n\t\t\t\t\t\t\t$(row).css('height', '20px').append(pallet)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tuideg270.on('click', function() {\n\t\t\t\t\t\t\trdegree = rdegree - 90;\n\t\t\t\t\t\t\trotate.update(rdegree);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tuideg90.on('click', function(){\n\t\t\t\t\t\t\trdegree = rdegree + 90;\n\t\t\t\t\t\t\trotate.update(rdegree);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdialog.append(uitype).on('resize', function(e){\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (api2) {\n\t\t\t\t\t\tcontrol.append(/*$(row), */uiresize, uicrop.hide(), uirotate.hide());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontrol.append(/*$(row), */uiresize);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\trhandle.append('<div class=\"'+hline+' '+hline+'-top\"/>',\n\t\t\t\t\t\t'<div class=\"'+hline+' '+hline+'-bottom\"/>',\n\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-left\"/>',\n\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-right\"/>',\n\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-e\"/>',\n\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-se\"/>',\n\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-s\"/>');\n\t\t\t\t\t\t\n\t\t\t\t\tpreview.append(spinner).append(rhandle.hide()).append(img.hide());\n\n\t\t\t\t\tif (api2) {\n\t\t\t\t\t\trhandlec.css('position', 'absolute')\n\t\t\t\t\t\t\t.append('<div class=\"'+hline+' '+hline+'-top\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+hline+' '+hline+'-bottom\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-left\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-right\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-n\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-e\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-s\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-w\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-ne\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-se\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-sw\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-nw\"/>');\n\n\t\t\t\t\t\tpreview.append(basec.css('position', 'absolute').hide().append(imgc, rhandlec.append(coverc)));\n\t\t\t\t\t\t\n\t\t\t\t\t\tpreview.append(imgr.hide());\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tpreview.css('overflow', 'hidden');\n\t\t\t\t\t\n\t\t\t\t\tdialog.append(preview, control);\n\t\t\t\t\t\n\t\t\t\t\tbuttons[fm.i18n('btnApply')] = save;\n\t\t\t\t\tif (useSaveAs) {\n\t\t\t\t\t\tbuttons[fm.i18n('btnSaveAs')] = function() { requestAnimationFrame(saveAs); };\n\t\t\t\t\t}\n\t\t\t\t\tbuttons[fm.i18n('btnCancel')] = function() { dialog.elfinderdialog('close'); };\n\t\t\t\t\t\n\t\t\t\t\tdialog.find('input,button').addClass('elfinder-tabstop');\n\t\t\t\t\t\n\t\t\t\t\tbase = self.fmDialog(dialog, {\n\t\t\t\t\t\ttitle          : fm.escape(file.name),\n\t\t\t\t\t\twidth          : dialogWidth,\n\t\t\t\t\t\tresizable      : false,\n\t\t\t\t\t\tbuttons        : buttons,\n\t\t\t\t\t\topen           : function() {\n\t\t\t\t\t\t\tvar doDimReq = function(force) {\n\t\t\t\t\t\t\t\t\tdimreq = fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'dim', target : file.hash, substitute : substituteImg? 400 : ''},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\tif (!data.url && needPng) {\n\t\t\t\t\t\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\t\t\t\t\t\tfm.error(['errOpen', file.name]);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tif (data.dim) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\n\t\t\t\t\t\t\t\t\t\t\t\tfile.width = dim[0];\n\t\t\t\t\t\t\t\t\t\t\t\tfile.height = dim[1];\n\t\t\t\t\t\t\t\t\t\t\t\tsetdim(dim);\n\t\t\t\t\t\t\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.attr('src', data.url);\n\t\t\t\t\t\t\t\t\t\t\t\t\timgc.attr('src', data.url);\n\t\t\t\t\t\t\t\t\t\t\t\t\timgr.attr('src', data.url);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\treturn init();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tneedPng = !{'image/jpeg':true,'image/png':true,'image/gif':true,}[file.mime],\n\t\t\t\t\t\t\t\tsubstituteImg = fm.option('substituteImg', file.hash) && (needPng || file.size > options.dimSubImgSize)? true : false,\n\t\t\t\t\t\t\t\thasSize = (file.width && file.height)? true : false;\n\t\t\t\t\t\t\tdMinBtn = base.find('.ui-dialog-titlebar .elfinder-titlebar-minimize').hide();\n\t\t\t\t\t\t\tfm.bind('resize', dinit);\n\t\t\t\t\t\t\timg.attr('src', src).one('error.dimreq', function() {\n\t\t\t\t\t\t\t\tdoDimReq(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\timgc.attr('src', src);\n\t\t\t\t\t\t\timgr.attr('src', src);\n\t\t\t\t\t\t\tif (api2) {\n\t\t\t\t\t\t\t\timgr.on('mousedown touchstart', rotate.start)\n\t\t\t\t\t\t\t\t\t.on('touchend', rotate.stop);\n\t\t\t\t\t\t\t\tbase.on('mouseup', rotate.stop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (hasSize && !substituteImg) {\n\t\t\t\t\t\t\t\treturn init();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (file.size > (options.getDimThreshold || 0)) {\n\t\t\t\t\t\t\t\timg.off('error.dimreq');\n\t\t\t\t\t\t\t\tdoDimReq();\n\t\t\t\t\t\t\t} else if (hasSize) {\n\t\t\t\t\t\t\t\treturn init();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclose          : function() {\n\t\t\t\t\t\t\tif (api2) {\n\t\t\t\t\t\t\t\timgr.off('mousedown touchstart', rotate.start)\n\t\t\t\t\t\t\t\t\t.off('touchend', rotate.stop);\n\t\t\t\t\t\t\t\t$(document).off('mouseup', rotate.stop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.unbind('resize', dinit);\n\t\t\t\t\t\t\t$(this).elfinderdialog('destroy');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresize         : function(e, data) {\n\t\t\t\t\t\t\tif (data && data.minimize === 'off') {\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).attr('id', id).closest('.ui-dialog').addClass(clsediting);\n\t\t\t\t\t\n\t\t\t\t\t// for IE < 9 dialog mising at open second+ time.\n\t\t\t\t\tif (fm.UA.ltIE8) {\n\t\t\t\t\t\t$('.elfinder-dialog').css('filter', '');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcoverc.css({ 'opacity': 0.2, 'background-color': '#fff', 'position': 'absolute'}),\n\t\t\t\t\trhandlec.css('cursor', 'move');\n\t\t\t\t\trhandlec.find('.elfinder-resize-handle-point').css({\n\t\t\t\t\t\t'background-color' : '#fff',\n\t\t\t\t\t\t'opacity': 0.5,\n\t\t\t\t\t\t'border-color':'#000'\n\t\t\t\t\t});\n\n\t\t\t\t\tif (! api2) {\n\t\t\t\t\t\tuitype.find('.api2').remove();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcontrol.find('input,select').prop('disabled', true);\n\t\t\t\t\tcontrol.find('input.elfinder-resize-quality')\n\t\t\t\t\t\t.next('span').addClass('elfinder-resize-jpgsize').attr('title', fm.i18n('roughFileSize'));\n\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tid, dialog\n\t\t\t\t;\n\t\t\t\t\n\n\t\t\tif (!files.length || files[0].mime.indexOf('image/') === -1) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tid = 'resize-'+fm.namespace+'-'+files[0].hash;\n\t\t\tdialog = fmnode.find('#'+id);\n\t\t\t\n\t\t\tif (dialog.length) {\n\t\t\t\tdialog.elfinderdialog('toTop');\n\t\t\t\treturn dfrd.resolve();\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tfm.openUrl(files[0].hash, 'sameorigin', function(src) {\n\t\t\t\topen(files[0], id, src);\n\t\t\t});\n\t\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\t(function ($) {\n\t\t\n\t\tvar findProperty = function (styleObject, styleArgs) {\n\t\t\tvar i = 0 ;\n\t\t\tfor( i in styleArgs) {\n\t\t        if (typeof styleObject[styleArgs[i]] != 'undefined') \n\t\t        \treturn styleArgs[i];\n\t\t\t}\n\t\t\tstyleObject[styleArgs[i]] = '';\n\t\t    return styleArgs[i];\n\t\t};\n\t\t\n\t\t$.cssHooks.rotate = {\n\t\t\tget: function(elem, computed, extra) {\n\t\t\t\treturn $(elem).rotate();\n\t\t\t},\n\t\t\tset: function(elem, value) {\n\t\t\t\t$(elem).rotate(value);\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\t$.cssHooks.transform = {\n\t\t\tget: function(elem, computed, extra) {\n\t\t\t\tvar name = findProperty( elem.style , \n\t\t\t\t\t['WebkitTransform', 'MozTransform', 'OTransform' , 'msTransform' , 'transform'] );\n\t\t\t\treturn elem.style[name];\n\t\t\t},\n\t\t\tset: function(elem, value) {\n\t\t\t\tvar name = findProperty( elem.style , \n\t\t\t\t\t['WebkitTransform', 'MozTransform', 'OTransform' , 'msTransform' , 'transform'] );\n\t\t\t\telem.style[name] = value;\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\t\n\t\t$.fn.rotate = function(val) {\n\t\t\tvar r;\n\t\t\tif (typeof val == 'undefined') {\n\t\t\t\tif (!!window.opera) {\n\t\t\t\t\tr = this.css('transform').match(/rotate\\((.*?)\\)/);\n\t\t\t\t\treturn  ( r && r[1])?\n\t\t\t\t\t\tMath.round(parseFloat(r[1]) * 180 / Math.PI) : 0;\n\t\t\t\t} else {\n\t\t\t\t\tr = this.css('transform').match(/rotate\\((.*?)\\)/);\n\t\t\t\t\treturn  ( r && r[1])? parseInt(r[1]) : 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.css('transform', \n\t\t\t\tthis.css('transform').replace(/none|rotate\\(.*?\\)/, '') + 'rotate(' + parseInt(val) + 'deg)');\n\t\t\treturn this;\n\t\t};\n\n\t\t$.fx.step.rotate  = function(fx) {\n\t\t\tif ( fx.state == 0 ) {\n\t\t\t\tfx.start = $(fx.elem).rotate();\n\t\t\t\tfx.now = fx.start;\n\t\t\t}\n\t\t\t$(fx.elem).rotate(fx.now);\n\t\t};\n\n\t\tif (typeof window.addEventListener == \"undefined\" && typeof document.getElementsByClassName == \"undefined\") { // IE & IE<9\n\t\t\tvar GetAbsoluteXY = function(element) {\n\t\t\t\tvar pnode = element;\n\t\t\t\tvar x = pnode.offsetLeft;\n\t\t\t\tvar y = pnode.offsetTop;\n\t\t\t\t\n\t\t\t\twhile ( pnode.offsetParent ) {\n\t\t\t\t\tpnode = pnode.offsetParent;\n\t\t\t\t\tif (pnode != document.body && pnode.currentStyle['position'] != 'static') {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (pnode != document.body && pnode != document.documentElement) {\n\t\t\t\t\t\tx -= pnode.scrollLeft;\n\t\t\t\t\t\ty -= pnode.scrollTop;\n\t\t\t\t\t}\n\t\t\t\t\tx += pnode.offsetLeft;\n\t\t\t\t\ty += pnode.offsetTop;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn { x: x, y: y };\n\t\t\t};\n\t\t\t\n\t\t\tvar StaticToAbsolute = function (element) {\n\t\t\t\tif ( element.currentStyle['position'] != 'static') {\n\t\t\t\t\treturn ;\n\t\t\t\t}\n\n\t\t\t\tvar xy = GetAbsoluteXY(element);\n\t\t\t\telement.style.position = 'absolute' ;\n\t\t\t\telement.style.left = xy.x + 'px';\n\t\t\t\telement.style.top = xy.y + 'px';\n\t\t\t};\n\n\t\t\tvar IETransform = function(element,transform){\n\n\t\t\t\tvar r;\n\t\t\t\tvar m11 = 1;\n\t\t\t\tvar m12 = 1;\n\t\t\t\tvar m21 = 1;\n\t\t\t\tvar m22 = 1;\n\n\t\t\t\tif (typeof element.style['msTransform'] != 'undefined'){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tStaticToAbsolute(element);\n\n\t\t\t\tr = transform.match(/rotate\\((.*?)\\)/);\n\t\t\t\tvar rotate =  ( r && r[1])\t?\tparseInt(r[1])\t:\t0;\n\n\t\t\t\trotate = rotate % 360;\n\t\t\t\tif (rotate < 0) rotate = 360 + rotate;\n\n\t\t\t\tvar radian= rotate * Math.PI / 180;\n\t\t\t\tvar cosX =Math.cos(radian);\n\t\t\t\tvar sinY =Math.sin(radian);\n\n\t\t\t\tm11 *= cosX;\n\t\t\t\tm12 *= -sinY;\n\t\t\t\tm21 *= sinY;\n\t\t\t\tm22 *= cosX;\n\n\t\t\t\telement.style.filter =  (element.style.filter || '').replace(/progid:DXImageTransform\\.Microsoft\\.Matrix\\([^)]*\\)/, \"\" ) +\n\t\t\t\t\t(\"progid:DXImageTransform.Microsoft.Matrix(\" + \n\t\t\t\t\t\t \"M11=\" + m11 + \n\t\t\t\t\t\t\",M12=\" + m12 + \n\t\t\t\t\t\t\",M21=\" + m21 + \n\t\t\t\t\t\t\",M22=\" + m22 + \n\t\t\t\t\t\t\",FilterType='bilinear',sizingMethod='auto expand')\") \n\t\t\t\t\t;\n\n\t\t  \t\tvar ow = parseInt(element.style.width || element.width || 0 );\n\t\t  \t\tvar oh = parseInt(element.style.height || element.height || 0 );\n\n\t\t\t\tradian = rotate * Math.PI / 180;\n\t\t\t\tvar absCosX =Math.abs(Math.cos(radian));\n\t\t\t\tvar absSinY =Math.abs(Math.sin(radian));\n\n\t\t\t\tvar dx = (ow - (ow * absCosX + oh * absSinY)) / 2;\n\t\t\t\tvar dy = (oh - (ow * absSinY + oh * absCosX)) / 2;\n\n\t\t\t\telement.style.marginLeft = Math.floor(dx) + \"px\";\n\t\t\t\telement.style.marginTop  = Math.floor(dy) + \"px\";\n\n\t\t\t\treturn(true);\n\t\t\t};\n\t\t\t\n\t\t\tvar transform_set = $.cssHooks.transform.set;\n\t\t\t$.cssHooks.transform.set = function(elem, value) {\n\t\t\t\ttransform_set.apply(this, [elem, value] );\n\t\t\t\tIETransform(elem,value);\n\t\t\t\treturn value;\n\t\t\t};\n\t\t}\n\n\t})(jQuery);\n\n\treturn elFinder;\n\n});"]}