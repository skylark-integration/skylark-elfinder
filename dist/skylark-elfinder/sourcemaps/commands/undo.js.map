{"version":3,"sources":["commands/undo.js"],"names":["define","elFinder","prototype","commands","undo","self","this","fm","setTitle","title","i18n","cmd","state","change","cmds","alwaysEnabled","updateOnSelect","shortcuts","pattern","syncTitleOnChange","getstate","length","setUndo","redo","_undo","$","isPlainObject","callback","Object","assign","getCommand","setRedo","push","exec","res","dfd","Deferred","_redo","pop","done","resolve","fail","reject","update","name","bind","e","data","opts","_userAction","dfrd"],"mappings":"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","file":"../../commands/undo.js","sourcesContent":["define([\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"undo\"\n\t * Undo previous commands\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.undo = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\tsetTitle = function(undo) {\n\t\t\t\tif (undo) {\n\t\t\t\t\tself.title = fm.i18n('cmdundo') + ' ' + fm.i18n('cmd'+undo.cmd);\n\t\t\t\t\tself.state = 0;\n\t\t\t\t} else {\n\t\t\t\t\tself.title = fm.i18n('cmdundo');\n\t\t\t\t\tself.state = -1;\n\t\t\t\t}\n\t\t\t\tself.change();\n\t\t\t},\n\t\t\tcmds = [];\n\t\t\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts      = [{\n\t\t\tpattern     : 'ctrl+z'\n\t\t}];\n\t\tthis.syncTitleOnChange = true;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn cmds.length? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.setUndo = function(undo, redo) {\n\t\t\tvar _undo = {};\n\t\t\tif (undo) {\n\t\t\t\tif ($.isPlainObject(undo) && undo.cmd && undo.callback) {\n\t\t\t\t\tObject.assign(_undo, undo);\n\t\t\t\t\tif (redo) {\n\t\t\t\t\t\tdelete redo.undo;\n\t\t\t\t\t\t_undo.redo = redo;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.getCommand('redo').setRedo(null);\n\t\t\t\t\t}\n\t\t\t\t\tcmds.push(_undo);\n\t\t\t\t\tsetTitle(_undo);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar redo = fm.getCommand('redo'),\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\tundo, res, _redo = {};\n\t\t\tif (cmds.length) {\n\t\t\t\tundo = cmds.pop();\n\t\t\t\tif (undo.redo) {\n\t\t\t\t\tObject.assign(_redo, undo.redo);\n\t\t\t\t\tdelete undo.redo;\n\t\t\t\t} else {\n\t\t\t\t\t_redo = null;\n\t\t\t\t} \n\t\t\t\tdfd.done(function() {\n\t\t\t\t\tif (_redo) {\n\t\t\t\t\t\tredo.setRedo(_redo, undo);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tsetTitle(cmds.length? cmds[cmds.length-1] : void(0));\n\t\t\t\t\n\t\t\t\tres = undo.callback();\n\t\t\t\t\n\t\t\t\tif (res && res.done) {\n\t\t\t\t\tres.done(function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfd.resolve();\n\t\t\t\t}\n\t\t\t\tif (cmds.length) {\n\t\t\t\t\tthis.update(0, cmds[cmds.length - 1].name);\n\t\t\t\t} else {\n\t\t\t\t\tthis.update(-1, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdfd.reject();\n\t\t\t}\n\t\t\treturn dfd;\n\t\t};\n\t\t\n\t\tfm.bind('exec', function(e) {\n\t\t\tvar data = e.data || {};\n\t\t\tif (data.opts && data.opts._userAction) {\n\t\t\t\tif (data.dfrd && data.dfrd.done) {\n\t\t\t\t\tdata.dfrd.done(function(res) {\n\t\t\t\t\t\tif (res && res.undo && res.redo) {\n\t\t\t\t\t\t\tres.undo.redo = res.redo;\n\t\t\t\t\t\t\tself.setUndo(res.undo);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * @class  elFinder command \"redo\"\n\t * Redo previous commands\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.redo = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm   = this.fm,\n\t\t\tsetTitle = function(redo) {\n\t\t\t\tif (redo && redo.callback) {\n\t\t\t\t\tself.title = fm.i18n('cmdredo') + ' ' + fm.i18n('cmd'+redo.cmd);\n\t\t\t\t\tself.state = 0;\n\t\t\t\t} else {\n\t\t\t\t\tself.title = fm.i18n('cmdredo');\n\t\t\t\t\tself.state = -1;\n\t\t\t\t}\n\t\t\t\tself.change();\n\t\t\t},\n\t\t\tcmds = [];\n\t\t\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts      = [{\n\t\t\tpattern     : 'shift+ctrl+z ctrl+y'\n\t\t}];\n\t\tthis.syncTitleOnChange = true;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn cmds.length? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.setRedo = function(redo, undo) {\n\t\t\tif (redo === null) {\n\t\t\t\tcmds = [];\n\t\t\t\tsetTitle();\n\t\t\t} else {\n\t\t\t\tif (redo && redo.cmd && redo.callback) {\n\t\t\t\t\tif (undo) {\n\t\t\t\t\t\tredo.undo = undo;\n\t\t\t\t\t}\n\t\t\t\t\tcmds.push(redo);\n\t\t\t\t\tsetTitle(redo);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar undo = fm.getCommand('undo'),\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\tredo, res, _undo = {}, _redo = {};\n\t\t\tif (cmds.length) {\n\t\t\t\tredo = cmds.pop();\n\t\t\t\tif (redo.undo) {\n\t\t\t\t\tObject.assign(_undo, redo.undo);\n\t\t\t\t\tObject.assign(_redo, redo);\n\t\t\t\t\tdelete _redo.undo;\n\t\t\t\t\tdfd.done(function() {\n\t\t\t\t\t\tundo.setUndo(_undo, _redo);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsetTitle(cmds.length? cmds[cmds.length-1] : void(0));\n\t\t\t\t\n\t\t\t\tres = redo.callback();\n\t\t\t\t\n\t\t\t\tif (res && res.done) {\n\t\t\t\t\tres.done(function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfd.resolve();\n\t\t\t\t}\n\t\t\t\treturn dfd;\n\t\t\t} else {\n\t\t\t\treturn dfd.reject();\n\t\t\t}\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});"]}