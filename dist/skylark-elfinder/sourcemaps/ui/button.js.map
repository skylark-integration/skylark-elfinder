{"version":3,"sources":["ui/button.js"],"names":["define","$","fn","elfinderbutton","cmd","this","each","menu","tm","c","fm","disabled","res","active","hover","item","text","title","prvCname","className","name","button","addClass","attr","append","on","e","hasClass","type","variants","length","is","getUI","click","stopPropagation","css","getMenuOffset","slideToggle","duration","done","exec","getSelected","_userAction","_currentType","_currentNode","hideMenu","toHide","fmNode","baseOffset","offset","buttonOffset","top","left","maxHeight","height","sel","selected","cwd","hash","hide","Array","isArray","appendTo","toggleClass","opts","data","preventDefault","removeClass","bind","change","html","i","variant","value","cName","cancelAnimationFrame","requestAnimationFrame","syncTitleOnChange","children"],"mappings":";;;;;;;AAAAA,QACC,kBACC,SAASC,GAOVA,EAAEC,GAAGC,eAAiB,SAASC,GAC9B,aACA,OAAOC,KAAKC,KAAK,WAEhB,IAOCC,EAkDAC,EAzDGC,EAAW,QACdC,EAAWN,EAAIM,GACfC,EAAWD,EAAGE,IAAIH,EAAG,YACrBI,EAAWH,EAAGE,IAAIH,EAAG,UACrBK,EAAWJ,EAAGE,IAAIH,EAAG,SACrBM,EAAW,4BAGXC,EAAWf,EAAE,sCAAsCG,EAAIa,MAAM,WAC7DC,EAAWd,EAAIe,UAAWf,EAAIe,UAAYf,EAAIgB,KAC9CC,EAAWpB,EAAEI,MAAMiB,SAAS,oCAC1BC,KAAK,QAASnB,EAAIa,OAClBO,OAAO,0DAA4DN,EAAW,MAAOF,GACrFS,GAAG,wBAAyB,SAASC,IAAML,EAAOM,SAAShB,IAAaU,EAAiB,cAAVK,EAAEE,KAAuB,cAAgB,YAAYd,KACpIW,GAAG,QAAS,SAASC,GAChBL,EAAOM,SAAShB,KAChBJ,GAAQH,EAAIyB,SAASC,QAAU,GAElCvB,EAAKwB,GAAG,YAAcrB,EAAGsB,QAAQC,QACjCP,EAAEQ,kBACF3B,EAAK4B,IAAIC,KAAiBC,aACzBC,SAAU,IACVC,KAAM,SAASb,GACdhB,EAAGH,EAAKwB,GAAG,YAAa,UAAY,UAAUxB,OAIhDG,EAAG8B,KAAKpC,EAAIgB,KAAMqB,KAAgBC,aAAa,EAAMC,aAAc,UAAWC,aAAcvB,OAKhGwB,EAAW,WACVnC,EAAGoC,OAAOvC,IAEX6B,EAAgB,WACf,IAAIW,EAASrC,EAAGsB,QACfgB,EAAaD,EAAOE,SACpBC,EAAe7B,EAAO4B,SACvB,OACCE,IAAMD,EAAaC,IAAMH,EAAWG,IACpCC,KAAOF,EAAaE,KAAOJ,EAAWI,KACtCC,UAAYN,EAAOO,SAAW,KAGhCb,EAAc,WACb,IAAIc,EAAM7C,EAAG8C,WASb,OAPKD,EAAIzB,SAEPyB,EADS7C,EAAG+C,OACJ/C,EAAG+C,MAAMC,WAEX,GAGDH,GAITvC,EAAK2C,OAGLvD,EAAIiB,OAASA,EAGTuC,MAAMC,QAAQzD,EAAIyB,YACrBR,EAAOC,SAAS,uBAEhBf,EAAON,EAAE,yFAA2FiB,EAAW,0BAC7GyC,OACAG,SAASpD,EAAGsB,SACZP,GAAG,wBAAyB,IAAIV,EAAM,WAAad,EAAEI,MAAM0D,YAAYjD,KACvEW,GAAG,QAAS,IAAIV,EAAM,SAASW,GAC/B,IAAIsC,EAAO/D,EAAEI,MAAM4D,KAAK,SACxBvC,EAAEwC,iBACFxC,EAAEQ,kBACFb,EAAO8C,YAAYrD,GACnBJ,EAAGoC,OAAOvC,QACU,IAATyD,IACVA,MAEmB,iBAATA,IACVA,EAAKtB,aAAc,GAEpBhC,EAAG8B,KAAKpC,EAAIgB,KAAMqB,IAAeuB,KAEjCvC,GAAG,QAASoB,GAEdnC,EAAG0D,KAAK,iBAAkBvB,GAAUb,QAAQP,GAAG,QAASoB,GAExDzC,EAAIiE,OAAO,WACV9D,EAAK+D,KAAK,IACVrE,EAAEK,KAAKF,EAAIyB,SAAU,SAAS0C,EAAGC,GAChCjE,EAAKiB,OAAOvB,EAAE,eAAec,EAAK,KAAKyD,EAAQ,GAAG,UAAUP,KAAK,QAASO,EAAQ,IAAIlD,SAASkD,EAAQ,IAAMpE,EAAIqE,MAvFxG,qCAuF2H,UAKvIrE,EAAIiE,OAAO,WACV,IAAIK,EACJlE,GAAMmE,qBAAqBnE,GAC3BA,EAAKoE,sBAAsB,WACtBxE,EAAIO,WACPU,EAAO8C,YAAYtD,EAAO,IAAIC,GAAOQ,SAASX,IAE9CU,EAAO8C,YAAYxD,GACnBU,EAAOjB,EAAIS,SAAW,WAAa,eAAeA,IAE/CT,EAAIyE,oBACPH,EAAQtE,EAAIe,UAAWf,EAAIe,UAAYf,EAAIgB,KACvCF,IAAawD,IAChBrD,EAAOyD,SAAS,yBAAyBX,YAAY,wBAA0BjD,GAAUI,SAAS,wBAA0BoD,GACxHnE,GACHA,EAAK4D,YAAY,mBAAqBjD,EAAW,SAASI,SAAS,mBAAqBoD,EAAQ,SAEjGxD,EAAWwD,GAEZ1D,EAAKsD,KAAKlE,EAAIa,OACdI,EAAOE,KAAK,QAASnB,EAAIa,YAI3BoD","file":"../../ui/button.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar button widget.\n\t * If command has variants - create menu\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\t\n\t\t\tvar c        = 'class',\n\t\t\t\tfm       = cmd.fm,\n\t\t\t\tdisabled = fm.res(c, 'disabled'),\n\t\t\t\tactive   = fm.res(c, 'active'),\n\t\t\t\thover    = fm.res(c, 'hover'),\n\t\t\t\titem     = 'elfinder-button-menu-item',\n\t\t\t\tselected = 'elfinder-button-menu-item-selected',\n\t\t\t\tmenu,\n\t\t\t\ttext     = $('<span class=\"elfinder-button-text\">'+cmd.title+'</span>'),\n\t\t\t\tprvCname = cmd.className? cmd.className : cmd.name,\n\t\t\t\tbutton   = $(this).addClass('ui-state-default elfinder-button')\n\t\t\t\t\t.attr('title', cmd.title)\n\t\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-' + prvCname + '\"/>', text)\n\t\t\t\t\t.on('mouseenter mouseleave', function(e) { !button.hasClass(disabled) && button[e.type == 'mouseleave' ? 'removeClass' : 'addClass'](hover);})\n\t\t\t\t\t.on('click', function(e) { \n\t\t\t\t\t\tif (!button.hasClass(disabled)) {\n\t\t\t\t\t\t\tif (menu && cmd.variants.length >= 1) {\n\t\t\t\t\t\t\t\t// close other menus\n\t\t\t\t\t\t\t\tmenu.is(':hidden') && fm.getUI().click();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tmenu.css(getMenuOffset()).slideToggle({\n\t\t\t\t\t\t\t\t\tduration: 100,\n\t\t\t\t\t\t\t\t\tdone: function(e) {\n\t\t\t\t\t\t\t\t\t\tfm[menu.is(':visible')? 'toFront' : 'toHide'](menu);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.exec(cmd.name, getSelected(), {_userAction: true, _currentType: 'toolbar', _currentNode: button });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\thideMenu = function() {\n\t\t\t\t\tfm.toHide(menu);\n\t\t\t\t},\n\t\t\t\tgetMenuOffset = function() {\n\t\t\t\t\tvar fmNode = fm.getUI(),\n\t\t\t\t\t\tbaseOffset = fmNode.offset(),\n\t\t\t\t\t\tbuttonOffset = button.offset();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttop : buttonOffset.top - baseOffset.top,\n\t\t\t\t\t\tleft : buttonOffset.left - baseOffset.left,\n\t\t\t\t\t\tmaxHeight : fmNode.height() - 40\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tgetSelected = function() {\n\t\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\t\tcwd;\n\t\t\t\t\tif (!sel.length) {\n\t\t\t\t\t\tif (cwd = fm.cwd()) {\n\t\t\t\t\t\t\tsel = [ fm.cwd().hash ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsel = void(0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn sel;\n\t\t\t\t},\n\t\t\t\ttm;\n\t\t\t\t\n\t\t\ttext.hide();\n\t\t\t\n\t\t\t// set self button object to cmd object\n\t\t\tcmd.button = button;\n\t\t\t\n\t\t\t// if command has variants create menu\n\t\t\tif (Array.isArray(cmd.variants)) {\n\t\t\t\tbutton.addClass('elfinder-menubutton');\n\t\t\t\t\n\t\t\t\tmenu = $('<div class=\"ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-' + prvCname + '-menu ui-corner-all\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.appendTo(fm.getUI())\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+item, function() { $(this).toggleClass(hover); })\n\t\t\t\t\t.on('click', '.'+item, function(e) {\n\t\t\t\t\t\tvar opts = $(this).data('value');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tbutton.removeClass(hover);\n\t\t\t\t\t\tfm.toHide(menu);\n\t\t\t\t\t\tif (typeof opts === 'undefined') {\n\t\t\t\t\t\t\topts = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof opts === 'object') {\n\t\t\t\t\t\t\topts._userAction = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.exec(cmd.name, getSelected(), opts);\n\t\t\t\t\t})\n\t\t\t\t\t.on('close', hideMenu);\n\n\t\t\t\tfm.bind('disable select', hideMenu).getUI().on('click', hideMenu);\n\t\t\t\t\n\t\t\t\tcmd.change(function() {\n\t\t\t\t\tmenu.html('');\n\t\t\t\t\t$.each(cmd.variants, function(i, variant) {\n\t\t\t\t\t\tmenu.append($('<div class=\"'+item+'\">'+variant[1]+'</div>').data('value', variant[0]).addClass(variant[0] == cmd.value ? selected : ''));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\t\n\t\t\t\t\n\t\t\tcmd.change(function() {\n\t\t\t\tvar cName;\n\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\tif (cmd.disabled()) {\n\t\t\t\t\t\tbutton.removeClass(active+' '+hover).addClass(disabled);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbutton.removeClass(disabled);\n\t\t\t\t\t\tbutton[cmd.active() ? 'addClass' : 'removeClass'](active);\n\t\t\t\t\t}\n\t\t\t\t\tif (cmd.syncTitleOnChange) {\n\t\t\t\t\t\tcName = cmd.className? cmd.className : cmd.name;\n\t\t\t\t\t\tif (prvCname !== cName) {\n\t\t\t\t\t\t\tbutton.children('.elfinder-button-icon').removeClass('elfinder-button-icon-' + prvCname).addClass('elfinder-button-icon-' + cName);\n\t\t\t\t\t\t\tif (menu) {\n\t\t\t\t\t\t\t\tmenu.removeClass('elfinder-button-' + prvCname + '-menu').addClass('elfinder-button-' + cName + '-menu');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprvCname = cName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttext.html(cmd.title);\n\t\t\t\t\t\tbutton.attr('title', cmd.title);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.change();\n\t\t});\n\t};\n\n});"]}