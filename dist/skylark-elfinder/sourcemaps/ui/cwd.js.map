{"version":3,"sources":["ui/cwd.js"],"names":["define","$","fn","elfindercwd","fm","options","this","not","each","thHeight","addBadgeStyleSheet","vExpiresTm","hasUiTree","iconSize","curVolId","winScrTm","mobile","UA","Mobile","list","viewType","evtSelect","namespace","evtUnselect","evtDisable","evtEnable","c","clFile","res","fileSelector","clSelected","clDisabled","clDraggable","clDroppable","clHover","clActive","clDropActive","clTmp","clSelChk","tmbNum","loadTmbs","query","clipCuts","cwdParents","cwdHashes","incHashes","customCols","curClickId","makeTemplateRow","selectCheckbox","cols","i","length","customColsBuild","map","showSelectCheckboxUA","t","match","colResizing","colWidth","templates","icon","row","permsTpl","lockTpl","symlinkTpl","replacement","id","f","cwdHash2Id","hash","name","escape","i18","replace","nametitle","permsclass","perms2class","perm","formatPermissions","dirclass","cName","mime","isroot","csscls","getClass","style","getIconStyle","mime2class","size","formatSize","date","formatDate","kind","mime2kind","mode","formatFileMode","modestr","modeoct","modeboth","marker","alias","read","write","locked","tooltip","title","info","path","addedBadges","itemhtml","sel","ext","type","remove","insertBefore","children","get","sheet","toLowerCase","split","mimeTypes","insertRule","e","addBadgeStyle","s","selectedNext","selectLock","selectedFiles","selectFile","cwdHash2Elm","trigger","allSelected","selectAll","cwd","selectAllCheckbox","find","prop","lazy","files","maxTargets","unselectAll","notrigger","file","slice","v","toast","msg","i18n","arrayFlip","data","repaint","opts","o","Object","keys","removeClass","lastSelect","selected","origin","oldSchoolItem","cwdId2Hash","attr","hasClass","selectall","unselectall","scrollToView","blink","ftop","position","top","fheight","outerHeight","wtop","wrapper","scrollTop","wheight","clientHeight","thheight","tableHeader","parseInt","scrollLeft","resources","buffer","bufferExt","index","l","scrolling","selectableOption","disabled","filter","stop","delay","appendTo","autoRefresh","ui","unselected","inViewHashes","wrapperRepaint","init","recnt","renderd","firstNode","oldSchool","arr","widget","wos","ww","w","x","selectable","rec","offset","width","window","Math","min","left","direction","max","round","tgt","document","elementFromPoint","ids","tmbs","cnt","ceil","hpi","wz","height","showFiles","chk","getTmbs","attachTmbs","next","done","idsArr","assign","join","attachThumbnails","setTarget","closest","getUI","hide","show","Array","repaintJob","asyncJob","requestAnimationFrame","render","rendering","phash","place","docFlag","htmlPrefilter","tempDom","createDocumentFragment","go","locks","over","html","dirs","atmb","stmb","option","splice","bottomMarker","off","tmb","indexOf","push","empty","append","makeDroppable","n","bottomMarkerShow","fixTableHeader","fitWidth","p","pdir","set","extend","addClass","on","exec","replaceWith","prepend","draggingUiHelper","one","request","cmd","target","preventFail","setColwidth","itemH","showThreshold","enabled","resize","cssSticky","CSS","positionSticky","widthMaxContent","optsArg","listView","fixedHeader","base","table","thead","tbody","hheight","htr","btr","htd","btd","htw","btw","setPos","val","pos","outerWidth","css","is","parent","after","stopPropagation","abs","cancelAnimationFrame","mBoard","cl","first","merge","k","droppable","status","inParent","dst","helper","ctr","shiftKey","ctrlKey","metaKey","insideWorkzone","pageX","pageY","h","out","removeData","deactivate","drop","call","targets","isCommandEnabled","$n","reload","isPlainObject","tmbObj","node","className","url","attach","loadThumbnails","tmbLoading","reloads","oldAPI","current","images","resLen","errs","always","add","nodes","ndx","findNode","file2","pointer","compare","findIndex","content","before","found","inSearch","searchStatus","state","curCmd","getCommand","currentReqCmd","noChangeDirOnRemovedCwd","reverse","roots","debug","inArray","cur","boxSize","itemBoxSize","col","floor","elm","setItemBoxSize","wrapperContextMenu","preventDefault","y","originalEvent","touches","setTimeout","clearTimeout","thtr","ininc","substr","attachThumbJob","_abort","_padding","iOS","getColumnName","customColsName","customColsNameBuild","sortable","axis","distance","items","start","item","placeholder","update","prev","storage","$this","resizable","handles","element","originalSize","sortFiles","lazyOpts","tm","pl","nl","sib","parents","prevAll","nextAll","prevUntil","nextUntil","dblclick","nodeName","metakeyDragout","IE","altKey","disable","draggable","removeAttr","currentTarget","dt","dataTransfer","durl","murl","outerHTML","geturl","furl","convAbsUrl","text","rfile","notify","setDragImage","body","effectAllowed","setData","location","href","getData","child","toggleClass","lock","move","icons","deltaY","iconsView","sizeMax","autoDisable","scrtm","scrolltop","restm","initHeight","siblings","wph","insertAfter","vExpires","showVolumeExpires","remain","sec","int","volumeExpires","Date","ltIE10","bind","grep","columns","columnhides","keyCode","ESCAPE","createElement","head","appendChild","zIndex","fullscreen","detach","dfd","req","Deferred","resolve","cwdObj","volumeid","when","isIn","trashes","autoSync","noupdate","q","searchTypes","commandsOptions","search","incsearch","regex","incSearch","fst","RegExp","hashes","lastScrollLeft","allsel","cwdOffset","cwdEdge","clipboard","cut","imgs","curPath","added","mixed","vid","inTarget","change","changed","removed","dragstart","oe","dragstop","event","lockfiles","unlockfiles","selectfiles","unselectfiles","all","inselect","_multiupload","concat","shortcut","pattern","description","callback","invHashes","itemNode","code","LEFT","UP","sibling","RIGHT","select"],"mappings":"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","file":"../../ui/cwd.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * elFinder current working directory ui.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindercwd = function(fm, options) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-cwd').each(function() {\n\t\t\t// fm.time('cwdLoad');\n\t\t\t\n\t\t\tvar mobile = fm.UA.Mobile,\n\t\t\t\tlist = fm.viewType == 'list',\n\n\t\t\t\tundef = 'undefined',\n\t\t\t\t/**\n\t\t\t\t * Select event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtSelect = 'select.'+fm.namespace,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Unselect event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtUnselect = 'unselect.'+fm.namespace,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disable event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtDisable = 'disable.'+fm.namespace,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disable event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtEnable = 'enable.'+fm.namespace,\n\t\t\t\t\n\t\t\t\tc = 'class',\n\t\t\t\t/**\n\t\t\t\t * File css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclFile       = fm.res(c, 'cwdfile'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Selected css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tfileSelector = '.'+clFile,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Selected css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclSelected = 'ui-selected',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disabled css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDisabled = fm.res(c, 'disabled'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Draggable css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDraggable = fm.res(c, 'draggable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDroppable = fm.res(c, 'droppable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Hover css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclHover     = fm.res(c, 'hover'),\n\n\t\t\t\t/**\n\t\t\t\t * Active css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclActive     = fm.res(c, 'active'),\n\n\t\t\t\t/**\n\t\t\t\t * Hover css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDropActive = fm.res(c, 'adroppable'),\n\n\t\t\t\t/**\n\t\t\t\t * Css class for temporary nodes (for mkdir/mkfile) commands\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclTmp = clFile+'-tmp',\n\n\t\t\t\t/**\n\t\t\t\t * Select checkbox css class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tclSelChk = 'elfinder-cwd-selectchk',\n\n\t\t\t\t/**\n\t\t\t\t * Number of thumbnails to load in one request (new api only)\n\t\t\t\t *\n\t\t\t\t * @type Number\n\t\t\t\t **/\n\t\t\t\ttmbNum = fm.options.loadTmbs > 0 ? fm.options.loadTmbs : 5,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Current search query.\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tquery = '',\n\n\t\t\t\t/**\n\t\t\t\t * Currect clipboard(cut) hashes as object key\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tclipCuts = {},\n\n\t\t\t\t/**\n\t\t\t\t * Parents hashes of cwd\n\t\t\t\t *\n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tcwdParents = [],\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * cwd current hashes\n\t\t\t\t * \n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tcwdHashes = [],\n\n\t\t\t\t/**\n\t\t\t\t * incsearch current hashes\n\t\t\t\t * \n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tincHashes = void 0,\n\n\t\t\t\t/**\n\t\t\t\t * Custom columns name and order\n\t\t\t\t *\n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tcustomCols = [],\n\n\t\t\t\t/**\n\t\t\t\t * Current clicked element id of first time for dblclick\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tcurClickId = '',\n\n\t\t\t\t/**\n\t\t\t\t * Custom columns builder\n\t\t\t\t *\n\t\t\t\t * @type Function\n\t\t\t\t */\n\t\t\t\tcustomColsBuild = function() {\n\t\t\t\t\tvar cols = '';\n\t\t\t\t\tfor (var i = 0; i < customCols.length; i++) {\n\t\t\t\t\t\tcols += '<td class=\"elfinder-col-'+customCols[i]+'\">{' + customCols[i] + '}</td>';\n\t\t\t\t\t}\n\t\t\t\t\treturn cols;\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * Make template.row from customCols\n\t\t\t\t *\n\t\t\t\t * @type Function\n\t\t\t\t */\n\t\t\t\tmakeTemplateRow = function() {\n\t\t\t\t\treturn '<tr id=\"{id}\" class=\"'+clFile+' {permsclass} {dirclass}\" title=\"{tooltip}\"{css}><td class=\"elfinder-col-name\"><div class=\"elfinder-cwd-file-wrapper\"><span class=\"elfinder-cwd-icon {mime}\"{style}/>{marker}<span class=\"elfinder-cwd-filename\">{name}</span></div>'+selectCheckbox+'</td>'+customColsBuild()+'</tr>';\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tselectCheckbox = ($.map(options.showSelectCheckboxUA, function(t) {return (fm.UA[t] || t.match(/^all$/i))? true : null;}).length)? '<div class=\"elfinder-cwd-select\"><input type=\"checkbox\" class=\"'+clSelChk+'\"></div>' : '',\n\n\t\t\t\tcolResizing = false,\n\t\t\t\t\n\t\t\t\tcolWidth = null,\n\n\t\t\t\t/**\n\t\t\t\t * Table header height\n\t\t\t\t */\n\t\t\t\tthHeight,\n\n\t\t\t\t/**\n\t\t\t\t * File templates\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\ttemplates = {\n\t\t\t\t\ticon : '<div id=\"{id}\" class=\"'+clFile+' {permsclass} {dirclass} ui-corner-all\" title=\"{tooltip}\"><div class=\"elfinder-cwd-file-wrapper ui-corner-all\"><div class=\"elfinder-cwd-icon {mime} ui-corner-all\" unselectable=\"on\"{style}/>{marker}</div><div class=\"elfinder-cwd-filename\" title=\"{nametitle}\">{name}</div>'+selectCheckbox+'</div>',\n\t\t\t\t\trow  : ''\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tpermsTpl = fm.res('tpl', 'perms'),\n\t\t\t\t\n\t\t\t\tlockTpl = fm.res('tpl', 'lock'),\n\t\t\t\t\n\t\t\t\tsymlinkTpl = fm.res('tpl', 'symlink'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Template placeholders replacement rules\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\treplacement = {\n\t\t\t\t\tid : function(f) {\n\t\t\t\t\t\treturn fm.cwdHash2Id(f.hash);\n\t\t\t\t\t},\n\t\t\t\t\tname : function(f) {\n\t\t\t\t\t\tvar name = fm.escape(f.i18 || f.name);\n\t\t\t\t\t\t!list && (name = name.replace(/([_.])/g, '&#8203;$1'));\n\t\t\t\t\t\treturn name;\n\t\t\t\t\t},\n\t\t\t\t\tnametitle : function(f) {\n\t\t\t\t\t\treturn fm.escape(f.i18 || f.name);\n\t\t\t\t\t},\n\t\t\t\t\tpermsclass : function(f) {\n\t\t\t\t\t\treturn fm.perms2class(f);\n\t\t\t\t\t},\n\t\t\t\t\tperm : function(f) {\n\t\t\t\t\t\treturn fm.formatPermissions(f);\n\t\t\t\t\t},\n\t\t\t\t\tdirclass : function(f) {\n\t\t\t\t\t\tvar cName = f.mime == 'directory' ? 'directory' : '';\n\t\t\t\t\t\tf.isroot && (cName += ' isroot');\n\t\t\t\t\t\tf.csscls && (cName += ' ' + fm.escape(f.csscls));\n\t\t\t\t\t\toptions.getClass && (cName += ' ' + options.getClass(f));\n\t\t\t\t\t\treturn cName;\n\t\t\t\t\t},\n\t\t\t\t\tstyle : function(f) {\n\t\t\t\t\t\treturn f.icon? fm.getIconStyle(f) : '';\n\t\t\t\t\t},\n\t\t\t\t\tmime : function(f) {\n\t\t\t\t\t\tvar cName = fm.mime2class(f.mime);\n\t\t\t\t\t\tf.icon && (cName += ' elfinder-cwd-bgurl');\n\t\t\t\t\t\treturn cName;\n\t\t\t\t\t},\n\t\t\t\t\tsize : function(f) {\n\t\t\t\t\t\treturn (f.mime === 'directory' && !f.size)? '-' : fm.formatSize(f.size);\n\t\t\t\t\t},\n\t\t\t\t\tdate : function(f) {\n\t\t\t\t\t\treturn fm.formatDate(f);\n\t\t\t\t\t},\n\t\t\t\t\tkind : function(f) {\n\t\t\t\t\t\treturn fm.mime2kind(f);\n\t\t\t\t\t},\n\t\t\t\t\tmode : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm) : '';\n\t\t\t\t\t},\n\t\t\t\t\tmodestr : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm, 'string') : '';\n\t\t\t\t\t},\n\t\t\t\t\tmodeoct : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm, 'octal') : '';\n\t\t\t\t\t},\n\t\t\t\t\tmodeboth : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm, 'both') : '';\n\t\t\t\t\t},\n\t\t\t\t\tmarker : function(f) {\n\t\t\t\t\t\treturn (f.alias || f.mime == 'symlink-broken' ? symlinkTpl : '')+(!f.read || !f.write ? permsTpl : '')+(f.locked ? lockTpl : '');\n\t\t\t\t\t},\n\t\t\t\t\ttooltip : function(f) {\n\t\t\t\t\t\tvar title = fm.formatDate(f) + (f.size > 0 ? ' ('+fm.formatSize(f.size)+')' : ''),\n\t\t\t\t\t\t\tinfo  = '';\n\t\t\t\t\t\tif (query && f.path) {\n\t\t\t\t\t\t\tinfo = fm.escape(f.path.replace(/\\/[^\\/]*$/, ''));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinfo = f.tooltip? fm.escape(f.tooltip).replace(/\\r/g, '&#13;') : '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tinfo += (info? '&#13;' : '') + fm.escape(f.i18 || f.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn info? info + '&#13;' + title : title;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Type badge CSS added flag\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\taddedBadges = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Type badge style sheet element\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\taddBadgeStyleSheet,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Add type badge CSS into 'head'\n\t\t\t\t * \n\t\t\t\t * @type Fundtion\n\t\t\t\t */\n\t\t\t\taddBadgeStyle = function(mime, name) {\n\t\t\t\t\tvar sel, ext, type;\n\t\t\t\t\tif (mime && ! addedBadges[mime]) {\n\t\t\t\t\t\tif (typeof addBadgeStyleSheet === 'undefined') {\n\t\t\t\t\t\t\tif ($('#elfinderAddBadgeStyle'+fm.namespace).length) {\n\t\t\t\t\t\t\t\t$('#elfinderAddBadgeStyle'+fm.namespace).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taddBadgeStyleSheet = $('<style id=\"addBadgeStyle'+fm.namespace+'\"/>').insertBefore($('head').children(':first')).get(0).sheet || null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (addBadgeStyleSheet) {\n\t\t\t\t\t\t\tmime = mime.toLowerCase();\n\t\t\t\t\t\t\ttype = mime.split('/');\n\t\t\t\t\t\t\text = fm.escape(fm.mimeTypes[mime] || (name.replace(/.bac?k$/i, '').match(/\\.([^.]+)$/) || ['',''])[1]);\n\t\t\t\t\t\t\tif (ext) {\n\t\t\t\t\t\t\t\tsel = '.elfinder-cwd-icon-' + type[0].replace(/(\\.|\\+)/g, '-');\n\t\t\t\t\t\t\t\tif (typeof type[1] !== 'undefined') {\n\t\t\t\t\t\t\t\t\tsel += '.elfinder-cwd-icon-' + type[1].replace(/(\\.|\\+)/g, '-');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\taddBadgeStyleSheet.insertRule(sel + ':before{content:\"' + ext.toLowerCase() + '\"}', 0);\n\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taddedBadges[mime] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return file html\n\t\t\t\t *\n\t\t\t\t * @param  Object  file info\n\t\t\t\t * @return String\n\t\t\t\t **/\n\t\t\t\titemhtml = function(f) {\n\t\t\t\t\tf.mime && f.mime !== 'directory' && !addedBadges[f.mime] && addBadgeStyle(f.mime, f.name);\n\t\t\t\t\treturn templates[list ? 'row' : 'icon']\n\t\t\t\t\t\t\t.replace(/\\{([a-z0-9_]+)\\}/g, function(s, e) { \n\t\t\t\t\t\t\t\treturn replacement[e] ? replacement[e](f, fm) : (f[e] ? f[e] : ''); \n\t\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * jQueery node that will be selected next\n\t\t\t\t * \n\t\t\t\t * @type Object jQuery node\n\t\t\t\t */\n\t\t\t\tselectedNext = $(),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Flag. Required for msie to avoid unselect files on dragstart\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t **/\n\t\t\t\tselectLock = false,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Move selection to prev/next file\n\t\t\t\t *\n\t\t\t\t * @param String  move direction\n\t\t\t\t * @param Boolean append to current selection\n\t\t\t\t * @return void\n\t\t\t\t * @rise select\t\t\t\n\t\t\t\t */\n\t\t\t\tselect = function(keyCode, append) {\n\t\t\t\t\tvar code     = $.ui.keyCode,\n\t\t\t\t\t\tprev     = keyCode == code.LEFT || keyCode == code.UP,\n\t\t\t\t\t\tsel      = cwd.find('[id].'+clSelected),\n\t\t\t\t\t\tselector = prev ? 'first:' : 'last',\n\t\t\t\t\t\ts, n, sib, top, left;\n\n\t\t\t\t\tfunction sibling(n, direction) {\n\t\t\t\t\t\treturn n[direction+'All']('[id]:not(.'+clDisabled+'):not(.elfinder-cwd-parent):first');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (sel.length) {\n\t\t\t\t\t\ts = sel.filter(prev ? ':first' : ':last');\n\t\t\t\t\t\tsib = sibling(s, prev ? 'prev' : 'next');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!sib.length) {\n\t\t\t\t\t\t\t// there is no sibling on required side - do not move selection\n\t\t\t\t\t\t\tn = s;\n\t\t\t\t\t\t} else if (list || keyCode == code.LEFT || keyCode == code.RIGHT) {\n\t\t\t\t\t\t\t// find real prevoius file\n\t\t\t\t\t\t\tn = sib;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// find up/down side file in icons view\n\t\t\t\t\t\t\ttop = s.position().top;\n\t\t\t\t\t\t\tleft = s.position().left;\n\n\t\t\t\t\t\t\tn = s;\n\t\t\t\t\t\t\tif (prev) {\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\tn = n.prev('[id]');\n\t\t\t\t\t\t\t\t} while (n.length && !(n.position().top < top && n.position().left <= left));\n\n\t\t\t\t\t\t\t\tif (n.hasClass(clDisabled)) {\n\t\t\t\t\t\t\t\t\tn = sibling(n, 'next');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\tn = n.next('[id]');\n\t\t\t\t\t\t\t\t} while (n.length && !(n.position().top > top && n.position().left >= left));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (n.hasClass(clDisabled)) {\n\t\t\t\t\t\t\t\t\tn = sibling(n, 'prev');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// there is row before last one - select last file\n\t\t\t\t\t\t\t\tif (!n.length) {\n\t\t\t\t\t\t\t\t\tsib = cwd.find('[id]:not(.'+clDisabled+'):last');\n\t\t\t\t\t\t\t\t\tif (sib.position().top > top) {\n\t\t\t\t\t\t\t\t\t\tn = sib;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// !append && unselectAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (selectedNext.length) {\n\t\t\t\t\t\t\tn = prev? selectedNext.prev() : selectedNext;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// there are no selected file - select first/last one\n\t\t\t\t\t\t\tn = cwd.find('[id]:not(.'+clDisabled+'):not(.elfinder-cwd-parent):'+(prev ? 'last' : 'first'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (n && n.length && !n.hasClass('elfinder-cwd-parent')) {\n\t\t\t\t\t\tif (s && append) {\n\t\t\t\t\t\t\t// append new files to selected\n\t\t\t\t\t\t\tn = s.add(s[prev ? 'prevUntil' : 'nextUntil']('#'+n.attr('id'))).add(n);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// unselect selected files\n\t\t\t\t\t\t\tsel.trigger(evtUnselect);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// select file(s)\n\t\t\t\t\t\tn.trigger(evtSelect);\n\t\t\t\t\t\t// set its visible\n\t\t\t\t\t\tscrollToView(n.filter(prev ? ':first' : ':last'));\n\t\t\t\t\t\t// update cache/view\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tselectedFiles = {},\n\t\t\t\t\n\t\t\t\tselectFile = function(hash) {\n\t\t\t\t\tfm.cwdHash2Elm(hash).trigger(evtSelect);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tallSelected = false,\n\t\t\t\t\n\t\t\t\tselectAll = function() {\n\t\t\t\t\tvar phash = fm.cwd().hash;\n\n\t\t\t\t\tselectCheckbox && selectAllCheckbox.find('input').prop('checked', true);\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tvar files;\n\t\t\t\t\t\tif (fm.maxTargets && (incHashes || cwdHashes).length > fm.maxTargets) {\n\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\tfiles = $.map(incHashes || cwdHashes, function(hash) { return fm.file(hash) || null; });\n\t\t\t\t\t\t\tfiles = files.slice(0, fm.maxTargets);\n\t\t\t\t\t\t\tselectedFiles = {};\n\t\t\t\t\t\t\t$.each(files, function(i, v) {\n\t\t\t\t\t\t\t\tselectedFiles[v.hash] = true;\n\t\t\t\t\t\t\t\tfm.cwdHash2Elm(v.hash).trigger(evtSelect);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.toast({mode: 'warning', msg: fm.i18n(['errMaxTargets', fm.maxTargets])});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcwd.find('[id]:not(.'+clSelected+'):not(.elfinder-cwd-parent)').trigger(evtSelect);\n\t\t\t\t\t\t\tselectedFiles = fm.arrayFlip(incHashes || cwdHashes, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.data('pending', false);\n\t\t\t\t\t}, 0, {repaint: true});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Unselect all files\n\t\t\t\t *\n\t\t\t\t * @param  Object  options\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tunselectAll = function(opts) {\n\t\t\t\t\tvar o = opts || {};\n\t\t\t\t\tselectCheckbox && selectAllCheckbox.find('input').prop('checked', false);\n\t\t\t\t\tif (Object.keys(selectedFiles).length) {\n\t\t\t\t\t\tselectLock = false;\n\t\t\t\t\t\tselectedFiles = {};\n\t\t\t\t\t\tcwd.find('[id].'+clSelected).trigger(evtUnselect);\n\t\t\t\t\t\tselectCheckbox && cwd.find('input:checkbox.'+clSelChk).prop('checked', false);\n\t\t\t\t\t}\n\t\t\t\t\t!o.notrigger && trigger();\n\t\t\t\t\tselectCheckbox && selectAllCheckbox.data('pending', false);\n\t\t\t\t\tcwd.removeClass('elfinder-cwd-allselected');\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tselectInvert = function() {\n\t\t\t\t\tvar invHashes = {};\n\t\t\t\t\tif (allSelected) {\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t} else if (! Object.keys(selectedFiles).length) {\n\t\t\t\t\t\tselectAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.each((incHashes || cwdHashes), function(i, h) {\n\t\t\t\t\t\t\tvar itemNode = fm.cwdHash2Elm(h);\n\t\t\t\t\t\t\tif (! selectedFiles[h]) {\n\t\t\t\t\t\t\t\tinvHashes[h] = true;\n\t\t\t\t\t\t\t\titemNode.length && itemNode.trigger(evtSelect);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\titemNode.length && itemNode.trigger(evtUnselect);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tselectedFiles = invHashes;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return selected files hashes list\n\t\t\t\t *\n\t\t\t\t * @return Array\n\t\t\t\t */\n\t\t\t\tselected = function() {\n\t\t\t\t\treturn Object.keys(selectedFiles);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Last selected node id\n\t\t\t\t * \n\t\t\t\t * @type String|Void\n\t\t\t\t */\n\t\t\t\tlastSelect = void 0,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Fire elfinder \"select\" event and pass selected files to it\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\ttrigger = function() {\n\t\t\t\t\tvar selected = Object.keys(selectedFiles),\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\tselected : selected,\n\t\t\t\t\t\t\torigin : 'cwd'\n\t\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tif (oldSchoolItem && (selected.length > 1 || selected[0] !== fm.cwdId2Hash(\n\t\t\t\t\t\toldSchoolItem.attr('id'))) && oldSchoolItem.hasClass(clSelected)) {\n\t\t\t\t\t\toldSchoolItem.trigger(evtUnselect);\n\t\t\t\t\t}\n\t\t\t\t\tallSelected = selected.length && (selected.length === (incHashes || cwdHashes).length) && (!fm.maxTargets || selected.length <= fm.maxTargets);\n\t\t\t\t\tif (selectCheckbox) {\n\t\t\t\t\t\tselectAllCheckbox.find('input').prop('checked', allSelected);\n\t\t\t\t\t\tcwd[allSelected? 'addClass' : 'removeClass']('elfinder-cwd-allselected');\n\t\t\t\t\t}\n\t\t\t\t\tif (allSelected) {\n\t\t\t\t\t\topts.selectall = true;\n\t\t\t\t\t} else if (! selected.length) {\n\t\t\t\t\t\topts.unselectall = true;\n\t\t\t\t\t}\n\t\t\t\t\tfm.trigger('select', opts);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Scroll file to set it visible\n\t\t\t\t *\n\t\t\t\t * @param DOMElement  file/dir node\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tscrollToView = function(o, blink) {\n\t\t\t\t\tif (! o.length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar ftop    = o.position().top,\n\t\t\t\t\t\tfheight = o.outerHeight(true),\n\t\t\t\t\t\twtop    = wrapper.scrollTop(),\n\t\t\t\t\t\twheight = wrapper.get(0).clientHeight,\n\t\t\t\t\t\tthheight = tableHeader? tableHeader.outerHeight(true) : 0;\n\n\t\t\t\t\tif (ftop + thheight + fheight > wtop + wheight) {\n\t\t\t\t\t\twrapper.scrollTop(parseInt(ftop + thheight + fheight - wheight));\n\t\t\t\t\t} else if (ftop < wtop) {\n\t\t\t\t\t\twrapper.scrollTop(ftop);\n\t\t\t\t\t}\n\t\t\t\t\tlist && wrapper.scrollLeft(0);\n\t\t\t\t\t!!blink && fm.resources.blink(o, 'lookme');\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Files we get from server but not show yet\n\t\t\t\t *\n\t\t\t\t * @type Array\n\t\t\t\t **/\n\t\t\t\tbuffer = [],\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Extra data of buffer\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\tbufferExt = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return index of elements with required hash in buffer \n\t\t\t\t *\n\t\t\t\t * @param String  file hash\n\t\t\t\t * @return Number\n\t\t\t\t */\n\t\t\t\tindex = function(hash) {\n\t\t\t\t\tvar l = buffer.length;\n\t\t\t\t\t\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\tif (buffer[l].hash == hash) {\n\t\t\t\t\t\t\treturn l;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn -1;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Scroll start event name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tscrollStartEvent = 'elfscrstart',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Scroll stop event name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tscrollEvent = 'elfscrstop',\n\t\t\t\t\n\t\t\t\tscrolling = false,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * jQuery UI selectable option\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tselectableOption = {\n\t\t\t\t\tdisabled   : true,\n\t\t\t\t\tfilter     : '[id]:first',\n\t\t\t\t\tstop       : trigger,\n\t\t\t\t\tdelay      : 250,\n\t\t\t\t\tappendTo   : 'body',\n\t\t\t\t\tautoRefresh: false,\n\t\t\t\t\tselected   : function(e, ui) { $(ui.selected).trigger(evtSelect); },\n\t\t\t\t\tunselected : function(e, ui) { $(ui.unselected).trigger(evtUnselect); }\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * hashes of items displayed in current view\n\t\t\t\t * \n\t\t\t\t * @type Object  ItemHash => DomId\n\t\t\t\t */\n\t\t\t\tinViewHashes = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Processing when the current view is changed (On open, search, scroll, resize etc.)\n\t\t\t\t * \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\twrapperRepaint = function(init, recnt) {\n\t\t\t\t\tif (!bufferExt.renderd) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar firstNode = (list? cwd.find('tbody:first') : cwd).children('[id]'+(options.oldSchool? ':not(.elfinder-cwd-parent)' : '')+':first');\n\t\t\t\t\tif (!firstNode.length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar selectable = cwd.data('selectable'),\n\t\t\t\t\t\trec = (function() {\n\t\t\t\t\t\t\tvar wos = wrapper.offset(),\n\t\t\t\t\t\t\t\tww = wrapper.width(),\n\t\t\t\t\t\t\t\tw = $(window),\n\t\t\t\t\t\t\t\tx = firstNode.width() / 2,\n\t\t\t\t\t\t\t\tl = Math.min(wos.left - w.scrollLeft() + (fm.direction === 'ltr'? x : ww - x), wos.left + ww - 10),\n\t\t\t\t\t\t\t\tt = wos.top - w.scrollTop() + 10 + (list? thHeight : 0);\n\t\t\t\t\t\t\treturn {left: Math.max(0, Math.round(l)), top: Math.max(0, Math.round(t))};\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\ttgt = init? firstNode : $(document.elementFromPoint(rec.left , rec.top)),\n\t\t\t\t\t\tids = {},\n\t\t\t\t\t\ttmbs = {},\n\t\t\t\t\t\tmulti = 5,\n\t\t\t\t\t\tcnt = Math.ceil((bufferExt.hpi? Math.ceil((wz.data('rectangle').height / bufferExt.hpi) * 1.5) : showFiles) / multi),\n\t\t\t\t\t\tchk = function() {\n\t\t\t\t\t\t\tvar id, hash, file, i;\n\t\t\t\t\t\t\tfor (i = 0; i < multi; i++) {\n\t\t\t\t\t\t\t\tid = tgt.attr('id');\n\t\t\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\t\t\tbufferExt.getTmbs = [];\n\t\t\t\t\t\t\t\t\thash = fm.cwdId2Hash(id);\n\t\t\t\t\t\t\t\t\tinViewHashes[hash] = id;\n\t\t\t\t\t\t\t\t\t// for tmbs\n\t\t\t\t\t\t\t\t\tif (bufferExt.attachTmbs[hash]) {\n\t\t\t\t\t\t\t\t\t\ttmbs[hash] = bufferExt.attachTmbs[hash];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// for selectable\n\t\t\t\t\t\t\t\t\tselectable && (ids[id] = true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// next node\n\t\t\t\t\t\t\t\ttgt = tgt.next();\n\t\t\t\t\t\t\t\tif (!tgt.length) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdone = function() {\n\t\t\t\t\t\t\tvar idsArr;\n\t\t\t\t\t\t\tif (cwd.data('selectable')) {\n\t\t\t\t\t\t\t\tObject.assign(ids, selectedFiles);\n\t\t\t\t\t\t\t\tidsArr = Object.keys(ids);\n\t\t\t\t\t\t\t\tif (idsArr.length) {\n\t\t\t\t\t\t\t\t\tselectableOption.filter = '#'+idsArr.join(', #');\n\t\t\t\t\t\t\t\t\tcwd.selectable('enable').selectable('option', {filter : selectableOption.filter}).selectable('refresh');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (Object.keys(tmbs).length) {\n\t\t\t\t\t\t\t\tbufferExt.getTmbs = [];\n\t\t\t\t\t\t\t\tattachThumbnails(tmbs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetTarget = function() {\n\t\t\t\t\t\t\tif (!tgt.hasClass(clFile)) {\n\t\t\t\t\t\t\t\ttgt = tgt.closest(fileSelector);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tarr, widget;\n\t\t\t\t\t\n\t\t\t\t\tinViewHashes = {};\n\t\t\t\t\tselectable && cwd.selectable('option', 'disabled');\n\t\t\t\t\t\n\t\t\t\t\tif (tgt.length) {\n\t\t\t\t\t\tif (!tgt.hasClass(clFile) && !tgt.closest(fileSelector).length) {\n\t\t\t\t\t\t\t// dialog, serach button etc.\n\t\t\t\t\t\t\twidget = fm.getUI().find('.ui-dialog:visible,.ui-widget:visible');\n\t\t\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\t\t\twidget.hide();\n\t\t\t\t\t\t\t\ttgt = $(document.elementFromPoint(rec.left , rec.top));\n\t\t\t\t\t\t\t\twidget.show();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twidget = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTarget();\n\t\t\t\t\t\tif (!tgt.length) {\n\t\t\t\t\t\t\t// try search 5px down\n\t\t\t\t\t\t\twidget && widget.hide();\n\t\t\t\t\t\t\ttgt = $(document.elementFromPoint(rec.left , rec.top + 5));\n\t\t\t\t\t\t\twidget && widget.show();\n\t\t\t\t\t\t\tsetTarget();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tgt.length) {\n\t\t\t\t\t\tif (tgt.attr('id')) {\n\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\tfor (var i = 0; i < cnt; i++) {\n\t\t\t\t\t\t\t\t\tchk();\n\t\t\t\t\t\t\t\t\tif (! tgt.length) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//bufferExt.repaintJob && bufferExt.repaintJob.state() === 'pending' && bufferExt.repaintJob.reject(); // modified by lwf\n\t\t\t\t\t\t\t\tarr = new Array(cnt);\n\t\t\t\t\t\t\t\tbufferExt.repaintJob = fm.asyncJob(function() {\n\t\t\t\t\t\t\t\t\tchk();\n\t\t\t\t\t\t\t\t\tif (! tgt.length) {\n\t\t\t\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t\t\t\t\t//bufferExt.repaintJob && bufferExt.repaintJob.state() === 'pending' && bufferExt.repaintJob.reject();// modified by lwf\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, arr).done(done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (init && bufferExt.renderd) {\n\t\t\t\t\t\t// In initial request, cwd DOM not renderd so doing lazy check\n\t\t\t\t\t\trecnt = recnt || 0;\n\t\t\t\t\t\tif (recnt < 10) { // Prevent infinite loop\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\twrapperRepaint(init, ++recnt);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Item node of oldScholl \"..\"\n\t\t\t\t */\n\t\t\t\toldSchoolItem = null,\n\n\t\t\t\t/**\n\t\t\t\t * display parent folder with \"..\" name\n\t\t\t\t * \n\t\t\t\t * @param  String  phash\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\toldSchool = function(p) {\n\t\t\t\t\tvar phash = fm.cwd().phash,\n\t\t\t\t\t\tpdir  = fm.file(phash) || null,\n\t\t\t\t\t\tset   = function(pdir) {\n\t\t\t\t\t\t\tif (pdir) {\n\t\t\t\t\t\t\t\toldSchoolItem = $(itemhtml($.extend(true, {}, pdir, {name : '..', i18 : '..', mime : 'directory'})))\n\t\t\t\t\t\t\t\t\t.addClass('elfinder-cwd-parent')\n\t\t\t\t\t\t\t\t\t.on('dblclick', function() {\n\t\t\t\t\t\t\t\t\t\tfm.trigger('select', {selected : [phash]}).exec('open', phash);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t(list ? oldSchoolItem.children('td:first') : oldSchoolItem).children('.elfinder-cwd-select').remove();\n\t\t\t\t\t\t\t\tif (fm.cwdHash2Elm(phash).length) {\n\t\t\t\t\t\t\t\t\tfm.cwdHash2Elm(phash).replaceWith(oldSchoolItem);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(list ? cwd.find('tbody') : cwd).prepend(oldSchoolItem);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\tif (pdir) {\n\t\t\t\t\t\tset(pdir);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tset({hash: phash, read: true, write: true});\n\t\t\t\t\t\tif (fm.getUI('tree').length) {\n\t\t\t\t\t\t\tfm.one('parents', function() {\n\t\t\t\t\t\t\t\tset(fm.file(phash) || null);\n\t\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'parents', target : fm.cwd().hash},\n\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tset(fm.file(phash) || null);\n\t\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tshowFiles = fm.options.showFiles,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Cwd scroll event handler.\n\t\t\t\t * Lazy load - append to cwd not shown files\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\trender = function() {\n\t\t\t\t\tif (bufferExt.rendering || (bufferExt.renderd && ! buffer.length)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar place = (list ? cwd.children('table').children('tbody') : cwd),\n\t\t\t\t\t\tphash,\n\t\t\t\t\t\tchk,\n\t\t\t\t\t\t// created document fragment for jQuery >= 1.12, 2.2, 3.0\n\t\t\t\t\t\t// see Studio-42/elFinder#1544 @ github\n\t\t\t\t\t\tdocFlag = $.htmlPrefilter? true : false,\n\t\t\t\t\t\ttempDom = docFlag? $(document.createDocumentFragment()) : $('<div/>'),\n\t\t\t\t\t\tgo      = function(o){\n\t\t\t\t\t\t\tvar over  = o || null,\n\t\t\t\t\t\t\t\thtml  = [],\n\t\t\t\t\t\t\t\tdirs  = false,\n\t\t\t\t\t\t\t\tatmb  = {},\n\t\t\t\t\t\t\t\tstmb  = (fm.option('tmbUrl') === 'self'),\n\t\t\t\t\t\t\t\tinit  = bufferExt.renderd? false : true,\n\t\t\t\t\t\t\t\tfiles, locks, selected;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfiles = buffer.splice(0, showFiles + (over || 0) / (bufferExt.hpi || 1));\n\t\t\t\t\t\t\tbufferExt.renderd += files.length;\n\t\t\t\t\t\t\tif (! buffer.length) {\n\t\t\t\t\t\t\t\tbottomMarker.hide();\n\t\t\t\t\t\t\t\twrapper.off(scrollEvent, render);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlocks = [];\n\t\t\t\t\t\t\thtml = $.map(files, function(f) {\n\t\t\t\t\t\t\t\tif (f.hash && f.name) {\n\t\t\t\t\t\t\t\t\tif (f.mime == 'directory') {\n\t\t\t\t\t\t\t\t\t\tdirs = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ((f.tmb && (f.tmb != 1 || f.size > 0)) || (stmb && f.mime.indexOf('image/') === 0)) {\n\t\t\t\t\t\t\t\t\t\tatmb[f.hash] = f.tmb || 'self';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tclipCuts[f.hash] && locks.push(f.hash);\n\t\t\t\t\t\t\t\t\treturn itemhtml(f);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// html into temp node\n\t\t\t\t\t\t\ttempDom.empty().append(html.join(''));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// make directory droppable\n\t\t\t\t\t\t\tdirs && !mobile && makeDroppable(tempDom);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// check selected items\n\t\t\t\t\t\t\tselected = [];\n\t\t\t\t\t\t\tif (Object.keys(selectedFiles).length) {\n\t\t\t\t\t\t\t\ttempDom.find('[id]:not(.'+clSelected+'):not(.elfinder-cwd-parent)').each(function() {\n\t\t\t\t\t\t\t\t\tselectedFiles[fm.cwdId2Hash(this.id)] && selected.push($(this));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// append to cwd\n\t\t\t\t\t\t\tplace.append(docFlag? tempDom : tempDom.children());\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// trigger select\n\t\t\t\t\t\t\tif (selected.length) {\n\t\t\t\t\t\t\t\t$.each(selected, function(i, n) { n.trigger(evtSelect); });\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlocks.length && fm.trigger('lockfiles', {files: locks});\n\t\t\t\t\t\t\t!bufferExt.hpi && bottomMarkerShow(place, files.length);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t// show thead\n\t\t\t\t\t\t\t\tcwd.find('thead').show();\n\t\t\t\t\t\t\t\t// fixed table header\n\t\t\t\t\t\t\t\tfixTableHeader({fitWidth: ! colWidth});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (Object.keys(atmb).length) {\n\t\t\t\t\t\t\t\tObject.assign(bufferExt.attachTmbs, atmb);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\tif (! mobile && ! cwd.data('selectable')) {\n\t\t\t\t\t\t\t\t\t// make files selectable\n\t\t\t\t\t\t\t\t\tcwd.selectable(selectableOption).data('selectable', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t! scrolling && wrapper.trigger(scrollEvent);\n\t\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tif (! bufferExt.renderd) {\n\t\t\t\t\t\t// first time to go()\n\t\t\t\t\t\tbufferExt.rendering = true;\n\t\t\t\t\t\t// scroll top on dir load to avoid scroll after page reload\n\t\t\t\t\t\twrapper.scrollTop(0);\n\t\t\t\t\t\tphash = fm.cwd().phash;\n\t\t\t\t\t\tgo();\n\t\t\t\t\t\tif (options.oldSchool) {\n\t\t\t\t\t\t\tif (phash && !query) {\n\t\t\t\t\t\t\t\toldSchool(phash);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\toldSchoolItem = $();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tcolWidth && setColwidth();\n\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbufferExt.itemH = (list? place.find('tr:first') : place.find('[id]:first')).outerHeight(true);\n\t\t\t\t\t\tfm.trigger('cwdrender');\n\t\t\t\t\t\tbufferExt.rendering = false;\n\t\t\t\t\t\twrapperRepaint(true);\n\t\t\t\t\t}\n\t\t\t\t\tif (! bufferExt.rendering && buffer.length) {\n\t\t\t\t\t\t// next go()\n\t\t\t\t\t\tif ((chk = (wrapper.height() + wrapper.scrollTop() + fm.options.showThreshold + bufferExt.row) - (bufferExt.renderd * bufferExt.hpi)) > 0) {\n\t\t\t\t\t\t\tbufferExt.rendering = true;\n\t\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t\tgo(chk);\n\t\t\t\t\t\t\t\tbufferExt.rendering = false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t!fm.enabled() && resize();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresize();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t// fixed table header jQuery object\n\t\t\t\ttableHeader = null,\n\n\t\t\t\t// Is UA support CSS sticky\n\t\t\t\tcssSticky = fm.UA.CSS.positionSticky && fm.UA.CSS.widthMaxContent,\n\t\t\t\t\n\t\t\t\t// To fixed table header colmun\n\t\t\t\tfixTableHeader = function(optsArg) {\n\t\t\t\t\tthHeight = 0;\n\t\t\t\t\tif (! options.listView.fixedHeader) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar setPos = function() {\n\t\t\t\t\t\tvar val, pos;\n\t\t\t\t\t\tpos = (fm.direction === 'ltr')? 'left' : 'right';\n\t\t\t\t\t\tval = ((fm.direction === 'ltr')? wrapper.scrollLeft() : table.outerWidth(true) - wrapper.width() - wrapper.scrollLeft()) * -1;\n\t\t\t\t\t\tif (base.css(pos) !== val) {\n\t\t\t\t\t\t\tbase.css(pos, val);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\topts = optsArg || {},\n\t\t\t\t\tcnt, base, table, htable, thead, tbody, hheight, htr, btr, htd, btd, htw, btw, init;\n\t\t\t\t\t\n\t\t\t\t\ttbody = cwd.find('tbody');\n\t\t\t\t\tbtr = tbody.children('tr:first');\n\t\t\t\t\tif (btr.length && btr.is(':visible')) {\n\t\t\t\t\t\ttable = tbody.parent();\n\t\t\t\t\t\tif (! tableHeader) {\n\t\t\t\t\t\t\tinit = true;\n\t\t\t\t\t\t\ttbody.addClass('elfinder-cwd-fixheader');\n\t\t\t\t\t\t\tthead = cwd.find('thead').attr('id', fm.namespace+'-cwd-thead');\n\t\t\t\t\t\t\thtr = thead.children('tr:first');\n\t\t\t\t\t\t\thheight = htr.outerHeight(true);\n\t\t\t\t\t\t\tcwd.css('margin-top', hheight - parseInt(table.css('padding-top')));\n\t\t\t\t\t\t\tif (cssSticky) {\n\t\t\t\t\t\t\t\ttableHeader = $('<div class=\"elfinder-table-header-sticky\"/>').addClass(cwd.attr('class')).append($('<table/>').append(thead));\n\t\t\t\t\t\t\t\tcwd.after(tableHeader);\n\t\t\t\t\t\t\t\twrapper.on('resize.fixheader', function(e) {\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tbase = $('<div/>').addClass(cwd.attr('class')).append($('<table/>').append(thead));\n\t\t\t\t\t\t\t\ttableHeader = $('<div/>').addClass(wrapper.attr('class') + ' elfinder-cwd-fixheader')\n\t\t\t\t\t\t\t\t\t.removeClass('ui-droppable native-droppable')\n\t\t\t\t\t\t\t\t\t.css(wrapper.position())\n\t\t\t\t\t\t\t\t\t.css({ height: hheight, width: cwd.outerWidth() })\n\t\t\t\t\t\t\t\t\t.append(base);\n\t\t\t\t\t\t\t\tif (fm.direction === 'rtl') {\n\t\t\t\t\t\t\t\t\ttableHeader.css('left', (wrapper.data('width') - wrapper.width()) + 'px');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tsetPos();\n\t\t\t\t\t\t\t\twrapper.after(tableHeader)\n\t\t\t\t\t\t\t\t\t.on('scroll.fixheader resize.fixheader', function(e) {\n\t\t\t\t\t\t\t\t\t\tsetPos();\n\t\t\t\t\t\t\t\t\t\tif (e.type === 'resize') {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\ttableHeader.css(wrapper.position());\n\t\t\t\t\t\t\t\t\t\t\twrapper.data('width', wrapper.css('overflow', 'hidden').width());\n\t\t\t\t\t\t\t\t\t\t\twrapper.css('overflow', 'auto');\n\t\t\t\t\t\t\t\t\t\t\tfixTableHeader();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthead = $('#'+fm.namespace+'-cwd-thead');\n\t\t\t\t\t\t\thtr = thead.children('tr:first');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (init || opts.fitWidth || Math.abs(btr.outerWidth() - htr.outerWidth()) > 2) {\n\t\t\t\t\t\t\tcnt = customCols.length + 1;\n\t\t\t\t\t\t\tfor (var i = 0; i < cnt; i++) {\n\t\t\t\t\t\t\t\thtd = htr.children('td:eq('+i+')');\n\t\t\t\t\t\t\t\tbtd = btr.children('td:eq('+i+')');\n\t\t\t\t\t\t\t\thtw = htd.width();\n\t\t\t\t\t\t\t\tbtw = btd.width();\n\t\t\t\t\t\t\t\tif (typeof htd.data('delta') === 'undefined') {\n\t\t\t\t\t\t\t\t\thtd.data('delta', (htd.outerWidth() - htw) - (btd.outerWidth() - btw));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbtw -= htd.data('delta');\n\t\t\t\t\t\t\t\tif (! init && ! opts.fitWidth && htw === btw) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\thtd.css('width', btw + 'px');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!cssSticky) {\n\t\t\t\t\t\t\ttableHeader.data('widthTimer') && cancelAnimationFrame(tableHeader.data('widthTimer'));\n\t\t\t\t\t\t\ttableHeader.data('widthTimer', requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tif (tableHeader) {\n\t\t\t\t\t\t\t\t\ttableHeader.css('width', mBoard.width() + 'px');\n\t\t\t\t\t\t\t\t\tif (fm.direction === 'rtl') {\n\t\t\t\t\t\t\t\t\t\ttableHeader.css('left', (wrapper.data('width') - wrapper.width()) + 'px');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthHeight = thead.height();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t// Set colmun width\n\t\t\t\tsetColwidth = function() {\n\t\t\t\t\tif (list && colWidth) {\n\t\t\t\t\t\tvar cl = 'elfinder-cwd-colwidth',\n\t\t\t\t\t\tfirst = cwd.find('tr[id]:first'),\n\t\t\t\t\t\tformer;\n\t\t\t\t\t\tif (! first.hasClass(cl)) {\n\t\t\t\t\t\t\tformer = cwd.find('tr.'+cl);\n\t\t\t\t\t\t\tformer.removeClass(cl).find('td').css('width', '');\n\t\t\t\t\t\t\tfirst.addClass(cl);\n\t\t\t\t\t\t\tcwd.find('table:first').css('table-layout', 'fixed');\n\t\t\t\t\t\t\t$.each($.merge(['name'], customCols), function(i, k) {\n\t\t\t\t\t\t\t\tvar w = colWidth[k] || first.find('td.elfinder-col-'+k).width();\n\t\t\t\t\t\t\t\tfirst.find('td.elfinder-col-'+k).width(w);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable options for cwd.\n\t\t\t\t * Drop target is `wrapper`\n\t\t\t\t * Do not add class on childs file over\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tdroppable = Object.assign({}, fm.droppable, {\n\t\t\t\t\tover : function(e, ui) {\n\t\t\t\t\t\tvar dst    = $(this),\n\t\t\t\t\t\t\thelper = ui.helper,\n\t\t\t\t\t\t\tctr    = (e.shiftKey || e.ctrlKey || e.metaKey),\n\t\t\t\t\t\t\thash, status, inParent;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\thelper.data('dropover', helper.data('dropover') + 1);\n\t\t\t\t\t\tdst.data('dropover', true);\n\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\tif (helper.data('namespace') !== fm.namespace || ! fm.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\t\t\tdst.removeClass(clDropActive);\n\t\t\t\t\t\t\t//helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dst.hasClass(fm.res(c, 'cwdfile'))) {\n\t\t\t\t\t\t\thash = fm.cwdId2Hash(dst.attr('id'));\n\t\t\t\t\t\t\tdst.data('dropover', hash);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thash = fm.cwd().hash;\n\t\t\t\t\t\t\tfm.cwd().write && dst.data('dropover', hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinParent = (fm.file(helper.data('files')[0]).phash === hash);\n\t\t\t\t\t\tif (dst.data('dropover') === hash) {\n\t\t\t\t\t\t\t$.each(helper.data('files'), function(i, h) {\n\t\t\t\t\t\t\t\tif (h === hash || (inParent && !ctr && !helper.hasClass('elfinder-drag-helper-plus'))) {\n\t\t\t\t\t\t\t\t\tdst.removeClass(clDropActive);\n\t\t\t\t\t\t\t\t\treturn false; // break $.each\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdst.removeClass(clDropActive);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (helper.data('locked') || inParent) {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-plus';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-move';\n\t\t\t\t\t\t\tif (ctr) {\n\t\t\t\t\t\t\t\tstatus += ' elfinder-drag-helper-plus';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdst.hasClass(clDropActive) && helper.addClass(status);\n\t\t\t\t\t\trequestAnimationFrame(function(){ dst.hasClass(clDropActive) && helper.addClass(status); });\n\t\t\t\t\t},\n\t\t\t\t\tout : function(e, ui) {\n\t\t\t\t\t\tvar helper = ui.helper;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus').data('dropover', Math.max(helper.data('dropover') - 1, 0));\n\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t       .removeClass(clDropActive);\n\t\t\t\t\t},\n\t\t\t\t\tdeactivate : function() {\n\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t       .removeClass(clDropActive);\n\t\t\t\t\t},\n\t\t\t\t\tdrop : function(e, ui) {\n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tfm.droppable.drop.call(this, e, ui);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Make directory droppable\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tmakeDroppable = function(place) {\n\t\t\t\t\tplace = place? place : (list ? cwd.find('tbody') : cwd);\n\t\t\t\t\tvar targets = place.children('.directory:not(.'+clDroppable+',.elfinder-na,.elfinder-ro)');\n\n\t\t\t\t\tif (fm.isCommandEnabled('paste')) {\n\t\t\t\t\t\ttargets.droppable(droppable);\n\t\t\t\t\t}\n\t\t\t\t\tif (fm.isCommandEnabled('upload')) {\n\t\t\t\t\t\ttargets.addClass('native-droppable');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tplace.children('.isroot').each(function(i, n) {\n\t\t\t\t\t\tvar $n   = $(n),\n\t\t\t\t\t\t\thash = fm.cwdId2Hash(n.id);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (fm.isCommandEnabled('paste', hash)) {\n\t\t\t\t\t\t\tif (! $n.hasClass(clDroppable+',elfinder-na,elfinder-ro')) {\n\t\t\t\t\t\t\t\t$n.droppable(droppable);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ($n.hasClass(clDroppable)) {\n\t\t\t\t\t\t\t\t$n.droppable('destroy');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (fm.isCommandEnabled('upload', hash)) {\n\t\t\t\t\t\t\tif (! $n.hasClass('native-droppable,elfinder-na,elfinder-ro')) {\n\t\t\t\t\t\t\t\t$n.addClass('native-droppable');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ($n.hasClass('native-droppable')) {\n\t\t\t\t\t\t\t\t$n.removeClass('native-droppable');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Preload required thumbnails and on load add css to files.\n\t\t\t\t * Return false if required file is not visible yet (in buffer) -\n\t\t\t\t * required for old api to stop loading thumbnails.\n\t\t\t\t *\n\t\t\t\t * @param  Object  file hash -> thumbnail map\n\t\t\t\t * @param  Bool    reload\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tattachThumbnails = function(tmbs, reload) {\n\t\t\t\t\tvar attach = function(node, tmb) {\n\t\t\t\t\t\t\t$('<img/>')\n\t\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\t\tnode.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\");\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchk  = function(hash, tmb) {\n\t\t\t\t\t\t\tvar node = fm.cwdHash2Elm(hash),\n\t\t\t\t\t\t\t\tfile, tmbObj, reloads = [];\n\t\t\n\t\t\t\t\t\t\tif (node.length) {\n\t\t\t\t\t\t\t\tif (tmb != '1') {\n\t\t\t\t\t\t\t\t\tfile = fm.file(hash);\n\t\t\t\t\t\t\t\t\tif (file.tmb !== tmb) {\n\t\t\t\t\t\t\t\t\t\tfile.tmb = tmb;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ttmbObj = fm.tmb(file);\n\t\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\t\tnode.find('.elfinder-cwd-icon').addClass(tmbObj.className).css('background-image', \"url('\"+tmbObj.url+\"')\");\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tattach(node, tmbObj);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdelete bufferExt.attachTmbs[hash];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\t\tloadThumbnails([hash]);\n\t\t\t\t\t\t\t\t\t} else if (! bufferExt.tmbLoading[hash]) {\n\t\t\t\t\t\t\t\t\t\tbufferExt.getTmbs.push(hash);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\tif ($.isPlainObject(tmbs) && Object.keys(tmbs).length) {\n\t\t\t\t\t\tObject.assign(bufferExt.attachTmbs, tmbs);\n\t\t\t\t\t\t$.each(tmbs, chk);\n\t\t\t\t\t\tif (! reload && bufferExt.getTmbs.length && ! Object.keys(bufferExt.tmbLoading).length) {\n\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Load thumbnails from backend.\n\t\t\t\t *\n\t\t\t\t * @param  Array|void reloads  hashes list for reload thumbnail items\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tloadThumbnails = function(reloads) {\n\t\t\t\t\tvar tmbs = [],\n\t\t\t\t\t\treload = false;\n\t\t\t\t\t\n\t\t\t\t\tif (fm.oldAPI) {\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'tmb', current : fm.cwd().hash},\n\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tif (data.images && Object.keys(data.images).length) {\n\t\t\t\t\t\t\t\tattachThumbnails(data.images);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (data.tmb) {\n\t\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} \n\n\t\t\t\t\tif (reloads) {\n\t\t\t\t\t\treload = true;\n\t\t\t\t\t\ttmbs = reloads.splice(0, tmbNum);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttmbs = bufferExt.getTmbs.splice(0, tmbNum);\n\t\t\t\t\t}\n\t\t\t\t\tif (tmbs.length) {\n\t\t\t\t\t\tif (reload || inViewHashes[tmbs[0]] || inViewHashes[tmbs[tmbs.length-1]]) {\n\t\t\t\t\t\t\t$.each(tmbs, function(i, h) {\n\t\t\t\t\t\t\t\tbufferExt.tmbLoading[h] = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'tmb', targets : tmbs},\n\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tvar errs = [],\n\t\t\t\t\t\t\t\t\tresLen;\n\t\t\t\t\t\t\t\tif (data.images) {\n\t\t\t\t\t\t\t\t\tif (resLen = Object.keys(data.images).length) {\n\t\t\t\t\t\t\t\t\t\tif (resLen < tmbs.length) {\n\t\t\t\t\t\t\t\t\t\t\t$.each(tmbs, function(i, h) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (! data.images[h]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\terrs.push(h);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tattachThumbnails(data.images, reload);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\terrs = tmbs;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// unset error items from bufferExt.attachTmbs\n\t\t\t\t\t\t\t\t\tif (errs.length) {\n\t\t\t\t\t\t\t\t\t\t$.each(errs, function(i, h) {\n\t\t\t\t\t\t\t\t\t\t\tdelete bufferExt.attachTmbs[h];\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\tif (reloads.length) {\n\t\t\t\t\t\t\t\t\t\tloadThumbnails(reloads);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\tbufferExt.tmbLoading = {};\n\t\t\t\t\t\t\t\tif (! reload && bufferExt.getTmbs.length) {\n\t\t\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Add new files to cwd/buffer\n\t\t\t\t *\n\t\t\t\t * @param  Array  new files\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tadd = function(files, mode) {\n\t\t\t\t\tvar place    = list ? cwd.find('tbody') : cwd,\n\t\t\t\t\t\tl        = files.length, \n\t\t\t\t\t\tatmb     = {},\n\t\t\t\t\t\tfindNode = function(file) {\n\t\t\t\t\t\t\tvar pointer = cwd.find('[id]:first'), file2;\n\n\t\t\t\t\t\t\twhile (pointer.length) {\n\t\t\t\t\t\t\t\tfile2 = fm.file(fm.cwdId2Hash(pointer.attr('id')));\n\t\t\t\t\t\t\t\tif (!pointer.hasClass('elfinder-cwd-parent') && file2 && fm.compare(file, file2) < 0) {\n\t\t\t\t\t\t\t\t\treturn pointer;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpointer = pointer.next('[id]');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfindIndex = function(file) {\n\t\t\t\t\t\t\tvar l = buffer.length, i;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor (i =0; i < l; i++) {\n\t\t\t\t\t\t\t\tif (fm.compare(file, buffer[i]) < 0) {\n\t\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn l || -1;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// created document fragment for jQuery >= 1.12, 2.2, 3.0\n\t\t\t\t\t\t// see Studio-42/elFinder#1544 @ github\n\t\t\t\t\t\tdocFlag = $.htmlPrefilter? true : false,\n\t\t\t\t\t\ttempDom = docFlag? $(document.createDocumentFragment()) : $('<div/>'),\n\t\t\t\t\t\tfile, hash, node, nodes, ndx, stmb;\n\n\t\t\t\t\tif (l > showFiles) {\n\t\t\t\t\t\t// re-render for performance tune\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t\tselectedFiles = fm.arrayFlip($.map(files, function(f) { return f.hash; }), true);\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// add the item immediately\n\t\t\t\t\t\tl && wz.removeClass('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Self thumbnail\n\t\t\t\t\t\tstmb = (fm.option('tmbUrl') === 'self');\n\t\t\t\t\t\t\n\t\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\t\tfile = files[l];\n\t\t\t\t\t\t\thash = file.hash;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(hash).length) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif ((node = findNode(file)) && ! node.length) {\n\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (! node && (ndx = findIndex(file)) >= 0) {\n\t\t\t\t\t\t\t\tbuffer.splice(ndx, 0, file);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttempDom.empty().append(itemhtml(file));\n\t\t\t\t\t\t\t\t(file.mime === 'directory') && !mobile && makeDroppable(tempDom);\n\t\t\t\t\t\t\t\tnodes = docFlag? tempDom : tempDom.children();\n\t\t\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\t\t\tnode.before(nodes);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tplace.append(nodes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t++bufferExt.renderd;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(hash).length) {\n\t\t\t\t\t\t\t\tif ((file.tmb && (file.tmb != 1 || file.size > 0)) || (stmb && file.mime.indexOf('image/') === 0)) {\n\t\t\t\t\t\t\t\t\tatmb[hash] = file.tmb || 'self';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tsetColwidth();\n\t\t\t\t\t\t\tfixTableHeader({fitWidth: ! colWidth});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbottomMarkerShow(place);\n\t\t\t\t\t\tif (Object.keys(atmb).length) {\n\t\t\t\t\t\t\tObject.assign(bufferExt.attachTmbs, atmb);\n\t\t\t\t\t\t\tif (buffer.length < 1) {\n\t\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Remove files from cwd/buffer\n\t\t\t\t *\n\t\t\t\t * @param  Array  files hashes\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tremove = function(files) {\n\t\t\t\t\tvar l = files.length,\n\t\t\t\t\t\tinSearch = fm.searchStatus.state > 1,\n\t\t\t\t\t\tcurCmd = fm.getCommand(fm.currentReqCmd) || {},\n\t\t\t\t\t\thash, n, ndx, found;\n\n\t\t\t\t\t// removed cwd\n\t\t\t\t\tif (!fm.cwd().hash && !curCmd.noChangeDirOnRemovedCwd) {\n\t\t\t\t\t\t$.each(cwdParents.reverse(), function(i, h) {\n\t\t\t\t\t\t\tif (fm.file(h)) {\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\tfm.one(fm.currentReqCmd + 'done', function() {\n\t\t\t\t\t\t\t\t\t!fm.cwd().hash && fm.exec('open', h);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// fallback to fm.roots[0]\n\t\t\t\t\t\t!found && !fm.cwd().hash && fm.exec('open', fm.roots[Object.keys(fm.roots)[0]]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\thash = files[l];\n\t\t\t\t\t\tif ((n = fm.cwdHash2Elm(hash)).length) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tn.remove();\n\t\t\t\t\t\t\t\t--bufferExt.renderd;\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tfm.debug('error', e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ((ndx = index(hash)) !== -1) {\n\t\t\t\t\t\t\tbuffer.splice(ndx, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselectedFiles[hash] && delete selectedFiles[hash];\n\t\t\t\t\t\tif (inSearch) {\n\t\t\t\t\t\t\tif ((ndx = $.inArray(hash, cwdHashes)) !== -1) {\n\t\t\t\t\t\t\t\tcwdHashes.splice(ndx, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tinSearch && fm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tsetColwidth();\n\t\t\t\t\t\tfixTableHeader({fitWidth: ! colWidth});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcustomColsNameBuild = function() {\n\t\t\t\t\tvar name = '',\n\t\t\t\t\tcustomColsName = '';\n\t\t\t\t\tfor (var i = 0; i < customCols.length; i++) {\n\t\t\t\t\t\tname = fm.getColumnName(customCols[i]);\n\t\t\t\t\t\tcustomColsName +='<td class=\"elfinder-cwd-view-th-'+customCols[i]+' sortable-item\">'+name+'</td>';\n\t\t\t\t\t}\n\t\t\t\t\treturn customColsName;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tsetItemBoxSize = function(boxSize) {\n\t\t\t\t\tvar place, elm;\n\t\t\t\t\tif (!boxSize.height) {\n\t\t\t\t\t\tplace = (list ? cwd.find('tbody') : cwd);\n\t\t\t\t\t\telm = place.find(list? 'tr:first' : '[id]:first');\n\t\t\t\t\t\tboxSize.height = elm.outerHeight(true);\n\t\t\t\t\t\tif (!list) {\n\t\t\t\t\t\t\tboxSize.width = elm.outerWidth(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tbottomMarkerShow = function(cur, cnt) {\n\t\t\t\t\tvar place = cur || (list ? cwd.find('tbody') : cwd),\n\t\t\t\t\t\tboxSize = itemBoxSize[fm.viewType],\n\t\t\t\t\t\tcol = 1,\n\t\t\t\t\t\trow;\n\n\t\t\t\t\tif (buffer.length > 0) {\n\t\t\t\t\t\tif (!bufferExt.hpi) {\n\t\t\t\t\t\t\tsetItemBoxSize(boxSize);\n\t\t\t\t\t\t\tif (! list) {\n\t\t\t\t\t\t\t\tcol = Math.floor(place.width() / boxSize.width);\n\t\t\t\t\t\t\t\tbufferExt.row = boxSize.height;\n\t\t\t\t\t\t\t\tbufferExt.hpi = bufferExt.row / col;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tbufferExt.row = bufferExt.hpi = boxSize.height;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (!list) {\n\t\t\t\t\t\t\tcol = Math.floor(place.width() / boxSize.width);\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow = Math.ceil((buffer.length + (cnt || 0)) / col);\n\t\t\t\t\t\tif (list && tableHeader) {\n\t\t\t\t\t\t\t++row;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbottomMarker.css({top: (bufferExt.row * row) + 'px'}).show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\twrapperContextMenu = {\n\t\t\t\t\tcontextmenu : function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif (cwd.data('longtap') !== void(0)) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t'type'    : 'cwd',\n\t\t\t\t\t\t\t'targets' : [fm.cwd().hash],\n\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\ttouchstart : function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cwd.data('longtap') !== false) {\n\t\t\t\t\t\t\twrapper.data('touching', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY});\n\t\t\t\t\t\t\tcwd.data('tmlongtap', setTimeout(function(){\n\t\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\t\tcwd.data('longtap', true);\n\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t'type'    : 'cwd',\n\t\t\t\t\t\t\t\t\t'targets' : [fm.cwd().hash],\n\t\t\t\t\t\t\t\t\t'x'       : wrapper.data('touching').x,\n\t\t\t\t\t\t\t\t\t'y'       : wrapper.data('touching').y\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcwd.data('longtap', null);\n\t\t\t\t\t},\n\t\t\t\t\ttouchend : function(e) {\n\t\t\t\t\t\tif (e.type === 'touchmove') {\n\t\t\t\t\t\t\tif (! wrapper.data('touching') ||\n\t\t\t\t\t\t\t\t\t( Math.abs(wrapper.data('touching').x - e.originalEvent.touches[0].pageX)\n\t\t\t\t\t\t\t\t\t+ Math.abs(wrapper.data('touching').y - e.originalEvent.touches[0].pageY)) > 4) {\n\t\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcwd.removeData('longtap');\n\t\t\t\t\t\t\t}, 80);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclearTimeout(cwd.data('tmlongtap'));\n\t\t\t\t\t},\n\t\t\t\t\tclick : function(e) {\n\t\t\t\t\t\tif (cwd.data('longtap')) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Update directory content\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tcontent = function() {\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tvar phash, emptyMethod, thtr;\n\n\t\t\t\t\t\twz.append(selectAllCheckbox).removeClass('elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result elfinder-letsearch-result');\n\t\t\t\t\t\tif (fm.searchStatus.state > 1 || fm.searchStatus.ininc) {\n\t\t\t\t\t\t\twz.addClass('elfinder-search-result' + (fm.searchStatus.ininc? ' elfinder-'+(query.substr(0,1) === '/' ? 'let':'inc')+'search-result' : ''));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// abort attachThumbJob\n\t\t\t\t\t\tbufferExt.attachThumbJob && bufferExt.attachThumbJob._abort();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// destroy selectable for GC\n\t\t\t\t\t\tcwd.data('selectable') && cwd.selectable('disable').selectable('destroy').removeData('selectable');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// notify cwd init\n\t\t\t\t\t\tfm.trigger('cwdinit');\n\t\t\t\t\t\t\n\t\t\t\t\t\tselectedNext = $();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// to avoid problem with draggable\n\t\t\t\t\t\t\tcwd.empty();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tcwd.html('');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (tableHeader) {\n\t\t\t\t\t\t\twrapper.off('scroll.fixheader resize.fixheader');\n\t\t\t\t\t\t\ttableHeader.remove();\n\t\t\t\t\t\t\ttableHeader = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcwd.removeClass('elfinder-cwd-view-icons elfinder-cwd-view-list')\n\t\t\t\t\t\t\t.addClass('elfinder-cwd-view-'+(list ? 'list' :'icons'))\n\t\t\t\t\t\t\t.attr('style', '')\n\t\t\t\t\t\t\t.css('height', 'auto');\n\t\t\t\t\t\tbottomMarker.hide();\n\n\t\t\t\t\t\twrapper[list ? 'addClass' : 'removeClass']('elfinder-cwd-wrapper-list')._padding = parseInt(wrapper.css('padding-top')) + parseInt(wrapper.css('padding-bottom'));\n\t\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t\twrapper.removeClass('overflow-scrolling-touch').addClass('overflow-scrolling-touch');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tcwd.html('<table><thead/><tbody/></table>');\n\t\t\t\t\t\t\tthtr = $('<tr class=\"ui-state-default\"><td class=\"elfinder-cwd-view-th-name\">'+fm.getColumnName('name')+'</td>'+customColsNameBuild()+'</tr>');\n\t\t\t\t\t\t\tcwd.find('thead').hide().append(thtr).find('td:first').append(selectAllCheckbox);\n\t\t\t\t\t\t\tif ($.fn.sortable) {\n\t\t\t\t\t\t\t\tthtr.addClass('touch-punch touch-punch-keep-default')\n\t\t\t\t\t\t\t\t\t.sortable({\n\t\t\t\t\t\t\t\t\taxis: 'x',\n\t\t\t\t\t\t\t\t\tdistance: 8,\n\t\t\t\t\t\t\t\t\titems: '> .sortable-item',\n\t\t\t\t\t\t\t\t\tstart: function(e, ui) {\n\t\t\t\t\t\t\t\t\t\t$(ui.item[0]).data('dragging', true);\n\t\t\t\t\t\t\t\t\t\tui.placeholder\n\t\t\t\t\t\t\t\t\t\t\t.width(ui.helper.removeClass('ui-state-hover').width())\n\t\t\t\t\t\t\t\t\t\t\t.removeClass('ui-state-active')\n\t\t\t\t\t\t\t\t\t\t\t.addClass('ui-state-hover')\n\t\t\t\t\t\t\t\t\t\t\t.css('visibility', 'visible');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tupdate: function(e, ui){\n\t\t\t\t\t\t\t\t\t\tvar target = $(ui.item[0]).attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', ''),\n\t\t\t\t\t\t\t\t\t\t\tprev, done;\n\t\t\t\t\t\t\t\t\t\tcustomCols = $.map($(this).children(), function(n) {\n\t\t\t\t\t\t\t\t\t\t\tvar name = $(n).attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', '');\n\t\t\t\t\t\t\t\t\t\t\tif (! done) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (target === name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdone = true;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprev = name;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn (name === 'name')? null : name;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\ttemplates.row = makeTemplateRow();\n\t\t\t\t\t\t\t\t\t\tfm.storage('cwdCols', customCols);\n\t\t\t\t\t\t\t\t\t\tprev = '.elfinder-col-'+prev+':first';\n\t\t\t\t\t\t\t\t\t\ttarget = '.elfinder-col-'+target+':first';\n\t\t\t\t\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t\t\t\t\tcwd.find('tbody tr').each(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t\t\t\t\t\t\t\t$this.children(prev).after($this.children(target));\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tstop: function(e, ui) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t$(ui.item[0]).removeData('dragging');\n\t\t\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthtr.find('td').addClass('touch-punch').resizable({\n\t\t\t\t\t\t\t\thandles: fm.direction === 'ltr'? 'e' : 'w',\n\t\t\t\t\t\t\t\tstart: function(e, ui) {\n\t\t\t\t\t\t\t\t\tvar target = cwd.find('td.elfinder-col-'\n\t\t\t\t\t\t\t\t\t\t+ ui.element.attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', '')\n\t\t\t\t\t\t\t\t\t\t+ ':first');\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tui.element\n\t\t\t\t\t\t\t\t\t\t.data('dragging', true)\n\t\t\t\t\t\t\t\t\t\t.data('resizeTarget', target)\n\t\t\t\t\t\t\t\t\t\t.data('targetWidth', target.width());\n\t\t\t\t\t\t\t\t\tcolResizing = true;\n\t\t\t\t\t\t\t\t\tif (cwd.find('table').css('table-layout') !== 'fixed') {\n\t\t\t\t\t\t\t\t\t\tcwd.find('tbody tr:first td').each(function() {\n\t\t\t\t\t\t\t\t\t\t\t$(this).width($(this).width());\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tcwd.find('table').css('table-layout', 'fixed');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tresize: function(e, ui) {\n\t\t\t\t\t\t\t\t\tui.element.data('resizeTarget').width(ui.element.data('targetWidth') - (ui.originalSize.width - ui.size.width));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tstop : function(e, ui) {\n\t\t\t\t\t\t\t\t\tcolResizing = false;\n\t\t\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t\t\t\tcolWidth = {};\n\t\t\t\t\t\t\t\t\tcwd.find('tbody tr:first td').each(function() {\n\t\t\t\t\t\t\t\t\t\tvar name = $(this).attr('class').split(' ')[0].replace('elfinder-col-', '');\n\t\t\t\t\t\t\t\t\t\tcolWidth[name] = $(this).width();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfm.storage('cwdColWidth', colWidth);\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tui.element.removeData('dragging');\n\t\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.find('.ui-resizable-handle').addClass('ui-icon ui-icon-grip-dotted-vertical');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbuffer = $.map(incHashes || cwdHashes, function(hash) { return fm.file(hash) || null; });\n\t\t\t\t\t\t\n\t\t\t\t\t\tbuffer = fm.sortFiles(buffer);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (incHashes) {\n\t\t\t\t\t\t\tincHashes = $.map(buffer, function(f) { return f.hash; });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcwdHashes = $.map(buffer, function(f) { return f.hash; });\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tbufferExt = {\n\t\t\t\t\t\t\trenderd: 0,\n\t\t\t\t\t\t\tattachTmbs: {},\n\t\t\t\t\t\t\tgetTmbs: [],\n\t\t\t\t\t\t\ttmbLoading: {},\n\t\t\t\t\t\t\tlazyOpts: { tm : 0 }\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\twz[(buffer.length < 1) ? 'addClass' : 'removeClass']('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\twrapper.off(scrollEvent, render).on(scrollEvent, render).trigger(scrollEvent);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// set droppable\n\t\t\t\t\t\tif (!fm.cwd().write) {\n\t\t\t\t\t\t\twrapper.removeClass('native-droppable')\n\t\t\t\t\t\t\t       .droppable('disable')\n\t\t\t\t\t\t\t       .removeClass('ui-state-disabled'); // for old jQueryUI see https://bugs.jqueryui.com/ticket/5974\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twrapper[fm.isCommandEnabled('upload')? 'addClass' : 'removeClass']('native-droppable');\n\t\t\t\t\t\t\twrapper.droppable(fm.isCommandEnabled('paste')? 'enable' : 'disable');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * CWD node itself\n\t\t\t\t *\n\t\t\t\t * @type JQuery\n\t\t\t\t **/\n\t\t\t\tcwd = $(this)\n\t\t\t\t\t.addClass('ui-helper-clearfix elfinder-cwd')\n\t\t\t\t\t.attr('unselectable', 'on')\n\t\t\t\t\t// fix ui.selectable bugs and add shift+click support \n\t\t\t\t\t.on('click.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tvar p    = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\ttgt  = $(e.target),\n\t\t\t\t\t\t\tprev,\n\t\t\t\t\t\t\tnext,\n\t\t\t\t\t\t\tpl,\n\t\t\t\t\t\t\tnl,\n\t\t\t\t\t\t\tsib;\n\n\t\t\t\t\t\tif (selectCheckbox && (tgt.is('input:checkbox.'+clSelChk) || tgt.hasClass('elfinder-cwd-select'))) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tp.trigger(p.hasClass(clSelected) ? evtUnselect : evtSelect);\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\ttgt.prop('checked', p.hasClass(clSelected));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cwd.data('longtap') || tgt.hasClass('elfinder-cwd-nonselect')) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!curClickId) {\n\t\t\t\t\t\t\tcurClickId = p.attr('id');\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcurClickId = '';\n\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\t\tprev = p.prevAll(lastSelect || '.'+clSelected+':first');\n\t\t\t\t\t\t\tnext = p.nextAll(lastSelect || '.'+clSelected+':first');\n\t\t\t\t\t\t\tpl   = prev.length;\n\t\t\t\t\t\t\tnl   = next.length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.shiftKey && (pl || nl)) {\n\t\t\t\t\t\t\tsib = pl ? p.prevUntil('#'+prev.attr('id')) : p.nextUntil('#'+next.attr('id'));\n\t\t\t\t\t\t\tsib = sib.add(p);\n\t\t\t\t\t\t\tif (!pl) {\n\t\t\t\t\t\t\t\tsib  = $(sib.get().reverse());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsib.trigger(evtSelect);\n\t\t\t\t\t\t} else if (e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\t\tp.trigger(p.hasClass(clSelected) ? evtUnselect : evtSelect);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (wrapper.data('touching') && p.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\t\tfm.dblclick({file : fm.cwdId2Hash(this.id)});\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\t\tp.trigger(evtSelect);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t})\n\t\t\t\t\t// call fm.open()\n\t\t\t\t\t.on('dblclick.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tif (curClickId) {\n\t\t\t\t\t\t\tvar hash = fm.cwdId2Hash(curClickId);\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tif (this.id !== curClickId) {\n\t\t\t\t\t\t\t\t$(this).trigger(evtUnselect);\n\t\t\t\t\t\t\t\t$('#'+curClickId).trigger(evtSelect);\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.dblclick({file : hash});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// for touch device\n\t\t\t\t\t.on('touchstart.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar p   = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\ttgt = $(e.target),\n\t\t\t\t\t\t\tnodeName = e.target.nodeName,\n\t\t\t\t\t\t\tsel;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((nodeName === 'INPUT' && e.target.type === 'text') || nodeName === 'TEXTAREA' || tgt.hasClass('elfinder-cwd-nonselect')) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now name editing\n\t\t\t\t\t\tif (p.find('input:text,textarea').length) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\twrapper.data('touching', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY});\n\t\t\t\t\t\tif (selectCheckbox && (tgt.is('input:checkbox.'+clSelChk) || tgt.hasClass('elfinder-cwd-select'))) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsel = p.prevAll('.'+clSelected+':first').length +\n\t\t\t\t\t\t      p.nextAll('.'+clSelected+':first').length;\n\t\t\t\t\t\tcwd.data('longtap', null);\n\t\t\t\t\t\tif (Object.keys(selectedFiles).length\n\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t(list && e.target.nodeName !== 'TD')\n\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t(!list && this !== e.target)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcwd.data('longtap', false);\n\t\t\t\t\t\t\tp.addClass(clHover);\n\t\t\t\t\t\t\tp.data('tmlongtap', setTimeout(function(){\n\t\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\t\tcwd.data('longtap', true);\n\t\t\t\t\t\t\t\tp.trigger(evtSelect);\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t'type'    : 'files',\n\t\t\t\t\t\t\t\t\t'targets' : fm.selected(),\n\t\t\t\t\t\t\t\t\t'x'       : e.originalEvent.touches[0].pageX,\n\t\t\t\t\t\t\t\t\t'y'       : e.originalEvent.touches[0].pageY\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchmove.'+fm.namespace+' touchend.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tvar tgt = $(e.target),\n\t\t\t\t\t\t\tp;\n\t\t\t\t\t\tif (selectCheckbox && (tgt.is('input:checkbox.'+clSelChk) || tgt.hasClass('elfinder-cwd-select'))) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.target.nodeName == 'INPUT' || e.target.nodeName == 'TEXTAREA') {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tp = this.id ? $(this) : $(this).parents('[id]:first');\n\t\t\t\t\t\tclearTimeout(p.data('tmlongtap'));\n\t\t\t\t\t\tif (e.type === 'touchmove') {\n\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\tp.removeClass(clHover);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (wrapper.data('touching') && !cwd.data('longtap') && p.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\t\tfm.dblclick({file : fm.cwdId2Hash(this.id)});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcwd.removeData('longtap');\n\t\t\t\t\t\t\t}, 80);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// attach draggable\n\t\t\t\t\t.on('mouseenter.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tif (scrolling) { return; }\n\t\t\t\t\t\tvar $this = $(this), helper = null;\n\n\t\t\t\t\t\tif (!mobile && !$this.data('dragRegisted') && !$this.hasClass(clTmp) && !$this.hasClass(clDraggable) && !$this.hasClass(clDisabled)) {\n\t\t\t\t\t\t\t$this.data('dragRegisted', true);\n\t\t\t\t\t\t\tif (!fm.isCommandEnabled('copy', fm.searchStatus.state > 1 || $this.hasClass('isroot')? fm.cwdId2Hash($this.attr('id')) : void 0)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.on('mousedown', function(e) {\n\t\t\t\t\t\t\t\t// shiftKey or altKey + drag start for HTML5 native drag function\n\t\t\t\t\t\t\t\t// Note: can no use shiftKey with the Google Chrome \n\t\t\t\t\t\t\t\tvar metaKey = options.metakeyDragout && !fm.UA.IE && (e.shiftKey || e.altKey),\n\t\t\t\t\t\t\t\t\tdisable = false;\n\t\t\t\t\t\t\t\tif (metaKey && cwd.data('selectable')) {\n\t\t\t\t\t\t\t\t\t// destroy jQuery-ui selectable while trigger native drag\n\t\t\t\t\t\t\t\t\tcwd.selectable('disable').selectable('destroy').removeData('selectable');\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function(){\n\t\t\t\t\t\t\t\t\t\tcwd.selectable(selectableOption).selectable('option', {disabled: false}).selectable('refresh').data('selectable', true);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$this.removeClass('ui-state-disabled');\n\t\t\t\t\t\t\t\tif (metaKey) {\n\t\t\t\t\t\t\t\t\t$this.draggable('option', 'disabled', true).attr('draggable', 'true');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (!$this.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t\t\t\tdisable = $(e.target).closest('span,tr').is('tr');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdisable = $(e.target).hasClass('elfinder-cwd-file');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (disable) {\n\t\t\t\t\t\t\t\t\t\t// removeClass('ui-state-disabled') for old version of jQueryUI\n\t\t\t\t\t\t\t\t\t\t$this.draggable('option', 'disabled', true).removeClass('ui-state-disabled');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t$this.draggable('option', 'disabled', false)\n\t\t\t\t\t\t\t\t\t\t\t  .removeAttr('draggable')\n\t\t\t\t\t\t\t\t\t\t      .draggable('option', 'cursorAt', {left: 50 - parseInt($(e.currentTarget).css('margin-left')), top: 47});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragstart', function(e) {\n\t\t\t\t\t\t\t\tvar dt = e.dataTransfer || e.originalEvent.dataTransfer || null;\n\t\t\t\t\t\t\t\thelper = null;\n\t\t\t\t\t\t\t\tif (dt && !fm.UA.IE) {\n\t\t\t\t\t\t\t\t\tvar p = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\t\t\t\telm   = $('<span>'),\n\t\t\t\t\t\t\t\t\t\turl   = '',\n\t\t\t\t\t\t\t\t\t\tdurl  = null,\n\t\t\t\t\t\t\t\t\t\tmurl  = null,\n\t\t\t\t\t\t\t\t\t\tfiles = [],\n\t\t\t\t\t\t\t\t\t\ticon  = function(f) {\n\t\t\t\t\t\t\t\t\t\t\tvar mime = f.mime, i, tmb = fm.tmb(f);\n\t\t\t\t\t\t\t\t\t\t\ti = '<div class=\"elfinder-cwd-icon elfinder-cwd-icon-drag '+fm.mime2class(mime)+' ui-corner-all\"/>';\n\t\t\t\t\t\t\t\t\t\t\tif (tmb) {\n\t\t\t\t\t\t\t\t\t\t\t\ti = $(i).addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\").get(0).outerHTML;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t\t\t\t}, l, geturl = [];\n\t\t\t\t\t\t\t\t\tp.trigger(evtSelect);\n\t\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t\t\t$.each(selectedFiles, function(v){\n\t\t\t\t\t\t\t\t\t\tvar file = fm.file(v),\n\t\t\t\t\t\t\t\t\t\t\tfurl = file.url;\n\t\t\t\t\t\t\t\t\t\tif (file && file.mime !== 'directory') {\n\t\t\t\t\t\t\t\t\t\t\tif (!furl) {\n\t\t\t\t\t\t\t\t\t\t\t\tfurl = fm.url(file.hash);\n\t\t\t\t\t\t\t\t\t\t\t} else if (furl == '1') {\n\t\t\t\t\t\t\t\t\t\t\t\tgeturl.push(v);\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (furl) {\n\t\t\t\t\t\t\t\t\t\t\t\tfurl = fm.convAbsUrl(furl);\n\t\t\t\t\t\t\t\t\t\t\t\tfiles.push(v);\n\t\t\t\t\t\t\t\t\t\t\t\t$('<a>').attr('href', furl).text(furl).appendTo(elm);\n\t\t\t\t\t\t\t\t\t\t\t\turl += furl + \"\\n\";\n\t\t\t\t\t\t\t\t\t\t\t\tif (!durl) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdurl = file.mime + ':' + file.name + ':' + furl;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tif (!murl) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmurl = furl + \"\\n\" + file.name;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (geturl.length) {\n\t\t\t\t\t\t\t\t\t\t$.each(geturl, function(i, v){\n\t\t\t\t\t\t\t\t\t\t\tvar rfile = fm.file(v);\n\t\t\t\t\t\t\t\t\t\t\trfile.url = '';\n\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : v},\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'url', cnt : 1},\n\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\trfile.url = data.url? data.url : '1';\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t} else if (url) {\n\t\t\t\t\t\t\t\t\t\tif (dt.setDragImage) {\n\t\t\t\t\t\t\t\t\t\t\thelper = $('<div class=\"elfinder-drag-helper html5-native\"></div>').append(icon(fm.file(files[0]))).appendTo($(document.body));\n\t\t\t\t\t\t\t\t\t\t\tif ((l = files.length) > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\thelper.append(icon(fm.file(files[l-1])) + '<span class=\"elfinder-drag-num\">'+l+'</span>');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdt.setDragImage(helper.get(0), 50, 47);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdt.effectAllowed = 'copyLink';\n\t\t\t\t\t\t\t\t\t\tdt.setData('DownloadURL', durl);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/x-moz-url', murl);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/uri-list', url);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/plain', url);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/html', elm.html());\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom', window.location.href + fm.cwd().hash);\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom:' + dt.getData('elfinderfrom'), '');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragend', function(e){\n\t\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\t\thelper && helper.remove();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.draggable(fm.draggable);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// add hover class to selected file\n\t\t\t\t\t.on(evtSelect, fileSelector, function(e) {\n\t\t\t\t\t\tvar $this = $(this),\n\t\t\t\t\t\t\tid    = fm.cwdId2Hash($this.attr('id'));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!selectLock && !$this.hasClass(clDisabled)) {\n\t\t\t\t\t\t\tlastSelect = '#'+ this.id;\n\t\t\t\t\t\t\t$this.addClass(clSelected).children().addClass(clHover).find('input:checkbox.'+clSelChk).prop('checked', true);\n\t\t\t\t\t\t\tif (! selectedFiles[id]) {\n\t\t\t\t\t\t\t\tselectedFiles[id] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// will be selected next\n\t\t\t\t\t\t\tselectedNext = cwd.find('[id].'+clSelected+':last').next();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// remove hover class from unselected file\n\t\t\t\t\t.on(evtUnselect, fileSelector, function(e) {\n\t\t\t\t\t\tvar $this = $(this), \n\t\t\t\t\t\t\tid    = fm.cwdId2Hash($this.attr('id'));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!selectLock) {\n\t\t\t\t\t\t\t$this.removeClass(clSelected).children().removeClass(clHover).find('input:checkbox.'+clSelChk).prop('checked', false);\n\t\t\t\t\t\t\tif (cwd.hasClass('elfinder-cwd-allselected')) {\n\t\t\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.children('input').prop('checked', false);\n\t\t\t\t\t\t\t\tcwd.removeClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tselectedFiles[id] && delete selectedFiles[id];\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t})\n\t\t\t\t\t// disable files wich removing or moving\n\t\t\t\t\t.on(evtDisable, fileSelector, function() {\n\t\t\t\t\t\tvar $this  = $(this).removeClass(clHover+' '+clSelected).addClass(clDisabled), \n\t\t\t\t\t\t\tchild  = $this.children(),\n\t\t\t\t\t\t\ttarget = (list ? $this : child.find('div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename'));\n\t\t\t\t\t\t\n\t\t\t\t\t\tchild.removeClass(clHover+' '+clSelected);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$this.hasClass(clDroppable) && $this.droppable('disable');\n\t\t\t\t\t\ttarget.hasClass(clDraggable) && target.draggable('disable');\n\t\t\t\t\t})\n\t\t\t\t\t// if any files was not removed/moved - unlock its\n\t\t\t\t\t.on(evtEnable, fileSelector, function() {\n\t\t\t\t\t\tvar $this  = $(this).removeClass(clDisabled), \n\t\t\t\t\t\t\ttarget = list ? $this : $this.children('div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename');\n\t\t\t\t\t\t\n\t\t\t\t\t\t$this.hasClass(clDroppable) && $this.droppable('enable');\t\n\t\t\t\t\t\ttarget.hasClass(clDraggable) && target.draggable('enable');\n\t\t\t\t\t})\n\t\t\t\t\t.on('scrolltoview', fileSelector, function(e, data) {\n\t\t\t\t\t\tscrollToView($(this), (data && typeof data.blink !== 'undefined')? data.blink : true);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter.'+fm.namespace+' mouseleave.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tvar enter = (e.type === 'mouseenter');\n\t\t\t\t\t\tif (enter && (scrolling || fm.UA.Mobile)) { return; }\n\t\t\t\t\t\tfm.trigger('hover', {hash : fm.cwdId2Hash($(this).attr('id')), type : e.type});\n\t\t\t\t\t\t$(this).toggleClass(clHover, (e.type == 'mouseenter'));\n\t\t\t\t\t})\n\t\t\t\t\t// for file contextmenu\n\t\t\t\t\t.on('mouseenter.'+fm.namespace+' mouseleave.'+fm.namespace, '.elfinder-cwd-file-wrapper,.elfinder-cwd-filename', function(e) {\n\t\t\t\t\t\tvar enter = (e.type === 'mouseenter');\n\t\t\t\t\t\tif (enter && scrolling) { return; }\n\t\t\t\t\t\t$(this).closest(fileSelector).children('.elfinder-cwd-file-wrapper,.elfinder-cwd-filename').toggleClass(clActive, (e.type == 'mouseenter'));\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu.'+fm.namespace, function(e) {\n\t\t\t\t\t\tvar file = $(e.target).closest(fileSelector);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.get(0) === e.target && !selectedFiles[fm.cwdId2Hash(file.get(0).id)]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// now filename editing\n\t\t\t\t\t\tif (file.find('input:text,textarea').length) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.length && (e.target.nodeName != 'TD' || selectedFiles[fm.cwdId2Hash(file.get(0).id)])) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tif (!file.hasClass(clDisabled) && !wrapper.data('touching')) {\n\t\t\t\t\t\t\t\tif (!file.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\t\t\tfile.trigger(evtSelect);\n\t\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t'type'    : 'files',\n\t\t\t\t\t\t\t\t\t'targets' : fm.selected(),\n\t\t\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// unselect all on cwd click\n\t\t\t\t\t.on('click.'+fm.namespace, function(e) {\n\t\t\t\t\t\tif (e.target === this && ! cwd.data('longtap')) {\n\t\t\t\t\t\t\t!e.shiftKey && !e.ctrlKey && !e.metaKey && unselectAll();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// prepend fake file/dir\n\t\t\t\t\t.on('create.'+fm.namespace, function(e, f) {\n\t\t\t\t\t\tvar parent = list ? cwd.find('tbody') : cwd,\n\t\t\t\t\t\t\tp = parent.find('.elfinder-cwd-parent'),\n\t\t\t\t\t\t\tlock = f.move || false,\n\t\t\t\t\t\t\tfile = $(itemhtml(f)).addClass(clTmp),\n\t\t\t\t\t\t\tselected = fm.selected();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (selected.length) {\n\t\t\t\t\t\t\tlock && fm.trigger('lockfiles', {files: selected});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (p.length) {\n\t\t\t\t\t\t\tp.after(file);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparent.prepend(file);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsetColwidth();\n\t\t\t\t\t\twrapper.scrollTop(0).scrollLeft(0);\n\t\t\t\t\t})\n\t\t\t\t\t// unselect all selected files\n\t\t\t\t\t.on('unselectall', unselectAll)\n\t\t\t\t\t.on('selectfile', function(e, id) {\n\t\t\t\t\t\tfm.cwdHash2Elm(id).trigger(evtSelect);\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t})\n\t\t\t\t\t.on('colwidth', function() {\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tcwd.find('table').css('table-layout', '')\n\t\t\t\t\t\t\t\t.find('td').css('width', '');\n\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t\tfm.storage('cwdColWidth', colWidth = null);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('iconpref', function(e, data) {\n\t\t\t\t\t\tcwd.removeClass(function(i, cName) {\n\t\t\t\t\t\t\treturn (cName.match(/\\belfinder-cwd-size\\S+/g) || []).join(' ');\n\t\t\t\t\t\t});\n\t\t\t\t\t\ticonSize = data? (parseInt(data.size) || 0) : 0;\n\t\t\t\t\t\tif (!list) {\n\t\t\t\t\t\t\tif (iconSize > 0) {\n\t\t\t\t\t\t\t\tcwd.addClass('elfinder-cwd-size' + iconSize);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (bufferExt.renderd) {\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\titemBoxSize.icons = {};\n\t\t\t\t\t\t\t\t\tbufferExt.hpi = null;\n\t\t\t\t\t\t\t\t\tbottomMarkerShow(cwd, bufferExt.renderd);\n\t\t\t\t\t\t\t\t\twrapperRepaint();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// Change icon size with mouse wheel event\n\t\t\t\t\t.on('onwheel' in document ? 'wheel' : 'mousewheel', function(e) {\n\t\t\t\t\t\tvar tm, size, delta;\n\t\t\t\t\t\tif (!list && ((e.ctrlKey && !e.metaKey) || (!e.ctrlKey && e.metaKey))) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\ttm = cwd.data('wheelTm');\n\t\t\t\t\t\t\tif (typeof tm !== 'undefined') {\n\t\t\t\t\t\t\t\tclearTimeout(tm);\n\t\t\t\t\t\t\t\tcwd.data('wheelTm', setTimeout(function() {\n\t\t\t\t\t\t\t\t\tcwd.removeData('wheelTm');\n\t\t\t\t\t\t\t\t}, 200));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcwd.data('wheelTm', false);\n\t\t\t\t\t\t\t\tsize = iconSize || 0;\n\t\t\t\t\t\t\t\tdelta = e.originalEvent.deltaY ? e.originalEvent.deltaY : -(e.originalEvent.wheelDelta);\n\t\t\t\t\t\t\t\tif (delta > 0) {\n\t\t\t\t\t\t\t\t\tif (iconSize > 0) {\n\t\t\t\t\t\t\t\t\t\tsize = iconSize - 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (iconSize < options.iconsView.sizeMax) {\n\t\t\t\t\t\t\t\t\t\tsize = iconSize + 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (size !== iconSize) {\n\t\t\t\t\t\t\t\t\tfm.storage('iconsize', size);\n\t\t\t\t\t\t\t\t\tcwd.trigger('iconpref', {size: size});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\twrapper = $('<div class=\"elfinder-cwd-wrapper\"/>')\n\t\t\t\t\t// make cwd itself droppable for folders from nav panel\n\t\t\t\t\t.droppable(Object.assign({}, droppable, {autoDisable: false}))\n\t\t\t\t\t.on('contextmenu.'+fm.namespace, wrapperContextMenu.contextmenu)\n\t\t\t\t\t.on('touchstart.'+fm.namespace, wrapperContextMenu.touchstart)\n\t\t\t\t\t.on('touchmove.'+fm.namespace+' touchend.'+fm.namespace, wrapperContextMenu.touchend)\n\t\t\t\t\t.on('click.'+fm.namespace, wrapperContextMenu.click)\n\t\t\t\t\t.on('scroll.'+fm.namespace, function() {\n\t\t\t\t\t\tif (! scrolling) {\n\t\t\t\t\t\t\tcwd.data('selectable') && cwd.selectable('disable');\n\t\t\t\t\t\t\twrapper.trigger(scrollStartEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tscrolling = true;\n\t\t\t\t\t\tbufferExt.scrtm && cancelAnimationFrame(bufferExt.scrtm);\n\t\t\t\t\t\tif (bufferExt.scrtm && Math.abs((bufferExt.scrolltop || 0) - (bufferExt.scrolltop = (this.scrollTop || $(this).scrollTop()))) < 5) {\n\t\t\t\t\t\t\tbufferExt.scrtm = 0;\n\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbufferExt.scrtm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\tbufferExt.scrtm = 0;\n\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on(scrollEvent, function() {\n\t\t\t\t\t\tscrolling = false;\n\t\t\t\t\t\twrapperRepaint();\n\t\t\t\t\t}),\n\t\t\t\t\n\t\t\t\tbottomMarker = $('<div>&nbsp;</div>')\n\t\t\t\t\t.css({position: 'absolute', width: '1px', height: '1px'})\n\t\t\t\t\t.hide(),\n\t\t\t\t\n\t\t\t\tselectAllCheckbox = selectCheckbox? $('<div class=\"elfinder-cwd-selectall\"><input type=\"checkbox\"/></div>')\n\t\t\t\t\t.attr('title', fm.i18n('selectall'))\n\t\t\t\t\t.on('touchstart mousedown click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif ($(this).data('pending') || e.type === 'click') {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselectAllCheckbox.data('pending', true);\n\t\t\t\t\t\tif (cwd.hasClass('elfinder-cwd-allselected')) {\n\t\t\t\t\t\t\tselectAllCheckbox.find('input').prop('checked', false);\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselectAll();\n\t\t\t\t\t\t}\n\t\t\t\t\t}) : $(),\n\t\t\t\t\n\t\t\t\trestm = null,\n\t\t\t\tresize = function(init) {\n\t\t\t\t\tvar initHeight = function() {\n\t\t\t\t\t\tif (typeof bufferExt.renderd !== 'undefined') {\n\t\t\t\t\t\t\tvar h = 0;\n\t\t\t\t\t\t\twrapper.siblings('div.elfinder-panel:visible').each(function() {\n\t\t\t\t\t\t\t\th += $(this).outerHeight(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\twrapper.height(wz.height() - h - wrapper._padding);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tinit && initHeight();\n\t\t\t\t\t\n\t\t\t\t\trestm && cancelAnimationFrame(restm);\n\t\t\t\t\trestm = requestAnimationFrame(function(){\n\t\t\t\t\t\t!init && initHeight();\n\t\t\t\t\t\tvar wph, cwdoh;\n\t\t\t\t\t\t// fix cwd height if it less then wrapper\n\t\t\t\t\t\tcwd.css('height', 'auto');\n\t\t\t\t\t\twph = wrapper[0].clientHeight - parseInt(wrapper.css('padding-top')) - parseInt(wrapper.css('padding-bottom')) - parseInt(cwd.css('margin-top')),\n\t\t\t\t\t\tcwdoh = cwd.outerHeight(true);\n\t\t\t\t\t\tif (cwdoh < wph) {\n\t\t\t\t\t\t\tcwd.height(wph);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tlist && ! colResizing && (init? wrapper.trigger('resize.fixheader') : fixTableHeader());\n\t\t\t\t\t\n\t\t\t\t\twrapperRepaint();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t// elfinder node\n\t\t\t\tparent = $(this).parent().on('resize', resize),\n\t\t\t\t\n\t\t\t\t// workzone node \n\t\t\t\twz = parent.children('.elfinder-workzone').append(wrapper.append(this).append(bottomMarker)),\n\t\t\t\t\n\t\t\t\t// message board\n\t\t\t\tmBoard = $('<div class=\"elfinder-cwd-message-board\"/>').insertAfter(cwd),\n\n\t\t\t\t// Volume expires\n\t\t\t\tvExpires = $('<div class=\"elfinder-cwd-expires\" />'),\n\n\t\t\t\tvExpiresTm,\n\n\t\t\t\tshowVolumeExpires = function() {\n\t\t\t\t\tvar remain, sec, int;\n\t\t\t\t\tvExpiresTm && clearTimeout(vExpiresTm);\n\t\t\t\t\tif (curVolId && fm.volumeExpires[curVolId]) {\n\t\t\t\t\t\tsec = fm.volumeExpires[curVolId] - ((+new Date()) / 1000);\n\t\t\t\t\t\tint = (sec % 60) + 0.1;\n\t\t\t\t\t\tremain = Math.floor(sec / 60);\n\t\t\t\t\t\tvExpires.html(fm.i18n(['minsLeft', remain])).show();\n\t\t\t\t\t\tif (remain) {\n\t\t\t\t\t\t\tvExpiresTm = setTimeout(showVolumeExpires, int * 1000);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// each item box size\n\t\t\t\titemBoxSize = {\n\t\t\t\t\ticons : {},\n\t\t\t\t\tlist : {}\n\t\t\t\t},\n\n\t\t\t\t// has UI tree\n\t\t\t\thasUiTree,\n\n\t\t\t\t// Icon size of icons view\n\t\t\t\ticonSize,\n\n\t\t\t\t// Current volume id\n\t\t\t\tcurVolId,\n\t\t\t\t\n\t\t\t\twinScrTm;\n\n\t\t\t// IE < 11 not support CSS `pointer-events: none`\n\t\t\tif (!fm.UA.ltIE10) {\n\t\t\t\tmBoard.append($('<div class=\"elfinder-cwd-trash\" />').html(fm.i18n('volume_Trash')))\n\t\t\t\t      .append(vExpires);\n\t\t\t}\n\n\t\t\t// setup by options\n\t\t\treplacement = Object.assign(replacement, options.replacement || {});\n\t\t\t\n\t\t\ttry {\n\t\t\t\tcolWidth = fm.storage('cwdColWidth')? fm.storage('cwdColWidth') : null;\n\t\t\t} catch(e) {\n\t\t\t\tcolWidth = null;\n\t\t\t}\n\t\t\t\n\t\t\t// setup costomCols\n\t\t\tfm.bind('columnpref', function(e) {\n\t\t\t\tvar opts = e.data || {};\n\t\t\t\tif (customCols = fm.storage('cwdCols')) {\n\t\t\t\t\tcustomCols = $.grep(customCols, function(n) {\n\t\t\t\t\t\treturn (options.listView.columns.indexOf(n) !== -1)? true : false;\n\t\t\t\t\t});\n\t\t\t\t\tif (options.listView.columns.length > customCols.length) {\n\t\t\t\t\t\t$.each(options.listView.columns, function(i, n) {\n\t\t\t\t\t\t\tif (customCols.indexOf(n) === -1) {\n\t\t\t\t\t\t\t\tcustomCols.push(n);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcustomCols = options.listView.columns;\n\t\t\t\t}\n\t\t\t\t// column names array that hidden\n\t\t\t\tvar columnhides = fm.storage('columnhides') || null;\n\t\t\t\tif (columnhides && Object.keys(columnhides).length)\n\t\t\t\tcustomCols = $.grep(customCols, function(n) {\n\t\t\t\t\treturn columnhides[n]? false : true;\n\t\t\t\t});\n\t\t\t\t// make template with customCols\n\t\t\t\ttemplates.row = makeTemplateRow();\n\t\t\t\t// repaint if need it\n\t\t\t\tlist && opts.repaint && content();\n\t\t\t}).trigger('columnpref');\n\n\t\t\tif (mobile) {\n\t\t\t\t// for iOS5 bug\n\t\t\t\t$('body').on('touchstart touchmove touchend', function(e){});\n\t\t\t}\n\t\t\t\n\t\t\tselectCheckbox && cwd.addClass('elfinder-has-checkbox');\n\t\t\t\n\t\t\t$(window).on('scroll.'+fm.namespace, function() {\n\t\t\t\twinScrTm && cancelAnimationFrame(winScrTm);\n\t\t\t\twinScrTm = requestAnimationFrame(function() {\n\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\t$(document).on('keydown.'+fm.namespace, function(e) {\n\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\n\t\t\t\t\tif (! fm.getUI().find('.ui-widget:visible').length) {\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tfm\n\t\t\t\t.one('init', function(){\n\t\t\t\t\tvar style = document.createElement('style'),\n\t\t\t\t\tsheet, node, base, resizeTm, iconSize, i = 0;\n\t\t\t\t\tif (document.head) {\n\t\t\t\t\t\tdocument.head.appendChild(style);\n\t\t\t\t\t\tsheet = style.sheet;\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyFolder')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty .native-droppable .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyFolder'+(mobile? 'LTap' : 'Drop'))+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyFolder')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptySearch')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyIncSearch')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-letsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyLetSearch')+'\" }', i++);\n\t\t\t\t\t}\n\t\t\t\t\tif (iconSize = (fm.storage('iconsize') || options.iconsView.size || 0)) {\n\t\t\t\t\t\ticonSize = Math.min(iconSize, options.iconsView.sizeMax);\n\t\t\t\t\t\tcwd.trigger('iconpref', {size: iconSize});\n\t\t\t\t\t}\n\t\t\t\t\tif (! mobile) {\n\t\t\t\t\t\tfm.one('open', function() {\n\t\t\t\t\t\t\tsheet && fm.zIndex && sheet.insertRule('.ui-selectable-helper{z-index:'+fm.zIndex+';}', i++);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbase = $('<div style=\"position:absolute\"/>');\n\t\t\t\t\t\tnode = fm.getUI();\n\t\t\t\t\t\tnode.on('resize', function(e, data) {\n\t\t\t\t\t\t\tvar offset;\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tif (data && data.fullscreen) {\n\t\t\t\t\t\t\t\toffset = node.offset();\n\t\t\t\t\t\t\t\tif (data.fullscreen === 'on') {\n\t\t\t\t\t\t\t\t\tbase.css({top:offset.top * -1 , left:offset.left * -1 }).appendTo(node);\n\t\t\t\t\t\t\t\t\tselectableOption.appendTo = base;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tbase.detach();\n\t\t\t\t\t\t\t\t\tselectableOption.appendTo = 'body';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcwd.data('selectable') && cwd.selectable('option', {appendTo : selectableOption.appendTo});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\thasUiTree = fm.getUI('tree').length;\n\t\t\t\t})\n\t\t\t\t.bind('enable', function() {\n\t\t\t\t\tresize();\n\t\t\t\t})\n\t\t\t\t.bind('request.open', function() {\n\t\t\t\t\tbufferExt.getTmbs = [];\n\t\t\t\t})\n\t\t\t\t.one('open', function() {\n\t\t\t\t\tif (fm.maxTargets) {\n\t\t\t\t\t\ttmbNum = Math.min(fm.maxTargets, tmbNum);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('open add remove searchend', function() {\n\t\t\t\t\tvar phash = fm.cwd().hash,\n\t\t\t\t\t\ttype = this.type;\n\t\t\t\t\tif (type === 'open' || type === 'searchend' || fm.searchStatus.state < 2) {\n\t\t\t\t\t\tcwdHashes = $.map(fm.files(phash), function(f) { return f.hash; });\n\t\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t}\n\t\t\t\t\tif (type === 'open') {\n\t\t\t\t\t\tvar inTrash = function() {\n\t\t\t\t\t\t\t\tvar isIn = false;\n\t\t\t\t\t\t\t\t$.each(cwdParents, function(i, h) {\n\t\t\t\t\t\t\t\t\tif (fm.trashes[h]) {\n\t\t\t\t\t\t\t\t\t\tisIn = true;\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn isIn;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treq = phash?\n\t\t\t\t\t\t\t\t(! fm.file(phash) || hasUiTree?\n\t\t\t\t\t\t\t\t\t(! hasUiTree?\n\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\tcmd    : 'parents',\n\t\t\t\t\t\t\t\t\t\t\t\ttarget : fm.cwd().hash\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t\t\t}) : (function() {\n\t\t\t\t\t\t\t\t\t\t\tvar dfd = $.Deferred();\n\t\t\t\t\t\t\t\t\t\t\tfm.one('treesync', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\te.data.always(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t\t\t\t\t\t})()\n\t\t\t\t\t\t\t\t\t) : null\n\t\t\t\t\t\t\t\t) : null,\n\t\t\t\t\t\t\tcwdObj = fm.cwd();\n\t\t\t\t\t\t// add/remove volume id class\n\t\t\t\t\t\tif (cwdObj.volumeid !== curVolId) {\n\t\t\t\t\t\t\tvExpires.empty().hide();\n\t\t\t\t\t\t\tif (curVolId) {\n\t\t\t\t\t\t\t\twrapper.removeClass('elfinder-cwd-wrapper-' + curVolId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcurVolId = cwdObj.volumeid;\n\t\t\t\t\t\t\tshowVolumeExpires();\n\t\t\t\t\t\t\twrapper.addClass('elfinder-cwd-wrapper-' + curVolId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// add/remove trash class\n\t\t\t\t\t\t$.when(req).done(function() {\n\t\t\t\t\t\t\tcwdParents = fm.parents(cwdObj.hash);\n\t\t\t\t\t\t\twrapper[inTrash()? 'addClass':'removeClass']('elfinder-cwd-wrapper-trash');\n\t\t\t\t\t\t});\n\t\t\t\t\t\tincHashes = void 0;\n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('search', function(e) {\n\t\t\t\t\tcwdHashes = $.map(e.data.files, function(f) { return f.hash; });\n\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\tincHashes = void 0;\n\t\t\t\t\tfm.searchStatus.ininc = false;\n\t\t\t\t\tcontent();\n\t\t\t\t\tfm.autoSync('stop');\n\t\t\t\t})\n\t\t\t\t.bind('searchend', function(e) {\n\t\t\t\t\tif (query || incHashes) {\n\t\t\t\t\t\tquery = '';\n\t\t\t\t\t\tif (incHashes) {\n\t\t\t\t\t\t\tfm.trigger('incsearchend', e.data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!e.data || !e.data.noupdate) {\n\t\t\t\t\t\t\t\tcontent();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfm.autoSync();\n\t\t\t\t})\n\t\t\t\t.bind('searchstart', function(e) {\n\t\t\t\t\tunselectAll();\n\t\t\t\t\tquery = e.data.query;\n\t\t\t\t})\n\t\t\t\t.bind('incsearchstart', function(e) {\n\t\t\t\t\tvar q = e.data.query || '',\n\t\t\t\t\t\ttype =  e.data.type || 'SearchName',\n\t\t\t\t\t\tsearchTypes = fm.options.commandsOptions.search.searchTypes || {};\n\n\t\t\t\t\tif ((searchTypes[type] && searchTypes[type].incsearch) || type === 'SearchName') {\n\t\t\t\t\t\tselectedFiles = {};\n\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t// incremental search\n\t\t\t\t\t\t\tvar regex, incSearch, fst = '';\n\t\t\t\t\t\t\tquery = q;\n\t\t\t\t\t\t\tif (q) {\n\t\t\t\t\t\t\t\tif (q.substr(0,1) === '/') {\n\t\t\t\t\t\t\t\t\tq = q.substr(1);\n\t\t\t\t\t\t\t\t\tfst = '^';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tregex = new RegExp(fst + q.replace(/([\\\\*\\;\\.\\?\\[\\]\\{\\}\\(\\)\\^\\$\\-\\|])/g, '\\\\$1'), 'i');\n\t\t\t\t\t\t\t\tif (type === 'SearchName') {\n\t\t\t\t\t\t\t\t\tincHashes = $.grep(cwdHashes, function(hash) {\n\t\t\t\t\t\t\t\t\t\tvar file = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\treturn (file && (file.name.match(regex) || (file.i18 && file.i18.match(regex))))? true : false;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tincSearch = searchTypes[type].incsearch;\n\t\t\t\t\t\t\t\t\tif (typeof incSearch === 'string') {\n\t\t\t\t\t\t\t\t\t\tincHashes = $.grep(cwdHashes, function(hash) {\n\t\t\t\t\t\t\t\t\t\t\tvar file = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\t\treturn (file && file[incSearch] && (file[incSearch] + '').match(regex))? true : false;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (typeof incSearch === 'function') {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tincHashes = $.grep(incSearch({val: q, regex: regex}, cwdHashes, fm), function(hash) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn fm.file(hash)? true : false;\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\t\tincHashes = [];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.trigger('incsearch', { hashes: incHashes, query: q })\n\t\t\t\t\t\t\t\t\t.searchStatus.ininc = true;\n\t\t\t\t\t\t\t\tcontent();\n\t\t\t\t\t\t\t\tfm.autoSync('stop');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.trigger('incsearchend');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('incsearchend', function(e) {\n\t\t\t\t\tquery = '';\n\t\t\t\t\tfm.searchStatus.ininc = false;\n\t\t\t\t\tincHashes = void 0;\n\t\t\t\t\tif (!e.data || !e.data.noupdate) {\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t}\n\t\t\t\t\tfm.autoSync();\n\t\t\t\t})\n\t\t\t\t.bind('sortchange', function() {\n\t\t\t\t\tvar lastScrollLeft = wrapper.scrollLeft(),\n\t\t\t\t\t\tallsel = cwd.hasClass('elfinder-cwd-allselected');\n\t\t\t\t\t\n\t\t\t\t\tcontent();\n\t\t\t\t\tfm.one('cwdrender', function() {\n\t\t\t\t\t\twrapper.scrollLeft(lastScrollLeft);\n\t\t\t\t\t\tif (allsel) {\n\t\t\t\t\t\t\tselectedFiles = fm.arrayFlip(incHashes || cwdHashes, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t(allsel || Object.keys(selectedFiles).length) && trigger();\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.bind('viewchange', function() {\n\t\t\t\t\tvar l      = fm.viewType != 'list',\n\t\t\t\t\t\tallsel = cwd.hasClass('elfinder-cwd-allselected');\n\t\t\t\t\t\n\t\t\t\t\tif (l != list) {\n\t\t\t\t\t\tlist = l;\n\t\t\t\t\t\tfm.viewType = list? 'list' : 'icons';\n\t\t\t\t\t\tif (iconSize) {\n\t\t\t\t\t\t\tfm.one('cwdinit', function() {\n\t\t\t\t\t\t\t\tcwd.trigger('iconpref', {size: iconSize});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t\tresize();\n\n\t\t\t\t\t\tif (allsel) {\n\t\t\t\t\t\t\tcwd.addClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\tselectAllCheckbox.find('input').prop('checked', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tObject.keys(selectedFiles).length && trigger();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('wzresize', function() {\n\t\t\t\t\tvar place = list ? cwd.find('tbody') : cwd,\n\t\t\t\t\t\tcwdOffset;\n\t\t\t\t\tresize(true);\n\t\t\t\t\tif (bufferExt.hpi) {\n\t\t\t\t\t\tbottomMarkerShow(place, place.find('[id]').length);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcwdOffset = cwd.offset();\n\t\t\t\t\twz.data('rectangle', Object.assign(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidth: wz.width(),\n\t\t\t\t\t\t\theight: wz.height(),\n\t\t\t\t\t\t\tcwdEdge: (fm.direction === 'ltr')? cwdOffset.left : cwdOffset.left + cwd.width()\n\t\t\t\t\t\t},\n\t\t\t\t\t\twz.offset())\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tbufferExt.itemH = (list? place.find('tr:first') : place.find('[id]:first')).outerHeight(true);\n\t\t\t\t})\n\t\t\t\t.bind('changeclipboard', function(e) {\n\t\t\t\t\tclipCuts = {};\n\t\t\t\t\tif (e.data && e.data.clipboard && e.data.clipboard.length) {\n\t\t\t\t\t\t$.each(e.data.clipboard, function(i, f) {\n\t\t\t\t\t\t\tif (f.cut) {\n\t\t\t\t\t\t\t\tclipCuts[f.hash] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('resMixinMake', function() {\n\t\t\t\t\tsetColwidth();\n\t\t\t\t})\n\t\t\t\t.bind('tmbreload', function(e) {\n\t\t\t\t\tvar imgs = {},\n\t\t\t\t\t\tfiles = (e.data && e.data.files)? e.data.files : null;\n\t\t\t\t\t\n\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\tif (f.tmb && f.tmb != '1') {\n\t\t\t\t\t\t\timgs[f.hash] = f.tmb;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (Object.keys(imgs).length) {\n\t\t\t\t\t\tattachThumbnails(imgs, true);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.add(function(e) {\n\t\t\t\t\tvar regex = query? new RegExp(query.replace(/([\\\\*\\;\\.\\?\\[\\]\\{\\}\\(\\)\\^\\$\\-\\|])/g, '\\\\$1'), 'i') : null,\n\t\t\t\t\t\tmime  = fm.searchStatus.mime,\n\t\t\t\t\t\tinSearch = fm.searchStatus.state > 1,\n\t\t\t\t\t\tphash = inSearch && fm.searchStatus.target? fm.searchStatus.target : fm.cwd().hash,\n\t\t\t\t\t\tcurPath = fm.path(phash),\n\t\t\t\t\t\tinTarget = function(f) {\n\t\t\t\t\t\t\tvar res, parents, path;\n\t\t\t\t\t\t\tres = (f.phash === phash);\n\t\t\t\t\t\t\tif (!res && inSearch) {\n\t\t\t\t\t\t\t\tpath = f.path || fm.path(f.hash);\n\t\t\t\t\t\t\t\tres = (curPath && path.indexOf(curPath) === 0);\n\t\t\t\t\t\t\t\tif (! res && fm.searchStatus.mixed) {\n\t\t\t\t\t\t\t\t\tres = $.grep(fm.searchStatus.mixed, function(vid) { return f.hash.indexOf(vid) === 0? true : false; }).length? true : false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (res && inSearch) {\n\t\t\t\t\t\t\t\tif (mime) {\n\t\t\t\t\t\t\t\t\tres = (f.mime.indexOf(mime) === 0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tres = (f.name.match(regex) || (f.i18 && f.i18.match(regex)))? true : false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfiles = $.grep(e.data.added || [], function(f) { return inTarget(f)? true : false ;});\n\t\t\t\t\tadd(files);\n\t\t\t\t\tif (fm.searchStatus.state === 2) {\n\t\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\t\tif ($.inArray(f.hash, cwdHashes) === -1) {\n\t\t\t\t\t\t\t\tcwdHashes.push(f.hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t}\n\t\t\t\t\tlist && resize();\n\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t})\n\t\t\t\t.change(function(e) {\n\t\t\t\t\tvar phash = fm.cwd().hash,\n\t\t\t\t\t\tsel   = fm.selected(),\n\t\t\t\t\t\tfiles, added;\n\n\t\t\t\t\tif (query) {\n\t\t\t\t\t\t$.each(e.data.changed || [], function(i, file) {\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(file.hash).length) {\n\t\t\t\t\t\t\t\tremove([file.hash]);\n\t\t\t\t\t\t\t\tadd([file], 'change');\n\t\t\t\t\t\t\t\t$.inArray(file.hash, sel) !== -1 && selectFile(file.hash);\n\t\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.each($.grep(e.data.changed || [], function(f) { return f.phash == phash ? true : false; }), function(i, file) {\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(file.hash).length) {\n\t\t\t\t\t\t\t\tremove([file.hash]);\n\t\t\t\t\t\t\t\tadd([file], 'change');\n\t\t\t\t\t\t\t\t$.inArray(file.hash, sel) !== -1 && selectFile(file.hash);\n\t\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (added) {\n\t\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t\tlist && resize();\n\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\ttrigger();\n\t\t\t\t})\n\t\t\t\t.remove(function(e) {\n\t\t\t\t\tvar place = list ? cwd.find('tbody') : cwd;\n\t\t\t\t\tremove(e.data.removed || []);\n\t\t\t\t\ttrigger();\n\t\t\t\t\tif (buffer.length < 1 && place.children(fileSelector + (options.oldSchool? ':not(.elfinder-cwd-parent)' : '')).length < 1) {\n\t\t\t\t\t\twz.addClass('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.find('input').prop('checked', false);\n\t\t\t\t\t\tbottomMarker.hide();\n\t\t\t\t\t\twrapper.off(scrollEvent, render);\n\t\t\t\t\t\tresize();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbottomMarkerShow(place);\n\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// select dragged file if no selected, disable selectable\n\t\t\t\t.dragstart(function(e) {\n\t\t\t\t\tvar target = $(e.data.target),\n\t\t\t\t\t\toe     = e.data.originalEvent;\n\n\t\t\t\t\tif (target.hasClass(clFile)) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!target.hasClass(clSelected)) {\n\t\t\t\t\t\t\t!(oe.ctrlKey || oe.metaKey || oe.shiftKey) && unselectAll({ notrigger: true });\n\t\t\t\t\t\t\ttarget.trigger(evtSelect);\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcwd.removeClass(clDisabled).data('selectable') && cwd.selectable('disable');\n\t\t\t\t\tselectLock = true;\n\t\t\t\t})\n\t\t\t\t// enable selectable\n\t\t\t\t.dragstop(function() {\n\t\t\t\t\tcwd.data('selectable') && cwd.selectable('enable');\n\t\t\t\t\tselectLock = false;\n\t\t\t\t})\n\t\t\t\t.bind('lockfiles unlockfiles selectfiles unselectfiles', function(e) {\n\t\t\t\t\tvar events = {\n\t\t\t\t\t\t\tlockfiles     : evtDisable ,\n\t\t\t\t\t\t\tunlockfiles   : evtEnable ,\n\t\t\t\t\t\t\tselectfiles   : evtSelect,\n\t\t\t\t\t\t\tunselectfiles : evtUnselect },\n\t\t\t\t\t\tevent  = events[e.type],\n\t\t\t\t\t\tfiles  = e.data.files || [],\n\t\t\t\t\t\tl      = files.length,\n\t\t\t\t\t\thelper = e.data.helper || $(),\n\t\t\t\t\t\tparents, ctr, add;\n\n\t\t\t\t\tif (l > 0) {\n\t\t\t\t\t\tparents = fm.parents(files[0]);\n\t\t\t\t\t}\n\t\t\t\t\tif (event === evtSelect || event === evtUnselect) {\n\t\t\t\t\t\tadd  = (event === evtSelect),\n\t\t\t\t\t\t$.each(files, function(i, hash) {\n\t\t\t\t\t\t\tvar all = cwd.hasClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\tif (! selectedFiles[hash]) {\n\t\t\t\t\t\t\t\tadd && (selectedFiles[hash] = true);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (all) {\n\t\t\t\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.children('input').prop('checked', false);\n\t\t\t\t\t\t\t\t\tcwd.removeClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\t\t\tall = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t! add && delete selectedFiles[hash];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (!helper.data('locked')) {\n\t\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tfm.cwdHash2Elm(files[l]).trigger(event);\n\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t! e.data.inselect && trigger();\n\t\t\t\t\t}\n\t\t\t\t\tif (wrapper.data('dropover') && parents.indexOf(wrapper.data('dropover')) !== -1) {\n\t\t\t\t\t\tctr = e.type !== 'lockfiles';\n\t\t\t\t\t\thelper.toggleClass('elfinder-drag-helper-plus', ctr);\n\t\t\t\t\t\twrapper.toggleClass(clDropActive, ctr);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// select new files after some actions\n\t\t\t\t.bind('mkdir mkfile duplicate upload rename archive extract paste multiupload', function(e) {\n\t\t\t\t\tif (e.type == 'upload' && e.data._multiupload) return;\n\t\t\t\t\tvar phash = fm.cwd().hash, files;\n\t\t\t\t\t\n\t\t\t\t\tunselectAll({ notrigger: true });\n\n\t\t\t\t\t$.each((e.data.added || []).concat(e.data.changed || []), function(i, file) { \n\t\t\t\t\t\tfile && file.phash == phash && selectFile(file.hash);\n\t\t\t\t\t});\n\t\t\t\t\ttrigger();\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     :'ctrl+a', \n\t\t\t\t\tdescription : 'selectall',\n\t\t\t\t\tcallback    : selectAll\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     :'ctrl+shift+i', \n\t\t\t\t\tdescription : 'selectinvert',\n\t\t\t\t\tcallback    : selectInvert\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'left right up down shift+left shift+right shift+up shift+down',\n\t\t\t\t\tdescription : 'selectfiles',\n\t\t\t\t\ttype        : 'keydown' , //fm.UA.Firefox || fm.UA.Opera ? 'keypress' : 'keydown',\n\t\t\t\t\tcallback    : function(e) { select(e.keyCode, e.shiftKey); }\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'home',\n\t\t\t\t\tdescription : 'selectffile',\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tscrollToView(cwd.find('[id]:first').trigger(evtSelect));\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'end',\n\t\t\t\t\tdescription : 'selectlfile',\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tscrollToView(cwd.find('[id]:last').trigger(evtSelect)) ;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'page_up',\n\t\t\t\t\tdescription : 'pageTurning',\n\t\t\t\t\tcallback    : function(e) {\n\t\t\t\t\t\tif (bufferExt.itemH) {\n\t\t\t\t\t\t\twrapper.scrollTop(\n\t\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\t\twrapper.scrollTop()\n\t\t\t\t\t\t\t\t\t- (Math.floor((wrapper.height() + (list? bufferExt.itemH * -1 : 16)) / bufferExt.itemH)) * bufferExt.itemH\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).shortcut({\n\t\t\t\t\tpattern     : 'page_down',\n\t\t\t\t\tdescription : 'pageTurning',\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tif (bufferExt.itemH) {\n\t\t\t\t\t\t\twrapper.scrollTop(\n\t\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\t\twrapper.scrollTop()\n\t\t\t\t\t\t\t\t\t+ (Math.floor((wrapper.height() + (list? bufferExt.itemH * -1 : 16)) / bufferExt.itemH)) * bufferExt.itemH\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t});\n\t\t\n\t\t// fm.timeEnd('cwdLoad')\n\t\t\n\t\treturn this;\n\t};\n\n});"]}