{"version":3,"sources":["ui/navdock.js"],"names":["define","$","fn","elfindernavdock","fm","opts","this","not","each","basicHeight","hasNode","self","hide","addClass","resize","parent","children","append","to","h","ovf","diff","height","len","Object","keys","sizeSyncs","length","calc","css","id","n","trigger","namespace","handle","appendTo","initMaxHeight","parseInt","maxHeight","data","cNode","tH","mH","wzH","getUI","imaxH","assign","first","sizeSync","init","attr","Date","outerHeight","after","resizable","show","storage","Math","min","nodeId","detach","remove","disabled","one","handles","start","e","ui","event","inNavdockResize","stop","size","originalSize","bind","maxH","is","abs","oldH","round","requestAnimationFrame","curH","type"],"mappings":"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","file":"../../ui/navdock.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elfindernavdock - elFinder container for preview etc at below the navbar\n\t *\n\t * @author Naoki Sawada\n\t **/\n\t$.fn.elfindernavdock = function(fm, opts) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-navdock').each(function() {\n\t\t\tvar self = $(this).hide().addClass('ui-state-default elfinder-navdock touch-punch'),\n\t\t\t\tnode = self.parent(),\n\t\t\t\twz   = node.children('.elfinder-workzone').append(self),\n\t\t\t\tresize = function(to, h) {\n\t\t\t\t\tvar curH = h || self.height(),\n\t\t\t\t\t\tdiff = to - curH,\n\t\t\t\t\t\tlen  = Object.keys(sizeSyncs).length,\n\t\t\t\t\t\tcalc = len? diff / len : 0,\n\t\t\t\t\t\tovf;\n\t\t\t\t\tif (diff) {\n\t\t\t\t\t\tovf = self.css('overflow');\n\t\t\t\t\t\tself.css('overflow', 'hidden');\n\t\t\t\t\t\tself.height(to);\n\t\t\t\t\t\t$.each(sizeSyncs, function(id, n) {\n\t\t\t\t\t\t\tn.height(n.height() + calc).trigger('resize.' + fm.namespace);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\t\tself.css('overflow', ovf);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandle = $('<div class=\"ui-front ui-resizable-handle ui-resizable-n\"/>').appendTo(self),\n\t\t\t\tsizeSyncs = {},\n\t\t\t\tresizeFn = [],\n\t\t\t\tinitMaxHeight = (parseInt(opts.initMaxHeight) || 50) / 100,\n\t\t\t\tmaxHeight = (parseInt(opts.maxHeight) || 90) / 100,\n\t\t\t\tbasicHeight, hasNode;\n\t\t\t\n\t\t\t\n\t\t\tself.data('addNode', function(cNode, opts) {\n\t\t\t\tvar wzH = fm.getUI('workzone').height(),\n\t\t\t\t\timaxH = wzH * initMaxHeight,\n\t\t\t\t\tcurH, tH, mH;\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tfirst: false,\n\t\t\t\t\tsizeSync: true,\n\t\t\t\t\tinit: false\n\t\t\t\t}, opts);\n\t\t\t\tif (!cNode.attr('id')) {\n\t\t\t\t\tcNode.attr('id', fm.namespace+'-navdock-' + (+new Date()));\n\t\t\t\t}\n\t\t\t\topts.sizeSync && (sizeSyncs[cNode.attr('id')] = cNode);\n\t\t\t\tcurH = self.height();\n\t\t\t\ttH = curH + cNode.outerHeight(true);\n\t\t\t\t\n\t\t\t\tif (opts.first) {\n\t\t\t\t\thandle.after(cNode);\n\t\t\t\t} else {\n\t\t\t\t\tself.append(cNode);\n\t\t\t\t}\n\t\t\t\thasNode = true;\n\t\t\t\tself.resizable('enable').height(tH).show();\n\t\t\t\t\n\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\n\t\t\t\tif (opts.init) {\n\t\t\t\t\tmH = fm.storage('navdockHeight');\n\t\t\t\t\tif (mH) {\n\t\t\t\t\t\ttH = mH;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttH = tH > imaxH? imaxH : tH;\n\t\t\t\t\t}\n\t\t\t\t\tbasicHeight = tH;\n\t\t\t\t}\n\t\t\t\tresize(Math.min(tH, wzH * maxHeight));\n\t\t\t\t\n\t\t\t\treturn self;\n\t\t\t}).data('removeNode', function(nodeId, appendTo) {\n\t\t\t\tvar cNode = $('#'+nodeId);\n\t\t\t\tdelete sizeSyncs[nodeId];\n\t\t\t\tself.height(self.height() - $('#'+nodeId).outerHeight(true));\n\t\t\t\tif (appendTo) {\n\t\t\t\t\tif (appendTo === 'detach') {\n\t\t\t\t\t\tcNode = cNode.detach();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tappendTo.append(cNode);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcNode.remove();\n\t\t\t\t}\n\t\t\t\tif (self.children().length <= 1) {\n\t\t\t\t\thasNode = false;\n\t\t\t\t\tself.resizable('disable').height(0).hide();\n\t\t\t\t}\n\t\t\t\tfm.trigger('wzresize');\n\t\t\t\treturn cNode;\n\t\t\t});\n\t\t\t\n\t\t\tif (! opts.disabled) {\n\t\t\t\tfm.one('init', function() {\n\t\t\t\t\tvar ovf;\n\t\t\t\t\tif (fm.getUI('navbar').children().not('.ui-resizable-handle').length) {\n\t\t\t\t\t\tself.data('dockEnabled', true);\n\t\t\t\t\t\tself.resizable({\n\t\t\t\t\t\t\tmaxHeight: fm.getUI('workzone').height() * maxHeight,\n\t\t\t\t\t\t\thandles: { n: handle },\n\t\t\t\t\t\t\tstart: function(e, ui) {\n\t\t\t\t\t\t\t\tovf = self.css('overflow');\n\t\t\t\t\t\t\t\tself.css('overflow', 'hidden');\n\t\t\t\t\t\t\t\tfm.trigger('navdockresizestart', {event: e, ui: ui}, true);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresize: function(e, ui) {\n\t\t\t\t\t\t\t\tself.css('top', '');\n\t\t\t\t\t\t\t\tfm.trigger('wzresize', { inNavdockResize : true });\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstop: function(e, ui) {\n\t\t\t\t\t\t\t\tfm.trigger('navdockresizestop', {event: e, ui: ui}, true);\n\t\t\t\t\t\t\t\tself.css('top', '');\n\t\t\t\t\t\t\t\tbasicHeight = ui.size.height;\n\t\t\t\t\t\t\t\tfm.storage('navdockHeight', basicHeight);\n\t\t\t\t\t\t\t\tresize(basicHeight, ui.originalSize.height);\n\t\t\t\t\t\t\t\tself.css('overflow', ovf);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.bind('wzresize', function(e) {\n\t\t\t\t\t\t\tvar minH, maxH, h;\n\t\t\t\t\t\t\tif (self.is(':visible')) {\n\t\t\t\t\t\t\t\tmaxH = fm.getUI('workzone').height() * maxHeight;\n\t\t\t\t\t\t\t\tif (! e.data || ! e.data.inNavdockResize) {\n\t\t\t\t\t\t\t\t\th = self.height();\n\t\t\t\t\t\t\t\t\tif (maxH < basicHeight) {\n\t\t\t\t\t\t\t\t\t\tif (Math.abs(h - maxH) > 1) {\n\t\t\t\t\t\t\t\t\t\t\tresize(maxH);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (Math.abs(h - basicHeight) > 1) {\n\t\t\t\t\t\t\t\t\t\t\tresize(basicHeight);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tself.resizable('option', 'maxHeight', maxH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).bind('themechange', function() {\n\t\t\t\t\t\t\tvar oldH = Math.round(self.height());\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tvar curH = Math.round(self.height()),\n\t\t\t\t\t\t\t\t\tdiff = oldH - curH;\n\t\t\t\t\t\t\t\tif (diff !== 0) {\n\t\t\t\t\t\t\t\t\tresize(self.height(),  curH - diff);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tfm.bind('navbarshow navbarhide', function(e) {\n\t\t\t\t\t\tself[hasNode && e.type === 'navbarshow'? 'show' : 'hide']();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t};\n\n});"]}