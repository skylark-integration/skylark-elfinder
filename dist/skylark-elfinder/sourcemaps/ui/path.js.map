{"version":3,"sources":["ui/path.js"],"names":["define","$","fn","elfinderpath","fm","options","this","each","hasUiTree","hasUiStat","query","target","mimes","place","clHover","res","prefix","elFinder","prototype","uniqueid","wzbase","path","addClass","html","on","e","hash","attr","substr","length","preventDefault","cwd","exec","mime","join","trigger","selected","prependTo","getUI","show","roots","stopPropagation","map","h","file","raw","i","f","phash","root","push","label","escape","i18","name","icon","callback","iconClass","csscls","iconImg","x","pageX","y","pageY","append","appendTo","render","dirs","names","parents","c","option","toWorkzone","prev","children","direction","prevAll","scrollLeft","position","left","fit","UA","CSS","flex","m","ids","cnt","width","css","maxWidth","display","w","scrollWidth","k","d","last","one","toWorkzoneWithoutNavbar","insertBefore","bind","Object","keys","hide","data","i18n","wz","type","unbind","detach"],"mappings":";;;;;;;AAAAA,QACC,kBACC,SAASC,GAQVA,EAAEC,GAAGC,aAAe,SAASC,EAAIC,GAChC,aACA,OAAOC,KAAKC,KAAK,WAChB,IA0GCC,EAAWC,EA1GRC,EAAS,GACZC,EAAS,GACTC,KACAC,EAAS,YACTC,EAASV,EAAGW,IAAI,QAAS,SACzBC,EAAS,QAAUC,SAASC,UAAUC,SAAUF,SAASC,UAAUC,SAAW,IAAM,IACpFC,EAASnB,EAAE,6EACXoB,EAASpB,EAAEK,MAAMgB,SAAS,iBAAiBC,KAAK,UAC9CC,GAAG,YAAa,yBAA0B,SAASC,GACnD,IAAIC,EAAOzB,EAAEK,MAAMqB,KAAK,MAAMC,OAAOZ,EAAOa,QAC5CJ,EAAEK,iBACEJ,GAAQtB,EAAG2B,MAAML,OACpBzB,EAAEK,MAAMgB,SAASR,GACbJ,EACHN,EAAG4B,KAAK,SAAUtB,GAASC,OAAQe,EAAMO,KAAMrB,EAAMsB,KAAK,OAE1D9B,EAAG+B,QAAQ,UAAWC,UAAYV,KAAQM,KAAK,OAAQN,MAIzDW,UAAUjC,EAAGkC,MAAM,aAAaC,QAClCC,EAAQvC,EAAE,sCAAsCuB,GAAG,QAAS,SAASC,GACpEA,EAAEgB,kBACFhB,EAAEK,iBAEF,IAAIU,EAAQvC,EAAEyC,IAAItC,EAAGoC,MAAO,SAASG,GAAK,OAAOvC,EAAGwC,KAAKD,KACzDE,KAEA5C,EAAEM,KAAKiC,EAAO,SAASM,EAAGC,GACnBA,EAAEC,OAAS5C,EAAG6C,KAAK7C,EAAG2B,MAAML,MAAM,KAAUqB,EAAErB,MACnDmB,EAAIK,MACHC,MAAW/C,EAAGgD,OAAOL,EAAEM,KAAON,EAAEO,MAChCC,KAAW,OACXC,SAAW,WAAapD,EAAG4B,KAAK,OAAQe,EAAErB,OAC1CrB,SACCoD,UAAYV,EAAEW,QAAU,GACxBC,QAAYZ,EAAEQ,MAAU,QAK5BnD,EAAG+B,QAAQ,eACVU,IAAKA,EACLe,EAAGnC,EAAEoC,MACLC,EAAGrC,EAAEsC,UAEJC,OAAO,mEAAmEC,SAAS7C,GACtF8C,EAAS,SAASnC,GACjB,IAAIoC,KACHC,KAQD,OAPAnE,EAAEM,KAAKH,EAAGiE,QAAQtC,GAAM,SAASe,EAAGpB,GACnC,IAAI4C,EAAKvC,IAAQL,EAAO,sCAAwC,oBAC/DqB,EAAI3C,EAAGwC,KAAKlB,GACZ4B,EAAOlD,EAAGgD,OAAOL,EAAEM,KAAON,EAAEO,MAC7Bc,EAAMlB,KAAKI,GACXa,EAAKjB,KAAK,aAAalC,EAAOU,EAAK,YAAY4C,EAAE,YAAYF,EAAMlC,KAAK9B,EAAGmE,OAAO,cAAc,KAAKjB,EAAK,aAEpGa,EAAKjC,KAAK,qCAAqC9B,EAAGmE,OAAO,aAAa,YAE9EC,EAAa,WACZ,IAAIC,EACJpD,EAAKqD,SAAS,0BAA0B/C,KAAK,QAAS,IACtD8C,EAAwB,QAAjBrE,EAAGuE,UAAqB1E,EAAE,IAAIe,EAASZ,EAAG2B,MAAML,MAAMkD,QAAQ,gCAAkC3E,IACvGoB,EAAKwD,WAAWJ,EAAK5C,OAAQ4C,EAAKK,WAAWC,KAAO,IAErDC,EAAM,WACL,IAAI5E,EAAG6E,GAAGC,IAAIC,KAAd,CAGA,IAECC,EAAWC,EAFRlB,EAAO9C,EAAKqD,SAAS,0BACxBY,EAAOnB,EAAKtC,OAGC,aAAVhB,GAAwByE,EAAM,EACjCnB,EAAKxC,KAAK,QAAS,KAGpBN,EAAKkE,MAAMlE,EAAKmE,IAAI,cACpBrB,EAAKqB,KAAKC,SAAW,IAAIH,EAAK,IAAKI,QAAS,iBAC5CN,EAAI/D,EAAKkE,QAAU,EACnBlE,EAAKqD,SAAS,4BAA4BnE,KAAK,WAC9C6E,GAAKnF,EAAEK,MAAMiF,UAEdF,KACAlB,EAAK5D,KAAK,SAASuC,GAClB,IACC6C,EADS1F,EAAEK,MACDiF,QACXH,GAAKO,EACDA,EAAIrF,KAAKsF,aACZP,EAAInC,KAAKJ,KAGXzB,EAAKkE,MAAM,IACPF,EAAIxD,QACHuD,EAAI,IACPA,GAAQC,EAAIxD,OACZ5B,EAAEM,KAAK8E,EAAK,SAASvC,EAAG+C,GACvB,IAAIC,EAAI7F,EAAEkE,EAAK0B,IACfC,EAAEN,IAAI,YAAaM,EAAEP,QAAUH,MAGjCjB,EAAK4B,OAAOpE,KAAK,QAAS,KAE1BwC,EAAKxC,KAAK,QAAS,OAKtBvB,EAAG4F,IAAI,OAAQ,WACdxF,EAAYJ,EAAGkC,MAAM,QAAQT,OAC7BpB,EAAYL,EAAGkC,MAAM,QAAQT,QACvBrB,GAAaH,EAAQ4F,0BAC1B7E,EAAO4C,OAAO3C,GAAM6E,aAAa9F,EAAGkC,MAAM,aAC1CzB,EAAQ,WACRT,EAAG+F,KAAK,OAAQ3B,GACfwB,IAAI,WAAY,WAChB5F,EAAGkC,QAAQH,QAAQ,eAIrBgE,KAAK,yBAA0B,WAG/BzF,EAAS,GACTC,EAAS,GACTC,KAEAS,EAAKE,KAAK2C,EAAO9D,EAAG2B,MAAML,OACtB0E,OAAOC,KAAKjG,EAAGoC,OAAOX,OAAS,GAClCR,EAAKmE,IAAI,SAAU,IACnBhD,EAAMD,SAENlB,EAAKmE,IAAI,SAAU,GACnBhD,EAAM8D,SAEN7F,GAAauE,MAEdmB,KAAK,cAAe,SAAS1E,GACzBA,EAAE8E,OACL7F,EAASe,EAAE8E,KAAK7F,OAAS,GACzBC,EAASc,EAAE8E,KAAK5F,QAAU,GAC1BC,EAASa,EAAE8E,KAAK3F,aAGjBuF,KAAK,SAAU,SAAS1E,GACxB,IACCF,EAAO,GAEPA,EADGZ,EACIuD,EAAOvD,GAEPP,EAAGoG,KAAK,UAEhBnF,EAAKE,KAAK,qCAAqCnB,EAAGoG,KAAK,eAAiB,YAAcjF,GACtFyD,MAGAmB,KAAK,wBAAyB,WAC9B,IAAIM,EAAKrG,EAAGkC,MAAM,YACA,eAAdhC,KAAKoG,MACRtG,EAAGuG,OAAO,OAAQnC,GAClBnD,EAAKgB,UAAUjC,EAAGkC,MAAM,cACxBlB,EAAOwF,SACP/F,EAAQ,cAERO,EAAO4C,OAAO3C,GAAM6E,aAAaO,GACjC5F,EAAQ,WACR2D,IACApE,EAAG+F,KAAK,OAAQ3B,IAEjBpE,EAAG+B,QAAQ,cAEXgE,KAAK,sBAAuBnB","file":"../../ui/path.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elFinder ui\n\t * Display current folder path in statusbar.\n\t * Click on folder name in path - open folder\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderpath = function(fm, options) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar query  = '',\n\t\t\t\ttarget = '',\n\t\t\t\tmimes  = [],\n\t\t\t\tplace  = 'statusbar',\n\t\t\t\tclHover= fm.res('class', 'hover'),\n\t\t\t\tprefix = 'path' + (elFinder.prototype.uniqueid? elFinder.prototype.uniqueid : '') + '-',\n\t\t\t\twzbase = $('<div class=\"ui-widget-header ui-helper-clearfix elfinder-workzone-path\"/>'),\n\t\t\t\tpath   = $(this).addClass('elfinder-path').html('&nbsp;')\n\t\t\t\t\t.on('mousedown', 'span.elfinder-path-dir', function(e) {\n\t\t\t\t\t\tvar hash = $(this).attr('id').substr(prefix.length);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif (hash != fm.cwd().hash) {\n\t\t\t\t\t\t\t$(this).addClass(clHover);\n\t\t\t\t\t\t\tif (query) {\n\t\t\t\t\t\t\t\tfm.exec('search', query, { target: hash, mime: mimes.join(' ') });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.trigger('select', {selected : [hash]}).exec('open', hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.prependTo(fm.getUI('statusbar').show()),\n\t\t\t\troots = $('<div class=\"elfinder-path-roots\"/>').on('click', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\n\t\t\t\t\tvar roots = $.map(fm.roots, function(h) { return fm.file(h); }),\n\t\t\t\t\traw = [];\n\n\t\t\t\t\t$.each(roots, function(i, f) {\n\t\t\t\t\t\tif (! f.phash && fm.root(fm.cwd().hash, true) !== f.hash) {\n\t\t\t\t\t\t\traw.push({\n\t\t\t\t\t\t\t\tlabel    : fm.escape(f.i18 || f.name),\n\t\t\t\t\t\t\t\ticon     : 'home',\n\t\t\t\t\t\t\t\tcallback : function() { fm.exec('open', f.hash); },\n\t\t\t\t\t\t\t\toptions  : {\n\t\t\t\t\t\t\t\t\ticonClass : f.csscls || '',\n\t\t\t\t\t\t\t\t\ticonImg   : f.icon   || ''\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\traw: raw,\n\t\t\t\t\t\tx: e.pageX,\n\t\t\t\t\t\ty: e.pageY\n\t\t\t\t\t});\n\t\t\t\t}).append('<span class=\"elfinder-button-icon elfinder-button-icon-menu\" />').appendTo(wzbase),\n\t\t\t\trender = function(cwd) {\n\t\t\t\t\tvar dirs = [],\n\t\t\t\t\t\tnames = [];\n\t\t\t\t\t$.each(fm.parents(cwd), function(i, hash) {\n\t\t\t\t\t\tvar c = (cwd === hash)? 'elfinder-path-dir elfinder-path-cwd' : 'elfinder-path-dir',\n\t\t\t\t\t\t\tf = fm.file(hash),\n\t\t\t\t\t\t\tname = fm.escape(f.i18 || f.name);\n\t\t\t\t\t\tnames.push(name);\n\t\t\t\t\t\tdirs.push('<span id=\"'+prefix+hash+'\" class=\"'+c+'\" title=\"'+names.join(fm.option('separator'))+'\">'+name+'</span>');\n\t\t\t\t\t});\n\t\t\t\t\treturn dirs.join('<span class=\"elfinder-path-other\">'+fm.option('separator')+'</span>');\n\t\t\t\t},\n\t\t\t\ttoWorkzone = function() {\n\t\t\t\t\tvar prev;\n\t\t\t\t\tpath.children('span.elfinder-path-dir').attr('style', '');\n\t\t\t\t\tprev = fm.direction === 'ltr'? $('#'+prefix + fm.cwd().hash).prevAll('span.elfinder-path-dir:first') : $();\n\t\t\t\t\tpath.scrollLeft(prev.length? prev.position().left : 0);\n\t\t\t\t},\n\t\t\t\tfit = function() {\n\t\t\t\t\tif (fm.UA.CSS.flex) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar dirs = path.children('span.elfinder-path-dir'),\n\t\t\t\t\t\tcnt  = dirs.length,\n\t\t\t\t\t\tm, bg = 0, ids;\n\t\t\t\t\t\n\t\t\t\t\tif (place === 'workzone' || cnt < 2) {\n\t\t\t\t\t\tdirs.attr('style', '');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tpath.width(path.css('max-width'));\n\t\t\t\t\tdirs.css({maxWidth: (100/cnt)+'%', display: 'inline-block'});\n\t\t\t\t\tm = path.width() - 9;\n\t\t\t\t\tpath.children('span.elfinder-path-other').each(function() {\n\t\t\t\t\t\tm -= $(this).width();\n\t\t\t\t\t});\n\t\t\t\t\tids = [];\n\t\t\t\t\tdirs.each(function(i) {\n\t\t\t\t\t\tvar dir = $(this),\n\t\t\t\t\t\t\tw   = dir.width();\n\t\t\t\t\t\tm -= w;\n\t\t\t\t\t\tif (w < this.scrollWidth) {\n\t\t\t\t\t\t\tids.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tpath.width('');\n\t\t\t\t\tif (ids.length) {\n\t\t\t\t\t\tif (m > 0) {\n\t\t\t\t\t\t\tm = m / ids.length;\n\t\t\t\t\t\t\t$.each(ids, function(i, k) {\n\t\t\t\t\t\t\t\tvar d = $(dirs[k]);\n\t\t\t\t\t\t\t\td.css('max-width', d.width() + m);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdirs.last().attr('style', '');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdirs.attr('style', '');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thasUiTree, hasUiStat;\n\n\t\t\tfm.one('init', function() {\n\t\t\t\thasUiTree = fm.getUI('tree').length;\n\t\t\t\thasUiStat = fm.getUI('stat').length;\n\t\t\t\tif (! hasUiTree && options.toWorkzoneWithoutNavbar) {\n\t\t\t\t\twzbase.append(path).insertBefore(fm.getUI('workzone'));\n\t\t\t\t\tplace = 'workzone';\n\t\t\t\t\tfm.bind('open', toWorkzone)\n\t\t\t\t\t.one('opendone', function() {\n\t\t\t\t\t\tfm.getUI().trigger('resize');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('open searchend parents', function() {\n\t\t\t\tvar dirs = [];\n\n\t\t\t\tquery  = '';\n\t\t\t\ttarget = '';\n\t\t\t\tmimes  = [];\n\t\t\t\t\n\t\t\t\tpath.html(render(fm.cwd().hash));\n\t\t\t\tif (Object.keys(fm.roots).length > 1) {\n\t\t\t\t\tpath.css('margin', '');\n\t\t\t\t\troots.show();\n\t\t\t\t} else {\n\t\t\t\t\tpath.css('margin', 0);\n\t\t\t\t\troots.hide();\n\t\t\t\t}\n\t\t\t\t!hasUiStat && fit();\n\t\t\t})\n\t\t\t.bind('searchstart', function(e) {\n\t\t\t\tif (e.data) {\n\t\t\t\t\tquery  = e.data.query || '';\n\t\t\t\t\ttarget = e.data.target || '';\n\t\t\t\t\tmimes  = e.data.mimes || [];\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('search', function(e) {\n\t\t\t\tvar dirs = [],\n\t\t\t\t\thtml = '';\n\t\t\t\tif (target) {\n\t\t\t\t\thtml = render(target);\n\t\t\t\t} else {\n\t\t\t\t\thtml = fm.i18n('btnAll');\n\t\t\t\t}\n\t\t\t\tpath.html('<span class=\"elfinder-path-other\">'+fm.i18n('searcresult') + ': </span>' + html);\n\t\t\t\tfit();\n\t\t\t})\n\t\t\t// on swipe to navbar show/hide\n\t\t\t.bind('navbarshow navbarhide', function() {\n\t\t\t\tvar wz = fm.getUI('workzone');\n\t\t\t\tif (this.type === 'navbarshow') {\n\t\t\t\t\tfm.unbind('open', toWorkzone);\n\t\t\t\t\tpath.prependTo(fm.getUI('statusbar'));\n\t\t\t\t\twzbase.detach();\n\t\t\t\t\tplace = 'statusbar';\n\t\t\t\t} else {\n\t\t\t\t\twzbase.append(path).insertBefore(wz);\n\t\t\t\t\tplace = 'workzone';\n\t\t\t\t\ttoWorkzone();\n\t\t\t\t\tfm.bind('open', toWorkzone);\n\t\t\t\t}\n\t\t\t\tfm.trigger('uiresize');\n\t\t\t})\n\t\t\t.bind('resize uistatchange', fit);\n\t\t});\n\t};\n\n});\n"]}