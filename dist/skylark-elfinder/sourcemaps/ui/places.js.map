{"version":3,"sources":["ui/places.js"],"names":["define","$","fn","elfinderplaces","fm","opts","this","each","dirs","c","navdir","res","collapsed","expanded","hover","clroot","dropover","tpl","ptpl","spinner","suffix","key","menuTimer","id2hash","id","substr","hash2id","hash","hash2elm","document","getElementById","save","hashes","data","map","subtree","children","find","n","length","reverse","i","h","storage","init","dat","grep","split","d","dir","isPlainObject","trigger","storageKey","Object","keys","root","prepend","request","cmd","targets","preventDefault","done","exists","files","cache","f","add","assign","notfound","always","remove","create","replace","escape","i18","name","perms2class","csscls","read","write","path","icon","getIconStyle","node","mime","hasOwnProperty","tree","addClass","sortBtn","toggle","tgt","cnt","text","parent","removeClass","places","slideToggle","update","preHash","replaceWith","i18n","hide","on","e","stopPropagation","empty","file","ret","current","localeCompare","insertBefore","append","wrapper","namespace","hasClass","toggleClass","appendTo","getUI","type","p","exec","attr","self","raw","label","remain","callback","prev","cls","ctm","clearTimeout","setTimeout","moveup","x","pageX","y","pageY","bind","droppable","tolerance","accept","hoverClass","classes","ui-droppable-hover","over","ui","helper","insideWorkzone","out","Math","max","removeData","drop","resolve","originalEvent","touches","sortable","revert","target","direction","show","clone","stop","item","top","offset","left","width","height","added","one","oldAPI","change","changed","removed","names","push","inArray","ev","opSuffix","updated","cwd","updateCache","Boolean","phash"],"mappings":"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","file":"../../ui/places.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elFinder places/favorites ui\n\t *\n\t * @author Dmitry (dio) Levashov\n\t * @author Naoki Sawada\n\t **/\n\t$.fn.elfinderplaces = function(fm, opts) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar dirs      = {},\n\t\t\t\tc         = 'class',\n\t\t\t\tnavdir    = fm.res(c, 'navdir'),\n\t\t\t\tcollapsed = fm.res(c, 'navcollapse'),\n\t\t\t\texpanded  = fm.res(c, 'navexpand'),\n\t\t\t\thover     = fm.res(c, 'hover'),\n\t\t\t\tclroot    = fm.res(c, 'treeroot'),\n\t\t\t\tdropover  = fm.res(c, 'adroppable'),\n\t\t\t\ttpl       = fm.res('tpl', 'placedir'),\n\t\t\t\tptpl      = fm.res('tpl', 'perms'),\n\t\t\t\tspinner   = $(fm.res('tpl', 'navspinner')),\n\t\t\t\tsuffix    = opts.suffix? opts.suffix : '',\n\t\t\t\tkey       = 'places' + suffix,\n\t\t\t\tmenuTimer = null,\n\t\t\t\t/**\n\t\t\t\t * Convert places dir node into dir hash\n\t\t\t\t *\n\t\t\t\t * @param  String  directory id\n\t\t\t\t * @return String\n\t\t\t\t **/\n\t\t\t\tid2hash   = function(id) { return id.substr(6);\t},\n\t\t\t\t/**\n\t\t\t\t * Convert places dir hash into dir node id\n\t\t\t\t *\n\t\t\t\t * @param  String  directory id\n\t\t\t\t * @return String\n\t\t\t\t **/\n\t\t\t\thash2id   = function(hash) { return 'place-'+hash; },\n\n\t\t\t\t/**\n\t\t\t\t * Convert places dir hash into dir node elment (jQuery object)\n\t\t\t\t *\n\t\t\t\t * @param  String  directory id\n\t\t\t\t * @return Object\n\t\t\t\t **/\n\t\t\t\thash2elm  = function(hash) { return $(document.getElementById(hash2id(hash))); },\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Save current places state\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tsave      = function() {\n\t\t\t\t\tvar hashes = [], data = {};\n\t\t\t\t\t\n\t\t\t\t\thashes = $.map(subtree.children().find('[id]'), function(n) {\n\t\t\t\t\t\treturn id2hash(n.id);\n\t\t\t\t\t});\n\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\t$.each(hashes.reverse(), function(i, h) {\n\t\t\t\t\t\t\tdata[h] = dirs[h];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfm.storage(key, data);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Init dir at places\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tinit = function() {\n\t\t\t\t\tvar dat, hashes;\n\t\t\t\t\tkey = 'places'+(opts.suffix? opts.suffix : ''),\n\t\t\t\t\tdirs = {};\n\t\t\t\t\tdat = fm.storage(key);\n\t\t\t\t\tif (typeof dat === 'string') {\n\t\t\t\t\t\t// old data type elFinder <= 2.1.12\n\t\t\t\t\t\tdat = $.grep(dat.split(','), function(hash) { return hash? true : false;});\n\t\t\t\t\t\t$.each(dat, function(i, d) {\n\t\t\t\t\t\t\tvar dir = d.split('#');\n\t\t\t\t\t\t\tdirs[dir[0]] = dir[1]? dir[1] : dir[0];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if ($.isPlainObject(dat)) {\n\t\t\t\t\t\tdirs = dat;\n\t\t\t\t\t}\n\t\t\t\t\t// allow modify `dirs`\n\t\t\t\t\t/**\n\t\t\t\t\t * example for preset places\n\t\t\t\t\t * \n\t\t\t\t\t * elfinderInstance.bind('placesload', function(e, fm) {\n\t\t\t\t\t * \t//if (fm.storage(e.data.storageKey) === null) { // for first time only\n\t\t\t\t\t * \tif (!fm.storage(e.data.storageKey)) {           // for empty places\n\t\t\t\t\t * \t\te.data.dirs[targetHash] = fallbackName;     // preset folder\n\t\t\t\t\t * \t}\n\t\t\t\t\t * }\n\t\t\t\t\t **/\n\t\t\t\t\tfm.trigger('placesload', {dirs: dirs, storageKey: key}, true);\n\t\t\t\t\t\n\t\t\t\t\thashes = Object.keys(dirs);\n\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\troot.prepend(spinner);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'info', targets : hashes},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar exists = {};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdata.files && data.files.length && fm.cache(data.files);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$.each(data.files, function(i, f) {\n\t\t\t\t\t\t\t\tvar hash = f.hash;\n\t\t\t\t\t\t\t\texists[hash] = f;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.each(dirs, function(h, f) {\n\t\t\t\t\t\t\t\tadd(exists[h] || Object.assign({notfound: true}, f));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (fm.storage('placesState') > 0) {\n\t\t\t\t\t\t\t\troot.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Return node for given dir object\n\t\t\t\t *\n\t\t\t\t * @param  Object  directory object\n\t\t\t\t * @return jQuery\n\t\t\t\t **/\n\t\t\t\tcreate    = function(dir, hash) {\n\t\t\t\t\treturn $(tpl.replace(/\\{id\\}/, hash2id(dir? dir.hash : hash))\n\t\t\t\t\t\t\t.replace(/\\{name\\}/, fm.escape(dir? dir.i18 || dir.name : hash))\n\t\t\t\t\t\t\t.replace(/\\{cssclass\\}/, dir? (fm.perms2class(dir) + (dir.notfound? ' elfinder-na' : '') + (dir.csscls? ' '+dir.csscls : '')) : '')\n\t\t\t\t\t\t\t.replace(/\\{permissions\\}/, (dir && (!dir.read || !dir.write || dir.notfound))? ptpl : '')\n\t\t\t\t\t\t\t.replace(/\\{title\\}/, dir? (' title=\"' + fm.escape(fm.path(dir.hash, true) || dir.i18 || dir.name) + '\"') : '')\n\t\t\t\t\t\t\t.replace(/\\{symlink\\}/, '')\n\t\t\t\t\t\t\t.replace(/\\{style\\}/, (dir && dir.icon)? fm.getIconStyle(dir) : ''));\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Add new node into places\n\t\t\t\t *\n\t\t\t\t * @param  Object  directory object\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tadd = function(dir) {\n\t\t\t\t\tvar node, hash;\n\n\t\t\t\t\tif (dir.mime !== 'directory') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\thash = dir.hash;\n\t\t\t\t\tif (!fm.files().hasOwnProperty(hash)) {\n\t\t\t\t\t\t// update cache\n\t\t\t\t\t\tfm.trigger('tree', {tree: [dir]});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tnode = create(dir, hash);\n\t\t\t\t\t\n\t\t\t\t\tdirs[hash] = dir;\n\t\t\t\t\tsubtree.prepend(node);\n\t\t\t\t\troot.addClass(collapsed);\n\t\t\t\t\tsortBtn.toggle(subtree.children().length > 1);\n\t\t\t\t\t\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Remove dir from places\n\t\t\t\t *\n\t\t\t\t * @param  String  directory hash\n\t\t\t\t * @return String  removed name\n\t\t\t\t **/\n\t\t\t\tremove = function(hash) {\n\t\t\t\t\tvar name = null, tgt, cnt;\n\n\t\t\t\t\tif (dirs[hash]) {\n\t\t\t\t\t\tdelete dirs[hash];\n\t\t\t\t\t\ttgt = hash2elm(hash);\n\t\t\t\t\t\tif (tgt.length) {\n\t\t\t\t\t\t\tname = tgt.text();\n\t\t\t\t\t\t\ttgt.parent().remove();\n\t\t\t\t\t\t\tcnt = subtree.children().length;\n\t\t\t\t\t\t\tsortBtn.toggle(cnt > 1);\n\t\t\t\t\t\t\tif (! cnt) {\n\t\t\t\t\t\t\t\troot.removeClass(collapsed);\n\t\t\t\t\t\t\t\tplaces.removeClass(expanded);\n\t\t\t\t\t\t\t\tsubtree.slideToggle(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn name;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Move up dir on places\n\t\t\t\t *\n\t\t\t\t * @param  String  directory hash\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tmoveup = function(hash) {\n\t\t\t\t\tvar self = hash2elm(hash),\n\t\t\t\t\t\ttgt  = self.parent(),\n\t\t\t\t\t\tprev = tgt.prev('div'),\n\t\t\t\t\t\tcls  = 'ui-state-hover',\n\t\t\t\t\t\tctm  = fm.getUI('contextmenu');\n\t\t\t\t\t\n\t\t\t\t\tmenuTimer && clearTimeout(menuTimer);\n\t\t\t\t\t\n\t\t\t\t\tif (prev.length) {\n\t\t\t\t\t\tctm.find(':first').data('placesHash', hash);\n\t\t\t\t\t\tself.addClass(cls);\n\t\t\t\t\t\ttgt.insertBefore(prev);\n\t\t\t\t\t\tprev = tgt.prev('div');\n\t\t\t\t\t\tmenuTimer = setTimeout(function() {\n\t\t\t\t\t\t\tself.removeClass(cls);\n\t\t\t\t\t\t\tif (ctm.find(':first').data('placesHash') === hash) {\n\t\t\t\t\t\t\t\tctm.hide().empty();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(!prev.length) {\n\t\t\t\t\t\tself.removeClass(cls);\n\t\t\t\t\t\tctm.hide().empty();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Update dir at places\n\t\t\t\t *\n\t\t\t\t * @param  Object   directory\n\t\t\t\t * @param  String   previous hash\n\t\t\t\t * @return Boolean\n\t\t\t\t **/\n\t\t\t\tupdate = function(dir, preHash) {\n\t\t\t\t\tvar hash = dir.hash,\n\t\t\t\t\t\ttgt  = hash2elm(preHash || hash),\n\t\t\t\t\t\tnode = create(dir, hash);\n\n\t\t\t\t\tif (tgt.length > 0) {\n\t\t\t\t\t\ttgt.parent().replaceWith(node);\n\t\t\t\t\t\tdirs[hash] = dir;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Remove all dir from places\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tclear = function() {\n\t\t\t\t\tsubtree.empty();\n\t\t\t\t\troot.removeClass(collapsed);\n\t\t\t\t\tplaces.removeClass(expanded);\n\t\t\t\t\tsubtree.slideToggle(false);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Sort places dirs A-Z\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tsort = function() {\n\t\t\t\t\t$.each(dirs, function(h, f) {\n\t\t\t\t\t\tvar dir = fm.file(h) || f,\n\t\t\t\t\t\t\tnode = create(dir, h),\n\t\t\t\t\t\t\tret = null;\n\t\t\t\t\t\tif (!dir) {\n\t\t\t\t\t\t\tnode.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (subtree.children().length) {\n\t\t\t\t\t\t\t$.each(subtree.children(), function() {\n\t\t\t\t\t\t\t\tvar current =  $(this);\n\t\t\t\t\t\t\t\tif ((dir.i18 || dir.name).localeCompare(current.children('.'+navdir).text()) < 0) {\n\t\t\t\t\t\t\t\t\tret = !node.insertBefore(current);\n\t\t\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (ret !== null) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t!hash2elm(h).length && subtree.append(node);\n\t\t\t\t\t});\n\t\t\t\t\tsave();\n\t\t\t\t},\n\t\t\t\t// sort button\n\t\t\t\tsortBtn = $('<span class=\"elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon\" title=\"'+fm.i18n('cmdsort')+'\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tsubtree.empty();\n\t\t\t\t\t\tsort();\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\t/**\n\t\t\t\t * Node - wrapper for places root\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\twrapper = create({\n\t\t\t\t\t\thash  : 'root-'+fm.namespace, \n\t\t\t\t\t\tname  : fm.i18n(opts.name, 'places'),\n\t\t\t\t\t\tread  : true,\n\t\t\t\t\t\twrite : true\n\t\t\t\t\t}),\n\t\t\t\t/**\n\t\t\t\t * Places root node\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\troot = wrapper.children('.'+navdir)\n\t\t\t\t\t.addClass(clroot)\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (root.hasClass(collapsed)) {\n\t\t\t\t\t\t\tplaces.toggleClass(expanded);\n\t\t\t\t\t\t\tsubtree.slideToggle();\n\t\t\t\t\t\t\tfm.storage('placesState', places.hasClass(expanded)? 1 : 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.append(sortBtn),\n\t\t\t\t/**\n\t\t\t\t * Container for dirs\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\tsubtree = wrapper.children('.'+fm.res(c, 'navsubtree')),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Main places container\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\tplaces = $(this).addClass(fm.res(c, 'tree')+' elfinder-places ui-corner-all')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.append(wrapper)\n\t\t\t\t\t.appendTo(fm.getUI('navbar'))\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+navdir, function(e) {\n\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', (e.type == 'mouseenter'));\n\t\t\t\t\t})\n\t\t\t\t\t.on('click', '.'+navdir, function(e) {\n\t\t\t\t\t\tvar p = $(this);\n\t\t\t\t\t\tif (p.data('longtap')) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t! p.hasClass('elfinder-na') && fm.exec('open', p.attr('id').substr(6));\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu', '.'+navdir+':not(.'+clroot+')', function(e) {\n\t\t\t\t\t\tvar self = $(this),\n\t\t\t\t\t\t\thash = self.attr('id').substr(6);\n\t\t\t\t\t\t\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw : [{\n\t\t\t\t\t\t\t\tlabel    : fm.i18n('moveUp'),\n\t\t\t\t\t\t\t\ticon     : 'up',\n\t\t\t\t\t\t\t\tremain   : true,\n\t\t\t\t\t\t\t\tcallback : function() { moveup(hash); save(); }\n\t\t\t\t\t\t\t},'|',{\n\t\t\t\t\t\t\t\tlabel    : fm.i18n('rmFromPlaces'),\n\t\t\t\t\t\t\t\ticon     : 'rm',\n\t\t\t\t\t\t\t\tcallback : function() { remove(hash); save(); }\n\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.getUI('contextmenu').children().on('mouseenter', function() {\n\t\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.bind('closecontextmenu', function() {\n\t\t\t\t\t\t\tself.removeClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.droppable({\n\t\t\t\t\t\ttolerance  : 'pointer',\n\t\t\t\t\t\taccept     : '.elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file',\n\t\t\t\t\t\thoverClass : fm.res('class', 'adroppable'),\n\t\t\t\t\t\tclasses    : { // Deprecated hoverClass jQueryUI>=1.12.0\n\t\t\t\t\t\t\t'ui-droppable-hover': fm.res('class', 'adroppable')\n\t\t\t\t\t\t},\n\t\t\t\t\t\tover       : function(e, ui) {\n\t\t\t\t\t\t\tvar helper = ui.helper,\n\t\t\t\t\t\t\t\tdir    = $.grep(helper.data('files'), function(h) { return (fm.file(h).mime === 'directory' && !dirs[h])? true : false; });\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\thelper.data('dropover', helper.data('dropover') + 1);\n\t\t\t\t\t\t\tif (fm.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\t\t\t\tif (dir.length > 0) {\n\t\t\t\t\t\t\t\t\thelper.addClass('elfinder-drag-helper-plus');\n\t\t\t\t\t\t\t\t\tfm.trigger('unlockfiles', {files : helper.data('files'), helper: helper});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$(this).removeClass(dropover);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tout : function(e, ui) {\n\t\t\t\t\t\t\tvar helper = ui.helper;\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus').data('dropover', Math.max(helper.data('dropover') - 1, 0));\n\t\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t\t       .removeClass(dropover);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdrop       : function(e, ui) {\n\t\t\t\t\t\t\tvar helper  = ui.helper,\n\t\t\t\t\t\t\t\tresolve = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$.each(helper.data('files'), function(i, hash) {\n\t\t\t\t\t\t\t\tvar dir = fm.file(hash);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (dir && dir.mime == 'directory' && !dirs[dir.hash]) {\n\t\t\t\t\t\t\t\t\tadd(dir);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t\tresolve && helper.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// for touch device\n\t\t\t\t\t.on('touchstart', '.'+navdir+':not(.'+clroot+')', function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar hash = $(this).attr('id').substr(6),\n\t\t\t\t\t\tp = $(this)\n\t\t\t\t\t\t.addClass(hover)\n\t\t\t\t\t\t.data('longtap', null)\n\t\t\t\t\t\t.data('tmlongtap', setTimeout(function(){\n\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\tp.data('longtap', true);\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\traw : [{\n\t\t\t\t\t\t\t\t\tlabel    : fm.i18n('rmFromPlaces'),\n\t\t\t\t\t\t\t\t\ticon     : 'rm',\n\t\t\t\t\t\t\t\t\tcallback : function() { remove(hash); save(); }\n\t\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\t\t'x'       : e.originalEvent.touches[0].pageX,\n\t\t\t\t\t\t\t\t'y'       : e.originalEvent.touches[0].pageY\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 500));\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchmove touchend', '.'+navdir+':not(.'+clroot+')', function(e) {\n\t\t\t\t\t\tclearTimeout($(this).data('tmlongtap'));\n\t\t\t\t\t\tif (e.type == 'touchmove') {\n\t\t\t\t\t\t\t$(this).removeClass(hover);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\tif ($.fn.sortable) {\n\t\t\t\tsubtree.addClass('touch-punch')\n\t\t\t\t.sortable({\n\t\t\t\t\tappendTo : fm.getUI(),\n\t\t\t\t\trevert   : false,\n\t\t\t\t\thelper   : function(e) {\n\t\t\t\t\t\tvar dir = $(e.target).parent();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tdir.children().removeClass('ui-state-hover');\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn $('<div class=\"ui-widget elfinder-place-drag elfinder-'+fm.direction+'\"/>')\n\t\t\t\t\t\t\t\t.append($('<div class=\"elfinder-navbar\"/>').show().append(dir.clone()));\n\n\t\t\t\t\t},\n\t\t\t\t\tstop     : function(e, ui) {\n\t\t\t\t\t\tvar target = $(ui.item[0]),\n\t\t\t\t\t\t\ttop    = places.offset().top,\n\t\t\t\t\t\t\tleft   = places.offset().left,\n\t\t\t\t\t\t\twidth  = places.width(),\n\t\t\t\t\t\t\theight = places.height(),\n\t\t\t\t\t\t\tx      = e.pageX,\n\t\t\t\t\t\t\ty      = e.pageY;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!(x > left && x < left+width && y > top && y < y+height)) {\n\t\t\t\t\t\t\tremove(id2hash(target.children(':first').attr('id')));\n\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tupdate   : function(e, ui) {\n\t\t\t\t\t\tsave();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// \"on regist\" for command exec\n\t\t\t$(this).on('regist', function(e, files){\n\t\t\t\tvar added = false;\n\t\t\t\t$.each(files, function(i, dir) {\n\t\t\t\t\tif (dir && dir.mime == 'directory' && !dirs[dir.hash]) {\n\t\t\t\t\t\tif (add(dir)) {\n\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tadded && save();\n\t\t\t});\n\t\t\n\n\t\t\t// on fm load - show places and load files from backend\n\t\t\tfm.one('load', function() {\n\t\t\t\tvar dat, hashes;\n\t\t\t\t\n\t\t\t\tif (fm.oldAPI) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tplaces.show().parent().show();\n\n\t\t\t\tinit();\n\n\t\t\t\tfm.change(function(e) {\n\t\t\t\t\tvar changed = false;\n\t\t\t\t\t$.each(e.data.changed, function(i, file) {\n\t\t\t\t\t\tif (dirs[file.hash]) {\n\t\t\t\t\t\t\tif (file.mime !== 'directory') {\n\t\t\t\t\t\t\t\tif (remove(file.hash)) {\n\t\t\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (update(file)) {\n\t\t\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tchanged && save();\n\t\t\t\t})\n\t\t\t\t.bind('rename', function(e) {\n\t\t\t\t\tvar changed = false;\n\t\t\t\t\tif (e.data.removed) {\n\t\t\t\t\t\t$.each(e.data.removed, function(i, hash) {\n\t\t\t\t\t\t\tif (e.data.added[i]) {\n\t\t\t\t\t\t\t\tif (update(e.data.added[i], hash)) {\n\t\t\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tchanged && save();\n\t\t\t\t})\n\t\t\t\t.bind('rm paste', function(e) {\n\t\t\t\t\tvar names = [],\n\t\t\t\t\t\tchanged = false;\n\t\t\t\t\tif (e.data.removed) {\n\t\t\t\t\t\t$.each(e.data.removed, function(i, hash) {\n\t\t\t\t\t\t\tvar name = remove(hash);\n\t\t\t\t\t\t\tname && names.push(name);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (names.length) {\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (e.data.added && names.length) {\n\t\t\t\t\t\t$.each(e.data.added, function(i, file) {\n\t\t\t\t\t\t\tif ($.inArray(file.name, names) !== 1) {\n\t\t\t\t\t\t\t\tfile.mime == 'directory' && add(file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tchanged && save();\n\t\t\t\t})\n\t\t\t\t.bind('sync netmount', function() {\n\t\t\t\t\tvar ev = this,\n\t\t\t\t\t\topSuffix = opts.suffix? opts.suffix : '',\n\t\t\t\t\t\thashes;\n\t\t\t\t\t\n\t\t\t\t\tif (ev.type === 'sync') {\n\t\t\t\t\t\t// check is change of opts.suffix\n\t\t\t\t\t\tif (suffix !== opSuffix) {\n\t\t\t\t\t\t\tsuffix = opSuffix;\n\t\t\t\t\t\t\tclear();\n\t\t\t\t\t\t\tinit();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\thashes = Object.keys(dirs);\n\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\troot.prepend(spinner);\n\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'info', targets : hashes},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar exists  = {},\n\t\t\t\t\t\t\t\tupdated = false,\n\t\t\t\t\t\t\t\tcwd     = fm.cwd().hash;\n\t\t\t\t\t\t\t$.each(data.files || [], function(i, file) {\n\t\t\t\t\t\t\t\tvar hash = file.hash;\n\t\t\t\t\t\t\t\texists[hash] = file;\n\t\t\t\t\t\t\t\tif (!fm.files().hasOwnProperty(file.hash)) {\n\t\t\t\t\t\t\t\t\t// update cache\n\t\t\t\t\t\t\t\t\tfm.updateCache({tree: [file]});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.each(dirs, function(h, f) {\n\t\t\t\t\t\t\t\tif (Boolean(f.notfound) === Boolean(exists[h])) {\n\t\t\t\t\t\t\t\t\tif ((f.phash === cwd && ev.type !== 'netmount') || (exists[h] && exists[h].mime !== 'directory')) {\n\t\t\t\t\t\t\t\t\t\tif (remove(h)) {\n\t\t\t\t\t\t\t\t\t\t\tupdated = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (update(exists[h] || Object.assign({notfound: true}, f))) {\n\t\t\t\t\t\t\t\t\t\t\tupdated = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if (exists[h] && exists[h].phash != cwd) {\n\t\t\t\t\t\t\t\t\t// update permission of except cwd\n\t\t\t\t\t\t\t\t\tupdate(exists[h]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tupdated && save();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t});\n\t};\n\n});"]}