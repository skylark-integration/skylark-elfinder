{"version":3,"sources":["ui/searchbutton.js"],"names":["define","$","fn","elfindersearchbutton","cmd","this","each","opts","typeSet","cwdReady","inFocus","result","fm","isopts","res","options","incsearch","enable","sTypes","searchTypes","id","name","namespace","escape","toolbar","getUI","btnCls","button","hide","addClass","on","e","stopPropagation","search","input","data","clearTimeout","val","trim","from","prop","mime","type","root","cwd","hash","children","trigger","exec","done","fail","abort","incVal","lazy","fmNode","baseOffset","hasClass","click","css","offset","top","maxHeight","height","slideDown","toFront","slideUp","removeClass","toHide","appendTo","keyCode","ui","ENTER","ESCAPE","preventDefault","minlen","wait","attr","i18n","removeData","setTimeout","length","query","searchStatus","state","UA","ltIE8","title","bind","parent","prepend","show","remove","ltIE7","icon","direction","right","left","parseInt","width","outerWidth","one","api","append","find","i","v","buttonset","next","dirs","volroot","file","parents","push","join","option","substr","shortcut","pattern","description","callback","code","originalEvent","sel","selected","key","cwdHash2Elm","document","Event","ctrlKey","shiftKey","altKey","metaKey","String","fromCharCode"],"mappings":"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","file":"../../ui/searchbutton.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar search button widget.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindersearchbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar result = false,\n\t\t\t\tfm     = cmd.fm,\n\t\t\t\tdisabled = fm.res('class', 'disabled'),\n\t\t\t\tisopts = cmd.options.incsearch || { enable: false },\n\t\t\t\tsTypes = cmd.options.searchTypes,\n\t\t\t\tid     = function(name){return fm.namespace + fm.escape(name);},\n\t\t\t\ttoolbar= fm.getUI('toolbar'),\n\t\t\t\tbtnCls = fm.res('class', 'searchbtn'),\n\t\t\t\tbutton = $(this)\n\t\t\t\t\t.hide()\n\t\t\t\t\t.addClass('ui-widget-content elfinder-button '+btnCls)\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}),\n\t\t\t\tgetMenuOffset = function() {\n\t\t\t\t\tvar fmNode = fm.getUI(),\n\t\t\t\t\t\tbaseOffset = fmNode.offset(),\n\t\t\t\t\t\tbuttonOffset = button.offset();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttop : buttonOffset.top - baseOffset.top,\n\t\t\t\t\t\tmaxHeight : fmNode.height() - 40\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tsearch = function() {\n\t\t\t\t\tinput.data('inctm') && clearTimeout(input.data('inctm'));\n\t\t\t\t\tvar val = $.trim(input.val()),\n\t\t\t\t\t\tfrom = !$('#' + id('SearchFromAll')).prop('checked'),\n\t\t\t\t\t\tmime = $('#' + id('SearchMime')).prop('checked'),\n\t\t\t\t\t\ttype = '';\n\t\t\t\t\tif (from) {\n\t\t\t\t\t\tif ($('#' + id('SearchFromVol')).prop('checked')) {\n\t\t\t\t\t\t\tfrom = fm.root(fm.cwd().hash);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrom = fm.cwd().hash;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (mime) {\n\t\t\t\t\t\tmime = val;\n\t\t\t\t\t\tval = '.';\n\t\t\t\t\t}\n\t\t\t\t\tif (typeSet) {\n\t\t\t\t\t\ttype = typeSet.children('input:checked').val();\n\t\t\t\t\t}\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t\tcmd.exec(val, from, mime, type).done(function() {\n\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\tabort();\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.trigger('searchend');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tabort = function() {\n\t\t\t\t\tinput.data('inctm') && clearTimeout(input.data('inctm'));\n\t\t\t\t\tinput.val('').trigger('blur');\n\t\t\t\t\tif (result || incVal) {\n\t\t\t\t\t\tresult = false;\n\t\t\t\t\t\tincVal = '';\n\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\tfm.trigger('searchend');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tincVal = '',\n\t\t\t\tinput  = $('<input type=\"text\" size=\"42\"/>')\n\t\t\t\t\t.on('focus', function() {\n\t\t\t\t\t\t// close other menus\n\t\t\t\t\t\t!button.hasClass('ui-state-active') && fm.getUI().click();\n\t\t\t\t\t\tinFocus = true;\n\t\t\t\t\t\tincVal = '';\n\t\t\t\t\t\tbutton.addClass('ui-state-active');\n\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t\topts && opts.css(getMenuOffset()).slideDown(function() {\n\t\t\t\t\t\t\t// Care for on browser window re-active\n\t\t\t\t\t\t\tbutton.addClass('ui-state-active');\n\t\t\t\t\t\t\tfm.toFront(opts);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('blur', function() {\n\t\t\t\t\t\tinFocus = false;\n\t\t\t\t\t\tif (opts) {\n\t\t\t\t\t\t\tif (!opts.data('infocus')) {\n\t\t\t\t\t\t\t\topts.slideUp(function() {\n\t\t\t\t\t\t\t\t\tbutton.removeClass('ui-state-active');\n\t\t\t\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t\t\t\t\tfm.toHide(opts);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topts.data('infocus', false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbutton.removeClass('ui-state-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.appendTo(button)\n\t\t\t\t\t// to avoid fm shortcuts on arrows\n\t\t\t\t\t.on('keypress', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (e.keyCode === $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\tsearch();\n\t\t\t\t\t\t} else if (e.keyCode === $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tabort();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\topts, typeSet, cwdReady, inFocus;\n\t\t\t\n\t\t\tif (isopts.enable) {\n\t\t\t\tisopts.minlen = isopts.minlen || 2;\n\t\t\t\tisopts.wait = isopts.wait || 500;\n\t\t\t\tinput\n\t\t\t\t\t.attr('title', fm.i18n('incSearchOnly'))\n\t\t\t\t\t.on('compositionstart', function() {\n\t\t\t\t\t\tinput.data('composing', true);\n\t\t\t\t\t})\n\t\t\t\t\t.on('compositionend', function() {\n\t\t\t\t\t\tinput.removeData('composing');\n\t\t\t\t\t\tinput.trigger('input'); // for IE, edge\n\t\t\t\t\t})\n\t\t\t\t\t.on('input', function() {\n\t\t\t\t\t\tif (! input.data('composing')) {\n\t\t\t\t\t\t\tinput.data('inctm') && clearTimeout(input.data('inctm'));\n\t\t\t\t\t\t\tinput.data('inctm', setTimeout(function() {\n\t\t\t\t\t\t\t\tvar val = input.val();\n\t\t\t\t\t\t\t\tif (val.length === 0 || val.length >= isopts.minlen) {\n\t\t\t\t\t\t\t\t\t(incVal !== val) && fm.trigger('incsearchstart', {\n\t\t\t\t\t\t\t\t\t\tquery: val,\n\t\t\t\t\t\t\t\t\t\ttype: typeSet? typeSet.children('input:checked').val() : 'searchName'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tincVal = val;\n\t\t\t\t\t\t\t\t\tif (val === '' && fm.searchStatus.state > 1 && fm.searchStatus.query) {\n\t\t\t\t\t\t\t\t\t\tinput.val(fm.searchStatus.query).trigger('select');\n\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, isopts.wait));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (fm.UA.ltIE8) {\n\t\t\t\t\tinput.on('keydown', function(e) {\n\t\t\t\t\t\t\tif (e.keyCode === 229) {\n\t\t\t\t\t\t\t\tinput.data('imetm') && clearTimeout(input.data('imetm'));\n\t\t\t\t\t\t\t\tinput.data('composing', true);\n\t\t\t\t\t\t\t\tinput.data('imetm', setTimeout(function() {\n\t\t\t\t\t\t\t\t\tinput.removeData('composing');\n\t\t\t\t\t\t\t\t}, 100));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('keyup', function(e) {\n\t\t\t\t\t\t\tinput.data('imetm') && clearTimeout(input.data('imetm'));\n\t\t\t\t\t\t\tif (input.data('composing')) {\n\t\t\t\t\t\t\t\te.keyCode === $.ui.keyCode.ENTER && input.trigger('compositionend');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tinput.trigger('input');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t$('<span class=\"ui-icon ui-icon-search\" title=\"'+cmd.title+'\"/>')\n\t\t\t\t.appendTo(button)\n\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (button.hasClass('ui-state-active')) {\n\t\t\t\t\t\tsearch();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t\t$('<span class=\"ui-icon ui-icon-close\"/>')\n\t\t\t\t.appendTo(button)\n\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (input.val() === '' && !button.hasClass('ui-state-active')) {\n\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tabort();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t\t// wait when button will be added to DOM\n\t\t\tfm.bind('toolbarload', function(){\n\t\t\t\tvar parent = button.parent();\n\t\t\t\tif (parent.length) {\n\t\t\t\t\ttoolbar.prepend(button.show());\n\t\t\t\t\tparent.remove();\n\t\t\t\t\t// position icons for ie7\n\t\t\t\t\tif (fm.UA.ltIE7) {\n\t\t\t\t\t\tvar icon = button.children(fm.direction == 'ltr' ? '.ui-icon-close' : '.ui-icon-search');\n\t\t\t\t\t\ticon.css({\n\t\t\t\t\t\t\tright : '',\n\t\t\t\t\t\t\tleft  : parseInt(button.width())-icon.outerWidth(true)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tfm\n\t\t\t\t.one('init', function() {\n\t\t\t\t\tfm.getUI('cwd').on('touchstart click', function() {\n\t\t\t\t\t\tinFocus && input.trigger('blur');\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.one('open', function() {\n\t\t\t\t\topts = (fm.api < 2.1)? null : $('<div class=\"ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all\"/>')\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<div class=\"buttonset\"/>')\n\t\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchFromCwd')+'\" name=\"serchfrom\" type=\"radio\" checked=\"checked\"/><label for=\"'+id('SearchFromCwd')+'\">'+fm.i18n('btnCwd')+'</label>'),\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchFromVol')+'\" name=\"serchfrom\" type=\"radio\"/><label for=\"'+id('SearchFromVol')+'\">'+fm.i18n('btnVolume')+'</label>'),\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchFromAll')+'\" name=\"serchfrom\" type=\"radio\"/><label for=\"'+id('SearchFromAll')+'\">'+fm.i18n('btnAll')+'</label>')\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$('<div class=\"buttonset elfinder-search-type\"/>')\n\t\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchName')+'\" name=\"serchcol\" type=\"radio\" checked=\"checked\" value=\"SearchName\"/><label for=\"'+id('SearchName')+'\">'+fm.i18n('btnFileName')+'</label>')\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t.appendTo(fm.getUI());\n\t\t\t\t\tif (opts) {\n\t\t\t\t\t\tif (sTypes) {\n\t\t\t\t\t\t\ttypeSet = opts.find('.elfinder-search-type');\n\t\t\t\t\t\t\t$.each(cmd.options.searchTypes, function(i, v) {\n\t\t\t\t\t\t\t\ttypeSet.append($('<input id=\"'+id(i)+'\" name=\"serchcol\" type=\"radio\" value=\"'+fm.escape(i)+'\"/><label for=\"'+id(i)+'\">'+fm.i18n(v.name)+'</label>'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\topts.find('div.buttonset').buttonset();\n\t\t\t\t\t\t$('#'+id('SearchFromAll')).next('label').attr('title', fm.i18n('searchTarget', fm.i18n('btnAll')));\n\t\t\t\t\t\tif (sTypes) {\n\t\t\t\t\t\t\t$.each(sTypes, function(i, v) {\n\t\t\t\t\t\t\t\tif (v.title) {\n\t\t\t\t\t\t\t\t\t$('#'+id(i)).next('label').attr('title', fm.i18n(v.title));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\topts.on('mousedown', 'div.buttonset', function(e){\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\topts.data('infocus', true);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('click', 'input', function(e) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t$.trim(input.val())? search() : input.trigger('focus');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('close', function() {\n\t\t\t\t\t\t\t\tinput.trigger('blur');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('searchend', function() {\n\t\t\t\t\tinput.val('');\n\t\t\t\t})\n\t\t\t\t.bind('open parents', function() {\n\t\t\t\t\tvar dirs    = [],\n\t\t\t\t\t\tvolroot = fm.file(fm.root(fm.cwd().hash));\n\t\t\t\t\t\n\t\t\t\t\tif (volroot) {\n\t\t\t\t\t\t$.each(fm.parents(fm.cwd().hash), function(i, hash) {\n\t\t\t\t\t\t\tdirs.push(fm.file(hash).name);\n\t\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t\t$('#'+id('SearchFromCwd')).next('label').attr('title', fm.i18n('searchTarget', dirs.join(fm.option('separator'))));\n\t\t\t\t\t\t$('#'+id('SearchFromVol')).next('label').attr('title', fm.i18n('searchTarget', volroot.name));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('open', function() {\n\t\t\t\t\tincVal && abort();\n\t\t\t\t})\n\t\t\t\t.bind('cwdinit', function() {\n\t\t\t\t\tcwdReady = false;\n\t\t\t\t})\n\t\t\t\t.bind('cwdrender',function() {\n\t\t\t\t\tcwdReady = true;\n\t\t\t\t})\n\t\t\t\t.bind('keydownEsc', function() {\n\t\t\t\t\tif (incVal && incVal.substr(0, 1) === '/') {\n\t\t\t\t\t\tincVal = '';\n\t\t\t\t\t\tinput.val('');\n\t\t\t\t\t\tfm.trigger('searchend');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'ctrl+f f3',\n\t\t\t\t\tdescription : cmd.title,\n\t\t\t\t\tcallback    : function() { \n\t\t\t\t\t\tinput.trigger('select').trigger('focus');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9',\n\t\t\t\t\tdescription : fm.i18n('firstLetterSearch'),\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tif (! cwdReady) { return; }\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar code = e.originalEvent.keyCode,\n\t\t\t\t\t\t\tnext = function() {\n\t\t\t\t\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\t\t\t\t\tkey = $.ui.keyCode[(!sel.length || fm.cwdHash2Elm(sel[0]).next('[id]').length)? 'RIGHT' : 'HOME'];\n\t\t\t\t\t\t\t\t$(document).trigger($.Event('keydown', { keyCode: key, ctrlKey : false, shiftKey : false, altKey : false, metaKey : false }));\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tval;\n\t\t\t\t\t\tif (code >= 96 && code <= 105) {\n\t\t\t\t\t\t\tcode -= 48;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tval = '/' + String.fromCharCode(code);\n\t\t\t\t\t\tif (incVal !== val) {\n\t\t\t\t\t\t\tinput.val(val);\n\t\t\t\t\t\t\tincVal = val;\n\t\t\t\t\t\t\tfm\n\t\t\t\t\t\t\t\t.trigger('incsearchstart', { query: val })\n\t\t\t\t\t\t\t\t.one('cwdrender', next);\n\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t});\n\t};\n\n});"]}