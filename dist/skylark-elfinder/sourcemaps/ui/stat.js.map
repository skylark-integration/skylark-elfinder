{"version":3,"sources":["ui/stat.js"],"names":["define","$","fn","elfinderstat","fm","this","each","size","addClass","sel","on","e","hash","data","preventDefault","exec","titleitems","i18n","titlesel","titlesize","setIncsearchStat","find","html","hashes","length","attr","text","trigger","setSelect","files","path","file","s","c","dirs","searchStatus","state","escape","replace","push","phash","i18","name","join","formatSize","i","parseInt","getUI","prepend","append","show","UA","Mobile","tooltip","classes","ui-tooltip","tooltipClass","track","bind","cwd","calc","hasSize","map","h","sizeInfo","mime","change","changed","cwdHash","children","select","selectedFiles"],"mappings":"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","file":"../../ui/stat.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elFinder ui\n\t * Display number of files/selected files and its size in statusbar\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderstat = function(fm) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar size       = $(this).addClass('elfinder-stat-size'),\n\t\t\t\tsel        = $('<div class=\"elfinder-stat-selected\"/>')\n\t\t\t\t\t.on('click', 'a', function(e) {\n\t\t\t\t\t\tvar hash = $(this).data('hash');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfm.exec('opendir', [ hash ]);\n\t\t\t\t\t}),\n\t\t\t\ttitleitems = fm.i18n('items'),\n\t\t\t\ttitlesel   = fm.i18n('selected'),\n\t\t\t\ttitlesize  = fm.i18n('size'),\n\t\t\t\tsetstat    = function(files) {\n\t\t\t\t\tvar c = 0, \n\t\t\t\t\t\ts = 0,\n\t\t\t\t\t\tcwd = fm.cwd(),\n\t\t\t\t\t\tcalc = true,\n\t\t\t\t\t\thasSize = true;\n\n\t\t\t\t\tif (cwd.sizeInfo || cwd.size) {\n\t\t\t\t\t\ts = cwd.size;\n\t\t\t\t\t\tcalc = false;\n\t\t\t\t\t}\n\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\tc++;\n\t\t\t\t\t\tif (calc) {\n\t\t\t\t\t\t\ts += parseInt(file.size) || 0;\n\t\t\t\t\t\t\tif (hasSize === true && file.mime === 'directory' && !file.sizeInfo) {\n\t\t\t\t\t\t\t\thasSize = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tsize.html(titleitems+': <span class=\"elfinder-stat-incsearch\"></span>'+c+',&nbsp;<span class=\"elfinder-stat-size'+(hasSize? ' elfinder-stat-size-recursive' : '')+'\">'+fm.i18n(hasSize? 'sum' : 'size')+': '+fm.formatSize(s)+'</span>')\n\t\t\t\t\t\t.attr('title', size.text());\n\t\t\t\t\tfm.trigger('uistatchange');\n\t\t\t\t},\n\t\t\t\tsetIncsearchStat = function(data) {\n\t\t\t\t\tsize.find('span.elfinder-stat-incsearch').html(data? data.hashes.length + ' / ' : '');\n\t\t\t\t\tsize.attr('title', size.text());\n\t\t\t\t\tfm.trigger('uistatchange');\n\t\t\t\t},\n\t\t\t\tsetSelect = function(files) {\n\t\t\t\t\tvar s = 0,\n\t\t\t\t\t\tc = 0,\n\t\t\t\t\t\tdirs = [],\n\t\t\t\t\t\tpath, file;\n\n\t\t\t\t\tif (files.length === 1) {\n\t\t\t\t\t\tfile = files[0];\n\t\t\t\t\t\ts = file.size;\n\t\t\t\t\t\tif (fm.searchStatus.state === 2) {\n\t\t\t\t\t\t\tpath = fm.escape(file.path? file.path.replace(/\\/[^\\/]*$/, '') : '..');\n\t\t\t\t\t\t\tdirs.push('<a href=\"#elf_'+file.phash+'\" data-hash=\"'+file.hash+'\" title=\"'+path+'\">'+path+'</a>');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdirs.push(fm.escape(file.i18 || file.name));\n\t\t\t\t\t\tsel.html(dirs.join('/') + (s > 0 ? ', '+fm.formatSize(s) : ''));\n\t\t\t\t\t} else if (files.length) {\n\t\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t\ts += parseInt(file.size)||0;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsel.html(c ? titlesel+': '+c+', '+titlesize+': '+fm.formatSize(s) : '&nbsp;');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsel.html('');\n\t\t\t\t\t}\n\t\t\t\t\tsel.attr('title', sel.text());\n\t\t\t\t\tfm.trigger('uistatchange');\n\t\t\t\t};\n\n\t\t\tfm.getUI('statusbar').prepend(size).append(sel).show();\n\t\t\tif (fm.UA.Mobile && $.fn.tooltip) {\n\t\t\t\tfm.getUI('statusbar').tooltip({\n\t\t\t\t\tclasses: {\n\t\t\t\t\t\t'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'\n\t\t\t\t\t},\n\t\t\t\t\ttooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',\n\t\t\t\t\ttrack: true\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tfm\n\t\t\t.bind('cwdhasheschange', function(e) {\n\t\t\t\tsetstat($.map(e.data, function(h) { return fm.file(h); }));\n\t\t\t})\n\t\t\t.change(function(e) {\n\t\t\t\tvar files = e.data.changed || [],\n\t\t\t\t\tcwdHash = fm.cwd().hash;\n\t\t\t\t$.each(files, function() {\n\t\t\t\t\tif (this.hash === cwdHash) {\n\t\t\t\t\t\tif (this.size) {\n\t\t\t\t\t\t\tsize.children('.elfinder-stat-size').addClass('elfinder-stat-size-recursive').html(fm.i18n('sum')+': '+fm.formatSize(this.size));\n\t\t\t\t\t\t\tsize.attr('title', size.text());\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.select(function() {\n\t\t\t\tsetSelect(fm.selectedFiles());\n\t\t\t})\n\t\t\t.bind('open', function() {\n\t\t\t\tsetSelect([]);\n\t\t\t})\n\t\t\t.bind('incsearch', function(e) {\n\t\t\t\tsetIncsearchStat(e.data);\n\t\t\t})\n\t\t\t.bind('incsearchend', function() {\n\t\t\t\tsetIncsearchStat();\n\t\t\t})\n\t\t\t;\n\t\t});\n\t};\n\n\treturn $;\n});\n"]}