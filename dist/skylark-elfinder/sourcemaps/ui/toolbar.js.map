{"version":3,"sources":["ui/toolbar.js"],"names":["define","$","fn","elfindertoolbar","fm","opts","this","not","each","l","i","cmd","panel","button","swipeHandle","autoHide","textLabel","resizeTm","commands","_commands","self","addClass","options","displayTextLabel","labelExcludeUA","autoHideUA","showPreferenceButton","render","disabled","name","cmdPref","buttons","b","detach","empty","panels","length","ui","children","prepend","before","append","data","show","hide","prevHeight","clientHeight","trigger","grep","v","isPlainObject","Object","assign","filter","dispre","uiCmdMapPrev","contextRaw","toLowerCase","storage","UA","push","label","i18n","icon","callback","css","find","preferenceInContextmenu","exec","tab","on","e","stopPropagation","preventDefault","raw","x","pageX","y","pageY","originalEvent","touches","clearTimeout","removeData","setTimeout","type","longtap","Math","abs","stopImmediatePropagation","prev","parent","bind","doRender","sel","disabledKeys","option","userHides","Array","isArray","defaultHides","searchStatus","state","selected","getDisabledCmds","n","keys","commandMap","from","to","toString","sort","JSON","stringify","origin","after","btn","extendsCmd","cancelAnimationFrame","requestAnimationFrame","h","Touch","toolbar","one","uiAutoHide","stop","duration","init","appendTo","getUI","remove","wz","toshow","is","wzh","height","delta","outerHeight","opt","step","now","always","handleH","resources","blink","scrollTop","animate","scrollBottom","_preventSwipeY"],"mappings":"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","file":"../../ui/toolbar.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindertoolbar = function(fm, opts) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-toolbar').each(function() {\n\t\t\tvar commands = fm._commands,\n\t\t\t\tself     = $(this).addClass('ui-helper-clearfix ui-widget-header elfinder-toolbar'),\n\t\t\t\toptions  = {\n\t\t\t\t\t// default options\n\t\t\t\t\tdisplayTextLabel: false,\n\t\t\t\t\tlabelExcludeUA: ['Mobile'],\n\t\t\t\t\tautoHideUA: ['Mobile'],\n\t\t\t\t\tshowPreferenceButton: 'none'\n\t\t\t\t},\n\t\t\t\tfilter   = function(opts) {\n\t\t\t\t\treturn $.grep(opts, function(v) {\n\t\t\t\t\t\tif ($.isPlainObject(v)) {\n\t\t\t\t\t\t\toptions = Object.assign(options, v);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\trender = function(disabled){\n\t\t\t\t\tvar name,cmdPref;\n\t\t\t\t\t\n\t\t\t\t\t$.each(buttons, function(i, b) { b.detach(); });\n\t\t\t\t\tself.empty();\n\t\t\t\t\tl = panels.length;\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\tif (panels[l]) {\n\t\t\t\t\t\t\tpanel = $('<div class=\"ui-widget-content ui-corner-all elfinder-buttonset\"/>');\n\t\t\t\t\t\t\ti = panels[l].length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\tname = panels[l][i];\n\t\t\t\t\t\t\t\tif ((!disabled || !disabled[name]) && (cmd = commands[name])) {\n\t\t\t\t\t\t\t\t\tbutton = 'elfinder'+cmd.options.ui;\n\t\t\t\t\t\t\t\t\tif (! buttons[name] && $.fn[button]) {\n\t\t\t\t\t\t\t\t\t\tbuttons[name] = $('<div/>')[button](cmd);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (buttons[name]) {\n\t\t\t\t\t\t\t\t\t\tbuttons[name].children('.elfinder-button-text')[textLabel? 'show' : 'hide']();\n\t\t\t\t\t\t\t\t\t\tpanel.prepend(buttons[name]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpanel.children().length && self.prepend(panel);\n\t\t\t\t\t\t\tpanel.children(':gt(0)').before('<span class=\"ui-widget-content elfinder-toolbar-button-separator\"/>');\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (cmdPref = commands['preference']) {\n\t\t\t\t\t\t//cmdPref.state = !self.children().length? 0 : -1;\n\t\t\t\t\t\tif (options.showPreferenceButton === 'always' || (!self.children().length && options.showPreferenceButton === 'auto')) {\n\t\t\t\t\t\t\t//cmdPref.state = 0;\n\t\t\t\t\t\t\tpanel = $('<div class=\"ui-widget-content ui-corner-all elfinder-buttonset\"/>');\n\t\t\t\t\t\t\tname = 'preference';\n\t\t\t\t\t\t\tbutton = 'elfinder'+cmd.options.ui;\n\t\t\t\t\t\t\tbuttons[name] = $('<div/>')[button](cmdPref);\n\t\t\t\t\t\t\tbuttons[name].children('.elfinder-button-text')[textLabel? 'show' : 'hide']();\n\t\t\t\t\t\t\tpanel.prepend(buttons[name]);\n\t\t\t\t\t\t\tself.append(panel);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t(! self.data('swipeClose') && self.children().length)? self.show() : self.hide();\n\t\t\t\t\tprevHeight = self[0].clientHeight;\n\t\t\t\t\tfm.trigger('toolbarload').trigger('uiresize');\n\t\t\t\t},\n\t\t\t\tbuttons = {},\n\t\t\t\tpanels   = filter(opts || []),\n\t\t\t\tdispre   = null,\n\t\t\t\tuiCmdMapPrev = '',\n\t\t\t\tprevHeight = 0,\n\t\t\t\tcontextRaw = [],\n\t\t\t\tl, i, cmd, panel, button, swipeHandle, autoHide, textLabel, resizeTm;\n\t\t\t\n\t\t\t// normalize options\n\t\t\toptions.showPreferenceButton = options.showPreferenceButton.toLowerCase();\n\t\t\t\n\t\t\tif (options.displayTextLabel !== 'none') {\n\t\t\t\t// correction of options.displayTextLabel\n\t\t\t\ttextLabel = fm.storage('toolbarTextLabel');\n\t\t\t\tif (textLabel === null) {\n\t\t\t\t\ttextLabel = (options.displayTextLabel && (! options.labelExcludeUA || ! options.labelExcludeUA.length || ! $.grep(options.labelExcludeUA, function(v){ return fm.UA[v]? true : false; }).length));\n\t\t\t\t} else {\n\t\t\t\t\ttextLabel = (textLabel == 1);\n\t\t\t\t}\n\t\t\t\tcontextRaw.push({\n\t\t\t\t\tlabel    : fm.i18n('textLabel'),\n\t\t\t\t\ticon     : 'text',\n\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\ttextLabel = ! textLabel;\n\t\t\t\t\t\tself.css('height', '').find('.elfinder-button-text')[textLabel? 'show':'hide']();\n\t\t\t\t\t\tfm.trigger('uiresize').storage('toolbarTextLabel', textLabel? '1' : '0');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options.preferenceInContextmenu && commands['preference']) {\n\t\t\t\tcontextRaw.push({\n\t\t\t\t\tlabel    : fm.i18n('toolbarPref'),\n\t\t\t\t\ticon     : 'preference',\n\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\tfm.exec('preference', void(0), {tab: 'toolbar'});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// add contextmenu\n\t\t\tif (contextRaw.length) {\n\t\t\t\tself.on('contextmenu', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: contextRaw,\n\t\t\t\t\t\t\tx: e.pageX,\n\t\t\t\t\t\t\ty: e.pageY\n\t\t\t\t\t\t});\n\t\t\t\t\t}).on('touchstart', function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.data('tmlongtap') && clearTimeout(self.data('tmlongtap'));\n\t\t\t\t\t\tself.removeData('longtap')\n\t\t\t\t\t\t\t.data('longtap', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY})\n\t\t\t\t\t\t\t.data('tmlongtap', setTimeout(function() {\n\t\t\t\t\t\t\t\tself.removeData('longtapTm')\n\t\t\t\t\t\t\t\t\t.trigger({\n\t\t\t\t\t\t\t\t\t\ttype: 'contextmenu',\n\t\t\t\t\t\t\t\t\t\tpageX: self.data('longtap').x,\n\t\t\t\t\t\t\t\t\t\tpageY: self.data('longtap').y\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.data('longtap', {longtap: true});\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t}).on('touchmove touchend', function(e) {\n\t\t\t\t\t\tif (self.data('tmlongtap')) {\n\t\t\t\t\t\t\tif (e.type === 'touchend' ||\n\t\t\t\t\t\t\t\t\t( Math.abs(self.data('longtap').x - e.originalEvent.touches[0].pageX)\n\t\t\t\t\t\t\t\t\t+ Math.abs(self.data('longtap').y - e.originalEvent.touches[0].pageY)) > 4)\n\t\t\t\t\t\t\tclearTimeout(self.data('tmlongtap'));\n\t\t\t\t\t\t\tself.removeData('longtapTm');\n\t\t\t\t\t\t}\n\t\t\t\t\t}).on('click', function(e) {\n\t\t\t\t\t\tif (self.data('longtap') && self.data('longtap').longtap) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}).on('touchend click', '.elfinder-button', function(e) {\n\t\t\t\t\t\tif (self.data('longtap') && self.data('longtap').longtap) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tself.prev().length && self.parent().prepend(this);\n\t\t\t\n\t\t\trender();\n\t\t\t\n\t\t\tfm.bind('open sync select toolbarpref', function() {\n\t\t\t\tvar disabled = Object.assign({}, fm.option('disabledFlip')),\n\t\t\t\t\tuserHides = fm.storage('toolbarhides'),\n\t\t\t\t\tdoRender, sel, disabledKeys;\n\t\t\t\t\n\t\t\t\tif (! userHides && Array.isArray(options.defaultHides)) {\n\t\t\t\t\tuserHides = {};\n\t\t\t\t\t$.each(options.defaultHides, function() {\n\t\t\t\t\t\tuserHides[this] = true;\n\t\t\t\t\t});\n\t\t\t\t\tfm.storage('toolbarhides', userHides);\n\t\t\t\t}\n\t\t\t\tif (this.type === 'select') {\n\t\t\t\t\tif (fm.searchStatus.state < 2) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tsel = fm.selected();\n\t\t\t\t\tif (sel.length) {\n\t\t\t\t\t\tdisabled = fm.getDisabledCmds(sel, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(userHides, function(n) {\n\t\t\t\t\tif (!disabled[n]) {\n\t\t\t\t\t\tdisabled[n] = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (Object.keys(fm.commandMap).length) {\n\t\t\t\t\t$.each(fm.commandMap, function(from, to){\n\t\t\t\t\t\tif (to === 'hidden') {\n\t\t\t\t\t\t\tdisabled[from] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdisabledKeys = Object.keys(disabled);\n\t\t\t\tif (!dispre || dispre.toString() !== disabledKeys.sort().toString()) {\n\t\t\t\t\trender(disabledKeys.length? disabled : null);\n\t\t\t\t\tdoRender = true;\n\t\t\t\t}\n\t\t\t\tdispre = disabledKeys.sort();\n\n\t\t\t\tif (doRender || uiCmdMapPrev !== JSON.stringify(fm.commandMap)) {\n\t\t\t\t\tuiCmdMapPrev = JSON.stringify(fm.commandMap);\n\t\t\t\t\tif (! doRender) {\n\t\t\t\t\t\t// reset toolbar\n\t\t\t\t\t\t$.each($('div.elfinder-button'), function(){\n\t\t\t\t\t\t\tvar origin = $(this).data('origin');\n\t\t\t\t\t\t\tif (origin) {\n\t\t\t\t\t\t\t\t$(this).after(origin).detach();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (Object.keys(fm.commandMap).length) {\n\t\t\t\t\t\t$.each(fm.commandMap, function(from, to){\n\t\t\t\t\t\t\tvar cmd = fm._commands[to],\n\t\t\t\t\t\t\t\tbutton = cmd? 'elfinder'+cmd.options.ui : null,\n\t\t\t\t\t\t\t\tbtn;\n\t\t\t\t\t\t\tif (button && $.fn[button]) {\n\t\t\t\t\t\t\t\tbtn = buttons[from];\n\t\t\t\t\t\t\t\tif (btn) {\n\t\t\t\t\t\t\t\t\tif (! buttons[to] && $.fn[button]) {\n\t\t\t\t\t\t\t\t\t\tbuttons[to] = $('<div/>')[button](cmd);\n\t\t\t\t\t\t\t\t\t\tif (buttons[to]) {\n\t\t\t\t\t\t\t\t\t\t\tbuttons[to].children('.elfinder-button-text')[textLabel? 'show' : 'hide']();\n\t\t\t\t\t\t\t\t\t\t\tif (cmd.extendsCmd) {\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons[to].children('span.elfinder-button-icon').addClass('elfinder-button-icon-' + cmd.extendsCmd);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (buttons[to]) {\n\t\t\t\t\t\t\t\t\t\tbtn.after(buttons[to]);\n\t\t\t\t\t\t\t\t\t\tbuttons[to].data('origin', btn.detach());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).bind('resize', function(e) {\n\t\t\t\tresizeTm && cancelAnimationFrame(resizeTm);\n\t\t\t\tresizeTm = requestAnimationFrame(function() {\n\t\t\t\t\tvar h = self[0].clientHeight;\n\t\t\t\t\tif (prevHeight !== h) {\n\t\t\t\t\t\tprevHeight = h;\n\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\tif (fm.UA.Touch) {\n\t\t\t\tautoHide = fm.storage('autoHide') || {};\n\t\t\t\tif (typeof autoHide.toolbar === 'undefined') {\n\t\t\t\t\tautoHide.toolbar = (options.autoHideUA && options.autoHideUA.length > 0 && $.grep(options.autoHideUA, function(v){ return fm.UA[v]? true : false; }).length);\n\t\t\t\t\tfm.storage('autoHide', autoHide);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (autoHide.toolbar) {\n\t\t\t\t\tfm.one('init', function() {\n\t\t\t\t\t\tfm.uiAutoHide.push(function(){ self.stop(true, true).trigger('toggle', { duration: 500, init: true }); });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.bind('load', function() {\n\t\t\t\t\tswipeHandle = $('<div class=\"elfinder-toolbar-swipe-handle\"/>').hide().appendTo(fm.getUI());\n\t\t\t\t\tif (swipeHandle.css('pointer-events') !== 'none') {\n\t\t\t\t\t\tswipeHandle.remove();\n\t\t\t\t\t\tswipeHandle = null;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.on('toggle', function(e, data) {\n\t\t\t\t\tvar wz    = fm.getUI('workzone'),\n\t\t\t\t\t\ttoshow= self.is(':hidden'),\n\t\t\t\t\t\twzh   = wz.height(),\n\t\t\t\t\t\th     = self.height(),\n\t\t\t\t\t\ttbh   = self.outerHeight(true),\n\t\t\t\t\t\tdelta = tbh - h,\n\t\t\t\t\t\topt   = Object.assign({\n\t\t\t\t\t\t\tstep: function(now) {\n\t\t\t\t\t\t\t\twz.height(wzh + (toshow? (now + delta) * -1 : h - now));\n\t\t\t\t\t\t\t\tfm.trigger('resize');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\talways: function() {\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tself.css('height', '');\n\t\t\t\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t\t\t\t\tif (swipeHandle) {\n\t\t\t\t\t\t\t\t\t\tif (toshow) {\n\t\t\t\t\t\t\t\t\t\t\tswipeHandle.stop(true, true).hide();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tswipeHandle.height(data.handleH? data.handleH : '');\n\t\t\t\t\t\t\t\t\t\t\tfm.resources.blink(swipeHandle, 'slowonce');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ttoshow && self.scrollTop('0px');\n\t\t\t\t\t\t\t\t\tdata.init && fm.trigger('uiautohide');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, data);\n\t\t\t\t\tself.data('swipeClose', ! toshow).stop(true, true).animate({height : 'toggle'}, opt);\n\t\t\t\t\tautoHide.toolbar = !toshow;\n\t\t\t\t\tfm.storage('autoHide', Object.assign(fm.storage('autoHide'), {toolbar: autoHide.toolbar}));\n\t\t\t\t}).on('touchstart', function(e) {\n\t\t\t\t\tif (self.scrollBottom() > 5) {\n\t\t\t\t\t\te.originalEvent._preventSwipeY = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn this;\n\t};\n\n\n\treturn $;\n});\n"]}