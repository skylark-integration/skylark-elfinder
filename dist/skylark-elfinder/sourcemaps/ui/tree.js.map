{"version":3,"sources":["ui/tree.js"],"names":["define","$","fn","elfindertree","fm","opts","treeclass","res","this","not","each","execSubdirsTm","autoScrTm","syncing","navbarScrTm","c","mobile","UA","Mobile","root","openRoot","openRootOnLoad","openCwd","openCwdOnOpen","syncTree","subtree","navdir","selNavdir","collapsed","expanded","loaded","arrow","active","dropover","hover","disabled","draggable","droppable","wrapperRoot","pastable","uploadable","insideNavbar","x","left","navbar","offset","width","subdirsQue","subdirsExecQue","subdirs","ids","targets","i","id","push","navId2Hash","length","request","data","cmd","preventDefault","done","hash","elm","navHash2Elm","removeClass","subdirsJobRes","checkSubdirs","Object","keys","_abort","clearTimeout","asyncJob","isInWindow","numPerOnce","arr","execSubdirs","subdirsPending","cnt","subdirsMaxConn","atOnce","maxTargets","Math","min","subdirsAtOnce","cancelAnimationFrame","splice","always","requestAnimationFrame","drop","droppableopts","extend","over","e","ui","status","dst","helper","cl","stopPropagation","namespace","insideWorkzone","pageX","pageY","clientX","addClass","is","setTimeout","children","trigger","attr","h","file","phash","hasClass","shiftKey","ctrlKey","metaKey","out","max","removeData","deactivate","call","spinner","tpl","ptpl","stpl","hasMoreDirs","replace","dir","navHash2Id","name","escape","i18","cssclass","cname","isroot","perms2class","dirs","link","getClass","csscls","title","attrTitle","path","cls","inArray","permissions","read","write","symlink","alias","style","icon","getIconStyle","itemhtml","m","key","filter","files","checkExists","map","f","mime","findSubtree","next","tree","findSibling","info","node","compare","updateTree","parent","sibling","init","base","lastKey","orphans","tgts","cwd","append","start","direction","hashes","curStart","newAPI","subTreeMax","setHashes","d","update","changed","mode","select","render","getStart","change","hide","detach","show","removed","grep","indexOf","added","concat","sort","target","floor","prev","total","page","parts","prevBtn","nextBtn","html","nodes","off","on","slice","ceil","text","i18n","button","icons","primary","empty","join","n","replaceWith","autoScroll","lazy","updateDroppable","ch","atonce","updates","lastNodes","before","add","prepend","after","p","dir1","dir2","sortAlsoTreeview","asc","sortOrder","type","sortType","rules","sortRules","current","top","treeH","bottom","tgtTop","dfrd","Deferred","document","getElementById","parents","stop","height","outerHeight","animate","scrollTop","duration","durations","complete","resolve","reject","getEnds","cur","unshift","selectPages","curHash","sync","cwdDirs","aScr","baseNode","reqs","baseHash","baseId","dfd","ends","cwdhash","autoScr","open","endHash","updateArrows","api","find","rmSpinner","fail","remove","until","isRoot","getPhash","dep","ph","depth","closest","preventFail","makeReq","insertBefore","when","apply","argLen","arguments","assign","makeArray","interval","sel","enter","scrolling","isCommandEnabled","toggleClass","originalEvent","dataTransfer","selected","origin","exec","one","touches","evt","nodeName","y","stree","toggle","draggingUiHelper","slideUpDown","slideDown","self","getUI","bind","blink","resources","item","pdir","lock","move","prevSortTreeview","contextmenu","iOS","tmp","realParent","reqParent","realSibling","reqSibling","isExpanded","isLoaded","l","get","helperLocked","act","endsMap","endsVid","topVid","single","roots","end","vid","volumeid"],"mappings":";;;;;;;AAAAA,QACC,kBACC,SAASC,GA4hDV,OAthDAA,EAAEC,GAAGC,aAAe,SAASC,EAAIC,GAChC,aACA,IAAIC,EAAYF,EAAGG,IAAI,QAAS,QAghDhC,OA9gDAC,KAAKC,IAAI,IAAIH,GAAWI,KAAK,WAE5B,IA0OCC,EAqgBAC,EA6FAC,EA2dAC,EAvyCGC,EAAI,QAASC,EAASZ,EAAGa,GAAGC,OAO/BC,EAAYf,EAAGG,IAAIQ,EAAG,YAOtBK,EAAYf,EAAKgB,eAOjBC,EAAYjB,EAAKkB,cAQjBC,EAAYF,GAAWjB,EAAKmB,SAO5BC,EAAYrB,EAAGG,IAAIQ,EAAG,cAOtBW,EAAYtB,EAAGG,IAAIQ,EAAG,WAOtBY,EAAY,QAAUD,EAOtBE,EAAYxB,EAAGG,IAAIQ,EAAG,eAOtBc,EAAYzB,EAAGG,IAAIQ,EAAG,aAOtBe,EAAY,0BAcZC,EAAQ3B,EAAGG,IAAIQ,EAAG,YAOlBiB,EAAY5B,EAAGG,IAAIQ,EAAG,UAOtBkB,EAAW7B,EAAGG,IAAIQ,EAAG,cAOrBmB,EAAW9B,EAAGG,IAAIQ,EAAG,SAOrBoB,EAAW/B,EAAGG,IAAIQ,EAAG,YAOrBqB,EAAYhC,EAAGG,IAAIQ,EAAG,aAOtBsB,EAAYjC,EAAGG,IAAIQ,EAAG,aAOtBuB,EAAc,+BAOdC,EAAW,mCAOXC,EAAa,qCASbC,EAAe,SAASC,GACvB,IAAIC,EAAOC,GAAOC,SAASF,KAE3B,OAAOA,GAAQD,GAAKA,GAAKC,EAAOC,GAAOE,SAQxCC,KAMAC,KASAC,EAAU,SAASC,GAClB,IAAIC,KAKJ,GAJAlD,EAAES,KAAKwC,EAAK,SAASE,EAAGC,GACvBN,EAAWM,IAAOF,EAAQG,KAAKlD,EAAGmD,WAAWF,WACtCN,EAAWM,KAEfF,EAAQK,OACX,OAAOpD,EAAGqD,SACTC,MACCC,IAAK,UACLR,QAASA,EACTS,gBAAiB,KAEhBC,KAAK,SAAStD,GACZA,GAAOA,EAAI0C,SACdhD,EAAES,KAAKH,EAAI0C,QAAS,SAASa,EAAMb,GAClC,IAAIc,EAAM3D,EAAG4D,YAAYF,GACzBC,EAAIE,YA1HG,8BA2HPF,EAAId,EAAS,WAAa,eAAerB,QAO9CsC,EAAgB,KAOhBC,EAAe,WACd,IAAIjB,EAAMkB,OAAOC,KAAKtB,GAClBG,EAAIM,SACPU,GAAiBA,EAAcI,SAC/B3D,GAAiB4D,aAAa5D,GAC9BqC,KACAkB,EAAgB9D,EAAGoE,SAAS,SAASnB,GACpC,OAAOjD,EAAGqE,WAAWxE,EAAE,IAAIoD,IAAMA,EAAK,MACpCH,GAAOwB,WAAY,MACrBb,KAAK,SAASc,GACVA,EAAInB,SACPR,EAAiB2B,EACjBC,SAMJC,EAAiB,EAQjBD,EAAc,WACb,IAECxB,EAFG0B,EAAMzE,EAAK0E,eAAiBF,EAC/BG,EAAS5E,EAAG6E,WAAYC,KAAKC,IAAI/E,EAAG6E,WAAY5E,EAAK+E,eAAiB/E,EAAK+E,cAG5E,GADAzE,GAAiB0E,qBAAqB1E,GAClCqC,EAAeQ,OAClB,GAAIsB,EAAM,EACT,IAAK1B,EAAI,EAAGA,EAAI0B,EAAK1B,IAChBJ,EAAeQ,SAClBqB,IACA5B,EAAQD,EAAesC,OAAO,EAAGN,IAASO,OAAO,WAChDV,IACAD,YAKHjE,EAAgB6E,sBAAsB,WACrCxC,EAAeQ,QAAUoB,OAM7Ba,EAAOrF,EAAGiC,UAAUoD,KAOpBC,EAAgBzF,EAAE0F,QAAO,KAAUvF,EAAGiC,WAErCuD,KAAO,SAASC,EAAGC,GAClB,IAGChC,EAAMiC,EAHHC,EAAS/F,EAAEO,MACdyF,EAASH,EAAGG,OACZC,EAAShE,EAAM,IAAID,EAKpB,GAHA4D,EAAEM,kBACFF,EAAOvC,KAAK,WAAYuC,EAAOvC,KAAK,YAAc,GAClDsC,EAAItC,KAAK,YAAY,GACjBoC,EAAGG,OAAOvC,KAAK,eAAiBtD,EAAGgG,YAAehG,EAAGiG,eAAeR,EAAES,MAAOT,EAAEU,OAGlF,OAFAP,EAAI/B,YAAYiC,QAChBD,EAAOhC,YAAY,uDAGdxB,EAAaoD,EAAEW,UAIrBP,EAAOhC,YAAY,uDACnB+B,EAAIS,SAASvE,GACT8D,EAAIU,GAAG,IAAI9E,EAAU,SAASC,EAAS,MAC1CmE,EAAItC,KAAK,cAAeiD,WAAW,WAClCX,EAAIU,GAAG,IAAI9E,EAAU,IAAIM,IAAU8D,EAAIY,SAAS,IAAI7E,GAAO8E,QAAQ,UACjE,MAEAb,EAAIU,GAAG,6BACVV,EAAI/B,YAAYhC,IAIjB6B,EAAO1D,EAAGmD,WAAWyC,EAAIc,KAAK,OAC9Bd,EAAItC,KAAK,WAAYI,GACrB7D,EAAES,KAAKoF,EAAGG,OAAOvC,KAAK,SAAU,SAASN,EAAG2D,GAC3C,GAAIA,IAAMjD,GAAS1D,EAAG4G,KAAKD,GAAGE,QAAUnD,IAASgC,EAAGG,OAAOiB,SAAS,6BAEnE,OADAlB,EAAI/B,YAAYiC,IACT,IAGLD,EAAOvC,KAAK,UACfqC,EAAS,6BAETA,EAAS,6BACLF,EAAEsB,UAAYtB,EAAEuB,SAAWvB,EAAEwB,WAChCtB,GAAU,+BAGZC,EAAIkB,SAASjF,IAAagE,EAAOQ,SAASV,GAC1CP,sBAAsB,WAAYQ,EAAIkB,SAASjF,IAAagE,EAAOQ,SAASV,OAhC3EC,EAAI/B,YAAYiC,IAkClBoB,IAAM,SAASzB,EAAGC,GACjB,IAAIE,EAAS/F,EAAEO,MACdyF,EAASH,EAAGG,OACbJ,EAAEM,kBACE1D,EAAaoD,EAAEW,UAClBP,EAAOhC,YAAY,uDAEpBgC,EAAOvC,KAAK,WAAYwB,KAAKqC,IAAItB,EAAOvC,KAAK,YAAc,EAAG,IAC9DsC,EAAItC,KAAK,gBAAkBa,aAAayB,EAAItC,KAAK,gBACjDsC,EAAIwB,WAAW,YACXvD,YAAY/B,EAAM,IAAID,IAE3BwF,WAAa,WACZxH,EAAEO,MAAMgH,WAAW,YACXvD,YAAY/B,EAAM,IAAID,IAE/BwD,KAAO,SAASI,EAAGC,GAClBrD,EAAaoD,EAAEW,UAAYf,EAAKiC,KAAKlH,KAAMqF,EAAGC,MAIhD6B,EAAU1H,EAAEG,EAAGG,IAAI,MAAO,eAO1BqH,EAAMxH,EAAGG,IAAI,MAAO,UAOpBsH,EAAOzH,EAAGG,IAAI,MAAO,SAcrBuH,GAPO1H,EAAGG,IAAI,MAAO,QAOdH,EAAGG,IAAI,MAAO,YAOrBwH,KAOAC,GACC3E,GAAc,SAAS4E,GAAO,OAAO7H,EAAG8H,WAAWD,EAAInE,OACvDqE,KAAc,SAASF,GAAO,OAAO7H,EAAGgI,OAAOH,EAAII,KAAOJ,EAAIE,OAC9DG,SAAc,SAASL,GACtB,IAAIM,GAASN,EAAIhB,QAAWgB,EAAIO,OAAS,GAAKrH,GAAM,IAAIO,EAAO,IAAItB,EAAGqI,YAAYR,GAIlF,OAHAA,EAAIS,OAAST,EAAIU,OAASJ,GAAS,IAAM3G,KAA2B,GAAbqG,EAAIS,OAAeH,GAAS,+BACnFlI,EAAKuI,WAAaL,GAAS,IAAMlI,EAAKuI,SAASX,IAC/CA,EAAIY,SAAWN,GAAS,IAAMnI,EAAGgI,OAAOH,EAAIY,SACrCN,GAERO,MAAc,SAASb,GAAO,OAAO5H,EAAK0I,UAAY,WAAa3I,EAAGgI,OAAOhI,EAAG4I,KAAKf,EAAInE,MAAM,IAASmE,EAAII,KAAOJ,EAAIE,MAAQ,IAAO,IACtIhH,KAAc,SAAS8G,GACtB,IAAIgB,EAAM,GACV,OAAKhB,EAAIhB,OAASgB,EAAIO,QACrBS,GAAO,IAAI3G,GACN2F,EAAI9F,UAAY8F,EAAI9F,SAASqB,OAAS,EAC1CyF,GAAO,IAAI1G,EAAS,IAAIC,IAEkB,IAAtCvC,EAAEiJ,QAAQ,QAASjB,EAAI9F,YAC1B8G,GAAO,IAAI1G,IAE+B,IAAvCtC,EAAEiJ,QAAQ,SAAUjB,EAAI9F,YAC3B8G,GAAO,IAAIzG,IAGNyG,GAEA,IAGTE,YAAc,SAASlB,GAAO,OAAQA,EAAImB,MAASnB,EAAIoB,MAAe,GAAPxB,GAC/DyB,QAAc,SAASrB,GAAO,OAAOA,EAAIsB,MAAQzB,EAAO,IACxD0B,MAAc,SAASvB,GAAO,OAAOA,EAAIwB,KAAOrJ,EAAGsJ,aAAazB,GAAO,KASxE0B,EAAW,SAAS1B,GACnB,OAAOL,EAAII,QAAQ,qBAAsB,SAAS4B,EAAGC,GACpD,IAAItJ,EAAMyH,EAAQ6B,GAAO7B,EAAQ6B,GAAK5B,GAAQA,EAAI4B,IAAQ,GAI1D,MAHY,OAARA,IAA6B,GAAb5B,EAAIS,OACvB3F,EAAWxC,GAAOA,GAEZA,KAWTuJ,EAAS,SAASC,EAAOC,GACxB,OAAO/J,EAAEgK,IAAIF,MAAa,SAASG,GAClC,MAAmB,cAAXA,EAAEC,MAA0BH,IAAe5J,EAAG4D,YAAYkG,EAAEpG,MAAMN,OAAe,KAAJ0G,KAUvFE,EAAc,SAAStG,GACtB,OAAOA,EAAO1D,EAAG4D,YAAYF,GAAMuG,KAAK,IAAI5I,GAAW6I,IAWxDC,EAAc,SAAS9I,EAASwG,GAI/B,IAHA,IACCuC,EADGC,EAAOhJ,EAAQmF,SAAS,UAGrB6D,EAAKjH,QAAQ,CAGnB,GAFAgH,EAAOpK,EAAG4G,KAAK5G,EAAGmD,WAAWkH,EAAK7D,SAAS,QAAQE,KAAK,SAEnD0D,EAAOpK,EAAG4G,KAAK5G,EAAGmD,WAAWkH,EAAK7D,SAAS,QAAQE,KAAK,UAC1D4D,EAAQzC,EAAKuC,GAAQ,EACvB,OAAOC,EAERA,EAAOA,EAAKJ,OAEb,OAAO5I,EAAQmF,SAAS,sCASzB+D,EAAa,SAASjC,GAuKrB,IAtKA,IAmKCT,EAAW2C,EAAQC,EAASC,EAAiCC,EAAMN,EACnEO,EApKGxH,EAAUkF,EAAKlF,OAClByH,KACA7H,EAAII,EACJ0H,EAAOjL,IACP4D,KACAsH,EAAM/K,EAAG+K,MACTC,EAAS,SAASR,EAAQlC,EAAM2C,EAAOC,GACtC,IAAIC,KACHC,EAAW,EACXjE,EAAMnH,EAAGqL,OAAQvG,KAAKC,IAAI,IAAOD,KAAKqC,IAAI,GAAIlH,EAAKqL,aAAe,IAClEC,EAAY,WACXJ,KACAtL,EAAES,KAAKgI,EAAM,SAAStF,EAAGwI,GACxBL,EAAOK,EAAE9H,MAAQV,KAcnByI,EAAS,SAAShG,EAAGnC,GACpB,IAAOoI,EAZUC,GAajBlG,EAAEM,kBAEEzC,EAAKsI,QACRC,EAAOC,EAASxI,EAAKsI,SAIlBtI,EAAKyI,OAnBI,aADIJ,EAqBTrI,EAAKyI,QAnBZlM,EAAES,KAAKgI,EAAM,SAAStF,EAAGwI,GACxBA,EAAEnB,MAAQG,EAAOQ,OAAOQ,EAAEnB,KAAK2B,UAEb,SAATL,GACV9L,EAAES,KAAKgI,EAAM,SAAStF,EAAGwI,GACxBA,EAAEnB,MAAQmB,EAAEnB,KAAK4B,SAASC,UAkBxB5I,EAAK6I,SAAW7I,EAAK6I,QAAQ/I,SAChCkF,EAAOzI,EAAEuM,KAAK9D,EAAM,SAASkD,GAC5B,OAAsC,IAAlClI,EAAK6I,QAAQE,QAAQb,EAAE9H,SAGzBgI,IAAYA,GAAU,IAChB,MAKNpI,EAAKgJ,OAAShJ,EAAKgJ,MAAMlJ,SAC5BkF,EAAOA,EAAKiE,OAAO1M,EAAEuM,KAAK9I,EAAKgJ,MAAO,SAASd,GAC9C,YAAuB,IAAnBL,EAAOK,EAAE9H,SACXgI,IAAYA,GAAU,IAChB,OAMNA,IACHpD,EAAKkE,KAAKlC,GACViB,IACAM,EAAOT,MAGTU,EAAW,SAASW,GACnB,QAAuB,IAAnBtB,EAAOsB,GACV,OAAO3H,KAAK4H,MAAMvB,EAAOsB,GAAUtF,GAAOA,GAI5CsF,EAASzM,EAAGmD,WAAWqH,EAAOmC,KAAK,QAAQjG,KAAK,OAChDmF,EAAS,SAASZ,EAAOC,GACxB,IAEC0B,EAAOC,EAASC,EAAOH,EAAM1C,EAAM8C,EAASC,EAFzCC,KACHC,YAEMvF,EAAY8E,GACnBrB,EAAWH,EACXT,EAAO2C,IAAI,UAAUnN,EAAGgG,UAAWyF,GAC/BnD,EAAKlF,OAAS+D,IACjBqD,EAAO4C,GAAG,UAAUpN,EAAGgG,UAAWyF,QACpB,IAAVR,IACC,EACJM,SAEc,KADdN,EAAQa,EAASf,EAAIrH,SAEpBuH,EAAQ,IAGV6B,EAAQxE,EAAK+E,MAAMpC,EAAOA,EAAQ9D,GAClCQ,EAAY8E,GAAUjC,EACtBmC,EAAO1B,EAAOnG,KAAKqC,KAAK,EAAG8D,EAAQ9D,IAAQ,EAC3C8C,EAAQgB,EAAQ9D,GAAOmB,EAAKlF,OAAS,EAAI6H,EAAQ9D,EACjDyF,EAAQ9H,KAAKwI,KAAKhF,EAAKlF,OAAO+D,GAC9B0F,EAAO/H,KAAKwI,KAAKrC,EAAM9D,IAExBtH,EAAES,KAAKwM,GAASxE,EAAM,SAAStF,EAAGwI,GACjCyB,EAAK/J,KAAKqG,EAASiC,IACfA,EAAEnB,OACL6C,EAAM1B,EAAE9H,MAAQ8H,EAAEnB,QAInB0C,EADGJ,GAAQ,EACD9M,EAAE,sEACV0N,KAAKvN,EAAGwN,KAAK,cAAeX,EAAMD,IAClCa,QACAC,OACCC,QAAS,uBAGVP,GAAG,QAAS,SAAS3H,GACrBA,EAAEjC,iBACFiC,EAAEM,kBACF8F,EAAOc,EAAM,QAGL9M,IAGVmN,EADG/C,EACOpK,EAAE,sEACV0N,KAAKvN,EAAGwN,KAAK,UAAWX,EAAO,EAAGD,IAClCa,QACAC,OACCC,QAAS,uBAGVP,GAAG,QAAS,SAAS3H,GACrBA,EAAEjC,iBACFiC,EAAEM,kBACF8F,EAAO5B,EAAM,UAGLpK,IAEXoM,IACAzB,EAAOoD,QAAQd,EAAO,WAAa,eAAe,2BAA2B9B,OAAO+B,EAASE,EAAKY,KAAK,IAAKb,GAC5GnN,EAAES,KAAK4M,EAAO,SAASvG,EAAGmH,GACzB9N,EAAG4D,YAAY+C,GAAG6D,SAASuD,YAAYD,KAEpC5C,GACH8C,EAAWhO,EAAG8H,WAAWgF,EAAoB,OAAd5B,EAAoB4B,EAAM1J,OAAS,EAAI,GAAGM,QAExE9C,GAAUZ,EAAGiO,KAAK,WAAaC,GAAgB,KAAM1D,MAExDyB,EAAS,WACRpM,EAAES,KAAKkK,EAAOhE,SAAS,4BAA6B,SAASxD,EAAGW,GAC/D,IAECgD,EAAGhG,EAFAmN,EAAIjO,EAAE8D,GACTwK,EAAKL,EAAEtH,SAAS,cAEb2H,EAAGrH,SAASpF,KACfiF,EAAI3G,EAAGmD,WAAWgL,EAAGzH,KAAK,cACG,KAAnB/F,EAAIwK,EAAOxE,MACpB2B,EAAK3H,GAAG0J,KAAOyD,EAAE7B,aAMtBJ,KAEiCuC,KAAaC,KACtCC,KAEHtL,KAGFS,GAFJoE,EAAMS,EAAKtF,IAEEU,OAAS1D,EAAG4D,YAAYiE,EAAInE,MAAMN,SAG/CK,EAAKoE,EAAInE,OAAQ,GAEZ8G,EAASR,EAAYnC,EAAIhB,QAAQzD,aAEH,IAAvBkL,EADX1D,EAAU/C,EAAIhB,OAAS,cAEtByH,EAAU1D,GAAWJ,EAAOhE,SAAS,UAEtCkE,GAAQ4D,EAAU1D,GAASxH,OACvByE,EAAIhB,QAAU6D,GAAQF,EAAO1D,SAAS,6BAA+B2D,EAAUN,EAAYK,EAAQ3C,IAAMzE,QACxGsH,GACE0D,EAAOvG,EAAIhB,SACfuH,EAAOvG,EAAIhB,WAEZuH,EAAOvG,EAAIhB,OAAO3D,KAAK2E,IAEnB4C,GACHJ,EAAOd,EAAS1B,GAChB4C,EAAQ8D,OAAOlE,IACbzJ,IAAWkK,EAAOA,EAAK0D,IAAInE,KAE7BgE,EAAQnL,KAAK2E,IAIfwC,EAAOd,EAAS1B,GACZ6C,EACHF,EAAOiE,QAAQpE,GAEfiE,EAAU1D,GAAS8D,MAAMrE,GAErBxC,EAAIhB,QAASgB,EAAIO,SACrBuC,EAAO3K,EAAG4D,YAAYiE,EAAInE,MAAM8G,WAE/B5J,GAAUsN,GAAgB,KAAMvD,KAGnCE,EAAQ3H,KAAK2E,IAKX7D,OAAOC,KAAKmK,GAAQhL,QACvBvD,EAAES,KAAK8N,EAAQ,SAASO,EAAGrG,GAC1B,IAAIkC,EAASR,EAAY2E,GAEzBrG,EAAKkE,KAAKlC,GACVU,EAAOR,EAAQlC,KAIb+F,EAAQjL,QACXoH,EAAO/D,QAAQ,UAAYzG,EAAGgG,WAAasG,MAAQ+B,IAGhDxD,EAAQzH,QAAUyH,EAAQzH,OAASA,EACtCmH,EAAWM,IAIVjK,GAAUkK,EAAK1H,QAAUpD,EAAGiO,KAAK,WAAaC,GAAgBpD,MAQjER,EAAU,SAASsE,EAAMC,GACxB,GAAM7O,EAAG8O,iBAEF,CACN,IAGC3O,EAHG4O,EAAwB,OAAhB/O,EAAGgP,UACdC,EAAQjP,EAAGkP,SACXC,EAAQnP,EAAGoP,UAKZ,OAFAjP,EAAM4O,EAAKI,EAAMnP,EAAGkP,UAAUN,EAAMC,GAAQM,EAAMnP,EAAGkP,UAAUL,EAAMD,GAErD,SAATK,GAA2B,IAAR9O,EACvBA,EAAM4O,EAAMI,EAAMpH,KAAK6G,EAAMC,GAAQM,EAAMpH,KAAK8G,EAAMD,GACtDzO,EAXH,OAAOH,EAAGoP,UAAUrH,KAAK6G,EAAMC,IA2BjCb,EAAa,SAASvB,GACrB,IACC4C,EAAS7E,EAAQ8E,EAAKC,EAAOC,EAAQC,EADlCC,EAAO7P,EAAE8P,WA6Bb,OA3BAnP,GAAa2D,aAAa3D,GAC1BA,EAAY+F,WAAW,YACtB8I,EAAUxP,EAAE+P,SAASC,eAAgBpD,GAAUzM,EAAG8H,WAAW9H,EAAG+K,MAAMrH,SAC1DN,SAEVlC,EAASmO,EAAUA,EAAQ7E,UAAUsF,QAAQ,4BAA4BtJ,SAAS,IAAI9E,GAAQ2E,SAAS5E,GAAUwI,KAAK,IAAI5I,GAAS6K,OAEpI1B,EAASN,GAAKM,SAASuF,MAAK,GAAO,GACnCT,EAAM9E,EAAO/H,SAAS6M,IACtBC,EAAQ/E,EAAOwF,SACfR,EAASF,EAAMC,EAAQF,EAAQY,eAC/BR,EAASJ,EAAQ5M,SAAS6M,KAEbA,GAAOG,EAASD,EAC5BhF,EAAO0F,SACNC,UAAY3F,EAAO2F,YAAcV,EAASH,EAAMC,EAAQ,IAExDa,SAAWnQ,EAAKoQ,UAAUrC,WAC1BsC,SAAW,WAAaZ,EAAKa,aAG9Bb,EAAKa,WAGNb,EAAKc,UAEJ,KACId,GAQRe,EAAU,SAASjF,GAClB,IAEC3E,EAAO9F,EAAM8G,EAFV6I,EAAMlF,GAAKxL,EAAG+K,MACjB5K,EAAMuQ,EAAIhN,MAAQgN,EAAIhN,SAKvB,IAFA3C,EAAOf,EAAGe,KAAK2P,EAAIhN,MACnBmE,EAAM7H,EAAG4G,KAAK7F,GACP8G,IAAQhB,EAAQgB,EAAIhB,SAC1B1G,EAAIwQ,QAAQ9J,GACZ9F,EAAOf,EAAGe,KAAK8F,GACfgB,EAAM7H,EAAG4G,KAAK7F,IACVf,EAAG4D,YAAYiE,EAAInE,MAAMoD,SAASpF,MAKvC,OAAOvB,GASRyQ,GAAc,SAASvB,GACtB,IAAIqB,EAAMrB,GAAWrP,EAAG+K,MACvB8F,EAAUH,EAAIhN,KACd2G,EAAOrK,EAAG4D,YAAYiN,GAEvB,IAAKxG,EAAKjH,OAAQ,CACjB,KAAMsN,GAAOA,EAAI7J,OACZc,EAAY+I,EAAI7J,SAAW7G,EAAG4D,YAAY8M,EAAIhN,MAAMN,QACvDuE,EAAY+I,EAAI7J,OAAOJ,QAAQ,UAAUzG,EAAGgG,WAAa4F,OAAS8E,EAAIhN,OAEvEgN,EAAM1Q,EAAG4G,KAAK8J,EAAI7J,OAEnBwD,EAAOrK,EAAG4D,YAAYiN,GAGvB,OAAOxG,GAkBRyG,GAAO,SAASC,EAASC,GACxB,IA2JCC,EAAU1J,EAxJaM,EAErBqJ,EAeAC,EAAUC,EAhBPC,EAEHC,EANCvG,EAAU/K,EAAG+K,MAChBwG,EAAUxG,EAAIrH,KACd8N,OAAmB,IAATR,EAAkB5P,EAAW4P,EAmGvCvN,EAAM,SAAStD,EAAKuP,GACnB,IAWCL,EAXGoC,EAAO,WACLzQ,GAAYiQ,IACfjH,EAAYiH,EAASvN,MAAMwI,OAAOS,KAAKpL,GAAW8E,SAAS5E,GAC3DT,GAAW,GAERwQ,EACHxD,IAAavK,KAAKM,GAElBA,KAKC5D,GACHN,EAAES,KAAKH,EAAK,SAASuR,EAASpJ,GAC7BA,GAAQiC,EAAWjC,GACnBsI,GAAY5Q,EAAG4G,KAAK8K,IACpBpJ,GAAQqJ,GAAarJ,EAAM5G,KAIzBqP,IACF/Q,EAAG4R,IAAM,KAAQb,EAAQ7N,KAAK6H,GAC/BR,EAAWwG,KAIZ1B,EAAUuB,MAEG9J,SAASlF,KACrBsI,GAAK2H,KAAKtQ,EAAU,IAAIK,GAAQiC,YAAYjC,GAC5CyN,EAAQhJ,SAASzE,IAIlByN,EAAQS,QAAQ,4BAA4BtJ,SAAS,IAAIlF,GAAQ+E,SAAS3E,GAEtEvB,EACHH,EAAGiO,KAAKwD,GAAMhO,KAAK,WAClBiM,EAAKa,aAGNkB,IACA/B,EAAKa,YAGPuB,EAAY,SAASC,GAChBd,IACH1J,EAAQyK,SACRf,EAAS5K,SAAS7E,GAAauQ,EAAM,GAAM,IAAMrQ,MAGnDgO,EAAO7P,EAAE8P,WAwBV,OArBK3P,EAAG4D,YAAY2N,GAASnO,OAe5BK,OAAK,EAASiM,IAddjP,GAAU,GA1JL4Q,EAAOxR,EAAE8P,WAEZ2B,EAAOb,EAAQ5I,IAgBhBqJ,EAAOrR,EAAEgK,IAAIyH,EAAM,SAAS3K,GAC3B,IAYCsL,EAiBA1O,EA7BGiI,EAAIxL,EAAG4G,KAAKD,GACfuL,IAAS1G,GAAGxL,EAAGkS,OAAO1G,GACtBnB,EAAOrK,EAAG4D,YAAY+C,GACtBwL,EAAW,SAASxL,EAAGyL,GACtB,IAAI5G,EAAG6G,EACNC,EAAQF,GAAO,EAEhB,OADAC,KAAM7G,EAAIxL,EAAG4G,KAAKD,KAAK6E,EAAE3E,QACfyL,EAAQ,EACVH,EAASE,IAAMC,GAEhBD,GAGRE,EAAU,WACT,IAAI1L,EAAQsL,EAASxL,GAErB,IADAsL,EAAQpL,EACDA,IACF7G,EAAG4D,YAAYiD,GAAOC,SAASpF,IAGnCuQ,EAAQpL,EACRA,EAAQsL,EAAStL,GAMlB,OAJKA,IACJoL,OAAQ,EACRpL,EAAQ7G,EAAGe,KAAK4F,IAEVE,EAdE,GAkBX,OAAKwD,EAAKvD,SAASpF,KAAYwQ,GAAW1G,GAAMxL,EAAG4D,YAAY4H,EAAE3E,OAAOC,SAASpF,GAe1E,MAdFwQ,GAAUK,IAAYJ,EAASxL,IAAM4L,IAAYJ,EAASxL,EAAG,IAChEsL,OAAQ,EACR1O,EAAM,OACD2O,IACJvL,EAAIwL,EAASxL,KAGdpD,EAAM,UAEF4N,IACJA,EAAoB,SAAR5N,EAAiBoD,EAAI4L,GA1DzB,SAAShP,EAAKoD,EAAGsL,GAC1B,IAAI3O,GACFC,IAASA,EACTkJ,OAAS9F,GAKX,OAHIsL,IACH3O,EAAK2O,MAAQA,GAEPjS,EAAGqD,SACTC,KAAOA,EACPkP,aAAc,IAkDRC,CAAQlP,EAAKoD,EAAGsL,OAKhB7O,QACRwN,GAAY5Q,EAAG4G,KAAKuK,IACpBC,EAASpR,EAAG8H,WAAWqJ,GACvBK,GAAWxD,EAAWoD,GACtBH,EAAWpR,EAAE,IAAIuR,GACjB7J,EAAU1H,EAAEG,EAAGG,IAAI,MAAO,eAAeuS,aAAazB,EAASzK,SAAS,IAAI7E,IAC5EsP,EAASpN,YAAYrC,GAErB3B,EAAE8S,KAAKC,MAAM/S,EAAGqR,GACfzN,KAAK,WACL,IAAaH,EAAsBuP,EAAQ7P,EAAvC7C,KAEJ,IADA0S,EAASC,UAAU1P,QACN,EACZ,IAAKJ,EAAI,EAAGA,EAAI6P,EAAQ7P,IACvBM,EAAOwP,UAAU9P,GAAGkH,SACpB/J,EAAImR,EAAKtO,IAAMgB,OAAO+O,UAAWrJ,EAAOpG,IAG1C+N,EAAId,QAAQpQ,KAEZ4R,KAAK,WACLV,EAAIb,WAGEa,GAEAA,EAAId,WA8DZ9M,KAAK,SAAStD,GACdsD,EAAKtD,EAAKuP,GACVoC,MAEAC,KAAK,WACLD,GAAU,GACVpC,EAAKc,WAELrL,OAAO,WACP1E,GAAU,KAOZT,EAAGyG,QAAQ,WAAYiJ,GAEhBA,GAQRxB,GAAkB,SAASzB,EAAQpC,GAI7BoC,IACCpC,IAAQA,EAAKkI,QAAQ,OAAOrQ,GAAa4E,SAAS1E,KACrDiI,GAAQH,GAAK2H,KAAK,OAAOzP,IAAayP,KAAKtQ,EAAU,mCAAmC8E,SAAS,oBAGlGoG,GADIpC,GAAQA,EAAKkI,QAAQ,OAAOrQ,GAAa4E,SAAS3E,IAC5CkI,GAAQH,GAAK2H,KAAK,OAAO1P,IAAW0P,KAAKtQ,EAAU,SAASU,EAAU,KAEvEpC,IAENwK,GAEHA,EAAK7D,SAAS,OAAOtE,GAAa5B,KAAK,WACtC4N,GAAgB,KAAMrO,EAAEO,UAMvBqM,EAAOrJ,QACVpD,EAAGoE,SAAS,SAAST,GACpB9D,EAAE8D,GAAK1B,UAAUqD,IACfzF,EAAEmT,UAAUvG,IACdwG,SAAW,GACX3O,WAAa,OAYhBqN,GAAe,SAASrJ,EAAMO,GAC7B,IAAIqK,EAAMrK,GAAOnH,EACb,IAAIF,EAAU,SAASE,EAAO,IAC9B,SAASF,EAAU,IAEvB3B,EAAES,KAAKgI,EAAM,SAAStF,EAAG6E,GACxB7H,EAAG4D,YAAYiE,EAAIhB,OAAO6C,OAAOwJ,GAC/BxJ,OAAO,WAAa,OAAO7J,EAAEuM,KAAKvM,EAAEO,MAAM6J,KAAK,IAAI5I,GAASmF,WAAY,SAASsH,GACjF,OAAQjO,EAAEiO,GAAGtH,WAAWM,SAAS/F,KAC/BqC,OAAS,IACXiD,SAASwC,MAWbqB,GAAOrK,EAAEO,MAAMiG,SAASnG,GAEtBkN,GAAG,wBAAyB7L,EAAW,SAASkE,GAChD,IAAI0N,EAAoB,eAAX1N,EAAEwJ,KACf,IAAIkE,IAASC,GAAb,CACA,IACC1P,EAAMmE,EADHU,EAAQ1I,EAAEO,MAGTmI,EAAKzB,SAASjF,EAAS,IAAIE,KAC1BnB,IAAUuS,GAAU5K,EAAKjF,KAAK,iBAAoBiF,EAAKzB,SAAS/F,EAAK,IAAIiB,EAAU,8BACvFuG,EAAKjF,KAAK,gBAAgB,GACtBtD,EAAGqT,iBAAiB,OAAS3P,EAAO1D,EAAGmD,WAAWoF,EAAK7B,KAAK,SAC/D6B,EAAKvG,UAAUhC,EAAGgC,YAGpBuG,EAAK+K,YAAYxR,EAAOqR,IAGrBA,GAASlT,EAAK0I,aACjBd,EAAM7H,EAAG4G,KAAKlD,GAAQ1D,EAAGmD,WAAWoF,EAAK7B,KAAK,SACrC0B,QAAUG,EAAK7B,KAAK,YAAcmB,EAAII,KAAOJ,EAAIE,OACzDQ,EAAK7B,KAAK,QAAS1G,EAAG4I,KAAKlF,GAAM,QAKnC0J,GAAG,YAAa7L,EAAW,SAASkE,GACpC,GAAIA,EAAE8N,cAAcC,aAAc,CACjC,IAAI5N,EAAM/F,EAAEO,MACZwF,EAAIS,SAASvE,GACT8D,EAAIU,GAAG,IAAI9E,EAAU,SAASC,EAAS,MAC1CmE,EAAItC,KAAK,cAAeiD,WAAW,WAClCX,EAAIU,GAAG,IAAI9E,EAAU,IAAIM,IAAU8D,EAAIY,SAAS,IAAI7E,GAAO8E,QAAQ,UACjE,SAKL2G,GAAG,YAAa7L,EAAW,SAASkE,GACpC,GAAIA,EAAE8N,cAAcC,aAAc,CACjC,IAAI5N,EAAM/F,EAAEO,MACZwF,EAAItC,KAAK,gBAAkBa,aAAayB,EAAItC,KAAK,gBACjDsC,EAAI/B,YAAY/B,MAIjBsL,GAAG,QAAS7L,EAAW,SAASkE,GAChC,IAAI8C,EAAO1I,EAAEO,MACZsD,EAAO1D,EAAGmD,WAAWoF,EAAK7B,KAAK,OACxB1G,EAAG4G,KAAKlD,GAEhB,GAAI6E,EAAKjF,KAAK,WAGb,OAFAiF,EAAKnB,WAAW,gBAChB3B,EAAEM,kBAIEwC,EAAKzB,SAASlF,KAClBsI,GAAK2H,KAAKtQ,EAAU,IAAIK,GAAQiC,YAAYjC,GAC5C2G,EAAKlC,SAASzE,IAEX8B,GAAQ1D,EAAG+K,MAAMrH,MAAS6E,EAAKzB,SAAS/E,IAOvCwG,EAAKzB,SAAStF,GAGlBxB,EAAG4L,QAAQ6H,UAAW/P,GAAOgQ,OAAQ,YATrC1T,EAAG2T,KAAK,OAAQjQ,GAAMD,KAAK,WAC1BzD,EAAG4T,IAAI,WAAY,WAClB5T,EAAG4L,QAAQ6H,UAAW/P,GAAOgQ,OAAQ,iBAWxCtG,GAAG,aAAc7L,EAAW,SAASkE,GACrC,KAAIA,EAAE8N,cAAcM,QAAQzQ,OAAS,GAArC,CAGA,IACCuL,EADGmF,EAAMrO,EAAE8N,cAGc,UAAtB9N,EAAEgH,OAAOsH,SAKbpF,EAAI9O,EAAEO,MAAMiG,SAASvE,GACpBsF,WAAW,WACX9D,KAAK,YAAaiD,WAAW,SAASd,GAEtCkJ,EAAErL,KAAK,WAAW,GAClBtD,EAAGyG,QAAQ,eACVwI,KAAY,SACZlM,SAAa/C,EAAGmD,WAAWwL,EAAEjI,KAAK,QAClCpE,EAAYwR,EAAID,QAAQ,GAAG3N,MAC3B8N,EAAYF,EAAID,QAAQ,GAAG1N,SAE1B,MAfFV,EAAEM,qBAiBHqH,GAAG,qBAAsB7L,EAAW,SAASkE,GACnB,UAAtBA,EAAEgH,OAAOsH,UAIb5P,aAAatE,EAAEO,MAAMkD,KAAK,cAC1BzD,EAAEO,MAAMgH,WAAW,aACL,aAAV3B,EAAEwJ,MACLpP,EAAEO,MAAMyD,YAAY/B,IANpB2D,EAAEM,oBAUHqH,GAAG,QAAS7L,EAAU,IAAIC,EAAU,KAAKG,EAAO,SAAS8D,GACzD,IAAI9D,EAAQ9B,EAAEO,MACbmI,EAAQ5G,EAAM6I,OAAOjJ,GACrB0S,EAAQ1L,EAAK0B,KAAK,IAAI5I,GACtBqO,EAAQ7P,EAAE8P,WAGXlK,EAAEM,kBAEEwC,EAAKzB,SAASpF,IACjB6G,EAAK+K,YAAY7R,GACjBzB,EAAGiO,KAAK,YACD1F,EAAKzB,SAASrF,GAAWwS,EAAMzN,WAAWpD,OAAS6Q,EAAMpC,KAAK,6CAA6CrL,WAAWpD,OAAS6Q,EAAMpC,KAAK,eAAezO,QAPtJ,IASR6Q,EAAMC,SACNlU,EAAGmU,kBAAoBnU,EAAGmU,iBAAiB7Q,KAAK,mBAAoB,GACpES,KAEAkQ,EAAMlE,MAAK,GAAM,GAAMxH,EAAKzB,SAASrF,GAAW,YAAc,WAAWxB,EAAKoQ,UAAU+D,YAAa,WACpGpU,EAAGmU,kBAAoBnU,EAAGmU,iBAAiB7Q,KAAK,mBAAoB,GACpES,QAGAoB,OAAO,WACTuK,EAAKa,cAGNhJ,EAAQmL,aAAa/Q,GACrB4G,EAAK1E,YAAYrC,GAEjBxB,EAAGqD,SAASE,IAAM,OAAQkJ,OAASzM,EAAGmD,WAAWoF,EAAK7B,KAAK,SACzDjD,KAAK,SAASH,GACdiH,EAAWvG,OAAO+O,UAAWrJ,EAAOpG,EAAK4G,QAErC+J,EAAMzN,WAAWpD,SACpBmF,EAAKlC,SAAS7E,EAAU,IAAIC,GACxBwS,EAAMzN,WAAWpD,OA/Bd,IAgCN6Q,EAAM/H,OACNlM,EAAGmU,kBAAoBnU,EAAGmU,iBAAiB7Q,KAAK,mBAAoB,GACpES,KAEAkQ,EAAMlE,MAAK,GAAM,GAAMsE,UAAUpU,EAAKoQ,UAAU+D,YAAa,WAC5DpU,EAAGmU,kBAAoBnU,EAAGmU,iBAAiB7Q,KAAK,mBAAoB,GACpES,SAKHoB,OAAO,SAAS7B,GAChBiE,EAAQyK,SACRzJ,EAAKlC,SAAS3E,GACd1B,EAAG4T,IAAI,WAAY,WAClBlE,EAAKa,eAIT5O,EAAM2B,KAAK,OAAQoM,KAEnBtC,GAAG,cAAe7L,EAAW,SAASkE,GACtC,IAAI6O,EAAOzU,EAAEO,MAGTkU,EAAKzC,KAAK,cAAczO,OAC3BqC,EAAEM,mBAIHN,EAAEjC,iBAEG8Q,EAAKhR,KAAK,cACdtD,EAAGyG,QAAQ,eACVwI,KAAY,SACZlM,SAAa/C,EAAGmD,WAAWtD,EAAEO,MAAMsG,KAAK,QACxCpE,EAAYmD,EAAES,MACd8N,EAAYvO,EAAEU,QAGhBmO,EAAKjO,SAAS,kBAEdrG,EAAGuU,MAAM,eAAe/N,WAAW4G,GAAG,aAAc,WACnDkH,EAAKjO,SAAS,oBAGfrG,EAAGwU,KAAK,mBAAoB,WAC3BF,EAAKzQ,YAAY,uBAGlBuJ,GAAG,eAAgB7L,EAAW,SAASkE,EAAGnC,GAC1C,IAAIgR,EAAOzU,EAAEO,MACb4N,EAAWsG,EAAK5N,KAAK,OAAOjD,KAAK,WAC3BH,GAAuB,cAAfA,EAAKmR,QAAyBnR,EAAKmR,OAC/CzU,EAAG0U,UAAUD,MAAMH,EAAM,cAK3BlH,GAAG,UAAUpN,EAAGgG,UAAW,SAASP,EAAGkP,GACvC,IAAIC,EAAO5K,EAAY2K,EAAK9N,OAC3BgO,EAAOF,EAAKG,OAAQ,EACpBjN,EAAOhI,EAAE0J,EAASoL,IAAOtO,SAAS,+BAClCoN,EAAWzT,EAAGyT,WAEfoB,GAAQpB,EAASrQ,QAAUpD,EAAGyG,QAAQ,aAAckD,MAAO8J,IAC3DmB,EAAKnG,QAAQ5G,KAEfuL,IAAY,EAGZ5Q,GAASxC,EAAGuU,MAAM,UAAUvJ,OAAOd,IAAMgC,OAAOkB,GAAG,SAAU,WAC5DgG,IAAY,EACZ1S,GAAeuE,qBAAqBvE,GACpCA,EAAc0E,sBAAsB,WACnCgO,IAAY,EACZrP,QAIFgR,GAAmB/U,EAAG8O,iBAEvB9O,EAAGyR,KAAK,SAAShM,GAChB,IAAInC,EAAOmC,EAAEnC,KACZgF,EAAOoB,EAAOpG,EAAKqG,OACnBqL,EAAchV,EAAGuU,MAAM,eAExBjR,EAAKoH,MAAQR,GAAK0D,QAEd5N,EAAGa,GAAGoU,KACTzS,GAAOqB,YAAY,4BAA4BwC,SAAS,4BAGrDiC,EAAKlF,OACRpD,EAAGiO,KAAK,WACF+G,EAAY1R,KAAK,YACrB0R,EAAY1R,KAAK,cAElBiH,EAAWjC,GACXqJ,GAAarJ,EAAM5G,GACnBoP,GAAKxI,KAGNwI,OAIDtC,IAAI,SAAS/I,GACb,IAAI6C,EAAOoB,EAAOjE,EAAEnC,KAAKgJ,OAErBhE,EAAKlF,SACRmH,EAAWjC,GACXqJ,GAAarJ,EAAM9G,MAIpBuK,OAAO,SAAStG,GAEhB,IAAIhF,EAAJ,CAIA,IAKCoH,EAAKhB,EAAOwD,EAAM6K,EAAKC,EAAYC,EAAWC,EAAaC,EAAYC,EAAYC,EAAUhL,EAAQ3H,EALlGyF,EAAOoB,EAAOjE,EAAEnC,KAAKoI,SAAS,GACjCtI,EAASkF,EAAKlF,OACdqS,EAAOrS,EACAvD,IAQR,IAJAA,EAAES,KAAKqH,EAAa,SAAShB,EAAG0D,GAC/BA,EAAK5D,QAAQ,UAAUzG,EAAGgG,WAAa+F,OAAQ,cAGzC0J,KAGN,GADA5O,GADAgB,EAAMS,EAAKmN,IACC5O,OACPwD,EAAOrK,EAAG4D,YAAYiE,EAAInE,OAAON,OAAQ,CAE7C,GADAoH,EAASH,EAAKG,SACV3D,EAAO,CAMV,GALAsO,EAAc9K,EAAKkI,QAAQ,IAAIlR,GAC/B+T,EAAcpL,EAAYnD,GAC1BwO,EAAchL,EAAKG,SAASP,OAC5BqL,EAAcnL,EAAYiL,EAAWvN,IAEhCuN,EAAUhS,OACd,SAGGgS,EAAU,KAAOD,EAAW,IAAME,EAAYK,IAAI,KAAOJ,EAAWI,IAAI,KAC3EJ,EAAWlS,OAASkS,EAAW/G,OAAO/D,GAAU4K,EAAUpK,OAAOR,IAGnE+K,EAAalL,EAAKvD,SAASrF,GAC3B+T,EAAanL,EAAKvD,SAASpF,GAC3BwT,EAAarV,EAAE0J,EAAS1B,IACxBwC,EAAK0D,YAAYmH,EAAI1O,SAASjF,KAC5BX,GAAUsN,GAAgB,KAAM1D,GAE9B3C,EAAIS,OACJiN,GAAcC,KACdnL,EAAOrK,EAAG4D,YAAYiE,EAAInE,QAC3B2G,EAAKJ,KAAK,IAAI5I,GAASmF,WAAWpD,SACpCmS,GAAclL,EAAKhE,SAAS5E,GAC5B+T,GAAYnL,EAAKhE,SAAS3E,IAG3BmB,IAAwB,GAAbgF,EAAIS,KAKbzF,GACHkB,IAGDlE,EAAES,KAAKqH,EAAa,SAAShB,EAAG0D,GAC/BA,EAAK5D,QAAQ,UAAUzG,EAAGgG,WAAa+F,OAAQ,WAGhD3I,GAAU0N,QAAK,GAAS,MAGxBkB,OAAO,SAASvM,GAChB,IAEC4E,EAAM4J,EAAO9H,EAFV7D,EAAO7C,EAAEnC,KAAK6I,QACjBsJ,EAAOnN,EAAKlF,OAQb,IALAvD,EAAES,KAAKqH,EAAa,SAAShB,EAAG0D,GAC/BA,EAAK5D,QAAQ,UAAUzG,EAAGgG,WAAamG,QAAU7D,IACjD+B,EAAK5D,QAAQ,UAAUzG,EAAGgG,WAAa+F,OAAQ,cAGzC0J,MACDpL,EAAOrK,EAAG4D,YAAY0E,EAAKmN,KAAKrS,SACpC+I,GAAU,EACV8H,EAAQ5J,EAAKkI,QAAQ,IAAIlR,GACzBgJ,EAAKG,SAASyB,SACTgI,EAAMzN,WAAWpD,QACrB6Q,EAAMjI,OAAOW,KAAKpL,GAAWsC,YAAYrC,EAAU,IAAIC,EAAS,IAAIC,IAKvEyK,GAAWnM,EAAGuU,MAAM,UAAU/N,SAAS,wBAAwBC,QAAQ,UAEvE5G,EAAES,KAAKqH,EAAa,SAAShB,EAAG0D,GAC/BA,EAAK5D,QAAQ,UAAUzG,EAAGgG,WAAa+F,OAAQ,aAIhDyI,KAAK,wBAAyB,SAAS/O,GACvC,IAAIoP,EAAiB,aAAVpP,EAAEwJ,KACZ0G,IAAelQ,EAAEnC,KAAKuC,QAAQJ,EAAEnC,KAAKuC,OAAOvC,KAAK,UACjDsS,EAAQf,IAASc,EAAgB,UAAY,SAC7CrN,EAAOzI,EAAEuM,KAAK3G,EAAEnC,KAAKqG,UAAW,SAAShD,GACxC,IAAIkB,EAAM7H,EAAG4G,KAAKD,GAClB,SAAOkB,GAAmB,aAAZA,EAAIkC,QAGpBlK,EAAES,KAAKgI,EAAM,SAAStF,EAAGU,GACxB,IAAImE,EAAM7H,EAAG4D,YAAYF,GAErBmE,EAAIzE,SAAWuS,IAClB9N,EAAIf,SAAS9E,IAAc6F,EAAI7F,UAAU4T,GACzC/N,EAAIf,SAAS7E,IAAc4F,EAAI5F,UAAU2T,GACzC/N,EAAIgN,EAAO,WAAa,eAAe9S,QAIzCyS,KAAK,aAAc,WACnB,GAAIxU,EAAG8O,kBAAoBiG,KAAqB/U,EAAG8O,iBAAkB,CACpE,IAAIxG,EACHgJ,KACAuE,KACAC,KACAC,EAAS,GACTC,GAAS,EAGVhW,EAAGiO,KAAK,WACP3F,EAAOoB,EAAO1J,EAAG2J,SACjBoL,GAAmB/U,EAAG8O,iBAEtB5E,GAAK0D,QAGLrD,EAAW1K,EAAEgK,IAAI7J,EAAGiW,MAAO,SAAStP,GACnC,IAAIkB,EAAM7H,EAAG4G,KAAKD,GAClB,OAAOkB,IAAQA,EAAIhB,MAAOgB,EAAM,QAG5B7D,OAAOC,KAAK0D,GAAavE,SAK7BkO,EAAOb,KACErN,OAAS,GACjBvD,EAAES,KAAKgR,EAAM,SAAStO,EAAGkT,GACxB,IAAIC,EAAMnW,EAAG4G,KAAK5G,EAAGe,KAAKmV,IAAME,SACtB,IAANpT,IACH+S,EAASI,GAEVL,EAAQK,GAAOD,EACfL,EAAQK,QAETrW,EAAES,KAAKgI,EAAM,SAAStF,EAAGwI,GACxB,IAAKA,EAAE4K,SAEN,OADAJ,GAAS,GACF,EAERH,EAAQC,EAAQtK,EAAE4K,WAAaN,EAAQC,IAAS7S,KAAKsI,MAGtDwK,GAAS,EAENA,EACHnW,EAAES,KAAKgR,EAAM,SAAStO,EAAG0O,GACxBnH,EAAWjC,GACDsI,GAAY5Q,EAAG4G,KAAK8K,IAC9BC,GAAarJ,EAAM5G,KAGpB7B,EAAES,KAAKuV,EAAS,SAASnE,EAASpJ,GACjCiC,EAAWjC,GACDsI,GAAY5Q,EAAG4G,KAAK8K,IAC9BC,GAAarJ,EAAM5G,OAlCrB6I,EAAWjC,GACDsI,KACVe,GAAarJ,EAAM5G,IAqCpBoP,MACE,UAMC1Q,MAIDP","file":"../../ui/tree.js","sourcesContent":["define([\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder folders tree\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindertree = function(fm, opts) {\n\t\t\"use strict\";\n\t\tvar treeclass = fm.res('class', 'tree');\n\t\t\n\t\tthis.not('.'+treeclass).each(function() {\n\n\t\t\tvar c = 'class', mobile = fm.UA.Mobile,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Root directory class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\troot      = fm.res(c, 'treeroot'),\n\n\t\t\t\t/**\n\t\t\t\t * Open root dir if not opened yet\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\topenRoot  = opts.openRootOnLoad,\n\n\t\t\t\t/**\n\t\t\t\t * Open current work dir if not opened yet\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\topenCwd   = opts.openCwdOnOpen,\n\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Auto loading current directory parents and do expand their node\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\tsyncTree  = openCwd || opts.syncTree,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Subtree class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tsubtree   = fm.res(c, 'navsubtree'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tnavdir    = fm.res(c, 'treedir'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory CSS selector\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tselNavdir = 'span.' + navdir,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Collapsed arrow class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tcollapsed = fm.res(c, 'navcollapse'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Expanded arrow class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\texpanded  = fm.res(c, 'navexpand'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Class name to mark arrow for directory with already loaded children\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tloaded    = 'elfinder-subtree-loaded',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Class name to mark need subdirs request\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tchksubdir = 'elfinder-subtree-chksubdir',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Arraw class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tarrow = fm.res(c, 'navarrow'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Current directory class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tactive    = fm.res(c, 'active'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable dirs dropover class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdropover = fm.res(c, 'adroppable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Hover class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\thover    = fm.res(c, 'hover'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disabled dir class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdisabled = fm.res(c, 'disabled'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Draggable dir class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdraggable = fm.res(c, 'draggable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable dir  class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdroppable = fm.res(c, 'droppable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * root wrapper class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\twrapperRoot = 'elfinder-navbar-wrapper-root',\n\n\t\t\t\t/**\n\t\t\t\t * Un-disabled cmd `paste` volume's root wrapper class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tpastable = 'elfinder-navbar-wrapper-pastable',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Un-disabled cmd `upload` volume's root wrapper class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tuploadable = 'elfinder-navbar-wrapper-uploadable',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Is position x inside Navbar\n\t\t\t\t * \n\t\t\t\t * @param x Numbar\n\t\t\t\t * \n\t\t\t\t * @return\n\t\t\t\t */\n\t\t\t\tinsideNavbar = function(x) {\n\t\t\t\t\tvar left = navbar.offset().left;\n\t\t\t\t\t\t\n\t\t\t\t\treturn left <= x && x <= left + navbar.width();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * To call subdirs elements queue\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tsubdirsQue = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * To exec subdirs elements ids\n\t\t\t\t * \n\t\t\t\t */\n\t\t\t\tsubdirsExecQue = [],\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Request subdirs to backend\n\t\t\t\t * \n\t\t\t\t * @param id String\n\t\t\t\t * \n\t\t\t\t * @return Deferred\n\t\t\t\t */\n\t\t\t\tsubdirs = function(ids) {\n\t\t\t\t\tvar targets = [];\n\t\t\t\t\t$.each(ids, function(i, id) {\n\t\t\t\t\t\tsubdirsQue[id] && targets.push(fm.navId2Hash(id));\n\t\t\t\t\t\tdelete subdirsQue[id];\n\t\t\t\t\t});\n\t\t\t\t\tif (targets.length) {\n\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcmd: 'subdirs',\n\t\t\t\t\t\t\t\ttargets: targets,\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).done(function(res) {\n\t\t\t\t\t\t\tif (res && res.subdirs) {\n\t\t\t\t\t\t\t\t$.each(res.subdirs, function(hash, subdirs) {\n\t\t\t\t\t\t\t\t\tvar elm = fm.navHash2Elm(hash);\n\t\t\t\t\t\t\t\t\telm.removeClass(chksubdir);\n\t\t\t\t\t\t\t\t\telm[subdirs? 'addClass' : 'removeClass'](collapsed);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tsubdirsJobRes = null,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * To check target element is in window of subdirs\n\t\t\t\t * \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tcheckSubdirs = function() {\n\t\t\t\t\tvar ids = Object.keys(subdirsQue);\n\t\t\t\t\tif (ids.length) {\n\t\t\t\t\t\tsubdirsJobRes && subdirsJobRes._abort();\n\t\t\t\t\t\texecSubdirsTm && clearTimeout(execSubdirsTm);\n\t\t\t\t\t\tsubdirsExecQue = [];\n\t\t\t\t\t\tsubdirsJobRes = fm.asyncJob(function(id) {\n\t\t\t\t\t\t\treturn fm.isInWindow($('#'+id))? id : null;\n\t\t\t\t\t\t}, ids, { numPerOnce: 200 })\n\t\t\t\t\t\t.done(function(arr) {\n\t\t\t\t\t\t\tif (arr.length) {\n\t\t\t\t\t\t\t\tsubdirsExecQue = arr;\n\t\t\t\t\t\t\t\texecSubdirs();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tsubdirsPending = 0,\n\t\t\t\texecSubdirsTm,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Exec subdirs as batch request\n\t\t\t\t * \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\texecSubdirs = function() {\n\t\t\t\t\tvar cnt = opts.subdirsMaxConn - subdirsPending,\n\t\t\t\t\t\tatOnce = fm.maxTargets? Math.min(fm.maxTargets, opts.subdirsAtOnce) : opts.subdirsAtOnce,\n\t\t\t\t\t\ti, ids;\n\t\t\t\t\texecSubdirsTm && cancelAnimationFrame(execSubdirsTm);\n\t\t\t\t\tif (subdirsExecQue.length) {\n\t\t\t\t\t\tif (cnt > 0) {\n\t\t\t\t\t\t\tfor (i = 0; i < cnt; i++) {\n\t\t\t\t\t\t\t\tif (subdirsExecQue.length) {\n\t\t\t\t\t\t\t\t\tsubdirsPending++;\n\t\t\t\t\t\t\t\t\tsubdirs(subdirsExecQue.splice(0, atOnce)).always(function() {\n\t\t\t\t\t\t\t\t\t\tsubdirsPending--;\n\t\t\t\t\t\t\t\t\t\texecSubdirs();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texecSubdirsTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tsubdirsExecQue.length && execSubdirs();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tdrop = fm.droppable.drop,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable options\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tdroppableopts = $.extend(true, {}, fm.droppable, {\n\t\t\t\t\t// show subfolders on dropover\n\t\t\t\t\tover : function(e, ui) {\n\t\t\t\t\t\tvar dst    = $(this),\n\t\t\t\t\t\t\thelper = ui.helper,\n\t\t\t\t\t\t\tcl     = hover+' '+dropover,\n\t\t\t\t\t\t\thash, status;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\thelper.data('dropover', helper.data('dropover') + 1);\n\t\t\t\t\t\tdst.data('dropover', true);\n\t\t\t\t\t\tif (ui.helper.data('namespace') !== fm.namespace || ! fm.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\t\t\tdst.removeClass(cl);\n\t\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (! insideNavbar(e.clientX)) {\n\t\t\t\t\t\t\tdst.removeClass(cl);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\tdst.addClass(hover);\n\t\t\t\t\t\tif (dst.is('.'+collapsed+':not(.'+expanded+')')) {\n\t\t\t\t\t\t\tdst.data('expandTimer', setTimeout(function() {\n\t\t\t\t\t\t\t\tdst.is('.'+collapsed+'.'+hover) && dst.children('.'+arrow).trigger('click');\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dst.is('.elfinder-ro,.elfinder-na')) {\n\t\t\t\t\t\t\tdst.removeClass(dropover);\n\t\t\t\t\t\t\t//helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thash = fm.navId2Hash(dst.attr('id'));\n\t\t\t\t\t\tdst.data('dropover', hash);\n\t\t\t\t\t\t$.each(ui.helper.data('files'), function(i, h) {\n\t\t\t\t\t\t\tif (h === hash || (fm.file(h).phash === hash && !ui.helper.hasClass('elfinder-drag-helper-plus'))) {\n\t\t\t\t\t\t\t\tdst.removeClass(cl);\n\t\t\t\t\t\t\t\treturn false; // break $.each\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (helper.data('locked')) {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-plus';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-move';\n\t\t\t\t\t\t\tif (e.shiftKey || e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\t\t\tstatus += ' elfinder-drag-helper-plus';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdst.hasClass(dropover) && helper.addClass(status);\n\t\t\t\t\t\trequestAnimationFrame(function(){ dst.hasClass(dropover) && helper.addClass(status); });\n\t\t\t\t\t},\n\t\t\t\t\tout : function(e, ui) {\n\t\t\t\t\t\tvar dst    = $(this),\n\t\t\t\t\t\t\thelper = ui.helper;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (insideNavbar(e.clientX)) {\n\t\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t}\n\t\t\t\t\t\thelper.data('dropover', Math.max(helper.data('dropover') - 1, 0));\n\t\t\t\t\t\tdst.data('expandTimer') && clearTimeout(dst.data('expandTimer'));\n\t\t\t\t\t\tdst.removeData('dropover')\n\t\t\t\t\t\t   .removeClass(hover+' '+dropover);\n\t\t\t\t\t},\n\t\t\t\t\tdeactivate : function() {\n\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t       .removeClass(hover+' '+dropover);\n\t\t\t\t\t},\n\t\t\t\t\tdrop : function(e, ui) {\n\t\t\t\t\t\tinsideNavbar(e.clientX) && drop.call(this, e, ui);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\t\n\t\t\t\tspinner = $(fm.res('tpl', 'navspinner')),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\ttpl = fm.res('tpl', 'navdir'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Permissions marker html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tptpl = fm.res('tpl', 'perms'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Lock marker html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tltpl = fm.res('tpl', 'lock'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Symlink marker html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tstpl = fm.res('tpl', 'symlink'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory hashes that has more pages\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\thasMoreDirs = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Html template replacement methods\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\treplace = {\n\t\t\t\t\tid          : function(dir) { return fm.navHash2Id(dir.hash); },\n\t\t\t\t\tname        : function(dir) { return fm.escape(dir.i18 || dir.name); },\n\t\t\t\t\tcssclass    : function(dir) {\n\t\t\t\t\t\tvar cname = (dir.phash && ! dir.isroot ? '' : root)+' '+navdir+' '+fm.perms2class(dir);\n\t\t\t\t\t\tdir.dirs && !dir.link && (cname += ' ' + collapsed) && dir.dirs == -1 && (cname += ' ' + chksubdir);\n\t\t\t\t\t\topts.getClass && (cname += ' ' + opts.getClass(dir));\n\t\t\t\t\t\tdir.csscls && (cname += ' ' + fm.escape(dir.csscls));\n\t\t\t\t\t\treturn cname;\n\t\t\t\t\t},\n\t\t\t\t\ttitle       : function(dir) { return opts.attrTitle? (' title=\"' + fm.escape(fm.path(dir.hash, true) || dir.i18 || dir.name) + '\"') : ''; },\n\t\t\t\t\troot        : function(dir) {\n\t\t\t\t\t\tvar cls = '';\n\t\t\t\t\t\tif (!dir.phash || dir.isroot) {\n\t\t\t\t\t\t\tcls += ' '+wrapperRoot;\n\t\t\t\t\t\t\tif (!dir.disabled || dir.disabled.length < 1) {\n\t\t\t\t\t\t\t\tcls += ' '+pastable+' '+uploadable;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ($.inArray('paste', dir.disabled) === -1) {\n\t\t\t\t\t\t\t\t\tcls += ' '+pastable;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ($.inArray('upload', dir.disabled) === -1) {\n\t\t\t\t\t\t\t\t\tcls += ' '+uploadable;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn cls;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tpermissions : function(dir) { return !dir.read || !dir.write ? ptpl : ''; },\n\t\t\t\t\tsymlink     : function(dir) { return dir.alias ? stpl : ''; },\n\t\t\t\t\tstyle       : function(dir) { return dir.icon ? fm.getIconStyle(dir) : ''; }\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return html for given dir\n\t\t\t\t *\n\t\t\t\t * @param  Object  directory\n\t\t\t\t * @return String\n\t\t\t\t */\n\t\t\t\titemhtml = function(dir) {\n\t\t\t\t\treturn tpl.replace(/(?:\\{([a-z]+)\\})/ig, function(m, key) {\n\t\t\t\t\t\tvar res = replace[key] ? replace[key](dir) : (dir[key] || '');\n\t\t\t\t\t\tif (key === 'id' && dir.dirs == -1) {\n\t\t\t\t\t\t\tsubdirsQue[res] = res;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return only dirs from files list\n\t\t\t\t *\n\t\t\t\t * @param  Array   files list\n\t\t\t\t * @param  Boolean do check exists\n\t\t\t\t * @return Array\n\t\t\t\t */\n\t\t\t\tfilter = function(files, checkExists) {\n\t\t\t\t\treturn $.map(files || [], function(f) {\n\t\t\t\t\t\treturn (f.mime === 'directory' && (!checkExists || fm.navHash2Elm(f.hash).length)) ? f : null;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Find parent subtree for required directory\n\t\t\t\t *\n\t\t\t\t * @param  String  dir hash\n\t\t\t\t * @return jQuery\n\t\t\t\t */\n\t\t\t\tfindSubtree = function(hash) {\n\t\t\t\t\treturn hash ? fm.navHash2Elm(hash).next('.'+subtree) : tree;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Find directory (wrapper) in required node\n\t\t\t\t * before which we can insert new directory\n\t\t\t\t *\n\t\t\t\t * @param  jQuery  parent directory\n\t\t\t\t * @param  Object  new directory\n\t\t\t\t * @return jQuery\n\t\t\t\t */\n\t\t\t\tfindSibling = function(subtree, dir) {\n\t\t\t\t\tvar node = subtree.children(':first'),\n\t\t\t\t\t\tinfo;\n\n\t\t\t\t\twhile (node.length) {\n\t\t\t\t\t\tinfo = fm.file(fm.navId2Hash(node.children('[id]').attr('id')));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((info = fm.file(fm.navId2Hash(node.children('[id]').attr('id')))) \n\t\t\t\t\t\t&& compare(dir, info) < 0) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = node.next();\n\t\t\t\t\t}\n\t\t\t\t\treturn subtree.children('button.elfinder-navbar-pager-next');\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Add new dirs in tree\n\t\t\t\t *\n\t\t\t\t * @param  Array  dirs list\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tupdateTree = function(dirs) {\n\t\t\t\t\tvar length  = dirs.length,\n\t\t\t\t\t\torphans = [],\n\t\t\t\t\t\ti = length,\n\t\t\t\t\t\ttgts = $(),\n\t\t\t\t\t\tdone = {},\n\t\t\t\t\t\tcwd = fm.cwd(),\n\t\t\t\t\t\tappend = function(parent, dirs, start, direction) {\n\t\t\t\t\t\t\tvar hashes = {},\n\t\t\t\t\t\t\t\tcurStart = 0,\n\t\t\t\t\t\t\t\tmax = fm.newAPI? Math.min(10000, Math.max(10, opts.subTreeMax)) : 10000,\n\t\t\t\t\t\t\t\tsetHashes = function() {\n\t\t\t\t\t\t\t\t\thashes = {};\n\t\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\thashes[d.hash] = i;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchange = function(mode) {\n\t\t\t\t\t\t\t\t\tif (mode === 'prepare') {\n\t\t\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\t\td.node && parent.append(d.node.hide());\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (mode === 'done') {\n\t\t\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\t\td.node && d.node.detach().show();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdate = function(e, data) {\n\t\t\t\t\t\t\t\t\tvar i, changed;\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.select) {\n\t\t\t\t\t\t\t\t\t\trender(getStart(data.select));\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.change) {\n\t\t\t\t\t\t\t\t\t\tchange(data.change);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.removed && data.removed.length) {\n\t\t\t\t\t\t\t\t\t\tdirs = $.grep(dirs, function(d) {\n\t\t\t\t\t\t\t\t\t\t\tif (data.removed.indexOf(d.hash) === -1) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t!changed && (changed = true);\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tdirs = dirs.concat($.grep(data.added, function(d) {\n\t\t\t\t\t\t\t\t\t\t\tif (hashes[d.hash] === void(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\t!changed && (changed = true);\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (changed) {\n\t\t\t\t\t\t\t\t\t\tdirs.sort(compare);\n\t\t\t\t\t\t\t\t\t\tsetHashes();\n\t\t\t\t\t\t\t\t\t\trender(curStart);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tgetStart = function(target) {\n\t\t\t\t\t\t\t\t\tif (hashes[target] !== void(0)) {\n\t\t\t\t\t\t\t\t\t\treturn Math.floor(hashes[target] / max) * max;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn void(0);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttarget = fm.navId2Hash(parent.prev('[id]').attr('id')),\n\t\t\t\t\t\t\t\trender = function(start, direction) {\n\t\t\t\t\t\t\t\t\tvar html = [],\n\t\t\t\t\t\t\t\t\t\tnodes = {},\n\t\t\t\t\t\t\t\t\t\ttotal, page, s, parts, prev, next, prevBtn, nextBtn;\n\t\t\t\t\t\t\t\t\tdelete hasMoreDirs[target];\n\t\t\t\t\t\t\t\t\tcurStart = start;\n\t\t\t\t\t\t\t\t\tparent.off('update.'+fm.namespace, update);\n\t\t\t\t\t\t\t\t\tif (dirs.length > max) {\n\t\t\t\t\t\t\t\t\t\tparent.on('update.'+fm.namespace, update);\n\t\t\t\t\t\t\t\t\t\tif (start === void(0)) {\n\t\t\t\t\t\t\t\t\t\t\ts = 0;\n\t\t\t\t\t\t\t\t\t\t\tsetHashes();\n\t\t\t\t\t\t\t\t\t\t\tstart = getStart(cwd.hash);\n\t\t\t\t\t\t\t\t\t\t\tif (start === void(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\tstart = 0;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tparts = dirs.slice(start, start + max);\n\t\t\t\t\t\t\t\t\t\thasMoreDirs[target] = parent;\n\t\t\t\t\t\t\t\t\t\tprev = start? Math.max(-1, start - max) : -1;\n\t\t\t\t\t\t\t\t\t\tnext = (start + max >= dirs.length)? 0 : start + max;\n\t\t\t\t\t\t\t\t\t\ttotal = Math.ceil(dirs.length/max);\n\t\t\t\t\t\t\t\t\t\tpage = Math.ceil(start/max);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$.each(parts || dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\thtml.push(itemhtml(d));\n\t\t\t\t\t\t\t\t\t\tif (d.node) {\n\t\t\t\t\t\t\t\t\t\t\tnodes[d.hash] = d.node;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (prev > -1) {\n\t\t\t\t\t\t\t\t\t\tprevBtn = $('<button class=\"elfinder-navbar-pager elfinder-navbar-pager-prev\"/>')\n\t\t\t\t\t\t\t\t\t\t\t.text(fm.i18n('btnPrevious', page, total))\n\t\t\t\t\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprimary: \"ui-icon-caret-1-n\"\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\trender(prev, 'up');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tprevBtn = $();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (next) {\n\t\t\t\t\t\t\t\t\t\tnextBtn = $('<button class=\"elfinder-navbar-pager elfinder-navbar-pager-next\"/>')\n\t\t\t\t\t\t\t\t\t\t\t.text(fm.i18n('btnNext', page + 2, total))\n\t\t\t\t\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprimary: \"ui-icon-caret-1-s\"\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\trender(next, 'down');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tnextBtn = $();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdetach();\n\t\t\t\t\t\t\t\t\tparent.empty()[parts? 'addClass' : 'removeClass']('elfinder-navbar-hasmore').append(prevBtn, html.join(''), nextBtn);\n\t\t\t\t\t\t\t\t\t$.each(nodes, function(h, n) {\n\t\t\t\t\t\t\t\t\t\tfm.navHash2Elm(h).parent().replaceWith(n);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (direction) {\n\t\t\t\t\t\t\t\t\t\tautoScroll(fm.navHash2Id(parts[direction === 'up'? parts.length - 1 : 0].hash));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t! mobile && fm.lazy(function() { updateDroppable(null, parent); });\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdetach = function() {\n\t\t\t\t\t\t\t\t\t$.each(parent.children('.elfinder-navbar-wrapper'), function(i, elm) {\n\t\t\t\t\t\t\t\t\t\tvar n = $(elm),\n\t\t\t\t\t\t\t\t\t\t\tch = n.children('[id]:first'),\n\t\t\t\t\t\t\t\t\t\t\th, c;\n\t\t\t\t\t\t\t\t\t\tif (ch.hasClass(loaded)) {\n\t\t\t\t\t\t\t\t\t\t\th = fm.navId2Hash(ch.attr('id'));\n\t\t\t\t\t\t\t\t\t\t\tif (h && (c = hashes[h]) !== void(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\tdirs[c].node = n.detach();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\trender();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdir, html, parent, sibling, init, atonce = {}, updates = [], base, node,\n\t\t\t\t\t\tlastKey, lastNodes = {};\n\t\t\t\t\t\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tdir = dirs[i];\n\n\t\t\t\t\t\tif (done[dir.hash] || fm.navHash2Elm(dir.hash).length) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone[dir.hash] = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((parent = findSubtree(dir.phash)).length) {\n\t\t\t\t\t\t\tlastKey = dir.phash || 'treeroot';\n\t\t\t\t\t\t\tif (typeof lastNodes[lastKey] === 'undefined') {\n\t\t\t\t\t\t\t\tlastNodes[lastKey] = parent.children(':last');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinit = !lastNodes[lastKey].length;\n\t\t\t\t\t\t\tif (dir.phash && (init || parent.hasClass('elfinder-navbar-hasmore') || (sibling = findSibling(parent, dir)).length)) {\n\t\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\t\tif (!atonce[dir.phash]) {\n\t\t\t\t\t\t\t\t\t\tatonce[dir.phash] = [];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tatonce[dir.phash].push(dir);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\t\t\t\tnode = itemhtml(dir);\n\t\t\t\t\t\t\t\t\t\tsibling.before(node);\n\t\t\t\t\t\t\t\t\t\t! mobile && (tgts = tgts.add(node));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tupdates.push(dir);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnode = itemhtml(dir);\n\t\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\t\tparent.prepend(node);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlastNodes[lastKey].after(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!dir.phash || dir.isroot) {\n\t\t\t\t\t\t\t\t\tbase = fm.navHash2Elm(dir.hash).parent();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t! mobile && updateDroppable(null, base);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\torphans.push(dir);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// When init, html append at once\n\t\t\t\t\tif (Object.keys(atonce).length){\n\t\t\t\t\t\t$.each(atonce, function(p, dirs){\n\t\t\t\t\t\t\tvar parent = findSubtree(p),\n\t\t\t\t\t\t\t    html   = [];\n\t\t\t\t\t\t\tdirs.sort(compare);\n\t\t\t\t\t\t\tappend(parent, dirs);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (updates.length) {\n\t\t\t\t\t\tparent.trigger('update.' + fm.namespace, { added : updates });\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (orphans.length && orphans.length < length) {\n\t\t\t\t\t\tupdateTree(orphans);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} \n\t\t\t\t\t\n\t\t\t\t\t! mobile && tgts.length && fm.lazy(function() { updateDroppable(tgts); });\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * sort function by dir.name\n\t\t\t\t * \n\t\t\t\t */\n\t\t\t\tcompare = function(dir1, dir2) {\n\t\t\t\t\tif (! fm.sortAlsoTreeview) {\n\t\t\t\t\t\treturn fm.sortRules.name(dir1, dir2);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar asc   = fm.sortOrder == 'asc',\n\t\t\t\t\t\t\ttype  = fm.sortType,\n\t\t\t\t\t\t\trules = fm.sortRules,\n\t\t\t\t\t\t\tres;\n\t\t\t\t\t\t\n\t\t\t\t\t\tres = asc? rules[fm.sortType](dir1, dir2) : rules[fm.sortType](dir2, dir1);\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn type !== 'name' && res === 0\n\t\t\t\t\t\t\t? res = asc ? rules.name(dir1, dir2) : rules.name(dir2, dir1)\n\t\t\t\t\t\t\t: res;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * Timer ID of autoScroll\n\t\t\t\t * \n\t\t\t\t * @type  Integer\n\t\t\t\t */\n\t\t\t\tautoScrTm,\n\n\t\t\t\t/**\n\t\t\t\t * Auto scroll to cwd\n\t\t\t\t *\n\t\t\t\t * @return Object  jQuery Deferred\n\t\t\t\t */\n\t\t\t\tautoScroll = function(target) {\n\t\t\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\t\t\tcurrent, parent, top, treeH, bottom, tgtTop;\n\t\t\t\t\tautoScrTm && clearTimeout(autoScrTm);\n\t\t\t\t\tautoScrTm = setTimeout(function() {\n\t\t\t\t\t\tcurrent = $(document.getElementById((target || fm.navHash2Id(fm.cwd().hash))));\n\t\t\t\t\t\tif (current.length) {\n\t\t\t\t\t\t\t// expand parents directory\n\t\t\t\t\t\t\t(openCwd? current : current.parent()).parents('.elfinder-navbar-wrapper').children('.'+loaded).addClass(expanded).next('.'+subtree).show();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tparent = tree.parent().stop(false, true);\n\t\t\t\t\t\t\ttop = parent.offset().top;\n\t\t\t\t\t\t\ttreeH = parent.height();\n\t\t\t\t\t\t\tbottom = top + treeH - current.outerHeight();\n\t\t\t\t\t\t\ttgtTop = current.offset().top;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (tgtTop < top || tgtTop > bottom) {\n\t\t\t\t\t\t\t\tparent.animate({\n\t\t\t\t\t\t\t\t\tscrollTop : parent.scrollTop() + tgtTop - top - treeH / 3\n\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\tduration : opts.durations.autoScroll,\n\t\t\t\t\t\t\t\t\tcomplete : function() {\tdfrd.resolve(); }\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100);\n\t\t\t\t\treturn dfrd;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Get hashes array of items of the bottom of the leaf root back from the target\n\t\t\t\t * \n\t\t\t\t * @param Object elFinder item(directory) object\n\t\t\t\t * @return Array hashes\n\t\t\t\t */\n\t\t\t\tgetEnds = function(d) {\n\t\t\t\t\tvar cur = d || fm.cwd(),\n\t\t\t\t\t\tres = cur.hash? [ cur.hash ] : [],\n\t\t\t\t\t\tphash, root, dir;\n\t\t\t\t\t\n\t\t\t\t\troot = fm.root(cur.hash);\n\t\t\t\t\tdir = fm.file(root);\n\t\t\t\t\twhile (dir && (phash = dir.phash)) {\n\t\t\t\t\t\tres.unshift(phash);\n\t\t\t\t\t\troot = fm.root(phash);\n\t\t\t\t\t\tdir = fm.file(root);\n\t\t\t\t\t\tif (fm.navHash2Elm(dir.hash).hasClass(loaded)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn res;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Select pages back in order to display the target\n\t\t\t\t * \n\t\t\t\t * @param Object elFinder item(directory) object\n\t\t\t\t * @return Object jQuery node object of target node\n\t\t\t\t */\n\t\t\t\tselectPages = function(current) {\n\t\t\t\t\tvar cur = current || fm.cwd(),\n\t\t\t\t\t\tcurHash = cur.hash,\n\t\t\t\t\t\tnode = fm.navHash2Elm(curHash);\n\t\t\t\t\n\t\t\t\t\tif (!node.length) {\n\t\t\t\t\t\twhile(cur && cur.phash) {\n\t\t\t\t\t\t\tif (hasMoreDirs[cur.phash] && !fm.navHash2Elm(cur.hash).length) {\n\t\t\t\t\t\t\t\thasMoreDirs[cur.phash].trigger('update.'+fm.namespace, { select : cur.hash });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcur = fm.file(cur.phash);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = fm.navHash2Elm(curHash);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Flag indicating that synchronization is currently in progress\n\t\t\t\t * \n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\tsyncing,\n\n\t\t\t\t/**\n\t\t\t\t * Mark current directory as active\n\t\t\t\t * If current directory is not in tree - load it and its parents\n\t\t\t\t *\n\t\t\t\t * @param Array directory objects of cwd\n\t\t\t\t * @param Boolean do auto scroll\n\t\t\t\t * @return Object jQuery Deferred\n\t\t\t\t */\n\t\t\t\tsync = function(cwdDirs, aScr) {\n\t\t\t\t\tvar cwd     = fm.cwd(),\n\t\t\t\t\t\tcwdhash = cwd.hash,\n\t\t\t\t\t\tautoScr = aScr === void(0)? syncTree : aScr,\n\t\t\t\t\t\tloadParents = function(dir) {\n\t\t\t\t\t\t\tvar dfd  = $.Deferred(),\n\t\t\t\t\t\t\t\treqs = [],\n\t\t\t\t\t\t\t\tends = getEnds(dir),\n\t\t\t\t\t\t\t\tmakeReq = function(cmd, h, until) {\n\t\t\t\t\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\t\t\t\t\tcmd    : cmd,\n\t\t\t\t\t\t\t\t\t\t\ttarget : h\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tif (until) {\n\t\t\t\t\t\t\t\t\t\tdata.until = until;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : data,\n\t\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseHash, baseId;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treqs = $.map(ends, function(h) {\n\t\t\t\t\t\t\t\tvar d = fm.file(h),\n\t\t\t\t\t\t\t\t\tisRoot = d? fm.isRoot(d) : false,\n\t\t\t\t\t\t\t\t\tnode = fm.navHash2Elm(h),\n\t\t\t\t\t\t\t\t\tgetPhash = function(h, dep) {\n\t\t\t\t\t\t\t\t\t\tvar d, ph,\n\t\t\t\t\t\t\t\t\t\t\tdepth = dep || 1;\n\t\t\t\t\t\t\t\t\t\tph = (d = fm.file(h))? d.phash : false;\n\t\t\t\t\t\t\t\t\t\tif (ph && depth > 1) {\n\t\t\t\t\t\t\t\t\t\t\treturn getPhash(ph, --depth);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn ph;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuntil,\n\t\t\t\t\t\t\t\t\tclosest = (function() {\n\t\t\t\t\t\t\t\t\t\tvar phash = getPhash(h);\n\t\t\t\t\t\t\t\t\t\tuntil = phash;\n\t\t\t\t\t\t\t\t\t\twhile (phash) {\n\t\t\t\t\t\t\t\t\t\t\tif (fm.navHash2Elm(phash).hasClass(loaded)) {\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tuntil = phash;\n\t\t\t\t\t\t\t\t\t\t\tphash = getPhash(phash);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!phash) {\n\t\t\t\t\t\t\t\t\t\t\tuntil = void(0);\n\t\t\t\t\t\t\t\t\t\t\tphash = fm.root(h);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn phash;\n\t\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t\t\tcmd;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (!node.hasClass(loaded) && (isRoot || !d || !fm.navHash2Elm(d.phash).hasClass(loaded))) {\n\t\t\t\t\t\t\t\t\tif (isRoot || closest === getPhash(h) || closest === getPhash(h, 2)) {\n\t\t\t\t\t\t\t\t\t\tuntil = void(0);\n\t\t\t\t\t\t\t\t\t\tcmd = 'tree';\n\t\t\t\t\t\t\t\t\t\tif (!isRoot) {\n\t\t\t\t\t\t\t\t\t\t\th = getPhash(h);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcmd = 'parents';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!baseHash) {\n\t\t\t\t\t\t\t\t\t\tbaseHash = (cmd === 'tree')? h : closest;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn makeReq(cmd, h, until);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (reqs.length) {\n\t\t\t\t\t\t\t\tselectPages(fm.file(baseHash));\n\t\t\t\t\t\t\t\tbaseId = fm.navHash2Id(baseHash);\n\t\t\t\t\t\t\t\tautoScr && autoScroll(baseId);\n\t\t\t\t\t\t\t\tbaseNode = $('#'+baseId);\n\t\t\t\t\t\t\t\tspinner = $(fm.res('tpl', 'navspinner')).insertBefore(baseNode.children('.'+arrow));\n\t\t\t\t\t\t\t\tbaseNode.removeClass(collapsed);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$.when.apply($, reqs)\n\t\t\t\t\t\t\t\t.done(function() {\n\t\t\t\t\t\t\t\t\tvar res = {},data, treeDirs, dirs, argLen, i;\n\t\t\t\t\t\t\t\t\targLen = arguments.length;\n\t\t\t\t\t\t\t\t\tif (argLen > 0) {\n\t\t\t\t\t\t\t\t\t\tfor (i = 0; i < argLen; i++) {\n\t\t\t\t\t\t\t\t\t\t\tdata = arguments[i].tree || [];\n\t\t\t\t\t\t\t\t\t\t\tres[ends[i]] = Object.assign([], filter(data));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdfd.resolve(res);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn dfd.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdone= function(res, dfrd) {\n\t\t\t\t\t\t\tvar open = function() {\n\t\t\t\t\t\t\t\t\tif (openRoot && baseNode) {\n\t\t\t\t\t\t\t\t\t\tfindSubtree(baseNode.hash).show().prev(selNavdir).addClass(expanded);\n\t\t\t\t\t\t\t\t\t\topenRoot = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (autoScr) {\n\t\t\t\t\t\t\t\t\t\tautoScroll().done(checkSubdirs);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcurrent;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t$.each(res, function(endHash, dirs) {\n\t\t\t\t\t\t\t\t\tdirs && updateTree(dirs);\n\t\t\t\t\t\t\t\t\tselectPages(fm.file(endHash));\n\t\t\t\t\t\t\t\t\tdirs && updateArrows(dirs, loaded);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (cwdDirs) {\n\t\t\t\t\t\t\t\t(fm.api < 2.1) && cwdDirs.push(cwd);\n\t\t\t\t\t\t\t\tupdateTree(cwdDirs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// set current node\n\t\t\t\t\t\t\tcurrent = selectPages();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!current.hasClass(active)) {\n\t\t\t\t\t\t\t\ttree.find(selNavdir+'.'+active).removeClass(active);\n\t\t\t\t\t\t\t\tcurrent.addClass(active);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// mark as loaded to cwd parents\n\t\t\t\t\t\t\tcurrent.parents('.elfinder-navbar-wrapper').children('.'+navdir).addClass(loaded);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\tfm.lazy(open).done(function() {\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topen();\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trmSpinner = function(fail) {\n\t\t\t\t\t\t\tif (baseNode) {\n\t\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t\t\tbaseNode.addClass(collapsed + (fail? '' : (' ' + loaded)));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\t\tbaseNode, spinner;\n\t\t\t\t\t\n\t\t\t\t\tif (!fm.navHash2Elm(cwdhash).length) {\n\t\t\t\t\t\tsyncing = true;\n\t\t\t\t\t\tloadParents()\n\t\t\t\t\t\t.done(function(res) {\n\t\t\t\t\t\t\tdone(res, dfrd);\n\t\t\t\t\t\t\trmSpinner();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function() { \n\t\t\t\t\t\t\trmSpinner(true);\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tsyncing = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdone(void(0), dfrd);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// trigger 'treesync' with my $.Deferred\n\t\t\t\t\tfm.trigger('treesync', dfrd);\n\n\t\t\t\t\treturn dfrd;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Make writable and not root dirs droppable\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tupdateDroppable = function(target, node) {\n\t\t\t\t\tvar limit = 100,\n\t\t\t\t\t\tnext;\n\t\t\t\t\t\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tif (!node || node.closest('div.'+wrapperRoot).hasClass(uploadable)) {\n\t\t\t\t\t\t\t(node || tree.find('div.'+uploadable)).find(selNavdir+':not(.elfinder-ro,.elfinder-na)').addClass('native-droppable');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!node || node.closest('div.'+wrapperRoot).hasClass(pastable)) {\n\t\t\t\t\t\t\ttarget = (node || tree.find('div.'+pastable)).find(selNavdir+':not(.'+droppable+')');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget = $();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\t// check leaf roots\n\t\t\t\t\t\t\tnode.children('div.'+wrapperRoot).each(function() {\n\t\t\t\t\t\t\t\tupdateDroppable(null, $(this));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// make droppable on async\n\t\t\t\t\tif (target.length) {\n\t\t\t\t\t\tfm.asyncJob(function(elm) {\n\t\t\t\t\t\t\t$(elm).droppable(droppableopts);\n\t\t\t\t\t\t}, $.makeArray(target), {\n\t\t\t\t\t\t\tinterval : 20,\n\t\t\t\t\t\t\tnumPerOnce : 100\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Check required folders for subfolders and update arrow classes\n\t\t\t\t *\n\t\t\t\t * @param  Array  folders to check\n\t\t\t\t * @param  String css class \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tupdateArrows = function(dirs, cls) {\n\t\t\t\t\tvar sel = cls == loaded\n\t\t\t\t\t\t\t? '.'+collapsed+':not(.'+loaded+')'\n\t\t\t\t\t\t\t: ':not(.'+collapsed+')';\n\t\t\t\t\t\n\t\t\t\t\t$.each(dirs, function(i, dir) {\n\t\t\t\t\t\tfm.navHash2Elm(dir.phash).filter(sel)\n\t\t\t\t\t\t\t.filter(function() { return $.grep($(this).next('.'+subtree).children(), function(n) {\n\t\t\t\t\t\t\t\treturn ($(n).children().hasClass(root))? false : true;\n\t\t\t\t\t\t\t}).length > 0; })\n\t\t\t\t\t\t\t.addClass(cls);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Navigation tree\n\t\t\t\t *\n\t\t\t\t * @type JQuery\n\t\t\t\t */\n\t\t\t\ttree = $(this).addClass(treeclass)\n\t\t\t\t\t// make dirs draggable and toggle hover class\n\t\t\t\t\t.on('mouseenter mouseleave', selNavdir, function(e) {\n\t\t\t\t\t\tvar enter = (e.type === 'mouseenter');\n\t\t\t\t\t\tif (enter && scrolling) { return; }\n\t\t\t\t\t\tvar link  = $(this),\n\t\t\t\t\t\t\thash, dir; \n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!link.hasClass(dropover+' '+disabled)) {\n\t\t\t\t\t\t\tif (!mobile && enter && !link.data('dragRegisted') && !link.hasClass(root+' '+draggable+' elfinder-na elfinder-wo')) {\n\t\t\t\t\t\t\t\tlink.data('dragRegisted', true);\n\t\t\t\t\t\t\t\tif (fm.isCommandEnabled('copy', (hash = fm.navId2Hash(link.attr('id'))))) {\n\t\t\t\t\t\t\t\t\tlink.draggable(fm.draggable);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlink.toggleClass(hover, enter);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// update title attr if necessary\n\t\t\t\t\t\tif (enter && opts.attrTitle) {\n\t\t\t\t\t\t\tdir = fm.file(hash || fm.navId2Hash(link.attr('id')));\n\t\t\t\t\t\t\tif (!dir.isroot && link.attr('title') === (dir.i18 || dir.name)) {\n\t\t\t\t\t\t\t\tlink.attr('title', fm.path(hash, true));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// native drag enter\n\t\t\t\t\t.on('dragenter', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar dst = $(this);\n\t\t\t\t\t\t\tdst.addClass(hover);\n\t\t\t\t\t\t\tif (dst.is('.'+collapsed+':not(.'+expanded+')')) {\n\t\t\t\t\t\t\t\tdst.data('expandTimer', setTimeout(function() {\n\t\t\t\t\t\t\t\t\tdst.is('.'+collapsed+'.'+hover) && dst.children('.'+arrow).trigger('click');\n\t\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// native drag leave\n\t\t\t\t\t.on('dragleave', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar dst = $(this);\n\t\t\t\t\t\t\tdst.data('expandTimer') && clearTimeout(dst.data('expandTimer'));\n\t\t\t\t\t\t\tdst.removeClass(hover);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// open dir or open subfolders in tree\n\t\t\t\t\t.on('click', selNavdir, function(e) {\n\t\t\t\t\t\tvar link = $(this),\n\t\t\t\t\t\t\thash = fm.navId2Hash(link.attr('id')),\n\t\t\t\t\t\t\tfile = fm.file(hash);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (link.data('longtap')) {\n\t\t\t\t\t\t\tlink.removeData('longtap');\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!link.hasClass(active)) {\n\t\t\t\t\t\t\ttree.find(selNavdir+'.'+active).removeClass(active);\n\t\t\t\t\t\t\tlink.addClass(active);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hash != fm.cwd().hash && !link.hasClass(disabled)) {\n\t\t\t\t\t\t\tfm.exec('open', hash).done(function() {\n\t\t\t\t\t\t\t\tfm.one('opendone', function() {\n\t\t\t\t\t\t\t\t\tfm.select({selected: [hash], origin: 'navbar'});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (link.hasClass(collapsed)) {\n\t\t\t\t\t\t\t\t//link.children('.'+arrow).trigger('click');  // modified by lwf\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.select({selected: [hash], origin: 'navbar'});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// for touch device\n\t\t\t\t\t.on('touchstart', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar evt = e.originalEvent,\n\t\t\t\t\t\t\tp;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (e.target.nodeName === 'INPUT') {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tp = $(this).addClass(hover)\n\t\t\t\t\t\t.removeData('longtap')\n\t\t\t\t\t\t.data('tmlongtap', setTimeout(function(e){\n\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\tp.data('longtap', true);\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t'type'    : 'navbar',\n\t\t\t\t\t\t\t\t'targets' : [fm.navId2Hash(p.attr('id'))],\n\t\t\t\t\t\t\t\t'x'       : evt.touches[0].pageX,\n\t\t\t\t\t\t\t\t'y'       : evt.touches[0].pageY\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 500));\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchmove touchend', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.target.nodeName === 'INPUT') {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclearTimeout($(this).data('tmlongtap'));\n\t\t\t\t\t\t$(this).removeData('tmlongtap');\n\t\t\t\t\t\tif (e.type == 'touchmove') {\n\t\t\t\t\t\t\t$(this).removeClass(hover);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// toggle subfolders in tree\n\t\t\t\t\t.on('click', selNavdir+'.'+collapsed+' .'+arrow, function(e) {\n\t\t\t\t\t\tvar arrow = $(this),\n\t\t\t\t\t\t\tlink  = arrow.parent(selNavdir),\n\t\t\t\t\t\t\tstree = link.next('.'+subtree),\n\t\t\t\t\t\t\tdfrd  = $.Deferred(),\n\t\t\t\t\t\t\tslideTH = 30, cnt;\n\n\t\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\t\tif (link.hasClass(loaded)) {\n\t\t\t\t\t\t\tlink.toggleClass(expanded);\n\t\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t\tcnt = link.hasClass(expanded)? stree.children().length + stree.find('div.elfinder-navbar-subtree[style*=block]').children().length : stree.find('div:visible').length;\n\t\t\t\t\t\t\t\tif (cnt > slideTH) {\n\t\t\t\t\t\t\t\t\tstree.toggle();\n\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tstree.stop(true, true)[link.hasClass(expanded)? 'slideDown' : 'slideUp'](opts.durations.slideUpDown, function(){\n\t\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tspinner.insertBefore(arrow);\n\t\t\t\t\t\t\tlink.removeClass(collapsed);\n\n\t\t\t\t\t\t\tfm.request({cmd : 'tree', target : fm.navId2Hash(link.attr('id'))})\n\t\t\t\t\t\t\t\t.done(function(data) { \n\t\t\t\t\t\t\t\t\tupdateTree(Object.assign([], filter(data.tree))); \n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (stree.children().length) {\n\t\t\t\t\t\t\t\t\t\tlink.addClass(collapsed+' '+expanded);\n\t\t\t\t\t\t\t\t\t\tif (stree.children().length > slideTH) {\n\t\t\t\t\t\t\t\t\t\t\tstree.show();\n\t\t\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tstree.stop(true, true).slideDown(opts.durations.slideUpDown, function(){\n\t\t\t\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t\t\t\tlink.addClass(loaded);\n\t\t\t\t\t\t\t\t\tfm.one('treedone', function() {\n\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tarrow.data('dfrd', dfrd);\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu', selNavdir, function(e) {\n\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now dirname editing\n\t\t\t\t\t\tif (self.find('input:text').length) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tif (!self.data('tmlongtap')) {\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t'type'    : 'navbar',\n\t\t\t\t\t\t\t\t'targets' : [fm.navId2Hash($(this).attr('id'))],\n\t\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.getUI('contextmenu').children().on('mouseenter', function() {\n\t\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.bind('closecontextmenu', function() {\n\t\t\t\t\t\t\tself.removeClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('scrolltoview', selNavdir, function(e, data) {\n\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\tautoScroll(self.attr('id')).done(function() {\n\t\t\t\t\t\t\tif (!data || data.blink === 'undefined' || data.blink) {\n\t\t\t\t\t\t\t\tfm.resources.blink(self, 'lookme');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t// prepend fake dir\n\t\t\t\t\t.on('create.'+fm.namespace, function(e, item) {\n\t\t\t\t\t\tvar pdir = findSubtree(item.phash),\n\t\t\t\t\t\t\tlock = item.move || false,\n\t\t\t\t\t\t\tdir  = $(itemhtml(item)).addClass('elfinder-navbar-wrapper-tmp'),\n\t\t\t\t\t\t\tselected = fm.selected();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tlock && selected.length && fm.trigger('lockfiles', {files: selected});\n\t\t\t\t\t\tpdir.prepend(dir);\n\t\t\t\t\t}),\n\t\t\t\tscrolling = false,\n\t\t\t\tnavbarScrTm,\n\t\t\t\t// move tree into navbar\n\t\t\t\tnavbar = fm.getUI('navbar').append(tree).show().on('scroll', function() {\n\t\t\t\t\tscrolling = true;\n\t\t\t\t\tnavbarScrTm && cancelAnimationFrame(navbarScrTm);\n\t\t\t\t\tnavbarScrTm = requestAnimationFrame(function() {\n\t\t\t\t\t\tscrolling = false;\n\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t\t\n\t\t\t\tprevSortTreeview = fm.sortAlsoTreeview;\n\t\t\t\t\n\t\t\tfm.open(function(e) {\n\t\t\t\tvar data = e.data,\n\t\t\t\t\tdirs = filter(data.files),\n\t\t\t\t\tcontextmenu = fm.getUI('contextmenu');\n\n\t\t\t\tdata.init && tree.empty();\n\n\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\tnavbar.removeClass('overflow-scrolling-touch').addClass('overflow-scrolling-touch');\n\t\t\t\t}\n\n\t\t\t\tif (dirs.length) {\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tif (!contextmenu.data('cmdMaps')) {\n\t\t\t\t\t\t\tcontextmenu.data('cmdMaps', {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\tsync(dirs);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsync();\n\t\t\t\t}\n\t\t\t})\n\t\t\t// add new dirs\n\t\t\t.add(function(e) {\n\t\t\t\tvar dirs = filter(e.data.added);\n\n\t\t\t\tif (dirs.length) {\n\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\tupdateArrows(dirs, collapsed);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// update changed dirs\n\t\t\t.change(function(e) {\n\t\t\t\t// do ot perfome while syncing\n\t\t\t\tif (syncing) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar dirs = filter(e.data.changed, true),\n\t\t\t\t\tlength = dirs.length,\n\t\t\t\t\tl    = length,\n\t\t\t\t\ttgts = $(),\n\t\t\t\t\tchanged = {},\n\t\t\t\t\tdir, phash, node, tmp, realParent, reqParent, realSibling, reqSibling, isExpanded, isLoaded, parent, subdirs;\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'prepare' });\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\twhile (l--) {\n\t\t\t\t\tdir = dirs[l];\n\t\t\t\t\tphash = dir.phash;\n\t\t\t\t\tif ((node = fm.navHash2Elm(dir.hash)).length) {\n\t\t\t\t\t\tparent = node.parent();\n\t\t\t\t\t\tif (phash) {\n\t\t\t\t\t\t\trealParent  = node.closest('.'+subtree);\n\t\t\t\t\t\t\treqParent   = findSubtree(phash);\n\t\t\t\t\t\t\trealSibling = node.parent().next();\n\t\t\t\t\t\t\treqSibling  = findSibling(reqParent, dir);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!reqParent.length) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (reqParent[0] !== realParent[0] || realSibling.get(0) !== reqSibling.get(0)) {\n\t\t\t\t\t\t\t\treqSibling.length ? reqSibling.before(parent) : reqParent.append(parent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tisExpanded = node.hasClass(expanded);\n\t\t\t\t\t\tisLoaded   = node.hasClass(loaded);\n\t\t\t\t\t\ttmp        = $(itemhtml(dir));\n\t\t\t\t\t\tnode.replaceWith(tmp.children(selNavdir));\n\t\t\t\t\t\t! mobile && updateDroppable(null, parent);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (dir.dirs\n\t\t\t\t\t\t&& (isExpanded || isLoaded) \n\t\t\t\t\t\t&& (node = fm.navHash2Elm(dir.hash))\n\t\t\t\t\t\t&& node.next('.'+subtree).children().length) {\n\t\t\t\t\t\t\tisExpanded && node.addClass(expanded);\n\t\t\t\t\t\t\tisLoaded && node.addClass(loaded);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsubdirs |= dir.dirs == -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// to check subdirs\n\t\t\t\tif (subdirs) {\n\t\t\t\t\tcheckSubdirs();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'done' });\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tlength && sync(void(0), false);\n\t\t\t})\n\t\t\t// remove dirs\n\t\t\t.remove(function(e) {\n\t\t\t\tvar dirs = e.data.removed,\n\t\t\t\t\tl    = dirs.length,\n\t\t\t\t\tnode, stree, removed;\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { removed : dirs });\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'prepare' });\n\t\t\t\t});\n\n\t\t\t\twhile (l--) {\n\t\t\t\t\tif ((node = fm.navHash2Elm(dirs[l])).length) {\n\t\t\t\t\t\tremoved = true;\n\t\t\t\t\t\tstree = node.closest('.'+subtree);\n\t\t\t\t\t\tnode.parent().detach();\n\t\t\t\t\t\tif (!stree.children().length) {\n\t\t\t\t\t\t\tstree.hide().prev(selNavdir).removeClass(collapsed+' '+expanded+' '+loaded);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tremoved && fm.getUI('navbar').children('.ui-resizable-handle').trigger('resize');\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'done' });\n\t\t\t\t});\n\t\t\t})\n\t\t\t// lock/unlock dirs while moving\n\t\t\t.bind('lockfiles unlockfiles', function(e) {\n\t\t\t\tvar lock = e.type == 'lockfiles',\n\t\t\t\t\thelperLocked = e.data.helper? e.data.helper.data('locked') : false,\n\t\t\t\t\tact  = (lock && !helperLocked) ? 'disable' : 'enable',\n\t\t\t\t\tdirs = $.grep(e.data.files||[], function(h) {  \n\t\t\t\t\t\tvar dir = fm.file(h);\n\t\t\t\t\t\treturn dir && dir.mime == 'directory' ? true : false;\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t$.each(dirs, function(i, hash) {\n\t\t\t\t\tvar dir = fm.navHash2Elm(hash);\n\t\t\t\t\t\n\t\t\t\t\tif (dir.length && !helperLocked) {\n\t\t\t\t\t\tdir.hasClass(draggable) && dir.draggable(act);\n\t\t\t\t\t\tdir.hasClass(droppable) && dir.droppable(act);\n\t\t\t\t\t\tdir[lock ? 'addClass' : 'removeClass'](disabled);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.bind('sortchange', function() {\n\t\t\t\tif (fm.sortAlsoTreeview || prevSortTreeview !== fm.sortAlsoTreeview) {\n\t\t\t\t\tvar dirs,\n\t\t\t\t\t\tends = [],\n\t\t\t\t\t\tendsMap = {},\n\t\t\t\t\t\tendsVid = {},\n\t\t\t\t\t\ttopVid = '',\n\t\t\t\t\t\tsingle = false,\n\t\t\t\t\t\tcurrent;\n\t\t\t\t\t\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tdirs = filter(fm.files());\n\t\t\t\t\t\tprevSortTreeview = fm.sortAlsoTreeview;\n\t\t\t\t\t\t\n\t\t\t\t\t\ttree.empty();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// append volume roots at first\n\t\t\t\t\t\tupdateTree($.map(fm.roots, function(h) {\n\t\t\t\t\t\t\tvar dir = fm.file(h);\n\t\t\t\t\t\t\treturn dir && !dir.phash? dir : null;\n\t\t\t\t\t\t}));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!Object.keys(hasMoreDirs).length) {\n\t\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\t\tcurrent = selectPages();\n\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tends = getEnds();\n\t\t\t\t\t\t\tif (ends.length > 1) {\n\t\t\t\t\t\t\t\t$.each(ends, function(i, end) {\n\t\t\t\t\t\t\t\t\tvar vid = fm.file(fm.root(end)).volumeid; \n\t\t\t\t\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\t\t\t\t\ttopVid = vid;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tendsVid[vid] = end;\n\t\t\t\t\t\t\t\t\tendsMap[end] = [];\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\tif (!d.volumeid) {\n\t\t\t\t\t\t\t\t\t\tsingle = true;\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tendsMap[endsVid[d.volumeid] || endsVid[topVid]].push(d);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsingle = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (single) {\n\t\t\t\t\t\t\t\t$.each(ends, function(i, endHash) {\n\t\t\t\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\t\t\t\tcurrent = selectPages(fm.file(endHash));\n\t\t\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$.each(endsMap, function(endHash, dirs) {\n\t\t\t\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\t\t\t\tcurrent = selectPages(fm.file(endHash));\n\t\t\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsync();\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t\t\n\t\treturn this;\n\t};\n\n\n\treturn $;\n});\n"]}