/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["skylark-jquery"],function(e){e.fn.elfindersearchbutton=function(t){"use strict";return this.each(function(){var n,i,a,o,r=!1,c=t.fm,s=(c.res("class","disabled"),t.options.incsearch||{enable:!1}),l=t.options.searchTypes,u=function(e){return c.namespace+c.escape(e)},d=c.getUI("toolbar"),p=c.res("class","searchbtn"),h=e(this).hide().addClass("ui-widget-content elfinder-button "+p).on("click",function(e){e.stopPropagation()}),m=function(){b.data("inctm")&&clearTimeout(b.data("inctm"));var n=e.trim(b.val()),a=!e("#"+u("SearchFromAll")).prop("checked"),o=e("#"+u("SearchMime")).prop("checked"),s="";a&&(a=e("#"+u("SearchFromVol")).prop("checked")?c.root(c.cwd().hash):c.cwd().hash),o&&(o=n,n="."),i&&(s=i.children("input:checked").val()),n?(b.trigger("focus"),t.exec(n,a,o,s).done(function(){r=!0}).fail(function(){f()})):c.trigger("searchend")},f=function(){b.data("inctm")&&clearTimeout(b.data("inctm")),b.val("").trigger("blur"),(r||g)&&(r=!1,g="",c.lazy(function(){c.trigger("searchend")}))},g="",b=e('<input type="text" size="42"/>').on("focus",function(){var e,t;!h.hasClass("ui-state-active")&&c.getUI().click(),o=!0,g="",h.addClass("ui-state-active"),c.trigger("uiresize"),n&&n.css((e=c.getUI(),t=e.offset(),{top:h.offset().top-t.top,maxHeight:e.height()-40})).slideDown(function(){h.addClass("ui-state-active"),c.toFront(n)})}).on("blur",function(){o=!1,n?n.data("infocus")?n.data("infocus",!1):n.slideUp(function(){h.removeClass("ui-state-active"),c.trigger("uiresize"),c.toHide(n)}):h.removeClass("ui-state-active")}).appendTo(h).on("keypress",function(e){e.stopPropagation()}).on("keydown",function(t){t.stopPropagation(),t.keyCode===e.ui.keyCode.ENTER?m():t.keyCode===e.ui.keyCode.ESCAPE&&(t.preventDefault(),f())});s.enable&&(s.minlen=s.minlen||2,s.wait=s.wait||500,b.attr("title",c.i18n("incSearchOnly")).on("compositionstart",function(){b.data("composing",!0)}).on("compositionend",function(){b.removeData("composing"),b.trigger("input")}).on("input",function(){b.data("composing")||(b.data("inctm")&&clearTimeout(b.data("inctm")),b.data("inctm",setTimeout(function(){var e=b.val();(0===e.length||e.length>=s.minlen)&&(g!==e&&c.trigger("incsearchstart",{query:e,type:i?i.children("input:checked").val():"searchName"}),g=e,""===e&&c.searchStatus.state>1&&c.searchStatus.query&&b.val(c.searchStatus.query).trigger("select"))},s.wait)))}),c.UA.ltIE8&&b.on("keydown",function(e){229===e.keyCode&&(b.data("imetm")&&clearTimeout(b.data("imetm")),b.data("composing",!0),b.data("imetm",setTimeout(function(){b.removeData("composing")},100)))}).on("keyup",function(t){b.data("imetm")&&clearTimeout(b.data("imetm")),b.data("composing")?t.keyCode===e.ui.keyCode.ENTER&&b.trigger("compositionend"):b.trigger("input")})),e('<span class="ui-icon ui-icon-search" title="'+t.title+'"/>').appendTo(h).on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),h.hasClass("ui-state-active")?m():b.trigger("focus")}),e('<span class="ui-icon ui-icon-close"/>').appendTo(h).on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),""!==b.val()||h.hasClass("ui-state-active")?f():b.trigger("focus")}),c.bind("toolbarload",function(){var e=h.parent();if(e.length&&(d.prepend(h.show()),e.remove(),c.UA.ltIE7)){var t=h.children("ltr"==c.direction?".ui-icon-close":".ui-icon-search");t.css({right:"",left:parseInt(h.width())-t.outerWidth(!0)})}}),c.one("init",function(){c.getUI("cwd").on("touchstart click",function(){o&&b.trigger("blur")})}).one("open",function(){(n=c.api<2.1?null:e('<div class="ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all"/>').append(e('<div class="buttonset"/>').append(e('<input id="'+u("SearchFromCwd")+'" name="serchfrom" type="radio" checked="checked"/><label for="'+u("SearchFromCwd")+'">'+c.i18n("btnCwd")+"</label>"),e('<input id="'+u("SearchFromVol")+'" name="serchfrom" type="radio"/><label for="'+u("SearchFromVol")+'">'+c.i18n("btnVolume")+"</label>"),e('<input id="'+u("SearchFromAll")+'" name="serchfrom" type="radio"/><label for="'+u("SearchFromAll")+'">'+c.i18n("btnAll")+"</label>")),e('<div class="buttonset elfinder-search-type"/>').append(e('<input id="'+u("SearchName")+'" name="serchcol" type="radio" checked="checked" value="SearchName"/><label for="'+u("SearchName")+'">'+c.i18n("btnFileName")+"</label>"))).hide().appendTo(c.getUI()))&&(l&&(i=n.find(".elfinder-search-type"),e.each(t.options.searchTypes,function(t,n){i.append(e('<input id="'+u(t)+'" name="serchcol" type="radio" value="'+c.escape(t)+'"/><label for="'+u(t)+'">'+c.i18n(n.name)+"</label>"))})),n.find("div.buttonset").buttonset(),e("#"+u("SearchFromAll")).next("label").attr("title",c.i18n("searchTarget",c.i18n("btnAll"))),l&&e.each(l,function(t,n){n.title&&e("#"+u(t)).next("label").attr("title",c.i18n(n.title))}),n.on("mousedown","div.buttonset",function(e){e.stopPropagation(),n.data("infocus",!0)}).on("click","input",function(t){t.stopPropagation(),e.trim(b.val())?m():b.trigger("focus")}).on("close",function(){b.trigger("blur")}))}).bind("searchend",function(){b.val("")}).bind("open parents",function(){var t=[],n=c.file(c.root(c.cwd().hash));n&&(e.each(c.parents(c.cwd().hash),function(e,n){t.push(c.file(n).name)}),e("#"+u("SearchFromCwd")).next("label").attr("title",c.i18n("searchTarget",t.join(c.option("separator")))),e("#"+u("SearchFromVol")).next("label").attr("title",c.i18n("searchTarget",n.name)))}).bind("open",function(){g&&f()}).bind("cwdinit",function(){a=!1}).bind("cwdrender",function(){a=!0}).bind("keydownEsc",function(){g&&"/"===g.substr(0,1)&&(g="",b.val(""),c.trigger("searchend"))}).shortcut({pattern:"ctrl+f f3",description:t.title,callback:function(){b.trigger("select").trigger("focus")}}).shortcut({pattern:"a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9",description:c.i18n("firstLetterSearch"),callback:function(t){if(a){var n,i=t.originalEvent.keyCode,o=function(){var t=c.selected(),n=e.ui.keyCode[!t.length||c.cwdHash2Elm(t[0]).next("[id]").length?"RIGHT":"HOME"];e(document).trigger(e.Event("keydown",{keyCode:n,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))};i>=96&&i<=105&&(i-=48),n="/"+String.fromCharCode(i),g!==n?(b.val(n),g=n,c.trigger("incsearchstart",{query:n}).one("cwdrender",o)):o()}}})})}});
//# sourceMappingURL=../sourcemaps/ui/searchbutton.js.map
