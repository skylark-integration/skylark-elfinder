/**
 * skylark-elfinder - A version of elfinder that ported to running on skylarkjs.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["skylark-jquery"],function(e){return e.fn.elfindertoolbar=function(t,n){"use strict";return this.not(".elfinder-toolbar").each(function(){var o,a,i,r,l,c,d,s,u,g=t._commands,h=e(this).addClass("ui-helper-clearfix ui-widget-header elfinder-toolbar"),p={displayTextLabel:!1,labelExcludeUA:["Mobile"],autoHideUA:["Mobile"],showPreferenceButton:"none"},f=function(n){var c,d;for(e.each(b,function(e,t){t.detach()}),h.empty(),o=m.length;o--;)if(m[o]){for(r=e('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),a=m[o].length;a--;)c=m[o][a],n&&n[c]||!(i=g[c])||(l="elfinder"+i.options.ui,!b[c]&&e.fn[l]&&(b[c]=e("<div/>")[l](i)),b[c]&&(b[c].children(".elfinder-button-text")[s?"show":"hide"](),r.prepend(b[c])));r.children().length&&h.prepend(r),r.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}(d=g.preference)&&("always"===p.showPreferenceButton||!h.children().length&&"auto"===p.showPreferenceButton)&&(r=e('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),c="preference",l="elfinder"+i.options.ui,b[c]=e("<div/>")[l](d),b[c].children(".elfinder-button-text")[s?"show":"hide"](),r.prepend(b[c]),h.append(r)),!h.data("swipeClose")&&h.children().length?h.show():h.hide(),w=h[0].clientHeight,t.trigger("toolbarload").trigger("uiresize")},b={},m=function(t){return e.grep(t,function(t){return!e.isPlainObject(t)||(p=Object.assign(p,t),!1)})}(n||[]),v=null,x="",w=0,y=[];p.showPreferenceButton=p.showPreferenceButton.toLowerCase(),"none"!==p.displayTextLabel&&(s=null===(s=t.storage("toolbarTextLabel"))?p.displayTextLabel&&(!p.labelExcludeUA||!p.labelExcludeUA.length||!e.grep(p.labelExcludeUA,function(e){return!!t.UA[e]}).length):1==s,y.push({label:t.i18n("textLabel"),icon:"text",callback:function(){s=!s,h.css("height","").find(".elfinder-button-text")[s?"show":"hide"](),t.trigger("uiresize").storage("toolbarTextLabel",s?"1":"0")}})),p.preferenceInContextmenu&&g.preference&&y.push({label:t.i18n("toolbarPref"),icon:"preference",callback:function(){t.exec("preference",void 0,{tab:"toolbar"})}}),y.length&&h.on("contextmenu",function(e){e.stopPropagation(),e.preventDefault(),t.trigger("contextmenu",{raw:y,x:e.pageX,y:e.pageY})}).on("touchstart",function(e){e.originalEvent.touches.length>1||(h.data("tmlongtap")&&clearTimeout(h.data("tmlongtap")),h.removeData("longtap").data("longtap",{x:e.originalEvent.touches[0].pageX,y:e.originalEvent.touches[0].pageY}).data("tmlongtap",setTimeout(function(){h.removeData("longtapTm").trigger({type:"contextmenu",pageX:h.data("longtap").x,pageY:h.data("longtap").y}).data("longtap",{longtap:!0})},500)))}).on("touchmove touchend",function(e){h.data("tmlongtap")&&(("touchend"===e.type||Math.abs(h.data("longtap").x-e.originalEvent.touches[0].pageX)+Math.abs(h.data("longtap").y-e.originalEvent.touches[0].pageY)>4)&&clearTimeout(h.data("tmlongtap")),h.removeData("longtapTm"))}).on("click",function(e){h.data("longtap")&&h.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}).on("touchend click",".elfinder-button",function(e){h.data("longtap")&&h.data("longtap").longtap&&(e.stopImmediatePropagation(),e.preventDefault())}),h.prev().length&&h.parent().prepend(this),f(),t.bind("open sync select toolbarpref",function(){var n,o,a,i=Object.assign({},t.option("disabledFlip")),r=t.storage("toolbarhides");if(!r&&Array.isArray(p.defaultHides)&&(r={},e.each(p.defaultHides,function(){r[this]=!0}),t.storage("toolbarhides",r)),"select"===this.type){if(t.searchStatus.state<2)return;(o=t.selected()).length&&(i=t.getDisabledCmds(o,!0))}e.each(r,function(e){i[e]||(i[e]=!0)}),Object.keys(t.commandMap).length&&e.each(t.commandMap,function(e,t){"hidden"===t&&(i[e]=!0)}),a=Object.keys(i),v&&v.toString()===a.sort().toString()||(f(a.length?i:null),n=!0),v=a.sort(),(n||x!==JSON.stringify(t.commandMap))&&(x=JSON.stringify(t.commandMap),n||e.each(e("div.elfinder-button"),function(){var t=e(this).data("origin");t&&e(this).after(t).detach()}),Object.keys(t.commandMap).length&&e.each(t.commandMap,function(n,o){var a,i=t._commands[o],r=i?"elfinder"+i.options.ui:null;r&&e.fn[r]&&(a=b[n])&&(!b[o]&&e.fn[r]&&(b[o]=e("<div/>")[r](i),b[o]&&(b[o].children(".elfinder-button-text")[s?"show":"hide"](),i.extendsCmd&&b[o].children("span.elfinder-button-icon").addClass("elfinder-button-icon-"+i.extendsCmd))),b[o]&&(a.after(b[o]),b[o].data("origin",a.detach())))}))}).bind("resize",function(e){u&&cancelAnimationFrame(u),u=requestAnimationFrame(function(){var e=h[0].clientHeight;w!==e&&(w=e,t.trigger("uiresize"))})}),t.UA.Touch&&(void 0===(d=t.storage("autoHide")||{}).toolbar&&(d.toolbar=p.autoHideUA&&p.autoHideUA.length>0&&e.grep(p.autoHideUA,function(e){return!!t.UA[e]}).length,t.storage("autoHide",d)),d.toolbar&&t.one("init",function(){t.uiAutoHide.push(function(){h.stop(!0,!0).trigger("toggle",{duration:500,init:!0})})}),t.bind("load",function(){"none"!==(c=e('<div class="elfinder-toolbar-swipe-handle"/>').hide().appendTo(t.getUI())).css("pointer-events")&&(c.remove(),c=null)}),h.on("toggle",function(e,n){var o=t.getUI("workzone"),a=h.is(":hidden"),i=o.height(),r=h.height(),l=h.outerHeight(!0)-r,s=Object.assign({step:function(e){o.height(i+(a?-1*(e+l):r-e)),t.trigger("resize")},always:function(){requestAnimationFrame(function(){h.css("height",""),t.trigger("uiresize"),c&&(a?c.stop(!0,!0).hide():(c.height(n.handleH?n.handleH:""),t.resources.blink(c,"slowonce"))),a&&h.scrollTop("0px"),n.init&&t.trigger("uiautohide")})}},n);h.data("swipeClose",!a).stop(!0,!0).animate({height:"toggle"},s),d.toolbar=!a,t.storage("autoHide",Object.assign(t.storage("autoHide"),{toolbar:d.toolbar}))}).on("touchstart",function(e){h.scrollBottom()>5&&(e.originalEvent._preventSwipeY=!0)}))}),this},e});
//# sourceMappingURL=../sourcemaps/ui/toolbar.js.map
