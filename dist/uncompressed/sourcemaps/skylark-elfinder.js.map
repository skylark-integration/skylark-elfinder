{"version":3,"sources":["skylark-elfinder.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../skylark-elfinder.js","sourcesContent":["\tdefine('skylark-elfinder/elFinder',[],function() {\n\n\t/**\n\t * @class elFinder - file manager for web\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\tvar elFinder = function(elm, opts, bootCallback) {\n\t\t\"use strict\";\n\t\t//this.time('load');\n\t\tvar self = this,\n\t\t\t\n\t\t\t/**\n\t\t\t * Objects array of jQuery.Deferred that calls before elFinder boot up\n\t\t\t * \n\t\t\t * @type Array\n\t\t\t */\n\t\t\tdfrdsBeforeBootup = [],\n\t\t\t\n\t\t\t/**\n\t\t\t * Plugin name to check for conflicts with bootstrap etc\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t **/\n\t\t\tconflictChecks = ['button', 'tooltip'],\n\t\t\t\n\t\t\t/**\n\t\t\t * Node on which elfinder creating\n\t\t\t *\n\t\t\t * @type jQuery\n\t\t\t **/\n\t\t\tnode = $(elm),\n\t\t\t\n\t\t\t/**\n\t\t\t * Object of events originally registered in this node\n\t\t\t * \n\t\t\t * @type Object\n\t\t\t */\n\t\t\tprevEvents = $.extend(true, {}, $._data(node.get(0), 'events')),\n\t\t\t\n\t\t\t/**\n\t\t\t * Store node contents.\n\t\t\t *\n\t\t\t * @see this.destroy\n\t\t\t * @type jQuery\n\t\t\t **/\n\t\t\tprevContent = $('<div/>').append(node.contents()).attr('class', node.attr('class') || '').attr('style', node.attr('style') || ''),\n\t\t\t\n\t\t\t/**\n\t\t\t * Instance ID. Required to get/set cookie\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tid = node.attr('id') || node.attr('id', 'elfauto' + $('.elfinder').length).attr('id'),\n\t\t\t\n\t\t\t/**\n\t\t\t * Events namespace\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tnamespace = 'elfinder-' + id,\n\t\t\t\n\t\t\t/**\n\t\t\t * Mousedown event\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tmousedown = 'mousedown.'+namespace,\n\t\t\t\n\t\t\t/**\n\t\t\t * Keydown event\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tkeydown = 'keydown.'+namespace,\n\t\t\t\n\t\t\t/**\n\t\t\t * Keypress event\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tkeypress = 'keypress.'+namespace,\n\t\t\t\n\t\t\t/**\n\t\t\t * Keypup event\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tkeyup    = 'keyup.'+namespace,\n\n\t\t\t/**\n\t\t\t * Is shortcuts/commands enabled\n\t\t\t *\n\t\t\t * @type Boolean\n\t\t\t **/\n\t\t\tenabled = false,\n\t\t\t\n\t\t\t/**\n\t\t\t * Store enabled value before ajax request\n\t\t\t *\n\t\t\t * @type Boolean\n\t\t\t **/\n\t\t\tprevEnabled = false,\n\t\t\t\n\t\t\t/**\n\t\t\t * List of build-in events which mapped into methods with same names\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t **/\n\t\t\tevents = ['enable', 'disable', 'load', 'open', 'reload', 'select',  'add', 'remove', 'change', 'dblclick', 'getfile', 'lockfiles', 'unlockfiles', 'selectfiles', 'unselectfiles', 'dragstart', 'dragstop', 'search', 'searchend', 'viewchange'],\n\t\t\t\n\t\t\t/**\n\t\t\t * Rules to validate data from backend\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\trules = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Current working directory hash\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tcwd = '',\n\t\t\t\n\t\t\t/**\n\t\t\t * Current working directory options default\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tcwdOptionsDefault = {\n\t\t\t\tpath          : '',\n\t\t\t\turl           : '',\n\t\t\t\ttmbUrl        : '',\n\t\t\t\tdisabled      : [],\n\t\t\t\tseparator     : '/',\n\t\t\t\tarchives      : [],\n\t\t\t\textract       : [],\n\t\t\t\tcopyOverwrite : true,\n\t\t\t\tuploadOverwrite : true,\n\t\t\t\tuploadMaxSize : 0,\n\t\t\t\tjpgQuality    : 100,\n\t\t\t\ttmbCrop       : false,\n\t\t\t\ttmbReqCustomData : false,\n\t\t\t\ttmb           : false // old API\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Current working directory options\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tcwdOptions = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Files/dirs cache\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tfiles = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Hidden Files/dirs cache\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\thiddenFiles = {},\n\n\t\t\t/**\n\t\t\t * Files/dirs hash cache of each dirs\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\townFiles = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Selected files hashes\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t **/\n\t\t\tselected = [],\n\t\t\t\n\t\t\t/**\n\t\t\t * Events listeners\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tlisteners = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Shortcuts\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tshortcuts = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Buffer for copied files\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t **/\n\t\t\tclipboard = [],\n\t\t\t\n\t\t\t/**\n\t\t\t * Copied/cuted files hashes\n\t\t\t * Prevent from remove its from cache.\n\t\t\t * Required for dispaly correct files names in error messages\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tremember = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Queue for 'open' requests\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t **/\n\t\t\tqueue = [],\n\t\t\t\n\t\t\t/**\n\t\t\t * Queue for only cwd requests e.g. `tmb`\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t **/\n\t\t\tcwdQueue = [],\n\t\t\t\n\t\t\t/**\n\t\t\t * Commands prototype\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tbase = new self.command(self),\n\t\t\t\n\t\t\t/**\n\t\t\t * elFinder node width\n\t\t\t *\n\t\t\t * @type String\n\t\t\t * @default \"auto\"\n\t\t\t **/\n\t\t\twidth  = 'auto',\n\t\t\t\n\t\t\t/**\n\t\t\t * elFinder node height\n\t\t\t * Number: pixcel or String: Number + \"%\"\n\t\t\t *\n\t\t\t * @type Number | String\n\t\t\t * @default 400\n\t\t\t **/\n\t\t\theight = 400,\n\t\t\t\n\t\t\t/**\n\t\t\t * Base node object or selector\n\t\t\t * Element which is the reference of the height percentage\n\t\t\t *\n\t\t\t * @type Object|String\n\t\t\t * @default null | $(window) (if height is percentage)\n\t\t\t **/\n\t\t\theightBase = null,\n\t\t\t\n\t\t\t/**\n\t\t\t * MIME type list(Associative array) handled as a text file\n\t\t\t * \n\t\t\t * @type Object|null\n\t\t\t */\n\t\t\ttextMimes = null,\n\t\t\t\n\t\t\t/**\n\t\t\t * elfinder path for sound played on remove\n\t\t\t * @type String\n\t\t\t * @default ./sounds/\n\t\t\t **/\n\t\t\tsoundPath = 'sounds/',\n\t\t\t\n\t\t\t/**\n\t\t\t * JSON.stringify of previous fm.sorters\n\t\t\t * @type String\n\t\t\t */\n\t\t\tprevSorterStr = '',\n\n\t\t\t/**\n\t\t\t * Map table of file extention to MIME-Type\n\t\t\t * @type Object\n\t\t\t */\n\t\t\textToMimeTable,\n\n\t\t\t/**\n\t\t\t * Disabled page unload function\n\t\t\t * @type Boolean\n\t\t\t */\n\t\t\tdiableUnloadCheck = false,\n\n\t\t\tbeeper = $(document.createElement('audio')).hide().appendTo('body')[0],\n\t\t\t\t\n\t\t\tsyncInterval,\n\t\t\tautoSyncStop = 0,\n\t\t\t\n\t\t\tuiCmdMapPrev = '',\n\t\t\t\n\t\t\tgcJobRes = null,\n\t\t\t\n\t\t\topen = function(data) {\n\t\t\t\t// NOTES: Do not touch data object\n\t\t\t\n\t\t\t\tvar volumeid, contextmenu, emptyDirs = {}, stayDirs = {},\n\t\t\t\t\trmClass, hashes, calc, gc, collapsed, prevcwd, sorterStr, diff;\n\t\t\t\t\n\t\t\t\tif (self.api >= 2.1) {\n\t\t\t\t\t// support volume driver option `uiCmdMap`\n\t\t\t\t\tself.commandMap = (data.options.uiCmdMap && Object.keys(data.options.uiCmdMap).length)? data.options.uiCmdMap : {};\n\t\t\t\t\tif (uiCmdMapPrev !== JSON.stringify(self.commandMap)) {\n\t\t\t\t\t\tuiCmdMapPrev = JSON.stringify(self.commandMap);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tself.options.sync = 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (data.init) {\n\t\t\t\t\t// init - reset cache\n\t\t\t\t\tfiles = {};\n\t\t\t\t\townFiles = {};\n\t\t\t\t} else {\n\t\t\t\t\t// remove only files from prev cwd\n\t\t\t\t\t// and collapsed directory (included 100+ directories) to empty for perfomance tune in DnD\n\t\t\t\t\tprevcwd = cwd;\n\t\t\t\t\trmClass = 'elfinder-subtree-loaded ' + self.res('class', 'navexpand');\n\t\t\t\t\tcollapsed = self.res('class', 'navcollapse');\n\t\t\t\t\thashes = Object.keys(files);\n\t\t\t\t\tcalc = function(i) {\n\t\t\t\t\t\tif (!files[i]) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar isDir = (files[i].mime === 'directory'),\n\t\t\t\t\t\t\tphash = files[i].phash,\n\t\t\t\t\t\t\tpnav;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(!isDir\n\t\t\t\t\t\t\t\t|| emptyDirs[phash]\n\t\t\t\t\t\t\t\t|| (!stayDirs[phash]\n\t\t\t\t\t\t\t\t\t&& self.navHash2Elm(files[i].hash).is(':hidden')\n\t\t\t\t\t\t\t\t\t&& self.navHash2Elm(phash).next('.elfinder-navbar-subtree').children().length > 100\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t&& (isDir || phash !== cwd)\n\t\t\t\t\t\t\t&& ! remember[i]\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (isDir && !emptyDirs[phash]) {\n\t\t\t\t\t\t\t\temptyDirs[phash] = true;\n\t\t\t\t\t\t\t\tself.navHash2Elm(phash)\n\t\t\t\t\t\t\t\t .removeClass(rmClass)\n\t\t\t\t\t\t\t\t .next('.elfinder-navbar-subtree').empty();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdeleteCache(files[i]);\n\t\t\t\t\t\t} else if (isDir) {\n\t\t\t\t\t\t\tstayDirs[phash] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tgc = function() {\n\t\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\t\tgcJobRes && gcJobRes._abort();\n\t\t\t\t\t\t\tgcJobRes = self.asyncJob(calc, hashes, {\n\t\t\t\t\t\t\t\tinterval : 20,\n\t\t\t\t\t\t\t\tnumPerOnce : 100\n\t\t\t\t\t\t\t}).done(function() {\n\t\t\t\t\t\t\t\tvar hd = self.storage('hide') || {items: {}};\n\t\t\t\t\t\t\t\tif (Object.keys(hiddenFiles).length) {\n\t\t\t\t\t\t\t\t\t$.each(hiddenFiles, function(h) {\n\t\t\t\t\t\t\t\t\t\tif (!hd.items[h]) {\n\t\t\t\t\t\t\t\t\t\t\tdelete hiddenFiles[h];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tself.trigger('filesgc').one('filesgc', function() {\n\t\t\t\t\t\thashes = [];\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tself.one('opendone', function() {\n\t\t\t\t\t\tif (prevcwd !== cwd) {\n\t\t\t\t\t\t\tif (! node.data('lazycnt')) {\n\t\t\t\t\t\t\t\tgc();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.one('lazydone', gc);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tself.sorters = {};\n\t\t\t\tcwd = data.cwd.hash;\n\t\t\t\tcache(data.files);\n\t\t\t\tif (!files[cwd]) {\n\t\t\t\t\tcache([data.cwd]);\n\t\t\t\t} else {\n\t\t\t\t\tdiff = self.diff([data.cwd], true);\n\t\t\t\t\tif (diff.changed.length) {\n\t\t\t\t\t\tcache(diff.changed, 'change');\n\t\t\t\t\t\tself.change({changed: diff.changed});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdata.changed && data.changed.length && cache(data.changed, 'change');\n\n\t\t\t\t// trigger event 'sorterupdate'\n\t\t\t\tsorterStr = JSON.stringify(self.sorters);\n\t\t\t\tif (prevSorterStr !== sorterStr) {\n\t\t\t\t\tself.trigger('sorterupdate');\n\t\t\t\t\tprevSorterStr = sorterStr;\n\t\t\t\t}\n\n\t\t\t\tself.lastDir(cwd);\n\t\t\t\t\n\t\t\t\tself.autoSync();\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Store info about files/dirs in \"files\" object.\n\t\t\t *\n\t\t\t * @param  Array  files\n\t\t\t * @param  String data type\n\t\t\t * @return void\n\t\t\t **/\n\t\t\tcache = function(data, type) {\n\t\t\t\tvar type      = type || 'files',\n\t\t\t\t\tkeeps = ['sizeInfo', 'encoding'],\n\t\t\t\t\tdefsorter = { name: true, perm: true, date: true,  size: true, kind: true },\n\t\t\t\t\tsorterChk = !self.sorters._checked && (type === 'files'),\n\t\t\t\t\tl         = data.length,\n\t\t\t\t\tsetSorter = function(file) {\n\t\t\t\t\t\tvar f = file || {},\n\t\t\t\t\t\t\tsorters = [];\n\t\t\t\t\t\t$.each(self.sortRules, function(key) {\n\t\t\t\t\t\t\tif (defsorter[key] || typeof f[key] !== 'undefined' || (key === 'mode' && typeof f.perm !== 'undefined')) {\n\t\t\t\t\t\t\t\tsorters.push(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tself.sorters = self.arrayFlip(sorters, true);\n\t\t\t\t\t\tself.sorters._checked = true;\n\t\t\t\t\t},\n\t\t\t\t\tchangedParents = {},\n\t\t\t\t\thideData = self.storage('hide') || {},\n\t\t\t\t\thides = hideData.items || {},\n\t\t\t\t\tf, i, i1, keepProp, parents, hidden;\n\n\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\tf = Object.assign({}, data[i]);\n\t\t\t\t\thidden = (!hideData.show && hides[f.hash])? true : false;\n\t\t\t\t\tif (f.name && f.hash && f.mime) {\n\t\t\t\t\t\tif (!hidden) {\n\t\t\t\t\t\t\tif (sorterChk && f.phash === cwd) {\n\t\t\t\t\t\t\t\tsetSorter(f);\n\t\t\t\t\t\t\t\tsorterChk = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (f.phash && (type === 'add' || (type === 'change' && (!files[f.hash] || f.size !== files[f.hash])))) {\n\t\t\t\t\t\t\t\tif (parents = self.parents(f.phash)) {\n\t\t\t\t\t\t\t\t\t$.each(parents, function() {\n\t\t\t\t\t\t\t\t\t\tchangedParents[this] = true;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (files[f.hash]) {\n\t\t\t\t\t\t\tfor (i1 =0; i1 < keeps.length; i1++) {\n\t\t\t\t\t\t\t\tif(files[f.hash][keeps[i1]] && ! f[keeps[i1]]) {\n\t\t\t\t\t\t\t\t\tf[keeps[i1]] = files[f.hash][keeps[i1]];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (f.sizeInfo && !f.size) {\n\t\t\t\t\t\t\t\tf.size = f.sizeInfo.size;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdeleteCache(files[f.hash], true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hides[f.hash]) {\n\t\t\t\t\t\t\thiddenFiles[f.hash] = f;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hidden) {\n\t\t\t\t\t\t\tl--;\n\t\t\t\t\t\t\tdata.splice(i--, 1);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles[f.hash] = f;\n\t\t\t\t\t\t\tif (f.mime === 'directory' && !ownFiles[f.hash]) {\n\t\t\t\t\t\t\t\townFiles[f.hash] = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (f.phash) {\n\t\t\t\t\t\t\t\tif (!ownFiles[f.phash]) {\n\t\t\t\t\t\t\t\t\townFiles[f.phash] = {};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\townFiles[f.phash][f.hash] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// delete sizeInfo cache\n\t\t\t\t$.each(Object.keys(changedParents), function() {\n\t\t\t\t\tvar target = files[this];\n\t\t\t\t\tif (target && target.sizeInfo) {\n\t\t\t\t\t\tdelete target.sizeInfo;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// for empty folder\n\t\t\t\tsorterChk && setSorter();\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Delete file object from files caches\n\t\t\t * \n\t\t\t * @param  Array  removed hashes\n\t\t\t * @return void\n\t\t\t */\n\t\t\tremove = function(removed) {\n\t\t\t\tvar l       = removed.length,\n\t\t\t\t\troots   = {},\n\t\t\t\t\trm      = function(hash) {\n\t\t\t\t\t\tvar file = files[hash], i;\n\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\tif (file.mime === 'directory') {\n\t\t\t\t\t\t\t\tif (roots[hash]) {\n\t\t\t\t\t\t\t\t\tdelete self.roots[roots[hash]];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// restore stats of deleted root parent directory\n\t\t\t\t\t\t\t\t$.each(self.leafRoots, function(phash, roots) {\n\t\t\t\t\t\t\t\t\tvar idx, pdir;\n\t\t\t\t\t\t\t\t\tif ((idx = $.inArray(hash, roots))!== -1) {\n\t\t\t\t\t\t\t\t\t\tif (roots.length === 1) {\n\t\t\t\t\t\t\t\t\t\t\tif ((pdir = Object.assign({}, files[phash])) && pdir._realStats) {\n\t\t\t\t\t\t\t\t\t\t\t\t$.each(pdir._realStats, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpdir[k] = v;\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\tremove(files[phash]._realStats);\n\t\t\t\t\t\t\t\t\t\t\t\tself.change({ changed: [pdir] });\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdelete self.leafRoots[phash];\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tself.leafRoots[phash].splice(idx, 1);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (self.searchStatus.state < 2) {\n\t\t\t\t\t\t\t\t\t$.each(files, function(h, f) {\n\t\t\t\t\t\t\t\t\t\tf.phash == hash && rm(h);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (file.phash) {\n\t\t\t\t\t\t\t\tif (parents = self.parents(file.phash)) {\n\t\t\t\t\t\t\t\t\t$.each(parents, function() {\n\t\t\t\t\t\t\t\t\t\tchangedParents[this] = true;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdeleteCache(files[hash]);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tchangedParents = {},\n\t\t\t\t\tparents;\n\t\t\t\n\t\t\t\t$.each(self.roots, function(k, v) {\n\t\t\t\t\troots[v] = k;\n\t\t\t\t});\n\t\t\t\twhile (l--) {\n\t\t\t\t\trm(removed[l]);\n\t\t\t\t}\n\t\t\t\t// delete sizeInfo cache\n\t\t\t\t$.each(Object.keys(changedParents), function() {\n\t\t\t\t\tvar target = files[this];\n\t\t\t\t\tif (target && target.sizeInfo) {\n\t\t\t\t\t\tdelete target.sizeInfo;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Update file object in files caches\n\t\t\t * \n\t\t\t * @param  Array  changed file objects\n\t\t\t * @return void\n\t\t\t * @deprecated should be use `cache(updatesArrayData, 'change');`\n\t\t\t */\n\t\t\tchange = function(changed) {\n\t\t\t\t$.each(changed, function(i, file) {\n\t\t\t\t\tvar hash = file.hash;\n\t\t\t\t\tif (files[hash]) {\n\t\t\t\t\t\t$.each(Object.keys(files[hash]), function(i, v){\n\t\t\t\t\t\t\tif (typeof file[v] === 'undefined') {\n\t\t\t\t\t\t\t\tdelete files[hash][v];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tfiles[hash] = files[hash] ? Object.assign(files[hash], file) : file;\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Delete cache data of files, ownFiles and self.optionsByHashes\n\t\t\t * \n\t\t\t * @param  Object  file\n\t\t\t * @param  Boolean update\n\t\t\t * @return void\n\t\t\t */\n\t\t\tdeleteCache = function(file, update) {\n\t\t\t\tvar hash = file.hash,\n\t\t\t\t\tphash = file.phash;\n\t\t\t\t\n\t\t\t\tif (phash && ownFiles[phash]) {\n\t\t\t\t\t delete ownFiles[phash][hash];\n\t\t\t\t}\n\t\t\t\tif (!update) {\n\t\t\t\t\townFiles[hash] && delete ownFiles[hash];\n\t\t\t\t\tself.optionsByHashes[hash] && delete self.optionsByHashes[hash];\n\t\t\t\t}\n\t\t\t\tdelete files[hash];\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Maximum number of concurrent connections on request\n\t\t\t * \n\t\t\t * @type Number\n\t\t\t */\n\t\t\trequestMaxConn,\n\t\t\t\n\t\t\t/**\n\t\t\t * Current number of connections\n\t\t\t * \n\t\t\t * @type Number\n\t\t\t */\n\t\t\trequestCnt = 0,\n\t\t\t\n\t\t\t/**\n\t\t\t * Queue waiting for connection\n\t\t\t * \n\t\t\t * @type Array\n\t\t\t */\n\t\t\trequestQueue = [],\n\t\t\t\n\t\t\t/**\n\t\t\t * Current open command instance\n\t\t\t * \n\t\t\t * @type Object\n\t\t\t */\n\t\t\tcurrentOpenCmd = null,\n\n\t\t\t/**\n\t\t\t * Exec shortcut\n\t\t\t *\n\t\t\t * @param  jQuery.Event  keydown/keypress event\n\t\t\t * @return void\n\t\t\t */\n\t\t\texecShortcut = function(e) {\n\t\t\t\tvar code    = e.keyCode,\n\t\t\t\t\tctrlKey = !!(e.ctrlKey || e.metaKey),\n\t\t\t\t\tisMousedown = e.type === 'mousedown',\n\t\t\t\t\tddm;\n\n\t\t\t\t!isMousedown && (self.keyState.keyCode = code);\n\t\t\t\tself.keyState.ctrlKey  = ctrlKey;\n\t\t\t\tself.keyState.shiftKey = e.shiftKey;\n\t\t\t\tself.keyState.metaKey  = e.metaKey;\n\t\t\t\tself.keyState.altKey   = e.altKey;\n\t\t\t\tif (isMousedown) {\n\t\t\t\t\treturn;\n\t\t\t\t} else if (e.type === 'keyup') {\n\t\t\t\t\tself.keyState.keyCode = null;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (enabled) {\n\n\t\t\t\t\t$.each(shortcuts, function(i, shortcut) {\n\t\t\t\t\t\tif (shortcut.type    == e.type \n\t\t\t\t\t\t&& shortcut.keyCode  == code \n\t\t\t\t\t\t&& shortcut.shiftKey == e.shiftKey \n\t\t\t\t\t\t&& shortcut.ctrlKey  == ctrlKey \n\t\t\t\t\t\t&& shortcut.altKey   == e.altKey) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tshortcut.callback(e, self);\n\t\t\t\t\t\t\tself.debug('shortcut-exec', i+' : '+shortcut.description);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// prevent tab out of elfinder\n\t\t\t\t\tif (code == $.ui.keyCode.TAB && !$(e.target).is(':input')) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// cancel any actions by [Esc] key\n\t\t\t\t\tif (e.type === 'keydown' && code == $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t// copy or cut \n\t\t\t\t\t\tif (! node.find('.ui-widget:visible').length) {\n\t\t\t\t\t\t\tself.clipboard().length && self.clipboard([]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// dragging\n\t\t\t\t\t\tif ($.ui.ddmanager) {\n\t\t\t\t\t\t\tddm = $.ui.ddmanager.current;\n\t\t\t\t\t\t\tddm && ddm.helper && ddm.cancel();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// button menus\n\t\t\t\t\t\tself.toHide(node.find('.ui-widget.elfinder-button-menu.elfinder-frontmost:visible'));\n\t\t\t\t\t\t// trigger keydownEsc\n\t\t\t\t\t\tself.trigger('keydownEsc', e);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tdate = new Date(),\n\t\t\tutc,\n\t\t\ti18n,\n\t\t\tinFrame = (window.parent !== window),\n\t\t\tparentIframe = (function() {\n\t\t\t\tvar pifm, ifms;\n\t\t\t\tif (inFrame) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tifms = $('iframe', window.parent.document);\n\t\t\t\t\t\tif (ifms.length) {\n\t\t\t\t\t\t\t$.each(ifms, function(i, ifm) {\n\t\t\t\t\t\t\t\tif (ifm.contentWindow === window) {\n\t\t\t\t\t\t\t\t\tpifm = $(ifm);\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\treturn pifm;\n\t\t\t})(),\n\t\t\t/**\n\t\t\t * elFinder boot up function\n\t\t\t * \n\t\t\t * @type Function\n\t\t\t */\n\t\t\tbootUp,\n\t\t\t/**\n\t\t\t * Original function of XMLHttpRequest.prototype.send\n\t\t\t * \n\t\t\t * @type Function\n\t\t\t */\n\t\t\tsavedXhrSend;\n\t\t\n\t\t// opts must be an object\n\t\tif (!opts) {\n\t\t\topts = {};\n\t\t}\n\t\t\n\t\t// set UA.Angle, UA.Rotated for mobile devices\n\t\tif (self.UA.Mobile) {\n\t\t\t$(window).on('orientationchange.'+namespace, function() {\n\t\t\t\tvar a = ((screen && screen.orientation && screen.orientation.angle) || window.orientation || 0) + 0;\n\t\t\t\tif (a === -90) {\n\t\t\t\t\ta = 270;\n\t\t\t\t}\n\t\t\t\tself.UA.Angle = a;\n\t\t\t\tself.UA.Rotated = a % 180 === 0? false : true;\n\t\t\t}).trigger('orientationchange.'+namespace);\n\t\t}\n\t\t\n\t\t// check opt.bootCallback\n\t\tif (opts.bootCallback && typeof opts.bootCallback === 'function') {\n\t\t\t(function() {\n\t\t\t\tvar func = bootCallback,\n\t\t\t\t\topFunc = opts.bootCallback;\n\t\t\t\tbootCallback = function(fm, extraObj) {\n\t\t\t\t\tfunc && typeof func === 'function' && func.call(this, fm, extraObj);\n\t\t\t\t\topFunc.call(this, fm, extraObj);\n\t\t\t\t};\n\t\t\t})();\n\t\t}\n\t\tdelete opts.bootCallback;\n\n\t\t/**\n\t\t * Protocol version\n\t\t *\n\t\t * @type String\n\t\t **/\n\t\tthis.api = null;\n\t\t\n\t\t/**\n\t\t * elFinder use new api\n\t\t *\n\t\t * @type Boolean\n\t\t **/\n\t\tthis.newAPI = false;\n\t\t\n\t\t/**\n\t\t * elFinder use old api\n\t\t *\n\t\t * @type Boolean\n\t\t **/\n\t\tthis.oldAPI = false;\n\t\t\n\t\t/**\n\t\t * Net drivers names\n\t\t *\n\t\t * @type Array\n\t\t **/\n\t\tthis.netDrivers = [];\n\t\t\n\t\t/**\n\t\t * Base URL of elfFinder library starting from Manager HTML\n\t\t * \n\t\t * @type String\n\t\t */\n\t\tthis.baseUrl = '';\n\t\t\n\t\t/**\n\t\t * Base URL of i18n js files\n\t\t * baseUrl + \"js/i18n/\" when empty value\n\t\t * \n\t\t * @type String\n\t\t */\n\t\tthis.i18nBaseUrl = '';\n\n\t\t/**\n\t\t * Is elFinder CSS loaded\n\t\t * \n\t\t * @type Boolean\n\t\t */\n\t\tthis.cssloaded = false;\n\t\t\n\t\t/**\n\t\t * Current theme object\n\t\t * \n\t\t * @type Object|Null\n\t\t */\n\t\tthis.theme = null;\n\n\t\tthis.mimesCanMakeEmpty = {};\n\n\t\t/**\n\t\t * Callback function at boot up that option specified at elFinder starting\n\t\t * \n\t\t * @type Function\n\t\t */\n\t\tthis.bootCallback;\n\n\t\t/**\n\t\t * Callback function at reload(restart) elFinder \n\t\t * \n\t\t * @type Function\n\t\t */\n\t\tthis.reloadCallback;\n\n\t\t/**\n\t\t * ID. Required to create unique cookie name\n\t\t *\n\t\t * @type String\n\t\t **/\n\t\tthis.id = id;\n\n\t\t/**\n\t\t * Method to store/fetch data\n\t\t *\n\t\t * @type Function\n\t\t **/\n\t\tthis.storage = (function() {\n\t\t\ttry {\n\t\t\t\tif ('localStorage' in window && window.localStorage !== null) {\n\t\t\t\t\tif (self.UA.Safari) {\n\t\t\t\t\t\t// check for Mac/iOS safari private browsing mode\n\t\t\t\t\t\twindow.localStorage.setItem('elfstoragecheck', 1);\n\t\t\t\t\t\twindow.localStorage.removeItem('elfstoragecheck');\n\t\t\t\t\t}\n\t\t\t\t\treturn self.localStorage;\n\t\t\t\t} else {\n\t\t\t\t\treturn self.cookie;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn self.cookie;\n\t\t\t}\n\t\t})();\n\n\t\t/**\n\t\t * Set pause page unload check function or Get state\n\t\t *\n\t\t * @param      Boolean   state   To set state\n\t\t * @param      Boolean   keep    Keep disabled\n\t\t * @return     Boolean|void\n\t\t */\n\t\tthis.pauseUnloadCheck = function(state, keep) {\n\t\t\tif (typeof state === 'undefined') {\n\t\t\t\treturn diableUnloadCheck;\n\t\t\t} else {\n\t\t\t\tdiableUnloadCheck = !!state;\n\t\t\t\tif (state && !keep) {\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tdiableUnloadCheck = false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Configuration options\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\t//this.options = $.extend(true, {}, this._options, opts);\n\t\tthis.options = Object.assign({}, this._options);\n\t\t\n\t\t// for old type configuration\n\t\tif (opts.uiOptions) {\n\t\t\tif (opts.uiOptions.toolbar && Array.isArray(opts.uiOptions.toolbar)) {\n\t\t\t\tif ($.isPlainObject(opts.uiOptions.toolbar[opts.uiOptions.toolbar.length - 1])) {\n\t\t\t\t\tself.options.uiOptions.toolbarExtra = Object.assign(self.options.uiOptions.toolbarExtra || {}, opts.uiOptions.toolbar.pop());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Overwrite if opts value is an array\n\t\t(function() {\n\t\t\tvar arrOv = function(obj, base) {\n\t\t\t\tif ($.isPlainObject(obj)) {\n\t\t\t\t\t$.each(obj, function(k, v) {\n\t\t\t\t\t\tif ($.isPlainObject(v)) {\n\t\t\t\t\t\t\tif (!base[k]) {\n\t\t\t\t\t\t\t\tbase[k] = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tarrOv(v, base[k]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbase[k] = v;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tarrOv(opts, self.options);\n\t\t})();\n\t\t\n\t\t// join toolbarExtra to toolbar\n\t\tthis.options.uiOptions.toolbar.push(this.options.uiOptions.toolbarExtra);\n\t\tdelete this.options.uiOptions.toolbarExtra;\n\n\t\t/**\n\t\t * Arrays that has to unbind events\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.toUnbindEvents = {};\n\t\t\n\t\t/**\n\t\t * Attach listener to events\n\t\t * To bind to multiply events at once, separate events names by space\n\t\t * \n\t\t * @param  String  event(s) name(s)\n\t\t * @param  Object  event handler or {done: handler}\n\t\t * @param  Boolean priority first\n\t\t * @return elFinder\n\t\t */\n\t\tthis.bind = function(event, callback, priorityFirst) {\n\t\t\tvar i, len;\n\t\t\t\n\t\t\tif (callback && (typeof callback === 'function' || typeof callback.done === 'function')) {\n\t\t\t\tevent = ('' + event).toLowerCase().replace(/^\\s+|\\s+$/g, '').split(/\\s+/);\n\t\t\t\t\n\t\t\t\tlen = event.length;\n\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\tif (listeners[event[i]] === void(0)) {\n\t\t\t\t\t\tlisteners[event[i]] = [];\n\t\t\t\t\t}\n\t\t\t\t\tlisteners[event[i]][priorityFirst? 'unshift' : 'push'](callback);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Remove event listener if exists\n\t\t * To un-bind to multiply events at once, separate events names by space\n\t\t *\n\t\t * @param  String    event(s) name(s)\n\t\t * @param  Function  callback\n\t\t * @return elFinder\n\t\t */\n\t\tthis.unbind = function(event, callback) {\n\t\t\tvar i, len, l, ci;\n\t\t\t\n\t\t\tevent = ('' + event).toLowerCase().split(/\\s+/);\n\t\t\t\n\t\t\tlen = event.length;\n\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\tif (l = listeners[event[i]]) {\n\t\t\t\t\tci = $.inArray(callback, l);\n\t\t\t\t\tci > -1 && l.splice(ci, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tcallback = null;\n\t\t\treturn this;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Fire event - send notification to all event listeners\n\t\t * In the callback `this` becames an event object\n\t\t *\n\t\t * @param  String   event type\n\t\t * @param  Object   data to send across event\n\t\t * @param  Boolean  allow modify data (call by reference of data) default: true\n\t\t * @return elFinder\n\t\t */\n\t\tthis.trigger = function(evType, data, allowModify) {\n\t\t\tvar type      = evType.toLowerCase(),\n\t\t\t\tisopen    = (type === 'open'),\n\t\t\t\tdataIsObj = (typeof data === 'object'),\n\t\t\t\thandlers  = listeners[type] || [],\n\t\t\t\tdones     = [],\n\t\t\t\ti, l, jst, event;\n\t\t\t\n\t\t\tthis.debug('event-'+type, data);\n\t\t\t\n\t\t\tif (! dataIsObj || typeof allowModify === 'undefined') {\n\t\t\t\tallowModify = true;\n\t\t\t}\n\t\t\tif (l = handlers.length) {\n\t\t\t\tevent = $.Event(type);\n\t\t\t\tif (data) {\n\t\t\t\t\tdata._getEvent = function() {\n\t\t\t\t\t\treturn event;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (allowModify) {\n\t\t\t\t\tevent.data = data;\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\tif (! handlers[i]) {\n\t\t\t\t\t\t// probably un-binded this handler\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// handler is $.Deferred(), call all functions upon completion\n\t\t\t\t\tif (handlers[i].done) {\n\t\t\t\t\t\tdones.push(handlers[i].done);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// set `event.data` only callback has argument\n\t\t\t\t\tif (handlers[i].length) {\n\t\t\t\t\t\tif (!allowModify) {\n\t\t\t\t\t\t\t// to avoid data modifications. remember about \"sharing\" passing arguments in js :) \n\t\t\t\t\t\t\tif (typeof jst === 'undefined') {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tjst = JSON.stringify(data);\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tjst = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tevent.data = jst? JSON.parse(jst) : data;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (handlers[i].call(event, event, this) === false || event.isDefaultPrevented()) {\n\t\t\t\t\t\t\tthis.debug('event-stoped', event.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\twindow.console && window.console.log && window.console.log(ex);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// call done functions\n\t\t\t\tif (l = dones.length) {\n\t\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (dones[i].call(event, event, this) === false || event.isDefaultPrevented()) {\n\t\t\t\t\t\t\t\tthis.debug('event-stoped', event.type + '(done)');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\twindow.console && window.console.log && window.console.log(ex);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.toUnbindEvents[type] && this.toUnbindEvents[type].length) {\n\t\t\t\t\t$.each(this.toUnbindEvents[type], function(i, v) {\n\t\t\t\t\t\tself.unbind(v.type, v.callback);\n\t\t\t\t\t});\n\t\t\t\t\tdelete this.toUnbindEvents[type];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Get event listeners\n\t\t *\n\t\t * @param  String   event type\n\t\t * @return Array    listed event functions\n\t\t */\n\t\tthis.getListeners = function(event) {\n\t\t\treturn event? listeners[event.toLowerCase()] : listeners;\n\t\t};\n\n\t\t// set fm.baseUrl\n\t\tthis.baseUrl = (function() {\n\t\t\tvar myTag, base, baseUrl;\n\t\t\t\n\t\t\tif (self.options.baseUrl) {\n\t\t\t\treturn self.options.baseUrl;\n\t\t\t} else {\n\t\t\t\tbaseUrl = '';\n\t\t\t\tmyTag = null;\n\t\t\t\t$('head > script').each(function() {\n\t\t\t\t\tif (this.src && this.src.match(/js\\/elfinder(?:-[a-z0-9_-]+)?\\.(?:min|full)\\.js$/i)) {\n\t\t\t\t\t\tmyTag = $(this);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (myTag) {\n\t\t\t\t\tbaseUrl = myTag.attr('src').replace(/js\\/[^\\/]+$/, '');\n\t\t\t\t\tif (! baseUrl.match(/^(https?\\/\\/|\\/)/)) {\n\t\t\t\t\t\t// check <base> tag\n\t\t\t\t\t\tif (base = $('head > base[href]').attr('href')) {\n\t\t\t\t\t\t\tbaseUrl = base.replace(/\\/$/, '') + '/' + baseUrl; \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (baseUrl !== '') {\n\t\t\t\t\tself.options.baseUrl = baseUrl;\n\t\t\t\t} else {\n\t\t\t\t\tif (! self.options.baseUrl) {\n\t\t\t\t\t\tself.options.baseUrl = './';\n\t\t\t\t\t}\n\t\t\t\t\tbaseUrl = self.options.baseUrl;\n\t\t\t\t}\n\t\t\t\treturn baseUrl;\n\t\t\t}\n\t\t})();\n\t\t\n\t\tthis.i18nBaseUrl = (this.options.i18nBaseUrl || this.baseUrl + 'js/i18n').replace(/\\/$/, '') + '/';\n\n\t\tthis.options.maxErrorDialogs = Math.max(1, parseInt(this.options.maxErrorDialogs || 5));\n\n\t\t// set dispInlineRegex\n\t\tcwdOptionsDefault.dispInlineRegex = this.options.dispInlineRegex;\n\n\t\t// auto load required CSS\n\t\tif (this.options.cssAutoLoad) {\n\t\t\t(function() {\n\t\t\t\tvar baseUrl = self.baseUrl,\n\t\t\t\t\tmyCss = $('head > link[href$=\"css/elfinder.min.css\"],link[href$=\"css/elfinder.full.css\"]:first').length,\n\t\t\t\t\trmTag = function() {\n\t\t\t\t\t\tif (node.data('cssautoloadHide')) {\n\t\t\t\t\t\t\tnode.data('cssautoloadHide').remove();\n\t\t\t\t\t\t\tnode.removeData('cssautoloadHide');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tloaded = function() {\n\t\t\t\t\t\tif (!self.cssloaded) {\n\t\t\t\t\t\t\trmTag();\n\t\t\t\t\t\t\tself.cssloaded = true;\n\t\t\t\t\t\t\tself.trigger('cssloaded');\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (! myCss) {\n\t\t\t\t\t// to request CSS auto loading\n\t\t\t\t\tself.cssloaded = null;\n\t\t\t\t}\n\n\t\t\t\t// additional CSS files\n\t\t\t\tif (Array.isArray(self.options.cssAutoLoad)) {\n\t\t\t\t\tif (!self.options.themes.default) {\n\t\t\t\t\t\t// set as default theme\n\t\t\t\t\t\tself.options.themes = Object.assign({\n\t\t\t\t\t\t\t'default' : {\n\t\t\t\t\t\t\t\t'name': 'default',\n\t\t\t\t\t\t\t\t'cssurls': self.options.cssAutoLoad\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, self.options.themes);\n\t\t\t\t\t\tif (!self.options.theme) {\n\t\t\t\t\t\t\tself.options.theme = 'default';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (self.cssloaded === true) {\n\t\t\t\t\t\t\tself.loadCss(self.options.cssAutoLoad);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.bind('cssloaded', function() {\n\t\t\t\t\t\t\t\tself.loadCss(self.options.cssAutoLoad);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// try to load main css\n\t\t\t\tif (self.cssloaded === null) {\n\t\t\t\t\t// hide elFinder node while css loading\n\t\t\t\t\tnode.addClass('elfinder')\n\t\t\t\t\t\t.data('cssautoloadHide', $('<style>.elfinder{visibility:hidden;overflow:hidden}</style>'));\n\t\t\t\t\t$('head').append(node.data('cssautoloadHide'));\n\n\t\t\t\t\t// set default theme\n\t\t\t\t\tif (!self.options.themes.default) {\n\t\t\t\t\t\tself.options.themes = Object.assign({\n\t\t\t\t\t\t\t'default' : {\n\t\t\t\t\t\t\t\t'name': 'default',\n\t\t\t\t\t\t\t\t'cssurls': 'css/theme.css',\n\t\t\t\t\t\t\t\t'author': 'elFinder Project',\n\t\t\t\t\t\t\t\t'license': '3-clauses BSD'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, self.options.themes);\n\t\t\t\t\t\tif (!self.options.theme) {\n\t\t\t\t\t\t\tself.options.theme = 'default';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Delay 'visibility' check it required for browsers such as Safari\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tif (node.css('visibility') === 'hidden') {\n\t\t\t\t\t\t\t// load CSS\n\t\t\t\t\t\t\tself.loadCss([baseUrl+'css/elfinder.min.css'], {\n\t\t\t\t\t\t\t\tdfd: $.Deferred().done(function() {\n\t\t\t\t\t\t\t\t\tloaded();\n\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\trmTag();\n\t\t\t\t\t\t\t\t\tif (!self.cssloaded) {\n\t\t\t\t\t\t\t\t\t\tself.cssloaded = false;\n\t\t\t\t\t\t\t\t\t\tself.bind('init', function() {\n\t\t\t\t\t\t\t\t\t\t\tif (!self.cssloaded) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.error(['errRead', 'CSS (elfinder.min)']);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tloaded();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\t// load theme if exists\n\t\t(function() {\n\t\t\tvar theme,\n\t\t\t\tthemes = self.options.themes,\n\t\t\t\tids = Object.keys(themes || {});\n\t\t\tif (ids.length) {\n\t\t\t\ttheme = self.storage('theme') || self.options.theme;\n\t\t\t\tif (!themes[theme]) {\n\t\t\t\t\ttheme = ids[0];\n\t\t\t\t}\n\t\t\t\tif (self.cssloaded) {\n\t\t\t\t\tself.changeTheme(theme);\n\t\t\t\t} else {\n\t\t\t\t\tself.bind('cssloaded', function() {\n\t\t\t\t\t\tself.changeTheme(theme);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t})();\n\t\t\n\t\t/**\n\t\t * Volume option to set the properties of the root Stat\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.optionProperties = {\n\t\t\ticon: void(0),\n\t\t\tcsscls: void(0),\n\t\t\ttmbUrl: void(0),\n\t\t\tuiCmdMap: {},\n\t\t\tnetkey: void(0),\n\t\t\tdisabled: []\n\t\t};\n\t\t\n\t\tif (! inFrame && ! this.options.enableAlways && $('body').children().length === 2) { // only node and beeper\n\t\t\tthis.options.enableAlways = true;\n\t\t}\n\t\t\n\t\t// make options.debug\n\t\tif (this.options.debug === true) {\n\t\t\tthis.options.debug = 'all';\n\t\t} else if (Array.isArray(this.options.debug)) {\n\t\t\t(function() {\n\t\t\t\tvar d = {};\n\t\t\t\t$.each(self.options.debug, function() {\n\t\t\t\t\td[this] = true;\n\t\t\t\t});\n\t\t\t\tself.options.debug = d;\n\t\t\t})();\n\t\t} else {\n\t\t\tthis.options.debug = false;\n\t\t}\n\t\t\n\t\t/**\n\t\t * Original functions evacuated by conflict check\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.noConflicts = {};\n\t\t\n\t\t/**\n\t\t * Check and save conflicts with bootstrap etc\n\t\t * \n\t\t * @type Function\n\t\t */\n\t\tthis.noConflict = function() {\n\t\t\t$.each(conflictChecks, function(i, p) {\n\t\t\t\tif ($.fn[p] && typeof $.fn[p].noConflict === 'function') {\n\t\t\t\t\tself.noConflicts[p] = $.fn[p].noConflict();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t// do check conflict\n\t\tthis.noConflict();\n\t\t\n\t\t/**\n\t\t * Is elFinder over CORS\n\t\t *\n\t\t * @type Boolean\n\t\t **/\n\t\tthis.isCORS = false;\n\t\t\n\t\t// configure for CORS\n\t\t(function(){\n\t\t\tif (typeof self.options.cors !== 'undefined' && self.options.cors !== null) {\n\t\t\t\tself.isCORS = self.options.cors? true : false;\n\t\t\t} else {\n\t\t\t\tvar parseUrl = document.createElement('a'),\n\t\t\t\t\tparseUploadUrl,\n\t\t\t\t\tselfProtocol = window.location.protocol,\n\t\t\t\t\tportReg = function(protocol) {\n\t\t\t\t\t\tprotocol = (!protocol || protocol === ':')? selfProtocol : protocol;\n\t\t\t\t\t\treturn protocol === 'https:'? /\\:443$/ : /\\:80$/;\n\t\t\t\t\t},\n\t\t\t\t\tselfHost = window.location.host.replace(portReg(selfProtocol), '');\n\t\t\t\tparseUrl.href = opts.url;\n\t\t\t\tif (opts.urlUpload && (opts.urlUpload !== opts.url)) {\n\t\t\t\t\tparseUploadUrl = document.createElement('a');\n\t\t\t\t\tparseUploadUrl.href = opts.urlUpload;\n\t\t\t\t}\n\t\t\t\tif (selfHost !== parseUrl.host.replace(portReg(parseUrl.protocol), '')\n\t\t\t\t\t|| (parseUrl.protocol !== ':'&& parseUrl.protocol !== '' && (selfProtocol !== parseUrl.protocol))\n\t\t\t\t\t|| (parseUploadUrl && \n\t\t\t\t\t\t(selfHost !== parseUploadUrl.host.replace(portReg(parseUploadUrl.protocol), '')\n\t\t\t\t\t\t|| (parseUploadUrl.protocol !== ':' && parseUploadUrl.protocol !== '' && (selfProtocol !== parseUploadUrl.protocol))\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tself.isCORS = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (self.isCORS) {\n\t\t\t\tif (!$.isPlainObject(self.options.customHeaders)) {\n\t\t\t\t\tself.options.customHeaders = {};\n\t\t\t\t}\n\t\t\t\tif (!$.isPlainObject(self.options.xhrFields)) {\n\t\t\t\t\tself.options.xhrFields = {};\n\t\t\t\t}\n\t\t\t\tself.options.requestType = 'post';\n\t\t\t\tself.options.customHeaders['X-Requested-With'] = 'XMLHttpRequest';\n\t\t\t\tself.options.xhrFields['withCredentials'] = true;\n\t\t\t}\n\t\t})();\n\n\t\t/**\n\t\t * Ajax request type\n\t\t *\n\t\t * @type String\n\t\t * @default \"get\"\n\t\t **/\n\t\tthis.requestType = /^(get|post)$/i.test(this.options.requestType) ? this.options.requestType.toLowerCase() : 'get';\n\t\t\n\t\t// set `requestMaxConn` by option\n\t\trequestMaxConn = Math.max(parseInt(this.options.requestMaxConn), 1);\n\t\t\n\t\t/**\n\t\t * Custom data that given as options\n\t\t * \n\t\t * @type Object\n\t\t * @default {}\n\t\t */\n\t\tthis.optsCustomData = $.isPlainObject(this.options.customData) ? this.options.customData : {};\n\n\t\t/**\n\t\t * Any data to send across every ajax request\n\t\t *\n\t\t * @type Object\n\t\t * @default {}\n\t\t **/\n\t\tthis.customData = Object.assign({}, this.optsCustomData);\n\n\t\t/**\n\t\t * Previous custom data from connector\n\t\t * \n\t\t * @type Object|null\n\t\t */\n\t\tthis.prevCustomData = null;\n\n\t\t/**\n\t\t * Any custom headers to send across every ajax request\n\t\t *\n\t\t * @type Object\n\t\t * @default {}\n\t\t*/\n\t\tthis.customHeaders = $.isPlainObject(this.options.customHeaders) ? this.options.customHeaders : {};\n\n\t\t/**\n\t\t * Any custom xhrFields to send across every ajax request\n\t\t *\n\t\t * @type Object\n\t\t * @default {}\n\t\t */\n\t\tthis.xhrFields = $.isPlainObject(this.options.xhrFields) ? this.options.xhrFields : {};\n\n\t\t/**\n\t\t * Replace XMLHttpRequest.prototype.send to extended function for 3rd party libs XHR request etc.\n\t\t * \n\t\t * @type Function\n\t\t */\n\t\tthis.replaceXhrSend = function() {\n\t\t\tif (! savedXhrSend) {\n\t\t\t\tsavedXhrSend = XMLHttpRequest.prototype.send;\n\t\t\t}\n\t\t\tXMLHttpRequest.prototype.send = function() {\n\t\t\t\tvar xhr = this;\n\t\t\t\t// set request headers\n\t\t\t\tif (self.customHeaders) {\n\t\t\t\t\t$.each(self.customHeaders, function(key) {\n\t\t\t\t\t\txhr.setRequestHeader(key, this);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// set xhrFields\n\t\t\t\tif (self.xhrFields) {\n\t\t\t\t\t$.each(self.xhrFields, function(key) {\n\t\t\t\t\t\tif (key in xhr) {\n\t\t\t\t\t\t\txhr[key] = this;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn savedXhrSend.apply(this, arguments);\n\t\t\t};\n\t\t};\n\t\t\n\t\t/**\n\t\t * Restore saved original XMLHttpRequest.prototype.send\n\t\t * \n\t\t * @type Function\n\t\t */\n\t\tthis.restoreXhrSend = function() {\n\t\t\tsavedXhrSend && (XMLHttpRequest.prototype.send = savedXhrSend);\n\t\t};\n\n\t\t/**\n\t\t * command names for into queue for only cwd requests\n\t\t * these commands aborts before `open` request\n\t\t *\n\t\t * @type Array\n\t\t * @default ['tmb', 'parents']\n\t\t */\n\t\tthis.abortCmdsOnOpen = this.options.abortCmdsOnOpen || ['tmb', 'parents'];\n\n\t\t/**\n\t\t * ui.nav id prefix\n\t\t * \n\t\t * @type String\n\t\t */\n\t\tthis.navPrefix = 'nav' + (elFinder.prototype.uniqueid? elFinder.prototype.uniqueid : '') + '-';\n\t\t\n\t\t/**\n\t\t * ui.cwd id prefix\n\t\t * \n\t\t * @type String\n\t\t */\n\t\tthis.cwdPrefix = elFinder.prototype.uniqueid? ('cwd' + elFinder.prototype.uniqueid + '-') : '';\n\t\t\n\t\t// Increment elFinder.prototype.uniqueid\n\t\t++elFinder.prototype.uniqueid;\n\t\t\n\t\t/**\n\t\t * URL to upload files\n\t\t *\n\t\t * @type String\n\t\t **/\n\t\tthis.uploadURL = opts.urlUpload || opts.url;\n\t\t\n\t\t/**\n\t\t * Events namespace\n\t\t *\n\t\t * @type String\n\t\t **/\n\t\tthis.namespace = namespace;\n\n\t\t/**\n\t\t * Today timestamp\n\t\t *\n\t\t * @type Number\n\t\t **/\n\t\tthis.today = (new Date(date.getFullYear(), date.getMonth(), date.getDate())).getTime()/1000;\n\t\t\n\t\t/**\n\t\t * Yesterday timestamp\n\t\t *\n\t\t * @type Number\n\t\t **/\n\t\tthis.yesterday = this.today - 86400;\n\t\t\n\t\tutc = this.options.UTCDate ? 'UTC' : '';\n\t\t\n\t\tthis.getHours    = 'get'+utc+'Hours';\n\t\tthis.getMinutes  = 'get'+utc+'Minutes';\n\t\tthis.getSeconds  = 'get'+utc+'Seconds';\n\t\tthis.getDate     = 'get'+utc+'Date';\n\t\tthis.getDay      = 'get'+utc+'Day';\n\t\tthis.getMonth    = 'get'+utc+'Month';\n\t\tthis.getFullYear = 'get'+utc+'FullYear';\n\t\t\n\t\t/**\n\t\t * elFinder node z-index (auto detect on elFinder load)\n\t\t *\n\t\t * @type null | Number\n\t\t **/\n\t\tthis.zIndex;\n\n\t\t/**\n\t\t * Current search status\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.searchStatus = {\n\t\t\tstate  : 0, // 0: search ended, 1: search started, 2: in search result\n\t\t\tquery  : '',\n\t\t\ttarget : '',\n\t\t\tmime   : '',\n\t\t\tmixed  : false, // in multi volumes search: false or Array that target volume ids\n\t\t\tininc  : false // in incremental search\n\t\t};\n\n\t\t/**\n\t\t * Interface language\n\t\t *\n\t\t * @type String\n\t\t * @default \"en\"\n\t\t **/\n\t\tthis.lang = this.storage('lang') || this.options.lang;\n\t\tif (this.lang === 'jp') {\n\t\t\tthis.lang = this.options.lang = 'ja';\n\t\t}\n\n\t\tthis.viewType = this.storage('view') || this.options.defaultView || 'icons';\n\n\t\tthis.sortType = this.storage('sortType') || this.options.sortType || 'name';\n\t\t\n\t\tthis.sortOrder = this.storage('sortOrder') || this.options.sortOrder || 'asc';\n\n\t\tthis.sortStickFolders = this.storage('sortStickFolders');\n\t\tif (this.sortStickFolders === null) {\n\t\t\tthis.sortStickFolders = !!this.options.sortStickFolders;\n\t\t} else {\n\t\t\tthis.sortStickFolders = !!this.sortStickFolders;\n\t\t}\n\n\t\tthis.sortAlsoTreeview = this.storage('sortAlsoTreeview');\n\t\tif (this.sortAlsoTreeview === null || this.options.sortAlsoTreeview === null) {\n\t\t\tthis.sortAlsoTreeview = !!this.options.sortAlsoTreeview;\n\t\t} else {\n\t\t\tthis.sortAlsoTreeview = !!this.sortAlsoTreeview;\n\t\t}\n\n\t\tthis.sortRules = $.extend(true, {}, this._sortRules, this.options.sortRules);\n\t\t\n\t\t$.each(this.sortRules, function(name, method) {\n\t\t\tif (typeof method != 'function') {\n\t\t\t\tdelete self.sortRules[name];\n\t\t\t} \n\t\t});\n\t\t\n\t\tthis.compare = $.proxy(this.compare, this);\n\t\t\n\t\t/**\n\t\t * Delay in ms before open notification dialog\n\t\t *\n\t\t * @type Number\n\t\t * @default 500\n\t\t **/\n\t\tthis.notifyDelay = this.options.notifyDelay > 0 ? parseInt(this.options.notifyDelay) : 500;\n\t\t\n\t\t/**\n\t\t * Dragging UI Helper object\n\t\t *\n\t\t * @type jQuery | null\n\t\t **/\n\t\tthis.draggingUiHelper = null;\n\t\t\n\t\t/**\n\t\t * Base droppable options\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tthis.droppable = {\n\t\t\tgreedy     : true,\n\t\t\ttolerance  : 'pointer',\n\t\t\taccept     : '.elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file,.elfinder-cwd-filename',\n\t\t\thoverClass : this.res('class', 'adroppable'),\n\t\t\tclasses    : { // Deprecated hoverClass jQueryUI>=1.12.0\n\t\t\t\t'ui-droppable-hover': this.res('class', 'adroppable')\n\t\t\t},\n\t\t\tautoDisable: true, // elFinder original, see jquery.elfinder.js\n\t\t\tdrop : function(e, ui) {\n\t\t\t\tvar dst     = $(this),\n\t\t\t\t\ttargets = $.grep(ui.helper.data('files')||[], function(h) { return h? true : false; }),\n\t\t\t\t\tresult  = [],\n\t\t\t\t\tdups    = [],\n\t\t\t\t\tfaults  = [],\n\t\t\t\t\tisCopy  = ui.helper.hasClass('elfinder-drag-helper-plus'),\n\t\t\t\t\tc       = 'class',\n\t\t\t\t\tcnt, hash, i, h;\n\t\t\t\t\n\t\t\t\tif (typeof e.button === 'undefined' || ui.helper.data('namespace') !== namespace || ! self.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (dst.hasClass(self.res(c, 'cwdfile'))) {\n\t\t\t\t\thash = self.cwdId2Hash(dst.attr('id'));\n\t\t\t\t} else if (dst.hasClass(self.res(c, 'navdir'))) {\n\t\t\t\t\thash = self.navId2Hash(dst.attr('id'));\n\t\t\t\t} else {\n\t\t\t\t\thash = cwd;\n\t\t\t\t}\n\n\t\t\t\tcnt = targets.length;\n\t\t\t\t\n\t\t\t\twhile (cnt--) {\n\t\t\t\t\th = targets[cnt];\n\t\t\t\t\t// ignore drop into itself or in own location\n\t\t\t\t\tif (h != hash && files[h].phash != hash) {\n\t\t\t\t\t\tresult.push(h);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t((isCopy && h !== hash && files[hash].write)? dups : faults).push(h);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (faults.length) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tui.helper.data('droped', true);\n\t\t\t\t\n\t\t\t\tif (dups.length) {\n\t\t\t\t\tui.helper.hide();\n\t\t\t\t\tself.exec('duplicate', dups, {_userAction: true});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (result.length) {\n\t\t\t\t\tui.helper.hide();\n\t\t\t\t\tself.clipboard(result, !isCopy);\n\t\t\t\t\tself.exec('paste', hash, {_userAction: true}, hash).always(function(){\n\t\t\t\t\t\tself.clipboard([]);\n\t\t\t\t\t\tself.trigger('unlockfiles', {files : targets});\n\t\t\t\t\t});\n\t\t\t\t\tself.trigger('drop', {files : targets});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if filemanager is active\n\t\t *\n\t\t * @return Boolean\n\t\t **/\n\t\tthis.enabled = function() {\n\t\t\treturn enabled && this.visible();\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if filemanager is visible\n\t\t *\n\t\t * @return Boolean\n\t\t **/\n\t\tthis.visible = function() {\n\t\t\treturn node[0].elfinder && node.is(':visible');\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return file is root?\n\t\t * \n\t\t * @param  Object  target file object\n\t\t * @return Boolean\n\t\t */\n\t\tthis.isRoot = function(file) {\n\t\t\treturn (file.isroot || ! file.phash)? true : false;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return root dir hash for current working directory\n\t\t * \n\t\t * @param  String   target hash\n\t\t * @param  Boolean  include fake parent (optional)\n\t\t * @return String\n\t\t */\n\t\tthis.root = function(hash, fake) {\n\t\t\thash = hash || cwd;\n\t\t\tvar dir, i;\n\t\t\t\n\t\t\tif (! fake) {\n\t\t\t\t$.each(self.roots, function(id, rhash) {\n\t\t\t\t\tif (hash.indexOf(id) === 0) {\n\t\t\t\t\t\tdir = rhash;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (dir) {\n\t\t\t\t\treturn dir;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tdir = files[hash];\n\t\t\twhile (dir && dir.phash && (fake || ! dir.isroot)) {\n\t\t\t\tdir = files[dir.phash];\n\t\t\t}\n\t\t\tif (dir) {\n\t\t\t\treturn dir.hash;\n\t\t\t}\n\t\t\t\n\t\t\twhile (i in files && files.hasOwnProperty(i)) {\n\t\t\t\tdir = files[i];\n\t\t\t\tif (dir.mime === 'directory' && !dir.phash && dir.read) {\n\t\t\t\t\treturn dir.hash;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn '';\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return current working directory info\n\t\t * \n\t\t * @return Object\n\t\t */\n\t\tthis.cwd = function() {\n\t\t\treturn files[cwd] || {};\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return required cwd option\n\t\t * \n\t\t * @param  String  option name\n\t\t * @param  String  target hash (optional)\n\t\t * @return mixed\n\t\t */\n\t\tthis.option = function(name, target) {\n\t\t\tvar res, item;\n\t\t\ttarget = target || cwd;\n\t\t\tif (self.optionsByHashes[target] && typeof self.optionsByHashes[target][name] !== 'undefined') {\n\t\t\t\treturn self.optionsByHashes[target][name];\n\t\t\t}\n\t\t\tif (self.hasVolOptions && cwd !== target && (!(item = self.file(target)) || item.phash !== cwd)) {\n\t\t\t\tres = '';\n\t\t\t\t$.each(self.volOptions, function(id, opt) {\n\t\t\t\t\tif (target.indexOf(id) === 0) {\n\t\t\t\t\t\tres = opt[name] || '';\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn res;\n\t\t\t} else {\n\t\t\t\treturn cwdOptions[name] || '';\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return disabled commands by each folder\n\t\t * \n\t\t * @param  Array  target hashes\n\t\t * @return Array\n\t\t */\n\t\tthis.getDisabledCmds = function(targets, flip) {\n\t\t\tvar disabled = {'hidden': true};\n\t\t\tif (! Array.isArray(targets)) {\n\t\t\t\ttargets = [ targets ];\n\t\t\t}\n\t\t\t$.each(targets, function(i, h) {\n\t\t\t\tvar disCmds = self.option('disabledFlip', h);\n\t\t\t\tif (disCmds) {\n\t\t\t\t\tObject.assign(disabled, disCmds);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn flip? disabled : Object.keys(disabled);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return file data from current dir or tree by it's hash\n\t\t * \n\t\t * @param  String  file hash\n\t\t * @return Object\n\t\t */\n\t\tthis.file = function(hash, alsoHidden) { \n\t\t\treturn hash? (files[hash] || (alsoHidden? hiddenFiles[hash] : void(0))) : void(0); \n\t\t};\n\t\t\n\t\t/**\n\t\t * Return all cached files\n\t\t * \n\t\t * @param  String  parent hash\n\t\t * @return Object\n\t\t */\n\t\tthis.files = function(phash) {\n\t\t\tvar items = {};\n\t\t\tif (phash) {\n\t\t\t\tif (!ownFiles[phash]) {\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t\t$.each(ownFiles[phash], function(h) {\n\t\t\t\t\tif (files[h]) {\n\t\t\t\t\t\titems[h] = files[h];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete ownFiles[phash][h];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn Object.assign({}, items);\n\t\t\t}\n\t\t\treturn Object.assign({}, files);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return list of file parents hashes include file hash\n\t\t * \n\t\t * @param  String  file hash\n\t\t * @return Array\n\t\t */\n\t\tthis.parents = function(hash) {\n\t\t\tvar parents = [],\n\t\t\t\tdir;\n\t\t\t\n\t\t\twhile (hash && (dir = this.file(hash))) {\n\t\t\t\tparents.unshift(dir.hash);\n\t\t\t\thash = dir.phash;\n\t\t\t}\n\t\t\treturn parents;\n\t\t};\n\t\t\n\t\tthis.path2array = function(hash, i18) {\n\t\t\tvar file, \n\t\t\t\tpath = [];\n\t\t\t\t\n\t\t\twhile (hash) {\n\t\t\t\tif ((file = files[hash]) && file.hash) {\n\t\t\t\t\tpath.unshift(i18 && file.i18 ? file.i18 : file.name);\n\t\t\t\t\thash = file.isroot? null : file.phash;\n\t\t\t\t} else {\n\t\t\t\t\tpath = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t\n\t\t\treturn path;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return file path or Get path async with jQuery.Deferred\n\t\t * \n\t\t * @param  Object  file\n\t\t * @param  Boolean i18\n\t\t * @param  Object  asyncOpt\n\t\t * @return String|jQuery.Deferred\n\t\t */\n\t\tthis.path = function(hash, i18, asyncOpt) { \n\t\t\tvar path = files[hash] && files[hash].path\n\t\t\t\t? files[hash].path\n\t\t\t\t: this.path2array(hash, i18).join(cwdOptions.separator);\n\t\t\tif (! asyncOpt || ! files[hash]) {\n\t\t\t\treturn path;\n\t\t\t} else {\n\t\t\t\tasyncOpt = Object.assign({notify: {type : 'parents', cnt : 1, hideCnt : true}}, asyncOpt);\n\t\t\t\t\n\t\t\t\tvar dfd    = $.Deferred(),\n\t\t\t\t\tnotify = asyncOpt.notify,\n\t\t\t\t\tnoreq  = false,\n\t\t\t\t\treq    = function() {\n\t\t\t\t\t\tself.request({\n\t\t\t\t\t\t\tdata : {cmd : 'parents', target : files[hash].phash},\n\t\t\t\t\t\t\tnotify : notify,\n\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(done)\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tdone   = function() {\n\t\t\t\t\t\tself.one('parentsdone', function() {\n\t\t\t\t\t\t\tpath = self.path(hash, i18);\n\t\t\t\t\t\t\tif (path === '' && noreq) {\n\t\t\t\t\t\t\t\t//retry with request\n\t\t\t\t\t\t\t\tnoreq = false;\n\t\t\t\t\t\t\t\treq();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (notify) {\n\t\t\t\t\t\t\t\t\tclearTimeout(ntftm);\n\t\t\t\t\t\t\t\t\tnotify.cnt = -(parseInt(notify.cnt || 0));\n\t\t\t\t\t\t\t\t\tself.notify(notify);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdfd.resolve(path);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tntftm;\n\t\t\t\n\t\t\t\tif (path) {\n\t\t\t\t\treturn dfd.resolve(path);\n\t\t\t\t} else {\n\t\t\t\t\tif (self.ui['tree']) {\n\t\t\t\t\t\t// try as no request\n\t\t\t\t\t\tif (notify) {\n\t\t\t\t\t\t\tntftm = setTimeout(function() {\n\t\t\t\t\t\t\t\tself.notify(notify);\n\t\t\t\t\t\t\t}, self.notifyDelay);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnoreq = true;\n\t\t\t\t\t\tdone(true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treq();\n\t\t\t\t\t}\n\t\t\t\t\treturn dfd;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return file url if set\n\t\t * \n\t\t * @param  String  file hash\n\t\t * @param  Object  Options\n\t\t * @return String|Object of jQuery Deferred\n\t\t */\n\t\tthis.url = function(hash, o) {\n\t\t\tvar file   = files[hash],\n\t\t\t\topts   = o || {},\n\t\t\t\tasync  = opts.async || false,\n\t\t\t\ttemp   = opts.temporary || false,\n\t\t\t\tonetm  = (opts.onetime && self.option('onetimeUrl', hash)) || false,\n\t\t\t\tabsurl = opts.absurl || false,\n\t\t\t\tdfrd   = (async || onetm)? $.Deferred() : null,\n\t\t\t\tfilter = function(url) {\n\t\t\t\t\tif (url && absurl) {\n\t\t\t\t\t\turl = self.convAbsUrl(url);\n\t\t\t\t\t}\n\t\t\t\t\treturn url;\n\t\t\t\t},\n\t\t\t\tgetUrl = function(url) {\n\t\t\t\t\tif (url) {\n\t\t\t\t\t\treturn filter(url);\n\t\t\t\t\t}\n\t\t\t\t\tif (file.url) {\n\t\t\t\t\t\treturn filter(file.url);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (typeof baseUrl === 'undefined') {\n\t\t\t\t\t\tbaseUrl = getBaseUrl();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (baseUrl) {\n\t\t\t\t\t\treturn filter(baseUrl + $.map(self.path2array(hash), function(n) { return encodeURIComponent(n); }).slice(1).join('/'));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar params = Object.assign({}, self.customData, {\n\t\t\t\t\t\tcmd: 'file',\n\t\t\t\t\t\ttarget: file.hash\n\t\t\t\t\t});\n\t\t\t\t\tif (self.oldAPI) {\n\t\t\t\t\t\tparams.cmd = 'open';\n\t\t\t\t\t\tparams.current = file.phash;\n\t\t\t\t\t}\n\t\t\t\t\treturn filter(self.options.url + (self.options.url.indexOf('?') === -1 ? '?' : '&') + $.param(params, true));\n\t\t\t\t},\n\t\t\t\tgetBaseUrl = function() {\n\t\t\t\t\treturn self.option('url', (!self.isRoot(file) && file.phash) || file.hash);\n\t\t\t\t},\n\t\t\t\tbaseUrl, res;\n\t\t\t\n\t\t\tif (!file || !file.read) {\n\t\t\t\treturn async? dfrd.resolve('') : '';\n\t\t\t}\n\t\t\t\n\t\t\tif (onetm && (!file.url || file.url == '1') && !(baseUrl = getBaseUrl())) {\n\t\t\t\tasync = true;\n\t\t\t\tthis.request({\n\t\t\t\t\tdata : { cmd : 'url', target : hash, options : { onetime: 1 } },\n\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\toptions: {async: async},\n\t\t\t\t\tnotify: {type : 'file', cnt : 1, hideCnt : true},\n\t\t\t\t\tprogressBar: opts.progressBar\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tdfrd.resolve(filter(data.url || ''));\n\t\t\t\t}).fail(function() {\n\t\t\t\t\tdfrd.resolve('');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (file.url == '1' || (temp && !file.url && !(baseUrl = getBaseUrl()))) {\n\t\t\t\t\tthis.request({\n\t\t\t\t\t\tdata : { cmd : 'url', target : hash, options : { temporary: temp? 1 : 0 } },\n\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\toptions: {async: async},\n\t\t\t\t\t\tnotify: async? {type : temp? 'file' : 'url', cnt : 1, hideCnt : true} : {},\n\t\t\t\t\t\tprogressBar: opts.progressBar\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tfile.url = data.url || '';\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\tfile.url = '';\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tvar url;\n\t\t\t\t\t\tif (file.url && temp) {\n\t\t\t\t\t\t\turl = file.url;\n\t\t\t\t\t\t\tfile.url = '1'; // restore\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (async) {\n\t\t\t\t\t\t\tdfrd.resolve(getUrl(url));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn getUrl(url);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (async) {\n\t\t\t\t\t\tdfrd.resolve(getUrl());\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn getUrl();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (async) {\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return file url for the extarnal service\n\t\t *\n\t\t * @param      String  hash     The hash\n\t\t * @param      Object  options  The options\n\t\t * @return     Object  jQuery Deferred\n\t\t */\n\t\tthis.forExternalUrl = function(hash, options) {\n\t\t\tvar onetime = self.option('onetimeUrl', hash),\n\t\t\t\topts = {\n\t\t\t\t\tasync: true,\n\t\t\t\t\tabsurl: true\n\t\t\t\t};\n\n\t\t\topts[onetime? 'onetime' : 'temporary'] = true;\n\t\t\treturn self.url(hash, Object.assign({}, options, opts));\n\t\t};\n\n\t\t/**\n\t\t * Return file url for open in elFinder\n\t\t * \n\t\t * @param  String  file hash\n\t\t * @param  Boolean for download link\n\t\t * @param      Object  requestOpts   The request options\n\t\t * @return String\n\t\t */\n\t\tthis.openUrl = function(hash, download, callback, requestOpts) {\n\t\t\tvar file = files[hash],\n\t\t\t\turl  = '',\n\t\t\t\tonetimeSize = (requestOpts || {}).onetimeSize || (5 * 1024 * 1024);\n\t\t\t\n\t\t\tif (!file || !file.read) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t\n\t\t\tif (!download || download === 'sameorigin') {\n\t\t\t\tif (file.url) {\n\t\t\t\t\tif (file.url != 1) {\n\t\t\t\t\t\turl = file.url;\n\t\t\t\t\t}\n\t\t\t\t} else if (cwdOptions.url && file.hash.indexOf(self.cwd().volumeid) === 0) {\n\t\t\t\t\turl = cwdOptions.url + $.map(this.path2array(hash), function(n) { return encodeURIComponent(n); }).slice(1).join('/');\n\t\t\t\t}\n\t\t\t\tif (!download || this.isSameOrigin(url)) {\n\t\t\t\t\tif (url) {\n\t\t\t\t\t\turl += (url.match(/\\?/)? '&' : '?') + '_'.repeat((url.match(/[\\?&](_+)t=/g) || ['&t=']).sort().shift().match(/[\\?&](_*)t=/)[1].length + 1) + 't=' + (file.ts || parseInt(+new Date()/1000));\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback(url);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn url;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (callback && this.hasParrotHeaders()) {\n\t\t\t\tif (!requestOpts) {\n\t\t\t\t\trequestOpts = {};\n\t\t\t\t} else {\n\t\t\t\t\tdelete requestOpts.onetimeSize;\n\t\t\t\t}\n\t\t\t\tif (!requestOpts.onetime && !requestOpts.temporary && file.size > onetimeSize) {\n\t\t\t\t\tif (file.mime.match(/^video|audio/)) {\n\t\t\t\t\t\trequestOpts.temporary = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trequestOpts.onetime = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (requestOpts.onetime || requestOpts.temporary) {\n\t\t\t\t\treturn this.url(file.hash, Object.assign({\n\t\t\t\t\t\tasync: true\n\t\t\t\t\t}, requestOpts)).done(function(url) {\n\t\t\t\t\t\tcallback(url);\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tcallback('');\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn this.getContents(hash, 'blob', requestOpts).done(function(blob){\n\t\t\t\t\t\turl = (window.URL || window.webkitURL).createObjectURL(blob);\n\t\t\t\t\t\tcallback(url);\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tcallback('');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\turl = this.options.url;\n\t\t\t\turl = url + (url.indexOf('?') === -1 ? '?' : '&')\n\t\t\t\t\t+ (this.oldAPI ? 'cmd=open&current='+file.phash : 'cmd=file')\n\t\t\t\t\t+ '&target=' + file.hash\n\t\t\t\t\t+ '&_t=' + (file.ts || parseInt(+new Date()/1000));\n\t\t\t\t\n\t\t\t\tif (download === true) {\n\t\t\t\t\turl += '&download=1';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(this.customData, function(key, val) {\n\t\t\t\t\turl += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(val);\n\t\t\t\t});\n\t\t\t\tif (callback) {\n\t\t\t\t\tcallback(url);\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\treturn url;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return thumbnail url\n\t\t * \n\t\t * @param  Object  file object\n\t\t * @return String\n\t\t */\n\t\tthis.tmb = function(file) {\n\t\t\tvar tmbUrl, tmbCrop,\n\t\t\t\tcls    = 'elfinder-cwd-bgurl',\n\t\t\t\turl    = '',\n\t\t\t\tcData  = {},\n\t\t\t\tn      = 0;\n\n\t\t\tif ($.isPlainObject(file)) {\n\t\t\t\tif (self.searchStatus.state && file.hash.indexOf(self.cwd().volumeid) !== 0) {\n\t\t\t\t\ttmbUrl = self.option('tmbUrl', file.hash);\n\t\t\t\t\ttmbCrop = self.option('tmbCrop', file.hash);\n\t\t\t\t} else {\n\t\t\t\t\ttmbUrl = cwdOptions.tmbUrl;\n\t\t\t\t\ttmbCrop = cwdOptions.tmbCrop;\n\t\t\t\t}\n\t\t\t\tif (tmbCrop) {\n\t\t\t\t\tcls += ' elfinder-cwd-bgurl-crop';\n\t\t\t\t}\n\t\t\t\tif (tmbUrl === 'self' && file.mime.indexOf('image/') === 0) {\n\t\t\t\t\turl = self.openUrl(file.hash);\n\t\t\t\t\tcls += ' elfinder-cwd-bgself';\n\t\t\t\t} else if ((self.oldAPI || tmbUrl) && file && file.tmb && file.tmb != 1) {\n\t\t\t\t\turl = tmbUrl + file.tmb;\n\t\t\t\t} else if (self.newAPI && file && file.tmb && file.tmb != 1) {\n\t\t\t\t\turl = file.tmb;\n\t\t\t\t}\n\t\t\t\tif (url) {\n\t\t\t\t\tif (tmbUrl !== 'self') {\n\t\t\t\t\t\tif (file.ts) {\n\t\t\t\t\t\t\tcData._t = file.ts;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cwdOptions.tmbReqCustomData && Object.keys(this.customData).length) {\n\t\t\t\t\t\t\tcData = Object.assign(cData, this.customData);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Object.keys(cData).length) {\n\t\t\t\t\t\t\turl += (url.match(/\\?/) ? '&' : '?');\n\t\t\t\t\t\t\t$.each(cData, function (key, val) {\n\t\t\t\t\t\t\t\turl += ((n++ === 0)? '' : '&') + encodeURIComponent(key) + '=' + encodeURIComponent(val);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn { url: url, className: cls };\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn false;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return selected files hashes\n\t\t *\n\t\t * @return Array\n\t\t **/\n\t\tthis.selected = function() {\n\t\t\treturn selected.slice(0);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return selected files info\n\t\t * \n\t\t * @return Array\n\t\t */\n\t\tthis.selectedFiles = function() {\n\t\t\treturn $.map(selected, function(hash) { return files[hash] ? Object.assign({}, files[hash]) : null; });\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if file with required name existsin required folder\n\t\t * \n\t\t * @param  String  file name\n\t\t * @param  String  parent folder hash\n\t\t * @return Boolean\n\t\t */\n\t\tthis.fileByName = function(name, phash) {\n\t\t\tvar hash;\n\t\t\n\t\t\tfor (hash in files) {\n\t\t\t\tif (files.hasOwnProperty(hash) && files[hash].phash == phash && files[hash].name == name) {\n\t\t\t\t\treturn files[hash];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Valid data for required command based on rules\n\t\t * \n\t\t * @param  String  command name\n\t\t * @param  Object  cammand's data\n\t\t * @return Boolean\n\t\t */\n\t\tthis.validResponse = function(cmd, data) {\n\t\t\treturn data.error || this.rules[this.rules[cmd] ? cmd : 'defaults'](data);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return bytes from ini formated size\n\t\t * \n\t\t * @param  String  ini formated size\n\t\t * @return Integer\n\t\t */\n\t\tthis.returnBytes = function(val) {\n\t\t\tvar last;\n\t\t\tif (isNaN(val)) {\n\t\t\t\tif (! val) {\n\t\t\t\t\tval = '';\n\t\t\t\t}\n\t\t\t\t// for ex. 1mb, 1KB\n\t\t\t\tval = val.replace(/b$/i, '');\n\t\t\t\tlast = val.charAt(val.length - 1).toLowerCase();\n\t\t\t\tval = val.replace(/[tgmk]$/i, '');\n\t\t\t\tif (last == 't') {\n\t\t\t\t\tval = val * 1024 * 1024 * 1024 * 1024;\n\t\t\t\t} else if (last == 'g') {\n\t\t\t\t\tval = val * 1024 * 1024 * 1024;\n\t\t\t\t} else if (last == 'm') {\n\t\t\t\t\tval = val * 1024 * 1024;\n\t\t\t\t} else if (last == 'k') {\n\t\t\t\t\tval = val * 1024;\n\t\t\t\t}\n\t\t\t\tval = isNaN(val)? 0 : parseInt(val);\n\t\t\t} else {\n\t\t\t\tval = parseInt(val);\n\t\t\t\tif (val < 1) val = 0;\n\t\t\t}\n\t\t\treturn val;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Process ajax request.\n\t\t * Fired events :\n\t\t * @todo\n\t\t * @example\n\t\t * @todo\n\t\t * @return $.Deferred\n\t\t */\n\t\tthis.request = function(opts) { \n\t\t\tvar self     = this,\n\t\t\t\to        = this.options,\n\t\t\t\tdfrd     = $.Deferred(),\n\t\t\t\t// request ID\n\t\t\t\treqId    = (+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16), \n\t\t\t\t// request data\n\t\t\t\tdata     = Object.assign({}, self.customData, {mimes : o.onlyMimes}, opts.data || opts),\n\t\t\t\t// command name\n\t\t\t\tcmd      = data.cmd,\n\t\t\t\t// request type is binary\n\t\t\t\tisBinary = (opts.options || {}).dataType === 'binary',\n\t\t\t\t// current cmd is \"open\"\n\t\t\t\tisOpen   = (!opts.asNotOpen && cmd === 'open'),\n\t\t\t\t// call default fail callback (display error dialog) ?\n\t\t\t\tdeffail  = !(isBinary || opts.preventDefault || opts.preventFail),\n\t\t\t\t// call default success callback ?\n\t\t\t\tdefdone  = !(isBinary || opts.preventDefault || opts.preventDone),\n\t\t\t\t// current progress of receive data\n\t\t\t\tprog     = opts.progressVal || 20,\n\t\t\t\t// timer of fake progress\n\t\t\t\tprogTm   = null,\n\t\t\t\t// whether the notification dialog is currently displayed\n\t\t\t\thasNotify= false,\n\t\t\t\t// options for notify dialog\n\t\t\t\tnotify   = !opts.progressBar? (opts.notify? Object.assign({progress: prog * opts.notify.cnt}, opts.notify) : {}) : {},\n\t\t\t\t// make cancel button\n\t\t\t\tcancel   = !!opts.cancel,\n\t\t\t\t// do not normalize data - return as is\n\t\t\t\traw      = isBinary || !!opts.raw,\n\t\t\t\t// sync files on request fail\n\t\t\t\tsyncOnFail = opts.syncOnFail,\n\t\t\t\t// use lazy()\n\t\t\t\tlazy     = !!opts.lazy,\n\t\t\t\t// prepare function before done()\n\t\t\t\tprepare  = opts.prepare,\n\t\t\t\t// navigate option object when cmd done\n\t\t\t\tnavigate = opts.navigate,\n\t\t\t\t// open notify dialog timeout\n\t\t\t\ttimeout,\n\t\t\t\t// use browser cache\n\t\t\t\tuseCache = (opts.options || {}).cache,\n\t\t\t\t// request options\n\t\t\t\toptions = Object.assign({\n\t\t\t\t\turl      : o.url,\n\t\t\t\t\tasync    : true,\n\t\t\t\t\ttype     : this.requestType,\n\t\t\t\t\tdataType : 'json',\n\t\t\t\t\tcache    : (self.api >= 2.1029), // api >= 2.1029 has unique request ID\n\t\t\t\t\tdata     : data,\n\t\t\t\t\theaders  : this.customHeaders,\n\t\t\t\t\txhrFields: this.xhrFields,\n\t\t\t\t\tprogress : function(e) {\n\t\t\t\t\t\tvar p = e.loaded / e.total * 100;\n\t\t\t\t\t\tprogTm && clearTimeout(progTm);\n\t\t\t\t\t\tif (opts.progressBar) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\topts.progressBar.width(p + '%');\n\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (hasNotify && notify.type) {\n\t\t\t\t\t\t\t\tp = p * notify.cnt;\n\t\t\t\t\t\t\t\tif (prog < p) {\n\t\t\t\t\t\t\t\t\tself.notify({\n\t\t\t\t\t\t\t\t\t\ttype: notify.type,\n\t\t\t\t\t\t\t\t\t\tprogress: p - prog,\n\t\t\t\t\t\t\t\t\t\tcnt: 0,\n\t\t\t\t\t\t\t\t\t\thideCnt: notify.hideCnt\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tprog = p;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.progress) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\topts.progress(e);\n\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, opts.options || {}),\n\t\t\t\t/**\n\t\t\t\t * Default success handler. \n\t\t\t\t * Call default data handlers and fire event with command name.\n\t\t\t\t *\n\t\t\t\t * @param Object  normalized response data\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tdone = function(data) {\n\t\t\t\t\tdata.warning && self.error(data.warning);\n\t\t\t\t\t\n\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\topen(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.updateCache(data);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tself.lazy(function() {\n\t\t\t\t\t\t// fire some event to update cache/ui\n\t\t\t\t\t\tdata.removed && data.removed.length && self.remove(data);\n\t\t\t\t\t\tdata.added   && data.added.length   && self.add(data);\n\t\t\t\t\t\tdata.changed && data.changed.length && self.change(data);\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t// fire event with command name\n\t\t\t\t\t\treturn self.lazy(function() {\n\t\t\t\t\t\t\tself.trigger(cmd, data, false);\n\t\t\t\t\t\t});\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t// fire event with command name + 'done'\n\t\t\t\t\t\treturn self.lazy(function() {\n\t\t\t\t\t\t\tself.trigger(cmd + 'done');\n\t\t\t\t\t\t});\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t// make toast message\n\t\t\t\t\t\tif (data.toasts && Array.isArray(data.toasts)) {\n\t\t\t\t\t\t\t$.each(data.toasts, function() {\n\t\t\t\t\t\t\t\tthis.msg && self.toast(this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// force update content\n\t\t\t\t\t\tdata.sync && self.sync();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Request error handler. Reject dfrd with correct error message.\n\t\t\t\t *\n\t\t\t\t * @param jqxhr  request object\n\t\t\t\t * @param String request status\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\terror = function(xhr, status) {\n\t\t\t\t\tvar error, data, \n\t\t\t\t\t\td = self.options.debug;\n\t\t\t\t\t\n\t\t\t\t\tswitch (status) {\n\t\t\t\t\t\tcase 'abort':\n\t\t\t\t\t\t\terror = xhr.quiet ? '' : ['errConnect', 'errAbort'];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'timeout':\t    \n\t\t\t\t\t\t\terror = ['errConnect', 'errTimeout'];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'parsererror': \n\t\t\t\t\t\t\terror = ['errResponse', 'errDataNotJSON'];\n\t\t\t\t\t\t\tif (xhr.responseText) {\n\t\t\t\t\t\t\t\tif (! cwd || (d && (d === 'all' || d['backend-error']))) {\n\t\t\t\t\t\t\t\t\terror.push(xhr.responseText);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tif (xhr.responseText) {\n\t\t\t\t\t\t\t\t// check responseText, Is that JSON?\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tdata = JSON.parse(xhr.responseText);\n\t\t\t\t\t\t\t\t\tif (data && data.error) {\n\t\t\t\t\t\t\t\t\t\terror = data.error;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (! error) {\n\t\t\t\t\t\t\t\tif (xhr.status == 403) {\n\t\t\t\t\t\t\t\t\terror = ['errConnect', 'errAccess', 'HTTP error ' + xhr.status];\n\t\t\t\t\t\t\t\t} else if (xhr.status == 404) {\n\t\t\t\t\t\t\t\t\terror = ['errConnect', 'errNotFound', 'HTTP error ' + xhr.status];\n\t\t\t\t\t\t\t\t} else if (xhr.status >= 500) {\n\t\t\t\t\t\t\t\t\terror = ['errResponse', 'errServerError', 'HTTP error ' + xhr.status];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (xhr.status == 414 && options.type === 'get') {\n\t\t\t\t\t\t\t\t\t\t// retry by POST method\n\t\t\t\t\t\t\t\t\t\toptions.type = 'post';\n\t\t\t\t\t\t\t\t\t\tself.abortXHR(xhr);\n\t\t\t\t\t\t\t\t\t\tdfrd.xhr = xhr = self.transport.send(options).fail(error).done(success);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\terror = xhr.quiet ? '' : ['errConnect', 'HTTP error ' + xhr.status];\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tself.trigger(cmd + 'done');\n\t\t\t\t\tdfrd.reject({error: error}, xhr, status);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Request success handler. Valid response data and reject/resolve dfrd.\n\t\t\t\t *\n\t\t\t\t * @param Object  response data\n\t\t\t\t * @param String request status\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tsuccess = function(response) {\n\t\t\t\t\t// Set currrent request command name\n\t\t\t\t\tself.currentReqCmd = cmd;\n\t\t\t\t\t\n\t\t\t\t\tresponse.debug && self.responseDebug(response);\n\t\t\t\t\t\n\t\t\t\t\tself.setCustomHeaderByXhr(xhr);\n\n\t\t\t\t\tif (raw) {\n\t\t\t\t\t\tself.abortXHR(xhr);\n\t\t\t\t\t\tresponse && response.debug && self.debug('backend-debug', response);\n\t\t\t\t\t\treturn dfrd.resolve(response);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!response) {\n\t\t\t\t\t\treturn dfrd.reject({error :['errResponse', 'errDataEmpty']}, xhr, response);\n\t\t\t\t\t} else if (!$.isPlainObject(response)) {\n\t\t\t\t\t\treturn dfrd.reject({error :['errResponse', 'errDataNotJSON']}, xhr, response);\n\t\t\t\t\t} else if (response.error) {\n\t\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\t\t// check leafRoots\n\t\t\t\t\t\t\t$.each(self.leafRoots, function(phash, roots) {\n\t\t\t\t\t\t\t\tself.leafRoots[phash] = $.grep(roots, function(h) { return h !== data.target; });\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfrd.reject({error :response.error}, xhr, response);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar resolve = function() {\n\t\t\t\t\t\tvar pushLeafRoots = function(name) {\n\t\t\t\t\t\t\tif (self.leafRoots[data.target] && response[name]) {\n\t\t\t\t\t\t\t\t$.each(self.leafRoots[data.target], function(i, h) {\n\t\t\t\t\t\t\t\t\tvar root;\n\t\t\t\t\t\t\t\t\tif (root = self.file(h)) {\n\t\t\t\t\t\t\t\t\t\tresponse[name].push(root);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetTextMimes = function() {\n\t\t\t\t\t\t\tself.textMimes = {};\n\t\t\t\t\t\t\t$.each(self.res('mimes', 'text'), function() {\n\t\t\t\t\t\t\t\tself.textMimes[this.toLowerCase()] = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tactionTarget;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\t\tpushLeafRoots('files');\n\t\t\t\t\t\t} else if (cmd === 'tree') {\n\t\t\t\t\t\t\tpushLeafRoots('tree');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tresponse = self.normalize(response);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!self.validResponse(cmd, response)) {\n\t\t\t\t\t\t\treturn dfrd.reject({error :(response.norError || 'errResponse')}, xhr, response);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\t\tif (!self.api) {\n\t\t\t\t\t\t\t\tself.api    = response.api || 1;\n\t\t\t\t\t\t\t\tif (self.api == '2.0' && typeof response.options.uploadMaxSize !== 'undefined') {\n\t\t\t\t\t\t\t\t\tself.api = '2.1';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tself.newAPI = self.api >= 2;\n\t\t\t\t\t\t\t\tself.oldAPI = !self.newAPI;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (response.textMimes && Array.isArray(response.textMimes)) {\n\t\t\t\t\t\t\t\tself.resources.mimes.text = response.textMimes;\n\t\t\t\t\t\t\t\tsetTextMimes();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t!self.textMimes && setTextMimes();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (response.options) {\n\t\t\t\t\t\t\t\tcwdOptions = Object.assign({}, cwdOptionsDefault, response.options);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (response.netDrivers) {\n\t\t\t\t\t\t\t\tself.netDrivers = response.netDrivers;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (response.maxTargets) {\n\t\t\t\t\t\t\t\tself.maxTargets = response.maxTargets;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!!data.init) {\n\t\t\t\t\t\t\t\tself.uplMaxSize = self.returnBytes(response.uplMaxSize);\n\t\t\t\t\t\t\t\tself.uplMaxFile = !!response.uplMaxFile? Math.min(parseInt(response.uplMaxFile), 50) : 20;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof prepare === 'function') {\n\t\t\t\t\t\t\tprepare(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (navigate) {\n\t\t\t\t\t\t\tactionTarget = navigate.target || 'added';\n\t\t\t\t\t\t\tif (response[actionTarget] && response[actionTarget].length) {\n\t\t\t\t\t\t\t\tself.one(cmd + 'done', function() {\n\t\t\t\t\t\t\t\t\tvar targets  = response[actionTarget],\n\t\t\t\t\t\t\t\t\t\tnewItems = self.findCwdNodes(targets),\n\t\t\t\t\t\t\t\t\t\tinCwdHashes = function() {\n\t\t\t\t\t\t\t\t\t\t\tvar cwdHash = self.cwd().hash;\n\t\t\t\t\t\t\t\t\t\t\treturn $.map(targets, function(f) { return (f.phash && cwdHash === f.phash)? f.hash : null; });\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\thashes   = inCwdHashes(),\n\t\t\t\t\t\t\t\t\t\tmakeToast  = function(t) {\n\t\t\t\t\t\t\t\t\t\t\tvar node = void(0),\n\t\t\t\t\t\t\t\t\t\t\t\tdata = t.action? t.action.data : void(0),\n\t\t\t\t\t\t\t\t\t\t\t\tcmd, msg, done;\n\t\t\t\t\t\t\t\t\t\t\tif ((data || hashes.length) && t.action && (msg = t.action.msg) && (cmd = t.action.cmd) && (!t.action.cwdNot || t.action.cwdNot !== self.cwd().hash)) {\n\t\t\t\t\t\t\t\t\t\t\t\tdone = t.action.done;\n\t\t\t\t\t\t\t\t\t\t\t\tdata = t.action.data;\n\t\t\t\t\t\t\t\t\t\t\t\tnode = $('<div/>')\n\t\t\t\t\t\t\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('<button type=\"button\" class=\"ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop\"><span class=\"ui-button-text\">'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+self.i18n(msg)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+'</span></button>')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.on('mouseenter mouseleave', function(e) { \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type == 'mouseenter');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.exec(cmd, data || hashes, {_userAction: true, _currentType: 'toast', _currentNode: $(this) });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (done) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.one(cmd+'done', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof done === 'function') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (done === 'select') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.trigger('selectfiles', {files : inCwdHashes()});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdelete t.action;\n\t\t\t\t\t\t\t\t\t\t\tt.extNode = node;\n\t\t\t\t\t\t\t\t\t\t\treturn t;\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (! navigate.toast) {\n\t\t\t\t\t\t\t\t\t\tnavigate.toast = {};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t!navigate.noselect && self.trigger('selectfiles', {files : self.searchStatus.state > 1 ? $.map(targets, function(f) { return f.hash; }) : hashes});\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (newItems.length) {\n\t\t\t\t\t\t\t\t\t\tif (!navigate.noscroll) {\n\t\t\t\t\t\t\t\t\t\t\tnewItems.first().trigger('scrolltoview', {blink : false});\n\t\t\t\t\t\t\t\t\t\t\tself.resources.blink(newItems, 'lookme');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif ($.isPlainObject(navigate.toast.incwd)) {\n\t\t\t\t\t\t\t\t\t\t\tself.toast(makeToast(navigate.toast.incwd));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif ($.isPlainObject(navigate.toast.inbuffer)) {\n\t\t\t\t\t\t\t\t\t\t\tself.toast(makeToast(navigate.toast.inbuffer));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdfrd.resolve(response);\n\t\t\t\t\t\t\n\t\t\t\t\t\tresponse.debug && self.debug('backend-debug', response);\n\t\t\t\t\t};\n\t\t\t\t\tself.abortXHR(xhr);\n\t\t\t\t\tlazy? self.lazy(resolve) : resolve();\n\t\t\t\t},\n\t\t\t\txhr, _xhr,\n\t\t\t\txhrAbort = function(e) {\n\t\t\t\t\tif (xhr && xhr.state() === 'pending') {\n\t\t\t\t\t\tself.abortXHR(xhr, { quiet: true , abort: true });\n\t\t\t\t\t\tif (!e || (e.type !== 'unload' && e.type !== 'destroy')) {\n\t\t\t\t\t\t\tself.autoSync();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tabort = function(e){\n\t\t\t\t\tself.trigger(cmd + 'done');\n\t\t\t\t\tif (e.type == 'autosync') {\n\t\t\t\t\t\tif (e.data.action != 'stop') return;\n\t\t\t\t\t} else if (e.type != 'unload' && e.type != 'destroy' && e.type != 'openxhrabort') {\n\t\t\t\t\t\tif (!e.data.added || !e.data.added.length) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\txhrAbort(e);\n\t\t\t\t},\n\t\t\t\trequest = function(mode) {\n\t\t\t\t\tvar queueAbort = function() {\n\t\t\t\t\t\tsyncOnFail = false;\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tif (mode) {\n\t\t\t\t\t\tif (mode === 'cmd') {\n\t\t\t\t\t\t\treturn cmd;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\tif (currentOpenCmd && currentOpenCmd.state() === 'pending') {\n\t\t\t\t\t\t\tif (currentOpenCmd._target === data.target) {\n\t\t\t\t\t\t\t\treturn dfrd.reject('openabort');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (currentOpenCmd.xhr) {\n\t\t\t\t\t\t\t\t\tcurrentOpenCmd.xhr.queueAbort();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcurrentOpenCmd.reject('openabort');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentOpenCmd = dfrd;\n\t\t\t\t\t\tcurrentOpenCmd._target = data.target;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\tdelete options.headers['X-elFinderReqid'];\n\t\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\t\tcurrentOpenCmd = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fail(function(error, xhr, response) {\n\t\t\t\t\t\tvar errData, errMsg;\n\n\t\t\t\t\t\tif (isOpen && error === 'openabort') {\n\t\t\t\t\t\t\terror = '';\n\t\t\t\t\t\t\tsyncOnFail = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\terrData = {\n\t\t\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t\t\terr: error,\n\t\t\t\t\t\t\txhr: xhr,\n\t\t\t\t\t\t\trc: response\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// unset this cmd queue when user canceling\n\t\t\t\t\t\t// see notify : function - `cancel.reject(0);`\n\t\t\t\t\t\tif (error === 0) {\n\t\t\t\t\t\t\tif (requestQueue.length) {\n\t\t\t\t\t\t\t\trequestQueue = $.grep(requestQueue, function(req) {\n\t\t\t\t\t\t\t\t\treturn (req('cmd') === cmd) ? false : true;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// trigger \"requestError\" event\n\t\t\t\t\t\tself.trigger('requestError', errData);\n\t\t\t\t\t\tif (errData._getEvent && errData._getEvent().isDefaultPrevented()) {\n\t\t\t\t\t\t\tdeffail = false;\n\t\t\t\t\t\t\tsyncOnFail = false;\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\terror.error = '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// abort xhr\n\t\t\t\t\t\txhrAbort();\n\t\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\t\topenDir = self.file(data.target);\n\t\t\t\t\t\t\topenDir && openDir.volumeid && self.isRoot(openDir) && delete self.volumeExpires[openDir.volumeid];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.trigger(cmd + 'fail', response);\n\t\t\t\t\t\terrMsg = (typeof error === 'object')? error.error : error;\n\t\t\t\t\t\tif (errMsg) {\n\t\t\t\t\t\t\tdeffail ? self.error(errMsg) : self.debug('error', self.i18n(errMsg));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsyncOnFail && self.sync();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!cmd) {\n\t\t\t\t\t\tsyncOnFail = false;\n\t\t\t\t\t\treturn dfrd.reject({error :'errCmdReq'});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (self.maxTargets && data.targets && data.targets.length > self.maxTargets) {\n\t\t\t\t\t\tsyncOnFail = false;\n\t\t\t\t\t\treturn dfrd.reject({error :['errMaxTargets', self.maxTargets]});\n\t\t\t\t\t}\n\n\t\t\t\t\tdefdone && dfrd.done(done);\n\t\t\t\t\t\n\t\t\t\t\t// quiet abort not completed \"open\" requests\n\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\twhile ((_xhr = queue.pop())) {\n\t\t\t\t\t\t\t_xhr.queueAbort();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cwd !== data.target) {\n\t\t\t\t\t\t\twhile ((_xhr = cwdQueue.pop())) {\n\t\t\t\t\t\t\t\t_xhr.queueAbort();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// trigger abort autoSync for commands to add the item\n\t\t\t\t\tif ($.inArray(cmd, (self.cmdsToAdd + ' autosync').split(' ')) !== -1) {\n\t\t\t\t\t\tif (cmd !== 'autosync') {\n\t\t\t\t\t\t\tself.autoSync('stop');\n\t\t\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\t\t\tself.autoSync();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.trigger('openxhrabort');\n\t\t\t\t\t}\n\n\t\t\t\t\tdelete options.preventFail;\n\n\t\t\t\t\tif (self.api >= 2.1029) {\n\t\t\t\t\t\tif (useCache) {\n\t\t\t\t\t\t\toptions.headers['X-elFinderReqid'] = reqId;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tObject.assign(options.data, { reqid : reqId });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// function for set value of this syncOnFail\n\t\t\t\t\tdfrd.syncOnFail = function(state) {\n\t\t\t\t\t\tsyncOnFail = !!state;\n\t\t\t\t\t};\n\n\t\t\t\t\trequestCnt++;\n\n\t\t\t\t\tdfrd.xhr = xhr = self.transport.send(options).always(function() {\n\t\t\t\t\t\t// set responseURL from native xhr object\n\t\t\t\t\t\tif (options._xhr && typeof options._xhr.responseURL !== 'undefined') {\n\t\t\t\t\t\t\txhr.responseURL = options._xhr.responseURL || '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\t--requestCnt;\n\t\t\t\t\t\tif (requestQueue.length) {\n\t\t\t\t\t\t\trequestQueue.shift()();\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fail(error).done(success);\n\t\t\t\t\t\n\t\t\t\t\tif (self.api >= 2.1029) {\n\t\t\t\t\t\txhr._requestId = reqId;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (isOpen || (data.compare && cmd === 'info')) {\n\t\t\t\t\t\t// regist function queueAbort\n\t\t\t\t\t\txhr.queueAbort = queueAbort;\n\t\t\t\t\t\t// add autoSync xhr into queue\n\t\t\t\t\t\tqueue.unshift(xhr);\n\t\t\t\t\t\t// bind abort()\n\t\t\t\t\t\tdata.compare && self.bind(self.cmdsToAdd + ' autosync openxhrabort', abort);\n\t\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\t\tvar ndx = $.inArray(xhr, queue);\n\t\t\t\t\t\t\tdata.compare && self.unbind(self.cmdsToAdd + ' autosync openxhrabort', abort);\n\t\t\t\t\t\t\tndx !== -1 && queue.splice(ndx, 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if ($.inArray(cmd, self.abortCmdsOnOpen) !== -1) {\n\t\t\t\t\t\t// regist function queueAbort\n\t\t\t\t\t\txhr.queueAbort = queueAbort;\n\t\t\t\t\t\t// add \"open\" xhr, only cwd xhr into queue\n\t\t\t\t\t\tcwdQueue.unshift(xhr);\n\t\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\t\tvar ndx = $.inArray(xhr, cwdQueue);\n\t\t\t\t\t\t\tndx !== -1 && cwdQueue.splice(ndx, 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// abort pending xhr on window unload or elFinder destroy\n\t\t\t\t\tself.bind('unload destroy', abort);\n\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\tself.unbind('unload destroy', abort);\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\treturn dfrd;\n\t\t\t\t},\n\t\t\t\tqueueingRequest = function() {\n\t\t\t\t\t// show notify\n\t\t\t\t\tif (notify.type && notify.cnt) {\n\t\t\t\t\t\tif (cancel) {\n\t\t\t\t\t\t\tnotify.cancel = dfrd;\n\t\t\t\t\t\t\topts.eachCancel && (notify.id = +new Date());\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\t\t// start fake count up\n\t\t\t\t\t\t\tprogTm = setTimeout(progFakeUp, 1000);\n\t\t\t\t\t\t\tself.notify(notify);\n\t\t\t\t\t\t\thasNotify = true;\n\t\t\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\t\t\tnotify.cnt = -(parseInt(notify.cnt)||0);\n\t\t\t\t\t\t\t\tself.notify(notify);\n\t\t\t\t\t\t\t\thasNotify = false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, self.notifyDelay);\n\t\t\t\t\t\t\n\t\t\t\t\t\tdfrd.always(function() {\n\t\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t// queueing\n\t\t\t\t\tif (requestCnt < requestMaxConn) {\n\t\t\t\t\t\t// do request\n\t\t\t\t\t\treturn request();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\t\trequestQueue.unshift(request);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trequestQueue.push(request);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfrd;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprogFakeUp = function() {\n\t\t\t\t\tvar add;\n\t\t\t\t\tif (hasNotify && progTm) {\n\t\t\t\t\t\tadd = 1 * notify.cnt;\n\t\t\t\t\t\tprogTm = null;\n\t\t\t\t\t\tself.notify({\n\t\t\t\t\t\t\ttype: notify.type,\n\t\t\t\t\t\t\tprogress: add,\n\t\t\t\t\t\t\tcnt: 0,\n\t\t\t\t\t\t\thideCnt: notify.hideCnt\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprog += add;\n\t\t\t\t\t\tif ((prog / notify.cnt) < 80) {\n\t\t\t\t\t\t\tprogTm = setTimeout(progFakeUp, 500);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbindData = {opts: opts, result: true},\n\t\t\t\topenDir;\n\t\t\t\n\t\t\t// prevent request initial request is completed\n\t\t\tif (!self.api && !data.init) {\n\t\t\t\tsyncOnFail = false;\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\n\t\t\t// trigger \"request.cmd\" that callback be able to cancel request by substituting \"false\" for \"event.data.result\"\n\t\t\tself.trigger('request.' + cmd, bindData, true);\n\t\t\t\n\t\t\tif (! bindData.result) {\n\t\t\t\tself.trigger(cmd + 'done');\n\t\t\t\treturn dfrd.reject();\n\t\t\t} else if (typeof bindData.result === 'object' && bindData.result.promise) {\n\t\t\t\tbindData.result\n\t\t\t\t\t.done(queueingRequest)\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\tself.trigger(cmd + 'done');\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t});\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t\t\n\t\t\treturn queueingRequest();\n\t\t};\n\t\t\n\t\t/**\n\t\t * Call cache()\n\t\t * Store info about files/dirs in \"files\" object.\n\t\t *\n\t\t * @param  Array  files\n\t\t * @param  String type\n\t\t * @return void\n\t\t */\n\t\tthis.cache = function(dataArray, type) {\n\t\t\tif (! Array.isArray(dataArray)) {\n\t\t\t\tdataArray = [ dataArray ];\n\t\t\t}\n\t\t\tcache(dataArray, type);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Update file object caches by respose data object\n\t\t * \n\t\t * @param  Object  respose data object\n\t\t * @return void\n\t\t */\n\t\tthis.updateCache = function(data) {\n\t\t\tif ($.isPlainObject(data)) {\n\t\t\t\tdata.files && data.files.length && cache(data.files, 'files');\n\t\t\t\tdata.tree && data.tree.length && cache(data.tree, 'tree');\n\t\t\t\tdata.removed && data.removed.length && remove(data.removed);\n\t\t\t\tdata.added && data.added.length && cache(data.added, 'add');\n\t\t\t\tdata.changed && data.changed.length && cache(data.changed, 'change');\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Compare current files cache with new files and return diff\n\t\t * \n\t\t * @param  Array   new files\n\t\t * @param  String  target folder hash\n\t\t * @param  Array   exclude properties to compare\n\t\t * @return Object\n\t\t */\n\t\tthis.diff = function(incoming, onlydir, excludeProps) {\n\t\t\tvar raw       = {},\n\t\t\t\tadded     = [],\n\t\t\t\tremoved   = [],\n\t\t\t\tchanged   = [],\n\t\t\t\texcludes  = null,\n\t\t\t\tisChanged = function(hash) {\n\t\t\t\t\tvar l = changed.length;\n\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\tif (changed[l].hash == hash) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\n\t\t\t$.each(incoming, function(i, f) {\n\t\t\t\traw[f.hash] = f;\n\t\t\t});\n\t\t\t\n\t\t\t// make excludes object\n\t\t\tif (excludeProps && excludeProps.length) {\n\t\t\t\texcludes = {};\n\t\t\t\t$.each(excludeProps, function() {\n\t\t\t\t\texcludes[this] = true;\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// find removed\n\t\t\t$.each(files, function(hash, f) {\n\t\t\t\tif (! raw[hash] && (! onlydir || f.phash === onlydir)) {\n\t\t\t\t\tremoved.push(hash);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t// compare files\n\t\t\t$.each(raw, function(hash, file) {\n\t\t\t\tvar origin  = files[hash],\n\t\t\t\t\torgKeys = {},\n\t\t\t\t\tchkKeyLen;\n\n\t\t\t\tif (!origin) {\n\t\t\t\t\tadded.push(file);\n\t\t\t\t} else {\n\t\t\t\t\t// make orgKeys object\n\t\t\t\t\t$.each(Object.keys(origin), function() {\n\t\t\t\t\t\torgKeys[this] = true;\n\t\t\t\t\t});\n\t\t\t\t\t$.each(file, function(prop) {\n\t\t\t\t\t\tdelete orgKeys[prop];\n\t\t\t\t\t\tif (! excludes || ! excludes[prop]) {\n\t\t\t\t\t\t\tif (file[prop] !== origin[prop]) {\n\t\t\t\t\t\t\t\tchanged.push(file);\n\t\t\t\t\t\t\t\torgKeys = {};\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tchkKeyLen = Object.keys(orgKeys).length;\n\t\t\t\t\tif (chkKeyLen !== 0) {\n\t\t\t\t\t\tif (excludes) {\n\t\t\t\t\t\t\t$.each(orgKeys, function(prop) {\n\t\t\t\t\t\t\t\tif (excludes[prop]) {\n\t\t\t\t\t\t\t\t\t--chkKeyLen;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t(chkKeyLen !== 0) && changed.push(file);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t// parents of removed dirs mark as changed (required for tree correct work)\n\t\t\t$.each(removed, function(i, hash) {\n\t\t\t\tvar file  = files[hash], \n\t\t\t\t\tphash = file.phash;\n\n\t\t\t\tif (phash \n\t\t\t\t&& file.mime == 'directory' \n\t\t\t\t&& $.inArray(phash, removed) === -1 \n\t\t\t\t&& raw[phash] \n\t\t\t\t&& !isChanged(phash)) {\n\t\t\t\t\tchanged.push(raw[phash]);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn {\n\t\t\t\tadded   : added,\n\t\t\t\tremoved : removed,\n\t\t\t\tchanged : changed\n\t\t\t};\n\t\t};\n\t\t\n\t\t/**\n\t\t * Sync content\n\t\t * \n\t\t * @return jQuery.Deferred\n\t\t */\n\t\tthis.sync = function(onlydir, polling) {\n\t\t\tthis.autoSync('stop');\n\t\t\tvar self  = this,\n\t\t\t\tcompare = function(){\n\t\t\t\t\tvar c = '', cnt = 0, mtime = 0;\n\t\t\t\t\tif (onlydir && polling) {\n\t\t\t\t\t\t$.each(files, function(h, f) {\n\t\t\t\t\t\t\tif (f.phash && f.phash === onlydir) {\n\t\t\t\t\t\t\t\t++cnt;\n\t\t\t\t\t\t\t\tmtime = Math.max(mtime, f.ts);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tc = cnt+':'+mtime;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn c;\n\t\t\t\t},\n\t\t\t\tcomp  = compare(),\n\t\t\t\tdfrd  = $.Deferred().always(function() { !reqFail && self.trigger('sync'); }),\n\t\t\t\topts = [this.request({\n\t\t\t\t\tdata           : {cmd : 'open', reload : 1, target : cwd, tree : (! onlydir && this.ui.tree) ? 1 : 0, compare : comp},\n\t\t\t\t\tpreventDefault : true\n\t\t\t\t})],\n\t\t\t\texParents = function() {\n\t\t\t\t\tvar parents = [],\n\t\t\t\t\t\tcurRoot = self.file(self.root(cwd)),\n\t\t\t\t\t\tcurId = curRoot? curRoot.volumeid : null,\n\t\t\t\t\t\tphash = self.cwd().phash,\n\t\t\t\t\t\tisroot,pdir;\n\t\t\t\t\t\n\t\t\t\t\twhile(phash) {\n\t\t\t\t\t\tif (pdir = self.file(phash)) {\n\t\t\t\t\t\t\tif (phash.indexOf(curId) !== 0) {\n\t\t\t\t\t\t\t\tparents.push( {target: phash, cmd: 'tree'} );\n\t\t\t\t\t\t\t\tif (! self.isRoot(pdir)) {\n\t\t\t\t\t\t\t\t\tparents.push( {target: phash, cmd: 'parents'} );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcurRoot = self.file(self.root(phash));\n\t\t\t\t\t\t\t\tcurId = curRoot? curRoot.volumeid : null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tphash = pdir.phash;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tphash = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn parents;\n\t\t\t\t},\n\t\t\t\treqFail;\n\t\t\t\n\t\t\tif (! onlydir && self.api >= 2) {\n\t\t\t\t(cwd !== this.root()) && opts.push(this.request({\n\t\t\t\t\tdata           : {cmd : 'parents', target : cwd},\n\t\t\t\t\tpreventDefault : true\n\t\t\t\t}));\n\t\t\t\t$.each(exParents(), function(i, data) {\n\t\t\t\t\topts.push(self.request({\n\t\t\t\t\t\tdata           : {cmd : data.cmd, target : data.target},\n\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t\t$.when.apply($, opts)\n\t\t\t.fail(function(error, xhr) {\n\t\t\t\treqFail = (xhr && xhr.status != 200);\n\t\t\t\tif (! polling || $.inArray('errOpen', error) !== -1) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\tself.parseError(error) && self.request({\n\t\t\t\t\t\tdata   : {cmd : 'open', target : (self.lastDir('') || self.root()), tree : 1, init : 1},\n\t\t\t\t\t\tnotify : {type : 'open', cnt : 1, hideCnt : true}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfrd.reject((error && xhr.status != 0)? error : void 0);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.done(function(odata) {\n\t\t\t\tvar pdata, argLen, i;\n\t\t\t\t\n\t\t\t\tif (odata.cwd.compare) {\n\t\t\t\t\tif (comp === odata.cwd.compare) {\n\t\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// for 2nd and more requests\n\t\t\t\tpdata = {tree : []};\n\t\t\t\t\n\t\t\t\t// results marge of 2nd and more requests\n\t\t\t\targLen = arguments.length;\n\t\t\t\tif (argLen > 1) {\n\t\t\t\t\tfor(i = 1; i < argLen; i++) {\n\t\t\t\t\t\tif (arguments[i].tree && arguments[i].tree.length) {\n\t\t\t\t\t\t\tpdata.tree.push.apply(pdata.tree, arguments[i].tree);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (self.api < 2.1) {\n\t\t\t\t\tif (! pdata.tree) {\n\t\t\t\t\t\tpdata.tree = [];\n\t\t\t\t\t}\n\t\t\t\t\tpdata.tree.push(odata.cwd);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// data normalize\n\t\t\t\todata = self.normalize(odata);\n\t\t\t\tif (!self.validResponse('open', odata)) {\n\t\t\t\t\treturn dfrd.reject((odata.norError || 'errResponse'));\n\t\t\t\t}\n\t\t\t\tpdata = self.normalize(pdata);\n\t\t\t\tif (!self.validResponse('tree', pdata)) {\n\t\t\t\t\treturn dfrd.reject((pdata.norError || 'errResponse'));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar diff = self.diff(odata.files.concat(pdata && pdata.tree ? pdata.tree : []), onlydir);\n\n\t\t\t\tdiff.added.push(odata.cwd);\n\t\t\t\t\n\t\t\t\tself.updateCache(diff);\n\t\t\t\t\n\t\t\t\t// trigger events\n\t\t\t\tdiff.removed.length && self.remove(diff);\n\t\t\t\tdiff.added.length   && self.add(diff);\n\t\t\t\tdiff.changed.length && self.change(diff);\n\t\t\t\treturn dfrd.resolve(diff);\n\t\t\t})\n\t\t\t.always(function() {\n\t\t\t\tself.autoSync();\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\t\t\n\t\tthis.upload = function(files) {\n\t\t\treturn this.transport.upload(files, this);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Bind keybord shortcut to keydown event\n\t\t *\n\t\t * @example\n\t\t *    elfinder.shortcut({ \n\t\t *       pattern : 'ctrl+a', \n\t\t *       description : 'Select all files', \n\t\t *       callback : function(e) { ... }, \n\t\t *       keypress : true|false (bind to keypress instead of keydown) \n\t\t *    })\n\t\t *\n\t\t * @param  Object  shortcut config\n\t\t * @return elFinder\n\t\t */\n\t\tthis.shortcut = function(s) {\n\t\t\tvar patterns, pattern, code, i, parts;\n\t\t\t\n\t\t\tif (this.options.allowShortcuts && s.pattern && $.isFunction(s.callback)) {\n\t\t\t\tpatterns = s.pattern.toUpperCase().split(/\\s+/);\n\t\t\t\t\n\t\t\t\tfor (i= 0; i < patterns.length; i++) {\n\t\t\t\t\tpattern = patterns[i];\n\t\t\t\t\tparts   = pattern.split('+');\n\t\t\t\t\tcode    = (code = parts.pop()).length == 1 \n\t\t\t\t\t\t? (code > 0 ? code : code.charCodeAt(0))\n\t\t\t\t\t\t: (code > 0 ? code : $.ui.keyCode[code]);\n\n\t\t\t\t\tif (code && !shortcuts[pattern]) {\n\t\t\t\t\t\tshortcuts[pattern] = {\n\t\t\t\t\t\t\tkeyCode     : code,\n\t\t\t\t\t\t\taltKey      : $.inArray('ALT', parts)   != -1,\n\t\t\t\t\t\t\tctrlKey     : $.inArray('CTRL', parts)  != -1,\n\t\t\t\t\t\t\tshiftKey    : $.inArray('SHIFT', parts) != -1,\n\t\t\t\t\t\t\ttype        : s.type || 'keydown',\n\t\t\t\t\t\t\tcallback    : s.callback,\n\t\t\t\t\t\t\tdescription : s.description,\n\t\t\t\t\t\t\tpattern     : pattern\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Registered shortcuts\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tthis.shortcuts = function() {\n\t\t\tvar ret = [];\n\t\t\t\n\t\t\t$.each(shortcuts, function(i, s) {\n\t\t\t\tret.push([s.pattern, self.i18n(s.description)]);\n\t\t\t});\n\t\t\treturn ret;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Get/set clipboard content.\n\t\t * Return new clipboard content.\n\t\t *\n\t\t * @example\n\t\t *   this.clipboard([]) - clean clipboard\n\t\t *   this.clipboard([{...}, {...}], true) - put 2 files in clipboard and mark it as cutted\n\t\t * \n\t\t * @param  Array    new files hashes\n\t\t * @param  Boolean  cut files?\n\t\t * @return Array\n\t\t */\n\t\tthis.clipboard = function(hashes, cut) {\n\t\t\tvar map = function() { return $.map(clipboard, function(f) { return f.hash; }); };\n\n\t\t\tif (hashes !== void(0)) {\n\t\t\t\tclipboard.length && this.trigger('unlockfiles', {files : map()});\n\t\t\t\tremember = {};\n\t\t\t\t\n\t\t\t\tclipboard = $.map(hashes||[], function(hash) {\n\t\t\t\t\tvar file = files[hash];\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tremember[hash] = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\thash   : hash,\n\t\t\t\t\t\t\tphash  : file.phash,\n\t\t\t\t\t\t\tname   : file.name,\n\t\t\t\t\t\t\tmime   : file.mime,\n\t\t\t\t\t\t\tread   : file.read,\n\t\t\t\t\t\t\tlocked : file.locked,\n\t\t\t\t\t\t\tcut    : !!cut\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t\tthis.trigger('changeclipboard', {clipboard : clipboard.slice(0, clipboard.length)});\n\t\t\t\tcut && this.trigger('lockfiles', {files : map()});\n\t\t\t}\n\n\t\t\t// return copy of clipboard instead of refrence\n\t\t\treturn clipboard.slice(0, clipboard.length);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if command enabled\n\t\t * \n\t\t * @param  String       command name\n\t\t * @param  String|void  hash for check of own volume's disabled cmds\n\t\t * @return Boolean\n\t\t */\n\t\tthis.isCommandEnabled = function(name, dstHash) {\n\t\t\tvar disabled, cmd,\n\t\t\t\tcvid = self.cwd().volumeid || '';\n\t\t\t\n\t\t\t// In serach results use selected item hash to check\n\t\t\tif (!dstHash && self.searchStatus.state > 1 && self.selected().length) {\n\t\t\t\tdstHash = self.selected()[0];\n\t\t\t}\n\t\t\tif (dstHash && (! cvid || dstHash.indexOf(cvid) !== 0)) {\n\t\t\t\tdisabled = self.option('disabledFlip', dstHash);\n\t\t\t\t//if (! disabled) {\n\t\t\t\t//\tdisabled = {};\n\t\t\t\t//}\n\t\t\t} else {\n\t\t\t\tdisabled = cwdOptions.disabledFlip/* || {}*/;\n\t\t\t}\n\t\t\tcmd = this._commands[name];\n\t\t\treturn cmd ? (cmd.alwaysEnabled || !disabled[name]) : false;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Exec command and return result;\n\t\t *\n\t\t * @param  String         command name\n\t\t * @param  String|Array   usualy files hashes\n\t\t * @param  String|Array   command options\n\t\t * @param  String|void    hash for enabled check of own volume's disabled cmds\n\t\t * @return $.Deferred\n\t\t */\t\t\n\t\tthis.exec = function(cmd, files, opts, dstHash) {\n\t\t\tvar dfrd, resType;\n\t\t\t\n\t\t\t// apply commandMap for keyboard shortcut\n\t\t\tif (!dstHash && this.commandMap[cmd] && this.commandMap[cmd] !== 'hidden') {\n\t\t\t\tcmd = this.commandMap[cmd];\n\t\t\t}\n\n\t\t\tif (cmd === 'open') {\n\t\t\t\tif (this.searchStatus.state || this.searchStatus.ininc) {\n\t\t\t\t\tthis.trigger('searchend', { noupdate: true });\n\t\t\t\t}\n\t\t\t\tthis.autoSync('stop');\n\t\t\t}\n\t\t\tif (!dstHash && files) {\n\t\t\t\tif ($.isArray(files)) {\n\t\t\t\t\tif (files.length) {\n\t\t\t\t\t\tdstHash = files[0];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdstHash = files;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdfrd = this._commands[cmd] && this.isCommandEnabled(cmd, dstHash) \n\t\t\t\t? this._commands[cmd].exec(files, opts) \n\t\t\t\t: $.Deferred().reject('errUnknownCmd');\n\t\t\t\n\t\t\tresType = typeof dfrd;\n\t\t\tif (!(resType === 'object' && dfrd.promise)) {\n\t\t\t\tself.debug('warning', '\"cmd.exec()\" should be returned \"$.Deferred\" but cmd \"' + cmd + '\" returned \"' + resType + '\"');\n\t\t\t\tdfrd = $.Deferred().resolve();\n\t\t\t}\n\t\t\t\n\t\t\tthis.trigger('exec', { dfrd : dfrd, cmd : cmd, files : files, opts : opts, dstHash : dstHash });\n\t\t\treturn dfrd;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Create and return dialog.\n\t\t *\n\t\t * @param  String|DOMElement  dialog content\n\t\t * @param  Object             dialog options\n\t\t * @return jQuery\n\t\t */\n\t\tthis.dialog = function(content, options) {\n\t\t\tvar dialog = $('<div/>').append(content).appendTo(node).elfinderdialog(options, self),\n\t\t\t\tdnode  = dialog.closest('.ui-dialog'),\n\t\t\t\tresize = function(){\n\t\t\t\t\t! dialog.data('draged') && dialog.is(':visible') && dialog.elfinderdialog('posInit');\n\t\t\t\t};\n\t\t\tif (dnode.length) {\n\t\t\t\tself.bind('resize', resize);\n\t\t\t\tdnode.on('remove', function() {\n\t\t\t\t\tself.unbind('resize', resize);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn dialog;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Create and return toast.\n\t\t *\n\t\t * @param  Object  toast options - see ui/toast.js\n\t\t * @return jQuery\n\t\t */\n\t\tthis.toast = function(options) {\n\t\t\treturn $('<div class=\"ui-front\"/>').appendTo(this.ui.toast).elfindertoast(options || {}, this);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return UI widget or node\n\t\t *\n\t\t * @param  String  ui name\n\t\t * @return jQuery\n\t\t */\n\t\tthis.getUI = function(ui) {\n\t\t\treturn ui? (this.ui[ui] || $()) : node;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return elFinder.command instance or instances array\n\t\t *\n\t\t * @param  String  command name\n\t\t * @return Object | Array\n\t\t */\n\t\tthis.getCommand = function(name) {\n\t\t\treturn name === void(0) ? this._commands : this._commands[name];\n\t\t};\n\t\t\n\t\t/**\n\t\t * Resize elfinder node\n\t\t * \n\t\t * @param  String|Number  width\n\t\t * @param  String|Number  height\n\t\t * @return void\n\t\t */\n\t\tthis.resize = function(w, h) {\n\t\t\tvar getMargin = function() {\n\t\t\t\t\tvar m = node.outerHeight(true) - node.innerHeight(),\n\t\t\t\t\t\tp = node;\n\t\t\t\t\t\n\t\t\t\t\twhile(p.get(0) !== heightBase.get(0)) {\n\t\t\t\t\t\tp = p.parent();\n\t\t\t\t\t\tm += p.outerHeight(true) - p.innerHeight();\n\t\t\t\t\t\tif (! p.parent().length) {\n\t\t\t\t\t\t\t// reached the document\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn m;\n\t\t\t\t},\n\t\t\t\tfit = ! node.hasClass('ui-resizable'),\n\t\t\t\tprv = node.data('resizeSize') || {w: 0, h: 0},\n\t\t\t\tmt, size = {};\n\n\t\t\tif (heightBase && heightBase.data('resizeTm')) {\n\t\t\t\tclearTimeout(heightBase.data('resizeTm'));\n\t\t\t}\n\t\t\t\n\t\t\tif (typeof h === 'string') {\n\t\t\t\tif (mt = h.match(/^([0-9.]+)%$/)) {\n\t\t\t\t\t// setup heightBase\n\t\t\t\t\tif (! heightBase || ! heightBase.length) {\n\t\t\t\t\t\theightBase = $(window);\n\t\t\t\t\t}\n\t\t\t\t\tif (! heightBase.data('marginToMyNode')) {\n\t\t\t\t\t\theightBase.data('marginToMyNode', getMargin());\n\t\t\t\t\t}\n\t\t\t\t\tif (! heightBase.data('fitToBaseFunc')) {\n\t\t\t\t\t\theightBase.data('fitToBaseFunc', function(e) {\n\t\t\t\t\t\t\tvar tm = heightBase.data('resizeTm');\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\t\t\t\tif (! node.hasClass('elfinder-fullscreen') && (!self.UA.Mobile || heightBase.data('rotated') !== self.UA.Rotated)) {\n\t\t\t\t\t\t\t\theightBase.data('rotated', self.UA.Rotated);\n\t\t\t\t\t\t\t\theightBase.data('resizeTm', requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tself.restoreSize();\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (typeof heightBase.data('rotated') === 'undefined') {\n\t\t\t\t\t\theightBase.data('rotated', self.UA.Rotated);\n\t\t\t\t\t}\n\t\t\t\t\th = heightBase.height() * (mt[1] / 100) - heightBase.data('marginToMyNode');\n\t\t\t\t\t\n\t\t\t\t\theightBase.off('resize.' + self.namespace, heightBase.data('fitToBaseFunc'));\n\t\t\t\t\tfit && heightBase.on('resize.' + self.namespace, heightBase.data('fitToBaseFunc'));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnode.css({ width : w, height : parseInt(h) });\n\t\t\tsize.w = Math.round(node.width());\n\t\t\tsize.h = Math.round(node.height());\n\t\t\tnode.data('resizeSize', size);\n\t\t\tif (size.w !== prv.w || size.h !== prv.h) {\n\t\t\t\tnode.trigger('resize');\n\t\t\t\tthis.trigger('resize', {width : size.w, height : size.h});\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Restore elfinder node size\n\t\t * \n\t\t * @return elFinder\n\t\t */\n\t\tthis.restoreSize = function() {\n\t\t\tthis.resize(width, height);\n\t\t};\n\t\t\n\t\tthis.show = function() {\n\t\t\tnode.show();\n\t\t\tthis.enable().trigger('show');\n\t\t};\n\t\t\n\t\tthis.hide = function() {\n\t\t\tif (this.options.enableAlways) {\n\t\t\t\tprevEnabled = enabled;\n\t\t\t\tenabled = false;\n\t\t\t}\n\t\t\tthis.disable();\n\t\t\tthis.trigger('hide');\n\t\t\tnode.hide();\n\t\t};\n\t\t\n\t\t/**\n\t\t * Lazy execution function\n\t\t * \n\t\t * @param  Object  function\n\t\t * @param  Number  delay\n\t\t * @param  Object  options\n\t\t * @return Object  jQuery.Deferred\n\t\t */\n\t\tthis.lazy = function(func, delay, opts) {\n\t\t\tvar busy = function(state) {\n\t\t\t\t\tvar cnt = node.data('lazycnt'),\n\t\t\t\t\t\trepaint;\n\t\t\t\t\t\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\trepaint = node.data('lazyrepaint')? false : opts.repaint;\n\t\t\t\t\t\tif (! cnt) {\n\t\t\t\t\t\t\tnode.data('lazycnt', 1)\n\t\t\t\t\t\t\t\t.addClass('elfinder-processing');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.data('lazycnt', ++cnt);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (repaint) {\n\t\t\t\t\t\t\tnode.data('lazyrepaint', true).css('display'); // force repaint\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (cnt && cnt > 1) {\n\t\t\t\t\t\t\tnode.data('lazycnt', --cnt);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trepaint = node.data('lazyrepaint');\n\t\t\t\t\t\t\tnode.data('lazycnt', 0)\n\t\t\t\t\t\t\t\t.removeData('lazyrepaint')\n\t\t\t\t\t\t\t\t.removeClass('elfinder-processing');\n\t\t\t\t\t\t\trepaint && node.css('display'); // force repaint;\n\t\t\t\t\t\t\tself.trigger('lazydone');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdfd  = $.Deferred(),\n\t\t\t\tcallFunc = function() {\n\t\t\t\t\tdfd.resolve(func.call(dfd));\n\t\t\t\t\tbusy(false);\n\t\t\t\t};\n\t\t\t\n\t\t\tdelay = delay || 0;\n\t\t\topts = opts || {};\n\t\t\tbusy(true);\n\t\t\t\n\t\t\tif (delay) {\n\t\t\t\tsetTimeout(callFunc, delay);\n\t\t\t} else {\n\t\t\t\trequestAnimationFrame(callFunc);\n\t\t\t}\n\t\t\t\n\t\t\treturn dfd;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Destroy this elFinder instance\n\t\t *\n\t\t * @return void\n\t\t **/\n\t\tthis.destroy = function() {\n\t\t\tif (node && node[0].elfinder) {\n\t\t\t\tnode.hasClass('elfinder-fullscreen') && self.toggleFullscreen(node);\n\t\t\t\tthis.options.syncStart = false;\n\t\t\t\tthis.autoSync('forcestop');\n\t\t\t\tthis.trigger('destroy').disable();\n\t\t\t\tclipboard = [];\n\t\t\t\tselected = [];\n\t\t\t\tlisteners = {};\n\t\t\t\tshortcuts = {};\n\t\t\t\t$(window).off('.' + namespace);\n\t\t\t\t$(document).off('.' + namespace);\n\t\t\t\tself.trigger = function(){};\n\t\t\t\t$(beeper).remove();\n\t\t\t\tnode.off()\n\t\t\t\t\t.removeData()\n\t\t\t\t\t.empty()\n\t\t\t\t\t.append(prevContent.contents())\n\t\t\t\t\t.attr('class', prevContent.attr('class'))\n\t\t\t\t\t.attr('style', prevContent.attr('style'));\n\t\t\t\tdelete node[0].elfinder;\n\t\t\t\t// restore kept events\n\t\t\t\t$.each(prevEvents, function(n, arr) {\n\t\t\t\t\t$.each(arr, function(i, o) {\n\t\t\t\t\t\tnode.on(o.type + (o.namespace? '.'+o.namespace : ''), o.selector, o.handler);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Start or stop auto sync\n\t\t * \n\t\t * @param  String|Bool  stop\n\t\t * @return void\n\t\t */\n\t\tthis.autoSync = function(mode) {\n\t\t\tvar sync;\n\t\t\tif (self.options.sync >= 1000) {\n\t\t\t\tif (syncInterval) {\n\t\t\t\t\tclearTimeout(syncInterval);\n\t\t\t\t\tsyncInterval = null;\n\t\t\t\t\tself.trigger('autosync', {action : 'stop'});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (mode === 'stop') {\n\t\t\t\t\t++autoSyncStop;\n\t\t\t\t} else {\n\t\t\t\t\tautoSyncStop = Math.max(0, --autoSyncStop);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (autoSyncStop || mode === 'forcestop' || ! self.options.syncStart) {\n\t\t\t\t\treturn;\n\t\t\t\t} \n\t\t\t\t\n\t\t\t\t// run interval sync\n\t\t\t\tsync = function(start){\n\t\t\t\t\tvar timeout;\n\t\t\t\t\tif (cwdOptions.syncMinMs && (start || syncInterval)) {\n\t\t\t\t\t\tstart && self.trigger('autosync', {action : 'start'});\n\t\t\t\t\t\ttimeout = Math.max(self.options.sync, cwdOptions.syncMinMs);\n\t\t\t\t\t\tsyncInterval && clearTimeout(syncInterval);\n\t\t\t\t\t\tsyncInterval = setTimeout(function() {\n\t\t\t\t\t\t\tvar dosync = true, hash = cwd, cts;\n\t\t\t\t\t\t\tif (cwdOptions.syncChkAsTs && files[hash] && (cts = files[hash].ts)) {\n\t\t\t\t\t\t\t\tself.request({\n\t\t\t\t\t\t\t\t\tdata : {cmd : 'info', targets : [hash], compare : cts, reload : 1},\n\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function(data){\n\t\t\t\t\t\t\t\t\tvar ts;\n\t\t\t\t\t\t\t\t\tdosync = true;\n\t\t\t\t\t\t\t\t\tif (data.compare) {\n\t\t\t\t\t\t\t\t\t\tts = data.compare;\n\t\t\t\t\t\t\t\t\t\tif (ts == cts) {\n\t\t\t\t\t\t\t\t\t\t\tdosync = false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (dosync) {\n\t\t\t\t\t\t\t\t\t\tself.sync(hash).always(function(){\n\t\t\t\t\t\t\t\t\t\t\tif (ts) {\n\t\t\t\t\t\t\t\t\t\t\t\t// update ts for cache clear etc.\n\t\t\t\t\t\t\t\t\t\t\t\tfiles[hash].ts = ts;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tsync();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsync();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function(error, xhr){\n\t\t\t\t\t\t\t\t\tvar err = self.parseError(error);\n\t\t\t\t\t\t\t\t\tif (err && xhr.status != 0) {\n\t\t\t\t\t\t\t\t\t\tself.error(err);\n\t\t\t\t\t\t\t\t\t\tif (Array.isArray(err) && $.inArray('errOpen', err) !== -1) {\n\t\t\t\t\t\t\t\t\t\t\tself.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'open', target : (self.lastDir('') || self.root()), tree : 1, init : 1},\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'open', cnt : 1, hideCnt : true}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsyncInterval = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tsync();\n\t\t\t\t\t\t\t\t\t\t}, timeout);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.sync(cwd, true).always(function(){\n\t\t\t\t\t\t\t\t\tsync();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, timeout);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tsync(true);\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return bool is inside work zone of specific point\n\t\t * \n\t\t * @param  Number event.pageX\n\t\t * @param  Number event.pageY\n\t\t * @return Bool\n\t\t */\n\t\tthis.insideWorkzone = function(x, y, margin) {\n\t\t\tvar rectangle = this.getUI('workzone').data('rectangle');\n\t\t\t\n\t\t\tmargin = margin || 1;\n\t\t\tif (x < rectangle.left + margin\n\t\t\t|| x > rectangle.left + rectangle.width + margin\n\t\t\t|| y < rectangle.top + margin\n\t\t\t|| y > rectangle.top + rectangle.height + margin) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Target ui node move to last of children of elFinder node fot to show front\n\t\t * \n\t\t * @param  Object  target    Target jQuery node object\n\t\t */\n\t\tthis.toFront = function(target) {\n\t\t\tvar nodes = node.children('.ui-front').removeClass('elfinder-frontmost'),\n\t\t\t\tlastnode = nodes.last();\n\t\t\tnodes.css('z-index', '');\n\t\t\t$(target).addClass('ui-front elfinder-frontmost').css('z-index', lastnode.css('z-index') + 1);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Remove class 'elfinder-frontmost' and hide() to target ui node\n\t\t *\n\t\t * @param      Object   target  Target jQuery node object\n\t\t * @param      Boolean  nohide  Do not hide\n\t\t */\n\t\tthis.toHide =function(target, nohide) {\n\t\t\tvar tgt = $(target),\n\t\t\t\tlast;\n\n\t\t\t!nohide && tgt.hide();\n\t\t\tif (tgt.hasClass('elfinder-frontmost')) {\n\t\t\t\ttgt.removeClass('elfinder-frontmost');\n\t\t\t\tlast = node.children('.ui-front:visible:not(.elfinder-frontmost)').last();\n\t\t\t\tif (last.length) {\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tif (!node.children('.elfinder-frontmost:visible').length) {\n\t\t\t\t\t\t\tself.toFront(last);\n\t\t\t\t\t\t\tlast.trigger('frontmost');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Return css object for maximize\n\t\t * \n\t\t * @return Object\n\t\t */\n\t\tthis.getMaximizeCss = function() {\n\t\t\treturn {\n\t\t\t\twidth   : '100%',\n\t\t\t\theight  : '100%',\n\t\t\t\tmargin  : 0,\n\t\t\t\ttop     : 0,\n\t\t\t\tleft    : 0,\n\t\t\t\tdisplay : 'block',\n\t\t\t\tposition: 'fixed',\n\t\t\t\tzIndex  : Math.max(self.zIndex? (self.zIndex + 1) : 0 , 1000),\n\t\t\t\tmaxWidth : '',\n\t\t\t\tmaxHeight: ''\n\t\t\t};\n\t\t};\n\t\t\n\t\t// Closure for togglefullscreen\n\t\t(function() {\n\t\t\t// check is in iframe\n\t\t\tif (inFrame && self.UA.Fullscreen) {\n\t\t\t\tself.UA.Fullscreen = false;\n\t\t\t\tif (parentIframe && typeof parentIframe.attr('allowfullscreen') !== 'undefined') {\n\t\t\t\t\tself.UA.Fullscreen = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar orgStyle, bodyOvf, resizeTm, fullElm, exitFull, toFull, funcObj,\n\t\t\t\tcls = 'elfinder-fullscreen',\n\t\t\t\tclsN = 'elfinder-fullscreen-native',\n\t\t\t\tcheckDialog = function() {\n\t\t\t\t\tvar t = 0,\n\t\t\t\t\t\tl = 0;\n\t\t\t\t\t$.each(node.children('.ui-dialog,.ui-draggable'), function(i, d) {\n\t\t\t\t\t\tvar $d = $(d),\n\t\t\t\t\t\t\tpos = $d.position();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (pos.top < 0) {\n\t\t\t\t\t\t\t$d.css('top', t);\n\t\t\t\t\t\t\tt += 20;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (pos.left < 0) {\n\t\t\t\t\t\t\t$d.css('left', l);\n\t\t\t\t\t\t\tl += 20;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tsetFuncObj = function() {\n\t\t\t\t\tvar useFullscreen = self.storage('useFullscreen');\n\t\t\t\t\tfuncObj = self.UA.Fullscreen && (useFullscreen? useFullscreen > 0 : self.options.commandsOptions.fullscreen.mode === 'screen') ? {\n\t\t\t\t\t\t// native full screen mode\n\t\t\t\t\t\t\n\t\t\t\t\t\tfullElm: function() {\n\t\t\t\t\t\t\treturn document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement || null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\n\t\t\t\t\t\texitFull: function() {\n\t\t\t\t\t\t\tif (document.exitFullscreen) {\n\t\t\t\t\t\t\t\treturn document.exitFullscreen();\n\t\t\t\t\t\t\t} else if (document.webkitExitFullscreen) {\n\t\t\t\t\t\t\t\treturn document.webkitExitFullscreen();\n\t\t\t\t\t\t\t} else if (document.mozCancelFullScreen) {\n\t\t\t\t\t\t\t\treturn document.mozCancelFullScreen();\n\t\t\t\t\t\t\t} else if (document.msExitFullscreen) {\n\t\t\t\t\t\t\t\treturn document.msExitFullscreen();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\n\t\t\t\t\t\ttoFull: function(elem) {\n\t\t\t\t\t\t\tif (elem.requestFullscreen) {\n\t\t\t\t\t\t\t\treturn elem.requestFullscreen();\n\t\t\t\t\t\t\t} else if (elem.webkitRequestFullscreen) {\n\t\t\t\t\t\t\t\treturn elem.webkitRequestFullscreen();\n\t\t\t\t\t\t\t} else if (elem.mozRequestFullScreen) {\n\t\t\t\t\t\t\t\treturn elem.mozRequestFullScreen();\n\t\t\t\t\t\t\t} else if (elem.msRequestFullscreen) {\n\t\t\t\t\t\t\t\treturn elem.msRequestFullscreen();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} : {\n\t\t\t\t\t\t// node element maximize mode\n\t\t\t\t\t\t\n\t\t\t\t\t\tfullElm: function() {\n\t\t\t\t\t\t\tvar full;\n\t\t\t\t\t\t\tif (node.hasClass(cls)) {\n\t\t\t\t\t\t\t\treturn node.get(0);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfull = node.find('.' + cls);\n\t\t\t\t\t\t\t\tif (full.length) {\n\t\t\t\t\t\t\t\t\treturn full.get(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\n\t\t\t\t\t\texitFull: function() {\n\t\t\t\t\t\t\tvar elm;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$(window).off('resize.' + namespace, resize);\n\t\t\t\t\t\t\tif (bodyOvf !== void(0)) {\n\t\t\t\t\t\t\t\t$('body').css('overflow', bodyOvf);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbodyOvf = void(0);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (orgStyle) {\n\t\t\t\t\t\t\t\telm = orgStyle.elm;\n\t\t\t\t\t\t\t\trestoreStyle(elm);\n\t\t\t\t\t\t\t\t$(elm).trigger('resize', {fullscreen: 'off'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$(window).trigger('resize');\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\n\t\t\t\t\t\ttoFull: function(elem) {\n\t\t\t\t\t\t\tbodyOvf = $('body').css('overflow') || '';\n\t\t\t\t\t\t\t$('body').css('overflow', 'hidden');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$(elem).css(self.getMaximizeCss())\n\t\t\t\t\t\t\t\t.addClass(cls)\n\t\t\t\t\t\t\t\t.trigger('resize', {fullscreen: 'on'});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tcheckDialog();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$(window).on('resize.' + namespace, resize).trigger('resize');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\trestoreStyle = function(elem) {\n\t\t\t\t\tif (orgStyle && orgStyle.elm == elem) {\n\t\t\t\t\t\t$(elem).removeClass(cls + ' ' + clsN).attr('style', orgStyle.style);\n\t\t\t\t\t\torgStyle = null;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresize = function(e) {\n\t\t\t\t\tvar elm;\n\t\t\t\t\tif (e.target === window) {\n\t\t\t\t\t\tresizeTm && cancelAnimationFrame(resizeTm);\n\t\t\t\t\t\tresizeTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\tif (elm = funcObj.fullElm()) {\n\t\t\t\t\t\t\t\t$(elm).trigger('resize', {fullscreen: 'on'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\n\t\t\tsetFuncObj();\n\n\t\t\t$(document).on('fullscreenchange.' + namespace + ' webkitfullscreenchange.' + namespace + ' mozfullscreenchange.' + namespace + ' MSFullscreenChange.' + namespace, function(e){\n\t\t\t\tif (self.UA.Fullscreen) {\n\t\t\t\t\tvar elm = funcObj.fullElm(),\n\t\t\t\t\t\twin = $(window);\n\t\t\t\t\t\n\t\t\t\t\tresizeTm && cancelAnimationFrame(resizeTm);\n\t\t\t\t\tif (elm === null) {\n\t\t\t\t\t\twin.off('resize.' + namespace, resize);\n\t\t\t\t\t\tif (orgStyle) {\n\t\t\t\t\t\t\telm = orgStyle.elm;\n\t\t\t\t\t\t\trestoreStyle(elm);\n\t\t\t\t\t\t\t$(elm).trigger('resize', {fullscreen: 'off'});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(elm).addClass(cls + ' ' + clsN)\n\t\t\t\t\t\t\t.attr('style', 'width:100%; height:100%; margin:0; padding:0;')\n\t\t\t\t\t\t\t.trigger('resize', {fullscreen: 'on'});\n\t\t\t\t\t\twin.on('resize.' + namespace, resize);\n\t\t\t\t\t\tcheckDialog();\n\t\t\t\t\t}\n\t\t\t\t\twin.trigger('resize');\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t/**\n\t\t\t * Toggle Full Scrren Mode\n\t\t\t * \n\t\t\t * @param  Object target\n\t\t\t * @param  Bool   full\n\t\t\t * @return Object | Null  DOM node object of current full scrren\n\t\t\t */\n\t\t\tself.toggleFullscreen = function(target, full) {\n\t\t\t\tvar elm = $(target).get(0),\n\t\t\t\t\tcurElm = null;\n\t\t\t\t\n\t\t\t\tcurElm = funcObj.fullElm();\n\t\t\t\tif (curElm) {\n\t\t\t\t\tif (curElm == elm) {\n\t\t\t\t\t\tif (full === true) {\n\t\t\t\t\t\t\treturn curElm;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (full === false) {\n\t\t\t\t\t\t\treturn curElm;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfuncObj.exitFull();\n\t\t\t\t\treturn null;\n\t\t\t\t} else {\n\t\t\t\t\tif (full === false) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsetFuncObj();\n\t\t\t\torgStyle = {elm: elm, style: $(elm).attr('style')};\n\t\t\t\tif (funcObj.toFull(elm) !== false) {\n\t\t\t\t\treturn elm;\n\t\t\t\t} else {\n\t\t\t\t\torgStyle = null;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t};\n\t\t})();\n\t\t\n\t\t// Closure for toggleMaximize\n\t\t(function(){\n\t\t\tvar cls = 'elfinder-maximized',\n\t\t\tresizeTm,\n\t\t\tresize = function(e) {\n\t\t\t\tif (e.target === window && e.data && e.data.elm) {\n\t\t\t\t\tvar elm = e.data.elm;\n\t\t\t\t\tresizeTm && cancelAnimationFrame(resizeTm);\n\t\t\t\t\tresizeTm = requestAnimationFrame(function() {\n\t\t\t\t\t\telm.trigger('resize', {maximize: 'on'});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\texitMax = function(elm) {\n\t\t\t\t$(window).off('resize.' + namespace, resize);\n\t\t\t\t$('body').css('overflow', elm.data('bodyOvf'));\n\t\t\t\telm.removeClass(cls)\n\t\t\t\t\t.attr('style', elm.data('orgStyle'))\n\t\t\t\t\t.removeData('bodyOvf')\n\t\t\t\t\t.removeData('orgStyle');\n\t\t\t\telm.trigger('resize', {maximize: 'off'});\n\t\t\t},\n\t\t\ttoMax = function(elm) {\n\t\t\t\telm.data('bodyOvf', $('body').css('overflow') || '')\n\t\t\t\t\t.data('orgStyle', elm.attr('style'))\n\t\t\t\t\t.addClass(cls)\n\t\t\t\t\t.css(self.getMaximizeCss());\n\t\t\t\t$('body').css('overflow', 'hidden');\n\t\t\t\t$(window).on('resize.' + namespace, {elm: elm}, resize);\n\t\t\t\telm.trigger('resize', {maximize: 'on'});\n\t\t\t};\n\t\t\t\n\t\t\t/**\n\t\t\t * Toggle Maximize target node\n\t\t\t * \n\t\t\t * @param  Object target\n\t\t\t * @param  Bool   max\n\t\t\t * @return void\n\t\t\t */\n\t\t\tself.toggleMaximize = function(target, max) {\n\t\t\t\tvar elm = $(target),\n\t\t\t\t\tmaximized = elm.hasClass(cls);\n\t\t\t\t\n\t\t\t\tif (maximized) {\n\t\t\t\t\tif (max === true) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\texitMax(elm);\n\t\t\t\t} else {\n\t\t\t\t\tif (max === false) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\ttoMax(elm);\n\t\t\t\t}\n\t\t\t};\n\t\t})();\n\t\t\n\t\t/*************  init stuffs  ****************/\n\t\tObject.assign($.ui.keyCode, {\n\t\t\t'F1' : 112,\n\t\t\t'F2' : 113,\n\t\t\t'F3' : 114,\n\t\t\t'F4' : 115,\n\t\t\t'F5' : 116,\n\t\t\t'F6' : 117,\n\t\t\t'F7' : 118,\n\t\t\t'F8' : 119,\n\t\t\t'F9' : 120,\n\t\t\t'F10' : 121,\n\t\t\t'F11' : 122,\n\t\t\t'F12' : 123,\n\t\t\t'DIG0' : 48,\n\t\t\t'DIG1' : 49,\n\t\t\t'DIG2' : 50,\n\t\t\t'DIG3' : 51,\n\t\t\t'DIG4' : 52,\n\t\t\t'DIG5' : 53,\n\t\t\t'DIG6' : 54,\n\t\t\t'DIG7' : 55,\n\t\t\t'DIG8' : 56,\n\t\t\t'DIG9' : 57,\n\t\t\t'NUM0' : 96,\n\t\t\t'NUM1' : 97,\n\t\t\t'NUM2' : 98,\n\t\t\t'NUM3' : 99,\n\t\t\t'NUM4' : 100,\n\t\t\t'NUM5' : 101,\n\t\t\t'NUM6' : 102,\n\t\t\t'NUM7' : 103,\n\t\t\t'NUM8' : 104,\n\t\t\t'NUM9' : 105,\n\t\t\t'CONTEXTMENU' : 93,\n\t\t\t'DOT'  : 190\n\t\t});\n\t\t\n\t\tthis.dragUpload = false;\n\t\tthis.xhrUpload  = (typeof XMLHttpRequestUpload != 'undefined' || typeof XMLHttpRequestEventTarget != 'undefined') && typeof File != 'undefined' && typeof FormData != 'undefined';\n\t\t\n\t\t// configure transport object\n\t\tthis.transport = {};\n\n\t\tif (typeof(this.options.transport) == 'object') {\n\t\t\tthis.transport = this.options.transport;\n\t\t\tif (typeof(this.transport.init) == 'function') {\n\t\t\t\tthis.transport.init(this);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (typeof(this.transport.send) != 'function') {\n\t\t\tthis.transport.send = function(opts) {\n\t\t\t\tif (!self.UA.IE) {\n\t\t\t\t\t// keep native xhr object for handling property responseURL\n\t\t\t\t\topts._xhr = new XMLHttpRequest();\n\t\t\t\t\topts.xhr = function() { \n\t\t\t\t\t\tif (opts.progress) {\n\t\t\t\t\t\t\topts._xhr.addEventListener('progress', opts.progress); \n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn opts._xhr;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn $.ajax(opts);\n\t\t\t};\n\t\t}\n\t\t\n\t\tif (this.transport.upload == 'iframe') {\n\t\t\tthis.transport.upload = $.proxy(this.uploads.iframe, this);\n\t\t} else if (typeof(this.transport.upload) == 'function') {\n\t\t\tthis.dragUpload = !!this.options.dragUploadAllow;\n\t\t} else if (this.xhrUpload && !!this.options.dragUploadAllow) {\n\t\t\tthis.transport.upload = $.proxy(this.uploads.xhr, this);\n\t\t\tthis.dragUpload = true;\n\t\t} else {\n\t\t\tthis.transport.upload = $.proxy(this.uploads.iframe, this);\n\t\t}\n\n\t\t/**\n\t\t * Decoding 'raw' string converted to unicode\n\t\t * \n\t\t * @param  String str\n\t\t * @return String\n\t\t */\n\t\tthis.decodeRawString = function(str) {\n\t\t\tvar charCodes = function(str) {\n\t\t\t\tvar i, len, arr;\n\t\t\t\tfor (i=0,len=str.length,arr=[]; i<len; i++) {\n\t\t\t\t\tarr.push(str.charCodeAt(i));\n\t\t\t\t}\n\t\t\t\treturn arr;\n\t\t\t},\n\t\t\tscalarValues = function(arr) {\n\t\t\t\tvar scalars = [], i, len, c;\n\t\t\t\tif (typeof arr === 'string') {arr = charCodes(arr);}\n\t\t\t\tfor (i=0,len=arr.length; c=arr[i],i<len; i++) {\n\t\t\t\t\tif (c >= 0xd800 && c <= 0xdbff) {\n\t\t\t\t\t\tscalars.push((c & 1023) + 64 << 10 | arr[++i] & 1023);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscalars.push(c);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn scalars;\n\t\t\t},\n\t\t\tdecodeUTF8 = function(arr) {\n\t\t\t\tvar i, len, c, str, char = String.fromCharCode;\n\t\t\t\tfor (i=0,len=arr.length,str=\"\"; c=arr[i],i<len; i++) {\n\t\t\t\t\tif (c <= 0x7f) {\n\t\t\t\t\t\tstr += char(c);\n\t\t\t\t\t} else if (c <= 0xdf && c >= 0xc2) {\n\t\t\t\t\t\tstr += char((c&31)<<6 | arr[++i]&63);\n\t\t\t\t\t} else if (c <= 0xef && c >= 0xe0) {\n\t\t\t\t\t\tstr += char((c&15)<<12 | (arr[++i]&63)<<6 | arr[++i]&63);\n\t\t\t\t\t} else if (c <= 0xf7 && c >= 0xf0) {\n\t\t\t\t\t\tstr += char(\n\t\t\t\t\t\t\t0xd800 | ((c&7)<<8 | (arr[++i]&63)<<2 | arr[++i]>>>4&3) - 64,\n\t\t\t\t\t\t\t0xdc00 | (arr[i++]&15)<<6 | arr[i]&63\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstr += char(0xfffd);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn str;\n\t\t\t};\n\t\t\t\n\t\t\treturn decodeUTF8(scalarValues(str));\n\t\t};\n\n\t\t/**\n\t\t * Gets target file contents by file.hash\n\t\t *\n\t\t * @param      String  hash          The hash\n\t\t * @param      String  responseType  'blob' or 'arraybuffer' (default)\n\t\t * @param      Object  requestOpts   The request options\n\t\t * @return     arraybuffer|blob  The contents.\n\t\t */\n\t\tthis.getContents = function(hash, responseType, requestOpts) {\n\t\t\tvar self = this,\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\ttype = responseType || 'arraybuffer',\n\t\t\t\turl, req;\n\n\t\t\tdfd.fail(function() {\n\t\t\t\treq && req.state() === 'pending' && req.reject();\n\t\t\t});\n\n\t\t\turl = self.openUrl(hash);\n\t\t\tif (!self.isSameOrigin(url)) {\n\t\t\t\turl = self.openUrl(hash, true);\n\t\t\t}\n\t\t\treq = self.request(Object.assign({\n\t\t\t\tdata    : {cmd : 'get'},\n\t\t\t\toptions : {\n\t\t\t\t\turl: url,\n\t\t\t\t\ttype: 'get',\n\t\t\t\t\tcache : true,\n\t\t\t\t\tdataType : 'binary',\n\t\t\t\t\tresponseType : type,\n\t\t\t\t\tprocessData: false\n\t\t\t\t},\n\t\t\t\tnotify : {\n\t\t\t\t\ttype: 'file',\n\t\t\t\t\tcnt: 1,\n\t\t\t\t\thideCnt: true\n\t\t\t\t},\n\t\t\t\tcancel : true\n\t\t\t}, requestOpts || {}))\n\t\t\t.fail(function() {\n\t\t\t\tdfd.reject();\n\t\t\t})\n\t\t\t.done(function(data) {\n\t\t\t\tdfd.resolve(data);\n\t\t\t});\n\n\t\t\treturn dfd;\n\t\t};\n\n\t\t/**\n\t\t * Gets the binary by url.\n\t\t *\n\t\t * @param      {Object}    opts      The options\n\t\t * @param      {Function}  callback  The callback\n\t\t * @param      {Object}    requestOpts The request options\n\t\t * @return     arraybuffer|blob  The contents.\n\t\t */\n\t\tthis.getBinaryByUrl = function(opts, callback, requestOpts) {\n\t\t\tvar self = this,\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\turl, req;\n\n\t\t\tdfd.fail(function() {\n\t\t\t\treq && req.state() === 'pending' && req.reject();\n\t\t\t});\n\n\t\t\treq = self.request(Object.assign({\n\t\t\t\tdata    : {cmd : 'get'},\n\t\t\t\toptions : Object.assign({\n\t\t\t\t\ttype: 'get',\n\t\t\t\t\tcache : true,\n\t\t\t\t\tdataType : 'binary',\n\t\t\t\t\tresponseType : 'blob',\n\t\t\t\t\tprocessData: false\n\t\t\t\t}, opts)\n\t\t\t}, requestOpts || {}))\n\t\t\t.fail(function() {\n\t\t\t\tdfd.reject();\n\t\t\t})\n\t\t\t.done(function(data) {\n\t\t\t\tcallback && callback(data);\n\t\t\t\tdfd.resolve(data);\n\t\t\t});\n\n\t\t\treturn dfd;\n\t\t};\n\n\t\t/**\n\t\t * Gets the mimetype.\n\t\t *\n\t\t * @param      {string}  name     The name\n\t\t * @param      {string}  orgMime  The organization mime\n\t\t * @return     {string}  The mimetype.\n\t\t */\n\t\tthis.getMimetype = function(name, orgMime) {\n\t\t\tvar mime = orgMime,\n\t\t\t\text, m;\n\t\t\tm = (name + '').match(/\\.([^.]+)$/);\n\t\t\tif (m && (ext = m[1])) {\n\t\t\t\tif (!extToMimeTable) {\n\t\t\t\t\textToMimeTable = self.arrayFlip(self.mimeTypes);\n\t\t\t\t}\n\t\t\t\tif (!(mime = extToMimeTable[ext.toLowerCase()])) {\n\t\t\t\t\tmime = orgMime;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn mime;\n\t\t};\n\n\t\t/**\n\t\t * Supported check hash algorisms\n\t\t * \n\t\t * @type Array\n\t\t */\n\t\tself.hashCheckers = [];\n\n\t\t/**\n\t\t * Closure of getContentsHashes()\n\t\t */\n\t\t(function(self) {\n\t\t\tvar hashLibs = {};\n\n\t\t\tif (window.Worker && window.ArrayBuffer) {\n\t\t\t\t// make fm.hashCheckers\n\t\t\t\tif (self.options.cdns.sparkmd5) {\n\t\t\t\t\thashLibs.SparkMD5 = true;\n\t\t\t\t\tself.hashCheckers.push('md5');\n\t\t\t\t}\n\t\t\t\tif (self.options.cdns.jssha) {\n\t\t\t\t\thashLibs.jsSHA = true;\n\t\t\t\t\tself.hashCheckers = self.hashCheckers.concat(['sha1', 'sha224', 'sha256', 'sha384', 'sha512', 'sha3-224', 'sha3-256', 'sha3-384', 'sha3-512', 'shake128', 'shake256']);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Gets the contents hashes.\n\t\t\t *\n\t\t\t * @param      String  target      target file.hash\n\t\t\t * @param      Object  needHashes  need hash lib names\n\t\t\t * @param      Object  requestOpts The request options\n\t\t\t * @return     Object  hashes with lib name as key\n\t\t\t */\n\t\t\tself.getContentsHashes = function(target, needHashes, hashOpts, requestOpts) {\n\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\tneeds = self.arrayFlip(needHashes || ['md5'], true),\n\t\t\t\t\tlibs = [],\n\t\t\t\t\tjobs = [],\n\t\t\t\t\tres = {},\n\t\t\t\t\topts = hashOpts? hashOpts : {\n\t\t\t\t\t\tshake128len : 256,\n\t\t\t\t\t\tshake256len : 512\n\t\t\t\t\t},\n\t\t\t\t\treq;\n\n\t\t\t\tdfd.fail(function() {\n\t\t\t\t\treq && req.reject();\n\t\t\t\t});\n\n\t\t\t\tif (Object.keys(hashLibs).length) {\n\t\t\t\t\treq = self.getContents(target, 'arraybuffer', requestOpts).done(function(arrayBuffer) {\n\t\t\t\t\t\tif (needs.md5 && hashLibs.SparkMD5) {\n\t\t\t\t\t\t\tjobs.push((function() {\n\t\t\t\t\t\t\t\tvar job = $.Deferred();\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tvar wk = self.getWorker();\n\t\t\t\t\t\t\t\t\tjob.fail(function() {\n\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\twk.onmessage = function(ans) {\n\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t\tif (ans.data.hash) {\n\t\t\t\t\t\t\t\t\t\t\tvar f;\n\t\t\t\t\t\t\t\t\t\t\tres.md5 = ans.data.hash;\n\t\t\t\t\t\t\t\t\t\t\tif (f = self.file(target)) {\n\t\t\t\t\t\t\t\t\t\t\t\tf.md5 = res.md5;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else if (ans.data.error) {\n\t\t\t\t\t\t\t\t\t\t\tres.md5 = ans.data.error;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdfd.notify(res);\n\t\t\t\t\t\t\t\t\t\tjob.resolve();\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\twk.onerror = function(e) {\n\t\t\t\t\t\t\t\t\t\tjob.reject();\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\tscripts: [self.options.cdns.sparkmd5, self.getWorkerUrl('calcfilehash.js')],\n\t\t\t\t\t\t\t\t\t\tdata: { type: 'md5', bin: arrayBuffer }\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tdfd.fail(function() {\n\t\t\t\t\t\t\t\t\t\tjob.reject();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tjob.reject();\n\t\t\t\t\t\t\t\t\tdelete hashLibs.SparkMD5;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn job;\n\t\t\t\t\t\t\t})());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hashLibs.jsSHA) {\n\t\t\t\t\t\t\t$.each(['1', '224', '256', '384', '512', '3-224', '3-256', '3-384', '3-512', 'ke128', 'ke256'], function(i, v) {\n\t\t\t\t\t\t\t\tif (needs['sha' + v]) {\n\t\t\t\t\t\t\t\t\tjobs.push((function() {\n\t\t\t\t\t\t\t\t\t\tvar job = $.Deferred();\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tvar wk = self.getWorker();\n\t\t\t\t\t\t\t\t\t\t\tjob.fail(function() {\n\t\t\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\twk.onmessage = function(ans) {\n\t\t\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t\t\t\tif (ans.data.hash) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar f;\n\t\t\t\t\t\t\t\t\t\t\t\t\tres['sha' + v] = ans.data.hash;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (f = self.file(target)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tf['sha' + v] = res['sha' + v];\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} else if (ans.data.error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tres['sha' + v] = ans.data.error;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tdfd.notify(res);\n\t\t\t\t\t\t\t\t\t\t\t\tjob.resolve();\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\twk.onerror = function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\tjob.reject();\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\t\t\tscripts: [self.options.cdns.jssha, self.getWorkerUrl('calcfilehash.js')],\n\t\t\t\t\t\t\t\t\t\t\t\tdata: { type: v, bin: arrayBuffer, hashOpts: opts }\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tdfd.fail(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tjob.reject();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\t\tjob.reject();\n\t\t\t\t\t\t\t\t\t\t\tdelete hashLibs.jsSHA;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn job;\n\t\t\t\t\t\t\t\t\t})());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (jobs.length) {\n\t\t\t\t\t\t\t$.when.apply(null, jobs).always(function() {\n\t\t\t\t\t\t\t\tdfd.resolve(res);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfd.reject();\n\t\t\t\t}\n\n\t\t\t\treturn dfd;\n\t\t\t};\n\t\t})(this);\n\n\t\t/**\n\t\t * Parse error value to display\n\t\t *\n\t\t * @param  Mixed  error\n\t\t * @return Mixed  parsed error\n\t\t */\n\t\tthis.parseError = function(error) {\n\t\t\tvar arg = error;\n\t\t\tif ($.isPlainObject(arg)) {\n\t\t\t\targ = arg.error;\n\t\t\t}\n\t\t\treturn arg;\n\t\t};\n\n\t\t/**\n\t\t * Alias for this.trigger('error', {error : 'message'})\n\t\t *\n\t\t * @param  String  error message\n\t\t * @return elFinder\n\t\t **/\n\t\tthis.error = function() {\n\t\t\tvar arg = arguments[0],\n\t\t\t\topts = arguments[1] || null,\n\t\t\t\terr;\n\t\t\tif (arguments.length == 1 && typeof(arg) === 'function') {\n\t\t\t\treturn self.bind('error', arg);\n\t\t\t} else {\n\t\t\t\terr = this.parseError(arg);\n\t\t\t\treturn (err === true || !err)? this : self.trigger('error', {error: err, opts : opts});\n\t\t\t}\n\t\t};\n\t\t\n\t\t// create bind/trigger aliases for build-in events\n\t\t$.each(events, function(i, name) {\n\t\t\tself[name] = function() {\n\t\t\t\tvar arg = arguments[0];\n\t\t\t\treturn arguments.length == 1 && typeof(arg) == 'function'\n\t\t\t\t\t? self.bind(name, arg)\n\t\t\t\t\t: self.trigger(name, $.isPlainObject(arg) ? arg : {});\n\t\t\t};\n\t\t});\n\n\t\t// bind core event handlers\n\t\tthis\n\t\t\t.enable(function() {\n\t\t\t\tif (!enabled && self.api && self.visible() && self.ui.overlay.is(':hidden') && ! node.children('.elfinder-dialog.' + self.res('class', 'editing') + ':visible').length) {\n\t\t\t\t\tenabled = true;\n\t\t\t\t\tdocument.activeElement && document.activeElement.blur();\n\t\t\t\t\tnode.removeClass('elfinder-disabled');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.disable(function() {\n\t\t\t\tprevEnabled = enabled;\n\t\t\t\tenabled = false;\n\t\t\t\tnode.addClass('elfinder-disabled');\n\t\t\t})\n\t\t\t.open(function() {\n\t\t\t\tselected = [];\n\t\t\t})\n\t\t\t.select(function(e) {\n\t\t\t\tvar cnt = 0,\n\t\t\t\t\tunselects = [];\n\t\t\t\tselected = $.grep(e.data.selected || e.data.value|| [], function(hash) {\n\t\t\t\t\tif (unselects.length || (self.maxTargets && ++cnt > self.maxTargets)) {\n\t\t\t\t\t\tunselects.push(hash);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn files[hash] ? true : false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (unselects.length) {\n\t\t\t\t\tself.trigger('unselectfiles', {files: unselects, inselect: true});\n\t\t\t\t\tself.toast({mode: 'warning', msg: self.i18n(['errMaxTargets', self.maxTargets])});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.error(function(e) { \n\t\t\t\tvar opts  = {\n\t\t\t\t\t\tcssClass  : 'elfinder-dialog-error',\n\t\t\t\t\t\ttitle     : self.i18n('error'),\n\t\t\t\t\t\tresizable : false,\n\t\t\t\t\t\tdestroyOnClose : true,\n\t\t\t\t\t\tbuttons   : {}\n\t\t\t\t\t},\n\t\t\t\t\tnode = self.getUI(),\n\t\t\t\t\tcnt = node.children('.elfinder-dialog-error').length,\n\t\t\t\t\tlast, counter;\n\t\t\t\t\n\t\t\t\tif (cnt < self.options.maxErrorDialogs) {\n\t\t\t\t\topts.buttons[self.i18n(self.i18n('btnClose'))] = function() { $(this).elfinderdialog('close'); };\n\n\t\t\t\t\tif (e.data.opts && $.isPlainObject(e.data.opts)) {\n\t\t\t\t\t\tObject.assign(opts, e.data.opts);\n\t\t\t\t\t}\n\n\t\t\t\t\tself.dialog('<span class=\"elfinder-dialog-icon elfinder-dialog-icon-error\"/>'+self.i18n(e.data.error), opts);\n\t\t\t\t} else {\n\t\t\t\t\tlast = node.children('.elfinder-dialog-error:last').children('.ui-dialog-content:first');\n\t\t\t\t\tcounter = last.children('.elfinder-error-counter');\n\t\t\t\t\tif (counter.length) {\n\t\t\t\t\t\tcounter.data('cnt', parseInt(counter.data('cnt')) + 1).html(self.i18n(['moreErrors', counter.data('cnt')]));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcounter = $('<span class=\"elfinder-error-counter\">'+ self.i18n(['moreErrors', 1]) +'</span>').data('cnt', 1);\n\t\t\t\t\t\tlast.append('<br/>', counter);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('tmb', function(e) {\n\t\t\t\t$.each(e.data.images||[], function(hash, tmb) {\n\t\t\t\t\tif (files[hash]) {\n\t\t\t\t\t\tfiles[hash].tmb = tmb;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.bind('searchstart', function(e) {\n\t\t\t\tObject.assign(self.searchStatus, e.data);\n\t\t\t\tself.searchStatus.state = 1;\n\t\t\t})\n\t\t\t.bind('search', function(e) {\n\t\t\t\tself.searchStatus.state = 2;\n\t\t\t})\n\t\t\t.bind('searchend', function() {\n\t\t\t\tself.searchStatus.state = 0;\n\t\t\t\tself.searchStatus.ininc = false;\n\t\t\t\tself.searchStatus.mixed = false;\n\t\t\t})\n\t\t\t.bind('canMakeEmptyFile', function(e) {\n\t\t\t\tvar data = e.data,\n\t\t\t\t\tobj = {};\n\t\t\t\tif (data && Array.isArray(data.mimes)) {\n\t\t\t\t\tif (!data.unshift) {\n\t\t\t\t\t\tobj = self.mimesCanMakeEmpty;\n\t\t\t\t\t}\n\t\t\t\t\t$.each(data.mimes, function() {\n\t\t\t\t\t\tif (!obj[this]) {\n\t\t\t\t\t\t\tobj[this] = self.mimeTypes[this];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (data.unshift) {\n\t\t\t\t\t\tself.mimesCanMakeEmpty = Object.assign(obj, self.mimesCanMakeEmpty);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('themechange', function() {\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.trigger('uiresize');\n\t\t\t\t});\n\t\t\t})\n\t\t\t;\n\n\t\t// We listen and emit a sound on delete according to option\n\t\tif (true === this.options.sound) {\n\t\t\tthis.bind('playsound', function(e) {\n\t\t\t\tvar play  = beeper.canPlayType && beeper.canPlayType('audio/wav; codecs=\"1\"'),\n\t\t\t\t\tfile = e.data && e.data.soundFile;\n\n\t\t\t\tplay && file && play != '' && play != 'no' && $(beeper).html('<source src=\"' + soundPath + file + '\" type=\"audio/wav\">')[0].play();\n\t\t\t});\n\t\t}\n\n\t\t// bind external event handlers\n\t\t$.each(this.options.handlers, function(event, callback) {\n\t\t\tself.bind(event, callback);\n\t\t});\n\n\t\t/**\n\t\t * History object. Store visited folders\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tthis.history = new this.history(this);\n\t\t\n\t\t/**\n\t\t * Root hashed\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.roots = {};\n\t\t\n\t\t/**\n\t\t * leaf roots\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.leafRoots = {};\n\t\t\n\t\tthis.volumeExpires = {};\n\n\t\t/**\n\t\t * Loaded commands\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tthis._commands = {};\n\t\t\n\t\tif (!Array.isArray(this.options.commands)) {\n\t\t\tthis.options.commands = [];\n\t\t}\n\t\t\n\t\tif ($.inArray('*', this.options.commands) !== -1) {\n\t\t\tthis.options.commands = Object.keys(this.commands);\n\t\t}\n\t\t\n\t\t/**\n\t\t * UI command map of cwd volume ( That volume driver option `uiCmdMap` )\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tthis.commandMap = {};\n\t\t\n\t\t/**\n\t\t * cwd options of each volume\n\t\t * key: volumeid\n\t\t * val: options object\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.volOptions = {};\n\n\t\t/**\n\t\t * Has volOptions data\n\t\t * \n\t\t * @type Boolean\n\t\t */\n\t\tthis.hasVolOptions = false;\n\n\t\t/**\n\t\t * Hash of trash holders\n\t\t * key: trash folder hash\n\t\t * val: source volume hash\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthis.trashes = {};\n\n\t\t/**\n\t\t * cwd options of each folder/file\n\t\t * key: hash\n\t\t * val: options object\n\t\t *\n\t\t * @type Object\n\t\t */\n\t\tthis.optionsByHashes = {};\n\t\t\n\t\t/**\n\t\t * UI Auto Hide Functions\n\t\t * Each auto hide function mast be call to `fm.trigger('uiautohide')` at end of process\n\t\t *\n\t\t * @type Array\n\t\t **/\n\t\tthis.uiAutoHide = [];\n\t\t\n\t\t// trigger `uiautohide`\n\t\tthis.one('open', function() {\n\t\t\tif (self.uiAutoHide.length) {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tself.trigger('uiautohide');\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Auto Hide Functions sequential processing start\n\t\tthis.bind('uiautohide', function() {\n\t\t\tif (self.uiAutoHide.length) {\n\t\t\t\tself.uiAutoHide.shift()();\n\t\t\t}\n\t\t});\n\n\t\tif (this.options.width) {\n\t\t\twidth = this.options.width;\n\t\t}\n\t\t\n\t\tif (this.options.height) {\n\t\t\theight = this.options.height;\n\t\t}\n\t\t\n\t\tif (this.options.heightBase) {\n\t\t\theightBase = $(this.options.heightBase);\n\t\t}\n\t\t\n\t\tif (this.options.soundPath) {\n\t\t\tsoundPath = this.options.soundPath.replace(/\\/+$/, '') + '/';\n\t\t} else {\n\t\t\tsoundPath = this.baseUrl + soundPath;\n\t\t}\n\t\t\n\t\tif (this.options.parrotHeaders && Array.isArray(this.options.parrotHeaders) && this.options.parrotHeaders.length) {\n\t\t\tthis.parrotHeaders = this.options.parrotHeaders;\n\t\t\t// check sessionStorage\n\t\t\t$.each(this.parrotHeaders, function(i, h) {\n\t\t\t\tvar v = self.sessionStorage('core-ph:' + h);\n\t\t\t\tif (v) {\n\t\t\t\t\tself.customHeaders[h] = v;\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.parrotHeaders = [];\n\t\t}\n\n\t\tself.one('opendone', function() {\n\t\t\tvar tm;\n\t\t\t// attach events to document\n\t\t\t$(document)\n\t\t\t\t// disable elfinder on click outside elfinder\n\t\t\t\t.on('click.'+namespace, function(e) { enabled && ! self.options.enableAlways && !$(e.target).closest(node).length && self.disable(); })\n\t\t\t\t// exec shortcuts\n\t\t\t\t.on(keydown+' '+keypress+' '+keyup+' '+mousedown, execShortcut);\n\t\t\t\n\t\t\t// attach events to window\n\t\t\tself.options.useBrowserHistory && $(window)\n\t\t\t\t.on('popstate.' + namespace, function(ev) {\n\t\t\t\t\tvar state = ev.originalEvent.state || {},\n\t\t\t\t\t\thasThash = state.thash? true : false,\n\t\t\t\t\t\tdialog = node.find('.elfinder-frontmost:visible'),\n\t\t\t\t\t\tinput = node.find('.elfinder-navbar-dir,.elfinder-cwd-filename').find('input,textarea'),\n\t\t\t\t\t\tonOpen, toast;\n\t\t\t\t\tif (!hasThash) {\n\t\t\t\t\t\tstate = { thash: self.cwd().hash };\n\t\t\t\t\t\t// scroll to elFinder node\n\t\t\t\t\t\t$('html,body').animate({ scrollTop: node.offset().top });\n\t\t\t\t\t}\n\t\t\t\t\tif (dialog.length || input.length) {\n\t\t\t\t\t\thistory.pushState(state, null, location.pathname + location.search + '#elf_' + state.thash);\n\t\t\t\t\t\tif (dialog.length) {\n\t\t\t\t\t\t\tif (!dialog.hasClass(self.res('class', 'preventback'))) {\n\t\t\t\t\t\t\t\tif (dialog.hasClass('elfinder-contextmenu')) {\n\t\t\t\t\t\t\t\t\t$(document).trigger($.Event('keydown', { keyCode: $.ui.keyCode.ESCAPE, ctrlKey : false, shiftKey : false, altKey : false, metaKey : false }));\n\t\t\t\t\t\t\t\t} else if (dialog.hasClass('elfinder-dialog')) {\n\t\t\t\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdialog.trigger('close');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinput.trigger($.Event('keydown', { keyCode: $.ui.keyCode.ESCAPE, ctrlKey : false, shiftKey : false, altKey : false, metaKey : false }));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (hasThash) {\n\t\t\t\t\t\t\t!$.isEmptyObject(self.files()) && self.request({\n\t\t\t\t\t\t\t\tdata   : {cmd  : 'open', target : state.thash, onhistory : 1},\n\t\t\t\t\t\t\t\tnotify : {type : 'open', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\t\tsyncOnFail : true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonOpen = function() {\n\t\t\t\t\t\t\t\ttoast.trigger('click');\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tself.one('open', onOpen, true);\n\t\t\t\t\t\t\ttoast = self.toast({\n\t\t\t\t\t\t\t\tmsg: self.i18n('pressAgainToExit'),\n\t\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\t\tself.unbind('open', onOpen);\n\t\t\t\t\t\t\t\t\thistory.pushState(state, null, location.pathname + location.search + '#elf_' + state.thash);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t\t$(window).on('resize.' + namespace, function(e){\n\t\t\t\tif (e.target === this) {\n\t\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\t\tvar prv = node.data('resizeSize') || {w: 0, h: 0},\n\t\t\t\t\t\t\tsize = {w: Math.round(node.width()), h: Math.round(node.height())};\n\t\t\t\t\t\tnode.data('resizeSize', size);\n\t\t\t\t\t\tif (size.w !== prv.w || size.h !== prv.h) {\n\t\t\t\t\t\t\tnode.trigger('resize');\n\t\t\t\t\t\t\tself.trigger('resize', {width : size.w, height : size.h});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('beforeunload.' + namespace,function(e){\n\t\t\t\tvar msg, cnt;\n\t\t\t\tif (!self.pauseUnloadCheck()) {\n\t\t\t\t\tif (node.is(':visible')) {\n\t\t\t\t\t\tif (self.ui.notify.children().length && $.inArray('hasNotifyDialog', self.options.windowCloseConfirm) !== -1) {\n\t\t\t\t\t\t\tmsg = self.i18n('ntfsmth');\n\t\t\t\t\t\t} else if (node.find('.'+self.res('class', 'editing')).length && $.inArray('editingFile', self.options.windowCloseConfirm) !== -1) {\n\t\t\t\t\t\t\tmsg = self.i18n('editingFile');\n\t\t\t\t\t\t} else if ((cnt = Object.keys(self.selected()).length) && $.inArray('hasSelectedItem', self.options.windowCloseConfirm) !== -1) {\n\t\t\t\t\t\t\tmsg = self.i18n('hasSelected', ''+cnt);\n\t\t\t\t\t\t} else if ((cnt = Object.keys(self.clipboard()).length) && $.inArray('hasClipboardData', self.options.windowCloseConfirm) !== -1) {\n\t\t\t\t\t\t\tmsg = self.i18n('hasClipboard', ''+cnt);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (msg) {\n\t\t\t\t\t\t\te.returnValue = msg;\n\t\t\t\t\t\t\treturn msg;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tself.trigger('unload');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// bind window onmessage for CORS\n\t\t\t$(window).on('message.' + namespace, function(e){\n\t\t\t\tvar res = e.originalEvent || null,\n\t\t\t\t\tobj, data;\n\t\t\t\tif (res && (self.convAbsUrl(self.options.url).indexOf(res.origin) === 0 || self.convAbsUrl(self.uploadURL).indexOf(res.origin) === 0)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tobj = JSON.parse(res.data);\n\t\t\t\t\t\tdata = obj.data || null;\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tif (data.error) {\n\t\t\t\t\t\t\t\tif (obj.bind) {\n\t\t\t\t\t\t\t\t\tself.trigger(obj.bind+'fail', data);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tself.error(data.error);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdata.warning && self.error(data.warning);\n\t\t\t\t\t\t\t\tself.updateCache(data);\n\t\t\t\t\t\t\t\tdata.removed && data.removed.length && self.remove(data);\n\t\t\t\t\t\t\t\tdata.added   && data.added.length   && self.add(data);\n\t\t\t\t\t\t\t\tdata.changed && data.changed.length && self.change(data);\n\t\t\t\t\t\t\t\tif (obj.bind) {\n\t\t\t\t\t\t\t\t\tself.trigger(obj.bind, data);\n\t\t\t\t\t\t\t\t\tself.trigger(obj.bind+'done');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdata.sync && self.sync();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself.sync();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// elFinder enable always\n\t\t\tif (self.options.enableAlways) {\n\t\t\t\t$(window).on('focus.' + namespace, function(e){\n\t\t\t\t\t(e.target === this) && self.enable();\n\t\t\t\t});\n\t\t\t\tif (inFrame) {\n\t\t\t\t\t$(window.top).on('focus.' + namespace, function() {\n\t\t\t\t\t\tif (self.enable() && (! parentIframe || parentIframe.is(':visible'))) {\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t$(window).trigger('focus');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (inFrame) {\n\t\t\t\t$(window).on('blur.' + namespace, function(e){\n\t\t\t\t\tenabled && e.target === this && self.disable();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// return focus to the window on click (elFInder in the frame)\n\t\t\tif (inFrame) {\n\t\t\t\tnode.on('click', function(e) {\n\t\t\t\t\t$(window).trigger('focus');\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// elFinder to enable by mouse over\n\t\t\tif (self.options.enableByMouseOver) {\n\t\t\t\tnode.on('mouseenter touchstart', function(e) {\n\t\t\t\t\t(inFrame) && $(window).trigger('focus');\n\t\t\t\t\t! self.enabled() && self.enable();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// When the browser tab turn to foreground/background\n\t\t\t$(window).on('visibilitychange.' + namespace, function(e) {\n\t\t\t\tvar background = document.hidden || document.webkitHidden || document.msHidden;\n\t\t\t\t// AutoSync turn On/Off\n\t\t\t\tif (self.options.syncStart) {\n\t\t\t\t\tself.autoSync(background? 'stop' : void(0));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// store instance in node\n\t\tnode[0].elfinder = this;\n\n\t\t// auto load language file\n\t\tdfrdsBeforeBootup.push((function() {\n\t\t\tvar lang   = self.lang,\n\t\t\t\tlangJs = self.i18nBaseUrl + 'elfinder.' + lang + '.js',\n\t\t\t\tdfd    = $.Deferred(),\n\t\t\t\tdfd1 = dfd.done(function() { // modified by lwf\n\t\t\t\t\tif (self.i18[lang]) {\n\t\t\t\t\t\tself.lang = lang;\n\t\t\t\t\t}\n\t\t\t\t\tself.trigger('i18load');\n\t\t\t\t\ti18n = self.lang === 'en' \n\t\t\t\t\t\t? self.i18['en'] \n\t\t\t\t\t\t: $.extend(true, {}, self.i18['en'], self.i18[self.lang]);\n\t\t\t\t});\n\t\t\t\n\t\t\tif (!self.i18[lang]) {\n\t\t\t\tself.lang = 'en';\n\t\t\t\tif (self.hasRequire) {\n\t\t\t\t\trequire([langJs], function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tself.loadScript([langJs], function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}, {\n\t\t\t\t\t\tloadType: 'tag',\n\t\t\t\t\t\terror : function() {\n\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdfd.resolve();\n\t\t\t}\n\t\t\treturn dfd;\n\t\t})());\n\t\t\n\t\t// elFinder boot up function\n\t\tbootUp = function() {\n\t\t\tvar columnNames;\n\n\t\t\t/**\n\t\t\t * i18 messages\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tself.messages = i18n.messages;\n\t\t\t\n\t\t\t// check jquery ui\n\t\t\tif (!($.fn.selectable && $.fn.draggable && $.fn.droppable && $.fn.resizable && $.fn.button && $.fn.slider)) {\n\t\t\t\treturn alert(self.i18n('errJqui'));\n\t\t\t}\n\t\t\t\n\t\t\t// check node\n\t\t\tif (!node.length) {\n\t\t\t\treturn alert(self.i18n('errNode'));\n\t\t\t}\n\t\t\t// check connector url\n\t\t\tif (!self.options.url) {\n\t\t\t\treturn alert(self.i18n('errURL'));\n\t\t\t}\n\t\t\t\n\t\t\t// column key/name map for fm.getColumnName()\n\t\t\tcolumnNames = Object.assign({\n\t\t\t\tname : self.i18n('name'),\n\t\t\t\tperm : self.i18n('perms'),\n\t\t\t\tdate : self.i18n('modify'),\n\t\t\t\tsize : self.i18n('size'),\n\t\t\t\tkind : self.i18n('kind'),\n\t\t\t\tmodestr : self.i18n('mode'),\n\t\t\t\tmodeoct : self.i18n('mode'),\n\t\t\t\tmodeboth : self.i18n('mode')\n\t\t\t}, self.options.uiOptions.cwd.listView.columnsCustomName);\n\n\t\t\t/**\n\t\t\t * Gets the column name of cwd list view\n\t\t\t *\n\t\t\t * @param      String  key     The key\n\t\t\t * @return     String  The column name.\n\t\t\t */\n\t\t\tself.getColumnName = function(key) {\n\t\t\t\treturn columnNames[key] || self.i18n(key);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Interface direction\n\t\t\t *\n\t\t\t * @type String\n\t\t\t * @default \"ltr\"\n\t\t\t **/\n\t\t\tself.direction = i18n.direction;\n\t\t\t\n\t\t\t/**\n\t\t\t * Date/time format\n\t\t\t *\n\t\t\t * @type String\n\t\t\t * @default \"m.d.Y\"\n\t\t\t **/\n\t\t\tself.dateFormat = self.options.dateFormat || i18n.dateFormat;\n\t\t\t\n\t\t\t/**\n\t\t\t * Date format like \"Yesterday 10:20:12\"\n\t\t\t *\n\t\t\t * @type String\n\t\t\t * @default \"{day} {time}\"\n\t\t\t **/\n\t\t\tself.fancyFormat = self.options.fancyDateFormat || i18n.fancyDateFormat;\n\t\t\t\n\t\t\t/**\n\t\t\t * Date format for if upload file has not original unique name\n\t\t\t * e.g. Clipboard image data, Image data taken with iOS\n\t\t\t *\n\t\t\t * @type String\n\t\t\t * @default \"ymd-His\"\n\t\t\t **/\n\t\t\tself.nonameDateFormat = (self.options.nonameDateFormat || i18n.nonameDateFormat).replace(/[\\/\\\\]/g, '_');\n\n\t\t\t/**\n\t\t\t * Css classes \n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tself.cssClass = 'ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-'\n\t\t\t\t\t+(self.direction == 'rtl' ? 'rtl' : 'ltr')\n\t\t\t\t\t+(self.UA.Touch? (' elfinder-touch' + (self.options.resizable ? ' touch-punch' : '')) : '')\n\t\t\t\t\t+(self.UA.Mobile? ' elfinder-mobile' : '')\n\t\t\t\t\t+(self.UA.iOS? ' elfinder-ios' : '')\n\t\t\t\t\t+' '+self.options.cssClass;\n\n\t\t\t// prepare node\n\t\t\tnode.addClass(self.cssClass)\n\t\t\t\t.on(mousedown, function() {\n\t\t\t\t\t!enabled && self.enable();\n\t\t\t\t});\n\n\t\t\t// draggable closure\n\t\t\t(function() {\n\t\t\t\tvar ltr, wzRect, wzBottom, wzBottom2, nodeStyle,\n\t\t\t\t\tkeyEvt = keydown + 'draggable' + ' keyup.' + namespace + 'draggable';\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Base draggable options\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\tself.draggable = {\n\t\t\t\t\tappendTo   : node,\n\t\t\t\t\taddClasses : false,\n\t\t\t\t\tdistance   : 4,\n\t\t\t\t\trevert     : true,\n\t\t\t\t\trefreshPositions : false,\n\t\t\t\t\tcursor     : 'crosshair',\n\t\t\t\t\tcursorAt   : {left : 50, top : 47},\n\t\t\t\t\tscroll     : false,\n\t\t\t\t\tstart      : function(e, ui) {\n\t\t\t\t\t\tvar helper   = ui.helper,\n\t\t\t\t\t\t\ttargets  = $.grep(helper.data('files')||[], function(h) {\n\t\t\t\t\t\t\t\tif (h) {\n\t\t\t\t\t\t\t\t\tremember[h] = true;\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tlocked   = false,\n\t\t\t\t\t\t\tcnt, h;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// fix node size\n\t\t\t\t\t\tnodeStyle = node.attr('style');\n\t\t\t\t\t\tnode.width(node.width()).height(node.height());\n\t\t\t\t\t\t\n\t\t\t\t\t\t// set var for drag()\n\t\t\t\t\t\tltr = (self.direction === 'ltr');\n\t\t\t\t\t\twzRect = self.getUI('workzone').data('rectangle');\n\t\t\t\t\t\twzBottom = wzRect.top + wzRect.height;\n\t\t\t\t\t\twzBottom2 = wzBottom - self.getUI('navdock').outerHeight(true);\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.draggingUiHelper = helper;\n\t\t\t\t\t\tcnt = targets.length;\n\t\t\t\t\t\twhile (cnt--) {\n\t\t\t\t\t\t\th = targets[cnt];\n\t\t\t\t\t\t\tif (files[h].locked) {\n\t\t\t\t\t\t\t\tlocked = true;\n\t\t\t\t\t\t\t\thelper.data('locked', true);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t!locked && self.trigger('lockfiles', {files : targets});\n\t\t\t\n\t\t\t\t\t\thelper.data('autoScrTm', setInterval(function() {\n\t\t\t\t\t\t\tif (helper.data('autoScr')) {\n\t\t\t\t\t\t\t\tself.autoScroll[helper.data('autoScr')](helper.data('autoScrVal'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 50));\n\t\t\t\t\t},\n\t\t\t\t\tdrag       : function(e, ui) {\n\t\t\t\t\t\tvar helper = ui.helper,\n\t\t\t\t\t\t\tautoScr, autoUp, bottom;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((autoUp = wzRect.top > e.pageY) || wzBottom2 < e.pageY) {\n\t\t\t\t\t\t\tif (wzRect.cwdEdge > e.pageX) {\n\t\t\t\t\t\t\t\tautoScr = (ltr? 'navbar' : 'cwd') + (autoUp? 'Up' : 'Down');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tautoScr = (ltr? 'cwd' : 'navbar') + (autoUp? 'Up' : 'Down');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!autoUp) {\n\t\t\t\t\t\t\t\tif (autoScr.substr(0, 3) === 'cwd') {\n\t\t\t\t\t\t\t\t\tif (wzBottom < e.pageY) {\n\t\t\t\t\t\t\t\t\t\tbottom = wzBottom;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tautoScr = null;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tbottom = wzBottom2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (autoScr) {\n\t\t\t\t\t\t\t\thelper.data('autoScr', autoScr);\n\t\t\t\t\t\t\t\thelper.data('autoScrVal', Math.pow((autoUp? wzRect.top - e.pageY : e.pageY - bottom), 1.3));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (! autoScr) {\n\t\t\t\t\t\t\tif (helper.data('autoScr')) {\n\t\t\t\t\t\t\t\thelper.data('refreshPositions', 1).data('autoScr', null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (helper.data('refreshPositions') && $(this).elfUiWidgetInstance('draggable')) {\n\t\t\t\t\t\t\tif (helper.data('refreshPositions') > 0) {\n\t\t\t\t\t\t\t\t$(this).draggable('option', { refreshPositions : true, elfRefresh : true });\n\t\t\t\t\t\t\t\thelper.data('refreshPositions', -1);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$(this).draggable('option', { refreshPositions : false, elfRefresh : false });\n\t\t\t\t\t\t\t\thelper.data('refreshPositions', null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tstop       : function(e, ui) {\n\t\t\t\t\t\tvar helper = ui.helper,\n\t\t\t\t\t\t\tfiles;\n\t\t\t\t\t\t\n\t\t\t\t\t\t$(document).off(keyEvt);\n\t\t\t\t\t\t$(this).elfUiWidgetInstance('draggable') && $(this).draggable('option', { refreshPositions : false });\n\t\t\t\t\t\tself.draggingUiHelper = null;\n\t\t\t\t\t\tself.trigger('focus').trigger('dragstop');\n\t\t\t\t\t\tif (! helper.data('droped')) {\n\t\t\t\t\t\t\tfiles = $.grep(helper.data('files')||[], function(h) { return h? true : false ;});\n\t\t\t\t\t\t\tself.trigger('unlockfiles', {files : files});\n\t\t\t\t\t\t\tself.trigger('selectfiles', {files : self.selected()});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.enable();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// restore node style\n\t\t\t\t\t\tnode.attr('style', nodeStyle);\n\t\t\t\t\t\t\n\t\t\t\t\t\thelper.data('autoScrTm') && clearInterval(helper.data('autoScrTm'));\n\t\t\t\t\t},\n\t\t\t\t\thelper     : function(e, ui) {\n\t\t\t\t\t\tvar element = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\thelper  = $('<div class=\"elfinder-drag-helper\"><span class=\"elfinder-drag-helper-icon-status\"/></div>'),\n\t\t\t\t\t\t\ticon    = function(f) {\n\t\t\t\t\t\t\t\tvar mime = f.mime, i, tmb = self.tmb(f);\n\t\t\t\t\t\t\t\ti = '<div class=\"elfinder-cwd-icon elfinder-cwd-icon-drag '+self.mime2class(mime)+' ui-corner-all\"/>';\n\t\t\t\t\t\t\t\tif (tmb) {\n\t\t\t\t\t\t\t\t\ti = $(i).addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\").get(0).outerHTML;\n\t\t\t\t\t\t\t\t} else if (f.icon) {\n\t\t\t\t\t\t\t\t\ti = $(i).css(self.getIconStyle(f, true)).get(0).outerHTML;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (f.csscls) {\n\t\t\t\t\t\t\t\t\ti = '<div class=\"'+f.csscls+'\">' + i + '</div>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thashes, l, ctr;\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.draggingUiHelper && self.draggingUiHelper.stop(true, true);\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.trigger('dragstart', {target : element[0], originalEvent : e}, true);\n\t\t\t\t\t\t\n\t\t\t\t\t\thashes = element.hasClass(self.res('class', 'cwdfile')) \n\t\t\t\t\t\t\t? self.selected() \n\t\t\t\t\t\t\t: [self.navId2Hash(element.attr('id'))];\n\t\t\t\t\t\t\n\t\t\t\t\t\thelper.append(icon(files[hashes[0]])).data('files', hashes).data('locked', false).data('droped', false).data('namespace', namespace).data('dropover', 0);\n\t\t\t\n\t\t\t\t\t\tif ((l = hashes.length) > 1) {\n\t\t\t\t\t\t\thelper.append(icon(files[hashes[l-1]]) + '<span class=\"elfinder-drag-num\">'+l+'</span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$(document).on(keyEvt, function(e){\n\t\t\t\t\t\t\tvar chk = (e.shiftKey||e.ctrlKey||e.metaKey);\n\t\t\t\t\t\t\tif (ctr !== chk) {\n\t\t\t\t\t\t\t\tctr = chk;\n\t\t\t\t\t\t\t\tif (helper.is(':visible') && helper.data('dropover') && ! helper.data('droped')) {\n\t\t\t\t\t\t\t\t\thelper.toggleClass('elfinder-drag-helper-plus', helper.data('locked')? true : ctr);\n\t\t\t\t\t\t\t\t\tself.trigger(ctr? 'unlockfiles' : 'lockfiles', {files : hashes, helper: helper});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn helper;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t})();\n\n\t\t\t// in getFileCallback set - change default actions on double click/enter/ctrl+enter\n\t\t\tif (self.commands.getfile) {\n\t\t\t\tif (typeof(self.options.getFileCallback) == 'function') {\n\t\t\t\t\tself.bind('dblclick', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tself.exec('getfile').fail(function() {\n\t\t\t\t\t\t\tself.exec('open', e.data && e.data.file? [ e.data.file ]: void(0));\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tself.shortcut({\n\t\t\t\t\t\tpattern     : 'enter',\n\t\t\t\t\t\tdescription : self.i18n('cmdgetfile'),\n\t\t\t\t\t\tcallback    : function() { self.exec('getfile').fail(function() { self.exec(self.OS == 'mac' ? 'rename' : 'open'); }); }\n\t\t\t\t\t})\n\t\t\t\t\t.shortcut({\n\t\t\t\t\t\tpattern     : 'ctrl+enter',\n\t\t\t\t\t\tdescription : self.i18n(self.OS == 'mac' ? 'cmdrename' : 'cmdopen'),\n\t\t\t\t\t\tcallback    : function() { self.exec(self.OS == 'mac' ? 'rename' : 'open'); }\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tself.options.getFileCallback = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// load commands\n\t\t\t$.each(self.commands, function(name, cmd) {\n\t\t\t\tvar proto = Object.assign({}, cmd.prototype),\n\t\t\t\t\textendsCmd, opts;\n\t\t\t\tif ($.isFunction(cmd) && !self._commands[name] && (cmd.prototype.forceLoad || $.inArray(name, self.options.commands) !== -1)) {\n\t\t\t\t\textendsCmd = cmd.prototype.extendsCmd || '';\n\t\t\t\t\tif (extendsCmd) {\n\t\t\t\t\t\tif ($.isFunction(self.commands[extendsCmd])) {\n\t\t\t\t\t\t\tcmd.prototype = Object.assign({}, base, new self.commands[extendsCmd](), cmd.prototype);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcmd.prototype = Object.assign({}, base, cmd.prototype);\n\t\t\t\t\t}\n\t\t\t\t\tself._commands[name] = new cmd();\n\t\t\t\t\tcmd.prototype = proto;\n\t\t\t\t\topts = self.options.commandsOptions[name] || {};\n\t\t\t\t\tif (extendsCmd && self.options.commandsOptions[extendsCmd]) {\n\t\t\t\t\t\topts = $.extend(true, {}, self.options.commandsOptions[extendsCmd], opts);\n\t\t\t\t\t}\n\t\t\t\t\tself._commands[name].setup(name, opts);\n\t\t\t\t\t// setup linked commands\n\t\t\t\t\tif (self._commands[name].linkedCmds.length) {\n\t\t\t\t\t\t$.each(self._commands[name].linkedCmds, function(i, n) {\n\t\t\t\t\t\t\tvar lcmd = self.commands[n];\n\t\t\t\t\t\t\tif ($.isFunction(lcmd) && !self._commands[n]) {\n\t\t\t\t\t\t\t\tlcmd.prototype = base;\n\t\t\t\t\t\t\t\tself._commands[n] = new lcmd();\n\t\t\t\t\t\t\t\tself._commands[n].setup(n, self.options.commandsOptions[n]||{});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * UI nodes\n\t\t\t *\n\t\t\t * @type Object\n\t\t\t **/\n\t\t\tself.ui = {\n\t\t\t\t// container for nav panel and current folder container\n\t\t\t\tworkzone : $('<div/>').appendTo(node).elfinderworkzone(self),\n\t\t\t\t// contaainer for folders tree / places\n\t\t\t\tnavbar : $('<div/>').appendTo(node).elfindernavbar(self, self.options.uiOptions.navbar || {}),\n\t\t\t\t// container for for preview etc at below the navbar\n\t\t\t\tnavdock : $('<div/>').appendTo(node).elfindernavdock(self, self.options.uiOptions.navdock || {}),\n\t\t\t\t// contextmenu\n\t\t\t\tcontextmenu : $('<div/>').appendTo(node).elfindercontextmenu(self),\n\t\t\t\t// overlay\n\t\t\t\toverlay : $('<div/>').appendTo(node).elfinderoverlay({\n\t\t\t\t\tshow : function() { self.disable(); },\n\t\t\t\t\thide : function() { prevEnabled && self.enable(); }\n\t\t\t\t}),\n\t\t\t\t// current folder container\n\t\t\t\tcwd : $('<div/>').appendTo(node).elfindercwd(self, self.options.uiOptions.cwd || {}),\n\t\t\t\t// notification dialog window\n\t\t\t\tnotify : self.dialog('', {\n\t\t\t\t\tcssClass      : 'elfinder-dialog-notify' + (self.options.notifyDialog.canClose? '' : ' elfinder-titlebar-button-hide'),\n\t\t\t\t\tposition      : self.options.notifyDialog.position,\n\t\t\t\t\tabsolute      : true,\n\t\t\t\t\tresizable     : false,\n\t\t\t\t\tautoOpen      : false,\n\t\t\t\t\tallowMinimize : true,\n\t\t\t\t\tcloseOnEscape : self.options.notifyDialog.canClose? true : false,\n\t\t\t\t\ttitle         : '&nbsp;',\n\t\t\t\t\twidth         : self.options.notifyDialog.width? parseInt(self.options.notifyDialog.width) : null,\n\t\t\t\t\tminHeight     : null,\n\t\t\t\t\tminimize      : function() { self.ui.notify.trigger('minimize'); }\n\t\t\t\t}),\n\t\t\t\tstatusbar : $('<div class=\"ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar\"/>').hide().appendTo(node),\n\t\t\t\ttoast : $('<div class=\"elfinder-toast\"/>').appendTo(node),\n\t\t\t\tbottomtray : $('<div class=\"elfinder-bottomtray\">').appendTo(node),\n\t\t\t\tprogressbar : $('<div class=\"elfinder-ui-progressbar\">').appendTo(node)\n\t\t\t};\n\n\t\t\tself.trigger('uiready');\n\n\t\t\t// load required ui\n\t\t\t$.each(self.options.ui || [], function(i, ui) {\n\t\t\t\tvar name = 'elfinder'+ui,\n\t\t\t\t\topts = self.options.uiOptions[ui] || {};\n\t\t\n\t\t\t\tif (!self.ui[ui] && $.fn[name]) {\n\t\t\t\t\t// regist to self.ui before make instance\n\t\t\t\t\tself.ui[ui] = $('<'+(opts.tag || 'div')+'/>').appendTo(node);\n\t\t\t\t\tself.ui[ui][name](self, opts);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tself.ui.progressbar.appendTo(self.ui.workzone);\n\t\t\tself.ui.notify.prev('.ui-dialog-titlebar').append('<div class=\"elfinder-ui-progressbar\"></div>');\n\n\t\t\t// update size\t\n\t\t\tself.resize(width, height);\n\t\t\t\n\t\t\t// make node resizable\n\t\t\tif (self.options.resizable) {\n\t\t\t\tnode.resizable({\n\t\t\t\t\tresize    : function(e, ui) {\n\t\t\t\t\t\tself.resize(ui.size.width, ui.size.height);\n\t\t\t\t\t},\n\t\t\t\t\thandles   : 'se',\n\t\t\t\t\tminWidth  : 300,\n\t\t\t\t\tminHeight : 200\n\t\t\t\t});\n\t\t\t\tif (self.UA.Touch) {\n\t\t\t\t\tnode.addClass('touch-punch');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t(function() {\n\t\t\t\tvar navbar = self.getUI('navbar'),\n\t\t\t\t\tcwd    = self.getUI('cwd').parent();\n\t\t\t\t\n\t\t\t\tself.autoScroll = {\n\t\t\t\t\tnavbarUp   : function(v) {\n\t\t\t\t\t\tnavbar.scrollTop(Math.max(0, navbar.scrollTop() - v));\n\t\t\t\t\t},\n\t\t\t\t\tnavbarDown : function(v) {\n\t\t\t\t\t\tnavbar.scrollTop(navbar.scrollTop() + v);\n\t\t\t\t\t},\n\t\t\t\t\tcwdUp     : function(v) {\n\t\t\t\t\t\tcwd.scrollTop(Math.max(0, cwd.scrollTop() - v));\n\t\t\t\t\t},\n\t\t\t\t\tcwdDown   : function(v) {\n\t\t\t\t\t\tcwd.scrollTop(cwd.scrollTop() + v);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t})();\n\n\t\t\t// Swipe on the touch devices to show/hide of toolbar or navbar\n\t\t\tif (self.UA.Touch) {\n\t\t\t\t(function() {\n\t\t\t\t\tvar lastX, lastY, nodeOffset, nodeWidth, nodeTop, navbarW, toolbarH,\n\t\t\t\t\t\tnavbar = self.getUI('navbar'),\n\t\t\t\t\t\ttoolbar = self.getUI('toolbar'),\n\t\t\t\t\t\tmoveEv = 'touchmove.stopscroll',\n\t\t\t\t\t\tmoveTm,\n\t\t\t\t\t\tmoveUpOn = function(e) {\n\t\t\t\t\t\t\tvar touches = e.originalEvent.touches || [{}],\n\t\t\t\t\t\t\t\ty = touches[0].pageY || null;\n\t\t\t\t\t\t\tif (!lastY || y < lastY) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tmoveTm && clearTimeout(moveTm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmoveDownOn = function(e) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tmoveTm && clearTimeout(moveTm);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmoveOff = function() {\n\t\t\t\t\t\t\tmoveTm = setTimeout(function() {\n\t\t\t\t\t\t\t\tnode.off(moveEv);\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t},\n\t\t\t\t\t\thandleW, handleH = 50;\n\n\t\t\t\t\tnavbar = navbar.children().length? navbar : null;\n\t\t\t\t\ttoolbar = toolbar.length? toolbar : null;\n\t\t\t\t\tnode.on('touchstart touchmove touchend', function(e) {\n\t\t\t\t\t\tif (e.type === 'touchend') {\n\t\t\t\t\t\t\tlastX = false;\n\t\t\t\t\t\t\tlastY = false;\n\t\t\t\t\t\t\tmoveOff();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar touches = e.originalEvent.touches || [{}],\n\t\t\t\t\t\t\tx = touches[0].pageX || null,\n\t\t\t\t\t\t\ty = touches[0].pageY || null,\n\t\t\t\t\t\t\tltr = (self.direction === 'ltr'),\n\t\t\t\t\t\t\tnavbarMode, treeWidth, swipeX, moveX, toolbarT, mode;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (x === null || y === null || (e.type === 'touchstart' && touches.length > 1)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (e.type === 'touchstart') {\n\t\t\t\t\t\t\tnodeOffset = node.offset();\n\t\t\t\t\t\t\tnodeWidth = node.width();\n\t\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\t\tlastX = false;\n\t\t\t\t\t\t\t\tif (navbar.is(':hidden')) {\n\t\t\t\t\t\t\t\t\tif (! handleW) {\n\t\t\t\t\t\t\t\t\t\thandleW = Math.max(50, nodeWidth / 10);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ((ltr? (x - nodeOffset.left) : (nodeWidth + nodeOffset.left - x)) < handleW) {\n\t\t\t\t\t\t\t\t\t\tlastX = x;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if (! e.originalEvent._preventSwipeX) {\n\t\t\t\t\t\t\t\t\tnavbarW = navbar.width();\n\t\t\t\t\t\t\t\t\tif (ltr) {\n\t\t\t\t\t\t\t\t\t\tswipeX = (x < nodeOffset.left + navbarW);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tswipeX = (x > nodeOffset.left + nodeWidth - navbarW);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (swipeX) {\n\t\t\t\t\t\t\t\t\t\thandleW = Math.max(50, nodeWidth / 10);\n\t\t\t\t\t\t\t\t\t\tlastX = x;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tlastX = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (toolbar) {\n\t\t\t\t\t\t\t\tlastY = false;\n\t\t\t\t\t\t\t\tif (! e.originalEvent._preventSwipeY) {\n\t\t\t\t\t\t\t\t\ttoolbarH = toolbar.height();\n\t\t\t\t\t\t\t\t\tnodeTop = nodeOffset.top;\n\t\t\t\t\t\t\t\t\tif (y - nodeTop < (toolbar.is(':hidden')? handleH : (toolbarH + 30))) {\n\t\t\t\t\t\t\t\t\t\tlastY = y;\n\t\t\t\t\t\t\t\t\t\tnode.on(moveEv, toolbar.is(':hidden')? moveDownOn: moveUpOn);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (navbar && lastX !== false) {\n\t\t\t\t\t\t\t\tnavbarMode = (ltr? (lastX > x) : (lastX < x))? 'navhide' : 'navshow';\n\t\t\t\t\t\t\t\tmoveX = Math.abs(lastX - x);\n\t\t\t\t\t\t\t\tif (navbarMode === 'navhide' && moveX > navbarW * 0.6\n\t\t\t\t\t\t\t\t\t|| (moveX > (navbarMode === 'navhide'? navbarW / 3 : 45)\n\t\t\t\t\t\t\t\t\t\t&& (navbarMode === 'navshow'\n\t\t\t\t\t\t\t\t\t\t\t|| (ltr? x < nodeOffset.left + 20 : x > nodeOffset.left + nodeWidth - 20)\n\t\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tself.getUI('navbar').trigger(navbarMode, {handleW: handleW});\n\t\t\t\t\t\t\t\t\tlastX = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (toolbar && lastY !== false ) {\n\t\t\t\t\t\t\t\ttoolbarT = toolbar.offset().top;\n\t\t\t\t\t\t\t\tif (Math.abs(lastY - y) > Math.min(45, toolbarH / 3)) {\n\t\t\t\t\t\t\t\t\tmode = (lastY > y)? 'slideUp' : 'slideDown';\n\t\t\t\t\t\t\t\t\tif (mode === 'slideDown' || toolbarT + 20 > y) {\n\t\t\t\t\t\t\t\t\t\tif (toolbar.is(mode === 'slideDown' ? ':hidden' : ':visible')) {\n\t\t\t\t\t\t\t\t\t\t\ttoolbar.stop(true, true).trigger('toggle', {duration: 100, handleH: handleH});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tlastY = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})();\n\t\t\t}\n\n\t\t\tif (self.dragUpload) {\n\t\t\t\t// add event listener for HTML5 DnD upload\n\t\t\t\t(function() {\n\t\t\t\t\tvar isin = function(e) {\n\t\t\t\t\t\treturn (e.target.nodeName !== 'TEXTAREA' && e.target.nodeName !== 'INPUT' && $(e.target).closest('div.ui-dialog-content').length === 0);\n\t\t\t\t\t},\n\t\t\t\t\tent       = 'native-drag-enter',\n\t\t\t\t\tdisable   = 'native-drag-disable',\n\t\t\t\t\tc         = 'class',\n\t\t\t\t\tnavdir    = self.res(c, 'navdir'),\n\t\t\t\t\tdroppable = self.res(c, 'droppable'),\n\t\t\t\t\tdropover  = self.res(c, 'adroppable'),\n\t\t\t\t\tarrow     = self.res(c, 'navarrow'),\n\t\t\t\t\tclDropActive = self.res(c, 'adroppable'),\n\t\t\t\t\twz        = self.getUI('workzone'),\n\t\t\t\t\tltr       = (self.direction === 'ltr'),\n\t\t\t\t\tclearTm   = function() {\n\t\t\t\t\t\tautoScrTm && cancelAnimationFrame(autoScrTm);\n\t\t\t\t\t\tautoScrTm = null;\n\t\t\t\t\t},\n\t\t\t\t\twzRect, autoScrFn, autoScrTm;\n\t\t\t\t\t\n\t\t\t\t\tnode.on('dragenter', function(e) {\n\t\t\t\t\t\tclearTm();\n\t\t\t\t\t\tif (isin(e)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\twzRect = wz.data('rectangle');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragleave', function(e) {\n\t\t\t\t\t\tclearTm();\n\t\t\t\t\t\tif (isin(e)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragover', function(e) {\n\t\t\t\t\t\tvar autoUp;\n\t\t\t\t\t\tif (isin(e)) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.originalEvent.dataTransfer.dropEffect = 'none';\n\t\t\t\t\t\t\tif (! autoScrTm) {\n\t\t\t\t\t\t\t\tautoScrTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tvar wzBottom = wzRect.top + wzRect.height,\n\t\t\t\t\t\t\t\t\t\twzBottom2 = wzBottom - self.getUI('navdock').outerHeight(true),\n\t\t\t\t\t\t\t\t\t\tfn;\n\t\t\t\t\t\t\t\t\tif ((autoUp = e.pageY < wzRect.top) || e.pageY > wzBottom2 ) {\n\t\t\t\t\t\t\t\t\t\tif (wzRect.cwdEdge > e.pageX) {\n\t\t\t\t\t\t\t\t\t\t\tfn = (ltr? 'navbar' : 'cwd') + (autoUp? 'Up' : 'Down');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfn = (ltr? 'cwd' : 'navbar') + (autoUp? 'Up' : 'Down');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!autoUp) {\n\t\t\t\t\t\t\t\t\t\t\tif (fn.substr(0, 3) === 'cwd') {\n\t\t\t\t\t\t\t\t\t\t\t\tif (wzBottom < e.pageY) {\n\t\t\t\t\t\t\t\t\t\t\t\t\twzBottom2 = wzBottom;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfn = '';\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfn && self.autoScroll[fn](Math.pow((autoUp? wzRect.top - e.pageY : e.pageY - wzBottom2), 1.3));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tautoScrTm = null;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclearTm();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('drop', function(e) {\n\t\t\t\t\t\tclearTm();\n\t\t\t\t\t\tif (isin(e)) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tnode.on('dragenter', '.native-droppable', function(e){\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar $elm = $(e.currentTarget),\n\t\t\t\t\t\t\t\tid   = e.currentTarget.id || null,\n\t\t\t\t\t\t\t\tcwd  = null,\n\t\t\t\t\t\t\t\telfFrom;\n\t\t\t\t\t\t\tif (!id) { // target is cwd\n\t\t\t\t\t\t\t\tcwd = self.cwd();\n\t\t\t\t\t\t\t\t$elm.data(disable, false);\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t$.each(e.originalEvent.dataTransfer.types, function(i, v){\n\t\t\t\t\t\t\t\t\t\tif (v.substr(0, 13) === 'elfinderfrom:') {\n\t\t\t\t\t\t\t\t\t\t\telfFrom = v.substr(13).toLowerCase();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!cwd || (cwd.write && (!elfFrom || elfFrom !== (window.location.href + cwd.hash).toLowerCase()))) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t$elm.data(ent, true);\n\t\t\t\t\t\t\t\t$elm.addClass(clDropActive);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$elm.data(disable, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragleave', '.native-droppable', function(e){\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar $elm = $(e.currentTarget);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tif ($elm.data(ent)) {\n\t\t\t\t\t\t\t\t$elm.data(ent, false);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$elm.removeClass(clDropActive);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragover', '.native-droppable', function(e){\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar $elm = $(e.currentTarget);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.originalEvent.dataTransfer.dropEffect = $elm.data(disable)? 'none' : 'copy';\n\t\t\t\t\t\t\t$elm.data(ent, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('drop', '.native-droppable', function(e){\n\t\t\t\t\t\tif (e.originalEvent && e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar $elm = $(e.currentTarget),\n\t\t\t\t\t\t\t\tid;\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t$elm.removeClass(clDropActive);\n\t\t\t\t\t\t\tif (e.currentTarget.id) {\n\t\t\t\t\t\t\t\tid = $elm.hasClass(navdir)? self.navId2Hash(e.currentTarget.id) : self.cwdId2Hash(e.currentTarget.id);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tid = self.cwd().hash;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\te.originalEvent._target = id;\n\t\t\t\t\t\t\tself.exec('upload', {dropEvt: e.originalEvent, target: id}, void 0, id);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})();\n\t\t\t}\n\n\t\t\t// trigger event cssloaded if cssAutoLoad disabled\n\t\t\tif (self.cssloaded === false) {\n\t\t\t\tself.cssloaded = true;\n\t\t\t\tself.trigger('cssloaded');\n\t\t\t}\n\n\t\t\t// calculate elFinder node z-index\n\t\t\tself.zIndexCalc();\n\n\t\t\t// send initial request and start to pray >_<\n\t\t\tself.trigger('init')\n\t\t\t\t.request({\n\t\t\t\t\tdata        : {cmd : 'open', target : self.startDir(), init : 1, tree : 1}, \n\t\t\t\t\tpreventDone : true,\n\t\t\t\t\tnotify      : {type : 'open', cnt : 1, hideCnt : true},\n\t\t\t\t\tfreeze      : true\n\t\t\t\t})\n\t\t\t\t.fail(function() {\n\t\t\t\t\tself.trigger('fail').disable().lastDir('');\n\t\t\t\t\tlisteners = {};\n\t\t\t\t\tshortcuts = {};\n\t\t\t\t\t$(document).add(node).off('.'+namespace);\n\t\t\t\t\tself.trigger = function() { };\n\t\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tvar trashDisable = function(th) {\n\t\t\t\t\t\t\tvar src = self.file(self.trashes[th]),\n\t\t\t\t\t\t\t\td = self.options.debug,\n\t\t\t\t\t\t\t\terror;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (src && src.volumeid) {\n\t\t\t\t\t\t\t\tdelete self.volOptions[src.volumeid].trashHash;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.trashes[th] = false;\n\t\t\t\t\t\t\tself.debug('backend-error', 'Trash hash \"'+th+'\" was not found or not writable.');\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoChkTh = {};\n\t\t\t\t\t\n\t\t\t\t\t// regist rawStringDecoder\n\t\t\t\t\tif (self.options.rawStringDecoder) {\n\t\t\t\t\t\tself.registRawStringDecoder(self.options.rawStringDecoder);\n\t\t\t\t\t}\n\n\t\t\t\t\t// re-calculate elFinder node z-index\n\t\t\t\t\tself.zIndexCalc();\n\t\t\t\t\t\n\t\t\t\t\tself.load().debug('api', self.api);\n\t\t\t\t\t// update ui's size after init\n\t\t\t\t\tnode.trigger('resize');\n\t\t\t\t\t// initial open\n\t\t\t\t\topen(data);\n\t\t\t\t\tself.trigger('open', data, false);\n\t\t\t\t\tself.trigger('opendone');\n\t\t\t\t\t\n\t\t\t\t\tif (inFrame && self.options.enableAlways) {\n\t\t\t\t\t\t$(window).trigger('focus');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// check self.trashes\n\t\t\t\t\t$.each(self.trashes, function(th) {\n\t\t\t\t\t\tvar dir = self.file(th),\n\t\t\t\t\t\t\tsrc;\n\t\t\t\t\t\tif (! dir) {\n\t\t\t\t\t\t\ttoChkTh[th] = true;\n\t\t\t\t\t\t} else if (dir.mime !== 'directory' || ! dir.write) {\n\t\t\t\t\t\t\ttrashDisable(th);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (Object.keys(toChkTh).length) {\n\t\t\t\t\t\tself.request({\n\t\t\t\t\t\t\tdata : {cmd : 'info', targets : Object.keys(toChkTh)},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\tif (data && data.files) {\n\t\t\t\t\t\t\t\t$.each(data.files, function(i, dir) {\n\t\t\t\t\t\t\t\t\tif (dir.mime === 'directory' && dir.write) {\n\t\t\t\t\t\t\t\t\t\tdelete toChkTh[dir.hash];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t$.each(toChkTh, trashDisable);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t// to enable / disable\n\t\t\t\t\tself[self.options.enableAlways? 'enable' : 'disable']();\n\t\t\t\t});\n\t\t\t\n\t\t\t// self.timeEnd('load');\n\t\t\t// End of bootUp()\n\t\t};\n\t\t\n\t\t// call bootCallback function with elFinder instance, extraObject - { dfrdsBeforeBootup: dfrdsBeforeBootup }\n\t\tif (bootCallback && typeof bootCallback === 'function') {\n\t\t\tself.bootCallback = bootCallback;\n\t\t\tbootCallback.call(node.get(0), self, { dfrdsBeforeBootup: dfrdsBeforeBootup });\n\t\t}\n\t\t\n\t\t// call dfrdsBeforeBootup functions then boot up elFinder\n\t\t$.when.apply(null, dfrdsBeforeBootup).done(function() {\n\t\t\tbootUp();\n\t\t}).fail(function(error) {\n\t\t\tself.error(error);\n\t\t});\n\t};\n\n\t//register elFinder to global scope\n\tif (typeof toGlobal === 'undefined' || toGlobal) {\n\t\twindow.elFinder = elFinder;\n\t}\n\n\t/**\n\t * Prototype\n\t * \n\t * @type  Object\n\t */\n\telFinder.prototype = {\n\t\t\n\t\tuniqueid : 0,\n\t\t\n\t\tres : function(type, id) {\n\t\t\treturn this.resources[type] && this.resources[type][id];\n\t\t}, \n\n\t\t/**\n\t\t * User os. Required to bind native shortcuts for open/rename\n\t\t *\n\t\t * @type String\n\t\t **/\n\t\tOS : navigator.userAgent.indexOf('Mac') !== -1 ? 'mac' : navigator.userAgent.indexOf('Win') !== -1  ? 'win' : 'other',\n\t\t\n\t\t/**\n\t\t * User browser UA.\n\t\t * jQuery.browser: version deprecated: 1.3, removed: 1.9\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tUA : (function(){\n\t\t\tvar self = this,\n\t\t\t\twebkit = !document.unqueID && !window.opera && !window.sidebar && 'localStorage' in window && 'WebkitAppearance' in document.documentElement.style,\n\t\t\t\tchrome = webkit && window.chrome,\n\t\t\t\t/*setRotated = function() {\n\t\t\t\t\tvar a = ((screen && screen.orientation && screen.orientation.angle) || window.orientation || 0) + 0;\n\t\t\t\t\tif (a === -90) {\n\t\t\t\t\t\ta = 270;\n\t\t\t\t\t}\n\t\t\t\t\tUA.Angle = a;\n\t\t\t\t\tUA.Rotated = a % 180 === 0? false : true;\n\t\t\t\t},*/\n\t\t\t\tUA = {\n\t\t\t\t\t// Browser IE <= IE 6\n\t\t\t\t\tltIE6   : typeof window.addEventListener == \"undefined\" && typeof document.documentElement.style.maxHeight == \"undefined\",\n\t\t\t\t\t// Browser IE <= IE 7\n\t\t\t\t\tltIE7   : typeof window.addEventListener == \"undefined\" && typeof document.querySelectorAll == \"undefined\",\n\t\t\t\t\t// Browser IE <= IE 8\n\t\t\t\t\tltIE8   : typeof window.addEventListener == \"undefined\" && typeof document.getElementsByClassName == \"undefined\",\n\t\t\t\t\t// Browser IE <= IE 9\n\t\t\t\t\tltIE9  : document.uniqueID && document.documentMode <= 9,\n\t\t\t\t\t// Browser IE <= IE 10\n\t\t\t\t\tltIE10  : document.uniqueID && document.documentMode <= 10,\n\t\t\t\t\t// Browser IE >= IE 11\n\t\t\t\t\tgtIE11  : document.uniqueID && document.documentMode >= 11,\n\t\t\t\t\tIE      : document.uniqueID,\n\t\t\t\t\tFirefox : window.sidebar,\n\t\t\t\t\tOpera   : window.opera,\n\t\t\t\t\tWebkit  : webkit,\n\t\t\t\t\tChrome  : chrome,\n\t\t\t\t\tEdge    : (chrome && window.msCredentials)? true : false,\n\t\t\t\t\tSafari  : webkit && !window.chrome,\n\t\t\t\t\tMobile  : typeof window.orientation != \"undefined\",\n\t\t\t\t\tTouch   : typeof window.ontouchstart != \"undefined\",\n\t\t\t\t\tiOS     : navigator.platform.match(/^iP(?:[ao]d|hone)/),\n\t\t\t\t\tMac     : navigator.platform.match(/^Mac/),\n\t\t\t\t\tFullscreen : (typeof (document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen) !== 'undefined'),\n\t\t\t\t\tAngle   : 0,\n\t\t\t\t\tRotated : false,\n\t\t\t\t\tCSS : (function() {\n\t\t\t\t\t\tvar aStyle = document.createElement('a').style,\n\t\t\t\t\t\t\tpStyle = document.createElement('p').style,\n\t\t\t\t\t\t\tcss;\n\t\t\t\t\t\tcss = 'position:sticky;position:-webkit-sticky;';\n\t\t\t\t\t\tcss += 'width:-webkit-max-content;width:-moz-max-content;width:-ms-max-content;width:max-content;';\n\t\t\t\t\t\taStyle.cssText = css;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tpositionSticky : aStyle.position.indexOf('sticky')!==-1,\n\t\t\t\t\t\t\twidthMaxContent : aStyle.width.indexOf('max-content')!==-1,\n\t\t\t\t\t\t\tflex : typeof pStyle.flex !== 'undefined'\n\t\t\t\t\t\t};\n\t\t\t\t\t})()\n\t\t\t\t};\n\t\t\t\treturn UA;\n\t\t})(),\n\t\t\n\t\t/**\n\t\t * Is cookie enabled\n\t\t * \n\t\t * @type Boolean\n\t\t */\n\t\tcookieEnabled : (function() {\n\t\t\tvar res = false,\n\t\t\t\ttest = 'elftest=';\n\t\t\tdocument.cookie = test + '1';\n\t\t\tres = document.cookie.split(test).length === 2;\n\t\t\tdocument.cookie = test + ';max-age=0';\n\t\t\treturn res;\n\t\t})(),\n\n\t\t/**\n\t\t * Has RequireJS?\n\t\t * \n\t\t * @type Boolean\n\t\t */\n\t\thasRequire : (typeof define === 'function' && define.amd),\n\t\t\n\t\t/**\n\t\t * Current request command\n\t\t * \n\t\t * @type  String\n\t\t */\n\t\tcurrentReqCmd : '',\n\t\t\n\t\t/**\n\t\t * Current keyboard state\n\t\t * \n\t\t * @type  Object\n\t\t */\n\t\tkeyState : {},\n\t\t\n\t\t/**\n\t\t * Internationalization object\n\t\t * \n\t\t * @type  Object\n\t\t */\n\t\ti18 : {\n\t\t\ten : {\n\t\t\t\ttranslator      : '',\n\t\t\t\tlanguage        : 'English',\n\t\t\t\tdirection       : 'ltr',\n\t\t\t\tdateFormat      : 'd.m.Y H:i',\n\t\t\t\tfancyDateFormat : '$1 H:i',\n\t\t\t\tnonameDateFormat : 'ymd-His',\n\t\t\t\tmessages        : {}\n\t\t\t},\n\t\t\tmonths : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n\t\t\tmonthsShort : ['msJan', 'msFeb', 'msMar', 'msApr', 'msMay', 'msJun', 'msJul', 'msAug', 'msSep', 'msOct', 'msNov', 'msDec'],\n\n\t\t\tdays : ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n\t\t\tdaysShort : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\n\t\t},\n\t\t\n\t\t/**\n\t\t * File mimetype to kind mapping\n\t\t * \n\t\t * @type  Object\n\t\t */\n\t\tkinds : \t{\n\t\t\t\t'unknown'                       : 'Unknown',\n\t\t\t\t'directory'                     : 'Folder',\n\t\t\t\t'group'                         : 'Selects',\n\t\t\t\t'symlink'                       : 'Alias',\n\t\t\t\t'symlink-broken'                : 'AliasBroken',\n\t\t\t\t'application/x-empty'           : 'TextPlain',\n\t\t\t\t'application/postscript'        : 'Postscript',\n\t\t\t\t'application/vnd.ms-office'     : 'MsOffice',\n\t\t\t\t'application/msword'            : 'MsWord',\n\t\t\t\t'application/vnd.ms-word'       : 'MsWord',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document' : 'MsWord',\n\t\t\t\t'application/vnd.ms-word.document.macroEnabled.12'                        : 'MsWord',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.template' : 'MsWord',\n\t\t\t\t'application/vnd.ms-word.template.macroEnabled.12'                        : 'MsWord',\n\t\t\t\t'application/vnd.ms-excel'      : 'MsExcel',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'       : 'MsExcel',\n\t\t\t\t'application/vnd.ms-excel.sheet.macroEnabled.12'                          : 'MsExcel',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.template'    : 'MsExcel',\n\t\t\t\t'application/vnd.ms-excel.template.macroEnabled.12'                       : 'MsExcel',\n\t\t\t\t'application/vnd.ms-excel.sheet.binary.macroEnabled.12'                   : 'MsExcel',\n\t\t\t\t'application/vnd.ms-excel.addin.macroEnabled.12'                          : 'MsExcel',\n\t\t\t\t'application/vnd.ms-powerpoint' : 'MsPP',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.presentation' : 'MsPP',\n\t\t\t\t'application/vnd.ms-powerpoint.presentation.macroEnabled.12'              : 'MsPP',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.slideshow'  : 'MsPP',\n\t\t\t\t'application/vnd.ms-powerpoint.slideshow.macroEnabled.12'                 : 'MsPP',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.template'   : 'MsPP',\n\t\t\t\t'application/vnd.ms-powerpoint.template.macroEnabled.12'                  : 'MsPP',\n\t\t\t\t'application/vnd.ms-powerpoint.addin.macroEnabled.12'                     : 'MsPP',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.slide'      : 'MsPP',\n\t\t\t\t'application/vnd.ms-powerpoint.slide.macroEnabled.12'                     : 'MsPP',\n\t\t\t\t'application/pdf'               : 'PDF',\n\t\t\t\t'application/xml'               : 'XML',\n\t\t\t\t'application/vnd.oasis.opendocument.text' : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.text-template'         : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.text-web'              : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.text-master'           : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.graphics'              : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.graphics-template'     : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.presentation'          : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.presentation-template' : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.spreadsheet'           : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.spreadsheet-template'  : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.chart'                 : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.formula'               : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.database'              : 'OO',\n\t\t\t\t'application/vnd.oasis.opendocument.image'                 : 'OO',\n\t\t\t\t'application/vnd.openofficeorg.extension'                  : 'OO',\n\t\t\t\t'application/x-shockwave-flash' : 'AppFlash',\n\t\t\t\t'application/flash-video'       : 'Flash video',\n\t\t\t\t'application/x-bittorrent'      : 'Torrent',\n\t\t\t\t'application/javascript'        : 'JS',\n\t\t\t\t'application/rtf'               : 'RTF',\n\t\t\t\t'application/rtfd'              : 'RTF',\n\t\t\t\t'application/x-font-ttf'        : 'TTF',\n\t\t\t\t'application/x-font-otf'        : 'OTF',\n\t\t\t\t'application/x-rpm'             : 'RPM',\n\t\t\t\t'application/x-web-config'      : 'TextPlain',\n\t\t\t\t'application/xhtml+xml'         : 'HTML',\n\t\t\t\t'application/docbook+xml'       : 'DOCBOOK',\n\t\t\t\t'application/x-awk'             : 'AWK',\n\t\t\t\t'application/x-gzip'            : 'GZIP',\n\t\t\t\t'application/x-bzip2'           : 'BZIP',\n\t\t\t\t'application/x-xz'              : 'XZ',\n\t\t\t\t'application/zip'               : 'ZIP',\n\t\t\t\t'application/x-zip'               : 'ZIP',\n\t\t\t\t'application/x-rar'             : 'RAR',\n\t\t\t\t'application/x-tar'             : 'TAR',\n\t\t\t\t'application/x-7z-compressed'   : '7z',\n\t\t\t\t'application/x-jar'             : 'JAR',\n\t\t\t\t'text/plain'                    : 'TextPlain',\n\t\t\t\t'text/x-php'                    : 'PHP',\n\t\t\t\t'text/html'                     : 'HTML',\n\t\t\t\t'text/javascript'               : 'JS',\n\t\t\t\t'text/css'                      : 'CSS',\n\t\t\t\t'text/rtf'                      : 'RTF',\n\t\t\t\t'text/rtfd'                     : 'RTF',\n\t\t\t\t'text/x-c'                      : 'C',\n\t\t\t\t'text/x-csrc'                   : 'C',\n\t\t\t\t'text/x-chdr'                   : 'CHeader',\n\t\t\t\t'text/x-c++'                    : 'CPP',\n\t\t\t\t'text/x-c++src'                 : 'CPP',\n\t\t\t\t'text/x-c++hdr'                 : 'CPPHeader',\n\t\t\t\t'text/x-shellscript'            : 'Shell',\n\t\t\t\t'application/x-csh'             : 'Shell',\n\t\t\t\t'text/x-python'                 : 'Python',\n\t\t\t\t'text/x-java'                   : 'Java',\n\t\t\t\t'text/x-java-source'            : 'Java',\n\t\t\t\t'text/x-ruby'                   : 'Ruby',\n\t\t\t\t'text/x-perl'                   : 'Perl',\n\t\t\t\t'text/x-sql'                    : 'SQL',\n\t\t\t\t'text/xml'                      : 'XML',\n\t\t\t\t'text/x-comma-separated-values' : 'CSV',\n\t\t\t\t'text/x-markdown'               : 'Markdown',\n\t\t\t\t'image/x-ms-bmp'                : 'BMP',\n\t\t\t\t'image/jpeg'                    : 'JPEG',\n\t\t\t\t'image/gif'                     : 'GIF',\n\t\t\t\t'image/png'                     : 'PNG',\n\t\t\t\t'image/tiff'                    : 'TIFF',\n\t\t\t\t'image/x-targa'                 : 'TGA',\n\t\t\t\t'image/vnd.adobe.photoshop'     : 'PSD',\n\t\t\t\t'image/xbm'                     : 'XBITMAP',\n\t\t\t\t'image/pxm'                     : 'PXM',\n\t\t\t\t'audio/mpeg'                    : 'AudioMPEG',\n\t\t\t\t'audio/midi'                    : 'AudioMIDI',\n\t\t\t\t'audio/ogg'                     : 'AudioOGG',\n\t\t\t\t'audio/mp4'                     : 'AudioMPEG4',\n\t\t\t\t'audio/x-m4a'                   : 'AudioMPEG4',\n\t\t\t\t'audio/wav'                     : 'AudioWAV',\n\t\t\t\t'audio/x-mp3-playlist'          : 'AudioPlaylist',\n\t\t\t\t'video/x-dv'                    : 'VideoDV',\n\t\t\t\t'video/mp4'                     : 'VideoMPEG4',\n\t\t\t\t'video/mpeg'                    : 'VideoMPEG',\n\t\t\t\t'video/x-msvideo'               : 'VideoAVI',\n\t\t\t\t'video/quicktime'               : 'VideoMOV',\n\t\t\t\t'video/x-ms-wmv'                : 'VideoWM',\n\t\t\t\t'video/x-flv'                   : 'VideoFlash',\n\t\t\t\t'video/x-matroska'              : 'VideoMKV',\n\t\t\t\t'video/ogg'                     : 'VideoOGG'\n\t\t\t},\n\t\t\n\t\t/**\n\t\t * File mimetype to file extention mapping\n\t\t * \n\t\t * @type  Object\n\t\t * @see   elFinder.mimetypes.js\n\t\t */\n\t\tmimeTypes : {},\n\t\t\n\t\t/**\n\t\t * Ajax request data validation rules\n\t\t * \n\t\t * @type  Object\n\t\t */\n\t\trules : {\n\t\t\tdefaults : function(data) {\n\t\t\t\tif (!data\n\t\t\t\t|| (data.added && !Array.isArray(data.added))\n\t\t\t\t||  (data.removed && !Array.isArray(data.removed))\n\t\t\t\t||  (data.changed && !Array.isArray(data.changed))) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\topen    : function(data) { return data && data.cwd && data.files && $.isPlainObject(data.cwd) && Array.isArray(data.files); },\n\t\t\ttree    : function(data) { return data && data.tree && Array.isArray(data.tree); },\n\t\t\tparents : function(data) { return data && data.tree && Array.isArray(data.tree); },\n\t\t\ttmb     : function(data) { return data && data.images && ($.isPlainObject(data.images) || Array.isArray(data.images)); },\n\t\t\tupload  : function(data) { return data && ($.isPlainObject(data.added) || Array.isArray(data.added));},\n\t\t\tsearch  : function(data) { return data && data.files && Array.isArray(data.files); }\n\t\t},\n\t\t\n\t\t/**\n\t\t * Commands costructors\n\t\t *\n\t\t * @type Object\n\t\t */\n\t\tcommands : {},\n\t\t\n\t\t/**\n\t\t * Commands to add the item (space delimited)\n\t\t * \n\t\t * @type String\n\t\t */\n\t\tcmdsToAdd : 'archive duplicate extract mkdir mkfile paste rm upload',\n\t\t\n\t\tparseUploadData : function(text) {\n\t\t\tvar self = this,\n\t\t\t\tdata;\n\t\t\t\n\t\t\tif (!$.trim(text)) {\n\t\t\t\treturn {error : ['errResponse', 'errDataEmpty']};\n\t\t\t}\n\t\t\t\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(text);\n\t\t\t} catch (e) {\n\t\t\t\treturn {error : ['errResponse', 'errDataNotJSON']};\n\t\t\t}\n\t\t\t\n\t\t\tdata = self.normalize(data);\n\t\t\tif (!self.validResponse('upload', data)) {\n\t\t\t\treturn {error : (data.norError || ['errResponse'])};\n\t\t\t}\n\t\t\tdata.removed = $.merge((data.removed || []), $.map(data.added || [], function(f) { return self.file(f.hash)? f.hash : null; }));\n\t\t\treturn data;\n\t\t\t\n\t\t},\n\t\t\n\t\tiframeCnt : 0,\n\t\t\n\t\tuploads : {\n\t\t\t// xhr muiti uploading flag\n\t\t\txhrUploading: false,\n\t\t\t\n\t\t\t// Timer of request fail to sync\n\t\t\tfailSyncTm: null,\n\t\t\t\n\t\t\t// current chunkfail requesting chunk\n\t\t\tchunkfailReq: {},\n\t\t\t\n\t\t\t// check file/dir exists\n\t\t\tcheckExists: function(files, target, fm, isDir) {\n\t\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\t\tnames, renames = [], hashes = {}, chkFiles = [],\n\t\t\t\t\tcancel = function() {\n\t\t\t\t\t\tvar i = files.length;\n\t\t\t\t\t\twhile (--i > -1) {\n\t\t\t\t\t\t\tfiles[i]._remove = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tresolve = function() {\n\t\t\t\t\t\tdfrd.resolve(renames, hashes);\n\t\t\t\t\t},\n\t\t\t\t\tcheck = function() {\n\t\t\t\t\t\tvar existed = [], exists = [], i, c,\n\t\t\t\t\t\t\tpathStr = target !== fm.cwd().hash? fm.path(target, true) + fm.option('separator', target) : '',\n\t\t\t\t\t\t\tconfirm = function(ndx) {\n\t\t\t\t\t\t\t\tvar last = ndx == exists.length-1,\n\t\t\t\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\t\t\t\tcssClass : 'elfinder-confirm-upload',\n\t\t\t\t\t\t\t\t\t\ttitle  : fm.i18n('cmdupload'),\n\t\t\t\t\t\t\t\t\t\ttext   : ['errExists', pathStr + exists[ndx].name, 'confirmRepl'], \n\t\t\t\t\t\t\t\t\t\tall    : !last,\n\t\t\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnYes',\n\t\t\t\t\t\t\t\t\t\t\tcallback : function(all) {\n\t\t\t\t\t\t\t\t\t\t\t\t!last && !all\n\t\t\t\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: resolve();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\treject : {\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnNo',\n\t\t\t\t\t\t\t\t\t\t\tcallback : function(all) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar i;\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\tif (all) {\n\t\t\t\t\t\t\t\t\t\t\t\t\ti = exists.length;\n\t\t\t\t\t\t\t\t\t\t\t\t\twhile (ndx < i--) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles[exists[i].i]._remove = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles[exists[ndx].i]._remove = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t!last && !all\n\t\t\t\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: resolve();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tbuttons : [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tlabel : 'btnBackup',\n\t\t\t\t\t\t\t\t\t\t\t\tcssClass : 'elfinder-confirm-btn-backup',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function(all) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar i;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (all) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti = exists.length;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhile (ndx < i--) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trenames.push(exists[i].name);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trenames.push(exists[ndx].name);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t!last && !all\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: resolve();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (!isDir) {\n\t\t\t\t\t\t\t\t\topts.buttons.push({\n\t\t\t\t\t\t\t\t\t\tlabel : 'btnRename' + (last? '' : 'All'),\n\t\t\t\t\t\t\t\t\t\tcssClass : 'elfinder-confirm-btn-rename',\n\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\trenames = null;\n\t\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (fm.iframeCnt > 0) {\n\t\t\t\t\t\t\t\t\tdelete opts.reject;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.confirm(opts);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (! fm.file(target).read) {\n\t\t\t\t\t\t\t// for dropbox type\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tnames = $.map(files, function(file, i) { return file.name && (!fm.UA.iOS || file.name !== 'image.jpg')? {i: i, name: file.name} : null ;});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'ls', target : target, intersect : $.map(names, function(item) { return item.name;})},\n\t\t\t\t\t\t\tnotify : {type : 'preupload', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar existedArr, cwdItems;\n\t\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\t\tif (data.error) {\n\t\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (fm.options.overwriteUploadConfirm && fm.option('uploadOverwrite', target)) {\n\t\t\t\t\t\t\t\t\t\tif (data.list) {\n\t\t\t\t\t\t\t\t\t\t\tif (Array.isArray(data.list)) {\n\t\t\t\t\t\t\t\t\t\t\t\texisted = data.list || [];\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\texistedArr = [];\n\t\t\t\t\t\t\t\t\t\t\t\texisted = $.map(data.list, function(n) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof n === 'string') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn n;\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// support to >=2.1.11 plugin Normalizer, Sanitizer\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texistedArr = existedArr.concat(n);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\tif (existedArr.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\texisted = existed.concat(existedArr);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\thashes = data.list;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\texists = $.grep(names, function(name){\n\t\t\t\t\t\t\t\t\t\t\t\treturn $.inArray(name.name, existed) !== -1 ? true : false ;\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tif (exists.length && existed.length && target == fm.cwd().hash) {\n\t\t\t\t\t\t\t\t\t\t\t\tcwdItems = $.map(fm.files(target), function(file) { return file.name; } );\n\t\t\t\t\t\t\t\t\t\t\t\tif ($.grep(existed, function(n) { \n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $.inArray(n, cwdItems) === -1? true : false;\n\t\t\t\t\t\t\t\t\t\t\t\t}).length){\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.sync();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (exists.length > 0) {\n\t\t\t\t\t\t\t\tconfirm(0);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\tif (fm.api >= 2.1 && typeof files[0] == 'object') {\n\t\t\t\t\tcheck();\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\t\n\t\t\t// check droped contents\n\t\t\tcheckFile : function(data, fm, target) {\n\t\t\t\tif (!!data.checked || data.type == 'files') {\n\t\t\t\t\treturn data.files;\n\t\t\t\t} else if (data.type == 'data') {\n\t\t\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\t\tscanDfd = $.Deferred(),\n\t\t\t\t\tfiles = [],\n\t\t\t\t\tpaths = [],\n\t\t\t\t\tdirctorys = [],\n\t\t\t\t\tprocessing = 0,\n\t\t\t\t\titems,\n\t\t\t\t\tmkdirs = [],\n\t\t\t\t\tcancel = false,\n\t\t\t\t\ttoArray = function(list) {\n\t\t\t\t\t\treturn Array.prototype.slice.call(list || [], 0);\n\t\t\t\t\t},\n\t\t\t\t\tdoScan = function(items) {\n\t\t\t\t\t\tvar entry, readEntries,\n\t\t\t\t\t\t\texcludes = fm.options.folderUploadExclude[fm.OS] || null,\n\t\t\t\t\t\t\tlength = items.length,\n\t\t\t\t\t\t\tcheck = function() {\n\t\t\t\t\t\t\t\tif (--processing < 1 && scanDfd.state() === 'pending') {\n\t\t\t\t\t\t\t\t\tscanDfd.resolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpushItem = function(file) {\n\t\t\t\t\t\t\t\tif (! excludes || ! file.name.match(excludes)) {\n\t\t\t\t\t\t\t\t\tpaths.push(entry.fullPath || '');\n\t\t\t\t\t\t\t\t\tfiles.push(file);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcheck();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treadEntries = function(dirReader) {\n\t\t\t\t\t\t\t\tvar entries = [],\n\t\t\t\t\t\t\t\t\tread = function() {\n\t\t\t\t\t\t\t\t\t\tdirReader.readEntries(function(results) {\n\t\t\t\t\t\t\t\t\t\t\tif (cancel || !results.length) {\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < entries.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (cancel) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscanDfd.reject();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdoScan([entries[i]]);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tcheck();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tentries = entries.concat(toArray(results));\n\t\t\t\t\t\t\t\t\t\t\t\tread();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}, check);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tread();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tprocessing++;\n\t\t\t\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\t\t\t\tif (cancel) {\n\t\t\t\t\t\t\t\tscanDfd.reject();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tentry = items[i];\n\t\t\t\t\t\t\tif (entry) {\n\t\t\t\t\t\t\t\tif (entry.isFile) {\n\t\t\t\t\t\t\t\t\tprocessing++;\n\t\t\t\t\t\t\t\t\tentry.file(pushItem, check);\n\t\t\t\t\t\t\t\t} else if (entry.isDirectory) {\n\t\t\t\t\t\t\t\t\tif (fm.api >= 2.1) {\n\t\t\t\t\t\t\t\t\t\tprocessing++;\n\t\t\t\t\t\t\t\t\t\tmkdirs.push(entry.fullPath);\n\t\t\t\t\t\t\t\t\t\treadEntries(entry.createReader()); // Start reading dirs.\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcheck();\n\t\t\t\t\t\treturn scanDfd;\n\t\t\t\t\t}, hasDirs;\n\t\t\t\t\t\n\t\t\t\t\titems = $.map(data.files.items, function(item){\n\t\t\t\t\t\treturn item.getAsEntry? item.getAsEntry() : item.webkitGetAsEntry();\n\t\t\t\t\t});\n\t\t\t\t\t$.each(items, function(i, item) {\n\t\t\t\t\t\tif (item.isDirectory) {\n\t\t\t\t\t\t\thasDirs = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (items.length > 0) {\n\t\t\t\t\t\tfm.uploads.checkExists(items, target, fm, hasDirs).done(function(renames, hashes){\n\t\t\t\t\t\t\tvar dfds = [];\n\t\t\t\t\t\t\tif (fm.options.overwriteUploadConfirm && fm.option('uploadOverwrite', target)) {\n\t\t\t\t\t\t\t\tif (renames === null) {\n\t\t\t\t\t\t\t\t\tdata.overwrite = 0;\n\t\t\t\t\t\t\t\t\trenames = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\titems = $.grep(items, function(item){\n\t\t\t\t\t\t\t\t\tvar i, bak, hash, dfd, hi;\n\t\t\t\t\t\t\t\t\tif (item.isDirectory && renames.length) {\n\t\t\t\t\t\t\t\t\t\ti = $.inArray(item.name, renames);\n\t\t\t\t\t\t\t\t\t\tif (i !== -1) {\n\t\t\t\t\t\t\t\t\t\t\trenames.splice(i, 1);\n\t\t\t\t\t\t\t\t\t\t\tbak = fm.uniqueName(item.name + fm.options.backupSuffix , null, '');\n\t\t\t\t\t\t\t\t\t\t\t$.each(hashes, function(h, name) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (item.name == name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\thash = h;\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tif (! hash) {\n\t\t\t\t\t\t\t\t\t\t\t\thash = fm.fileByName(item.name, target).hash;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tfm.lockfiles({files : [hash]});\n\t\t\t\t\t\t\t\t\t\t\tdfd = fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'rename', target : hash, name : bak},\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'rename', cnt : 1}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\t\t\t\titem._remove = true;\n\t\t\t\t\t\t\t\t\t\t\t\tfm.sync();\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : [hash]});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tdfds.push(dfd);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn !item._remove? true : false;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$.when.apply($, dfds).done(function(){\n\t\t\t\t\t\t\t\tvar notifyto, msg,\n\t\t\t\t\t\t\t\t\tid = +new Date();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (items.length > 0) {\n\t\t\t\t\t\t\t\t\tmsg = fm.escape(items[0].name);\n\t\t\t\t\t\t\t\t\tif (items.length > 1) {\n\t\t\t\t\t\t\t\t\t\tmsg += ' ... ' + items.length + fm.i18n('items');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tnotifyto = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\t\t\ttype : 'readdir',\n\t\t\t\t\t\t\t\t\t\t\tid : id,\n\t\t\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\t\t\thideCnt: true,\n\t\t\t\t\t\t\t\t\t\t\tmsg : fm.i18n('ntfreaddir') + ' (' + msg + ')',\n\t\t\t\t\t\t\t\t\t\t\tcancel: function() {\n\t\t\t\t\t\t\t\t\t\t\t\tcancel = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}, fm.options.notifyDelay);\n\t\t\t\t\t\t\t\t\tdoScan(items).done(function() {\n\t\t\t\t\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\n\t\t\t\t\t\t\t\t\t\tfm.notify({type : 'readdir', id: id, cnt : -1});\n\t\t\t\t\t\t\t\t\t\tif (cancel) {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve([files, paths, renames, hashes, mkdirs]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn dfrd.promise();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar ret = [];\n\t\t\t\t\tvar check = [];\n\t\t\t\t\tvar str = data.files[0];\n\t\t\t\t\tif (data.type == 'html') {\n\t\t\t\t\t\tvar tmp = $(\"<html/>\").append($.parseHTML(str.replace(/ src=/ig, ' _elfsrc='))),\n\t\t\t\t\t\t\tatag;\n\t\t\t\t\t\t$('img[_elfsrc]', tmp).each(function(){\n\t\t\t\t\t\t\tvar url, purl,\n\t\t\t\t\t\t\tself = $(this),\n\t\t\t\t\t\t\tpa = self.closest('a');\n\t\t\t\t\t\t\tif (pa && pa.attr('href') && pa.attr('href').match(/\\.(?:jpe?g|gif|bmp|png)/i)) {\n\t\t\t\t\t\t\t\tpurl = pa.attr('href');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\turl = self.attr('_elfsrc');\n\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\tif (purl) {\n\t\t\t\t\t\t\t\t\t$.inArray(purl, ret) == -1 && ret.push(purl);\n\t\t\t\t\t\t\t\t\t$.inArray(url, check) == -1 &&  check.push(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$.inArray(url, ret) == -1 && ret.push(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Probably it's clipboard data\n\t\t\t\t\t\t\tif (ret.length === 1 && ret[0].match(/^data:image\\/png/)) {\n\t\t\t\t\t\t\t\tdata.clipdata = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tatag = $('a[href]', tmp);\n\t\t\t\t\t\tatag.each(function(){\n\t\t\t\t\t\t\tvar text, loc,\n\t\t\t\t\t\t\t\tparseUrl = function(url) {\n\t\t\t\t\t\t\t\t\tvar a = document.createElement('a');\n\t\t\t\t\t\t\t\t\ta.href = url;\n\t\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (text = $(this).text()) {\n\t\t\t\t\t\t\t\tloc = parseUrl($(this).attr('href'));\n\t\t\t\t\t\t\t\tif (loc.href && loc.href.match(/^(?:ht|f)tp/i) && (atag.length === 1 || ! loc.pathname.match(/(?:\\.html?|\\/[^\\/.]*)$/i) || $.trim(text).match(/\\.[a-z0-9-]{1,10}$/i))) {\n\t\t\t\t\t\t\t\t\tif ($.inArray(loc.href, ret) == -1 && $.inArray(loc.href, check) == -1) ret.push(loc.href);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar regex, m, url;\n\t\t\t\t\t\tregex = /((?:ht|f)tps?:\\/\\/[-_.!~*\\'()a-z0-9;/?:\\@&=+\\$,%#\\*\\[\\]]+)/ig;\n\t\t\t\t\t\twhile (m = regex.exec(str)) {\n\t\t\t\t\t\t\turl = m[1].replace(/&amp;/g, '&');\n\t\t\t\t\t\t\tif ($.inArray(url, ret) == -1) ret.push(url);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// upload transport using XMLHttpRequest\n\t\t\txhr : function(data, fm) { \n\t\t\t\tvar self   = fm ? fm : this,\n\t\t\t\t\tnode        = self.getUI(),\n\t\t\t\t\txhr         = new XMLHttpRequest(),\n\t\t\t\t\tnotifyto    = null,\n\t\t\t\t\tnotifyto1   = null,\n\t\t\t\t\tnotifyto2   = null,\n\t\t\t\t\tdataChecked = data.checked,\n\t\t\t\t\tisDataType  = (data.isDataType || data.type == 'data'),\n\t\t\t\t\ttarget      = (data.target || self.cwd().hash),\n\t\t\t\t\tdropEvt     = (data.dropEvt || null),\n\t\t\t\t\textraData   = data.extraData || null,\n\t\t\t\t\tchunkEnable = (self.option('uploadMaxConn', target) != -1),\n\t\t\t\t\tmultiMax    = Math.min(5, Math.max(1, self.option('uploadMaxConn', target))),\n\t\t\t\t\tretryWait   = 10000, // 10 sec\n\t\t\t\t\tretryMax    = 30, // 10 sec * 30 = 300 secs (Max 5 mins)\n\t\t\t\t\tretry       = 0,\n\t\t\t\t\tgetFile     = function(files) {\n\t\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\t\tfile;\n\t\t\t\t\t\tif (files.promise) {\n\t\t\t\t\t\t\tfiles.always(function(f) {\n\t\t\t\t\t\t\t\tdfd.resolve(Array.isArray(f) && f.length? (isDataType? f[0][0] : f[0]) : {});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd.resolve(files.length? (isDataType? files[0][0] : files[0]) : {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t},\n\t\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t\t.fail(function(err) {\n\t\t\t\t\t\t\tvar error = self.parseError(err),\n\t\t\t\t\t\t\t\tuserAbort;\n\t\t\t\t\t\t\tif (error === 'userabort') {\n\t\t\t\t\t\t\t\tuserAbort = true;\n\t\t\t\t\t\t\t\terror = void 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (files && (self.uploads.xhrUploading || userAbort)) {\n\t\t\t\t\t\t\t\t// send request om fail\n\t\t\t\t\t\t\t\tgetFile(files).done(function(file) {\n\t\t\t\t\t\t\t\t\tif (!userAbort) {\n\t\t\t\t\t\t\t\t\t\ttriggerError(error, file);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (! file._cid) {\n\t\t\t\t\t\t\t\t\t\t// send sync request\n\t\t\t\t\t\t\t\t\t\tself.uploads.failSyncTm && clearTimeout(self.uploads.failSyncTm);\n\t\t\t\t\t\t\t\t\t\tself.uploads.failSyncTm = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tself.sync(target);\n\t\t\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t\t\t} else if (! self.uploads.chunkfailReq[file._cid]) {\n\t\t\t\t\t\t\t\t\t\t// send chunkfail request\n\t\t\t\t\t\t\t\t\t\tself.uploads.chunkfailReq[file._cid] = true;\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcmd: 'upload',\n\t\t\t\t\t\t\t\t\t\t\t\t\ttarget: target,\n\t\t\t\t\t\t\t\t\t\t\t\t\tchunk: file._chunk,\n\t\t\t\t\t\t\t\t\t\t\t\t\tcid: file._cid,\n\t\t\t\t\t\t\t\t\t\t\t\t\tupload: ['chunkfail'],\n\t\t\t\t\t\t\t\t\t\t\t\t\tmimes: 'chunkfail'\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\toptions : {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'post',\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: self.uploadURL\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault: true\n\t\t\t\t\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tdelete self.uploads.chunkfailReq[file._chunk];\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttriggerError(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t!userAbort && self.sync();\n\t\t\t\t\t\t\tself.uploads.xhrUploading = false;\n\t\t\t\t\t\t\tfiles = null;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tself.uploads.xhrUploading = false;\n\t\t\t\t\t\t\tfiles = null;\n\t\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\t\tself.currentReqCmd = 'upload';\n\t\t\t\t\t\t\t\tdata.warning && triggerError(data.warning);\n\t\t\t\t\t\t\t\tself.updateCache(data);\n\t\t\t\t\t\t\t\tdata.removed && data.removed.length && self.remove(data);\n\t\t\t\t\t\t\t\tdata.added   && data.added.length   && self.add(data);\n\t\t\t\t\t\t\t\tdata.changed && data.changed.length && self.change(data);\n\t\t\t\t\t\t\t\tself.trigger('upload', data, false);\n\t\t\t\t\t\t\t\tself.trigger('uploaddone');\n\t\t\t\t\t\t\t\tif (data.toasts && Array.isArray(data.toasts)) {\n\t\t\t\t\t\t\t\t\t$.each(data.toasts, function() {\n\t\t\t\t\t\t\t\t\t\tthis.msg && self.toast(this);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdata.sync && self.sync();\n\t\t\t\t\t\t\t\tif (data.debug) {\n\t\t\t\t\t\t\t\t\tself.responseDebug(data);\n\t\t\t\t\t\t\t\t\tfm.debug('backend-debug', data);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tself.abortXHR(xhr);\n\t\t\t\t\t\t\t// unregist fnAbort function\n\t\t\t\t\t\t\tnode.off('uploadabort', fnAbort);\n\t\t\t\t\t\t\t$(window).off('unload', fnAbort);\n\t\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\n\t\t\t\t\t\t\tnotifyto1 && clearTimeout(notifyto1);\n\t\t\t\t\t\t\tnotifyto2 && clearTimeout(notifyto2);\n\t\t\t\t\t\t\tdataChecked && !data.multiupload && checkNotify() && self.notify({type : 'upload', cnt : -cnt, progress : 0, size : 0});\n\t\t\t\t\t\t\tnotifyto1 && uploadedNtf && self.notify({type : 'chunkmerge', cnt : -cnt});\n\t\t\t\t\t\t\tchunkMerge && notifyElm.children('.elfinder-notify-chunkmerge').length && self.notify({type : 'chunkmerge', cnt : -1});\n\t\t\t\t\t\t}),\n\t\t\t\t\tformData    = new FormData(),\n\t\t\t\t\tfiles       = data.input ? data.input.files : self.uploads.checkFile(data, self, target), \n\t\t\t\t\tcnt         = data.checked? (isDataType? files[0].length : files.length) : files.length,\n\t\t\t\t\tisChunked   = false,\n\t\t\t\t\tloaded      = 0,\n\t\t\t\t\tprev        = 0,\n\t\t\t\t\tfilesize    = 0,\n\t\t\t\t\tnotify      = false,\n\t\t\t\t\tnotifyElm   = self.ui.notify,\n\t\t\t\t\tcancelBtn   = true,\n\t\t\t\t\tuploadedNtf = false,\n\t\t\t\t\tabort       = false,\n\t\t\t\t\tcheckNotify = function() {\n\t\t\t\t\t\tif (!notify && (ntfUpload = notifyElm.children('.elfinder-notify-upload')).length) {\n\t\t\t\t\t\t\tnotify = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn notify;\n\t\t\t\t\t},\n\t\t\t\t\tfnAbort     = function(e, error) {\n\t\t\t\t\t\tabort = true;\n\t\t\t\t\t\tself.abortXHR(xhr, { quiet: true, abort: true });\n\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\tif (checkNotify()) {\n\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : ntfUpload.data('cnt') * -1, progress : 0, size : 0});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcancelToggle = function(show, hasChunk) {\n\t\t\t\t\t\tntfUpload.children('.elfinder-notify-cancel')[show? 'show':'hide']();\n\t\t\t\t\t\tcancelBtn = show;\n\t\t\t\t\t},\n\t\t\t\t\tstartNotify = function(size) {\n\t\t\t\t\t\tif (!size) size = filesize;\n\t\t\t\t\t\treturn setTimeout(function() {\n\t\t\t\t\t\t\tnotify = true;\n\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : cnt, progress : loaded - prev, size : size,\n\t\t\t\t\t\t\t\tcancel: function() {\n\t\t\t\t\t\t\t\t\tnode.trigger('uploadabort', 'userabort');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tntfUpload = notifyElm.children('.elfinder-notify-upload');\n\t\t\t\t\t\t\tprev = loaded;\n\t\t\t\t\t\t\tif (data.multiupload) {\n\t\t\t\t\t\t\t\tcancelBtn && cancelToggle(true);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcancelToggle(cancelBtn && loaded < size);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, self.options.notifyDelay);\n\t\t\t\t\t},\n\t\t\t\t\tdoRetry = function() {\n\t\t\t\t\t\tif (retry++ <= retryMax) {\n\t\t\t\t\t\t\tif (checkNotify() && prev) {\n\t\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : 0, progress : 0, size : prev});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tself.abortXHR(xhr, { quiet: true });\n\t\t\t\t\t\t\tprev = loaded = 0;\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tvar reqId;\n\t\t\t\t\t\t\t\tif (! abort) {\n\t\t\t\t\t\t\t\t\txhr.open('POST', self.uploadURL, true);\n\t\t\t\t\t\t\t\t\tif (self.api >= 2.1029) {\n\t\t\t\t\t\t\t\t\t\treqId = (+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16);\n\t\t\t\t\t\t\t\t\t\t(typeof formData['delete'] === 'function') && formData['delete']('reqid');\n\t\t\t\t\t\t\t\t\t\tformData.append('reqid', reqId);\n\t\t\t\t\t\t\t\t\t\txhr._requestId = reqId;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\txhr.send(formData);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, retryWait);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.trigger('uploadabort', ['errAbort', 'errTimeout']);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprogress = function() {\n\t\t\t\t\t\tvar node;\n\t\t\t\t\t\tif (notify) {\n\t\t\t\t\t\t\tdfrd.notifyWith(ntfUpload, [{\n\t\t\t\t\t\t\t\tcnt: ntfUpload.data('cnt'),\n\t\t\t\t\t\t\t\tprogress: ntfUpload.data('progress'),\n\t\t\t\t\t\t\t\ttotal: ntfUpload.data('total')\n\t\t\t\t\t\t\t}]);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ttriggerError = function(err, file, unite) {\n\t\t\t\t\t\terr && self.trigger('xhruploadfail', { error: err, file: file });\n\t\t\t\t\t\tif (unite) {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tif (errCnt < self.options.maxErrorDialogs) {\n\t\t\t\t\t\t\t\t\tif (Array.isArray(err)) {\n\t\t\t\t\t\t\t\t\t\terrors = errors.concat(err);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\terrors.push(err);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrCnt++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tself.error(err);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (errors.length) {\n\t\t\t\t\t\t\t\t\tif (errCnt >= self.options.maxErrorDialogs) {\n\t\t\t\t\t\t\t\t\t\terrors = errors.concat('moreErrors', errCnt - self.options.maxErrorDialogs);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tself.error(errors);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrors = [];\n\t\t\t\t\t\t\t\terrCnt = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\terrors = [],\n\t\t\t\t\terrCnt = 0,\n\t\t\t\t\trenames = (data.renames || null),\n\t\t\t\t\thashes = (data.hashes || null),\n\t\t\t\t\tchunkMerge = false,\n\t\t\t\t\tntfUpload = $();\n\t\t\t\t\n\t\t\t\t// regist fnAbort function\n\t\t\t\tnode.one('uploadabort', fnAbort);\n\t\t\t\t$(window).one('unload.' + fm.namespace, fnAbort);\n\t\t\t\t\n\t\t\t\t!chunkMerge && (prev = loaded);\n\t\t\t\t\n\t\t\t\tif (!isDataType && !cnt) {\n\t\t\t\t\treturn dfrd.reject(['errUploadNoFiles']);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\txhr.addEventListener('error', function() {\n\t\t\t\t\tif (xhr.status == 0) {\n\t\t\t\t\t\tif (abort) {\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// ff bug while send zero sized file\n\t\t\t\t\t\t\t// for safari - send directory\n\t\t\t\t\t\t\tif (!isDataType && data.files && $.grep(data.files, function(f){return ! f.type && f.size === (self.UA.Safari? 1802 : 0)? true : false;}).length) {\n\t\t\t\t\t\t\t\tdfrd.reject(['errAbort', 'errFolderUpload']);\n\t\t\t\t\t\t\t} else if (data.input && $.grep(data.input.files, function(f){return ! f.type && f.size === (self.UA.Safari? 1802 : 0)? true : false;}).length) {\n\t\t\t\t\t\t\t\tdfrd.reject(['errUploadNoFiles']);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdoRetry();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode.trigger('uploadabort', 'errConnect');\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t\t\n\t\t\t\txhr.addEventListener('load', function(e) {\n\t\t\t\t\tvar status = xhr.status, res, curr = 0, error = '', errData, errObj;\n\t\t\t\t\t\n\t\t\t\t\tself.setCustomHeaderByXhr(xhr);\n\n\t\t\t\t\tif (status >= 400) {\n\t\t\t\t\t\tif (status > 500) {\n\t\t\t\t\t\t\terror = 'errResponse';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\terror = ['errResponse', 'errServerError'];\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!xhr.responseText) {\n\t\t\t\t\t\t\terror = ['errResponse', 'errDataEmpty'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tnode.trigger('uploadabort');\n\t\t\t\t\t\tgetFile(files || {}).done(function(file) {\n\t\t\t\t\t\t\treturn dfrd.reject(file._cid? null : error);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tloaded = filesize;\n\t\t\t\t\t\n\t\t\t\t\tif (checkNotify() && (curr = loaded - prev)) {\n\t\t\t\t\t\tself.notify({type : 'upload', cnt : 0, progress : curr, size : 0});\n\t\t\t\t\t\tprogress();\n\t\t\t\t\t}\n\n\t\t\t\t\tres = self.parseUploadData(xhr.responseText);\n\t\t\t\t\t\n\t\t\t\t\t// chunked upload commit\n\t\t\t\t\tif (res._chunkmerged) {\n\t\t\t\t\t\tformData = new FormData();\n\t\t\t\t\t\tvar _file = [{_chunkmerged: res._chunkmerged, _name: res._name, _mtime: res._mtime}];\n\t\t\t\t\t\tchunkMerge = true;\n\t\t\t\t\t\tnode.off('uploadabort', fnAbort);\n\t\t\t\t\t\tnotifyto2 = setTimeout(function() {\n\t\t\t\t\t\t\tself.notify({type : 'chunkmerge', cnt : 1});\n\t\t\t\t\t\t}, self.options.notifyDelay);\n\t\t\t\t\t\tisDataType? send(_file, files[1]) : send(_file);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tres._multiupload = data.multiupload? true : false;\n\t\t\t\t\tif (res.error) {\n\t\t\t\t\t\terrData = {\n\t\t\t\t\t\t\tcmd: 'upload',\n\t\t\t\t\t\t\terr: res,\n\t\t\t\t\t\t\txhr: xhr,\n\t\t\t\t\t\t\trc: xhr.status\n\t\t\t\t\t\t};\n\t\t\t\t\t\tself.trigger('uploadfail', res);\n\t\t\t\t\t\t// trigger \"requestError\" event\n\t\t\t\t\t\tself.trigger('requestError', errData);\n\t\t\t\t\t\tif (errData._getEvent && errData._getEvent().isDefaultPrevented()) {\n\t\t\t\t\t\t\tres.error = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (res._chunkfailure || res._multiupload) {\n\t\t\t\t\t\t\tabort = true;\n\t\t\t\t\t\t\tself.uploads.xhrUploading = false;\n\t\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\n\t\t\t\t\t\t\tif (ntfUpload.length) {\n\t\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : -cnt, progress : 0, size : 0});\n\t\t\t\t\t\t\t\tdfrd.reject(res);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// for multi connection\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd.reject(res);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfrd.resolve(res);\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t\t\n\t\t\t\txhr.upload.addEventListener('loadstart', function(e) {\n\t\t\t\t\tif (!chunkMerge && e.lengthComputable) {\n\t\t\t\t\t\tloaded = e.loaded;\n\t\t\t\t\t\tretry && (loaded = 0);\n\t\t\t\t\t\tfilesize = e.total;\n\t\t\t\t\t\tif (!loaded) {\n\t\t\t\t\t\t\tloaded = parseInt(filesize * 0.05);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (checkNotify()) {\n\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : 0, progress : loaded - prev, size : data.multiupload? 0 : filesize});\n\t\t\t\t\t\t\tprev = loaded;\n\t\t\t\t\t\t\tprogress();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t\t\n\t\t\t\txhr.upload.addEventListener('progress', function(e) {\n\t\t\t\t\tvar curr;\n\n\t\t\t\t\tif (e.lengthComputable && !chunkMerge && xhr.readyState < 2) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tloaded = e.loaded;\n\n\t\t\t\t\t\t// to avoid strange bug in safari (not in chrome) with drag&drop.\n\t\t\t\t\t\t// bug: macos finder opened in any folder,\n\t\t\t\t\t\t// reset safari cache (option+command+e), reload elfinder page,\n\t\t\t\t\t\t// drop file from finder\n\t\t\t\t\t\t// on first attempt request starts (progress callback called ones) but never ends.\n\t\t\t\t\t\t// any next drop - successfull.\n\t\t\t\t\t\tif (!data.checked && loaded > 0 && !notifyto) {\n\t\t\t\t\t\t\tnotifyto = startNotify(xhr._totalSize - loaded);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!filesize) {\n\t\t\t\t\t\t\tfilesize = e.total;\n\t\t\t\t\t\t\tif (!loaded) {\n\t\t\t\t\t\t\t\tloaded = parseInt(filesize * 0.05);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tcurr = loaded - prev;\n\t\t\t\t\t\tif (checkNotify() && (curr/e.total) >= 0.05) {\n\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : 0, progress : curr, size : 0});\n\t\t\t\t\t\t\tprev = loaded;\n\t\t\t\t\t\t\tprogress();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!uploadedNtf && loaded >= filesize && !isChunked) {\n\t\t\t\t\t\t\t// Use \"chunkmerge\" for \"server-in-process\" notification\n\t\t\t\t\t\t\tuploadedNtf = true;\n\t\t\t\t\t\t\tnotifyto1 = setTimeout(function() {\n\t\t\t\t\t\t\t\tself.notify({type : 'chunkmerge', cnt : cnt});\n\t\t\t\t\t\t\t}, self.options.notifyDelay);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cancelBtn && ! data.multiupload && loaded >= filesize) {\n\t\t\t\t\t\t\tcheckNotify() && cancelToggle(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t\t\n\t\t\t\tvar send = function(files, paths){\n\t\t\t\t\tvar size = 0,\n\t\t\t\t\tfcnt = 1,\n\t\t\t\t\tsfiles = [],\n\t\t\t\t\tc = 0,\n\t\t\t\t\ttotal = cnt,\n\t\t\t\t\tmaxFileSize,\n\t\t\t\t\ttotalSize = 0,\n\t\t\t\t\tchunked = [],\n\t\t\t\t\tchunkID = new Date().getTime().toString().substr(-9), // for take care of the 32bit backend system\n\t\t\t\t\tBYTES_PER_CHUNK = Math.min((fm.uplMaxSize? fm.uplMaxSize : 2097152) - 8190, fm.options.uploadMaxChunkSize), // uplMaxSize margin 8kb or options.uploadMaxChunkSize\n\t\t\t\t\tblobSlice = chunkEnable? false : '',\n\t\t\t\t\tblobSize, blobMtime, blobName, i, start, end, chunks, blob, chunk, added, done, last, failChunk,\n\t\t\t\t\tmulti = function(files, num){\n\t\t\t\t\t\tvar sfiles = [], cid, sfilesLen = 0, cancelChk, hasChunk;\n\t\t\t\t\t\tif (!abort) {\n\t\t\t\t\t\t\twhile(files.length && sfiles.length < num) {\n\t\t\t\t\t\t\t\tsfiles.push(files.shift());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsfilesLen = sfiles.length;\n\t\t\t\t\t\t\tif (sfilesLen) {\n\t\t\t\t\t\t\t\tcancelChk = sfilesLen;\n\t\t\t\t\t\t\t\tfor (var i=0; i < sfilesLen; i++) {\n\t\t\t\t\t\t\t\t\tif (abort) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcid = isDataType? (sfiles[i][0][0]._cid || null) : (sfiles[i][0]._cid || null);\n\t\t\t\t\t\t\t\t\thasChunk = (hasChunk || cid)? true : false;\n\t\t\t\t\t\t\t\t\tif (!!failChunk[cid]) {\n\t\t\t\t\t\t\t\t\t\tlast--;\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.exec('upload', {\n\t\t\t\t\t\t\t\t\t\ttype: data.type,\n\t\t\t\t\t\t\t\t\t\tisDataType: isDataType,\n\t\t\t\t\t\t\t\t\t\tfiles: sfiles[i],\n\t\t\t\t\t\t\t\t\t\tchecked: true,\n\t\t\t\t\t\t\t\t\t\ttarget: target,\n\t\t\t\t\t\t\t\t\t\tdropEvt: dropEvt,\n\t\t\t\t\t\t\t\t\t\trenames: renames,\n\t\t\t\t\t\t\t\t\t\thashes: hashes,\n\t\t\t\t\t\t\t\t\t\tmultiupload: true,\n\t\t\t\t\t\t\t\t\t\toverwrite: data.overwrite === 0? 0 : void 0,\n\t\t\t\t\t\t\t\t\t\tclipdata: data.clipdata\n\t\t\t\t\t\t\t\t\t}, void 0, target)\n\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\tif (error && error === 'No such command') {\n\t\t\t\t\t\t\t\t\t\t\tabort = true;\n\t\t\t\t\t\t\t\t\t\t\tfm.error(['errUpload', 'errPerm']);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (cid) {\t\n\t\t\t\t\t\t\t\t\t\t\tfailChunk[cid] = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.always(function(e) {\n\t\t\t\t\t\t\t\t\t\tif (e && e.added) added = $.merge(added, e.added);\n\t\t\t\t\t\t\t\t\t\tif (last <= ++done) {\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('multiupload', {added: added});\n\t\t\t\t\t\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\n\t\t\t\t\t\t\t\t\t\t\tif (checkNotify()) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : -cnt, progress : 0, size : 0});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (files.length) {\n\t\t\t\t\t\t\t\t\t\t\tmulti(files, 1); // Next one\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tif (--cancelChk <= 1) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (cancelBtn) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcancelToggle(false, hasChunk);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (sfiles.length < 1 || abort) {\n\t\t\t\t\t\t\tif (abort) {\n\t\t\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\n\t\t\t\t\t\t\t\tif (cid) {\n\t\t\t\t\t\t\t\t\tfailChunk[cid] = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\tself.uploads.xhrUploading = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcheck = function(){\n\t\t\t\t\t\tif (!self.uploads.xhrUploading) {\n\t\t\t\t\t\t\tself.uploads.xhrUploading = true;\n\t\t\t\t\t\t\tmulti(sfiles, multiMax); // Max connection: 3\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout(check, 100);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\treqId, err;\n\n\t\t\t\t\tif (! dataChecked && (isDataType || data.type == 'files')) {\n\t\t\t\t\t\tif (! (maxFileSize = fm.option('uploadMaxSize', target))) {\n\t\t\t\t\t\t\tmaxFileSize = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (i=0; i < files.length; i++) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tblob = files[i];\n\t\t\t\t\t\t\t\tblobSize = blob.size;\n\t\t\t\t\t\t\t\tif (blobSlice === false) {\n\t\t\t\t\t\t\t\t\tblobSlice = '';\n\t\t\t\t\t\t\t\t\tif (self.api >= 2.1) {\n\t\t\t\t\t\t\t\t\t\tif ('slice' in blob) {\n\t\t\t\t\t\t\t\t\t\t\tblobSlice = 'slice';\n\t\t\t\t\t\t\t\t\t\t} else if ('mozSlice' in blob) {\n\t\t\t\t\t\t\t\t\t\t\tblobSlice = 'mozSlice';\n\t\t\t\t\t\t\t\t\t\t} else if ('webkitSlice' in blob) {\n\t\t\t\t\t\t\t\t\t\t\tblobSlice = 'webkitSlice';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tcnt--;\n\t\t\t\t\t\t\t\ttotal--;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// file size check\n\t\t\t\t\t\t\tif ((maxFileSize && blobSize > maxFileSize) || (!blobSlice && fm.uplMaxSize && blobSize > fm.uplMaxSize)) {\n\t\t\t\t\t\t\t\ttriggerError(['errUploadFile', blob.name, 'errUploadFileSize'], blob, true);\n\t\t\t\t\t\t\t\tcnt--;\n\t\t\t\t\t\t\t\ttotal--;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// file mime check\n\t\t\t\t\t\t\tif (blob.type && ! self.uploadMimeCheck(blob.type, target)) {\n\t\t\t\t\t\t\t\ttriggerError(['errUploadFile', blob.name, 'errUploadMime', '(' + blob.type + ')'], blob, true);\n\t\t\t\t\t\t\t\tcnt--;\n\t\t\t\t\t\t\t\ttotal--;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (blobSlice && blobSize > BYTES_PER_CHUNK) {\n\t\t\t\t\t\t\t\tstart = 0;\n\t\t\t\t\t\t\t\tend = BYTES_PER_CHUNK;\n\t\t\t\t\t\t\t\tchunks = -1;\n\t\t\t\t\t\t\t\ttotal = Math.floor((blobSize - 1) / BYTES_PER_CHUNK);\n\t\t\t\t\t\t\t\tblobMtime = blob.lastModified? Math.round(blob.lastModified/1000) : 0;\n\t\t\t\t\t\t\t\tblobName = data.clipdata? fm.date(fm.nonameDateFormat) + '.png' : blob.name;\n\n\t\t\t\t\t\t\t\ttotalSize += blobSize;\n\t\t\t\t\t\t\t\tchunked[chunkID] = 0;\n\t\t\t\t\t\t\t\twhile(start < blobSize) {\n\t\t\t\t\t\t\t\t\tchunk = blob[blobSlice](start, end);\n\t\t\t\t\t\t\t\t\tchunk._chunk = blobName + '.' + (++chunks) + '_' + total + '.part';\n\t\t\t\t\t\t\t\t\tchunk._cid   = chunkID;\n\t\t\t\t\t\t\t\t\tchunk._range = start + ',' + chunk.size + ',' + blobSize;\n\t\t\t\t\t\t\t\t\tchunk._mtime = blobMtime;\n\t\t\t\t\t\t\t\t\tchunked[chunkID]++;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (size) {\n\t\t\t\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (typeof sfiles[c] == 'undefined') {\n\t\t\t\t\t\t\t\t\t\tsfiles[c] = [];\n\t\t\t\t\t\t\t\t\t\tif (isDataType) {\n\t\t\t\t\t\t\t\t\t\t\tsfiles[c][0] = [];\n\t\t\t\t\t\t\t\t\t\t\tsfiles[c][1] = [];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsize = BYTES_PER_CHUNK;\n\t\t\t\t\t\t\t\t\tfcnt = 1;\n\t\t\t\t\t\t\t\t\tif (isDataType) {\n\t\t\t\t\t\t\t\t\t\tsfiles[c][0].push(chunk);\n\t\t\t\t\t\t\t\t\t\tsfiles[c][1].push(paths[i]);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsfiles[c].push(chunk);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tstart = end;\n\t\t\t\t\t\t\t\t\tend = start + BYTES_PER_CHUNK;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (chunk == null) {\n\t\t\t\t\t\t\t\t\ttriggerError(['errUploadFile', blob.name, 'errUploadFileSize'], blob, true);\n\t\t\t\t\t\t\t\t\tcnt--;\n\t\t\t\t\t\t\t\t\ttotal--;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttotal += chunks;\n\t\t\t\t\t\t\t\t\tsize = 0;\n\t\t\t\t\t\t\t\t\tfcnt = 1;\n\t\t\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ((fm.uplMaxSize && size + blobSize > fm.uplMaxSize) || fcnt > fm.uplMaxFile) {\n\t\t\t\t\t\t\t\tsize = 0;\n\t\t\t\t\t\t\t\tfcnt = 1;\n\t\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (typeof sfiles[c] == 'undefined') {\n\t\t\t\t\t\t\t\tsfiles[c] = [];\n\t\t\t\t\t\t\t\tif (isDataType) {\n\t\t\t\t\t\t\t\t\tsfiles[c][0] = [];\n\t\t\t\t\t\t\t\t\tsfiles[c][1] = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (isDataType) {\n\t\t\t\t\t\t\t\tsfiles[c][0].push(blob);\n\t\t\t\t\t\t\t\tsfiles[c][1].push(paths[i]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsfiles[c].push(blob);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsize += blobSize;\n\t\t\t\t\t\t\ttotalSize += blobSize;\n\t\t\t\t\t\t\tfcnt++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (errors.length) {\n\t\t\t\t\t\t\ttriggerError();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (sfiles.length == 0) {\n\t\t\t\t\t\t\t// no data\n\t\t\t\t\t\t\tdata.checked = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (sfiles.length > 1) {\n\t\t\t\t\t\t\t// multi upload\n\t\t\t\t\t\t\tnotifyto = startNotify(totalSize);\n\t\t\t\t\t\t\tadded = [];\n\t\t\t\t\t\t\tdone = 0;\n\t\t\t\t\t\t\tlast = sfiles.length;\n\t\t\t\t\t\t\tfailChunk = [];\n\t\t\t\t\t\t\tcheck();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// single upload\n\t\t\t\t\t\tif (isDataType) {\n\t\t\t\t\t\t\tfiles = sfiles[0][0];\n\t\t\t\t\t\t\tpaths = sfiles[0][1];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles = sfiles[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!dataChecked) {\n\t\t\t\t\t\tif (!fm.UA.Safari || !data.files) {\n\t\t\t\t\t\t\tnotifyto = startNotify(totalSize);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\txhr._totalSize = totalSize;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdataChecked = true;\n\t\t\t\t\t\n\t\t\t\t\tif (! files.length) {\n\t\t\t\t\t\tdfrd.reject(['errUploadNoFiles']);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\txhr.open('POST', self.uploadURL, true);\n\t\t\t\t\t\n\t\t\t\t\t// set request headers\n\t\t\t\t\tif (fm.customHeaders) {\n\t\t\t\t\t\t$.each(fm.customHeaders, function(key) {\n\t\t\t\t\t\t\txhr.setRequestHeader(key, this);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// set xhrFields\n\t\t\t\t\tif (fm.xhrFields) {\n\t\t\t\t\t\t$.each(fm.xhrFields, function(key) {\n\t\t\t\t\t\t\tif (key in xhr) {\n\t\t\t\t\t\t\t\txhr[key] = this;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (self.api >= 2.1029) {\n\t\t\t\t\t\t// request ID\n\t\t\t\t\t\treqId = (+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16);\n\t\t\t\t\t\tformData.append('reqid', reqId);\n\t\t\t\t\t\txhr._requestId = reqId;\n\t\t\t\t\t}\n\t\t\t\t\tformData.append('cmd', 'upload');\n\t\t\t\t\tformData.append(self.newAPI ? 'target' : 'current', target);\n\t\t\t\t\tif (renames && renames.length) {\n\t\t\t\t\t\t$.each(renames, function(i, v) {\n\t\t\t\t\t\t\tformData.append('renames[]', v);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tformData.append('suffix', fm.options.backupSuffix);\n\t\t\t\t\t}\n\t\t\t\t\tif (hashes) {\n\t\t\t\t\t\t$.each(hashes, function(i, v) {\n\t\t\t\t\t\t\tformData.append('hashes['+ i +']', v);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t$.each(self.customData, function(key, val) {\n\t\t\t\t\t\tformData.append(key, val);\n\t\t\t\t\t});\n\t\t\t\t\t$.each(self.options.onlyMimes, function(i, mime) {\n\t\t\t\t\t\tformData.append('mimes[]', mime);\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\tvar name, relpath;\n\t\t\t\t\t\tif (file._chunkmerged) {\n\t\t\t\t\t\t\tformData.append('chunk', file._chunkmerged);\n\t\t\t\t\t\t\tformData.append('upload[]', file._name);\n\t\t\t\t\t\t\tformData.append('mtime[]', file._mtime);\n\t\t\t\t\t\t\tdata.clipdata && formData.append('overwrite', 0);\n\t\t\t\t\t\t\tisChunked = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (file._chunkfail) {\n\t\t\t\t\t\t\t\tformData.append('upload[]', 'chunkfail');\n\t\t\t\t\t\t\t\tformData.append('mimes', 'chunkfail');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (data.clipdata) {\n\t\t\t\t\t\t\t\t\tif (!file._chunk) {\n\t\t\t\t\t\t\t\t\t\tdata.overwrite = 0;\n\t\t\t\t\t\t\t\t\t\tname = fm.date(fm.nonameDateFormat) + '.png';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (file.name) {\n\t\t\t\t\t\t\t\t\t\tname = file.name;\n\t\t\t\t\t\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t\t\t\t\t\tif (name.match(/^image\\.jpe?g$/i)) {\n\t\t\t\t\t\t\t\t\t\t\t\tdata.overwrite = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tname = fm.date(fm.nonameDateFormat) + '.jpg';\n\t\t\t\t\t\t\t\t\t\t\t} else if (name.match(/^capturedvideo\\.mov$/i)) {\n\t\t\t\t\t\t\t\t\t\t\t\tdata.overwrite = 0;\n\t\t\t\t\t\t\t\t\t\t\t\tname = fm.date(fm.nonameDateFormat) + '.mov';\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\trelpath = (file.webkitRelativePath || file.relativePath || file._relativePath || '').replace(/[^\\/]+$/, '');\n\t\t\t\t\t\t\t\t\t\tname = relpath + name;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tname? formData.append('upload[]', file, name) : formData.append('upload[]', file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (file._chunk) {\n\t\t\t\t\t\t\t\tformData.append('chunk', file._chunk);\n\t\t\t\t\t\t\t\tformData.append('cid'  , file._cid);\n\t\t\t\t\t\t\t\tformData.append('range', file._range);\n\t\t\t\t\t\t\t\tformData.append('mtime[]', file._mtime);\n\t\t\t\t\t\t\t\tisChunked = true;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tformData.append('mtime[]', file.lastModified? Math.round(file.lastModified/1000) : 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (isDataType) {\n\t\t\t\t\t\t$.each(paths, function(i, path) {\n\t\t\t\t\t\t\tformData.append('upload_path[]', path);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (data.overwrite === 0) {\n\t\t\t\t\t\tformData.append('overwrite', 0);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// send int value that which meta key was pressed when dropped  as `dropWith`\n\t\t\t\t\tif (dropEvt) {\n\t\t\t\t\t\tformData.append('dropWith', parseInt(\n\t\t\t\t\t\t\t(dropEvt.altKey  ? '1' : '0')+\n\t\t\t\t\t\t\t(dropEvt.ctrlKey ? '1' : '0')+\n\t\t\t\t\t\t\t(dropEvt.metaKey ? '1' : '0')+\n\t\t\t\t\t\t\t(dropEvt.shiftKey? '1' : '0'), 2));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// set extraData on current request\n\t\t\t\t\tif (extraData) {\n\t\t\t\t\t\t$.each(extraData, function(key, val) {\n\t\t\t\t\t\t\tformData.append(key, val);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\txhr.send(formData);\n\t\t\t\t\t\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (! isDataType) {\n\t\t\t\t\tif (files.length > 0) {\n\t\t\t\t\t\tif (! data.clipdata && renames == null) {\n\t\t\t\t\t\t\tvar mkdirs = [],\n\t\t\t\t\t\t\t\tpaths = [],\n\t\t\t\t\t\t\t\texcludes = fm.options.folderUploadExclude[fm.OS] || null;\n\t\t\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\t\t\tvar relPath = file.webkitRelativePath || file.relativePath || '',\n\t\t\t\t\t\t\t\t\tidx, rootDir;\n\t\t\t\t\t\t\t\tif (! relPath) {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (excludes && file.name.match(excludes)) {\n\t\t\t\t\t\t\t\t\tfile._remove = true;\n\t\t\t\t\t\t\t\t\trelPath = void(0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// add '/' as prefix to make same to folder uploading with DnD, see #2607\n\t\t\t\t\t\t\t\t\trelPath = '/' + relPath.replace(/\\/[^\\/]*$/, '').replace(/^\\//, '');\n\t\t\t\t\t\t\t\t\tif (relPath && $.inArray(relPath, mkdirs) === -1) {\n\t\t\t\t\t\t\t\t\t\tmkdirs.push(relPath);\n\t\t\t\t\t\t\t\t\t\t// checking the root directory to supports <input type=\"file\" webkitdirectory> see #2378\n\t\t\t\t\t\t\t\t\t\tidx = relPath.substr(1).indexOf('/');\n\t\t\t\t\t\t\t\t\t\tif (idx !== -1 && (rootDir = relPath.substr(0, idx + 1)) && $.inArray(rootDir, mkdirs) === -1) {\n\t\t\t\t\t\t\t\t\t\t\tmkdirs.unshift(rootDir);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpaths.push(relPath);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\trenames = [];\n\t\t\t\t\t\t\thashes = {};\n\t\t\t\t\t\t\tif (mkdirs.length) {\n\t\t\t\t\t\t\t\t(function() {\n\t\t\t\t\t\t\t\t\tvar checkDirs = $.map(mkdirs, function(name) { return name.substr(1).indexOf('/') === -1 ? {name: name.substr(1)} : null;}),\n\t\t\t\t\t\t\t\t\t\tcancelDirs = [];\n\t\t\t\t\t\t\t\t\tfm.uploads.checkExists(checkDirs, target, fm, true).done(\n\t\t\t\t\t\t\t\t\t\tfunction(res, res2) {\n\t\t\t\t\t\t\t\t\t\t\tvar dfds = [], dfd, bak, hash;\n\t\t\t\t\t\t\t\t\t\t\tif (fm.options.overwriteUploadConfirm && fm.option('uploadOverwrite', target)) {\n\t\t\t\t\t\t\t\t\t\t\t\tcancelDirs = $.map(checkDirs, function(dir) { return dir._remove? dir.name : null ;} );\n\t\t\t\t\t\t\t\t\t\t\t\tcheckDirs = $.grep(checkDirs, function(dir) { return !dir._remove? true : false ;} );\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (cancelDirs.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t$.each(paths.concat(), function(i, path) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($.inArray(path, cancelDirs) === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles[i]._remove = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpaths[i] = void(0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tfiles = $.grep(files, function(file) { return file._remove? false : true; });\n\t\t\t\t\t\t\t\t\t\t\tpaths = $.grep(paths, function(path) { return path === void 0 ? false : true; });\n\t\t\t\t\t\t\t\t\t\t\tif (checkDirs.length) {\n\t\t\t\t\t\t\t\t\t\t\t\tdfd = $.Deferred();\n\t\t\t\t\t\t\t\t\t\t\t\tif (res.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.each(res, function(i, existName) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// backup\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbak = fm.uniqueName(existName + fm.options.backupSuffix , null, '');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$.each(res2, function(h, name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res[0] == name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thash = h;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (! hash) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thash = fm.fileByName(res[0], target).hash;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.lockfiles({files : [hash]});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfds.push(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'rename', target : hash, name : bak},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'rename', cnt : 1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.sync();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : [hash]});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfds.push(null);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t$.when.apply($, dfds).done(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// ensure directories\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'mkdir', target : target, dirs : mkdirs},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'mkdir', cnt : mkdirs.length},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpreventFail: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror = error || ['errUnknown'];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (error[0] === 'errCmdParams') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmultiMax = 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmultiMax = 0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar rm = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!data.hashes) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata.hashes = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpaths = $.map(paths.concat(), function(p, i) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (p === '/') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn target;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data.hashes[p]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn data.hashes[p];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trm = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles[i]._remove = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rm) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = $.grep(files, function(file) { return file._remove? false : true; });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (multiMax) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisDataType = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (! send(files, paths)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.uploads.checkExists(files, target, fm).done(\n\t\t\t\t\t\t\t\t\tfunction(res, res2){\n\t\t\t\t\t\t\t\t\t\tif (fm.options.overwriteUploadConfirm && fm.option('uploadOverwrite', target)) {\n\t\t\t\t\t\t\t\t\t\t\thashes = res2;\n\t\t\t\t\t\t\t\t\t\t\tif (res === null) {\n\t\t\t\t\t\t\t\t\t\t\t\tdata.overwrite = 0;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\trenames = res;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tfiles = $.grep(files, function(file){return !file._remove? true : false ;});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcnt = files.length;\n\t\t\t\t\t\t\t\t\t\tif (cnt > 0) {\n\t\t\t\t\t\t\t\t\t\t\tif (! send(files)) {\n\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (! send(files)) {\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (dataChecked) {\n\t\t\t\t\t\tsend(files[0], files[1]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfiles.done(function(result) { // result: [files, paths, renames, hashes, mkdirs]\n\t\t\t\t\t\t\trenames = [];\n\t\t\t\t\t\t\tcnt = result[0].length;\n\t\t\t\t\t\t\tif (cnt) {\n\t\t\t\t\t\t\t\tif (result[4] && result[4].length) {\n\t\t\t\t\t\t\t\t\t// ensure directories\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'mkdir', target : target, dirs : result[4]},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'mkdir', cnt : result[4].length},\n\t\t\t\t\t\t\t\t\t\tpreventFail: true\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\terror = error || ['errUnknown'];\n\t\t\t\t\t\t\t\t\t\tif (error[0] === 'errCmdParams') {\n\t\t\t\t\t\t\t\t\t\t\tmultiMax = 1;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tmultiMax = 0;\n\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\tvar rm = false;\n\t\t\t\t\t\t\t\t\t\tif (!data.hashes) {\n\t\t\t\t\t\t\t\t\t\t\tdata.hashes = {};\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tresult[1] = $.map(result[1], function(p, i) {\n\t\t\t\t\t\t\t\t\t\t\tresult[0][i]._relativePath = p.replace(/^\\//, '');\n\t\t\t\t\t\t\t\t\t\t\tp = p.replace(/\\/[^\\/]*$/, '');\n\t\t\t\t\t\t\t\t\t\t\tif (p === '') {\n\t\t\t\t\t\t\t\t\t\t\t\treturn target;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tif (data.hashes[p]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn data.hashes[p];\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\trm = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\tresult[0][i]._remove = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (rm) {\n\t\t\t\t\t\t\t\t\t\t\tresult[0] = $.grep(result[0], function(file) { return file._remove? false : true; });\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\t\tif (multiMax) {\n\t\t\t\t\t\t\t\t\t\t\trenames = result[2];\n\t\t\t\t\t\t\t\t\t\t\thashes = result[3];\n\t\t\t\t\t\t\t\t\t\t\tsend(result[0], result[1]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresult[1] = $.map(result[1], function() { return target; });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\trenames = result[2];\n\t\t\t\t\t\t\t\thashes = result[3];\n\t\t\t\t\t\t\t\tsend(result[0], result[1]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.reject(['errUploadNoFiles']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).fail(function(){\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\t\n\t\t\t// upload transport using iframe\n\t\t\tiframe : function(data, fm) { \n\t\t\t\tvar self   = fm ? fm : this,\n\t\t\t\t\tinput  = data.input? data.input : false,\n\t\t\t\t\tfiles  = !input ? self.uploads.checkFile(data, self) : false,\n\t\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\terror && self.error(error);\n\t\t\t\t\t\t}),\n\t\t\t\t\tname = 'iframe-'+fm.namespace+(++self.iframeCnt),\n\t\t\t\t\tform = $('<form action=\"'+self.uploadURL+'\" method=\"post\" enctype=\"multipart/form-data\" encoding=\"multipart/form-data\" target=\"'+name+'\" style=\"display:none\"><input type=\"hidden\" name=\"cmd\" value=\"upload\" /></form>'),\n\t\t\t\t\tmsie = this.UA.IE,\n\t\t\t\t\t// clear timeouts, close notification dialog, remove form/iframe\n\t\t\t\t\tonload = function() {\n\t\t\t\t\t\tabortto  && clearTimeout(abortto);\n\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\n\t\t\t\t\t\tnotify   && self.notify({type : 'upload', cnt : -cnt});\n\t\t\t\t\t\t\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmsie && $('<iframe src=\"javascript:false;\"/>').appendTo(form);\n\t\t\t\t\t\t\tform.remove();\n\t\t\t\t\t\t\tiframe.remove();\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t},\n\t\t\t\t\tiframe = $('<iframe src=\"'+(msie ? 'javascript:false;' : 'about:blank')+'\" name=\"'+name+'\" style=\"position:absolute;left:-1000px;top:-1000px\" />')\n\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\tiframe.off('load')\n\t\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\t\tonload();\n\t\t\t\t\t\t\t\t\t// data will be processed in callback response or window onmessage\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// notify dialog\n\t\t\t\t\t\t\t\tnotifyto = setTimeout(function() {\n\t\t\t\t\t\t\t\t\tnotify = true;\n\t\t\t\t\t\t\t\t\tself.notify({type : 'upload', cnt : cnt});\n\t\t\t\t\t\t\t\t}, self.options.notifyDelay);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// emulate abort on timeout\n\t\t\t\t\t\t\t\tif (self.options.iframeTimeout > 0) {\n\t\t\t\t\t\t\t\t\tabortto = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tonload();\n\t\t\t\t\t\t\t\t\t\tdfrd.reject(['errConnect', 'errTimeout']);\n\t\t\t\t\t\t\t\t\t}, self.options.iframeTimeout);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tform.submit();\n\t\t\t\t\t\t}),\n\t\t\t\t\ttarget  = (data.target || self.cwd().hash),\n\t\t\t\t\tnames   = [],\n\t\t\t\t\tdfds    = [],\n\t\t\t\t\trenames = [],\n\t\t\t\t\thashes  = {},\n\t\t\t\t\tcnt, notify, notifyto, abortto;\n\n\t\t\t\tif (files && files.length) {\n\t\t\t\t\t$.each(files, function(i, val) {\n\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"upload[]\" value=\"'+val+'\"/>');\n\t\t\t\t\t});\n\t\t\t\t\tcnt = 1;\n\t\t\t\t} else if (input && $(input).is(':file') && $(input).val()) {\n\t\t\t\t\tif (fm.options.overwriteUploadConfirm && fm.option('uploadOverwrite', target)) {\n\t\t\t\t\t\tnames = input.files? input.files : [{ name: $(input).val().replace(/^(?:.+[\\\\\\/])?([^\\\\\\/]+)$/, '$1') }];\n\t\t\t\t\t\t//names = $.map(names, function(file){return file.name? { name: file.name } : null ;});\n\t\t\t\t\t\tdfds.push(self.uploads.checkExists(names, target, self).done(\n\t\t\t\t\t\t\tfunction(res, res2){\n\t\t\t\t\t\t\t\thashes = res2;\n\t\t\t\t\t\t\t\tif (res === null) {\n\t\t\t\t\t\t\t\t\tdata.overwrite = 0;\n\t\t\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\t\t\trenames = res;\n\t\t\t\t\t\t\t\t\tcnt = $.grep(names, function(file){return !file._remove? true : false ;}).length;\n\t\t\t\t\t\t\t\t\tif (cnt != names.length) {\n\t\t\t\t\t\t\t\t\t\tcnt = 0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t));\n\t\t\t\t\t}\n\t\t\t\t\tcnt = input.files ? input.files.length : 1;\n\t\t\t\t\tform.append(input);\n\t\t\t\t} else {\n\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.when.apply($, dfds).done(function() {\n\t\t\t\t\tif (cnt < 1) {\n\t\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t\t}\n\t\t\t\t\tform.append('<input type=\"hidden\" name=\"'+(self.newAPI ? 'target' : 'current')+'\" value=\"'+target+'\"/>')\n\t\t\t\t\t\t.append('<input type=\"hidden\" name=\"html\" value=\"1\"/>')\n\t\t\t\t\t\t.append('<input type=\"hidden\" name=\"node\" value=\"'+self.id+'\"/>')\n\t\t\t\t\t\t.append($(input).attr('name', 'upload[]'));\n\t\t\t\t\t\n\t\t\t\t\tif (renames.length > 0) {\n\t\t\t\t\t\t$.each(renames, function(i, rename) {\n\t\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"renames[]\" value=\"'+self.escape(rename)+'\"/>');\n\t\t\t\t\t\t});\n\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"suffix\" value=\"'+fm.options.backupSuffix+'\"/>');\n\t\t\t\t\t}\n\t\t\t\t\tif (hashes) {\n\t\t\t\t\t\t$.each(renames, function(i, v) {\n\t\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"['+i+']\" value=\"'+self.escape(v)+'\"/>');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (data.overwrite === 0) {\n\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"overwrite\" value=\"0\"/>');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t$.each(self.options.onlyMimes||[], function(i, mime) {\n\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"mimes[]\" value=\"'+self.escape(mime)+'\"/>');\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t$.each(self.customData, function(key, val) {\n\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"'+key+'\" value=\"'+self.escape(val)+'\"/>');\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tform.appendTo('body');\n\t\t\t\t\tiframe.appendTo('body');\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t},\n\t\t\n\t\t\n\t\t/**\n\t\t * Bind callback to event(s) The callback is executed at most once per event.\n\t\t * To bind to multiply events at once, separate events names by space\n\t\t *\n\t\t * @param  String    event name\n\t\t * @param  Function  callback\n\t\t * @param  Boolan    priority first\n\t\t * @return elFinder\n\t\t */\n\t\tone : function(ev, callback, priorityFirst) {\n\t\t\tvar self  = this,\n\t\t\t\tevent = ev.toLowerCase(),\n\t\t\t\th     = function(e, f) {\n\t\t\t\t\tif (!self.toUnbindEvents[event]) {\n\t\t\t\t\t\tself.toUnbindEvents[event] = [];\n\t\t\t\t\t}\n\t\t\t\t\tself.toUnbindEvents[event].push({\n\t\t\t\t\t\ttype: event,\n\t\t\t\t\t\tcallback: h\n\t\t\t\t\t});\n\t\t\t\t\treturn (callback.done? callback.done : callback).apply(this, arguments);\n\t\t\t\t};\n\t\t\tif (callback.done) {\n\t\t\t\th = {done: h};\n\t\t\t}\n\t\t\treturn this.bind(event, h, priorityFirst);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Set/get data into/from localStorage\n\t\t *\n\t\t * @param  String       key\n\t\t * @param  String|void  value\n\t\t * @return String|null\n\t\t */\n\t\tlocalStorage : function(key, val) {\n\t\t\tvar self   = this,\n\t\t\t\ts      = window.localStorage,\n\t\t\t\toldkey = 'elfinder-'+(key || '')+this.id, // old key of elFinder < 2.1.6\n\t\t\t\tprefix = window.location.pathname+'-elfinder-',\n\t\t\t\tsuffix = this.id,\n\t\t\t\tclrs   = [],\n\t\t\t\tretval, oldval, t, precnt, sufcnt;\n\n\t\t\t// reset this node data\n\t\t\tif (typeof(key) === 'undefined') {\n\t\t\t\tprecnt = prefix.length;\n\t\t\t\tsufcnt = suffix.length * -1;\n\t\t\t\t$.each(s, function(key) {\n\t\t\t\t\tif (key.substr(0, precnt) === prefix && key.substr(sufcnt) === suffix) {\n\t\t\t\t\t\tclrs.push(key);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$.each(clrs, function(i, key) {\n\t\t\t\t\ts.removeItem(key);\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// new key of elFinder >= 2.1.6\n\t\t\tkey = prefix+key+suffix;\n\t\t\t\n\t\t\tif (val === null) {\n\t\t\t\treturn s.removeItem(key);\n\t\t\t}\n\t\t\t\n\t\t\tif (val === void(0) && !(retval = s.getItem(key)) && (oldval = s.getItem(oldkey))) {\n\t\t\t\tval = oldval;\n\t\t\t\ts.removeItem(oldkey);\n\t\t\t}\n\t\t\t\n\t\t\tif (val !== void(0)) {\n\t\t\t\tt = typeof val;\n\t\t\t\tif (t !== 'string' && t !== 'number') {\n\t\t\t\t\tval = JSON.stringify(val);\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\ts.setItem(key, val);\n\t\t\t\t} catch (e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\ts.clear();\n\t\t\t\t\t\ts.setItem(key, val);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself.debug('error', e.toString());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tretval = s.getItem(key);\n\t\t\t}\n\n\t\t\tif (retval && (retval.substr(0,1) === '{' || retval.substr(0,1) === '[')) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(retval);\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t\treturn retval;\n\t\t},\n\n\t\t/**\n\t\t * Set/get data into/from sessionStorage\n\t\t *\n\t\t * @param  String       key\n\t\t * @param  String|void  value\n\t\t * @return String|null\n\t\t */\n\t\tsessionStorage : function(key, val) {\n\t\t\tvar self   = this,\n\t\t\t\ts, retval, t;\n\n\t\t\ttry {\n\t\t\t\ts = window.sessionStorage;\n\t\t\t} catch(e) {}\n\n\t\t\tif (!s) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (val === null) {\n\t\t\t\treturn s.removeItem(key);\n\t\t\t}\n\n\t\t\tif (val !== void(0)) {\n\t\t\t\tt = typeof val;\n\t\t\t\tif (t !== 'string' && t !== 'number') {\n\t\t\t\t\tval = JSON.stringify(val);\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\ts.setItem(key, val);\n\t\t\t\t} catch (e) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\ts.clear();\n\t\t\t\t\t\ts.setItem(key, val);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself.debug('error', e.toString());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tretval = s.getItem(key);\n\n\t\t\tif (retval && (retval.substr(0,1) === '{' || retval.substr(0,1) === '[')) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(retval);\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t\treturn retval;\n\t\t},\n\n\t\t/**\n\t\t * Get/set cookie\n\t\t *\n\t\t * @param  String       cookie name\n\t\t * @param  String|void  cookie value\n\t\t * @return String|null\n\t\t */\n\t\tcookie : function(name, value) {\n\t\t\tvar d, o, c, i, retval, t;\n\n\t\t\tname = 'elfinder-'+name+this.id;\n\n\t\t\tif (value === void(0)) {\n\t\t\t\tif (this.cookieEnabled && document.cookie && document.cookie != '') {\n\t\t\t\t\tc = document.cookie.split(';');\n\t\t\t\t\tname += '=';\n\t\t\t\t\tfor (i=0; i<c.length; i++) {\n\t\t\t\t\t\tc[i] = $.trim(c[i]);\n\t\t\t\t\t\tif (c[i].substring(0, name.length) == name) {\n\t\t\t\t\t\t\tretval = decodeURIComponent(c[i].substring(name.length));\n\t\t\t\t\t\t\tif (retval.substr(0,1) === '{' || retval.substr(0,1) === '[') {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\treturn JSON.parse(retval);\n\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn retval;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (!this.cookieEnabled) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\to = Object.assign({}, this.options.cookie);\n\t\t\tif (value === null) {\n\t\t\t\tvalue = '';\n\t\t\t\to.expires = -1;\n\t\t\t} else {\n\t\t\t\tt = typeof value;\n\t\t\t\tif (t !== 'string' && t !== 'number') {\n\t\t\t\t\tvalue = JSON.stringify(value);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof(o.expires) == 'number') {\n\t\t\t\td = new Date();\n\t\t\t\td.setTime(d.getTime()+(o.expires * 86400000));\n\t\t\t\to.expires = d;\n\t\t\t}\n\t\t\tdocument.cookie = name+'='+encodeURIComponent(value)+'; expires='+o.expires.toUTCString()+(o.path ? '; path='+o.path : '')+(o.domain ? '; domain='+o.domain : '')+(o.secure ? '; secure' : '');\n\t\t\tif (value && (value.substr(0,1) === '{' || value.substr(0,1) === '[')) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(value);\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t\treturn value;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Get start directory (by location.hash or last opened directory)\n\t\t * \n\t\t * @return String\n\t\t */\n\t\tstartDir : function() {\n\t\t\tvar locHash = window.location.hash;\n\t\t\tif (locHash && locHash.match(/^#elf_/)) {\n\t\t\t\treturn locHash.replace(/^#elf_/, '');\n\t\t\t} else if (this.options.startPathHash) {\n\t\t\t\treturn this.options.startPathHash;\n\t\t\t} else {\n\t\t\t\treturn this.lastDir();\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Get/set last opened directory\n\t\t * \n\t\t * @param  String|undefined  dir hash\n\t\t * @return String\n\t\t */\n\t\tlastDir : function(hash) { \n\t\t\treturn this.options.rememberLastDir ? this.storage('lastdir', hash) : '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Node for escape html entities in texts\n\t\t * \n\t\t * @type jQuery\n\t\t */\n\t\t_node : $('<span/>'),\n\t\t\n\t\t/**\n\t\t * Replace not html-safe symbols to html entities\n\t\t * \n\t\t * @param  String  text to escape\n\t\t * @return String\n\t\t */\n\t\tescape : function(name) {\n\t\t\treturn this._node.text(name).html().replace(/\"/g, '&quot;').replace(/'/g, '&#039;');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Cleanup ajax data.\n\t\t * For old api convert data into new api format\n\t\t * \n\t\t * @param  String  command name\n\t\t * @param  Object  data from backend\n\t\t * @return Object\n\t\t */\n\t\tnormalize : function(data) {\n\t\t\tvar self   = this,\n\t\t\t\tfileFilter = (function() {\n\t\t\t\t\tvar func, filter;\n\t\t\t\t\tif (filter = self.options.fileFilter) {\n\t\t\t\t\t\tif (typeof filter === 'function') {\n\t\t\t\t\t\t\tfunc = function(file) {\n\t\t\t\t\t\t\t\treturn filter.call(self, file);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else if (filter instanceof RegExp) {\n\t\t\t\t\t\t\tfunc = function(file) {\n\t\t\t\t\t\t\t\treturn filter.test(file.name);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn func? func : null;\n\t\t\t\t})(),\n\t\t\t\tchkCmdMap = function(opts) {\n\t\t\t\t\t// Disable command to replace with other command\n\t\t\t\t\tvar disabled;\n\t\t\t\t\tif (opts.uiCmdMap) {\n\t\t\t\t\t\tif ($.isPlainObject(opts.uiCmdMap) && Object.keys(opts.uiCmdMap).length) {\n\t\t\t\t\t\t\tif (!opts.disabledFlip) {\n\t\t\t\t\t\t\t\topts.disabledFlip = {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdisabled = opts.disabledFlip;\n\t\t\t\t\t\t\t$.each(opts.uiCmdMap, function(f, t) {\n\t\t\t\t\t\t\t\tif (t === 'hidden' && !disabled[f]) {\n\t\t\t\t\t\t\t\t\topts.disabled.push(f);\n\t\t\t\t\t\t\t\t\topts.disabledFlip[f] = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete opts.uiCmdMap;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnormalizeOptions = function(opts) {\n\t\t\t\t\tvar getType = function(v) {\n\t\t\t\t\t\t\tvar type = typeof v;\n\t\t\t\t\t\t\tif (type === 'object' && Array.isArray(v)) {\n\t\t\t\t\t\t\t\ttype = 'array';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn type;\n\t\t\t\t\t\t};\n\t\t\t\t\t$.each(self.optionProperties, function(k, empty) {\n\t\t\t\t\t\tif (empty !== void(0)) {\n\t\t\t\t\t\t\tif (opts[k] && getType(opts[k]) !== getType(empty)) {\n\t\t\t\t\t\t\t\topts[k] = empty;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (opts.disabled) {\n\t\t\t\t\t\topts.disabledFlip = self.arrayFlip(opts.disabled, true);\n\t\t\t\t\t\t$.each(self.options.disabledCmdsRels, function(com, rels) {\n\t\t\t\t\t\t\tvar m, flg;\n\t\t\t\t\t\t\tif (opts.disabledFlip[com]) {\n\t\t\t\t\t\t\t\tflg = true;\n\t\t\t\t\t\t\t} else if (m = com.match(/^([^&]+)&([^=]+)=(.*)$/)) {\n\t\t\t\t\t\t\t\tif (opts.disabledFlip[m[1]] && opts[m[2]] == m[3]) {\n\t\t\t\t\t\t\t\t\tflg = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (flg) {\n\t\t\t\t\t\t\t\t$.each(rels, function(i, rel) {\n\t\t\t\t\t\t\t\t\tif (!opts.disabledFlip[rel]) {\n\t\t\t\t\t\t\t\t\t\topts.disabledFlip[rel] = true;\n\t\t\t\t\t\t\t\t\t\topts.disabled.push(rel);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\topts.disabledFlip = {};\n\t\t\t\t\t}\n\t\t\t\t\treturn opts;\n\t\t\t\t},\n\t\t\t\tfilter = function(file, asMap, type) { \n\t\t\t\t\tvar res = asMap? file : true,\n\t\t\t\t\t\tign = asMap? null : false,\n\t\t\t\t\t\tvid, targetOptions, isRoot, rootNames;\n\t\t\t\t\t\n\t\t\t\t\tif (file && file.hash && file.name && file.mime) {\n\t\t\t\t\t\tif (file.mime === 'application/x-empty') {\n\t\t\t\t\t\t\tfile.mime = 'text/plain';\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tisRoot = self.isRoot(file);\n\t\t\t\t\t\tif (isRoot && ! file.volumeid) {\n\t\t\t\t\t\t\tself.debug('warning', 'The volume root statuses requires `volumeid` property.');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (isRoot || file.mime === 'directory') {\n\t\t\t\t\t\t\t// Prevention of circular reference\n\t\t\t\t\t\t\tif (file.phash) {\n\t\t\t\t\t\t\t\tif (file.phash === file.hash) {\n\t\t\t\t\t\t\t\t\terror = error.concat(['Parent folder of \"$1\" is itself.', file.name]);\n\t\t\t\t\t\t\t\t\treturn ign;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (isRoot && file.volumeid && file.phash.indexOf(file.volumeid) === 0) {\n\t\t\t\t\t\t\t\t\terror = error.concat(['Parent folder of \"$1\" is inner itself.', file.name]);\n\t\t\t\t\t\t\t\t\treturn ign;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// set options, tmbUrls for each volume\n\t\t\t\t\t\t\tif (file.volumeid) {\n\t\t\t\t\t\t\t\tvid = file.volumeid;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (isRoot) {\n\t\t\t\t\t\t\t\t\t// make or update of leaf roots cache\n\t\t\t\t\t\t\t\t\tif (file.phash) {\n\t\t\t\t\t\t\t\t\t\tif (! self.leafRoots[file.phash]) {\n\t\t\t\t\t\t\t\t\t\t\tself.leafRoots[file.phash] = [ file.hash ];\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tif ($.inArray(file.hash, self.leafRoots[file.phash]) === -1) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.leafRoots[file.phash].push(file.hash);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tself.hasVolOptions = true;\n\t\t\t\t\t\t\t\t\tif (! self.volOptions[vid]) {\n\t\t\t\t\t\t\t\t\t\tself.volOptions[vid] = {\n\t\t\t\t\t\t\t\t\t\t\t// set dispInlineRegex\n\t\t\t\t\t\t\t\t\t\t\tdispInlineRegex: self.options.dispInlineRegex\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\ttargetOptions = self.volOptions[vid];\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (file.options) {\n\t\t\t\t\t\t\t\t\t\t// >= v.2.1.14 has file.options\n\t\t\t\t\t\t\t\t\t\tObject.assign(targetOptions, file.options);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// for compat <= v2.1.13\n\t\t\t\t\t\t\t\t\tif (file.disabled) {\n\t\t\t\t\t\t\t\t\t\ttargetOptions.disabled = file.disabled;\n\t\t\t\t\t\t\t\t\t\ttargetOptions.disabledFlip = self.arrayFlip(file.disabled, true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (file.tmbUrl) {\n\t\t\t\t\t\t\t\t\t\ttargetOptions.tmbUrl = file.tmbUrl;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// '/' required at the end of url\n\t\t\t\t\t\t\t\t\tif (targetOptions.url && targetOptions.url.substr(-1) !== '/') {\n\t\t\t\t\t\t\t\t\t\ttargetOptions.url += '/';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// check uiCmdMap\n\t\t\t\t\t\t\t\t\tchkCmdMap(targetOptions);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// check trash bin hash\n\t\t\t\t\t\t\t\t\tif (targetOptions.trashHash) {\n\t\t\t\t\t\t\t\t\t\tif (self.trashes[targetOptions.trashHash] === false) {\n\t\t\t\t\t\t\t\t\t\t\tdelete targetOptions.trashHash;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tself.trashes[targetOptions.trashHash] = file.hash;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// set immediate properties\n\t\t\t\t\t\t\t\t\t$.each(self.optionProperties, function(k) {\n\t\t\t\t\t\t\t\t\t\tif (targetOptions[k]) {\n\t\t\t\t\t\t\t\t\t\t\tfile[k] = targetOptions[k];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t// regist fm.roots\n\t\t\t\t\t\t\t\t\tif (type !== 'cwd') {\n\t\t\t\t\t\t\t\t\t\tself.roots[vid] = file.hash;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// regist fm.volumeExpires\n\t\t\t\t\t\t\t\t\tif (file.expires) {\n\t\t\t\t\t\t\t\t\t\tself.volumeExpires[vid] = file.expires;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (prevId !== vid) {\n\t\t\t\t\t\t\t\t\tprevId = vid;\n\t\t\t\t\t\t\t\t\ti18nFolderName = self.option('i18nFolderName', vid);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// volume root i18n name\n\t\t\t\t\t\t\tif (isRoot && ! file.i18) {\n\t\t\t\t\t\t\t\tname = 'volume_' + file.name,\n\t\t\t\t\t\t\t\ti18 = self.i18n(false, name);\n\t\t\n\t\t\t\t\t\t\t\tif (name !== i18) {\n\t\t\t\t\t\t\t\t\tfile.i18 = i18;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// i18nFolderName\n\t\t\t\t\t\t\tif (i18nFolderName && ! file.i18) {\n\t\t\t\t\t\t\t\tname = 'folder_' + file.name,\n\t\t\t\t\t\t\t\ti18 = self.i18n(false, name);\n\t\t\n\t\t\t\t\t\t\t\tif (name !== i18) {\n\t\t\t\t\t\t\t\t\tfile.i18 = i18;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (isRoot) {\n\t\t\t\t\t\t\t\tif (rootNames = self.storage('rootNames')) {\n\t\t\t\t\t\t\t\t\tif (rootNames[file.hash]) {\n\t\t\t\t\t\t\t\t\t\tfile._name = file.name;\n\t\t\t\t\t\t\t\t\t\tfile._i18 = file.i18;\n\t\t\t\t\t\t\t\t\t\tfile.name = rootNames[file.hash] = rootNames[file.hash];\n\t\t\t\t\t\t\t\t\t\tdelete file.i18;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tself.storage('rootNames', rootNames);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// lock trash bins holder\n\t\t\t\t\t\t\tif (self.trashes[file.hash]) {\n\t\t\t\t\t\t\t\tfile.locked = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (fileFilter) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif (! fileFilter(file)) {\n\t\t\t\t\t\t\t\t\t\treturn ign;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tself.debug(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (file.size == 0) {\n\t\t\t\t\t\t\t\tfile.mime = self.getMimetype(file.name, file.mime);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.options) {\n\t\t\t\t\t\t\tself.optionsByHashes[file.hash] = normalizeOptions(file.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdelete file.options;\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t}\n\t\t\t\t\treturn ign;\n\t\t\t\t},\n\t\t\t\tgetDescendants = function(hashes) {\n\t\t\t\t\tvar res = [];\n\t\t\t\t\t$.each(self.files(), function(h, f) {\n\t\t\t\t\t\t$.each(self.parents(h), function(i, ph) {\n\t\t\t\t\t\t\tif ($.inArray(ph, hashes) !== -1 && $.inArray(h, hashes) === -1) {\n\t\t\t\t\t\t\t\tres.push(h);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\treturn res;\n\t\t\t\t},\n\t\t\t\tapplyLeafRootStats = function(dataArr, type) {\n\t\t\t\t\t$.each(dataArr, function(i, f) {\n\t\t\t\t\t\tvar pfile, done;\n\t\t\t\t\t\tif (self.leafRoots[f.hash]) {\n\t\t\t\t\t\t\tself.applyLeafRootStats(f);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// update leaf root parent stat\n\t\t\t\t\t\tif (type !== 'change' && f.phash && self.isRoot(f) && (pfile = self.file(f.phash))) {\n\t\t\t\t\t\t\tself.applyLeafRootStats(pfile);\n\t\t\t\t\t\t\t// add to data.changed\n\t\t\t\t\t\t\tif (!data.changed) {\n\t\t\t\t\t\t\t\tdata.changed = [pfile];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$.each(data.changed, function(i, f) {\n\t\t\t\t\t\t\t\t\tif (f.hash === pfile.hash) {\n\t\t\t\t\t\t\t\t\t\tdata.changed[i] = pfile;\n\t\t\t\t\t\t\t\t\t\tdone = true;\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (!done) {\n\t\t\t\t\t\t\t\t\tdata.changed.push(pfile);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror = [],\n\t\t\t\tname, i18, i18nFolderName, prevId, cData;\n\t\t\t\n\t\t\t// set cunstom data\n\t\t\tif (data.customData && (!self.prevCustomData || (JSON.stringify(data.customData) !== JSON.stringify(self.prevCustomData)))) {\n\t\t\t\tself.prevCustomData = data.customData;\n\t\t\t\ttry {\n\t\t\t\t\tcData = JSON.parse(data.customData);\n\t\t\t\t\tif ($.isPlainObject(cData)) {\n\t\t\t\t\t\tself.prevCustomData = cData;\n\t\t\t\t\t\t$.each(Object.keys(cData), function(i, key) {\n\t\t\t\t\t\t\tif (cData[key] === null) {\n\t\t\t\t\t\t\t\tdelete cData[key];\n\t\t\t\t\t\t\t\tdelete self.optsCustomData[key];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tself.customData = Object.assign({}, self.optsCustomData, cData);\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\n\t\t\tif (data.options) {\n\t\t\t\tnormalizeOptions(data.options);\n\t\t\t}\n\t\t\t\n\t\t\tif (data.cwd) {\n\t\t\t\tif (data.cwd.volumeid && data.options && Object.keys(data.options).length && self.isRoot(data.cwd)) {\n\t\t\t\t\tself.hasVolOptions = true;\n\t\t\t\t\tself.volOptions[data.cwd.volumeid] = data.options;\n\t\t\t\t}\n\t\t\t\tdata.cwd = filter(data.cwd, true, 'cwd');\n\t\t\t}\n\t\t\tif (data.files) {\n\t\t\t\tdata.files = $.grep(data.files, filter);\n\t\t\t} \n\t\t\tif (data.tree) {\n\t\t\t\tdata.tree = $.grep(data.tree, filter);\n\t\t\t}\n\t\t\tif (data.added) {\n\t\t\t\tdata.added = $.grep(data.added, filter);\n\t\t\t}\n\t\t\tif (data.changed) {\n\t\t\t\tdata.changed = $.grep(data.changed, filter);\n\t\t\t}\n\t\t\tif (data.removed && data.removed.length && self.searchStatus.state === 2) {\n\t\t\t\tdata.removed = data.removed.concat(getDescendants(data.removed));\n\t\t\t}\n\t\t\tif (data.api) {\n\t\t\t\tdata.init = true;\n\t\t\t}\n\n\t\t\tif (Object.keys(self.leafRoots).length) {\n\t\t\t\tdata.files && applyLeafRootStats(data.files);\n\t\t\t\tdata.tree && applyLeafRootStats(data.tree);\n\t\t\t\tdata.added && applyLeafRootStats(data.added);\n\t\t\t\tdata.changed && applyLeafRootStats(data.changed, 'change');\n\t\t\t}\n\n\t\t\t// merge options that apply only to cwd\n\t\t\tif (data.cwd && data.cwd.options && data.options) {\n\t\t\t\tObject.assign(data.options, normalizeOptions(data.cwd.options));\n\t\t\t}\n\n\t\t\t// '/' required at the end of url\n\t\t\tif (data.options && data.options.url && data.options.url.substr(-1) !== '/') {\n\t\t\t\tdata.options.url += '/';\n\t\t\t}\n\t\t\t\n\t\t\t// check error\n\t\t\tif (error.length) {\n\t\t\t\tdata.norError = ['errResponse'].concat(error);\n\t\t\t}\n\t\t\t\n\t\t\treturn data;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Update sort options\n\t\t *\n\t\t * @param {String} sort type\n\t\t * @param {String} sort order\n\t\t * @param {Boolean} show folder first\n\t\t */\n\t\tsetSort : function(type, order, stickFolders, alsoTreeview) {\n\t\t\tthis.storage('sortType', (this.sortType = this.sortRules[type] ? type : 'name'));\n\t\t\tthis.storage('sortOrder', (this.sortOrder = /asc|desc/.test(order) ? order : 'asc'));\n\t\t\tthis.storage('sortStickFolders', (this.sortStickFolders = !!stickFolders) ? 1 : '');\n\t\t\tthis.storage('sortAlsoTreeview', (this.sortAlsoTreeview = !!alsoTreeview) ? 1 : '');\n\t\t\tthis.trigger('sortchange');\n\t\t},\n\t\t\n\t\t_sortRules : {\n\t\t\tname : function(file1, file2) {\n\t\t\t\treturn elFinder.prototype.naturalCompare(file1.i18 || file1.name, file2.i18 || file2.name);\n\t\t\t},\n\t\t\tsize : function(file1, file2) { \n\t\t\t\tvar size1 = parseInt(file1.size) || 0,\n\t\t\t\t\tsize2 = parseInt(file2.size) || 0;\n\t\t\t\t\t\n\t\t\t\treturn size1 === size2 ? 0 : size1 > size2 ? 1 : -1;\n\t\t\t},\n\t\t\tkind : function(file1, file2) {\n\t\t\t\treturn elFinder.prototype.naturalCompare(file1.mime, file2.mime);\n\t\t\t},\n\t\t\tdate : function(file1, file2) { \n\t\t\t\tvar date1 = file1.ts || file1.date || 0,\n\t\t\t\t\tdate2 = file2.ts || file2.date || 0;\n\n\t\t\t\treturn date1 === date2 ? 0 : date1 > date2 ? 1 : -1;\n\t\t\t},\n\t\t\tperm : function(file1, file2) { \n\t\t\t\tvar val = function(file) { return (file.write? 2 : 0) + (file.read? 1 : 0); },\n\t\t\t\t\tv1  = val(file1),\n\t\t\t\t\tv2  = val(file2);\n\t\t\t\treturn v1 === v2 ? 0 : v1 > v2 ? 1 : -1;\n\t\t\t},\n\t\t\tmode : function(file1, file2) { \n\t\t\t\tvar v1 = file1.mode || (file1.perm || ''),\n\t\t\t\t\tv2 = file2.mode || (file2.perm || '');\n\t\t\t\treturn elFinder.prototype.naturalCompare(v1, v2);\n\t\t\t},\n\t\t\towner : function(file1, file2) { \n\t\t\t\tvar v1 = file1.owner || '',\n\t\t\t\t\tv2 = file2.owner || '';\n\t\t\t\treturn elFinder.prototype.naturalCompare(v1, v2);\n\t\t\t},\n\t\t\tgroup : function(file1, file2) { \n\t\t\t\tvar v1 = file1.group || '',\n\t\t\t\t\tv2 = file2.group || '';\n\t\t\t\treturn elFinder.prototype.naturalCompare(v1, v2);\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Valid sort rule names\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tsorters : {},\n\t\t\n\t\t/**\n\t\t * Compare strings for natural sort\n\t\t *\n\t\t * @param  String\n\t\t * @param  String\n\t\t * @return Number\n\t\t */\n\t\tnaturalCompare : function(a, b) {\n\t\t\tvar self = elFinder.prototype.naturalCompare;\n\t\t\tif (typeof self.loc == 'undefined') {\n\t\t\t\tself.loc = (navigator.userLanguage || navigator.browserLanguage || navigator.language || 'en-US');\n\t\t\t}\n\t\t\tif (typeof self.sort == 'undefined') {\n\t\t\t\tif ('11'.localeCompare('2', self.loc, {numeric: true}) > 0) {\n\t\t\t\t\t// Native support\n\t\t\t\t\tif (window.Intl && window.Intl.Collator) {\n\t\t\t\t\t\tself.sort = new Intl.Collator(self.loc, {numeric: true}).compare;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.sort = function(a, b) {\n\t\t\t\t\t\t\treturn a.localeCompare(b, self.loc, {numeric: true});\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t/*\n\t\t\t\t\t * Edited for elFinder (emulates localeCompare() by numeric) by Naoki Sawada aka nao-pon\n\t\t\t\t\t */\n\t\t\t\t\t/*\n\t\t\t\t\t * Huddle/javascript-natural-sort (https://github.com/Huddle/javascript-natural-sort)\n\t\t\t\t\t */\n\t\t\t\t\t/*\n\t\t\t\t\t * Natural Sort algorithm for Javascript - Version 0.7 - Released under MIT license\n\t\t\t\t\t * Author: Jim Palmer (based on chunking idea from Dave Koelle)\n\t\t\t\t\t * http://opensource.org/licenses/mit-license.php\n\t\t\t\t\t */\n\t\t\t\t\tself.sort = function(a, b) {\n\t\t\t\t\t\tvar re = /(^-?[0-9]+(\\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,\n\t\t\t\t\t\tsre = /(^[ ]*|[ ]*$)/g,\n\t\t\t\t\t\tdre = /(^([\\w ]+,?[\\w ]+)?[\\w ]+,?[\\w ]+\\d+:\\d+(:\\d+)?[\\w ]?|^\\d{1,4}[\\/\\-]\\d{1,4}[\\/\\-]\\d{1,4}|^\\w+, \\w+ \\d+, \\d{4})/,\n\t\t\t\t\t\thre = /^0x[0-9a-f]+$/i,\n\t\t\t\t\t\tore = /^0/,\n\t\t\t\t\t\tsyre = /^[\\x01\\x21-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\x7e]/, // symbol first - (Naoki Sawada)\n\t\t\t\t\t\ti = function(s) { return self.sort.insensitive && (''+s).toLowerCase() || ''+s; },\n\t\t\t\t\t\t// convert all to strings strip whitespace\n\t\t\t\t\t\t// first character is \"_\", it's smallest - (Naoki Sawada)\n\t\t\t\t\t\tx = i(a).replace(sre, '').replace(/^_/, \"\\x01\") || '',\n\t\t\t\t\t\ty = i(b).replace(sre, '').replace(/^_/, \"\\x01\") || '',\n\t\t\t\t\t\t// chunk/tokenize\n\t\t\t\t\t\txN = x.replace(re, '\\0$1\\0').replace(/\\0$/,'').replace(/^\\0/,'').split('\\0'),\n\t\t\t\t\t\tyN = y.replace(re, '\\0$1\\0').replace(/\\0$/,'').replace(/^\\0/,'').split('\\0'),\n\t\t\t\t\t\t// numeric, hex or date detection\n\t\t\t\t\t\txD = parseInt(x.match(hre)) || (xN.length != 1 && x.match(dre) && Date.parse(x)),\n\t\t\t\t\t\tyD = parseInt(y.match(hre)) || xD && y.match(dre) && Date.parse(y) || null,\n\t\t\t\t\t\toFxNcL, oFyNcL,\n\t\t\t\t\t\tlocRes = 0;\n\n\t\t\t\t\t\t// first try and sort Hex codes or Dates\n\t\t\t\t\t\tif (yD) {\n\t\t\t\t\t\t\tif ( xD < yD ) return -1;\n\t\t\t\t\t\t\telse if ( xD > yD ) return 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// natural sorting through split numeric strings and default strings\n\t\t\t\t\t\tfor(var cLoc=0, numS=Math.max(xN.length, yN.length); cLoc < numS; cLoc++) {\n\n\t\t\t\t\t\t\t// find floats not starting with '0', string or 0 if not defined (Clint Priest)\n\t\t\t\t\t\t\toFxNcL = !(xN[cLoc] || '').match(ore) && parseFloat(xN[cLoc]) || xN[cLoc] || 0;\n\t\t\t\t\t\t\toFyNcL = !(yN[cLoc] || '').match(ore) && parseFloat(yN[cLoc]) || yN[cLoc] || 0;\n\n\t\t\t\t\t\t\t// handle numeric vs string comparison - number < string - (Kyle Adams)\n\t\t\t\t\t\t\t// but symbol first < number - (Naoki Sawada)\n\t\t\t\t\t\t\tif (isNaN(oFxNcL) !== isNaN(oFyNcL)) {\n\t\t\t\t\t\t\t\tif (isNaN(oFxNcL) && (typeof oFxNcL !== 'string' || ! oFxNcL.match(syre))) {\n\t\t\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t\t\t} else if (typeof oFyNcL !== 'string' || ! oFyNcL.match(syre)) {\n\t\t\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// use decimal number comparison if either value is string zero\n\t\t\t\t\t\t\tif (parseInt(oFxNcL, 10) === 0) oFxNcL = 0;\n\t\t\t\t\t\t\tif (parseInt(oFyNcL, 10) === 0) oFyNcL = 0;\n\n\t\t\t\t\t\t\t// rely on string comparison if different types - i.e. '02' < 2 != '02' < '2'\n\t\t\t\t\t\t\tif (typeof oFxNcL !== typeof oFyNcL) {\n\t\t\t\t\t\t\t\toFxNcL += '';\n\t\t\t\t\t\t\t\toFyNcL += '';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// use locale sensitive sort for strings when case insensitive\n\t\t\t\t\t\t\t// note: localeCompare interleaves uppercase with lowercase (e.g. A,a,B,b)\n\t\t\t\t\t\t\tif (self.sort.insensitive && typeof oFxNcL === 'string' && typeof oFyNcL === 'string') {\n\t\t\t\t\t\t\t\tlocRes = oFxNcL.localeCompare(oFyNcL, self.loc);\n\t\t\t\t\t\t\t\tif (locRes !== 0) return locRes;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (oFxNcL < oFyNcL) return -1;\n\t\t\t\t\t\t\tif (oFxNcL > oFyNcL) return 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t};\n\t\t\t\t\tself.sort.insensitive = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn self.sort(a, b);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Compare files based on elFinder.sort\n\t\t *\n\t\t * @param  Object  file\n\t\t * @param  Object  file\n\t\t * @return Number\n\t\t */\n\t\tcompare : function(file1, file2) {\n\t\t\tvar self  = this,\n\t\t\t\ttype  = self.sortType,\n\t\t\t\tasc   = self.sortOrder == 'asc',\n\t\t\t\tstick = self.sortStickFolders,\n\t\t\t\trules = self.sortRules,\n\t\t\t\tsort  = rules[type],\n\t\t\t\td1    = file1.mime == 'directory',\n\t\t\t\td2    = file2.mime == 'directory',\n\t\t\t\tres;\n\t\t\t\t\n\t\t\tif (stick) {\n\t\t\t\tif (d1 && !d2) {\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (!d1 && d2) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tres = asc ? sort(file1, file2) : sort(file2, file1);\n\t\t\t\n\t\t\treturn type !== 'name' && res === 0\n\t\t\t\t? res = asc ? rules.name(file1, file2) : rules.name(file2, file1)\n\t\t\t\t: res;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Sort files based on config\n\t\t *\n\t\t * @param  Array  files\n\t\t * @return Array\n\t\t */\n\t\tsortFiles : function(files) {\n\t\t\treturn files.sort(this.compare);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Open notification dialog \n\t\t * and append/update message for required notification type.\n\t\t *\n\t\t * @param  Object  options\n\t\t * @example  \n\t\t * this.notify({\n\t\t *    type : 'copy',\n\t\t *    msg : 'Copy files', // not required for known types @see this.notifyType\n\t\t *    cnt : 3,\n\t\t *    hideCnt  : false,   // true for not show count\n\t\t *    progress : 10,      // progress bar percents (use cnt : 0 to update progress bar)\n\t\t *    cancel   : callback // callback function for cancel button\n\t\t * })\n\t\t * @return elFinder\n\t\t */\n\t\tnotify : function(opts) {\n\t\t\tvar self     = this,\n\t\t\t\ttype     = opts.type,\n\t\t\t\tid       = opts.id? 'elfinder-notify-'+opts.id : '',\n\t\t\t\tmsg      = this.i18n((typeof opts.msg !== 'undefined')? opts.msg : (this.messages['ntf'+type] ? 'ntf'+type : 'ntfsmth')),\n\t\t\t\thiddens  = this.arrayFlip(this.options.notifyDialog.hiddens || []),\n\t\t\t\tndialog  = this.ui.notify,\n\t\t\t\tdialog   = ndialog.closest('.ui-dialog'),\n\t\t\t\tnotify   = ndialog.children('.elfinder-notify-'+type+(id? ('.'+id) : '')),\n\t\t\t\tbutton   = notify.children('div.elfinder-notify-cancel').children('button'),\n\t\t\t\tntpl     = '<div class=\"elfinder-notify elfinder-notify-{type}'+(id? (' '+id) : '')+'\"><span class=\"elfinder-dialog-icon elfinder-dialog-icon-{type}\"/><span class=\"elfinder-notify-msg\">{msg}</span> <span class=\"elfinder-notify-cnt\"/><div class=\"elfinder-notify-progressbar\"><div class=\"elfinder-notify-progress\"/></div><div class=\"elfinder-notify-cancel\"/></div>',\n\t\t\t\tdelta    = opts.cnt + 0,\n\t\t\t\tsize     = (typeof opts.size != 'undefined')? parseInt(opts.size) : null,\n\t\t\t\tprogress = (typeof opts.progress != 'undefined' && opts.progress >= 0) ? opts.progress : null,\n\t\t\t\tfakeint  = opts.fakeinterval || 200,\n\t\t\t\tcancel   = opts.cancel,\n\t\t\t\tclhover  = 'ui-state-hover',\n\t\t\t\tclose    = function() {\n\t\t\t\t\tvar prog = notify.find('.elfinder-notify-progress'),\n\t\t\t\t\t\trm = function() {\n\t\t\t\t\t\t\tnotify.remove();\n\t\t\t\t\t\t\tif (!ndialog.children(dialog.data('minimized')? void(0) : ':visible').length) {\n\t\t\t\t\t\t\t\tif (dialog.data('minimized')) {\n\t\t\t\t\t\t\t\t\tdialog.data('minimized').hide();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tndialog.elfinderdialog('close');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetProgressbar();\n\t\t\t\t\t\t};\n\t\t\t\t\tnotify._esc && $(document).off('keydown', notify._esc);\n\t\t\t\t\tif (notify.data('cur') < 100) {\n\t\t\t\t\t\tprog.animate({\n\t\t\t\t\t\t\twidth : '100%'\n\t\t\t\t\t\t}, 50, function() { requestAnimationFrame(function() { rm(); }); });\n\t\t\t\t\t} else {\n\t\t\t\t\t\trm();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfakeUp = function(interval) {\n\t\t\t\t\tvar cur;\n\t\t\t\t\tif (notify.length) {\n\t\t\t\t\t\tcur = notify.data('cur') + 1;\n\t\t\t\t\t\tif (cur <= 98) {\n\t\t\t\t\t\t\tnotify.find('.elfinder-notify-progress').width(cur + '%');\n\t\t\t\t\t\t\tnotify.data('cur', cur);\n\t\t\t\t\t\t\tsetProgressbar();\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tinterval *= 1.05; \n\t\t\t\t\t\t\t\tfakeUp(interval);\n\t\t\t\t\t\t\t}, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetProgressbar = function() {\n\t\t\t\t\tvar cnt = 0,\n\t\t\t\t\t\tval = 0,\n\t\t\t\t\t\tntfs = ndialog.children('.elfinder-notify'),\n\t\t\t\t\t\tw;\n\t\t\t\t\tif (ntfs.length) {\n\t\t\t\t\t\tntfs.each(function() {\n\t\t\t\t\t\t\tcnt++;\n\t\t\t\t\t\t\tval += Math.min($(this).data('cur'), 100);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tw = cnt? Math.floor(val / (cnt * 100) * 100) + '%' : 0;\n\t\t\t\t\t\tself.ui.progressbar.width(w);\n\t\t\t\t\t\tif (dialog.data('minimized')) {\n\t\t\t\t\t\t\tdialog.data('minimized').title(w);\n\t\t\t\t\t\t\tdialog.data('minimized').dialog().children('.ui-dialog-titlebar').children('.elfinder-ui-progressbar').width(w);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.ui.progressbar.width(0);\n\t\t\t\t\t\tdialog.data('minimized') && dialog.data('minimized').hide();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcnt, total, prc;\n\n\t\t\tif (!type) {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\t\n\t\t\tif (!notify.length) {\n\t\t\t\tnotify = $(ntpl.replace(/\\{type\\}/g, type).replace(/\\{msg\\}/g, msg));\n\t\t\t\tif (hiddens[type]) {\n\t\t\t\t\tnotify.hide();\n\t\t\t\t} else {\n\t\t\t\t\tndialog.on('minimize', function(e) {\n\t\t\t\t\t\tdialog.data('minimized') && setProgressbar();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnotify.appendTo(ndialog).data('cnt', 0);\n\n\t\t\t\tif (progress != null) {\n\t\t\t\t\tnotify.data({progress : 0, total : 0, cur : 0});\n\t\t\t\t} else {\n\t\t\t\t\tnotify.data({cur : 0});\n\t\t\t\t\tfakeUp(fakeint);\n\t\t\t\t}\n\n\t\t\t\tif (cancel) {\n\t\t\t\t\tbutton = $('<span class=\"elfinder-notify-button ui-icon ui-icon-close\" title=\"'+this.i18n('btnCancel')+'\"/>')\n\t\t\t\t\t\t.on('mouseenter mouseleave', function(e) { \n\t\t\t\t\t\t\t$(this).toggleClass(clhover, e.type === 'mouseenter');\n\t\t\t\t\t\t});\n\t\t\t\t\tnotify.children('div.elfinder-notify-cancel').append(button);\n\t\t\t\t}\n\t\t\t\tndialog.trigger('resize');\n\t\t\t} else if (typeof opts.msg !== 'undefined') {\n\t\t\t\tnotify.children('span.elfinder-notify-msg').html(msg);\n\t\t\t}\n\n\t\t\tcnt = delta + parseInt(notify.data('cnt'));\n\t\t\t\n\t\t\tif (cnt > 0) {\n\t\t\t\tif (cancel && button.length) {\n\t\t\t\t\tif ($.isFunction(cancel) || (typeof cancel === 'object' && cancel.promise)) {\n\t\t\t\t\t\tnotify._esc = function(e) {\n\t\t\t\t\t\t\tif (e.type == 'keydown' && e.keyCode != $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\tif (cancel.promise) {\n\t\t\t\t\t\t\t\tcancel.reject(0); // 0 is canceling flag\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcancel(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbutton.on('click', function(e) {\n\t\t\t\t\t\t\tnotify._esc(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$(document).on('keydown.' + this.namespace, notify._esc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t!opts.hideCnt && notify.children('.elfinder-notify-cnt').text('('+cnt+')');\n\t\t\t\tif (delta > 0 && ndialog.is(':hidden') && !hiddens[type]) {\n\t\t\t\t\tif (dialog.data('minimized')) {\n\t\t\t\t\t\tdialog.data('minimized').show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tndialog.elfinderdialog('open', this).height('auto');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnotify.data('cnt', cnt);\n\t\t\t\t\n\t\t\t\tif ((progress != null)\n\t\t\t\t&& (total = notify.data('total')) >= 0\n\t\t\t\t&& (prc = notify.data('progress')) >= 0) {\n\n\t\t\t\t\ttotal += size != null? size : delta;\n\t\t\t\t\tprc   += progress;\n\t\t\t\t\t(size == null && delta < 0) && (prc += delta * 100);\n\t\t\t\t\tnotify.data({progress : prc, total : total});\n\t\t\t\t\tif (size != null) {\n\t\t\t\t\t\tprc *= 100;\n\t\t\t\t\t\ttotal = Math.max(1, total);\n\t\t\t\t\t}\n\t\t\t\t\tprogress = Math.min(parseInt(prc/total), 100);\n\t\t\t\t\t\n\t\t\t\t\tnotify.find('.elfinder-notify-progress')\n\t\t\t\t\t\t.animate({\n\t\t\t\t\t\t\twidth : (progress < 100 ? progress : 100)+'%'\n\t\t\t\t\t\t}, 20, function() {\n\t\t\t\t\t\t\tnotify.data('cur', progress);\n\t\t\t\t\t\t\tsetProgressbar();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tclose();\n\t\t\t}\n\t\t\t\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Open confirmation dialog \n\t\t *\n\t\t * @param  Object  options\n\t\t * @example  \n\t\t * this.confirm({\n\t\t *    cssClass : 'elfinder-confirm-mydialog',\n\t\t *    title : 'Remove files',\n\t\t *    text  : 'Here is question text',\n\t\t *    accept : {  // accept callback - required\n\t\t *      label : 'Continue',\n\t\t *      callback : function(applyToAll) { fm.log('Ok') }\n\t\t *    },\n\t\t *    cancel : { // cancel callback - required\n\t\t *      label : 'Cancel',\n\t\t *      callback : function() { fm.log('Cancel')}\n\t\t *    },\n\t\t *    reject : { // reject callback - optionally\n\t\t *      label : 'No',\n\t\t *      callback : function(applyToAll) { fm.log('No')}\n\t\t *    },\n\t\t *    buttons : [ // additional buttons callback - optionally\n\t\t *      {\n\t\t *        label : 'Btn1',\n\t\t *        callback : function(applyToAll) { fm.log('Btn1')}\n\t\t *      }\n\t\t *    ],\n\t\t *    all : true  // display checkbox \"Apply to all\"\n\t\t * })\n\t\t * @return elFinder\n\t\t */\n\t\tconfirm : function(opts) {\n\t\t\tvar self     = this,\n\t\t\t\tcomplete = false,\n\t\t\t\toptions = {\n\t\t\t\t\tcssClass  : 'elfinder-dialog-confirm',\n\t\t\t\t\tmodal     : true,\n\t\t\t\t\tresizable : false,\n\t\t\t\t\ttitle     : this.i18n(opts.title || 'confirmReq'),\n\t\t\t\t\tbuttons   : {},\n\t\t\t\t\tclose     : function() { \n\t\t\t\t\t\t!complete && opts.cancel.callback();\n\t\t\t\t\t\t$(this).elfinderdialog('destroy');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tapply = this.i18n('apllyAll'),\n\t\t\t\tlabel, checkbox, btnNum;\n\n\t\t\tif (opts.cssClass) {\n\t\t\t\toptions.cssClass += ' ' + opts.cssClass;\n\t\t\t}\n\t\t\toptions.buttons[this.i18n(opts.accept.label)] = function() {\n\t\t\t\topts.accept.callback(!!(checkbox && checkbox.prop('checked')));\n\t\t\t\tcomplete = true;\n\t\t\t\t$(this).elfinderdialog('close');\n\t\t\t};\n\t\t\toptions.buttons[this.i18n(opts.accept.label)]._cssClass = 'elfinder-confirm-accept';\n\t\t\t\n\t\t\tif (opts.reject) {\n\t\t\t\toptions.buttons[this.i18n(opts.reject.label)] = function() {\n\t\t\t\t\topts.reject.callback(!!(checkbox && checkbox.prop('checked')));\n\t\t\t\t\tcomplete = true;\n\t\t\t\t\t$(this).elfinderdialog('close');\n\t\t\t\t};\n\t\t\t\toptions.buttons[this.i18n(opts.reject.label)]._cssClass = 'elfinder-confirm-reject';\n\t\t\t}\n\t\t\t\n\t\t\tif (opts.buttons && opts.buttons.length > 0) {\n\t\t\t\tbtnNum = 1;\n\t\t\t\t$.each(opts.buttons, function(i, v){\n\t\t\t\t\toptions.buttons[self.i18n(v.label)] = function() {\n\t\t\t\t\t\tv.callback(!!(checkbox && checkbox.prop('checked')));\n\t\t\t\t\t\tcomplete = true;\n\t\t\t\t\t\t$(this).elfinderdialog('close');\n\t\t\t\t\t};\n\t\t\t\t\toptions.buttons[self.i18n(v.label)]._cssClass = 'elfinder-confirm-extbtn' + (btnNum++);\n\t\t\t\t\tif (v.cssClass) {\n\t\t\t\t\t\toptions.buttons[self.i18n(v.label)]._cssClass += ' ' + v.cssClass;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\toptions.buttons[this.i18n(opts.cancel.label)] = function() {\n\t\t\t\t$(this).elfinderdialog('close');\n\t\t\t};\n\t\t\toptions.buttons[this.i18n(opts.cancel.label)]._cssClass = 'elfinder-confirm-cancel';\n\t\t\t\n\t\t\tif (opts.all) {\n\t\t\t\toptions.create = function() {\n\t\t\t\t\tvar base = $('<div class=\"elfinder-dialog-confirm-applyall\"/>');\n\t\t\t\t\tcheckbox = $('<input type=\"checkbox\" />');\n\t\t\t\t\t$(this).next().find('.ui-dialog-buttonset')\n\t\t\t\t\t\t.prepend(base.append($('<label>'+apply+'</label>').prepend(checkbox)));\n\t\t\t\t};\n\t\t\t}\n\t\t\t\n\t\t\tif (opts.optionsCallback && $.isFunction(opts.optionsCallback)) {\n\t\t\t\topts.optionsCallback(options);\n\t\t\t}\n\t\t\t\n\t\t\treturn this.dialog('<span class=\"elfinder-dialog-icon elfinder-dialog-icon-confirm\"/>' + this.i18n(opts.text), options);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Create unique file name in required dir\n\t\t * \n\t\t * @param  String  file name\n\t\t * @param  String  parent dir hash\n\t\t * @param  String  glue\n\t\t * @return String\n\t\t */\n\t\tuniqueName : function(prefix, phash, glue) {\n\t\t\tvar i = 0, ext = '', p, name;\n\t\t\t\n\t\t\tprefix = this.i18n(false, prefix);\n\t\t\tphash = phash || this.cwd().hash;\n\t\t\tglue = (typeof glue === 'undefined')? ' ' : glue;\n\n\t\t\tif (p = prefix.match(/^(.+)(\\.[^.]+)$/)) {\n\t\t\t\text    = p[2];\n\t\t\t\tprefix = p[1];\n\t\t\t}\n\t\t\t\n\t\t\tname   = prefix+ext;\n\t\t\t\n\t\t\tif (!this.fileByName(name, phash)) {\n\t\t\t\treturn name;\n\t\t\t}\n\t\t\twhile (i < 10000) {\n\t\t\t\tname = prefix + glue + (++i) + ext;\n\t\t\t\tif (!this.fileByName(name, phash)) {\n\t\t\t\t\treturn name;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn prefix + Math.random() + ext;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return message translated onto current language\n\t\t * Allowed accept HTML element that was wrapped in jQuery object\n\t\t * To be careful to XSS vulnerability of HTML element Ex. You should use `fm.escape(file.name)`\n\t\t *\n\t\t * @param  String|Array  message[s]|Object jQuery\n\t\t * @return String\n\t\t **/\n\t\ti18n : function() {\n\t\t\tvar self = this,\n\t\t\t\tmessages = this.messages, \n\t\t\t\tinput    = [],\n\t\t\t\tignore   = [], \n\t\t\t\tmessage = function(m) {\n\t\t\t\t\tvar file;\n\t\t\t\t\tif (m.indexOf('#') === 0) {\n\t\t\t\t\t\tif ((file = self.file(m.substr(1)))) {\n\t\t\t\t\t\t\treturn file.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn m;\n\t\t\t\t},\n\t\t\t\ti, j, m, escFunc, start = 0, isErr;\n\t\t\t\n\t\t\tif (arguments.length && arguments[0] === false) {\n\t\t\t\tescFunc = function(m){ return m; };\n\t\t\t\tstart = 1;\n\t\t\t}\n\t\t\tfor (i = start; i< arguments.length; i++) {\n\t\t\t\tm = arguments[i];\n\t\t\t\t\n\t\t\t\tif (Array.isArray(m)) {\n\t\t\t\t\tfor (j = 0; j < m.length; j++) {\n\t\t\t\t\t\tif (m[j] instanceof jQuery) {\n\t\t\t\t\t\t\t// jQuery object is HTML element\n\t\t\t\t\t\t\tinput.push(m[j]);\n\t\t\t\t\t\t} else if (typeof m[j] !== 'undefined'){\n\t\t\t\t\t\t\tinput.push(message('' + m[j]));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (m instanceof jQuery) {\n\t\t\t\t\t// jQuery object is HTML element\n\t\t\t\t\tinput.push(m[j]);\n\t\t\t\t} else if (typeof m !== 'undefined'){\n\t\t\t\t\tinput.push(message('' + m));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfor (i = 0; i < input.length; i++) {\n\t\t\t\t// dont translate placeholders\n\t\t\t\tif ($.inArray(i, ignore) !== -1) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tm = input[i];\n\t\t\t\tif (typeof m == 'string') {\n\t\t\t\t\tisErr = !!(messages[m] && m.match(/^err/));\n\t\t\t\t\t// translate message\n\t\t\t\t\tm = messages[m] || (escFunc? escFunc(m) : self.escape(m));\n\t\t\t\t\t// replace placeholders in message\n\t\t\t\t\tm = m.replace(/\\$(\\d+)/g, function(match, placeholder) {\n\t\t\t\t\t\tvar res;\n\t\t\t\t\t\tplaceholder = i + parseInt(placeholder);\n\t\t\t\t\t\tif (placeholder > 0 && input[placeholder]) {\n\t\t\t\t\t\t\tignore.push(placeholder);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = escFunc? escFunc(input[placeholder]) : self.escape(input[placeholder]);\n\t\t\t\t\t\tif (isErr) {\n\t\t\t\t\t\t\tres = '<span class=\"elfinder-err-var elfinder-err-var' + placeholder + '\">' + res + '</span>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// get HTML from jQuery object\n\t\t\t\t\tm = m.get(0).outerHTML;\n\t\t\t\t}\n\n\t\t\t\tinput[i] = m;\n\t\t\t}\n\n\t\t\treturn $.grep(input, function(m, i) { return $.inArray(i, ignore) === -1 ? true : false; }).join('<br>');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Get icon style from file.icon\n\t\t * \n\t\t * @param  Object  elFinder file object\n\t\t * @return String|Object\n\t\t */\n\t\tgetIconStyle : function(file, asObject) {\n\t\t\tvar self = this,\n\t\t\t\ttemplate = {\n\t\t\t\t\t'background' : 'url(\\'{url}\\') 0 0 no-repeat',\n\t\t\t\t\t'background-size' : 'contain'\n\t\t\t\t},\n\t\t\t\tstyle = '',\n\t\t\t\tcssObj = {},\n\t\t\t\ti = 0;\n\t\t\tif (file.icon) {\n\t\t\t\tstyle = 'style=\"';\n\t\t\t\t$.each(template, function(k, v) {\n\t\t\t\t\tif (i++ === 0) {\n\t\t\t\t\t\tv = v.replace('{url}', self.escape(file.icon));\n\t\t\t\t\t}\n\t\t\t\t\tif (asObject) {\n\t\t\t\t\t\tcssObj[k] = v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstyle += k+':'+v+';';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstyle += '\"';\n\t\t\t}\n\t\t\treturn asObject? cssObj : style;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Convert mimetype into css classes\n\t\t * \n\t\t * @param  String  file mimetype\n\t\t * @return String\n\t\t */\n\t\tmime2class : function(mimeType) {\n\t\t\tvar prefix = 'elfinder-cwd-icon-',\n\t\t\t\tmime   = mimeType.toLowerCase(),\n\t\t\t\tisText = this.textMimes[mime];\n\t\t\t\n\t\t\tmime = mime.split('/');\n\t\t\tif (isText) {\n\t\t\t\tmime[0] += ' ' + prefix + 'text';\n\t\t\t} else if (mime[1] && mime[1].match(/\\+xml$/)) {\n\t\t\t\tmime[0] += ' ' + prefix + 'xml';\n\t\t\t}\n\t\t\t\n\t\t\treturn prefix + mime[0] + (mime[1] ? ' ' + prefix + mime[1].replace(/(\\.|\\+)/g, '-') : '');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return localized kind of file\n\t\t * \n\t\t * @param  Object|String  file or file mimetype\n\t\t * @return String\n\t\t */\n\t\tmime2kind : function(f) {\n\t\t\tvar isObj = typeof(f) == 'object' ? true : false,\n\t\t\t\tmime  = isObj ? f.mime : f,\n\t\t\t\tkind;\n\t\t\t\n\n\t\t\tif (isObj && f.alias && mime != 'symlink-broken') {\n\t\t\t\tkind = 'Alias';\n\t\t\t} else if (this.kinds[mime]) {\n\t\t\t\tif (isObj && mime === 'directory' && (! f.phash || f.isroot)) {\n\t\t\t\t\tkind = 'Root';\n\t\t\t\t} else {\n\t\t\t\t\tkind = this.kinds[mime];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (! kind) {\n\t\t\t\tif (mime.indexOf('text') === 0) {\n\t\t\t\t\tkind = 'Text';\n\t\t\t\t} else if (mime.indexOf('image') === 0) {\n\t\t\t\t\tkind = 'Image';\n\t\t\t\t} else if (mime.indexOf('audio') === 0) {\n\t\t\t\t\tkind = 'Audio';\n\t\t\t\t} else if (mime.indexOf('video') === 0) {\n\t\t\t\t\tkind = 'Video';\n\t\t\t\t} else if (mime.indexOf('application') === 0) {\n\t\t\t\t\tkind = 'App';\n\t\t\t\t} else {\n\t\t\t\t\tkind = mime;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn this.messages['kind'+kind] ? this.i18n('kind'+kind) : mime;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return boolean Is mime-type text file\n\t\t * \n\t\t * @param  String  mime-type\n\t\t * @return Boolean\n\t\t */\n\t\tmimeIsText : function(mime) {\n\t\t\treturn (this.textMimes[mime.toLowerCase()] || (mime.indexOf('text/') === 0 && mime.substr(5, 3) !== 'rtf') || mime.match(/^application\\/.+\\+xml$/))? true : false;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns a date string formatted according to the given format string\n\t\t * \n\t\t * @param  String  format string\n\t\t * @param  Object  Date object\n\t\t * @return String\n\t\t */\n\t\tdate : function(format, date) {\n\t\t\tvar self = this,\n\t\t\t\toutput, d, dw, m, y, h, g, i, s;\n\t\t\t\n\t\t\tif (! date) {\n\t\t\t\tdate = new Date();\n\t\t\t}\n\t\t\t\n\t\t\th  = date[self.getHours]();\n\t\t\tg  = h > 12 ? h - 12 : h;\n\t\t\ti  = date[self.getMinutes]();\n\t\t\ts  = date[self.getSeconds]();\n\t\t\td  = date[self.getDate]();\n\t\t\tdw = date[self.getDay]();\n\t\t\tm  = date[self.getMonth]() + 1;\n\t\t\ty  = date[self.getFullYear]();\n\t\t\t\n\t\t\toutput = format.replace(/[a-z]/gi, function(val) {\n\t\t\t\tswitch (val) {\n\t\t\t\t\tcase 'd': return d > 9 ? d : '0'+d;\n\t\t\t\t\tcase 'j': return d;\n\t\t\t\t\tcase 'D': return self.i18n(self.i18.daysShort[dw]);\n\t\t\t\t\tcase 'l': return self.i18n(self.i18.days[dw]);\n\t\t\t\t\tcase 'm': return m > 9 ? m : '0'+m;\n\t\t\t\t\tcase 'n': return m;\n\t\t\t\t\tcase 'M': return self.i18n(self.i18.monthsShort[m-1]);\n\t\t\t\t\tcase 'F': return self.i18n(self.i18.months[m-1]);\n\t\t\t\t\tcase 'Y': return y;\n\t\t\t\t\tcase 'y': return (''+y).substr(2);\n\t\t\t\t\tcase 'H': return h > 9 ? h : '0'+h;\n\t\t\t\t\tcase 'G': return h;\n\t\t\t\t\tcase 'g': return g;\n\t\t\t\t\tcase 'h': return g > 9 ? g : '0'+g;\n\t\t\t\t\tcase 'a': return h >= 12 ? 'pm' : 'am';\n\t\t\t\t\tcase 'A': return h >= 12 ? 'PM' : 'AM';\n\t\t\t\t\tcase 'i': return i > 9 ? i : '0'+i;\n\t\t\t\t\tcase 's': return s > 9 ? s : '0'+s;\n\t\t\t\t}\n\t\t\t\treturn val;\n\t\t\t});\n\t\t\t\n\t\t\treturn output;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return localized date\n\t\t * \n\t\t * @param  Object  file object\n\t\t * @return String\n\t\t */\n\t\tformatDate : function(file, t) {\n\t\t\tvar self = this, \n\t\t\t\tts   = t || file.ts, \n\t\t\t\ti18  = self.i18,\n\t\t\t\tdate, format, output, d, dw, m, y, h, g, i, s;\n\n\t\t\tif (self.options.clientFormatDate && ts > 0) {\n\n\t\t\t\tdate = new Date(ts*1000);\n\t\t\t\tformat = ts >= this.yesterday \n\t\t\t\t\t? this.fancyFormat \n\t\t\t\t\t: this.dateFormat;\n\n\t\t\t\toutput = self.date(format, date);\n\t\t\t\t\n\t\t\t\treturn ts >= this.yesterday\n\t\t\t\t\t? output.replace('$1', this.i18n(ts >= this.today ? 'Today' : 'Yesterday'))\n\t\t\t\t\t: output;\n\t\t\t} else if (file.date) {\n\t\t\t\treturn file.date.replace(/([a-z]+)\\s/i, function(a1, a2) { return self.i18n(a2)+' '; });\n\t\t\t}\n\t\t\t\n\t\t\treturn self.i18n('dateUnknown');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return localized number string\n\t\t * \n\t\t * @param  Number\n\t\t * @return String\n\t\t */\n\t\ttoLocaleString : function(num) {\n\t\t\tvar v = new Number(num);\n\t\t\tif (v) {\n\t\t\t\tif (v.toLocaleString) {\n\t\t\t\t\treturn v.toLocaleString();\n\t\t\t\t} else {\n\t\t\t\t\treturn String(num).replace( /(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, '$1,');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn num;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return css class marks file permissions\n\t\t * \n\t\t * @param  Object  file \n\t\t * @return String\n\t\t */\n\t\tperms2class : function(o) {\n\t\t\tvar c = '';\n\t\t\t\n\t\t\tif (!o.read && !o.write) {\n\t\t\t\tc = 'elfinder-na';\n\t\t\t} else if (!o.read) {\n\t\t\t\tc = 'elfinder-wo';\n\t\t\t} else if (!o.write) {\n\t\t\t\tc = 'elfinder-ro';\n\t\t\t}\n\t\t\t\n\t\t\tif (o.type) {\n\t\t\t\tc += ' elfinder-' + this.escape(o.type);\n\t\t\t}\n\t\t\t\n\t\t\treturn c;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return localized string with file permissions\n\t\t * \n\t\t * @param  Object  file\n\t\t * @return String\n\t\t */\n\t\tformatPermissions : function(f) {\n\t\t\tvar p  = [];\n\t\t\t\t\n\t\t\tf.read && p.push(this.i18n('read'));\n\t\t\tf.write && p.push(this.i18n('write'));\t\n\n\t\t\treturn p.length ? p.join(' '+this.i18n('and')+' ') : this.i18n('noaccess');\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return formated file size\n\t\t * \n\t\t * @param  Number  file size\n\t\t * @return String\n\t\t */\n\t\tformatSize : function(s) {\n\t\t\tvar n = 1, u = 'b';\n\t\t\t\n\t\t\tif (s == 'unknown') {\n\t\t\t\treturn this.i18n('unknown');\n\t\t\t}\n\t\t\t\n\t\t\tif (s > 1073741824) {\n\t\t\t\tn = 1073741824;\n\t\t\t\tu = 'GB';\n\t\t\t} else if (s > 1048576) {\n\t\t\t\tn = 1048576;\n\t\t\t\tu = 'MB';\n\t\t\t} else if (s > 1024) {\n\t\t\t\tn = 1024;\n\t\t\t\tu = 'KB';\n\t\t\t}\n\t\t\ts = s/n;\n\t\t\treturn (s > 0 ? n >= 1048576 ? s.toFixed(2) : Math.round(s) : 0) +' '+u;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return formated file mode by options.fileModeStyle\n\t\t * \n\t\t * @param  String  file mode\n\t\t * @param  String  format style\n\t\t * @return String\n\t\t */\n\t\tformatFileMode : function(p, style) {\n\t\t\tvar i, o, s, b, sticy, suid, sgid, str, oct;\n\t\t\t\n\t\t\tif (!style) {\n\t\t\t\tstyle = this.options.fileModeStyle.toLowerCase();\n\t\t\t}\n\t\t\tp = $.trim(p);\n\t\t\tif (p.match(/[rwxs-]{9}$/i)) {\n\t\t\t\tstr = p = p.substr(-9);\n\t\t\t\tif (style == 'string') {\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\t\t\t\toct = '';\n\t\t\t\ts = 0;\n\t\t\t\tfor (i=0; i<7; i=i+3) {\n\t\t\t\t\to = p.substr(i, 3);\n\t\t\t\t\tb = 0;\n\t\t\t\t\tif (o.match(/[r]/i)) {\n\t\t\t\t\t\tb += 4;\n\t\t\t\t\t}\n\t\t\t\t\tif (o.match(/[w]/i)) {\n\t\t\t\t\t\tb += 2;\n\t\t\t\t\t}\n\t\t\t\t\tif (o.match(/[xs]/i)) {\n\t\t\t\t\t\tif (o.match(/[xs]/)) {\n\t\t\t\t\t\t\tb += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (o.match(/[s]/i)) {\n\t\t\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\t\t\ts += 4;\n\t\t\t\t\t\t\t} else if (i == 3) {\n\t\t\t\t\t\t\t\ts += 2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\toct += b.toString(8);\n\t\t\t\t}\n\t\t\t\tif (s) {\n\t\t\t\t\toct = s.toString(8) + oct;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tp = parseInt(p, 8);\n\t\t\t\toct = p? p.toString(8) : '';\n\t\t\t\tif (!p || style == 'octal') {\n\t\t\t\t\treturn oct;\n\t\t\t\t}\n\t\t\t\to = p.toString(8);\n\t\t\t\ts = 0;\n\t\t\t\tif (o.length > 3) {\n\t\t\t\t\to = o.substr(-4);\n\t\t\t\t\ts = parseInt(o.substr(0, 1), 8);\n\t\t\t\t\to = o.substr(1);\n\t\t\t\t}\n\t\t\t\tsticy = ((s & 1) == 1); // not support\n\t\t\t\tsgid = ((s & 2) == 2);\n\t\t\t\tsuid = ((s & 4) == 4);\n\t\t\t\tstr = '';\n\t\t\t\tfor(i=0; i<3; i++) {\n\t\t\t\t\tif ((parseInt(o.substr(i, 1), 8) & 4) == 4) {\n\t\t\t\t\t\tstr += 'r';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstr += '-';\n\t\t\t\t\t}\n\t\t\t\t\tif ((parseInt(o.substr(i, 1), 8) & 2) == 2) {\n\t\t\t\t\t\tstr += 'w';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstr += '-';\n\t\t\t\t\t}\n\t\t\t\t\tif ((parseInt(o.substr(i, 1), 8) & 1) == 1) {\n\t\t\t\t\t\tstr += ((i==0 && suid)||(i==1 && sgid))? 's' : 'x';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstr += '-';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (style == 'both') {\n\t\t\t\treturn str + ' (' + oct + ')';\n\t\t\t} else if (style == 'string') {\n\t\t\t\treturn str;\n\t\t\t} else {\n\t\t\t\treturn oct;\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Regist this.decodeRawString function\n\t\t * \n\t\t * @return void\n\t\t */\n\t\tregistRawStringDecoder : function(rawStringDecoder) {\n\t\t\tif ($.isFunction(rawStringDecoder)) {\n\t\t\t\tthis.decodeRawString = this.options.rawStringDecoder = rawStringDecoder;\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return boolean that uploadable MIME type into target folder\n\t\t * \n\t\t * @param  String  mime    MIME type\n\t\t * @param  String  target  target folder hash\n\t\t * @return Bool\n\t\t */\n\t\tuploadMimeCheck : function(mime, target) {\n\t\t\ttarget = target || this.cwd().hash;\n\t\t\tvar res   = true, // default is allow\n\t\t\t\tmimeChecker = this.option('uploadMime', target),\n\t\t\t\tallow,\n\t\t\t\tdeny,\n\t\t\t\tcheck = function(checker) {\n\t\t\t\t\tvar ret = false;\n\t\t\t\t\tif (typeof checker === 'string' && checker.toLowerCase() === 'all') {\n\t\t\t\t\t\tret = true;\n\t\t\t\t\t} else if (Array.isArray(checker) && checker.length) {\n\t\t\t\t\t\t$.each(checker, function(i, v) {\n\t\t\t\t\t\t\tv = v.toLowerCase();\n\t\t\t\t\t\t\tif (v === 'all' || mime.indexOf(v) === 0) {\n\t\t\t\t\t\t\t\tret = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\t};\n\t\t\tif (mime && $.isPlainObject(mimeChecker)) {\n\t\t\t\tmime = mime.toLowerCase();\n\t\t\t\tallow = check(mimeChecker.allow);\n\t\t\t\tdeny = check(mimeChecker.deny);\n\t\t\t\tif (mimeChecker.firstOrder === 'allow') {\n\t\t\t\t\tres = false; // default is deny\n\t\t\t\t\tif (! deny && allow === true) { // match only allow\n\t\t\t\t\t\tres = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tres = true; // default is allow\n\t\t\t\t\tif (deny === true && ! allow) { // match only deny\n\t\t\t\t\t\tres = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res;\n\t\t},\n\t\t\n\t\t/**\n\t\t * call chained sequence of async deferred functions\n\t\t * \n\t\t * @param  Array   tasks async functions\n\t\t * @return Object  jQuery.Deferred\n\t\t */\n\t\tsequence : function(tasks) {\n\t\t\tvar l = tasks.length,\n\t\t\t\tchain = function(task, idx) {\n\t\t\t\t\t++idx;\n\t\t\t\t\tif (tasks[idx]) {\n\t\t\t\t\t\treturn chain(task.then(tasks[idx]), idx);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn task;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\tif (l > 1) {\n\t\t\t\treturn chain(tasks[0](), 0);\n\t\t\t} else {\n\t\t\t\treturn tasks[0]();\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Reload contents of target URL for clear browser cache\n\t\t * \n\t\t * @param  String  url target URL\n\t\t * @return Object  jQuery.Deferred\n\t\t */\n\t\treloadContents : function(url) {\n\t\t\tvar dfd = $.Deferred(),\n\t\t\t\tifm;\n\t\t\ttry {\n\t\t\t\tifm = $('<iframe width=\"1\" height=\"1\" scrolling=\"no\" frameborder=\"no\" style=\"position:absolute; top:-1px; left:-1px\" crossorigin=\"use-credentials\">')\n\t\t\t\t\t.attr('src', url)\n\t\t\t\t\t.one('load', function() {\n\t\t\t\t\t\tvar ifm = $(this);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.contentDocument.location.reload(true);\n\t\t\t\t\t\t\tifm.one('load', function() {\n\t\t\t\t\t\t\t\tifm.remove();\n\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tifm.attr('src', '').attr('src', url).one('load', function() {\n\t\t\t\t\t\t\t\tifm.remove();\n\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.appendTo('body');\n\t\t\t} catch(e) {\n\t\t\t\tifm && ifm.remove();\n\t\t\t\tdfd.reject();\n\t\t\t}\n\t\t\treturn dfd;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Make netmount option for OAuth2\n\t\t * \n\t\t * @param  String   protocol\n\t\t * @param  String   name\n\t\t * @param  String   host\n\t\t * @param  Object   opts  Default {noOffline: false, root: 'root', pathI18n: 'folderId', folders: true}\n\t\t\t\t}\n\t\t * \n\t\t * @return Object\n\t\t */\n\t\tmakeNetmountOptionOauth : function(protocol, name, host, opt) {\n\t\t\tvar noOffline = typeof opt === 'boolean'? opt : null, // for backward compat\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tnoOffline : false,\n\t\t\t\t\troot      : 'root',\n\t\t\t\t\tpathI18n  : 'folderId',\n\t\t\t\t\tfolders   : true\n\t\t\t\t}, (noOffline === null? (opt || {}) : {noOffline : noOffline})),\n\t\t\t\taddFolders = function(fm, bro, folders) {\n\t\t\t\t\tvar self = this,\n\t\t\t\t\t\tcnt  = Object.keys($.isPlainObject(folders)? folders : {}).length,\n\t\t\t\t\t\tselect;\n\t\t\t\t\t\n\t\t\t\t\tbro.next().remove();\n\t\t\t\t\tif (cnt) {\n\t\t\t\t\t\tselect = $('<select class=\"ui-corner-all elfinder-tabstop\" style=\"max-width:200px;\">').append(\n\t\t\t\t\t\t\t$($.map(folders, function(n,i){return '<option value=\"'+fm.escape((i+'').trim())+'\">'+fm.escape(n)+'</option>';}).join(''))\n\t\t\t\t\t\t).on('change click', function(e){\n\t\t\t\t\t\t\tvar node = $(this),\n\t\t\t\t\t\t\t\tpath = node.val(),\n\t\t\t\t\t\t\t\tspn;\n\t\t\t\t\t\t\tself.inputs.path.val(path);\n\t\t\t\t\t\t\tif (opts.folders && (e.type === 'change' || node.data('current') !== path)) {\n\t\t\t\t\t\t\t\tnode.next().remove();\n\t\t\t\t\t\t\t\tnode.data('current', path);\n\t\t\t\t\t\t\t\tif (path != opts.root) {\n\t\t\t\t\t\t\t\t\tspn = spinner();\n\t\t\t\t\t\t\t\t\tif (xhr && xhr.state() === 'pending') {\n\t\t\t\t\t\t\t\t\t\tfm.abortXHR(xhr, { quiet: true , abort: true });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tnode.after(spn);\n\t\t\t\t\t\t\t\t\txhr = fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'netmount', protocol: protocol, host: host, user: 'init', path: path, pass: 'folders'},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t}).done(function(data){\n\t\t\t\t\t\t\t\t\t\taddFolders.call(self, fm, node, data.folders);\n\t\t\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\t\t\tfm.abortXHR(xhr, { quiet: true });\n\t\t\t\t\t\t\t\t\t\tspn.remove();\n\t\t\t\t\t\t\t\t\t}).xhr;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbro.after($('<div/>').append(select))\n\t\t\t\t\t\t\t.closest('.ui-dialog').trigger('tabstopsInit');\n\t\t\t\t\t\tselect.trigger('focus');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tspinner = function() {\n\t\t\t\t\treturn $('<div class=\"elfinder-netmount-spinner\"/>').append('<span class=\"elfinder-spinner\"/>');\n\t\t\t\t},\n\t\t\t\txhr;\n\t\t\treturn {\n\t\t\t\tvars : {},\n\t\t\t\tname : name,\n\t\t\t\tinputs: {\n\t\t\t\t\toffline  : $('<input type=\"checkbox\"/>').on('change', function() {\n\t\t\t\t\t\t$(this).parents('table.elfinder-netmount-tb').find('select:first').trigger('change', 'reset');\n\t\t\t\t\t}),\n\t\t\t\t\thost     : $('<span><span class=\"elfinder-spinner\"/></span><input type=\"hidden\"/>'),\n\t\t\t\t\tpath     : $('<input type=\"text\" value=\"'+opts.root+'\"/>'),\n\t\t\t\t\tuser     : $('<input type=\"hidden\"/>'),\n\t\t\t\t\tpass     : $('<input type=\"hidden\"/>'),\n\t\t\t\t\tmnt2res  : $('<input type=\"hidden\"/>')\n\t\t\t\t},\n\t\t\t\tselect: function(fm, ev, d){\n\t\t\t\t\tvar f = this.inputs,\n\t\t\t\t\t\toline = f.offline,\n\t\t\t\t\t\tf0 = $(f.host[0]),\n\t\t\t\t\t\tdata = d || null;\n\t\t\t\t\tthis.vars.mbtn = f.host.closest('.ui-dialog').children('.ui-dialog-buttonpane:first').find('button.elfinder-btncnt-0');\n\t\t\t\t\tif (! f0.data('inrequest')\n\t\t\t\t\t\t\t&& (f0.find('span.elfinder-spinner').length\n\t\t\t\t\t\t\t\t|| data === 'reset'\n\t\t\t\t\t\t\t\t|| (data === 'winfocus' && ! f0.siblings('span.elfinder-button-icon-reload').length))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (oline.parent().children().length === 1) {\n\t\t\t\t\t\t\tf.path.parent().prev().html(fm.i18n(opts.pathI18n));\n\t\t\t\t\t\t\toline.attr('title', fm.i18n('offlineAccess'));\n\t\t\t\t\t\t\toline.uniqueId().after($('<label/>').attr('for', oline.attr('id')).html(' '+fm.i18n('offlineAccess')));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf0.data('inrequest', true).empty().addClass('elfinder-spinner')\n\t\t\t\t\t\t\t.parent().find('span.elfinder-button-icon').remove();\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'netmount', protocol: protocol, host: host, user: 'init', options: {id: fm.id, offline: oline.prop('checked')? 1:0, pass: f.host[1].value}},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t}).done(function(data){\n\t\t\t\t\t\t\tf0.removeClass(\"elfinder-spinner\").html(data.body.replace(/\\{msg:([^}]+)\\}/g, function(whole,s1){return fm.i18n(s1, host);}));\n\t\t\t\t\t\t});\n\t\t\t\t\t\topts.noOffline && oline.closest('tr').hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\toline.closest('tr')[(opts.noOffline || f.user.val())? 'hide':'show']();\n\t\t\t\t\t\tf0.data('funcexpup') && f0.data('funcexpup')();\n\t\t\t\t\t}\n\t\t\t\t\tthis.vars.mbtn[$(f.host[1]).val()? 'show':'hide']();\n\t\t\t\t},\n\t\t\t\tdone: function(fm, data){\n\t\t\t\t\tvar f = this.inputs,\n\t\t\t\t\t\tp = this.protocol,\n\t\t\t\t\t\tf0 = $(f.host[0]),\n\t\t\t\t\t\tf1 = $(f.host[1]),\n\t\t\t\t\t\texpires = '&nbsp;',\n\t\t\t\t\t\tvars = this.vars,\n\t\t\t\t\t\tchk = function() {\n\t\t\t\t\t\t\tif (vars.oauthW && !document.hasFocus() && --vars.chkCnt) {\n\t\t\t\t\t\t\t\tp.trigger('change', 'winfocus');\n\t\t\t\t\t\t\t\tvars.tm = setTimeout(chk, 3000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbtn;\n\t\t\t\t\t\n\t\t\t\t\topts.noOffline && f.offline.closest('tr').hide();\n\t\t\t\t\tif (data.mode == 'makebtn') {\n\t\t\t\t\t\tf0.removeClass('elfinder-spinner').removeData('expires').removeData('funcexpup');\n\t\t\t\t\t\tbtn = f.host.find('input').on('mouseenter mouseleave', function(){$(this).toggleClass('ui-state-hover');});\n\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\tbtn.on('click', function() {\n\t\t\t\t\t\t\t\tvars.tm && clearTimeout(vars.tm);\n\t\t\t\t\t\t\t\tvars.oauthW = window.open(data.url);\n\t\t\t\t\t\t\t\t// To correspond to safari, authentication tab sometimes not closing in CORS environment.\n\t\t\t\t\t\t\t\t// This may be a safari bug and may improve in the future.\n\t\t\t\t\t\t\t\tif ((fm.UA.iOS || fm.UA.Mac) && fm.isCORS && !vars.chkdone) {\n\t\t\t\t\t\t\t\t\tvars.chkCnt = 60;\n\t\t\t\t\t\t\t\t\tvars.tm = setTimeout(chk, 5000);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf1.val('');\n\t\t\t\t\t\tf.path.val(opts.root).next().remove();\n\t\t\t\t\t\tf.user.val('');\n\t\t\t\t\t\tf.pass.val('');\n\t\t\t\t\t\t! opts.noOffline && f.offline.closest('tr').show();\n\t\t\t\t\t\tvars.mbtn.hide();\n\t\t\t\t\t} else if (data.mode == 'folders') {\n\t\t\t\t\t\tif (data.folders) {\n\t\t\t\t\t\t\taddFolders.call(this, fm, f.path.nextAll(':last'), data.folders);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (vars.oauthW) {\n\t\t\t\t\t\t\tvars.tm && clearTimeout(vars.tm);\n\t\t\t\t\t\t\tvars.oauthW.close();\n\t\t\t\t\t\t\tdelete vars.oauthW;\n\t\t\t\t\t\t\t// The problem that Safari's authentication tab doesn't close only affects the first time.\n\t\t\t\t\t\t\tvars.chkdone = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.expires) {\n\t\t\t\t\t\t\texpires = '()';\n\t\t\t\t\t\t\tf0.data('expires', data.expires);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf0.html(host + expires).removeClass('elfinder-spinner');\n\t\t\t\t\t\tif (data.expires) {\n\t\t\t\t\t\t\tf0.data('funcexpup', function() {\n\t\t\t\t\t\t\t\tvar rem = Math.floor((f0.data('expires') - (+new Date()) / 1000) / 60);\n\t\t\t\t\t\t\t\tif (rem < 3) {\n\t\t\t\t\t\t\t\t\tf0.parent().children('.elfinder-button-icon-reload').click();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tf0.text(f0.text().replace(/\\(.*\\)/, '('+fm.i18n(['minsLeft', rem])+')'));\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tif (f0.is(':visible')) {\n\t\t\t\t\t\t\t\t\t\t\tf0.data('funcexpup')();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, 60000);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tf0.data('funcexpup')();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.reset) {\n\t\t\t\t\t\t\tp.trigger('change', 'reset');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf0.parent().append($('<span class=\"elfinder-button-icon elfinder-button-icon-reload\" title=\"'+fm.i18n('reAuth')+'\">')\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tf1.val('reauth');\n\t\t\t\t\t\t\t\tp.trigger('change', 'reset');\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\tf1.val(protocol);\n\t\t\t\t\t\tvars.mbtn.show();\n\t\t\t\t\t\tif (data.folders) {\n\t\t\t\t\t\t\taddFolders.call(this, fm, f.path, data.folders);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.mnt2res) {\n\t\t\t\t\t\t\tf.mnt2res.val('1');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf.user.val('done');\n\t\t\t\t\t\tf.pass.val('done');\n\t\t\t\t\t\tf.offline.closest('tr').hide();\n\t\t\t\t\t}\n\t\t\t\t\tf0.removeData('inrequest');\n\t\t\t\t},\n\t\t\t\tfail: function(fm, err){\n\t\t\t\t\t$(this.inputs.host[0]).removeData('inrequest');\n\t\t\t\t\tthis.protocol.trigger('change', 'reset');\n\t\t\t\t},\n\t\t\t\tintegrateInfo: opts.integrate\n\t\t\t};\n\t\t},\n\t\t\n\t\t/**\n\t\t * Find cwd's nodes from files\n\t\t * \n\t\t * @param  Array    files\n\t\t * @param  Object   opts   {firstOnly: true|false}\n\t\t */\n\t\tfindCwdNodes : function(files, opts) {\n\t\t\tvar self    = this,\n\t\t\t\tcwd     = this.getUI('cwd'),\n\t\t\t\tcwdHash = this.cwd().hash,\n\t\t\t\tnewItem = $();\n\t\t\t\n\t\t\topts = opts || {};\n\t\t\t\n\t\t\t$.each(files, function(i, f) {\n\t\t\t\tif (f.phash === cwdHash || self.searchStatus.state > 1) {\n\t\t\t\t\tnewItem = newItem.add(self.cwdHash2Elm(f.hash));\n\t\t\t\t\tif (opts.firstOnly) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn newItem;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Convert from relative URL to abstract URL based on current URL\n\t\t * \n\t\t * @param  String  URL\n\t\t * @return String\n\t\t */\n\t\tconvAbsUrl : function(url) {\n\t\t\tif (url.match(/^http/i)) {\n\t\t\t\treturn url;\n\t\t\t}\n\t\t\tif (url.substr(0,2) === '//') {\n\t\t\t\treturn window.location.protocol + url;\n\t\t\t}\n\t\t\tvar root = window.location.protocol + '//' + window.location.host,\n\t\t\t\treg  = /[^\\/]+\\/\\.\\.\\//,\n\t\t\t\tret;\n\t\t\tif (url.substr(0, 1) === '/') {\n\t\t\t\tret = root + url;\n\t\t\t} else {\n\t\t\t\tret = root + window.location.pathname.replace(/\\/[^\\/]+$/, '/') + url;\n\t\t\t}\n\t\t\tret = ret.replace('/./', '/');\n\t\t\twhile(reg.test(ret)) {\n\t\t\t\tret = ret.replace(reg, '');\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Is same origin to current site\n\t\t * \n\t\t * @param  String  check url\n\t\t * @return Boolean\n\t\t */\n\t\tisSameOrigin : function (checkUrl) {\n\t\t\tvar url;\n\t\t\tcheckUrl = this.convAbsUrl(checkUrl);\n\t\t\tif (location.origin && window.URL) {\n\t\t\t\ttry {\n\t\t\t\t\turl = new URL(checkUrl);\n\t\t\t\t\treturn location.origin === url.origin;\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t\turl = document.createElement('a');\n\t\t\turl.href = checkUrl;\n\t\t\treturn location.protocol === url.protocol && location.host === url.host && location.port && url.port;\n\t\t},\n\t\t\n\t\tnavHash2Id : function(hash) {\n\t\t\treturn this.navPrefix + hash;\n\t\t},\n\t\t\n\t\tnavId2Hash : function(id) {\n\t\t\treturn typeof(id) == 'string' ? id.substr(this.navPrefix.length) : false;\n\t\t},\n\t\t\n\t\tcwdHash2Id : function(hash) {\n\t\t\treturn this.cwdPrefix + hash;\n\t\t},\n\t\t\n\t\tcwdId2Hash : function(id) {\n\t\t\treturn typeof(id) == 'string' ? id.substr(this.cwdPrefix.length) : false;\n\t\t},\n\t\t\n\t\t/**\n\t\t * navHash to jQuery element object\n\t\t *\n\t\t * @param      String  hash    nav hash\n\t\t * @return     Object  jQuery element object\n\t\t */\n\t\tnavHash2Elm : function(hash) {\n\t\t\treturn $(document.getElementById(this.navHash2Id(hash)));\n\t\t},\n\n\t\t/**\n\t\t * cwdHash to jQuery element object\n\t\t *\n\t\t * @param      String  hash    cwd hash\n\t\t * @return     Object  jQuery element object\n\t\t */\n\t\tcwdHash2Elm : function(hash) {\n\t\t\treturn $(document.getElementById(this.cwdHash2Id(hash)));\n\t\t},\n\n\t\tisInWindow : function(elem, nochkHide) {\n\t\t\tvar elm, rect;\n\t\t\tif (! (elm = elem.get(0))) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (! nochkHide && elm.offsetParent === null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trect = elm.getBoundingClientRect();\n\t\t\treturn document.elementFromPoint(rect.left, rect.top)? true : false;\n\t\t},\n\t\t\n\t\t/**\n\t\t * calculate elFinder node z-index\n\t\t * \n\t\t * @return void\n\t\t */\n\t\tzIndexCalc : function() {\n\t\t\tvar self = this,\n\t\t\t\tnode = this.getUI(),\n\t\t\t\tni = node.css('z-index');\n\t\t\tif (ni && ni !== 'auto' && ni !== 'inherit') {\n\t\t\t\tself.zIndex = ni;\n\t\t\t} else {\n\t\t\t\tnode.parents().each(function(i, n) {\n\t\t\t\t\tvar z = $(n).css('z-index');\n\t\t\t\t\tif (z !== 'auto' && z !== 'inherit' && (z = parseInt(z))) {\n\t\t\t\t\t\tself.zIndex = z;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Load JavaScript files\n\t\t * \n\t\t * @param  Array    urls      to load JavaScript file URLs\n\t\t * @param  Function callback  call back function on script loaded\n\t\t * @param  Object   opts      Additional options to $.ajax OR {loadType: 'tag'} to load by script tag\n\t\t * @param  Object   check     { obj: (Object)ParentObject, name: (String)\"Attribute name\", timeout: (Integer)milliseconds }\n\t\t * @return elFinder\n\t\t */\n\t\tloadScript : function(urls, callback, opts, check) {\n\t\t\tvar defOpts = {\n\t\t\t\t\tdataType : 'script',\n\t\t\t\t\tcache    : true\n\t\t\t\t},\n\t\t\t\tsuccess, cnt, scripts = {}, results = {};\n\t\t\t\n\t\t\topts = opts || {};\n\t\t\tif (opts.tryRequire && this.hasRequire) {\n\t\t\t\trequire(urls, callback, opts.error);\n\t\t\t} else {\n\t\t\t\tsuccess = function() {\n\t\t\t\t\tvar cnt, fi, hasError;\n\t\t\t\t\t$.each(results, function(i, status) {\n\t\t\t\t\t\tif (status !== 'success' && status !== 'notmodified') {\n\t\t\t\t\t\t\thasError = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (!hasError) {\n\t\t\t\t\t\tif ($.isFunction(callback)) {\n\t\t\t\t\t\t\tif (check) {\n\t\t\t\t\t\t\t\tif (typeof check.obj[check.name] === 'undefined') {\n\t\t\t\t\t\t\t\t\tcnt = check.timeout? (check.timeout / 10) : 1;\n\t\t\t\t\t\t\t\t\tfi = setInterval(function() {\n\t\t\t\t\t\t\t\t\t\tif (--cnt < 0 || typeof check.obj[check.name] !== 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\tclearInterval(fi);\n\t\t\t\t\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, 10);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (opts.error && $.isFunction(opts.error)) {\n\t\t\t\t\t\t\topts.error({ loadResults: results });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (opts.loadType === 'tag') {\n\t\t\t\t\t$('head > script').each(function() {\n\t\t\t\t\t\tscripts[this.src] = this;\n\t\t\t\t\t});\n\t\t\t\t\tcnt = urls.length;\n\t\t\t\t\t$.each(urls, function(i, url) {\n\t\t\t\t\t\tvar done = false,\n\t\t\t\t\t\t\tscript;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (scripts[url]) {\n\t\t\t\t\t\t\tresults[i] = scripts[url]._error || 'success';\n\t\t\t\t\t\t\t(--cnt < 1) && success();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tscript = document.createElement('script');\n\t\t\t\t\t\t\tscript.charset = opts.charset || 'UTF-8';\n\t\t\t\t\t\t\t$('head').append(script);\n\t\t\t\t\t\t\tscript.onload = script.onreadystatechange = function() {\n\t\t\t\t\t\t\t\tif ( !done && (!this.readyState ||\n\t\t\t\t\t\t\t\t\t\tthis.readyState === 'loaded' || this.readyState === 'complete') ) {\n\t\t\t\t\t\t\t\t\tdone = true;\n\t\t\t\t\t\t\t\t\tresults[i] = 'success';\n\t\t\t\t\t\t\t\t\t(--cnt < 1) && success();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tscript.onerror = function(err) {\n\t\t\t\t\t\t\t\tresults[i] = script._error = (err && err.type)? err.type : 'error';\n\t\t\t\t\t\t\t\t(--cnt < 1) && success();\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tscript.src = url;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\topts = $.isPlainObject(opts)? Object.assign(defOpts, opts) : defOpts;\n\t\t\t\t\tcnt = 0;\n\t\t\t\t\t(function appendScript(d, status) {\n\t\t\t\t\t\tif (d !== void(0)) {\n\t\t\t\t\t\t\tresults[cnt++] = status;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (urls.length) {\n\t\t\t\t\t\t\t$.ajax(Object.assign({}, opts, {\n\t\t\t\t\t\t\t\turl: urls.shift(),\n\t\t\t\t\t\t\t\tsuccess: appendScript,\n\t\t\t\t\t\t\t\terror: appendScript\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsuccess();\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Load CSS files\n\t\t * \n\t\t * @param  Array    to load CSS file URLs\n\t\t * @param  Object   options\n\t\t * @return elFinder\n\t\t */\n\t\tloadCss : function(urls, opts) {\n\t\t\tvar self = this,\n\t\t\t\tclName, dfds;\n\t\t\tif (typeof urls === 'string') {\n\t\t\t\turls = [ urls ];\n\t\t\t}\n\t\t\tif (opts) {\n\t\t\t\tif (opts.className) {\n\t\t\t\t\tclName = opts.className;\n\t\t\t\t}\n\t\t\t\tif (opts.dfd && opts.dfd.promise) {\n\t\t\t\t\tdfds = [];\n\t\t\t\t}\n\t\t\t}\n\t\t\t$.each(urls, function(i, url) {\n\t\t\t\tvar link, df;\n\t\t\t\turl = self.convAbsUrl(url).replace(/^https?:/i, '');\n\t\t\t\tif (dfds) {\n\t\t\t\t\tdfds[i] = $.Deferred();\n\t\t\t\t}\n\t\t\t\tif (! $('head > link[href=\"' + self.escape(url) + '\"]').length) {\n\t\t\t\t\tlink = document.createElement('link');\n\t\t\t\t\tlink.type = 'text/css';\n\t\t\t\t\tlink.rel = 'stylesheet';\n\t\t\t\t\tlink.href = url;\n\t\t\t\t\tif (clName) {\n\t\t\t\t\t\tlink.className = clName;\n\t\t\t\t\t}\n\t\t\t\t\tif (dfds) {\n\t\t\t\t\t\tlink.onload = function() {\n\t\t\t\t\t\t\tdfds[i].resolve();\n\t\t\t\t\t\t};\n\t\t\t\t\t\tlink.onerror = function() {\n\t\t\t\t\t\t\tdfds[i].reject();\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\t$('head').append(link);\n\t\t\t\t} else {\n\t\t\t\t\tdfds && dfds[i].resolve();\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (dfds) {\n\t\t\t\t$.when.apply(null, dfds).done(function() {\n\t\t\t\t\topts.dfd.resolve();\n\t\t\t\t}).fail(function() {\n\t\t\t\t\topts.dfd.reject();\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Abortable async job performer\n\t\t * \n\t\t * @param func Function\n\t\t * @param arr  Array\n\t\t * @param opts Object\n\t\t * \n\t\t * @return Object $.Deferred that has an extended method _abort()\n\t\t */\n\t\tasyncJob : function(func, arr, opts) {\n\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\tabortFlg = false,\n\t\t\t\tparms = Object.assign({\n\t\t\t\t\tinterval : 0,\n\t\t\t\t\tnumPerOnce : 1\n\t\t\t\t}, opts || {}),\n\t\t\t\tresArr = [],\n\t\t\t\tvars =[],\n\t\t\t\tcurVars = [],\n\t\t\t\texec,\n\t\t\t\ttm;\n\t\t\t\n\t\t\tdfrd._abort = function(resolve) {\n\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\tvars = [];\n\t\t\t\tabortFlg = true;\n\t\t\t\tif (dfrd.state() === 'pending') {\n\t\t\t\t\tdfrd[resolve? 'resolve' : 'reject'](resArr);\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tdfrd.fail(function() {\n\t\t\t\tdfrd._abort();\n\t\t\t}).always(function() {\n\t\t\t\tdfrd._abort = function() {};\n\t\t\t});\n\n\t\t\tif (typeof func === 'function' && Array.isArray(arr)) {\n\t\t\t\tvars = arr.concat();\n\t\t\t\texec = function() {\n\t\t\t\t\tvar i, len, res;\n\t\t\t\t\tif (abortFlg) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tcurVars = vars.splice(0, parms.numPerOnce);\n\t\t\t\t\tlen = curVars.length;\n\t\t\t\t\tfor (i = 0; i < len; i++) {\n\t\t\t\t\t\tif (abortFlg) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = func(curVars[i]);\n\t\t\t\t\t\t(res !== null) && resArr.push(res);\n\t\t\t\t\t}\n\t\t\t\t\tif (abortFlg) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (vars.length) {\n\t\t\t\t\t\ttm = setTimeout(exec, parms.interval);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfrd.resolve(resArr);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (vars.length) {\n\t\t\t\t\ttm = setTimeout(exec, 0);\n\t\t\t\t} else {\n\t\t\t\t\tdfrd.resolve(resArr);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdfrd.reject();\n\t\t\t}\n\t\t\treturn dfrd;\n\t\t},\n\t\t\n\t\tgetSize : function(targets) {\n\t\t\tvar self = this,\n\t\t\t\treqs = [],\n\t\t\t\ttgtlen = targets.length,\n\t\t\t\tdfrd = $.Deferred().fail(function() {\n\t\t\t\t\t$.each(reqs, function(i, req) {\n\t\t\t\t\t\tif (req) {\n\t\t\t\t\t\t\treq.syncOnFail && req.syncOnFail(false);\n\t\t\t\t\t\t\treq.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t\tgetLeafRoots = function(file) {\n\t\t\t\t\tvar targets = [];\n\t\t\t\t\tif (file.mime === 'directory') {\n\t\t\t\t\t\t$.each(self.leafRoots, function(hash, roots) {\n\t\t\t\t\t\t\tvar phash;\n\t\t\t\t\t\t\tif (hash === file.hash) {\n\t\t\t\t\t\t\t\ttargets.push.apply(targets, roots);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tphash = (self.file(hash) || {}).phash;\n\t\t\t\t\t\t\t\twhile(phash) {\n\t\t\t\t\t\t\t\t\tif (phash === file.hash) {\n\t\t\t\t\t\t\t\t\t\ttargets.push.apply(targets, roots);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tphash = (self.file(phash) || {}).phash;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn targets;\n\t\t\t\t},\n\t\t\t\tcheckPhash = function(hash) {\n\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\tdir = self.file(hash),\n\t\t\t\t\t\ttarget = dir? dir.phash : hash;\n\t\t\t\t\tif (target && ! self.file(target)) {\n\t\t\t\t\t\tself.request({\n\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\tcmd    : 'parents',\n\t\t\t\t\t\t\t\ttarget : target\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t}).done(function() {\n\t\t\t\t\t\t\tself.one('parentsdone', function() {\n\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn dfd;\n\t\t\t\t},\n\t\t\t\tcache = function() {\n\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\tcnt = Object.keys(self.leafRoots).length;\n\t\t\t\t\t\n\t\t\t\t\tif (cnt > 0) {\n\t\t\t\t\t\t$.each(self.leafRoots, function(hash) {\n\t\t\t\t\t\t\tcheckPhash(hash).done(function() {\n\t\t\t\t\t\t\t\t--cnt;\n\t\t\t\t\t\t\t\tif (cnt < 1) {\n\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}\n\t\t\t\t\treturn dfd;\n\t\t\t\t};\n\n\t\t\tself.autoSync('stop');\n\t\t\tcache().done(function() {\n\t\t\t\tvar files = [], grps = {}, dfds = [], cache = [], singles = {};\n\t\t\t\t\n\t\t\t\t$.each(targets, function() {\n\t\t\t\t\tfiles.push.apply(files, getLeafRoots(self.file(this)));\n\t\t\t\t});\n\t\t\t\ttargets.push.apply(targets, files);\n\t\t\t\t\n\t\t\t\t$.each(targets, function() {\n\t\t\t\t\tvar root = self.root(this),\n\t\t\t\t\t\tfile = self.file(this);\n\t\t\t\t\tif (file && (file.sizeInfo || file.mime !== 'directory')) {\n\t\t\t\t\t\tcache.push($.Deferred().resolve(file.sizeInfo? file.sizeInfo : {size: file.size, dirCnt: 0, fileCnt : 1}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (! grps[root]) {\n\t\t\t\t\t\t\tgrps[root] = [ this.toString() ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgrps[root].push(this.toString());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t$.each(grps, function() {\n\t\t\t\t\tvar idx = dfds.length;\n\t\t\t\t\tif (this.length === 1) {\n\t\t\t\t\t\tsingles[idx] = this[0];\n\t\t\t\t\t}\n\t\t\t\t\tdfds.push(self.request({\n\t\t\t\t\t\tdata : {cmd : 'size', targets : this},\n\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t\treqs.push.apply(reqs, dfds);\n\t\t\t\tdfds.push.apply(dfds, cache);\n\t\t\t\t\n\t\t\t\t$.when.apply($, dfds).fail(function() {\n\t\t\t\t\tdfrd.reject();\n\t\t\t\t}).done(function() {\n\t\t\t\t\tvar cache = function(h, data) {\n\t\t\t\t\t\t\tvar file;\n\t\t\t\t\t\t\tif (file = self.file(h)) {\n\t\t\t\t\t\t\t\tfile.sizeInfo = { isCache: true };\n\t\t\t\t\t\t\t\t$.each(['size', 'dirCnt', 'fileCnt'], function() {\n\t\t\t\t\t\t\t\t\tfile.sizeInfo[this] = data[this] || 0;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tfile.size = parseInt(file.sizeInfo.size);\n\t\t\t\t\t\t\t\tchanged.push(file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsize = 0,\n\t\t\t\t\t\tfileCnt = 0,\n\t\t\t\t\t\tdirCnt = 0,\n\t\t\t\t\t\targLen = arguments.length,\n\t\t\t\t\t\tcnts = [],\n\t\t\t\t\t\tcntsTxt = '',\n\t\t\t\t\t\tchanged = [],\n\t\t\t\t\t\ti, file, data;\n\t\t\t\t\t\n\t\t\t\t\tfor (i = 0; i < argLen; i++) {\n\t\t\t\t\t\tdata = arguments[i];\n\t\t\t\t\t\tfile = null;\n\t\t\t\t\t\tif (!data.isCache) {\n\t\t\t\t\t\t\tif (singles[i] && (file = self.file(singles[i]))) {\n\t\t\t\t\t\t\t\tcache(singles[i], data);\n\t\t\t\t\t\t\t} else if (data.sizes && $.isPlainObject(data.sizes)) {\n\t\t\t\t\t\t\t\t$.each(data.sizes, function(h, sizeInfo) {\n\t\t\t\t\t\t\t\t\tcache(h, sizeInfo);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsize += parseInt(data.size);\n\t\t\t\t\t\tif (fileCnt !== false) {\n\t\t\t\t\t\t\tif (typeof data.fileCnt === 'undefined') {\n\t\t\t\t\t\t\t\tfileCnt = false;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfileCnt += parseInt(data.fileCnt || 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dirCnt !== false) {\n\t\t\t\t\t\t\tif (typeof data.dirCnt === 'undefined') {\n\t\t\t\t\t\t\t\tdirCnt = false;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdirCnt += parseInt(data.dirCnt || 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tchanged.length && self.change({changed: changed});\n\t\t\t\t\t\n\t\t\t\t\tif (dirCnt !== false){\n\t\t\t\t\t\tcnts.push(self.i18n('folders') + ': ' + (dirCnt - (tgtlen > 1? 0 : 1)));\n\t\t\t\t\t}\n\t\t\t\t\tif (fileCnt !== false){\n\t\t\t\t\t\tcnts.push(self.i18n('files') + ': ' + fileCnt);\n\t\t\t\t\t}\n\t\t\t\t\tif (cnts.length) {\n\t\t\t\t\t\tcntsTxt = '<br>' + cnts.join(', ');\n\t\t\t\t\t}\n\t\t\t\t\tdfrd.resolve({\n\t\t\t\t\t\tsize: size,\n\t\t\t\t\t\tfileCnt: fileCnt,\n\t\t\t\t\t\tdirCnt: dirCnt,\n\t\t\t\t\t\tformated: (size >= 0 ? self.formatSize(size) : self.i18n('unknown')) + cntsTxt\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.autoSync();\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t},\n\n\t\t/**\n\t\t * Worker Object URL for Blob URL of getWorker()\n\t\t */\n\t\twkObjUrl : null,\n\n\t\t/**\n\t\t * Gets the web worker.\n\t\t *\n\t\t * @param      {Object}  options  The options\n\t\t * @return     {Worker}  The worker.\n\t\t */\n\t\tgetWorker : function(options){\n\t\t\t// for to make blob URL\n\t\t\tfunction woker() {\n\t\t\t\tself.onmessage = function(e) {\n\t\t\t\t\tvar d = e.data;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.data = d.data;\n\t\t\t\t\t\tif (d.scripts) {\n\t\t\t\t\t\t\tfor(var i = 0; i < d.scripts.length; i++) {\n\t\t\t\t\t\t\t\timportScripts(d.scripts[i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.postMessage(self.res);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself.postMessage({error: e.toString()});\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\t// get woker\n\t\t\tvar wk;\n\t\t\ttry {\n\t\t\t\tif (!this.wkObjUrl) {\n\t\t\t\t\tthis.wkObjUrl = (window.URL || window.webkitURL).createObjectURL(new Blob(\n\t\t\t\t\t\t[woker.toString().replace(/\\s+/g, ' ').replace(/ *([^\\w]) */g, '$1').replace(/^function\\b.+?\\{|\\}$/g, '')],\n\t\t\t\t\t\t{ type:'text/javascript' }\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t\twk = new Worker(this.wkObjUrl, options);\n\t\t\t} catch(e) {\n\t\t\t\tthis.debug('error', e.toString());\n\t\t\t}\n\t\t\treturn wk;\n\t\t},\n\n\t\t/**\n\t\t * Get worker absolute URL by filename\n\t\t *\n\t\t * @param      {string}  filename  The filename\n\t\t * @return     {<type>}  The worker url.\n\t\t */\n\t\tgetWorkerUrl : function(filename) {\n\t\t\treturn this.convAbsUrl(this.baseUrl + 'js/worker/' + filename);\n\t\t},\n\n\t\t/**\n\t\t * Gets the theme object by settings of options.themes\n\t\t *\n\t\t * @param  String  themeid  The themeid\n\t\t * @return Object  jQuery.Deferred\n\t\t */\n\t\tgetTheme : function(themeid) {\n\t\t\tvar self = this,\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\tabsUrl = function(url, base) {\n\t\t\t\t\tif (!base) {\n\t\t\t\t\t\tbase = self.convAbsUrl(self.baseUrl);\n\t\t\t\t\t}\n\t\t\t\t\tif (Array.isArray(url)) {\n\t\t\t\t\t\treturn $.map(url, function(v) {\n\t\t\t\t\t\t\treturn absUrl(v, base);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn url.match(/^(?:http|\\/\\/)/i)? url : base + url.replace(/^(?:\\.\\/|\\/)/, '');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tthemeObj, m;\n\t\t\tif (themeid && (themeObj = self.options.themes[themeid])) {\n\t\t\t\tif (typeof themeObj === 'string') {\n\t\t\t\t\turl = absUrl(themeObj);\n\t\t\t\t\tif (m = url.match(/^(.+\\/)[^/]+\\.json$/i)) {\n\t\t\t\t\t\t$.getJSON(url).done(function(data) {\n\t\t\t\t\t\t\tthemeObj = data;\n\t\t\t\t\t\t\tthemeObj.id = themeid;\n\t\t\t\t\t\t\tif (themeObj.cssurls) {\n\t\t\t\t\t\t\t\tthemeObj.cssurls = absUrl(themeObj.cssurls, m[1]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdfd.resolve(themeObj);\n\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfd.resolve({\n\t\t\t\t\t\t\tid: themeid,\n\t\t\t\t\t\t\tname: themeid,\n\t\t\t\t\t\t\tcssurls: [url]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else if ($.isPlainObject(themeObj) && themeObj.cssurls) {\n\t\t\t\t\tthemeObj.id = themeid;\n\t\t\t\t\tthemeObj.cssurls = absUrl(themeObj.cssurls);\n\t\t\t\t\tif (!Array.isArray(themeObj.cssurls)) {\n\t\t\t\t\t\tthemeObj.cssurls = [themeObj.cssurls];\n\t\t\t\t\t}\n\t\t\t\t\tif (!themeObj.name) {\n\t\t\t\t\t\tthemeObj.name = themeid;\n\t\t\t\t\t}\n\t\t\t\t\tdfd.resolve(themeObj);\n\t\t\t\t} else {\n\t\t\t\t\tdfd.reject();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdfd.reject();\n\t\t\t}\n\t\t\treturn dfd;\n\t\t},\n\n\t\t/**\n\t\t * Change current theme\n\t\t *\n\t\t * @param  String  themeid  The themeid\n\t\t * @return Object  this elFinder instance\n\t\t */\n\t\tchangeTheme : function(themeid) {\n\t\t\tvar self = this;\n\t\t\tif (themeid) {\n\t\t\t\tif (self.options.themes[themeid] && (!self.theme || self.theme.id !== themeid)) {\n\t\t\t\t\tself.getTheme(themeid).done(function(themeObj) {\n\t\t\t\t\t\tif (themeObj.cssurls) {\n\t\t\t\t\t\t\t$('head>link.elfinder-theme-ext').remove();\n\t\t\t\t\t\t\tself.loadCss(themeObj.cssurls, {\n\t\t\t\t\t\t\t\tclassName: 'elfinder-theme-ext',\n\t\t\t\t\t\t\t\tdfd: $.Deferred().done(function() {\n\t\t\t\t\t\t\t\t\tself.theme = themeObj;\n\t\t\t\t\t\t\t\t\tself.trigger && self.trigger('themechange');\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (themeid === 'default' && self.theme && self.theme.id !== 'default') {\n\t\t\t\t\t$('head>link.elfinder-theme-ext').remove();\n\t\t\t\t\tself.theme = null;\n\t\t\t\t\tself.trigger && self.trigger('themechange');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Apply leaf root stats to target directory\n\t\t *\n\t\t * @param      object     dir     object of target directory\n\t\t * @param      boolean    update  is force update\n\t\t * \n\t\t * @return     boolean    dir object was chenged \n\t\t */\n\t\tapplyLeafRootStats : function(dir, update) {\n\t\t\tvar self = this,\n\t\t\t\tprev = update? dir : (self.file(dir.hash) || dir),\n\t\t\t\tprevTs = prev.ts,\n\t\t\t\tchange = false;\n\t\t\t// backup original stats\n\t\t\tif (update || !dir._realStats) {\n\t\t\t\tdir._realStats = {\n\t\t\t\t\tlocked: dir.locked || 0,\n\t\t\t\t\tdirs: dir.dirs || 0,\n\t\t\t\t\tts: dir.ts\n\t\t\t\t};\n\t\t\t}\n\t\t\t// set lock\n\t\t\tdir.locked = 1;\n\t\t\tif (!prev.locked) {\n\t\t\t\tchange = true;\n\t\t\t}\n\t\t\t// has leaf root to `dirs: 1`\n\t\t\tdir.dirs = 1;\n\t\t\tif (!prev.dirs) {\n\t\t\t\tchange = true;\n\t\t\t}\n\t\t\t// set ts\n\t\t\t$.each(self.leafRoots[dir.hash], function() {\n\t\t\t\tvar f = self.file(this);\n\t\t\t\tif (f && f.ts && (dir.ts || 0) < f.ts) {\n\t\t\t\t\tdir.ts = f.ts;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (prevTs !== dir.ts) {\n\t\t\t\tchange = true;\n\t\t\t}\n\n\t\t\treturn change;\n\t\t},\n\n\t\t/**\n\t\t * To aborted XHR object\n\t\t * \n\t\t * @param Object xhr\n\t\t * @param Object opts\n\t\t * \n\t\t * @return void\n\t\t */\n\t\tabortXHR : function(xhr, o) {\n\t\t\tvar opts = o || {};\n\t\t\t\n\t\t\tif (xhr) {\n\t\t\t\topts.quiet && (xhr.quiet = true);\n\t\t\t\tif (opts.abort && xhr._requestId) {\n\t\t\t\t\tthis.request({\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tcmd: 'abort',\n\t\t\t\t\t\t\tid: xhr._requestId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreventDefault: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t//xhr.abort(); // modified by lwf\n\t\t\t\txhr = void 0;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Sets the custom header by xhr response header with options.parrotHeaders\n\t\t *\n\t\t * @param Object xhr\n\t\t * \n\t\t * @return void\n\t\t */\n\t\tsetCustomHeaderByXhr : function(xhr) {\n\t\t\tvar self = this;\n\t\t\tif (xhr.getResponseHeader && self.parrotHeaders && self.parrotHeaders.length) {\n\t\t\t\t$.each(self.parrotHeaders, function(i, h) {\n\t\t\t\t\tvar val = xhr.getResponseHeader(h);\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tself.customHeaders[h] = val;\n\t\t\t\t\t\tself.sessionStorage('core-ph:'+h, val);\n\t\t\t\t\t} else if (typeof val === 'string') {\n\t\t\t\t\t\tdelete self.customHeaders[h];\n\t\t\t\t\t\tself.sessionStorage('core-ph:'+h, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Determines if parrot headers.\n\t\t *\n\t\t * @return     {boolean}  True if parrot headers, False otherwise.\n\t\t */\n\t\thasParrotHeaders : function() {\n\t\t\tvar res = false,\n\t\t\t\tphs = this.parrotHeaders;\n\t\t\tif (Object.keys(this.customHeaders).length) {\n\t\t\t\tfor (var i = 0; i < phs.length; i++) {\n\t\t\t\t\tif (this.customHeaders[phs[i]]) {\n\t\t\t\t\t\tres = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res;\n\t\t},\n\n\t\t/**\n\t\t * Gets the request identifier\n\t\t *\n\t\t * @return  String  The request identifier.\n\t\t */\n\t\tgetRequestId : function() {\n\t\t\treturn (+ new Date()).toString(16) + Math.floor(1000 * Math.random()).toString(16);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Flip key and value of array or object\n\t\t * \n\t\t * @param  Array | Object  { a: 1, b: 1, c: 2 }\n\t\t * @param  Mixed           Static value\n\t\t * @return Object          { 1: \"b\", 2: \"c\" }\n\t\t */\n\t\tarrayFlip : function (trans, val) {\n\t\t\tvar key,\n\t\t\t\ttmpArr = {},\n\t\t\t\tisArr = $.isArray(trans);\n\t\t\tfor (key in trans) {\n\t\t\t\tif (isArr || trans.hasOwnProperty(key)) {\n\t\t\t\t\ttmpArr[trans[key]] = val || key;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn tmpArr;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Return array [\"name without extention\", \"extention\"]\n\t\t * \n\t\t * @param String name\n\t\t * \n\t\t * @return Array\n\t\t * \n\t\t */\n\t\tsplitFileExtention : function(name) {\n\t\t\tvar m;\n\t\t\tif (m = name.match(/^(.+?)?\\.((?:tar\\.(?:gz|bz|bz2|z|lzo))|cpio\\.gz|ps\\.gz|xcf\\.(?:gz|bz2)|[a-z0-9]{1,10})$/i)) {\n\t\t\t\tif (typeof m[1] === 'undefined') {\n\t\t\t\t\tm[1] = '';\n\t\t\t\t}\n\t\t\t\treturn [m[1], m[2]];\n\t\t\t} else {\n\t\t\t\treturn [name, ''];\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Slice the ArrayBuffer by sliceSize\n\t\t *\n\t\t * @param      arraybuffer  arrayBuffer  The array buffer\n\t\t * @param      Number       sliceSize    The slice size\n\t\t * @return     Array   Array of sleced arraybuffer\n\t\t */\n\t\tsliceArrayBuffer : function(arrayBuffer, sliceSize) {\n\t\t\tvar segments= [],\n\t\t\t\tfi = 0;\n\t\t\twhile(fi * sliceSize < arrayBuffer.byteLength){\n\t\t\t\tsegments.push(arrayBuffer.slice(fi * sliceSize, (fi + 1) * sliceSize));\n\t\t\t\tfi++;\n\t\t\t}\n\t\t\treturn segments;\n\t\t},\n\n\t\tarrayBufferToBase64 : function(ab) {\n\t\t\tif (!window.btoa) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tvar dView = new Uint8Array(ab), // Get a byte view\n\t\t\t\tarr = Array.prototype.slice.call(dView), // Create a normal array\n\t\t\t\tarr1 = arr.map(function(item) {\n\t\t\t\t\treturn String.fromCharCode(item); // Convert\n\t\t\t\t});\n\t\t    return window.btoa(arr1.join('')); // Form a string\n\t\t},\n\n\t\tlog : function(m) { window.console && window.console.log && window.console.log(m); return this; },\n\t\t\n\t\tdebug : function(type, m) {\n\t\t\tvar self = this,\n\t\t\t\td = this.options.debug,\n\t\t\t\ttb = this.options.toastBackendWarn,\n\t\t\t\ttbOpts, showlog;\n\n\t\t\tif (type === 'backend-error') {\n\t\t\t\tif (! this.cwd().hash || (d && (d === 'all' || d['backend-error']))) {\n\t\t\t\t\tm = Array.isArray(m)? m : [ m ];\n\t\t\t\t\tthis.error(m);\n\t\t\t\t}\n\t\t\t} else if (type === 'backend-warning') {\n\t\t\t\tshowlog = true;\n\t\t\t\tif (tb) {\n\t\t\t\t\ttbOpts = $.isPlainObject(tb)? tb : {};\n\t\t\t\t\t$.each(Array.isArray(m)? m : [ m ], function(i, m) {\n\t\t\t\t\t\tself.toast(Object.assign({\n\t\t\t\t\t\t\tmode : 'warning',\n\t\t\t\t\t\t\tmsg: m\n\t\t\t\t\t\t}, tbOpts));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (type === 'backend-debug') {\n\t\t\t\tthis.trigger('backenddebug', m);\n\t\t\t}\n\t\t\t\n\t\t\tif (showlog || (d && (d === 'all' || d[type]))) {\n\t\t\t\twindow.console && window.console.log && window.console.log('elfinder debug: ['+type+'] ['+this.id+']', m);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Parse response.debug and trigger debug\n\t\t *\n\t\t * @param      Object  response  The response\n\t\t */\n\t\tresponseDebug : function(response) {\n\t\t\tvar rd = response.debug,\n\t\t\t\td;\n\t\t\tif (rd) {\n\t\t\t\t// set options.debug\n\t\t\t\td = this.options.debug;\n\t\t\t\tif (!d || d !== 'all') {\n\t\t\t\t\tif (!d) {\n\t\t\t\t\t\td = this.options.debug = {};\n\t\t\t\t\t}\n\t\t\t\t\td['backend-error'] = true;\n\t\t\t\t\td['warning'] = true;\n\t\t\t\t}\n\t\t\t\tif (rd.mountErrors && (typeof rd.mountErrors === 'string' || (Array.isArray(rd.mountErrors) && rd.mountErrors.length))) {\n\t\t\t\t\tthis.debug('backend-error', rd.mountErrors);\n\t\t\t\t}\n\t\t\t\tif (rd.backendErrors && (typeof rd.backendErrors === 'string' || (Array.isArray(rd.backendErrors) && rd.backendErrors.length))) {\n\t\t\t\t\tthis.debug('backend-warning', rd.backendErrors);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\ttime : function(l) { window.console && window.console.time && window.console.time(l); },\n\t\ttimeEnd : function(l) { window.console && window.console.timeEnd && window.console.timeEnd(l); }\n\t\t\n\n\t};\n\n\t/**\n\t * for conpat ex. ie8...\n\t *\n\t * Object.keys() - JavaScript | MDN\n\t * https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\n\t */\n\tif (!Object.keys) {\n\t\tObject.keys = (function () {\n\t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n\t\t\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\n\t\t\t\t\tdontEnums = [\n\t\t\t\t\t\t'toString',\n\t\t\t\t\t\t'toLocaleString',\n\t\t\t\t\t\t'valueOf',\n\t\t\t\t\t\t'hasOwnProperty',\n\t\t\t\t\t\t'isPrototypeOf',\n\t\t\t\t\t\t'propertyIsEnumerable',\n\t\t\t\t\t\t'constructor'\n\t\t\t\t\t],\n\t\t\t\t\tdontEnumsLength = dontEnums.length;\n\n\t\t\treturn function (obj) {\n\t\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) throw new TypeError('Object.keys called on non-object');\n\n\t\t\t\tvar result = [];\n\n\t\t\t\tfor (var prop in obj) {\n\t\t\t\t\tif (hasOwnProperty.call(obj, prop)) result.push(prop);\n\t\t\t\t}\n\n\t\t\t\tif (hasDontEnumBug) {\n\t\t\t\t\tfor (var i=0; i < dontEnumsLength; i++) {\n\t\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) result.push(dontEnums[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t};\n\t\t})();\n\t}\n\t// Array.isArray\n\tif (!Array.isArray) {\n\t\tArray.isArray = function(arr) {\n\t\t\treturn jQuery.isArray(arr);\n\t\t};\n\t}\n\t// Object.assign\n\tif (!Object.assign) {\n\t\tObject.assign = function() {\n\t\t\treturn jQuery.extend.apply(null, arguments);\n\t\t};\n\t}\n\t// String.repeat\n\tif (!String.prototype.repeat) {\n\t\tString.prototype.repeat = function(count) {\n\t\t\t'use strict';\n\t\t\tif (this == null) {\n\t\t\t\tthrow new TypeError('can\\'t convert ' + this + ' to object');\n\t\t\t}\n\t\t\tvar str = '' + this;\n\t\t\tcount = +count;\n\t\t\tif (count != count) {\n\t\t\t\tcount = 0;\n\t\t\t}\n\t\t\tif (count < 0) {\n\t\t\t\tthrow new RangeError('repeat count must be non-negative');\n\t\t\t}\n\t\t\tif (count == Infinity) {\n\t\t\t\tthrow new RangeError('repeat count must be less than infinity');\n\t\t\t}\n\t\t\tcount = Math.floor(count);\n\t\t\tif (str.length == 0 || count == 0) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\t// Ensuring count is a 31-bit integer allows us to heavily optimize the\n\t\t\t// main part. But anyway, most current (August 2014) browsers can't handle\n\t\t\t// strings 1 << 28 chars or longer, so:\n\t\t\tif (str.length * count >= 1 << 28) {\n\t\t\t\tthrow new RangeError('repeat count must not overflow maximum string size');\n\t\t\t}\n\t\t\tvar rpt = '';\n\t\t\tfor (var i = 0; i < count; i++) {\n\t\t\t\trpt += str;\n\t\t\t}\n\t\t\treturn rpt;\n\t\t};\n\t}\n\t// String.trim\n\tif (!String.prototype.trim) {\n\t\tString.prototype.trim = function() {\n\t\t\treturn this.replace(/^\\s+|\\s+$/g, '');\n\t\t};\n\t}\n\t// Array.apply\n\t(function () {\n\t\ttry {\n\t\t\tArray.apply(null, {});\n\t\t\treturn;\n\t\t} catch (e) { }\n\n\t\tvar toString = Object.prototype.toString,\n\t\t\tarrayType = '[object Array]',\n\t\t\t_apply = Function.prototype.apply,\n\t\t\tslice = /*@cc_on @if (@_jscript_version <= 5.8)\n\t\t\t\tfunction () {\n\t\t\t\t\tvar a = [], i = this.length;\n\t\t\t\t\twhile (i-- > 0) a[i] = this[i];\n\t\t\t\t\treturn a;\n\t\t\t\t}@else@*/Array.prototype.slice/*@end@*/;\n\n\t\tFunction.prototype.apply = function apply(thisArg, argArray) {\n\t\t\treturn _apply.call(this, thisArg,\n\t\t\t\ttoString.call(argArray) === arrayType ? argArray : slice.call(argArray));\n\t\t};\n\t})();\n\t// Array.from\n\tif (!Array.from) {\n\t\tArray.from = function(obj) {\n\t\t\treturn obj.length === 1 ? [obj[0]] : Array.apply(null, obj);\n\t\t};\n\t}\n\t// window.requestAnimationFrame and window.cancelAnimationFrame\n\tif (!window.cancelAnimationFrame) {\n\t// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n\t// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\t// requestAnimationFrame polyfill by Erik Mller. fixes from Paul Irish and Tino Zijdel\n\t// MIT license\n\t(function() {\n\t    var lastTime = 0;\n\t    var vendors = ['ms', 'moz', 'webkit', 'o'];\n\t    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n\t        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\n\t        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] \n\t                                   || window[vendors[x]+'CancelRequestAnimationFrame'];\n\t    }\n\t \n\t    if (!window.requestAnimationFrame)\n\t        window.requestAnimationFrame = function(callback, element) {\n\t            var currTime = new Date().getTime();\n\t            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, \n\t              timeToCall);\n\t            lastTime = currTime + timeToCall;\n\t            return id;\n\t        };\n\t \n\t    if (!window.cancelAnimationFrame)\n\t        window.cancelAnimationFrame = function(id) {\n\t            clearTimeout(id);\n\t        };\n\t}());\n\t}\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/version',[\n\t\"./elFinder\"\n],function(elFinder) {\n\t/**\n\t * Application version\n\t *\n\t * @type String\n\t **/\n\telFinder.prototype.version = '2.1.55';\n\n\treturn elFinder;\n});\n\n\ndefine('skylark-elfinder/jquery.elfinder',[\n\t\"skylark-jquery\"\n],function($) {\t/*** jQuery UI droppable performance tune for elFinder ***/\n\t(function(){\n\tif ($.ui) {\n\t\tif ($.ui.ddmanager) {\n\t\t\tvar origin = $.ui.ddmanager.prepareOffsets;\n\t\t\t$.ui.ddmanager.prepareOffsets = function( t, event ) {\n\t\t\t\tvar isOutView = function(elem) {\n\t\t\t\t\tif (elem.is(':hidden')) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tvar rect = elem[0].getBoundingClientRect();\n\t\t\t\t\treturn document.elementFromPoint(rect.left, rect.top) || document.elementFromPoint(rect.left + rect.width, rect.top + rect.height)? false : true;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (event.type === 'mousedown' || t.options.elfRefresh) {\n\t\t\t\t\tvar i, d,\n\t\t\t\t\tm = $.ui.ddmanager.droppables[ t.options.scope ] || [],\n\t\t\t\t\tl = m.length;\n\t\t\t\t\tfor ( i = 0; i < l; i++ ) {\n\t\t\t\t\t\td = m[ i ];\n\t\t\t\t\t\tif (d.options.autoDisable && (!d.options.disabled || d.options.autoDisable > 1)) {\n\t\t\t\t\t\t\td.options.disabled = isOutView(d.element);\n\t\t\t\t\t\t\td.options.autoDisable = d.options.disabled? 2 : 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// call origin function\n\t\t\t\treturn origin( t, event );\n\t\t\t};\n\t\t}\n\t}\n\t})();\n\n\t /**\n\t *\n\t * jquery.binarytransport\n\t *\n\t * @description. jQuery ajax transport for making binary data type requests.\n\t *\n\t */\n\n\t(function($, undefined) {\n\t\t\"use strict\";\n\n\t\t// use this transport for \"binary\" data type\n\t\t$.ajaxTransport(\"+binary\", function(options, originalOptions, jqXHR) {\n\t\t\t// check for conditions and support for blob / arraybuffer response type\n\t\t\tif (window.FormData && ((options.dataType && (options.dataType == 'binary')) || (options.data && ((window.ArrayBuffer && options.data instanceof ArrayBuffer) || (window.Blob && options.data instanceof Blob))))) {\n\t\t\t\tvar callback;\n\n\t\t\t\t// Cross domain only allowed if supported through XMLHttpRequest\n\t\t\t\treturn {\n\t\t\t\t\tsend: function( headers, complete ) {\n\t\t\t\t\t\tvar i,\n\t\t\t\t\t\t\tdataType = options.responseType || \"blob\",\n\t\t\t\t\t\t\txhr = options.xhr();\n\n\t\t\t\t\t\txhr.open(\n\t\t\t\t\t\t\toptions.type,\n\t\t\t\t\t\t\toptions.url,\n\t\t\t\t\t\t\toptions.async,\n\t\t\t\t\t\t\toptions.username,\n\t\t\t\t\t\t\toptions.password\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// Apply custom fields if provided\n\t\t\t\t\t\tif ( options.xhrFields ) {\n\t\t\t\t\t\t\tfor ( i in options.xhrFields ) {\n\t\t\t\t\t\t\t\txhr[ i ] = options.xhrFields[ i ];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Override mime type if needed\n\t\t\t\t\t\tif ( options.mimeType && xhr.overrideMimeType ) {\n\t\t\t\t\t\t\txhr.overrideMimeType( options.mimeType );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// X-Requested-With header\n\t\t\t\t\t\t// For cross-domain requests, seeing as conditions for a preflight are\n\t\t\t\t\t\t// akin to a jigsaw puzzle, we simply never set it to be sure.\n\t\t\t\t\t\t// (it can always be set on a per-request basis or even using ajaxSetup)\n\t\t\t\t\t\t// For same-domain requests, won't change header if already provided.\n\t\t\t\t\t\tif ( !options.crossDomain && !headers[ \"X-Requested-With\" ] ) {\n\t\t\t\t\t\t\theaders[ \"X-Requested-With\" ] = \"XMLHttpRequest\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Set headers\n\t\t\t\t\t\tfor ( i in headers ) {\n\t\t\t\t\t\t\txhr.setRequestHeader( i, headers[ i ] );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Callback\n\t\t\t\t\t\tcallback = function( type ) {\n\t\t\t\t\t\t\treturn function() {\n\t\t\t\t\t\t\t\tif ( callback ) {\n\t\t\t\t\t\t\t\t\tcallback = xhr.onload = xhr.onerror = xhr.onabort = xhr.ontimeout = null;\n\n\t\t\t\t\t\t\t\t\tif ( type === \"abort\" ) {\n\t\t\t\t\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\t\t\t\t} else if ( type === \"error\" ) {\n\t\t\t\t\t\t\t\t\t\tcomplete(\n\t\t\t\t\t\t\t\t\t\t\txhr.status,\n\t\t\t\t\t\t\t\t\t\t\txhr.statusText\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tvar data = {};\n\t\t\t\t\t\t\t\t\t\tdata[options.dataType] = xhr.response;\n\t\t\t\t\t\t\t\t\t\tcomplete(\n\t\t\t\t\t\t\t\t\t\t\txhr.status,\n\t\t\t\t\t\t\t\t\t\t\txhr.statusText,\n\t\t\t\t\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\t\t\t\t\txhr.getAllResponseHeaders()\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Listen to events\n\t\t\t\t\t\txhr.onload = callback();\n\t\t\t\t\t\txhr.onabort = xhr.onerror = xhr.ontimeout = callback( \"error\" );\n\n\t\t\t\t\t\t// Create the abort callback\n\t\t\t\t\t\tcallback = callback( \"abort\" );\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\txhr.responseType = dataType;\n\t\t\t\t\t\t\t// Do send the request (this may raise an exception)\n\t\t\t\t\t\t\txhr.send( options.data || null );\n\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\tif ( callback ) {\n\t\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tabort: function() {\n\t\t\t\t\t\tif ( callback ) {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t})($);\n\n\t/*!\n\t * jQuery UI Touch Punch 0.2.3\n\t *\n\t * Copyright 20112014, Dave Furfero\n\t * Dual licensed under the MIT or GPL Version 2 licenses.\n\t *\n\t * Depends:\n\t *\tjquery.ui.widget.js\n\t *\tjquery.ui.mouse.js\n\t */\n\t(function ($) {\n\n\t  // Detect touch support\n\t  $.support.touch = 'ontouchend' in document;\n\n\t  // Ignore browsers without touch support\n\t  if (!$.support.touch) {\n\t\treturn;\n\t  }\n\n\t  var mouseProto = $.ui.mouse.prototype,\n\t\t  _mouseInit = mouseProto._mouseInit,\n\t\t  _mouseDestroy = mouseProto._mouseDestroy,\n\t\t  touchHandled,\n\t\t  posX, posY;\n\n\t  /**\n\t   * Simulate a mouse event based on a corresponding touch event\n\t   * @param {Object} event A touch event\n\t   * @param {String} simulatedType The corresponding mouse event\n\t   */\n\t  function simulateMouseEvent (event, simulatedType) {\n\n\t\t// Ignore multi-touch events\n\t\tif (event.originalEvent.touches.length > 1) {\n\t\t  return;\n\t\t}\n\n\t\tif (! $(event.currentTarget).hasClass('touch-punch-keep-default')) {\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tvar touch = event.originalEvent.changedTouches[0],\n\t\t\tsimulatedEvent = document.createEvent('MouseEvents');\n\t\t\n\t\t// Initialize the simulated mouse event using the touch event's coordinates\n\t\tsimulatedEvent.initMouseEvent(\n\t\t  simulatedType,\t// type\n\t\t  true,\t\t\t\t// bubbles\t\t\t\t\t  \n\t\t  true,\t\t\t\t// cancelable\t\t\t\t  \n\t\t  window,\t\t\t// view\t\t\t\t\t\t  \n\t\t  1,\t\t\t\t// detail\t\t\t\t\t  \n\t\t  touch.screenX,\t// screenX\t\t\t\t\t  \n\t\t  touch.screenY,\t// screenY\t\t\t\t\t  \n\t\t  touch.clientX,\t// clientX\t\t\t\t\t  \n\t\t  touch.clientY,\t// clientY\t\t\t\t\t  \n\t\t  false,\t\t\t// ctrlKey\t\t\t\t\t  \n\t\t  false,\t\t\t// altKey\t\t\t\t\t  \n\t\t  false,\t\t\t// shiftKey\t\t\t\t\t  \n\t\t  false,\t\t\t// metaKey\t\t\t\t\t  \n\t\t  0,\t\t\t\t// button\t\t\t\t\t  \n\t\t  null\t\t\t\t// relatedTarget\t\t\t  \n\t\t);\n\n\t\t// Dispatch the simulated event to the target element\n\t\tevent.target.dispatchEvent(simulatedEvent);\n\t  }\n\n\t  /**\n\t   * Handle the jQuery UI widget's touchstart events\n\t   * @param {Object} event The widget element's touchstart event\n\t   */\n\t  mouseProto._touchStart = function (event) {\n\n\t\tvar self = this;\n\n\t\t// Ignore the event if another widget is already being handled\n\t\tif (touchHandled || !self._mouseCapture(event.originalEvent.changedTouches[0])) {\n\t\t  return;\n\t\t}\n\n\t\t// Track element position to avoid \"false\" move\n\t\tposX = event.originalEvent.changedTouches[0].screenX.toFixed(0);\n\t\tposY = event.originalEvent.changedTouches[0].screenY.toFixed(0);\n\n\t\t// Set the flag to prevent other widgets from inheriting the touch event\n\t\ttouchHandled = true;\n\n\t\t// Track movement to determine if interaction was a click\n\t\tself._touchMoved = false;\n\n\t\t// Simulate the mouseover event\n\t\tsimulateMouseEvent(event, 'mouseover');\n\n\t\t// Simulate the mousemove event\n\t\tsimulateMouseEvent(event, 'mousemove');\n\n\t\t// Simulate the mousedown event\n\t\tsimulateMouseEvent(event, 'mousedown');\n\t  };\n\n\t  /**\n\t   * Handle the jQuery UI widget's touchmove events\n\t   * @param {Object} event The document's touchmove event\n\t   */\n\t  mouseProto._touchMove = function (event) {\n\n\t\t// Ignore event if not handled\n\t\tif (!touchHandled) {\n\t\t  return;\n\t\t}\n\n\t\t// Ignore if it's a \"false\" move (position not changed)\n\t\tvar x = event.originalEvent.changedTouches[0].screenX.toFixed(0);\n\t\tvar y = event.originalEvent.changedTouches[0].screenY.toFixed(0);\n\t\t// Ignore if it's a \"false\" move (position not changed)\n\t\tif (Math.abs(posX - x) <= 4 && Math.abs(posY - y) <= 4) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Interaction was not a click\n\t\tthis._touchMoved = true;\n\n\t\t// Simulate the mousemove event\n\t\tsimulateMouseEvent(event, 'mousemove');\n\t  };\n\n\t  /**\n\t   * Handle the jQuery UI widget's touchend events\n\t   * @param {Object} event The document's touchend event\n\t   */\n\t  mouseProto._touchEnd = function (event) {\n\n\t\t// Ignore event if not handled\n\t\tif (!touchHandled) {\n\t\t  return;\n\t\t}\n\n\t\t// Simulate the mouseup event\n\t\tsimulateMouseEvent(event, 'mouseup');\n\n\t\t// Simulate the mouseout event\n\t\tsimulateMouseEvent(event, 'mouseout');\n\n\t\t// If the touch interaction did not move, it should trigger a click\n\t\tif (!this._touchMoved) {\n\n\t\t  // Simulate the click event\n\t\t  simulateMouseEvent(event, 'click');\n\t\t}\n\n\t\t// Unset the flag to allow other widgets to inherit the touch event\n\t\ttouchHandled = false;\n\t\tthis._touchMoved = false;\n\t  };\n\n\t  /**\n\t   * A duck punch of the $.ui.mouse _mouseInit method to support touch events.\n\t   * This method extends the widget with bound touch event handlers that\n\t   * translate touch events to mouse events and pass them to the widget's\n\t   * original mouse event handling methods.\n\t   */\n\t  mouseProto._mouseInit = function () {\n\t\t\n\t\tvar self = this;\n\n\t\tif (self.element.hasClass('touch-punch')) {\n\t\t\t// Delegate the touch handlers to the widget's element\n\t\t\tself.element.on({\n\t\t\t  touchstart: $.proxy(self, '_touchStart'),\n\t\t\t  touchmove: $.proxy(self, '_touchMove'),\n\t\t\t  touchend: $.proxy(self, '_touchEnd')\n\t\t\t});\n\t\t}\n\n\t\t// Call the original $.ui.mouse init method\n\t\t_mouseInit.call(self);\n\t  };\n\n\t  /**\n\t   * Remove the touch event handlers\n\t   */\n\t  mouseProto._mouseDestroy = function () {\n\t\t\n\t\tvar self = this;\n\n\t\tif (self.element.hasClass('touch-punch')) {\n\t\t\t// Delegate the touch handlers to the widget's element\n\t\t\tself.element.off({\n\t\t\t  touchstart: $.proxy(self, '_touchStart'),\n\t\t\t  touchmove: $.proxy(self, '_touchMove'),\n\t\t\t  touchend: $.proxy(self, '_touchEnd')\n\t\t\t});\n\t\t}\n\n\t\t// Call the original $.ui.mouse destroy method\n\t\t_mouseDestroy.call(self);\n\t  };\n\n\t})($);\n\n\t$.fn.elfinder = function(o, o2) {\n\t\t\n\t\tif (o === 'instance') {\n\t\t\treturn this.getElFinder();\n\t\t} else if (o === 'ondemand') {\n\n\t\t}\n\t\t\n\t\treturn this.each(function() {\n\t\t\t\n\t\t\tvar cmd          = typeof o  === 'string'  ? o  : '',\n\t\t\t\tbootCallback = typeof o2 === 'function'? o2 : void(0),\n\t\t\t\telfinder     = this.elfinder,\n\t\t\t\topts, reloadCallback;\n\t\t\t\n\t\t\tif (!elfinder) {\n\t\t\t\tif ($.isPlainObject(o)) {\n\t\t\t\t\tnew elFinder(this, o, bootCallback);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tswitch(cmd) {\n\t\t\t\t\tcase 'close':\n\t\t\t\t\tcase 'hide':\n\t\t\t\t\t\telfinder.hide();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\t\t\tcase 'open':\n\t\t\t\t\tcase 'show':\n\t\t\t\t\t\telfinder.show();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\t\t\tcase 'destroy':\n\t\t\t\t\t\telfinder.destroy();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t\tcase 'reload':\n\t\t\t\t\tcase 'restart':\n\t\t\t\t\t\tif (elfinder) {\n\t\t\t\t\t\t\topts = $.extend(true, elfinder.options, $.isPlainObject(o2)? o2 : {});\n\t\t\t\t\t\t\tbootCallback = elfinder.bootCallback;\n\t\t\t\t\t\t\tif (elfinder.reloadCallback && $.isFunction(elfinder.reloadCallback)) {\n\t\t\t\t\t\t\t\telfinder.reloadCallback(opts, bootCallback);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telfinder.destroy();\n\t\t\t\t\t\t\t\tnew elFinder(this, opts, bootCallback);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t$.fn.getElFinder = function() {\n\t\tvar instance;\n\t\t\n\t\tthis.each(function() {\n\t\t\tif (this.elfinder) {\n\t\t\t\tinstance = this.elfinder;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn instance;\n\t};\n\n\t$.fn.elfUiWidgetInstance = function(name) {\n\t\ttry {\n\t\t\treturn this[name]('instance');\n\t\t} catch(e) {\n\t\t\t// fallback for jQuery UI < 1.11\n\t\t\tvar data = this.data('ui-' + name);\n\t\t\tif (data && typeof data === 'object' && data.widgetFullName === 'ui-' + name) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t// function scrollRight\n\tif (! $.fn.scrollRight) {\n\t\t$.fn.extend({\n\t\t\tscrollRight: function (val) {\n\t\t\t\tvar node = this.get(0);\n\t\t\t\tif (val === undefined) {\n\t\t\t\t\treturn Math.max(0, node.scrollWidth - (node.scrollLeft + node.clientWidth));\n\t\t\t\t}\n\t\t\t\treturn this.scrollLeft(node.scrollWidth - node.clientWidth - val);\n\t\t\t}\n\t\t});\n\t}\n\n\t// function scrollBottom\n\tif (! $.fn.scrollBottom) {\n\t\t$.fn.extend({\n\t\t\tscrollBottom: function(val) { \n\t\t\t\tvar node = this.get(0);\n\t\t\t\tif (val === undefined) {\n\t\t\t\t\treturn Math.max(0, node.scrollHeight - (node.scrollTop + node.clientHeight));\n\t\t\t\t}\n\t\t\t\treturn this.scrollTop(node.scrollHeight - node.clientHeight - val);\n\t\t\t}\n\t\t});\n\t}\n\n});\ndefine('skylark-elfinder/mimetypes',[\r\n\t\"./elFinder\"\r\n],function(elFinder) {\r\n\telFinder.prototype.mimeTypes = {\r\n\t  \"application\\/x-executable\": \"exe\",\r\n\t  \"application\\/x-jar\": \"jar\",\r\n\t  \"application\\/x-gzip\": \"gz\",\r\n\t  \"application\\/x-bzip2\": \"tbz\",\r\n\t  \"application\\/x-rar\": \"rar\",\r\n\t  \"text\\/x-php\": \"php\",\r\n\t  \"text\\/javascript\": \"js\",\r\n\t  \"application\\/rtfd\": \"rtfd\",\r\n\t  \"text\\/x-python\": \"py\",\r\n\t  \"text\\/x-ruby\": \"rb\",\r\n\t  \"text\\/x-shellscript\": \"sh\",\r\n\t  \"text\\/x-perl\": \"pl\",\r\n\t  \"text\\/xml\": \"xml\",\r\n\t  \"text\\/x-csrc\": \"c\",\r\n\t  \"text\\/x-chdr\": \"h\",\r\n\t  \"text\\/x-c++src\": \"cpp\",\r\n\t  \"text\\/x-c++hdr\": \"hh\",\r\n\t  \"text\\/x-markdown\": \"md\",\r\n\t  \"text\\/x-yaml\": \"yml\",\r\n\t  \"image\\/x-ms-bmp\": \"bmp\",\r\n\t  \"image\\/x-targa\": \"tga\",\r\n\t  \"image\\/xbm\": \"xbm\",\r\n\t  \"image\\/pxm\": \"pxm\",\r\n\t  \"audio\\/wav\": \"wav\",\r\n\t  \"video\\/x-dv\": \"dv\",\r\n\t  \"video\\/x-ms-wmv\": \"wm\",\r\n\t  \"video\\/ogg\": \"ogm\",\r\n\t  \"video\\/MP2T\": \"m2ts\",\r\n\t  \"application\\/x-mpegURL\": \"m3u8\",\r\n\t  \"application\\/dash+xml\": \"mpd\",\r\n\t  \"application\\/andrew-inset\": \"ez\",\r\n\t  \"application\\/applixware\": \"aw\",\r\n\t  \"application\\/atom+xml\": \"atom\",\r\n\t  \"application\\/atomcat+xml\": \"atomcat\",\r\n\t  \"application\\/atomsvc+xml\": \"atomsvc\",\r\n\t  \"application\\/ccxml+xml\": \"ccxml\",\r\n\t  \"application\\/cdmi-capability\": \"cdmia\",\r\n\t  \"application\\/cdmi-container\": \"cdmic\",\r\n\t  \"application\\/cdmi-domain\": \"cdmid\",\r\n\t  \"application\\/cdmi-object\": \"cdmio\",\r\n\t  \"application\\/cdmi-queue\": \"cdmiq\",\r\n\t  \"application\\/cu-seeme\": \"cu\",\r\n\t  \"application\\/davmount+xml\": \"davmount\",\r\n\t  \"application\\/docbook+xml\": \"dbk\",\r\n\t  \"application\\/dssc+der\": \"dssc\",\r\n\t  \"application\\/dssc+xml\": \"xdssc\",\r\n\t  \"application\\/ecmascript\": \"ecma\",\r\n\t  \"application\\/emma+xml\": \"emma\",\r\n\t  \"application\\/epub+zip\": \"epub\",\r\n\t  \"application\\/exi\": \"exi\",\r\n\t  \"application\\/font-tdpfr\": \"pfr\",\r\n\t  \"application\\/gml+xml\": \"gml\",\r\n\t  \"application\\/gpx+xml\": \"gpx\",\r\n\t  \"application\\/gxf\": \"gxf\",\r\n\t  \"application\\/hyperstudio\": \"stk\",\r\n\t  \"application\\/inkml+xml\": \"ink\",\r\n\t  \"application\\/ipfix\": \"ipfix\",\r\n\t  \"application\\/java-serialized-object\": \"ser\",\r\n\t  \"application\\/java-vm\": \"class\",\r\n\t  \"application\\/json\": \"json\",\r\n\t  \"application\\/jsonml+json\": \"jsonml\",\r\n\t  \"application\\/lost+xml\": \"lostxml\",\r\n\t  \"application\\/mac-binhex40\": \"hqx\",\r\n\t  \"application\\/mac-compactpro\": \"cpt\",\r\n\t  \"application\\/mads+xml\": \"mads\",\r\n\t  \"application\\/marc\": \"mrc\",\r\n\t  \"application\\/marcxml+xml\": \"mrcx\",\r\n\t  \"application\\/mathematica\": \"ma\",\r\n\t  \"application\\/mathml+xml\": \"mathml\",\r\n\t  \"application\\/mbox\": \"mbox\",\r\n\t  \"application\\/mediaservercontrol+xml\": \"mscml\",\r\n\t  \"application\\/metalink+xml\": \"metalink\",\r\n\t  \"application\\/metalink4+xml\": \"meta4\",\r\n\t  \"application\\/mets+xml\": \"mets\",\r\n\t  \"application\\/mods+xml\": \"mods\",\r\n\t  \"application\\/mp21\": \"m21\",\r\n\t  \"application\\/mp4\": \"mp4s\",\r\n\t  \"application\\/msword\": \"doc\",\r\n\t  \"application\\/mxf\": \"mxf\",\r\n\t  \"application\\/octet-stream\": \"bin\",\r\n\t  \"application\\/oda\": \"oda\",\r\n\t  \"application\\/oebps-package+xml\": \"opf\",\r\n\t  \"application\\/ogg\": \"ogx\",\r\n\t  \"application\\/omdoc+xml\": \"omdoc\",\r\n\t  \"application\\/onenote\": \"onetoc\",\r\n\t  \"application\\/oxps\": \"oxps\",\r\n\t  \"application\\/patch-ops-error+xml\": \"xer\",\r\n\t  \"application\\/pdf\": \"pdf\",\r\n\t  \"application\\/pgp-encrypted\": \"pgp\",\r\n\t  \"application\\/pgp-signature\": \"asc\",\r\n\t  \"application\\/pics-rules\": \"prf\",\r\n\t  \"application\\/pkcs10\": \"p10\",\r\n\t  \"application\\/pkcs7-mime\": \"p7m\",\r\n\t  \"application\\/pkcs7-signature\": \"p7s\",\r\n\t  \"application\\/pkcs8\": \"p8\",\r\n\t  \"application\\/pkix-attr-cert\": \"ac\",\r\n\t  \"application\\/pkix-cert\": \"cer\",\r\n\t  \"application\\/pkix-crl\": \"crl\",\r\n\t  \"application\\/pkix-pkipath\": \"pkipath\",\r\n\t  \"application\\/pkixcmp\": \"pki\",\r\n\t  \"application\\/pls+xml\": \"pls\",\r\n\t  \"application\\/postscript\": \"ai\",\r\n\t  \"application\\/prs.cww\": \"cww\",\r\n\t  \"application\\/pskc+xml\": \"pskcxml\",\r\n\t  \"application\\/rdf+xml\": \"rdf\",\r\n\t  \"application\\/reginfo+xml\": \"rif\",\r\n\t  \"application\\/relax-ng-compact-syntax\": \"rnc\",\r\n\t  \"application\\/resource-lists+xml\": \"rl\",\r\n\t  \"application\\/resource-lists-diff+xml\": \"rld\",\r\n\t  \"application\\/rls-services+xml\": \"rs\",\r\n\t  \"application\\/rpki-ghostbusters\": \"gbr\",\r\n\t  \"application\\/rpki-manifest\": \"mft\",\r\n\t  \"application\\/rpki-roa\": \"roa\",\r\n\t  \"application\\/rsd+xml\": \"rsd\",\r\n\t  \"application\\/rss+xml\": \"rss\",\r\n\t  \"application\\/rtf\": \"rtf\",\r\n\t  \"application\\/sbml+xml\": \"sbml\",\r\n\t  \"application\\/scvp-cv-request\": \"scq\",\r\n\t  \"application\\/scvp-cv-response\": \"scs\",\r\n\t  \"application\\/scvp-vp-request\": \"spq\",\r\n\t  \"application\\/scvp-vp-response\": \"spp\",\r\n\t  \"application\\/sdp\": \"sdp\",\r\n\t  \"application\\/set-payment-initiation\": \"setpay\",\r\n\t  \"application\\/set-registration-initiation\": \"setreg\",\r\n\t  \"application\\/shf+xml\": \"shf\",\r\n\t  \"application\\/smil+xml\": \"smi\",\r\n\t  \"application\\/sparql-query\": \"rq\",\r\n\t  \"application\\/sparql-results+xml\": \"srx\",\r\n\t  \"application\\/srgs\": \"gram\",\r\n\t  \"application\\/srgs+xml\": \"grxml\",\r\n\t  \"application\\/sru+xml\": \"sru\",\r\n\t  \"application\\/ssdl+xml\": \"ssdl\",\r\n\t  \"application\\/ssml+xml\": \"ssml\",\r\n\t  \"application\\/tei+xml\": \"tei\",\r\n\t  \"application\\/thraud+xml\": \"tfi\",\r\n\t  \"application\\/timestamped-data\": \"tsd\",\r\n\t  \"application\\/vnd.3gpp.pic-bw-large\": \"plb\",\r\n\t  \"application\\/vnd.3gpp.pic-bw-small\": \"psb\",\r\n\t  \"application\\/vnd.3gpp.pic-bw-var\": \"pvb\",\r\n\t  \"application\\/vnd.3gpp2.tcap\": \"tcap\",\r\n\t  \"application\\/vnd.3m.post-it-notes\": \"pwn\",\r\n\t  \"application\\/vnd.accpac.simply.aso\": \"aso\",\r\n\t  \"application\\/vnd.accpac.simply.imp\": \"imp\",\r\n\t  \"application\\/vnd.acucobol\": \"acu\",\r\n\t  \"application\\/vnd.acucorp\": \"atc\",\r\n\t  \"application\\/vnd.adobe.air-application-installer-package+zip\": \"air\",\r\n\t  \"application\\/vnd.adobe.formscentral.fcdt\": \"fcdt\",\r\n\t  \"application\\/vnd.adobe.fxp\": \"fxp\",\r\n\t  \"application\\/vnd.adobe.xdp+xml\": \"xdp\",\r\n\t  \"application\\/vnd.adobe.xfdf\": \"xfdf\",\r\n\t  \"application\\/vnd.ahead.space\": \"ahead\",\r\n\t  \"application\\/vnd.airzip.filesecure.azf\": \"azf\",\r\n\t  \"application\\/vnd.airzip.filesecure.azs\": \"azs\",\r\n\t  \"application\\/vnd.amazon.ebook\": \"azw\",\r\n\t  \"application\\/vnd.americandynamics.acc\": \"acc\",\r\n\t  \"application\\/vnd.amiga.ami\": \"ami\",\r\n\t  \"application\\/vnd.android.package-archive\": \"apk\",\r\n\t  \"application\\/vnd.anser-web-certificate-issue-initiation\": \"cii\",\r\n\t  \"application\\/vnd.anser-web-funds-transfer-initiation\": \"fti\",\r\n\t  \"application\\/vnd.antix.game-component\": \"atx\",\r\n\t  \"application\\/vnd.apple.installer+xml\": \"mpkg\",\r\n\t  \"application\\/vnd.aristanetworks.swi\": \"swi\",\r\n\t  \"application\\/vnd.astraea-software.iota\": \"iota\",\r\n\t  \"application\\/vnd.audiograph\": \"aep\",\r\n\t  \"application\\/vnd.blueice.multipass\": \"mpm\",\r\n\t  \"application\\/vnd.bmi\": \"bmi\",\r\n\t  \"application\\/vnd.businessobjects\": \"rep\",\r\n\t  \"application\\/vnd.chemdraw+xml\": \"cdxml\",\r\n\t  \"application\\/vnd.chipnuts.karaoke-mmd\": \"mmd\",\r\n\t  \"application\\/vnd.cinderella\": \"cdy\",\r\n\t  \"application\\/vnd.claymore\": \"cla\",\r\n\t  \"application\\/vnd.cloanto.rp9\": \"rp9\",\r\n\t  \"application\\/vnd.clonk.c4group\": \"c4g\",\r\n\t  \"application\\/vnd.cluetrust.cartomobile-config\": \"c11amc\",\r\n\t  \"application\\/vnd.cluetrust.cartomobile-config-pkg\": \"c11amz\",\r\n\t  \"application\\/vnd.commonspace\": \"csp\",\r\n\t  \"application\\/vnd.contact.cmsg\": \"cdbcmsg\",\r\n\t  \"application\\/vnd.cosmocaller\": \"cmc\",\r\n\t  \"application\\/vnd.crick.clicker\": \"clkx\",\r\n\t  \"application\\/vnd.crick.clicker.keyboard\": \"clkk\",\r\n\t  \"application\\/vnd.crick.clicker.palette\": \"clkp\",\r\n\t  \"application\\/vnd.crick.clicker.template\": \"clkt\",\r\n\t  \"application\\/vnd.crick.clicker.wordbank\": \"clkw\",\r\n\t  \"application\\/vnd.criticaltools.wbs+xml\": \"wbs\",\r\n\t  \"application\\/vnd.ctc-posml\": \"pml\",\r\n\t  \"application\\/vnd.cups-ppd\": \"ppd\",\r\n\t  \"application\\/vnd.curl.car\": \"car\",\r\n\t  \"application\\/vnd.curl.pcurl\": \"pcurl\",\r\n\t  \"application\\/vnd.dart\": \"dart\",\r\n\t  \"application\\/vnd.data-vision.rdz\": \"rdz\",\r\n\t  \"application\\/vnd.dece.data\": \"uvf\",\r\n\t  \"application\\/vnd.dece.ttml+xml\": \"uvt\",\r\n\t  \"application\\/vnd.dece.unspecified\": \"uvx\",\r\n\t  \"application\\/vnd.dece.zip\": \"uvz\",\r\n\t  \"application\\/vnd.denovo.fcselayout-link\": \"fe_launch\",\r\n\t  \"application\\/vnd.dna\": \"dna\",\r\n\t  \"application\\/vnd.dolby.mlp\": \"mlp\",\r\n\t  \"application\\/vnd.dpgraph\": \"dpg\",\r\n\t  \"application\\/vnd.dreamfactory\": \"dfac\",\r\n\t  \"application\\/vnd.ds-keypoint\": \"kpxx\",\r\n\t  \"application\\/vnd.dvb.ait\": \"ait\",\r\n\t  \"application\\/vnd.dvb.service\": \"svc\",\r\n\t  \"application\\/vnd.dynageo\": \"geo\",\r\n\t  \"application\\/vnd.ecowin.chart\": \"mag\",\r\n\t  \"application\\/vnd.enliven\": \"nml\",\r\n\t  \"application\\/vnd.epson.esf\": \"esf\",\r\n\t  \"application\\/vnd.epson.msf\": \"msf\",\r\n\t  \"application\\/vnd.epson.quickanime\": \"qam\",\r\n\t  \"application\\/vnd.epson.salt\": \"slt\",\r\n\t  \"application\\/vnd.epson.ssf\": \"ssf\",\r\n\t  \"application\\/vnd.eszigno3+xml\": \"es3\",\r\n\t  \"application\\/vnd.ezpix-album\": \"ez2\",\r\n\t  \"application\\/vnd.ezpix-package\": \"ez3\",\r\n\t  \"application\\/vnd.fdf\": \"fdf\",\r\n\t  \"application\\/vnd.fdsn.mseed\": \"mseed\",\r\n\t  \"application\\/vnd.fdsn.seed\": \"seed\",\r\n\t  \"application\\/vnd.flographit\": \"gph\",\r\n\t  \"application\\/vnd.fluxtime.clip\": \"ftc\",\r\n\t  \"application\\/vnd.framemaker\": \"fm\",\r\n\t  \"application\\/vnd.frogans.fnc\": \"fnc\",\r\n\t  \"application\\/vnd.frogans.ltf\": \"ltf\",\r\n\t  \"application\\/vnd.fsc.weblaunch\": \"fsc\",\r\n\t  \"application\\/vnd.fujitsu.oasys\": \"oas\",\r\n\t  \"application\\/vnd.fujitsu.oasys2\": \"oa2\",\r\n\t  \"application\\/vnd.fujitsu.oasys3\": \"oa3\",\r\n\t  \"application\\/vnd.fujitsu.oasysgp\": \"fg5\",\r\n\t  \"application\\/vnd.fujitsu.oasysprs\": \"bh2\",\r\n\t  \"application\\/vnd.fujixerox.ddd\": \"ddd\",\r\n\t  \"application\\/vnd.fujixerox.docuworks\": \"xdw\",\r\n\t  \"application\\/vnd.fujixerox.docuworks.binder\": \"xbd\",\r\n\t  \"application\\/vnd.fuzzysheet\": \"fzs\",\r\n\t  \"application\\/vnd.genomatix.tuxedo\": \"txd\",\r\n\t  \"application\\/vnd.geogebra.file\": \"ggb\",\r\n\t  \"application\\/vnd.geogebra.tool\": \"ggt\",\r\n\t  \"application\\/vnd.geometry-explorer\": \"gex\",\r\n\t  \"application\\/vnd.geonext\": \"gxt\",\r\n\t  \"application\\/vnd.geoplan\": \"g2w\",\r\n\t  \"application\\/vnd.geospace\": \"g3w\",\r\n\t  \"application\\/vnd.gmx\": \"gmx\",\r\n\t  \"application\\/vnd.google-earth.kml+xml\": \"kml\",\r\n\t  \"application\\/vnd.google-earth.kmz\": \"kmz\",\r\n\t  \"application\\/vnd.grafeq\": \"gqf\",\r\n\t  \"application\\/vnd.groove-account\": \"gac\",\r\n\t  \"application\\/vnd.groove-help\": \"ghf\",\r\n\t  \"application\\/vnd.groove-identity-message\": \"gim\",\r\n\t  \"application\\/vnd.groove-injector\": \"grv\",\r\n\t  \"application\\/vnd.groove-tool-message\": \"gtm\",\r\n\t  \"application\\/vnd.groove-tool-template\": \"tpl\",\r\n\t  \"application\\/vnd.groove-vcard\": \"vcg\",\r\n\t  \"application\\/vnd.hal+xml\": \"hal\",\r\n\t  \"application\\/vnd.handheld-entertainment+xml\": \"zmm\",\r\n\t  \"application\\/vnd.hbci\": \"hbci\",\r\n\t  \"application\\/vnd.hhe.lesson-player\": \"les\",\r\n\t  \"application\\/vnd.hp-hpgl\": \"hpgl\",\r\n\t  \"application\\/vnd.hp-hpid\": \"hpid\",\r\n\t  \"application\\/vnd.hp-hps\": \"hps\",\r\n\t  \"application\\/vnd.hp-jlyt\": \"jlt\",\r\n\t  \"application\\/vnd.hp-pcl\": \"pcl\",\r\n\t  \"application\\/vnd.hp-pclxl\": \"pclxl\",\r\n\t  \"application\\/vnd.hydrostatix.sof-data\": \"sfd-hdstx\",\r\n\t  \"application\\/vnd.ibm.minipay\": \"mpy\",\r\n\t  \"application\\/vnd.ibm.modcap\": \"afp\",\r\n\t  \"application\\/vnd.ibm.rights-management\": \"irm\",\r\n\t  \"application\\/vnd.ibm.secure-container\": \"sc\",\r\n\t  \"application\\/vnd.iccprofile\": \"icc\",\r\n\t  \"application\\/vnd.igloader\": \"igl\",\r\n\t  \"application\\/vnd.immervision-ivp\": \"ivp\",\r\n\t  \"application\\/vnd.immervision-ivu\": \"ivu\",\r\n\t  \"application\\/vnd.insors.igm\": \"igm\",\r\n\t  \"application\\/vnd.intercon.formnet\": \"xpw\",\r\n\t  \"application\\/vnd.intergeo\": \"i2g\",\r\n\t  \"application\\/vnd.intu.qbo\": \"qbo\",\r\n\t  \"application\\/vnd.intu.qfx\": \"qfx\",\r\n\t  \"application\\/vnd.ipunplugged.rcprofile\": \"rcprofile\",\r\n\t  \"application\\/vnd.irepository.package+xml\": \"irp\",\r\n\t  \"application\\/vnd.is-xpr\": \"xpr\",\r\n\t  \"application\\/vnd.isac.fcs\": \"fcs\",\r\n\t  \"application\\/vnd.jam\": \"jam\",\r\n\t  \"application\\/vnd.jcp.javame.midlet-rms\": \"rms\",\r\n\t  \"application\\/vnd.jisp\": \"jisp\",\r\n\t  \"application\\/vnd.joost.joda-archive\": \"joda\",\r\n\t  \"application\\/vnd.kahootz\": \"ktz\",\r\n\t  \"application\\/vnd.kde.karbon\": \"karbon\",\r\n\t  \"application\\/vnd.kde.kchart\": \"chrt\",\r\n\t  \"application\\/vnd.kde.kformula\": \"kfo\",\r\n\t  \"application\\/vnd.kde.kivio\": \"flw\",\r\n\t  \"application\\/vnd.kde.kontour\": \"kon\",\r\n\t  \"application\\/vnd.kde.kpresenter\": \"kpr\",\r\n\t  \"application\\/vnd.kde.kspread\": \"ksp\",\r\n\t  \"application\\/vnd.kde.kword\": \"kwd\",\r\n\t  \"application\\/vnd.kenameaapp\": \"htke\",\r\n\t  \"application\\/vnd.kidspiration\": \"kia\",\r\n\t  \"application\\/vnd.kinar\": \"kne\",\r\n\t  \"application\\/vnd.koan\": \"skp\",\r\n\t  \"application\\/vnd.kodak-descriptor\": \"sse\",\r\n\t  \"application\\/vnd.las.las+xml\": \"lasxml\",\r\n\t  \"application\\/vnd.llamagraphics.life-balance.desktop\": \"lbd\",\r\n\t  \"application\\/vnd.llamagraphics.life-balance.exchange+xml\": \"lbe\",\r\n\t  \"application\\/vnd.lotus-1-2-3\": 123,\r\n\t  \"application\\/vnd.lotus-approach\": \"apr\",\r\n\t  \"application\\/vnd.lotus-freelance\": \"pre\",\r\n\t  \"application\\/vnd.lotus-notes\": \"nsf\",\r\n\t  \"application\\/vnd.lotus-organizer\": \"org\",\r\n\t  \"application\\/vnd.lotus-screencam\": \"scm\",\r\n\t  \"application\\/vnd.lotus-wordpro\": \"lwp\",\r\n\t  \"application\\/vnd.macports.portpkg\": \"portpkg\",\r\n\t  \"application\\/vnd.mcd\": \"mcd\",\r\n\t  \"application\\/vnd.medcalcdata\": \"mc1\",\r\n\t  \"application\\/vnd.mediastation.cdkey\": \"cdkey\",\r\n\t  \"application\\/vnd.mfer\": \"mwf\",\r\n\t  \"application\\/vnd.mfmp\": \"mfm\",\r\n\t  \"application\\/vnd.micrografx.flo\": \"flo\",\r\n\t  \"application\\/vnd.micrografx.igx\": \"igx\",\r\n\t  \"application\\/vnd.mif\": \"mif\",\r\n\t  \"application\\/vnd.mobius.daf\": \"daf\",\r\n\t  \"application\\/vnd.mobius.dis\": \"dis\",\r\n\t  \"application\\/vnd.mobius.mbk\": \"mbk\",\r\n\t  \"application\\/vnd.mobius.mqy\": \"mqy\",\r\n\t  \"application\\/vnd.mobius.msl\": \"msl\",\r\n\t  \"application\\/vnd.mobius.plc\": \"plc\",\r\n\t  \"application\\/vnd.mobius.txf\": \"txf\",\r\n\t  \"application\\/vnd.mophun.application\": \"mpn\",\r\n\t  \"application\\/vnd.mophun.certificate\": \"mpc\",\r\n\t  \"application\\/vnd.mozilla.xul+xml\": \"xul\",\r\n\t  \"application\\/vnd.ms-artgalry\": \"cil\",\r\n\t  \"application\\/vnd.ms-cab-compressed\": \"cab\",\r\n\t  \"application\\/vnd.ms-excel\": \"xls\",\r\n\t  \"application\\/vnd.ms-excel.addin.macroenabled.12\": \"xlam\",\r\n\t  \"application\\/vnd.ms-excel.sheet.binary.macroenabled.12\": \"xlsb\",\r\n\t  \"application\\/vnd.ms-excel.sheet.macroenabled.12\": \"xlsm\",\r\n\t  \"application\\/vnd.ms-excel.template.macroenabled.12\": \"xltm\",\r\n\t  \"application\\/vnd.ms-fontobject\": \"eot\",\r\n\t  \"application\\/vnd.ms-htmlhelp\": \"chm\",\r\n\t  \"application\\/vnd.ms-ims\": \"ims\",\r\n\t  \"application\\/vnd.ms-lrm\": \"lrm\",\r\n\t  \"application\\/vnd.ms-officetheme\": \"thmx\",\r\n\t  \"application\\/vnd.ms-pki.seccat\": \"cat\",\r\n\t  \"application\\/vnd.ms-pki.stl\": \"stl\",\r\n\t  \"application\\/vnd.ms-powerpoint\": \"ppt\",\r\n\t  \"application\\/vnd.ms-powerpoint.addin.macroenabled.12\": \"ppam\",\r\n\t  \"application\\/vnd.ms-powerpoint.presentation.macroenabled.12\": \"pptm\",\r\n\t  \"application\\/vnd.ms-powerpoint.slide.macroenabled.12\": \"sldm\",\r\n\t  \"application\\/vnd.ms-powerpoint.slideshow.macroenabled.12\": \"ppsm\",\r\n\t  \"application\\/vnd.ms-powerpoint.template.macroenabled.12\": \"potm\",\r\n\t  \"application\\/vnd.ms-project\": \"mpp\",\r\n\t  \"application\\/vnd.ms-word.document.macroenabled.12\": \"docm\",\r\n\t  \"application\\/vnd.ms-word.template.macroenabled.12\": \"dotm\",\r\n\t  \"application\\/vnd.ms-works\": \"wps\",\r\n\t  \"application\\/vnd.ms-wpl\": \"wpl\",\r\n\t  \"application\\/vnd.ms-xpsdocument\": \"xps\",\r\n\t  \"application\\/vnd.mseq\": \"mseq\",\r\n\t  \"application\\/vnd.musician\": \"mus\",\r\n\t  \"application\\/vnd.muvee.style\": \"msty\",\r\n\t  \"application\\/vnd.mynfc\": \"taglet\",\r\n\t  \"application\\/vnd.neurolanguage.nlu\": \"nlu\",\r\n\t  \"application\\/vnd.nitf\": \"ntf\",\r\n\t  \"application\\/vnd.noblenet-directory\": \"nnd\",\r\n\t  \"application\\/vnd.noblenet-sealer\": \"nns\",\r\n\t  \"application\\/vnd.noblenet-web\": \"nnw\",\r\n\t  \"application\\/vnd.nokia.n-gage.data\": \"ngdat\",\r\n\t  \"application\\/vnd.nokia.n-gage.symbian.install\": \"n-gage\",\r\n\t  \"application\\/vnd.nokia.radio-preset\": \"rpst\",\r\n\t  \"application\\/vnd.nokia.radio-presets\": \"rpss\",\r\n\t  \"application\\/vnd.novadigm.edm\": \"edm\",\r\n\t  \"application\\/vnd.novadigm.edx\": \"edx\",\r\n\t  \"application\\/vnd.novadigm.ext\": \"ext\",\r\n\t  \"application\\/vnd.oasis.opendocument.chart\": \"odc\",\r\n\t  \"application\\/vnd.oasis.opendocument.chart-template\": \"otc\",\r\n\t  \"application\\/vnd.oasis.opendocument.database\": \"odb\",\r\n\t  \"application\\/vnd.oasis.opendocument.formula\": \"odf\",\r\n\t  \"application\\/vnd.oasis.opendocument.formula-template\": \"odft\",\r\n\t  \"application\\/vnd.oasis.opendocument.graphics\": \"odg\",\r\n\t  \"application\\/vnd.oasis.opendocument.graphics-template\": \"otg\",\r\n\t  \"application\\/vnd.oasis.opendocument.image\": \"odi\",\r\n\t  \"application\\/vnd.oasis.opendocument.image-template\": \"oti\",\r\n\t  \"application\\/vnd.oasis.opendocument.presentation\": \"odp\",\r\n\t  \"application\\/vnd.oasis.opendocument.presentation-template\": \"otp\",\r\n\t  \"application\\/vnd.oasis.opendocument.spreadsheet\": \"ods\",\r\n\t  \"application\\/vnd.oasis.opendocument.spreadsheet-template\": \"ots\",\r\n\t  \"application\\/vnd.oasis.opendocument.text\": \"odt\",\r\n\t  \"application\\/vnd.oasis.opendocument.text-master\": \"odm\",\r\n\t  \"application\\/vnd.oasis.opendocument.text-template\": \"ott\",\r\n\t  \"application\\/vnd.oasis.opendocument.text-web\": \"oth\",\r\n\t  \"application\\/vnd.olpc-sugar\": \"xo\",\r\n\t  \"application\\/vnd.oma.dd2+xml\": \"dd2\",\r\n\t  \"application\\/vnd.openofficeorg.extension\": \"oxt\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.presentationml.presentation\": \"pptx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.presentationml.slide\": \"sldx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.presentationml.slideshow\": \"ppsx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.presentationml.template\": \"potx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.spreadsheetml.sheet\": \"xlsx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.spreadsheetml.template\": \"xltx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.wordprocessingml.document\": \"docx\",\r\n\t  \"application\\/vnd.openxmlformats-officedocument.wordprocessingml.template\": \"dotx\",\r\n\t  \"application\\/vnd.osgeo.mapguide.package\": \"mgp\",\r\n\t  \"application\\/vnd.osgi.dp\": \"dp\",\r\n\t  \"application\\/vnd.osgi.subsystem\": \"esa\",\r\n\t  \"application\\/vnd.palm\": \"pdb\",\r\n\t  \"application\\/vnd.pawaafile\": \"paw\",\r\n\t  \"application\\/vnd.pg.format\": \"str\",\r\n\t  \"application\\/vnd.pg.osasli\": \"ei6\",\r\n\t  \"application\\/vnd.picsel\": \"efif\",\r\n\t  \"application\\/vnd.pmi.widget\": \"wg\",\r\n\t  \"application\\/vnd.pocketlearn\": \"plf\",\r\n\t  \"application\\/vnd.powerbuilder6\": \"pbd\",\r\n\t  \"application\\/vnd.previewsystems.box\": \"box\",\r\n\t  \"application\\/vnd.proteus.magazine\": \"mgz\",\r\n\t  \"application\\/vnd.publishare-delta-tree\": \"qps\",\r\n\t  \"application\\/vnd.pvi.ptid1\": \"ptid\",\r\n\t  \"application\\/vnd.quark.quarkxpress\": \"qxd\",\r\n\t  \"application\\/vnd.realvnc.bed\": \"bed\",\r\n\t  \"application\\/vnd.recordare.musicxml\": \"mxl\",\r\n\t  \"application\\/vnd.recordare.musicxml+xml\": \"musicxml\",\r\n\t  \"application\\/vnd.rig.cryptonote\": \"cryptonote\",\r\n\t  \"application\\/vnd.rim.cod\": \"cod\",\r\n\t  \"application\\/vnd.rn-realmedia\": \"rm\",\r\n\t  \"application\\/vnd.rn-realmedia-vbr\": \"rmvb\",\r\n\t  \"application\\/vnd.route66.link66+xml\": \"link66\",\r\n\t  \"application\\/vnd.sailingtracker.track\": \"st\",\r\n\t  \"application\\/vnd.seemail\": \"see\",\r\n\t  \"application\\/vnd.sema\": \"sema\",\r\n\t  \"application\\/vnd.semd\": \"semd\",\r\n\t  \"application\\/vnd.semf\": \"semf\",\r\n\t  \"application\\/vnd.shana.informed.formdata\": \"ifm\",\r\n\t  \"application\\/vnd.shana.informed.formtemplate\": \"itp\",\r\n\t  \"application\\/vnd.shana.informed.interchange\": \"iif\",\r\n\t  \"application\\/vnd.shana.informed.package\": \"ipk\",\r\n\t  \"application\\/vnd.simtech-mindmapper\": \"twd\",\r\n\t  \"application\\/vnd.smaf\": \"mmf\",\r\n\t  \"application\\/vnd.smart.teacher\": \"teacher\",\r\n\t  \"application\\/vnd.solent.sdkm+xml\": \"sdkm\",\r\n\t  \"application\\/vnd.spotfire.dxp\": \"dxp\",\r\n\t  \"application\\/vnd.spotfire.sfs\": \"sfs\",\r\n\t  \"application\\/vnd.stardivision.calc\": \"sdc\",\r\n\t  \"application\\/vnd.stardivision.draw\": \"sda\",\r\n\t  \"application\\/vnd.stardivision.impress\": \"sdd\",\r\n\t  \"application\\/vnd.stardivision.math\": \"smf\",\r\n\t  \"application\\/vnd.stardivision.writer\": \"sdw\",\r\n\t  \"application\\/vnd.stardivision.writer-global\": \"sgl\",\r\n\t  \"application\\/vnd.stepmania.package\": \"smzip\",\r\n\t  \"application\\/vnd.stepmania.stepchart\": \"sm\",\r\n\t  \"application\\/vnd.sun.xml.calc\": \"sxc\",\r\n\t  \"application\\/vnd.sun.xml.calc.template\": \"stc\",\r\n\t  \"application\\/vnd.sun.xml.draw\": \"sxd\",\r\n\t  \"application\\/vnd.sun.xml.draw.template\": \"std\",\r\n\t  \"application\\/vnd.sun.xml.impress\": \"sxi\",\r\n\t  \"application\\/vnd.sun.xml.impress.template\": \"sti\",\r\n\t  \"application\\/vnd.sun.xml.math\": \"sxm\",\r\n\t  \"application\\/vnd.sun.xml.writer\": \"sxw\",\r\n\t  \"application\\/vnd.sun.xml.writer.global\": \"sxg\",\r\n\t  \"application\\/vnd.sun.xml.writer.template\": \"stw\",\r\n\t  \"application\\/vnd.sus-calendar\": \"sus\",\r\n\t  \"application\\/vnd.svd\": \"svd\",\r\n\t  \"application\\/vnd.symbian.install\": \"sis\",\r\n\t  \"application\\/vnd.syncml+xml\": \"xsm\",\r\n\t  \"application\\/vnd.syncml.dm+wbxml\": \"bdm\",\r\n\t  \"application\\/vnd.syncml.dm+xml\": \"xdm\",\r\n\t  \"application\\/vnd.tao.intent-module-archive\": \"tao\",\r\n\t  \"application\\/vnd.tcpdump.pcap\": \"pcap\",\r\n\t  \"application\\/vnd.tmobile-livetv\": \"tmo\",\r\n\t  \"application\\/vnd.trid.tpt\": \"tpt\",\r\n\t  \"application\\/vnd.triscape.mxs\": \"mxs\",\r\n\t  \"application\\/vnd.trueapp\": \"tra\",\r\n\t  \"application\\/vnd.ufdl\": \"ufd\",\r\n\t  \"application\\/vnd.uiq.theme\": \"utz\",\r\n\t  \"application\\/vnd.umajin\": \"umj\",\r\n\t  \"application\\/vnd.unity\": \"unityweb\",\r\n\t  \"application\\/vnd.uoml+xml\": \"uoml\",\r\n\t  \"application\\/vnd.vcx\": \"vcx\",\r\n\t  \"application\\/vnd.visio\": \"vsd\",\r\n\t  \"application\\/vnd.visionary\": \"vis\",\r\n\t  \"application\\/vnd.vsf\": \"vsf\",\r\n\t  \"application\\/vnd.wap.wbxml\": \"wbxml\",\r\n\t  \"application\\/vnd.wap.wmlc\": \"wmlc\",\r\n\t  \"application\\/vnd.wap.wmlscriptc\": \"wmlsc\",\r\n\t  \"application\\/vnd.webturbo\": \"wtb\",\r\n\t  \"application\\/vnd.wolfram.player\": \"nbp\",\r\n\t  \"application\\/vnd.wordperfect\": \"wpd\",\r\n\t  \"application\\/vnd.wqd\": \"wqd\",\r\n\t  \"application\\/vnd.wt.stf\": \"stf\",\r\n\t  \"application\\/vnd.xara\": \"xar\",\r\n\t  \"application\\/vnd.xfdl\": \"xfdl\",\r\n\t  \"application\\/vnd.yamaha.hv-dic\": \"hvd\",\r\n\t  \"application\\/vnd.yamaha.hv-script\": \"hvs\",\r\n\t  \"application\\/vnd.yamaha.hv-voice\": \"hvp\",\r\n\t  \"application\\/vnd.yamaha.openscoreformat\": \"osf\",\r\n\t  \"application\\/vnd.yamaha.openscoreformat.osfpvg+xml\": \"osfpvg\",\r\n\t  \"application\\/vnd.yamaha.smaf-audio\": \"saf\",\r\n\t  \"application\\/vnd.yamaha.smaf-phrase\": \"spf\",\r\n\t  \"application\\/vnd.yellowriver-custom-menu\": \"cmp\",\r\n\t  \"application\\/vnd.zul\": \"zir\",\r\n\t  \"application\\/vnd.zzazz.deck+xml\": \"zaz\",\r\n\t  \"application\\/voicexml+xml\": \"vxml\",\r\n\t  \"application\\/widget\": \"wgt\",\r\n\t  \"application\\/winhlp\": \"hlp\",\r\n\t  \"application\\/wsdl+xml\": \"wsdl\",\r\n\t  \"application\\/wspolicy+xml\": \"wspolicy\",\r\n\t  \"application\\/x-7z-compressed\": \"7z\",\r\n\t  \"application\\/x-abiword\": \"abw\",\r\n\t  \"application\\/x-ace-compressed\": \"ace\",\r\n\t  \"application\\/x-apple-diskimage\": \"dmg\",\r\n\t  \"application\\/x-authorware-bin\": \"aab\",\r\n\t  \"application\\/x-authorware-map\": \"aam\",\r\n\t  \"application\\/x-authorware-seg\": \"aas\",\r\n\t  \"application\\/x-bcpio\": \"bcpio\",\r\n\t  \"application\\/x-bittorrent\": \"torrent\",\r\n\t  \"application\\/x-blorb\": \"blb\",\r\n\t  \"application\\/x-bzip\": \"bz\",\r\n\t  \"application\\/x-cbr\": \"cbr\",\r\n\t  \"application\\/x-cdlink\": \"vcd\",\r\n\t  \"application\\/x-cfs-compressed\": \"cfs\",\r\n\t  \"application\\/x-chat\": \"chat\",\r\n\t  \"application\\/x-chess-pgn\": \"pgn\",\r\n\t  \"application\\/x-conference\": \"nsc\",\r\n\t  \"application\\/x-cpio\": \"cpio\",\r\n\t  \"application\\/x-csh\": \"csh\",\r\n\t  \"application\\/x-debian-package\": \"deb\",\r\n\t  \"application\\/x-dgc-compressed\": \"dgc\",\r\n\t  \"application\\/x-director\": \"dir\",\r\n\t  \"application\\/x-doom\": \"wad\",\r\n\t  \"application\\/x-dtbncx+xml\": \"ncx\",\r\n\t  \"application\\/x-dtbook+xml\": \"dtb\",\r\n\t  \"application\\/x-dtbresource+xml\": \"res\",\r\n\t  \"application\\/x-dvi\": \"dvi\",\r\n\t  \"application\\/x-envoy\": \"evy\",\r\n\t  \"application\\/x-eva\": \"eva\",\r\n\t  \"application\\/x-font-bdf\": \"bdf\",\r\n\t  \"application\\/x-font-ghostscript\": \"gsf\",\r\n\t  \"application\\/x-font-linux-psf\": \"psf\",\r\n\t  \"application\\/x-font-pcf\": \"pcf\",\r\n\t  \"application\\/x-font-snf\": \"snf\",\r\n\t  \"application\\/x-font-type1\": \"pfa\",\r\n\t  \"application\\/x-freearc\": \"arc\",\r\n\t  \"application\\/x-futuresplash\": \"spl\",\r\n\t  \"application\\/x-gca-compressed\": \"gca\",\r\n\t  \"application\\/x-glulx\": \"ulx\",\r\n\t  \"application\\/x-gnumeric\": \"gnumeric\",\r\n\t  \"application\\/x-gramps-xml\": \"gramps\",\r\n\t  \"application\\/x-gtar\": \"gtar\",\r\n\t  \"application\\/x-hdf\": \"hdf\",\r\n\t  \"application\\/x-install-instructions\": \"install\",\r\n\t  \"application\\/x-iso9660-image\": \"iso\",\r\n\t  \"application\\/x-java-jnlp-file\": \"jnlp\",\r\n\t  \"application\\/x-latex\": \"latex\",\r\n\t  \"application\\/x-lzh-compressed\": \"lzh\",\r\n\t  \"application\\/x-mie\": \"mie\",\r\n\t  \"application\\/x-mobipocket-ebook\": \"prc\",\r\n\t  \"application\\/x-ms-application\": \"application\",\r\n\t  \"application\\/x-ms-shortcut\": \"lnk\",\r\n\t  \"application\\/x-ms-wmd\": \"wmd\",\r\n\t  \"application\\/x-ms-wmz\": \"wmz\",\r\n\t  \"application\\/x-ms-xbap\": \"xbap\",\r\n\t  \"application\\/x-msaccess\": \"mdb\",\r\n\t  \"application\\/x-msbinder\": \"obd\",\r\n\t  \"application\\/x-mscardfile\": \"crd\",\r\n\t  \"application\\/x-msclip\": \"clp\",\r\n\t  \"application\\/x-msdownload\": \"dll\",\r\n\t  \"application\\/x-msmediaview\": \"mvb\",\r\n\t  \"application\\/x-msmetafile\": \"wmf\",\r\n\t  \"application\\/x-msmoney\": \"mny\",\r\n\t  \"application\\/x-mspublisher\": \"pub\",\r\n\t  \"application\\/x-msschedule\": \"scd\",\r\n\t  \"application\\/x-msterminal\": \"trm\",\r\n\t  \"application\\/x-mswrite\": \"wri\",\r\n\t  \"application\\/x-netcdf\": \"nc\",\r\n\t  \"application\\/x-nzb\": \"nzb\",\r\n\t  \"application\\/x-pkcs12\": \"p12\",\r\n\t  \"application\\/x-pkcs7-certificates\": \"p7b\",\r\n\t  \"application\\/x-pkcs7-certreqresp\": \"p7r\",\r\n\t  \"application\\/x-research-info-systems\": \"ris\",\r\n\t  \"application\\/x-shar\": \"shar\",\r\n\t  \"application\\/x-shockwave-flash\": \"swf\",\r\n\t  \"application\\/x-silverlight-app\": \"xap\",\r\n\t  \"application\\/x-sql\": \"sql\",\r\n\t  \"application\\/x-stuffit\": \"sit\",\r\n\t  \"application\\/x-stuffitx\": \"sitx\",\r\n\t  \"application\\/x-subrip\": \"srt\",\r\n\t  \"application\\/x-sv4cpio\": \"sv4cpio\",\r\n\t  \"application\\/x-sv4crc\": \"sv4crc\",\r\n\t  \"application\\/x-t3vm-image\": \"t3\",\r\n\t  \"application\\/x-tads\": \"gam\",\r\n\t  \"application\\/x-tar\": \"tar\",\r\n\t  \"application\\/x-tcl\": \"tcl\",\r\n\t  \"application\\/x-tex\": \"tex\",\r\n\t  \"application\\/x-tex-tfm\": \"tfm\",\r\n\t  \"application\\/x-texinfo\": \"texinfo\",\r\n\t  \"application\\/x-tgif\": \"obj\",\r\n\t  \"application\\/x-ustar\": \"ustar\",\r\n\t  \"application\\/x-wais-source\": \"src\",\r\n\t  \"application\\/x-x509-ca-cert\": \"der\",\r\n\t  \"application\\/x-xfig\": \"fig\",\r\n\t  \"application\\/x-xliff+xml\": \"xlf\",\r\n\t  \"application\\/x-xpinstall\": \"xpi\",\r\n\t  \"application\\/x-xz\": \"xz\",\r\n\t  \"application\\/x-zmachine\": \"z1\",\r\n\t  \"application\\/xaml+xml\": \"xaml\",\r\n\t  \"application\\/xcap-diff+xml\": \"xdf\",\r\n\t  \"application\\/xenc+xml\": \"xenc\",\r\n\t  \"application\\/xhtml+xml\": \"xhtml\",\r\n\t  \"application\\/xml\": \"xsl\",\r\n\t  \"application\\/xml-dtd\": \"dtd\",\r\n\t  \"application\\/xop+xml\": \"xop\",\r\n\t  \"application\\/xproc+xml\": \"xpl\",\r\n\t  \"application\\/xslt+xml\": \"xslt\",\r\n\t  \"application\\/xspf+xml\": \"xspf\",\r\n\t  \"application\\/xv+xml\": \"mxml\",\r\n\t  \"application\\/yang\": \"yang\",\r\n\t  \"application\\/yin+xml\": \"yin\",\r\n\t  \"application\\/zip\": \"zip\",\r\n\t  \"audio\\/adpcm\": \"adp\",\r\n\t  \"audio\\/basic\": \"au\",\r\n\t  \"audio\\/midi\": \"mid\",\r\n\t  \"audio\\/mp4\": \"m4a\",\r\n\t  \"audio\\/mpeg\": \"mpga\",\r\n\t  \"audio\\/ogg\": \"oga\",\r\n\t  \"audio\\/s3m\": \"s3m\",\r\n\t  \"audio\\/silk\": \"sil\",\r\n\t  \"audio\\/vnd.dece.audio\": \"uva\",\r\n\t  \"audio\\/vnd.digital-winds\": \"eol\",\r\n\t  \"audio\\/vnd.dra\": \"dra\",\r\n\t  \"audio\\/vnd.dts\": \"dts\",\r\n\t  \"audio\\/vnd.dts.hd\": \"dtshd\",\r\n\t  \"audio\\/vnd.lucent.voice\": \"lvp\",\r\n\t  \"audio\\/vnd.ms-playready.media.pya\": \"pya\",\r\n\t  \"audio\\/vnd.nuera.ecelp4800\": \"ecelp4800\",\r\n\t  \"audio\\/vnd.nuera.ecelp7470\": \"ecelp7470\",\r\n\t  \"audio\\/vnd.nuera.ecelp9600\": \"ecelp9600\",\r\n\t  \"audio\\/vnd.rip\": \"rip\",\r\n\t  \"audio\\/webm\": \"weba\",\r\n\t  \"audio\\/x-aac\": \"aac\",\r\n\t  \"audio\\/x-aiff\": \"aif\",\r\n\t  \"audio\\/x-caf\": \"caf\",\r\n\t  \"audio\\/x-flac\": \"flac\",\r\n\t  \"audio\\/x-matroska\": \"mka\",\r\n\t  \"audio\\/x-mpegurl\": \"m3u\",\r\n\t  \"audio\\/x-ms-wax\": \"wax\",\r\n\t  \"audio\\/x-ms-wma\": \"wma\",\r\n\t  \"audio\\/x-pn-realaudio\": \"ram\",\r\n\t  \"audio\\/x-pn-realaudio-plugin\": \"rmp\",\r\n\t  \"audio\\/xm\": \"xm\",\r\n\t  \"chemical\\/x-cdx\": \"cdx\",\r\n\t  \"chemical\\/x-cif\": \"cif\",\r\n\t  \"chemical\\/x-cmdf\": \"cmdf\",\r\n\t  \"chemical\\/x-cml\": \"cml\",\r\n\t  \"chemical\\/x-csml\": \"csml\",\r\n\t  \"chemical\\/x-xyz\": \"xyz\",\r\n\t  \"font\\/collection\": \"ttc\",\r\n\t  \"font\\/otf\": \"otf\",\r\n\t  \"font\\/ttf\": \"ttf\",\r\n\t  \"font\\/woff\": \"woff\",\r\n\t  \"font\\/woff2\": \"woff2\",\r\n\t  \"image\\/cgm\": \"cgm\",\r\n\t  \"image\\/g3fax\": \"g3\",\r\n\t  \"image\\/gif\": \"gif\",\r\n\t  \"image\\/ief\": \"ief\",\r\n\t  \"image\\/jpeg\": \"jpeg\",\r\n\t  \"image\\/ktx\": \"ktx\",\r\n\t  \"image\\/png\": \"png\",\r\n\t  \"image\\/prs.btif\": \"btif\",\r\n\t  \"image\\/sgi\": \"sgi\",\r\n\t  \"image\\/svg+xml\": \"svg\",\r\n\t  \"image\\/tiff\": \"tiff\",\r\n\t  \"image\\/vnd.adobe.photoshop\": \"psd\",\r\n\t  \"image\\/vnd.dece.graphic\": \"uvi\",\r\n\t  \"image\\/vnd.djvu\": \"djvu\",\r\n\t  \"image\\/vnd.dvb.subtitle\": \"sub\",\r\n\t  \"image\\/vnd.dwg\": \"dwg\",\r\n\t  \"image\\/vnd.dxf\": \"dxf\",\r\n\t  \"image\\/vnd.fastbidsheet\": \"fbs\",\r\n\t  \"image\\/vnd.fpx\": \"fpx\",\r\n\t  \"image\\/vnd.fst\": \"fst\",\r\n\t  \"image\\/vnd.fujixerox.edmics-mmr\": \"mmr\",\r\n\t  \"image\\/vnd.fujixerox.edmics-rlc\": \"rlc\",\r\n\t  \"image\\/vnd.ms-modi\": \"mdi\",\r\n\t  \"image\\/vnd.ms-photo\": \"wdp\",\r\n\t  \"image\\/vnd.net-fpx\": \"npx\",\r\n\t  \"image\\/vnd.wap.wbmp\": \"wbmp\",\r\n\t  \"image\\/vnd.xiff\": \"xif\",\r\n\t  \"image\\/webp\": \"webp\",\r\n\t  \"image\\/x-3ds\": \"3ds\",\r\n\t  \"image\\/x-cmu-raster\": \"ras\",\r\n\t  \"image\\/x-cmx\": \"cmx\",\r\n\t  \"image\\/x-freehand\": \"fh\",\r\n\t  \"image\\/x-icon\": \"ico\",\r\n\t  \"image\\/x-mrsid-image\": \"sid\",\r\n\t  \"image\\/x-pcx\": \"pcx\",\r\n\t  \"image\\/x-pict\": \"pic\",\r\n\t  \"image\\/x-portable-anymap\": \"pnm\",\r\n\t  \"image\\/x-portable-bitmap\": \"pbm\",\r\n\t  \"image\\/x-portable-graymap\": \"pgm\",\r\n\t  \"image\\/x-portable-pixmap\": \"ppm\",\r\n\t  \"image\\/x-rgb\": \"rgb\",\r\n\t  \"image\\/x-xpixmap\": \"xpm\",\r\n\t  \"image\\/x-xwindowdump\": \"xwd\",\r\n\t  \"message\\/rfc822\": \"eml\",\r\n\t  \"model\\/iges\": \"igs\",\r\n\t  \"model\\/mesh\": \"msh\",\r\n\t  \"model\\/vnd.collada+xml\": \"dae\",\r\n\t  \"model\\/vnd.dwf\": \"dwf\",\r\n\t  \"model\\/vnd.gdl\": \"gdl\",\r\n\t  \"model\\/vnd.gtw\": \"gtw\",\r\n\t  \"model\\/vnd.vtu\": \"vtu\",\r\n\t  \"model\\/vrml\": \"wrl\",\r\n\t  \"model\\/x3d+binary\": \"x3db\",\r\n\t  \"model\\/x3d+vrml\": \"x3dv\",\r\n\t  \"model\\/x3d+xml\": \"x3d\",\r\n\t  \"text\\/cache-manifest\": \"appcache\",\r\n\t  \"text\\/calendar\": \"ics\",\r\n\t  \"text\\/css\": \"css\",\r\n\t  \"text\\/csv\": \"csv\",\r\n\t  \"text\\/html\": \"html\",\r\n\t  \"text\\/n3\": \"n3\",\r\n\t  \"text\\/plain\": \"txt\",\r\n\t  \"text\\/prs.lines.tag\": \"dsc\",\r\n\t  \"text\\/richtext\": \"rtx\",\r\n\t  \"text\\/sgml\": \"sgml\",\r\n\t  \"text\\/tab-separated-values\": \"tsv\",\r\n\t  \"text\\/troff\": \"t\",\r\n\t  \"text\\/turtle\": \"ttl\",\r\n\t  \"text\\/uri-list\": \"uri\",\r\n\t  \"text\\/vcard\": \"vcard\",\r\n\t  \"text\\/vnd.curl\": \"curl\",\r\n\t  \"text\\/vnd.curl.dcurl\": \"dcurl\",\r\n\t  \"text\\/vnd.curl.mcurl\": \"mcurl\",\r\n\t  \"text\\/vnd.curl.scurl\": \"scurl\",\r\n\t  \"text\\/vnd.fly\": \"fly\",\r\n\t  \"text\\/vnd.fmi.flexstor\": \"flx\",\r\n\t  \"text\\/vnd.graphviz\": \"gv\",\r\n\t  \"text\\/vnd.in3d.3dml\": \"3dml\",\r\n\t  \"text\\/vnd.in3d.spot\": \"spot\",\r\n\t  \"text\\/vnd.sun.j2me.app-descriptor\": \"jad\",\r\n\t  \"text\\/vnd.wap.wml\": \"wml\",\r\n\t  \"text\\/vnd.wap.wmlscript\": \"wmls\",\r\n\t  \"text\\/x-asm\": \"s\",\r\n\t  \"text\\/x-c\": \"cc\",\r\n\t  \"text\\/x-fortran\": \"f\",\r\n\t  \"text\\/x-java-source\": \"java\",\r\n\t  \"text\\/x-nfo\": \"nfo\",\r\n\t  \"text\\/x-opml\": \"opml\",\r\n\t  \"text\\/x-pascal\": \"p\",\r\n\t  \"text\\/x-setext\": \"etx\",\r\n\t  \"text\\/x-sfv\": \"sfv\",\r\n\t  \"text\\/x-uuencode\": \"uu\",\r\n\t  \"text\\/x-vcalendar\": \"vcs\",\r\n\t  \"text\\/x-vcard\": \"vcf\",\r\n\t  \"video\\/3gpp\": \"3gp\",\r\n\t  \"video\\/3gpp2\": \"3g2\",\r\n\t  \"video\\/h261\": \"h261\",\r\n\t  \"video\\/h263\": \"h263\",\r\n\t  \"video\\/h264\": \"h264\",\r\n\t  \"video\\/jpeg\": \"jpgv\",\r\n\t  \"video\\/jpm\": \"jpm\",\r\n\t  \"video\\/mj2\": \"mj2\",\r\n\t  \"video\\/mp4\": \"mp4\",\r\n\t  \"video\\/mpeg\": \"mpeg\",\r\n\t  \"video\\/quicktime\": \"qt\",\r\n\t  \"video\\/vnd.dece.hd\": \"uvh\",\r\n\t  \"video\\/vnd.dece.mobile\": \"uvm\",\r\n\t  \"video\\/vnd.dece.pd\": \"uvp\",\r\n\t  \"video\\/vnd.dece.sd\": \"uvs\",\r\n\t  \"video\\/vnd.dece.video\": \"uvv\",\r\n\t  \"video\\/vnd.dvb.file\": \"dvb\",\r\n\t  \"video\\/vnd.fvt\": \"fvt\",\r\n\t  \"video\\/vnd.mpegurl\": \"mxu\",\r\n\t  \"video\\/vnd.ms-playready.media.pyv\": \"pyv\",\r\n\t  \"video\\/vnd.uvvu.mp4\": \"uvu\",\r\n\t  \"video\\/vnd.vivo\": \"viv\",\r\n\t  \"video\\/webm\": \"webm\",\r\n\t  \"video\\/x-f4v\": \"f4v\",\r\n\t  \"video\\/x-fli\": \"fli\",\r\n\t  \"video\\/x-flv\": \"flv\",\r\n\t  \"video\\/x-m4v\": \"m4v\",\r\n\t  \"video\\/x-matroska\": \"mkv\",\r\n\t  \"video\\/x-mng\": \"mng\",\r\n\t  \"video\\/x-ms-asf\": \"asf\",\r\n\t  \"video\\/x-ms-vob\": \"vob\",\r\n\t  \"video\\/x-ms-wmx\": \"wmx\",\r\n\t  \"video\\/x-ms-wvx\": \"wvx\",\r\n\t  \"video\\/x-msvideo\": \"avi\",\r\n\t  \"video\\/x-sgi-movie\": \"movie\",\r\n\t  \"video\\/x-smv\": \"smv\",\r\n\t  \"x-conference\\/x-cooltalk\": \"ice\",\r\n\t  \"text\\/x-sql\": \"sql\",\r\n\t  \"image\\/x-pixlr-data\": \"pxd\",\r\n\t  \"image\\/x-adobe-dng\": \"dng\",\r\n\t  \"image\\/x-sketch\": \"sketch\",\r\n\t  \"image\\/x-xcf\": \"xcf\",\r\n\t  \"audio\\/amr\": \"amr\",\r\n\t  \"image\\/vnd-ms.dds\": \"dds\",\r\n\t  \"application\\/plt\": \"plt\",\r\n\t  \"application\\/sat\": \"sat\",\r\n\t  \"application\\/step\": \"step\",\r\n\t  \"text\\/x-httpd-cgi\": \"cgi\",\r\n\t  \"text\\/x-asap\": \"asp\",\r\n\t  \"text\\/x-jsp\": \"jsp\"\r\n\t};\r\n\r\n\r\n\treturn elFinder;\r\n});\r\n\ndefine('skylark-elfinder/options',[\n\t\"./elFinder\"\n],function(elFinder) {\t\n\t/**\n\n\t * Default elFinder config\n\t *\n\t * @type  Object\n\t * @autor Dmitry (dio) Levashov\n\t */\n\telFinder.prototype._options = {\n\t\t/**\n\t\t * URLs of 3rd party libraries CDN\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tcdns : {\n\t\t\t// for editor etc.\n\t\t\tace        : 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8',\n\t\t\tcodemirror : 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.0',\n\t\t\tckeditor   : 'https://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.12.1',\n\t\t\tckeditor5  : 'https://cdn.ckeditor.com/ckeditor5/17.0.0',\n\t\t\ttinymce    : 'https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.2.0',\n\t\t\tsimplemde  : 'https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2',\n\t\t\tfabric     : 'https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.2',\n\t\t\tfabric16   : 'https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7',\n\t\t\ttui        : 'https://uicdn.toast.com',\n\t\t\t// for quicklook etc.\n\t\t\thls        : 'https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.13.2/hls.min.js',\n\t\t\tdash       : 'https://cdnjs.cloudflare.com/ajax/libs/dashjs/3.0.2/dash.all.min.js',\n\t\t\tflv        : 'https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.5.0/flv.min.js',\n\t\t\tvideojs    : 'https://cdnjs.cloudflare.com/ajax/libs/video.js/7.7.4',\n\t\t\tprettify   : 'https://cdn.jsdelivr.net/gh/google/code-prettify@f1c3473acd1e8ea8c8c1a60c56e89f5cdd06f915/loader/run_prettify.js',\n\t\t\tpsd        : 'https://cdnjs.cloudflare.com/ajax/libs/psd.js/3.2.0/psd.min.js',\n\t\t\trar        : 'https://cdn.jsdelivr.net/gh/nao-pon/rar.js@6cef13ec66dd67992fc7f3ea22f132d770ebaf8b/rar.min.js',\n\t\t\tzlibUnzip  : 'https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/unzip.min.js', // need check unzipFiles() in quicklook.plugins.js when update\n\t\t\tzlibGunzip : 'https://cdn.jsdelivr.net/gh/imaya/zlib.js@0.3.1/bin/gunzip.min.js',\n\t\t\tbzip2      : 'https://cdn.jsdelivr.net/gh/nao-pon/bzip2.js@0.8.0/bzip2.js',\n\t\t\tmarked     : 'https://cdnjs.cloudflare.com/ajax/libs/marked/0.7.0/marked.min.js',\n\t\t\tsparkmd5   : 'https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.min.js',\n\t\t\tjssha      : 'https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha.js',\n\t\t\tamr        : 'https://cdn.jsdelivr.net/gh/yxl/opencore-amr-js@dcf3d2b5f384a1d9ded2a54e4c137a81747b222b/js/amrnb.js',\n\t\t\ttiff       : 'https://cdn.jsdelivr.net/gh/seikichi/tiff.js@545ede3ee46b5a5bc5f06d65954e775aa2a64017/tiff.min.js'\n\t\t},\n\t\t\n\t\t/**\n\t\t * Connector url. Required!\n\t\t *\n\t\t * @type String\n\t\t */\n\t\turl : '',\n\n\t\t/**\n\t\t * Ajax request type.\n\t\t *\n\t\t * @type String\n\t\t * @default \"get\"\n\t\t */\n\t\trequestType : 'get',\n\t\t\n\t\t/**\n\t\t * Use CORS to connector url\n\t\t * \n\t\t * @type Boolean|null  true|false|null(Auto detect)\n\t\t */\n\t\tcors : null,\n\n\t\t/**\n\t\t * Array of header names to return parrot out in HTTP headers received from the server\n\t\t * \n\t\t * @type Array\n\t\t */\n\t\tparrotHeaders : [],\n\n\t\t/**\n\t\t * Maximum number of concurrent connections on request\n\t\t * \n\t\t * @type Number\n\t\t * @default 3\n\t\t */\n\t\trequestMaxConn : 3,\n\n\t\t/**\n\t\t * Transport to send request to backend.\n\t\t * Required for future extensions using websockets/webdav etc.\n\t\t * Must be an object with \"send\" method.\n\t\t * transport.send must return $.Deferred() object\n\t\t *\n\t\t * @type Object\n\t\t * @default null\n\t\t * @example\n\t\t *  transport : {\n\t\t *    init : function(elfinderInstance) { },\n\t\t *    send : function(options) {\n\t\t *      var dfrd = $.Deferred();\n\t\t *      // connect to backend ...\n\t\t *      return dfrd;\n\t\t *    },\n\t\t *    upload : function(data) {\n\t\t *      var dfrd = $.Deferred();\n\t\t *      // upload ...\n\t\t *      return dfrd;\n\t\t *    }\n\t\t *    \n\t\t *  }\n\t\t **/\n\t\ttransport : {},\n\n\t\t/**\n\t\t * URL to upload file to.\n\t\t * If not set - connector URL will be used\n\t\t *\n\t\t * @type String\n\t\t * @default  ''\n\t\t */\n\t\turlUpload : '',\n\n\t\t/**\n\t\t * Allow to drag and drop to upload files\n\t\t *\n\t\t * @type Boolean|String\n\t\t * @default  'auto'\n\t\t */\n\t\tdragUploadAllow : 'auto',\n\t\t\n\t\t/**\n\t\t * Confirmation dialog displayed at the time of overwriting upload\n\t\t * \n\t\t * @type Boolean\n\t\t * @default true\n\t\t */\n\t\toverwriteUploadConfirm : true,\n\t\t\n\t\t/**\n\t\t * Max size of chunked data of file upload\n\t\t * \n\t\t * @type Number\n\t\t * @default  10485760(10MB)\n\t\t */\n\t\tuploadMaxChunkSize : 10485760,\n\t\t\n\t\t/**\n\t\t * Regular expression of file name to exclude when uploading folder\n\t\t * \n\t\t * @type Object\n\t\t * @default { win: /^(?:desktop\\.ini|thumbs\\.db)$/i, mac: /^\\.ds_store$/i }\n\t\t */\n\t\tfolderUploadExclude : {\n\t\t\twin: /^(?:desktop\\.ini|thumbs\\.db)$/i,\n\t\t\tmac: /^\\.ds_store$/i\n\t\t},\n\t\t\n\t\t/**\n\t\t * Timeout for upload using iframe\n\t\t *\n\t\t * @type Number\n\t\t * @default  0 - no timeout\n\t\t */\n\t\tiframeTimeout : 0,\n\t\t\n\t\t/**\n\t\t * Data to append to all requests and to upload files\n\t\t *\n\t\t * @type Object\n\t\t * @default  {}\n\t\t */\n\t\tcustomData : {},\n\t\t\n\t\t/**\n\t\t * Event listeners to bind on elFinder init\n\t\t *\n\t\t * @type Object\n\t\t * @default  {}\n\t\t */\n\t\thandlers : {},\n\n\t\t/**\n\t\t * Any custom headers to send across every ajax request\n\t\t *\n\t\t * @type Object\n\t\t * @default {}\n\t\t */\n\t\tcustomHeaders : {},\n\n\t\t/**\n\t\t * Any custom xhrFields to send across every ajax request\n\t\t *\n\t\t * @type Object\n\t\t * @default {}\n\t\t */\n\t\txhrFields : {},\n\n\t\t/**\n\t\t * Interface language\n\t\t *\n\t\t * @type String\n\t\t * @default \"en\"\n\t\t */\n\t\tlang : 'en',\n\n\t\t/**\n\t\t * Base URL of elfFinder library starting from Manager HTML\n\t\t * Auto detect when empty value\n\t\t * \n\t\t * @type String\n\t\t * @default \"\"\n\t\t */\n\t\tbaseUrl : '',\n\n\t\t/**\n\t\t * Base URL of i18n js files\n\t\t * baseUrl + \"js/i18n/\" when empty value\n\t\t * \n\t\t * @type String\n\t\t * @default \"\"\n\t\t */\n\t\ti18nBaseUrl : '',\n\t\t\n\t\t/**\n\t\t * Auto load required CSS\n\t\t * `false` to disable this function or\n\t\t * CSS URL Array to load additional CSS files\n\t\t * \n\t\t * @type Boolean|Array\n\t\t * @default true\n\t\t */\n\t\tcssAutoLoad : true,\n\n\t\t/**\n\t\t * Theme to load\n\t\t * {\"themeid\" : \"Theme CSS URL\"} or\n\t\t * {\"themeid\" : \"Theme manifesto.json URL\"} or\n\t\t * Theme manifesto.json Object\n\t\t * {\n\t\t *   \"themeid\" : {\n\t\t *     \"name\":\"Theme Name\",\n\t\t *     \"cssurls\":\"Theme CSS URL\",\n\t\t *     \"author\":\"Author Name\",\n\t\t *     \"email\":\"Author Email\",\n\t\t *     \"license\":\"License\",\n\t\t *     \"link\":\"Web Site URL\",\n\t\t *     \"image\":\"Screen Shot URL\",\n\t\t *     \"description\":\"Description\"\n\t\t *   }\n\t\t * }\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tthemes : {},\n\n\t\t/**\n\t\t * Theme id to initial theme\n\t\t * \n\t\t * @type String|Null\n\t\t */\n\t\ttheme : null,\n\n\t\t/**\n\t\t * Maximum value of error dialog open at the same time\n\t\t * \n\t\t * @type Number\n\t\t */\n\t\tmaxErrorDialogs : 5,\n\n\t\t/**\n\t\t * Additional css class for filemanager node.\n\t\t *\n\t\t * @type String\n\t\t */\n\t\tcssClass : '',\n\n\t\t/**\n\t\t * Active commands list. '*' means all of the commands that have been load.\n\t\t * If some required commands will be missed here, elFinder will add its\n\t\t *\n\t\t * @type Array\n\t\t */\n\t\tcommands : ['*'],\n\t\t// Available commands list\n\t\t//commands : [\n\t\t//\t'archive', 'back', 'chmod', 'colwidth', 'copy', 'cut', 'download', 'duplicate', 'edit', 'extract',\n\t\t//\t'forward', 'fullscreen', 'getfile', 'help', 'home', 'info', 'mkdir', 'mkfile', 'netmount', 'netunmount',\n\t\t//\t'open', 'opendir', 'paste', 'places', 'quicklook', 'reload', 'rename', 'resize', 'restore', 'rm',\n\t\t//\t'search', 'sort', 'up', 'upload', 'view', 'zipdl'\n\t\t//],\n\t\t\n\t\t/**\n\t\t * Commands options.\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tcommandsOptions : {\n\t\t\t// // configure shortcuts of any command\n\t\t\t// // add `shortcuts` property into each command\n\t\t\t// any_command_name : {\n\t\t\t// \tshortcuts : [] // for disable this command's shortcuts\n\t\t\t// },\n\t\t\t// any_command_name : {\n\t\t\t// \tshortcuts : function(fm, shortcuts) {\n\t\t\t// \t\t// for add `CTRL + E` for this command action\n\t\t\t// \t\tshortcuts[0]['pattern'] += ' ctrl+e';\n\t\t\t// \t\treturn shortcuts;\n\t\t\t// \t}\n\t\t\t// },\n\t\t\t// any_command_name : {\n\t\t\t// \tshortcuts : function(fm, shortcuts) {\n\t\t\t// \t\t// for full customize of this command's shortcuts\n\t\t\t// \t\treturn [ { pattern: 'ctrl+e ctrl+down numpad_enter' + (fm.OS != 'mac' && ' enter') } ];\n\t\t\t// \t}\n\t\t\t// },\n\t\t\t// \"getfile\" command options.\n\t\t\tgetfile : {\n\t\t\t\tonlyURL  : false,\n\t\t\t\t// allow to return multiple files info\n\t\t\t\tmultiple : false,\n\t\t\t\t// allow to return filers info\n\t\t\t\tfolders  : false,\n\t\t\t\t// action after callback (\"\"/\"close\"/\"destroy\")\n\t\t\t\toncomplete : '',\n\t\t\t\t// action when callback is fail (\"\"/\"close\"/\"destroy\")\n\t\t\t\tonerror : '',\n\t\t\t\t// get path before callback call\n\t\t\t\tgetPath    : true, \n\t\t\t\t// get image sizes before callback call\n\t\t\t\tgetImgSize : false\n\t\t\t},\n\t\t\topen : {\n\t\t\t\t// HTTP method that request to the connector when item URL is not valid URL.\n\t\t\t\t// If you set to \"get\" will be displayed request parameter in the browser's location field\n\t\t\t\t// so if you want to conceal its parameters should be given \"post\".\n\t\t\t\t// Nevertheless, please specify \"get\" if you want to enable the partial request by HTTP Range header.\n\t\t\t\tmethod : 'post',\n\t\t\t\t// Where to open into : 'window'(default), 'tab' or 'tabs'\n\t\t\t\t// 'tabs' opens in each tabs\n\t\t\t\tinto   : 'window',\n\t\t\t\t// Default command list of action when select file\n\t\t\t\t// String value that is 'Command Name' or 'Command Name1/CommandName2...'\n\t\t\t\tselectAction : 'open'\n\t\t\t},\n\t\t\topennew : {\n\t\t\t\t// URL of to open elFinder manager\n\t\t\t\t// Default '' : Origin URL\n\t\t\t\turl : '',\n\t\t\t\t// Use search query of origin URL\n\t\t\t\tuseOriginQuery : true\n\t\t\t},\n\t\t\t// \"upload\" command options.\n\t\t\tupload : {\n\t\t\t\t// Open elFinder upload dialog: 'button' OR Open system OS upload dialog: 'uploadbutton'\n\t\t\t\tui : 'button'\n\t\t\t},\n\t\t\t// \"download\" command options.\n\t\t\tdownload : {\n\t\t\t\t// max request to download files when zipdl disabled\n\t\t\t\tmaxRequests : 10,\n\t\t\t\t// minimum count of files to use zipdl\n\t\t\t\tminFilesZipdl : 2\n\t\t\t},\n\t\t\t// \"quicklook\" command options.\n\t\t\tquicklook : {\n\t\t\t\tautoplay : true,\n\t\t\t\twidth    : 450,\n\t\t\t\theight   : 300,\n\t\t\t\t// ControlsList of HTML5 audio/video preview\n\t\t\t\t// see https://googlechrome.github.io/samples/media/controlslist.html\n\t\t\t\tmediaControlsList : '', // e.g. 'nodownload nofullscreen noremoteplayback'\n\t\t\t\t// Show toolbar of PDF preview (with <embed> tag)\n\t\t\t\tpdfToolbar : true,\n\t\t\t\t// Maximum lines to preview at initial\n\t\t\t\ttextInitialLines : 100,\n\t\t\t\t// Maximum lines to preview by prettify\n\t\t\t\tprettifyMaxLines : 300,\n\t\t\t\t// quicklook window must be contained in elFinder node on window open (true|false)\n\t\t\t\tcontain : false,\n\t\t\t\t// preview window into NavDock (0 : undocked | 1 : docked(show) | 2 : docked(hide))\n\t\t\t\tdocked   : 0,\n\t\t\t\t// Docked preview height ('auto' or Number of pixel) 'auto' is setted to the Navbar width\n\t\t\t\tdockHeight : 'auto',\n\t\t\t\t// media auto play when docked\n\t\t\t\tdockAutoplay : false,\n\t\t\t\t// Google Maps API key (Require Maps JavaScript API)\n\t\t\t\tgoogleMapsApiKey : '',\n\t\t\t\t// Google Maps API Options\n\t\t\t\tgoogleMapsOpts : {\n\t\t\t\t\tmaps : {},\n\t\t\t\t\tkml : {\n\t\t\t\t\t\tsuppressInfoWindows : false,\n\t\t\t\t\t\tpreserveViewport : false\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// ViewerJS (https://viewerjs.org/) Options\n\t\t\t\t// To enable this you need to place ViewerJS on the same server as elFinder and specify that URL in `url`.\n\t\t\t\tviewerjs : {\n\t\t\t\t\turl: '', // Example '/ViewerJS/index.html'\n\t\t\t\t\tmimes: ['application/pdf', 'application/vnd.oasis.opendocument.text', 'application/vnd.oasis.opendocument.spreadsheet', 'application/vnd.oasis.opendocument.presentation'],\n\t\t\t\t\tpdfNative: true // Use Native PDF Viewer first\n\t\t\t\t},\n\t\t\t\t// MIME types to CAD-Files and 3D-Models online viewer on sharecad.org\n\t\t\t\t// Example ['image/vnd.dwg', 'image/vnd.dxf', 'model/vnd.dwf', 'application/vnd.hp-hpgl', 'application/plt', 'application/step', 'model/iges', 'application/vnd.ms-pki.stl', 'application/sat', 'image/cgm', 'application/x-msmetafile']\n\t\t\t\tsharecadMimes : [],\n\t\t\t\t// MIME types to use Google Docs online viewer\n\t\t\t\t// Example ['application/pdf', 'image/tiff', 'application/vnd.ms-office', 'application/msword', 'application/vnd.ms-word', 'application/vnd.ms-excel', 'application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'application/postscript', 'application/rtf']\n\t\t\t\tgoogleDocsMimes : [],\n\t\t\t\t// MIME types to use Microsoft Office Online viewer\n\t\t\t\t// Example ['application/msword', 'application/vnd.ms-word', 'application/vnd.ms-excel', 'application/vnd.ms-powerpoint', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'application/vnd.oasis.opendocument.text', 'application/vnd.oasis.opendocument.spreadsheet', 'application/vnd.oasis.opendocument.presentation']\n\t\t\t\t// These MIME types override \"googleDocsMimes\"\n\t\t\t\tofficeOnlineMimes : [],\n\t\t\t\t// File size threshold when using the dim command for obtain the image size necessary to image preview\n\t\t\t\tgetDimThreshold : '200K',\n\t\t\t\t// Max filesize to show filenames of the zip/tar/gzip/bzip file \n\t\t\t\tunzipMaxSize : '50M',\n\t\t\t\t// MIME-Type regular expression that does not check empty files\n\t\t\t\tmimeRegexNotEmptyCheck : /^application\\/vnd\\.google-apps\\./\n\t\t\t},\n\t\t\t// \"edit\" command options.\n\t\t\tedit : {\n\t\t\t\t// dialog width, integer(px) or integer+'%' (example: 650, '80%' ...)\n\t\t\t\tdialogWidth : void(0),\n\t\t\t\t// dialog height, integer(px) or integer+'%' (example: 650, '80%' ...)\n\t\t\t\tdialogHeight : void(0),\n\t\t\t\t// list of allowed mimetypes to edit of text files\n\t\t\t\t// if empty - any text files can be edited\n\t\t\t\tmimes : [],\n\t\t\t\t// MIME-types to unselected as default of \"File types to enable with \"New file\"\" in preferences\n\t\t\t\tmkfileHideMimes : [],\n\t\t\t\t// MIME-types of text file to make empty file\n\t\t\t\tmakeTextMimes : ['text/plain', 'text/css', 'text/html'],\n\t\t\t\t// Use the editor stored in the browser\n\t\t\t\t// This value allowd overwrite with user preferences\n\t\t\t\tuseStoredEditor : false,\n\t\t\t\t// Open the maximized editor window\n\t\t\t\t// This value allowd overwrite with user preferences\n\t\t\t\teditorMaximized : false,\n\t\t\t\t// edit files in wysisyg's\n\t\t\t\teditors : [\n\t\t\t\t\t// {\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * editor info\n\t\t\t\t\t// \t * @type  Object\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tinfo : { name: 'Editor Name' },\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * files mimetypes allowed to edit in current wysisyg\n\t\t\t\t\t// \t * @type  Array\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tmimes : ['text/html'], \n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * HTML element for editing area (optional for text editor)\n\t\t\t\t\t// \t * @type  String\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \thtml : '<textarea></textarea>', \n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Initialize editing area node (optional for text editor)\n\t\t\t\t\t// \t * \n\t\t\t\t\t// \t * @param  String  dialog DOM id\n\t\t\t\t\t// \t * @param  Object  target file object\n\t\t\t\t\t// \t * @param  String  target file content (text or Data URI Scheme(binary file))\n\t\t\t\t\t// \t * @param  Object  elFinder instance\n\t\t\t\t\t// \t * @type  Function\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tinit : function(id, file, content, fm) {\n\t\t\t\t\t// \t\t$(this).attr('id', id + '-text').val(content);\n\t\t\t\t\t// \t},\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Get edited contents (optional for text editor)\n\t\t\t\t\t// \t * @type  Function\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tgetContent : function() {\n\t\t\t\t\t// \t\treturn $(this).val();\n\t\t\t\t\t// \t},\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Called when \"edit\" dialog loaded.\n\t\t\t\t\t// \t * Place to init wysisyg.\n\t\t\t\t\t// \t * Can return wysisyg instance\n\t\t\t\t\t// \t *\n\t\t\t\t\t// \t * @param  DOMElement  textarea node\n\t\t\t\t\t// \t * @return Object      editor instance|jQuery.Deferred(return instance on resolve())\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tload : function(textarea) { },\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Called before \"edit\" dialog closed.\n\t\t\t\t\t// \t * Place to destroy wysisyg instance.\n\t\t\t\t\t// \t *\n\t\t\t\t\t// \t * @param  DOMElement  textarea node\n\t\t\t\t\t// \t * @param  Object      wysisyg instance (if was returned by \"load\" callback)\n\t\t\t\t\t// \t * @return void\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tclose : function(textarea, instance) { },\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Called before file content send to backend.\n\t\t\t\t\t// \t * Place to update textarea content if needed.\n\t\t\t\t\t// \t *\n\t\t\t\t\t// \t * @param  DOMElement  textarea node\n\t\t\t\t\t// \t * @param  Object      wysisyg instance (if was returned by \"load\" callback)\n\t\t\t\t\t// \t * @return void\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tsave : function(textarea, instance) {},\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Called after load() or save().\n\t\t\t\t\t// \t * Set focus to wysisyg editor.\n\t\t\t\t\t// \t *\n\t\t\t\t\t// \t * @param  DOMElement  textarea node\n\t\t\t\t\t// \t * @param  Object      wysisyg instance (if was returned by \"load\" callback)\n\t\t\t\t\t// \t * @return void\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tfocus : function(textarea, instance) {}\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Called after dialog resized..\n\t\t\t\t\t// \t *\n\t\t\t\t\t// \t * @param  DOMElement  textarea node\n\t\t\t\t\t// \t * @param  Object      wysisyg instance (if was returned by \"load\" callback)\n\t\t\t\t\t// \t * @param  Object      resize event object\n\t\t\t\t\t// \t * @param  Object      data object\n\t\t\t\t\t// \t * @return void\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tresize : function(textarea, instance, event, data) {}\n\t\t\t\t\t// \n\t\t\t\t\t// }\n\t\t\t\t],\n\t\t\t\t// Character encodings of select box\n\t\t\t\tencodings : ['Big5', 'Big5-HKSCS', 'Cp437', 'Cp737', 'Cp775', 'Cp850', 'Cp852', 'Cp855', 'Cp857', 'Cp858', \n\t\t\t\t\t'Cp862', 'Cp866', 'Cp874', 'EUC-CN', 'EUC-JP', 'EUC-KR', 'GB18030', 'ISO-2022-CN', 'ISO-2022-JP', 'ISO-2022-KR', \n\t\t\t\t\t'ISO-8859-1', 'ISO-8859-2', 'ISO-8859-3', 'ISO-8859-4', 'ISO-8859-5', 'ISO-8859-6', 'ISO-8859-7', \n\t\t\t\t\t'ISO-8859-8', 'ISO-8859-9', 'ISO-8859-13', 'ISO-8859-15', 'KOI8-R', 'KOI8-U', 'Shift-JIS', \n\t\t\t\t\t'Windows-1250', 'Windows-1251', 'Windows-1252', 'Windows-1253', 'Windows-1254', 'Windows-1257'],\n\t\t\t\t// options for extra editors\n\t\t\t\textraOptions : {\n\t\t\t\t\t// upload command options\n\t\t\t\t\tuploadOpts : {},\n\t\t\t\t\t// TUI Image Editor's options\n\t\t\t\t\ttuiImgEditOpts : {\n\t\t\t\t\t\t// Path prefix of icon-a.svg, icon-b.svg, icon-c.svg and icon-d.svg in the Theme. \n\t\t\t\t\t\t// `iconsPath` MUST follow the same origin policy.\n\t\t\t\t\t\ticonsPath : void(0), // default is \"./img/tui-\"\n\t\t\t\t\t\t// Theme object\n\t\t\t\t\t\ttheme : {}\n\t\t\t\t\t},\n\t\t\t\t\t// Pixo image editor constructor options - https://pixoeditor.com/\n\t\t\t\t\t// Require 'apikey' to enable it\n\t\t\t\t\tpixo: {\n\t\t\t\t\t\tapikey: ''\n\t\t\t\t\t},\n\t\t\t\t\t// Browsing manager URL for CKEditor, TinyMCE\n\t\t\t\t\t// Uses self location with the empty value or not defined.\n\t\t\t\t\t//managerUrl : 'elfinder.html'\n\t\t\t\t\tmanagerUrl : null,\n\t\t\t\t\t// CKEditor editor options\n\t\t\t\t\tckeditor: {},\n\t\t\t\t\t// CKEditor 5 editor options\n\t\t\t\t\tckeditor5: {\n\t\t\t\t\t\t// builds mode - 'classic', 'inline', 'balloon', 'balloon-block' or 'decoupled-document'\n\t\t\t\t\t\tmode: 'decoupled-document'\n\t\t\t\t\t},\n\t\t\t\t\t// TinyMCE editor options\n\t\t\t\t\ttinymce : {},\n\t\t\t\t\t// Setting for Online-Convert.com\n\t\t\t\t\tonlineConvert : {\n\t\t\t\t\t\tmaxSize  : 100, // (MB) Max 100MB on free account\n\t\t\t\t\t\tshowLink : true // It must be enabled with free account\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tfullscreen : {\n\t\t\t\t// fullscreen mode 'screen'(When the browser supports it) or 'window'\n\t\t\t\tmode: 'screen' // 'screen' or 'window'\n\t\t\t},\n\t\t\tsearch : {\n\t\t\t\t// Incremental search from the current view\n\t\t\t\tincsearch : {\n\t\t\t\t\tenable : true, // is enable true or false\n\t\t\t\t\tminlen : 1,    // minimum number of characters\n\t\t\t\t\twait   : 500   // wait milliseconds\n\t\t\t\t},\n\t\t\t\t// Additional search types\n\t\t\t\tsearchTypes : {\n\t\t\t\t\t// \"SearchMime\" is implemented in default\n\t\t\t\t\tSearchMime : {           // The key is search type that send to the connector\n\t\t\t\t\t\tname : 'btnMime',    // Button text to be processed in i18n()\n\t\t\t\t\t\ttitle : 'searchMime',// Button title to be processed in i18n()\n\t\t\t\t\t\tincsearch : 'mime'   // Incremental search target filed name of the file object\n\t\t\t\t\t\t// Or Callable function\n\t\t\t\t\t\t/* incsearch function example\n\t\t\t\t\t\tfunction(queryObject, cwdHashes, elFinderInstance) {\n\t\t\t\t\t\t\tvar q = queryObject.val;\n\t\t\t\t\t\t\tvar regex = queryObject.regex;\n\t\t\t\t\t\t\tvar matchedHashes = $.grep(cwdHashes, function(hash) {\n\t\t\t\t\t\t\t\tvar file = elFinderInstance.file(hash);\n\t\t\t\t\t\t\t\treturn (file && file.mime && file.mime.match(regex))? true : false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn matchedHashes;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t*/\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t// \"info\" command options.\n\t\t\tinfo : {\n\t\t\t\t// If the URL of the Directory is null,\n\t\t\t\t// it is assumed that the link destination is a URL to open the folder in elFinder\n\t\t\t\tnullUrlDirLinkSelf : true,\n\t\t\t\t// Information items to be hidden by default\n\t\t\t\t// These name are 'size', 'aliasfor', 'path', 'link', 'dim', 'modify', 'perms', 'locked', 'owner', 'group', 'perm' and your custom info items label\n\t\t\t\thideItems : [],\n\t\t\t\t// Maximum file size (byte) to get file contents hash (md5, sha256 ...)\n\t\t\t\tshowHashMaxsize : 104857600, // 100 MB\n\t\t\t\t// Array of hash algorisms to show on info dialog\n\t\t\t\t// These name are 'md5', 'sha1', 'sha224', 'sha256', 'sha384', 'sha512', 'sha3-224', 'sha3-256', 'sha3-384', 'sha3-512', 'shake128' and 'shake256'\n\t\t\t\tshowHashAlgorisms : ['md5', 'sha256'],\n\t\t\t\t// Options for fm.getContentsHashes()\n\t\t\t\tshowHashOpts : {\n\t\t\t\t\tshake128len : 256,\n\t\t\t\t\tshake256len : 512\n\t\t\t\t},\n\t\t\t\tcustom : {\n\t\t\t\t\t// /**\n\t\t\t\t\t//  * Example of custom info `desc`\n\t\t\t\t\t//  */\n\t\t\t\t\t// desc : {\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Lable (require)\n\t\t\t\t\t// \t * It is filtered by the `fm.i18n()`\n\t\t\t\t\t// \t * \n\t\t\t\t\t// \t * @type String\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tlabel : 'Description',\n\t\t\t\t\t// \t\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Template (require)\n\t\t\t\t\t// \t * `{id}` is replaced in dialog.id\n\t\t\t\t\t// \t * \n\t\t\t\t\t// \t * @type String\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \ttpl : '<div class=\"elfinder-info-desc\"><span class=\"elfinder-spinner\"></span></div>',\n\t\t\t\t\t// \t\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Restricts to mimetypes (optional)\n\t\t\t\t\t// \t * Exact match or category match\n\t\t\t\t\t// \t * \n\t\t\t\t\t// \t * @type Array\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \tmimes : ['text', 'image/jpeg', 'directory'],\n\t\t\t\t\t// \t\n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Restricts to file.hash (optional)\n\t\t\t\t\t// \t * \n\t\t\t\t\t// \t * @ type Regex\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \thashRegex : /^l\\d+_/,\n\t\t\t\t\t// \n\t\t\t\t\t// \t/**\n\t\t\t\t\t// \t * Request that asks for the description and sets the field (optional)\n\t\t\t\t\t// \t * \n\t\t\t\t\t// \t * @type Function\n\t\t\t\t\t// \t */\n\t\t\t\t\t// \taction : function(file, fm, dialog) {\n\t\t\t\t\t// \t\tfm.request({\n\t\t\t\t\t// \t\tdata : { cmd : 'desc', target: file.hash },\n\t\t\t\t\t// \t\t\tpreventDefault: true,\n\t\t\t\t\t// \t\t})\n\t\t\t\t\t// \t\t.fail(function() {\n\t\t\t\t\t// \t\t\tdialog.find('div.elfinder-info-desc').html(fm.i18n('unknown'));\n\t\t\t\t\t// \t\t})\n\t\t\t\t\t// \t\t.done(function(data) {\n\t\t\t\t\t// \t\t\tdialog.find('div.elfinder-info-desc').html(data.desc);\n\t\t\t\t\t// \t\t});\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\t\t\t},\n\t\t\tmkdir: {\n\t\t\t\t// Enable automatic switching function [\"New Folder\" / \"Into New Folder\"] of toolbar buttton\n\t\t\t\tintoNewFolderToolbtn: false\n\t\t\t},\n\t\t\tresize: {\n\t\t\t\t// defalt status of snap to 8px grid of the jpeg image (\"enable\" or \"disable\")\n\t\t\t\tgrid8px : 'disable',\n\t\t\t\t// Preset size array [width, height]\n\t\t\t\tpresetSize : [[320, 240], [400, 400], [640, 480], [800,600]],\n\t\t\t\t// File size (bytes) threshold when using the `dim` command for obtain the image size necessary to start editing\n\t\t\t\tgetDimThreshold : 204800,\n\t\t\t\t// File size (bytes) to request to get substitute image (400px) with the `dim` command\n\t\t\t\tdimSubImgSize : 307200\n\t\t\t},\n\t\t\trm: {\n\t\t\t\t// If trash is valid, items moves immediately to the trash holder without confirm.\n\t\t\t\tquickTrash : true,\n\t\t\t\t// Maximum wait seconds when checking the number of items to into the trash\n\t\t\t\tinfoCheckWait : 10,\n\t\t\t\t// Maximum number of items that can be placed into the Trash at one time\n\t\t\t\ttoTrashMaxItems : 1000\n\t\t\t},\n\t\t\tpaste : {\n\t\t\t\tmoveConfirm : false // Display confirmation dialog when moving items\n\t\t\t},\n\t\t\thelp : {\n\t\t\t\t// Tabs to show\n\t\t\t\tview : ['about', 'shortcuts', 'help', 'integrations', 'debug'],\n\t\t\t\t// HTML source URL of the heip tab\n\t\t\t\thelpSource : ''\n\t\t\t},\n\t\t\tpreference : {\n\t\t\t\t// dialog width\n\t\t\t\twidth: 600,\n\t\t\t\t// dialog height\n\t\t\t\theight: 400,\n\t\t\t\t// tabs setting see preference.js : build()\n\t\t\t\tcategories: null,\n\t\t\t\t// preference setting see preference.js : build()\n\t\t\t\tprefs: null,\n\t\t\t\t// language setting  see preference.js : build()\n\t\t\t\tlangs: null,\n\t\t\t\t// Command list of action when select file\n\t\t\t\t// Array value are 'Command Name' or 'Command Name1/CommandName2...'\n\t\t\t\tselectActions : ['open', 'edit/download', 'resize/edit/download', 'download', 'quicklook']\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Disabled commands relationship\n\t\t * \n\t\t * @type Object\n\t\t */\n\t\tdisabledCmdsRels : {\n\t\t\t'get'       : ['edit'],\n\t\t\t'rm'        : ['cut', 'empty'],\n\t\t\t'file&url=' : ['download', 'zipdl'] // file command and volume options url is empty\n\t\t},\n\n\t\t/**\n\t\t * Callback for prepare boot up\n\t\t * \n\t\t * - The this object in the function is an elFinder node\n\t\t * - The first parameter is elFinder Instance\n\t\t * - The second parameter is an object of other parameters\n\t\t *   For now it can use `dfrdsBeforeBootup` Array\n\t\t * \n\t\t * @type Function\n\t\t * @default null\n\t\t * @return void\n\t\t */\n\t\tbootCallback : null,\n\t\t\n\t\t/**\n\t\t * Callback for \"getfile\" commands.\n\t\t * Required to use elFinder with WYSIWYG editors etc..\n\t\t *\n\t\t * @type Function\n\t\t * @default null (command not active)\n\t\t */\n\t\tgetFileCallback : null,\n\t\t\n\t\t/**\n\t\t * Default directory view. icons/list\n\t\t *\n\t\t * @type String\n\t\t * @default \"icons\"\n\t\t */\n\t\tdefaultView : 'icons',\n\t\t\n\t\t/**\n\t\t * Hash of default directory path to open\n\t\t * \n\t\t * NOTE: This setting will be disabled if the target folder is specified in location.hash.\n\t\t * \n\t\t * If you want to find the hash in Javascript\n\t\t * can be obtained with the following code. (In the case of a standard hashing method)\n\t\t * \n\t\t * var volumeId = 'l1_'; // volume id\n\t\t * var path = 'path/to/target'; // without root path\n\t\t * //var path = 'path\\\\to\\\\target'; // use \\ on windows server\n\t\t * var hash = volumeId + btoa(path).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '.').replace(/\\.+$/, '');\n\t\t * \n\t\t * @type String\n\t\t * @default \"\"\n\t\t */\n\t\tstartPathHash : '',\n\n\t\t/**\n\t\t * Emit a sound when a file is deleted\n\t\t * Sounds are in sounds/ folder\n\t\t * \n\t\t * @type Boolean\n\t\t * @default true\n\t\t */\n\t\tsound : true,\n\t\t\n\t\t/**\n\t\t * UI plugins to load.\n\t\t * Current dir ui and dialogs loads always.\n\t\t * Here set not required plugins as folders tree/toolbar/statusbar etc.\n\t\t *\n\t\t * @type Array\n\t\t * @default ['toolbar', 'places', 'tree', 'path', 'stat']\n\t\t * @full ['toolbar', 'places', 'tree', 'path', 'stat']\n\t\t */\n\t\tui : ['toolbar', 'places', 'tree', 'path', 'stat'],\n\t\t\n\t\t/**\n\t\t * Some UI plugins options.\n\t\t * @type Object\n\t\t */\n\t\tuiOptions : {\n\t\t\t// toolbar configuration\n\t\t\ttoolbar : [\n\t\t\t\t['home', 'back', 'forward', 'up', 'reload'],\n\t\t\t\t['netmount'],\n\t\t\t\t['mkdir', 'mkfile', 'upload'],\n\t\t\t\t['open', 'download', 'getfile'],\n\t\t\t\t['undo', 'redo'],\n\t\t\t\t['copy', 'cut', 'paste', 'rm', 'empty', 'hide'],\n\t\t\t\t['duplicate', 'rename', 'edit', 'resize', 'chmod'],\n\t\t\t\t['selectall', 'selectnone', 'selectinvert'],\n\t\t\t\t['quicklook', 'info'],\n\t\t\t\t['extract', 'archive'],\n\t\t\t\t['search'],\n\t\t\t\t['view', 'sort'],\n\t\t\t\t['preference', 'help'],\n\t\t\t\t['fullscreen']\n\t\t\t],\n\t\t\t// toolbar extra options\n\t\t\ttoolbarExtra : {\n\t\t\t\t// also displays the text label on the button (true / false / 'none')\n\t\t\t\tdisplayTextLabel: false,\n\t\t\t\t// Exclude `displayTextLabel` setting UA type\n\t\t\t\tlabelExcludeUA: ['Mobile'],\n\t\t\t\t// auto hide on initial open\n\t\t\t\tautoHideUA: ['Mobile'],\n\t\t\t\t// Initial setting value of hide button in toolbar setting\n\t\t\t\tdefaultHides: ['home', 'reload'],\n\t\t\t\t// show Preference button ('none', 'auto', 'always')\n\t\t\t\t// If you do not include 'preference' in the context menu you should specify 'auto' or 'always'\n\t\t\t\tshowPreferenceButton: 'none',\n\t\t\t\t// show Preference button into contextmenu of the toolbar (true / false)\n\t\t\t\tpreferenceInContextmenu: true\n\t\t\t},\n\t\t\t// directories tree options\n\t\t\ttree : {\n\t\t\t\t// set path info to attr title\n\t\t\t\tattrTitle : true,\n\t\t\t\t// expand current root on init\n\t\t\t\topenRootOnLoad : true,\n\t\t\t\t// expand current work directory on open\n\t\t\t\topenCwdOnOpen  : true,\n\t\t\t\t// auto loading current directory parents and do expand their node.\n\t\t\t\tsyncTree : true,\n\t\t\t\t// Maximum number of display of each child trees\n\t\t\t\t// The tree of directories with children exceeding this number will be split\n\t\t\t\tsubTreeMax : 100,\n\t\t\t\t// Numbar of max connctions of subdirs request\n\t\t\t\tsubdirsMaxConn : 2,\n\t\t\t\t// Number of max simultaneous processing directory of subdirs\n\t\t\t\tsubdirsAtOnce : 5,\n\t\t\t\t// Durations of each animations\n\t\t\t\tdurations : {\n\t\t\t\t\tslideUpDown : 'fast',\n\t\t\t\t\tautoScroll : 'fast'\n\t\t\t\t}\n\t\t\t\t// ,\n\t\t\t\t// /**\n\t\t\t\t//  * Add CSS class name to navbar directories (optional)\n\t\t\t\t//  * see: https://github.com/Studio-42/elFinder/pull/1061,\n\t\t\t\t//  *      https://github.com/Studio-42/elFinder/issues/1231\n\t\t\t\t//  * \n\t\t\t\t//  * @type Function\n\t\t\t\t//  */\n\t\t\t\t// getClass: function(dir) {\n\t\t\t\t// \t// e.g. This adds the directory's name (lowercase) with prefix as a CSS class\n\t\t\t\t// \treturn 'elfinder-tree-' + dir.name.replace(/[ \"]/g, '').toLowerCase();\n\t\t\t\t// }\n\t\t\t},\n\t\t\t// navbar options\n\t\t\tnavbar : {\n\t\t\t\tminWidth : 150,\n\t\t\t\tmaxWidth : 500,\n\t\t\t\t// auto hide on initial open\n\t\t\t\tautoHideUA: [] // e.g. ['Mobile']\n\t\t\t},\n\t\t\tnavdock : {\n\t\t\t\t// disabled navdock ui\n\t\t\t\tdisabled : false,\n\t\t\t\t// percentage of initial maximum height to work zone\n\t\t\t\tinitMaxHeight : '50%',\n\t\t\t\t// percentage of maximum height to work zone by user resize action\n\t\t\t\tmaxHeight : '90%'\n\t\t\t},\n\t\t\tcwd : {\n\t\t\t\t// display parent folder with \"..\" name :)\n\t\t\t\toldSchool : false,\n\t\t\t\t\n\t\t\t\t// fm.UA types array to show item select checkboxes e.g. ['All'] or ['Mobile'] etc. default: ['Touch']\n\t\t\t\tshowSelectCheckboxUA : ['Touch'],\n\n\t\t\t\t// Enable dragout by dragstart with Alt key or Shift key\n\t\t\t\tmetakeyDragout : true,\n\t\t\t\t\n\t\t\t\t// file info columns displayed\n\t\t\t\tlistView : {\n\t\t\t\t\t// name is always displayed, cols are ordered\n\t\t\t\t\t// e.g. ['perm', 'date', 'size', 'kind', 'owner', 'group', 'mode']\n\t\t\t\t\t// mode: 'mode'(by `fileModeStyle` setting), 'modestr'(rwxr-xr-x) , 'modeoct'(755), 'modeboth'(rwxr-xr-x (755))\n\t\t\t\t\t// 'owner', 'group' and 'mode', It's necessary set volume driver option \"statOwner\" to `true`\n\t\t\t\t\t// for custom, characters that can be used in the name is `a-z0-9_`\n\t\t\t\t\tcolumns : ['perm', 'date', 'size', 'kind'],\n\t\t\t\t\t// override this if you want custom columns name\n\t\t\t\t\t// example\n\t\t\t\t\t// columnsCustomName : {\n\t\t\t\t\t//\t\tdate : 'Last modification',\n\t\t\t\t\t// \t\tkind : 'Mime type'\n\t\t\t\t\t// }\n\t\t\t\t\tcolumnsCustomName : {},\n\t\t\t\t\t// fixed list header colmun\n\t\t\t\t\tfixedHeader : true\n\t\t\t\t},\n\n\t\t\t\t// icons view setting\n\t\t\t\ticonsView : {\n\t\t\t\t\t// default icon size (0-3 in default CSS (cwd.css - elfinder-cwd-size[number]))\n\t\t\t\t\tsize: 0,\n\t\t\t\t\t// number of maximum size (3 in default CSS (cwd.css - elfinder-cwd-size[number]))\n\t\t\t\t\t// uses in preference.js\n\t\t\t\t\tsizeMax: 3,\n\t\t\t\t\t// Name of each size\n\t\t\t\t\tsizeNames: {\n\t\t\t\t\t\t0: 'viewSmall',\n\t\t\t\t\t\t1: 'viewMedium',\n\t\t\t\t\t\t2: 'viewLarge',\n\t\t\t\t\t\t3: 'viewExtraLarge' \n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// /**\n\t\t\t\t//  * Add CSS class name to cwd directories (optional)\n\t\t\t\t//  * see: https://github.com/Studio-42/elFinder/pull/1061,\n\t\t\t\t//  *      https://github.com/Studio-42/elFinder/issues/1231\n\t\t\t\t//  * \n\t\t\t\t//  * @type Function\n\t\t\t\t//  */\n\t\t\t\t// ,\n\t\t\t\t// getClass: function(file) {\n\t\t\t\t// \t// e.g. This adds the directory's name (lowercase) with prefix as a CSS class\n\t\t\t\t// \treturn 'elfinder-cwd-' + file.name.replace(/[ \"]/g, '').toLowerCase();\n\t\t\t\t//}\n\t\t\t\t\n\t\t\t\t//,\n\t\t\t\t//// Template placeholders replacement rules for overwrite. see ui/cwd.js replacement\n\t\t\t\t//replacement : {\n\t\t\t\t//\ttooltip : function(f, fm) {\n\t\t\t\t//\t\tvar list = fm.viewType == 'list', // current view type\n\t\t\t\t//\t\t\tquery = fm.searchStatus.state == 2, // is in search results\n\t\t\t\t//\t\t\ttitle = fm.formatDate(f) + (f.size > 0 ? ' ('+fm.formatSize(f.size)+')' : ''),\n\t\t\t\t//\t\t\tinfo  = '';\n\t\t\t\t//\t\tif (query && f.path) {\n\t\t\t\t//\t\t\tinfo = fm.escape(f.path.replace(/\\/[^\\/]*$/, ''));\n\t\t\t\t//\t\t} else {\n\t\t\t\t//\t\t\tinfo = f.tooltip? fm.escape(f.tooltip).replace(/\\r/g, '&#13;') : '';\n\t\t\t\t//\t\t}\n\t\t\t\t//\t\tif (list) {\n\t\t\t\t//\t\t\tinfo += (info? '&#13;' : '') + fm.escape(f.name);\n\t\t\t\t//\t\t}\n\t\t\t\t//\t\treturn info? info + '&#13;' + title : title;\n\t\t\t\t//\t}\n\t\t\t\t//}\n\t\t\t},\n\t\t\tpath : {\n\t\t\t\t// Move to head of work zone without UI navbar\n\t\t\t\ttoWorkzoneWithoutNavbar : true\n\t\t\t},\n\t\t\tdialog : {\n\t\t\t\t// Enable to auto focusing on mouse over in the target form element\n\t\t\t\tfocusOnMouseOver : true\n\t\t\t},\n\t\t\ttoast : {\n\t\t\t\tanimate : {\n\t\t\t\t\t// to show\n\t\t\t\t\tshowMethod: 'fadeIn', // fadeIn, slideDown, and show are built into jQuery\n\t\t\t\t\tshowDuration: 300,    // milliseconds\n\t\t\t\t\tshowEasing: 'swing',  // swing and linear are built into jQuery\n\t\t\t\t\t// timeout to hide\n\t\t\t\t\ttimeOut: 3000,\n\t\t\t\t\t// to hide\n\t\t\t\t\thideMethod: 'fadeOut',\n\t\t\t\t\thideDuration: 1500,\n\t\t\t\t\thideEasing: 'swing'\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * MIME regex of send HTTP header \"Content-Disposition: inline\" or allow preview in quicklook\n\t\t * This option will overwrite by connector configuration\n\t\t * \n\t\t * @type String\n\t\t * @default '^(?:(?:image|video|audio)|text/plain|application/pdf$)'\n\t\t * @example\n\t\t *  dispInlineRegex : '.',  // is allow inline of all of MIME types\n\t\t *  dispInlineRegex : '$^', // is not allow inline of all of MIME types\n\t\t */\n\t\tdispInlineRegex : '^(?:(?:image|video|audio)|application/(?:x-mpegURL|dash\\+xml)|(?:text/plain|application/pdf)$)',\n\n\t\t/**\n\t\t * Display only required files by types\n\t\t *\n\t\t * @type Array\n\t\t * @default []\n\t\t * @example\n\t\t *  onlyMimes : [\"image\"] - display all images\n\t\t *  onlyMimes : [\"image/png\", \"application/x-shockwave-flash\"] - display png and flash\n\t\t */\n\t\tonlyMimes : [],\n\n\t\t/**\n\t\t * Custom files sort rules.\n\t\t * All default rules (name/size/kind/date/perm/mode/owner/group) set in elFinder._sortRules\n\t\t *\n\t\t * @type {Object}\n\t\t * @example\n\t\t * sortRules : {\n\t\t *   name : function(file1, file2) { return file1.name.toLowerCase().localeCompare(file2.name.toLowerCase()); }\n\t\t * }\n\t\t */\n\t\tsortRules : {},\n\n\t\t/**\n\t\t * Default sort type.\n\t\t *\n\t\t * @type {String}\n\t\t */\n\t\tsortType : 'name',\n\t\t\n\t\t/**\n\t\t * Default sort order.\n\t\t *\n\t\t * @type {String}\n\t\t * @default \"asc\"\n\t\t */\n\t\tsortOrder : 'asc',\n\t\t\n\t\t/**\n\t\t * Display folders first?\n\t\t *\n\t\t * @type {Boolean}\n\t\t * @default true\n\t\t */\n\t\tsortStickFolders : true,\n\t\t\n\t\t/**\n\t\t * Sort also applies to the treeview (null: disable this feature)\n\t\t *\n\t\t * @type Boolean|null\n\t\t * @default false\n\t\t */\n\t\tsortAlsoTreeview : false,\n\t\t\n\t\t/**\n\t\t * If true - elFinder will formating dates itself, \n\t\t * otherwise - backend date will be used.\n\t\t *\n\t\t * @type Boolean\n\t\t */\n\t\tclientFormatDate : true,\n\t\t\n\t\t/**\n\t\t * Show UTC dates.\n\t\t * Required set clientFormatDate to true\n\t\t *\n\t\t * @type Boolean\n\t\t */\n\t\tUTCDate : false,\n\t\t\n\t\t/**\n\t\t * File modification datetime format.\n\t\t * Value from selected language data  is used by default.\n\t\t * Set format here to overwrite it.\n\t\t *\n\t\t * @type String\n\t\t * @default  \"\"\n\t\t */\n\t\tdateFormat : '',\n\t\t\n\t\t/**\n\t\t * File modification datetime format in form \"Yesterday 12:23:01\".\n\t\t * Value from selected language data is used by default.\n\t\t * Set format here to overwrite it.\n\t\t * Use $1 for \"Today\"/\"Yesterday\" placeholder\n\t\t *\n\t\t * @type String\n\t\t * @default  \"\"\n\t\t * @example \"$1 H:m:i\"\n\t\t */\n\t\tfancyDateFormat : '',\n\t\t\n\t\t/**\n\t\t * Style of file mode at cwd-list, info dialog\n\t\t * 'string' (ex. rwxr-xr-x) or 'octal' (ex. 755) or 'both' (ex. rwxr-xr-x (755))\n\t\t * \n\t\t * @type {String}\n\t\t * @default 'both'\n\t\t */\n\t\tfileModeStyle : 'both',\n\t\t\n\t\t/**\n\t\t * elFinder width\n\t\t *\n\t\t * @type String|Number\n\t\t * @default  \"auto\"\n\t\t */\n\t\twidth : 'auto',\n\t\t\n\t\t/**\n\t\t * elFinder node height\n\t\t * Number: pixcel or String: Number + \"%\"\n\t\t *\n\t\t * @type Number | String\n\t\t * @default  400\n\t\t */\n\t\theight : 400,\n\t\t\n\t\t/**\n\t\t * Base node object or selector\n\t\t * Element which is the reference of the height percentage\n\t\t *\n\t\t * @type Object|String\n\t\t * @default null | $(window) (if height is percentage)\n\t\t **/\n\t\theightBase : null,\n\t\t\n\t\t/**\n\t\t * Make elFinder resizable if jquery ui resizable available\n\t\t *\n\t\t * @type Boolean\n\t\t * @default  true\n\t\t */\n\t\tresizable : true,\n\t\t\n\t\t/**\n\t\t * Timeout before open notifications dialogs\n\t\t *\n\t\t * @type Number\n\t\t * @default  500 (.5 sec)\n\t\t */\n\t\tnotifyDelay : 500,\n\t\t\n\t\t/**\n\t\t * Position CSS, Width of notifications dialogs\n\t\t *\n\t\t * @type Object\n\t\t * @default {position: {}, width : null} - Apply CSS definition\n\t\t * position: CSS object | null (null: position center & middle)\n\t\t */\n\t\tnotifyDialog : {position : {}, width : null, canClose : false, hiddens : ['open']},\n\t\t\n\t\t/**\n\t\t * Dialog contained in the elFinder node\n\t\t * \n\t\t * @type Boolean\n\t\t * @default false\n\t\t */\n\t\tdialogContained : false,\n\t\t\n\t\t/**\n\t\t * Allow shortcuts\n\t\t *\n\t\t * @type Boolean\n\t\t * @default  true\n\t\t */\n\t\tallowShortcuts : true,\n\t\t\n\t\t/**\n\t\t * Remeber last opened dir to open it after reload or in next session\n\t\t *\n\t\t * @type Boolean\n\t\t * @default  true\n\t\t */\n\t\trememberLastDir : true,\n\t\t\n\t\t/**\n\t\t * Clear historys(elFinder) on reload(not browser) function\n\t\t * Historys was cleared on Reload function on elFinder 2.0 (value is true)\n\t\t * \n\t\t * @type Boolean\n\t\t * @default  false\n\t\t */\n\t\treloadClearHistory : false,\n\t\t\n\t\t/**\n\t\t * Use browser native history with supported browsers\n\t\t *\n\t\t * @type Boolean\n\t\t * @default  true\n\t\t */\n\t\tuseBrowserHistory : true,\n\t\t\n\t\t/**\n\t\t * Lazy load config.\n\t\t * How many files display at once?\n\t\t *\n\t\t * @type Number\n\t\t * @default  50\n\t\t */\n\t\tshowFiles : 50,\n\t\t\n\t\t/**\n\t\t * Lazy load config.\n\t\t * Distance in px to cwd bottom edge to start display files\n\t\t *\n\t\t * @type Number\n\t\t * @default  50\n\t\t */\n\t\tshowThreshold : 50,\n\t\t\n\t\t/**\n\t\t * Additional rule to valid new file name.\n\t\t * By default not allowed empty names or '..'\n\t\t * This setting does not have a sense of security.\n\t\t *\n\t\t * @type false|RegExp|function\n\t\t * @default  false\n\t\t * @example\n\t\t *  disable names with spaces:\n\t\t *  validName : /^[^\\s]+$/,\n\t\t */\n\t\tvalidName : false,\n\t\t\n\t\t/**\n\t\t * Additional rule to filtering for browsing.\n\t\t * This setting does not have a sense of security.\n\t\t * \n\t\t * The object `this` is elFinder instance object in this function\n\t\t *\n\t\t * @type false|RegExp|function\n\t\t * @default  false\n\t\t * @example\n\t\t *  show only png and jpg files:\n\t\t *  fileFilter : /.*\\.(png|jpg)$/i,\n\t\t *  \n\t\t *  show only image type files:\n\t\t *  fileFilter : function(file) { return file.mime && file.mime.match(/^image\\//i); },\n\t\t */\n\t\tfileFilter : false,\n\t\t\n\t\t/**\n\t\t * Backup name suffix.\n\t\t *\n\t\t * @type String\n\t\t * @default  \"~\"\n\t\t */\n\t\tbackupSuffix : '~',\n\t\t\n\t\t/**\n\t\t * Sync content interval\n\t\t *\n\t\t * @type Number\n\t\t * @default  0 (do not sync)\n\t\t */\n\t\tsync : 0,\n\t\t\n\t\t/**\n\t\t * Sync start on load if sync value >= 1000\n\t\t *\n\t\t * @type     Bool\n\t\t * @default  true\n\t\t */\n\t\tsyncStart : true,\n\t\t\n\t\t/**\n\t\t * How many thumbnails create in one request\n\t\t *\n\t\t * @type Number\n\t\t * @default  5\n\t\t */\n\t\tloadTmbs : 5,\n\t\t\n\t\t/**\n\t\t * Cookie option for browsersdoes not suppot localStorage\n\t\t *\n\t\t * @type Object\n\t\t */\n\t\tcookie         : {\n\t\t\texpires : 30,\n\t\t\tdomain  : '',\n\t\t\tpath    : '/',\n\t\t\tsecure  : false\n\t\t},\n\t\t\n\t\t/**\n\t\t * Contextmenu config\n\t\t *\n\t\t * @type Object\n\t\t */\n\t\tcontextmenu : {\n\t\t\t// navbarfolder menu\n\t\t\tnavbar : ['open', 'opennew', 'download', '|', 'upload', 'mkdir', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', 'empty', 'hide', '|', 'rename', '|', 'archive', '|', 'places', 'info', 'chmod', 'netunmount'],\n\t\t\t// current directory menu\n\t\t\tcwd    : ['undo', 'redo', '|', 'back', 'up', 'reload', '|', 'upload', 'mkdir', 'mkfile', 'paste', '|', 'empty', 'hide', '|', 'view', 'sort', 'selectall', 'colwidth', '|', 'places', 'info', 'chmod', 'netunmount', '|', 'fullscreen', '|', 'preference'],\n\t\t\t// current directory file menu\n\t\t\tfiles  : ['getfile', '|' ,'open', 'opennew', 'download', 'opendir', 'quicklook', '|', 'upload', 'mkdir', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', 'empty', 'hide', '|', 'rename', 'edit', 'resize', '|', 'archive', 'extract', '|', 'selectall', 'selectinvert', '|', 'places', 'info', 'chmod', 'netunmount']\n\t\t},\n\n\t\t/**\n\t\t * elFinder node enable always\n\t\t * This value will set to `true` if <body> has elFinder node only\n\t\t * \n\t\t * @type     Bool\n\t\t * @default  false\n\t\t */\n\t\tenableAlways : false,\n\t\t\n\t\t/**\n\t\t * elFinder node enable by mouse over\n\t\t * \n\t\t * @type     Bool\n\t\t * @default  true\n\t\t */\n\t\tenableByMouseOver : true,\n\n\t\t/**\n\t\t * Show window close confirm dialog\n\t\t * Value is which state to show\n\t\t * 'hasNotifyDialog', 'editingFile', 'hasSelectedItem' and 'hasClipboardData'\n\t\t * \n\t\t * @type     Array\n\t\t * @default  ['hasNotifyDialog', 'editingFile']\n\t\t */\n\t\twindowCloseConfirm : ['hasNotifyDialog', 'editingFile'],\n\n\t\t/**\n\t\t * Function decoding 'raw' string converted to unicode\n\t\t * It is used instead of fm.decodeRawString(str)\n\t\t * \n\t\t * @type Null|Function\n\t\t */\n\t\trawStringDecoder : typeof Encoding === 'object' && $.isFunction(Encoding.convert)? function(str) {\n\t\t\treturn Encoding.convert(str, {\n\t\t\t\tto: 'UNICODE',\n\t\t\t\ttype: 'string'\n\t\t\t});\n\t\t} : null,\n\n\t\t/**\n\t\t * Debug config\n\t\t *\n\t\t * @type Array|String('auto')|Boolean(true|false)\n\t\t */\n\t\tdebug : ['error', 'warning', 'event-destroy'],\n\n\t\t/**\n\t\t * Show toast messeges of backend warning (if found data `debug.backendErrors` in backend results)\n\t\t *\n\t\t * @type Boolean|Object (toast options)\n\t\t */\n\t\ttoastBackendWarn : true\n\t};\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/options.netmount',[\n\t\"./elFinder\",\n\t\"./options\"\n],function(elFinder) {\n\t/**\n\t * Default elFinder config of commandsOptions.netmount\n\t *\n\t * @type  Object\n\t */\n\n\telFinder.prototype._options.commandsOptions.netmount = {\n\t\tftp: {\n\t\t\tname : 'FTP',\n\t\t\tinputs: {\n\t\t\t\thost     : $('<input type=\"text\"/>'),\n\t\t\t\tport     : $('<input type=\"number\" placeholder=\"21\" class=\"elfinder-input-optional\"/>'),\n\t\t\t\tpath     : $('<input type=\"text\" value=\"/\"/>'),\n\t\t\t\tuser     : $('<input type=\"text\"/>'),\n\t\t\t\tpass     : $('<input type=\"password\" autocomplete=\"new-password\"/>'),\n\t\t\t\tFTPS     : $('<input type=\"checkbox\" value=\"1\" title=\"File Transfer Protocol over SSL/TLS\"/>'),\n\t\t\t\tencoding : $('<input type=\"text\" placeholder=\"Optional\" class=\"elfinder-input-optional\"/>'),\n\t\t\t\tlocale   : $('<input type=\"text\" placeholder=\"Optional\" class=\"elfinder-input-optional\"/>')\n\t\t\t}\n\t\t},\n\t\tdropbox2: elFinder.prototype.makeNetmountOptionOauth('dropbox2', 'Dropbox', 'Dropbox', {noOffline : true,\n\t\t\troot : '/',\n\t\t\tpathI18n : 'path',\n\t\t\tintegrate : {\n\t\t\t\ttitle: 'Dropbox.com',\n\t\t\t\tlink: 'https://www.dropbox.com'\n\t\t\t}\n\t\t}),\n\t\tgoogledrive: elFinder.prototype.makeNetmountOptionOauth('googledrive', 'Google Drive', 'Google', {\n\t\t\tintegrate : {\n\t\t\t\ttitle: 'Google Drive',\n\t\t\t\tlink: 'https://www.google.com/drive/'\n\t\t\t}\n\t\t}),\n\t\tonedrive: elFinder.prototype.makeNetmountOptionOauth('onedrive', 'One Drive', 'OneDrive', {\n\t\t\tintegrate : {\n\t\t\t\ttitle: 'Microsoft OneDrive',\n\t\t\t\tlink: 'https://onedrive.live.com'\n\t\t\t}\n\t\t}),\n\t\tbox: elFinder.prototype.makeNetmountOptionOauth('box', 'Box', 'Box', {\n\t\t\tnoOffline : true,\n\t\t\tintegrate : {\n\t\t\t\ttitle: 'Box.com',\n\t\t\t\tlink: 'https://www.box.com'\n\t\t\t}\n\t\t})\n\t};\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/history',[\n\t\"./elFinder\"\n],function(elFinder) {\n\t/**\n\t * @class elFinder.history\n\t * Store visited folders\n\t * and provide \"back\" and \"forward\" methods\n\t *\n\t * @author Dmitry (dio) Levashov\n\t */\n\telFinder.prototype.history = function(fm) {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\t/**\n\t\t\t * Update history on \"open\" event?\n\t\t\t *\n\t\t\t * @type Boolean\n\t\t\t */\n\t\t\tupdate = true,\n\t\t\t/**\n\t\t\t * Directories hashes storage\n\t\t\t *\n\t\t\t * @type Array\n\t\t\t */\n\t\t\thistory = [],\n\t\t\t/**\n\t\t\t * Current directory index in history\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t */\n\t\t\tcurrent,\n\t\t\t/**\n\t\t\t * Clear history\n\t\t\t *\n\t\t\t * @return void\n\t\t\t */\n\t\t\treset = function() {\n\t\t\t\thistory = [fm.cwd().hash];\n\t\t\t\tcurrent = 0;\n\t\t\t\tupdate  = true;\n\t\t\t},\n\t\t\t/**\n\t\t\t * Browser native history object\n\t\t\t */\n\t\t\tnativeHistory = (fm.options.useBrowserHistory && window.history && window.history.pushState)? window.history : null,\n\t\t\t/**\n\t\t\t * Open prev/next folder\n\t\t\t *\n\t\t\t * @Boolen  open next folder?\n\t\t\t * @return jQuery.Deferred\n\t\t\t */\n\t\t\tgo = function(fwd) {\n\t\t\t\tif ((fwd && self.canForward()) || (!fwd && self.canBack())) {\n\t\t\t\t\tupdate = false;\n\t\t\t\t\treturn fm.exec('open', history[fwd ? ++current : --current]).fail(reset);\n\t\t\t\t}\n\t\t\t\treturn $.Deferred().reject();\n\t\t\t},\n\t\t\t/**\n\t\t\t * Sets the native history.\n\t\t\t *\n\t\t\t * @param String thash target hash\n\t\t\t */\n\t\t\tsetNativeHistory = function(thash) {\n\t\t\t\tif (nativeHistory && (! nativeHistory.state || nativeHistory.state.thash !== thash)) {\n\t\t\t\t\tnativeHistory.pushState({thash: thash}, null, location.pathname + location.search + (thash? '#elf_' + thash : ''));\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if there is previous visited directories\n\t\t *\n\t\t * @return Boolen\n\t\t */\n\t\tthis.canBack = function() {\n\t\t\treturn current > 0;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if can go forward\n\t\t *\n\t\t * @return Boolen\n\t\t */\n\t\tthis.canForward = function() {\n\t\t\treturn current < history.length - 1;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Go back\n\t\t *\n\t\t * @return void\n\t\t */\n\t\tthis.back = go;\n\t\t\n\t\t/**\n\t\t * Go forward\n\t\t *\n\t\t * @return void\n\t\t */\n\t\tthis.forward = function() {\n\t\t\treturn go(true);\n\t\t};\n\t\t\n\t\t// bind to elfinder events\n\t\tfm.bind('init', function() {\n\t\t\tif (nativeHistory && !nativeHistory.state) {\n\t\t\t\tsetNativeHistory(fm.startDir());\n\t\t\t}\n\t\t})\n\t\t.open(function() {\n\t\t\tvar l = history.length,\n\t\t\t\tcwd = fm.cwd().hash;\n\n\t\t\tif (update) {\n\t\t\t\tcurrent >= 0 && l > current + 1 && history.splice(current+1);\n\t\t\t\thistory[history.length-1] != cwd && history.push(cwd);\n\t\t\t\tcurrent = history.length - 1;\n\t\t\t}\n\t\t\tupdate = true;\n\n\t\t\tsetNativeHistory(cwd);\n\t\t})\n\t\t.reload(fm.options.reloadClearHistory && reset);\n\t\t\n\t};\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/command',[\n\t\"./elFinder\"\n],function(elFinder) {\n\t/**\n\t * elFinder command prototype\n\t *\n\t * @type  elFinder.command\n\t * @author  Dmitry (dio) Levashov\n\t */\n\telFinder.prototype.command = function(fm) {\n\t\t\"use strict\";\n\t\t/**\n\t\t * elFinder instance\n\t\t *\n\t\t * @type  elFinder\n\t\t */\n\t\tthis.fm = fm;\n\t\t\n\t\t/**\n\t\t * Command name, same as class name\n\t\t *\n\t\t * @type  String\n\t\t */\n\t\tthis.name = '';\n\t\t\n\t\t/**\n\t\t * Dialog class name\n\t\t *\n\t\t * @type  String\n\t\t */\n\t\tthis.dialogClass = '';\n\n\t\t/**\n\t\t * Command icon class name with out 'elfinder-button-icon-'\n\t\t * Use this.name if it is empty\n\t\t *\n\t\t * @type  String\n\t\t */\n\t\tthis.className = '';\n\n\t\t/**\n\t\t * Short command description\n\t\t *\n\t\t * @type  String\n\t\t */\n\t\tthis.title = '';\n\t\t\n\t\t/**\n\t\t * Linked(Child) commands name\n\t\t * They are loaded together when tthis command is loaded.\n\t\t * \n\t\t * @type  Array\n\t\t */\n\t\tthis.linkedCmds = [];\n\t\t\n\t\t/**\n\t\t * Current command state\n\t\t *\n\t\t * @example\n\t\t * this.state = -1; // command disabled\n\t\t * this.state = 0;  // command enabled\n\t\t * this.state = 1;  // command active (for example \"fullscreen\" command while elfinder in fullscreen mode)\n\t\t * @default -1\n\t\t * @type  Number\n\t\t */\n\t\tthis.state = -1;\n\t\t\n\t\t/**\n\t\t * If true, command can not be disabled by connector.\n\t\t * @see this.update()\n\t\t *\n\t\t * @type  Boolen\n\t\t */\n\t\tthis.alwaysEnabled = false;\n\t\t\n\t\t/**\n\t\t * Do not change dirctory on removed current work directory\n\t\t * \n\t\t * @type  Boolen\n\t\t */\n\t\tthis.noChangeDirOnRemovedCwd = false;\n\t\t\n\t\t/**\n\t\t * If true, this means command was disabled by connector.\n\t\t * @see this.update()\n\t\t *\n\t\t * @type  Boolen\n\t\t */\n\t\tthis._disabled = false;\n\t\t\n\t\t/**\n\t\t * If true, this command is disabled on serach results\n\t\t * \n\t\t * @type  Boolean\n\t\t */\n\t\tthis.disableOnSearch = false;\n\t\t\n\t\t/**\n\t\t * Call update() when event select fired\n\t\t * \n\t\t * @type  Boolean\n\t\t */\n\t\tthis.updateOnSelect = true;\n\t\t\n\t\t/**\n\t\t * Sync toolbar button title on change\n\t\t * \n\t\t * @type  Boolean\n\t\t */\n\t\tthis.syncTitleOnChange = false;\n\n\t\t/**\n\t\t * Keep display of the context menu when command execution\n\t\t * \n\t\t * @type  Boolean\n\t\t */\n\t\tthis.keepContextmenu = false;\n\t\t\n\t\t/**\n\t\t * elFinder events defaults handlers.\n\t\t * Inside handlers \"this\" is current command object\n\t\t *\n\t\t * @type  Object\n\t\t */\n\t\tthis._handlers = {\n\t\t\tenable  : function() { this.update(void(0), this.value); },\n\t\t\tdisable : function() { this.update(-1, this.value); },\n\t\t\t'open reload load sync'    : function() { \n\t\t\t\tthis._disabled = !(this.alwaysEnabled || this.fm.isCommandEnabled(this.name));\n\t\t\t\tthis.update(void(0), this.value);\n\t\t\t\tthis.change(); \n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * elFinder events handlers.\n\t\t * Inside handlers \"this\" is current command object\n\t\t *\n\t\t * @type  Object\n\t\t */\n\t\tthis.handlers = {};\n\t\t\n\t\t/**\n\t\t * Shortcuts\n\t\t *\n\t\t * @type  Array\n\t\t */\n\t\tthis.shortcuts = [];\n\t\t\n\t\t/**\n\t\t * Command options\n\t\t *\n\t\t * @type  Object\n\t\t */\n\t\tthis.options = {ui : 'button'};\n\t\t\n\t\t/**\n\t\t * Callback functions on `change` event\n\t\t * \n\t\t * @type  Array\n\t\t */\n\t\tthis.listeners = [];\n\n\t\t/**\n\t\t * Prepare object -\n\t\t * bind events and shortcuts\n\t\t *\n\t\t * @return void\n\t\t */\n\t\tthis.setup = function(name, opts) {\n\t\t\tvar self = this,\n\t\t\t\tfm   = this.fm,\n\t\t\t\tsetCallback = function(s) {\n\t\t\t\t\tvar cb = s.callback || function(e) {\n\t\t\t\t\t\t\t\tfm.exec(self.name, void(0), {\n\t\t\t\t\t\t\t\t_userAction: true,\n\t\t\t\t\t\t\t\t_currentType: 'shortcut'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\ts.callback = function(e) {\n\t\t\t\t\t\tvar enabled, checks = {};\n\t\t\t\t\t\tif (self.enabled()) {\n\t\t\t\t\t\t\tif (fm.searchStatus.state < 2) {\n\t\t\t\t\t\t\t\tenabled = fm.isCommandEnabled(self.name);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$.each(fm.selected(), function(i, h) {\n\t\t\t\t\t\t\t\t\tif (fm.optionsByHashes[h]) {\n\t\t\t\t\t\t\t\t\t\tchecks[h] = true;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t$.each(fm.volOptions, function(id) {\n\t\t\t\t\t\t\t\t\t\t\tif (!checks[id] && h.indexOf(id) === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tchecks[id] = true;\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$.each(checks, function(h) {\n\t\t\t\t\t\t\t\t\tenabled = fm.isCommandEnabled(self.name, h);\n\t\t\t\t\t\t\t\t\tif (! enabled) {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (enabled) {\n\t\t\t\t\t\t\t\tself.event = e;\n\t\t\t\t\t\t\t\tcb.call(self);\n\t\t\t\t\t\t\t\tdelete self.event;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\ti, s, sc;\n\n\t\t\tthis.name      = name;\n\t\t\tthis.title     = fm.messages['cmd'+name] ? fm.i18n('cmd'+name)\n\t\t\t               : ((this.extendsCmd && fm.messages['cmd'+this.extendsCmd]) ? fm.i18n('cmd'+this.extendsCmd) : name);\n\t\t\tthis.options   = Object.assign({}, this.options, opts);\n\t\t\tthis.listeners = [];\n\t\t\tthis.dialogClass = 'elfinder-dialog-' + name;\n\n\t\t\tif (opts.shortcuts) {\n\t\t\t\tif (typeof opts.shortcuts === 'function') {\n\t\t\t\t\tsc = opts.shortcuts(this.fm, this.shortcuts);\n\t\t\t\t} else if (Array.isArray(opts.shortcuts)) {\n\t\t\t\t\tsc = opts.shortcuts;\n\t\t\t\t}\n\t\t\t\tthis.shortcuts = sc || [];\n\t\t\t}\n\n\t\t\tif (this.updateOnSelect) {\n\t\t\t\tthis._handlers.select = function() { this.update(void(0), this.value); };\n\t\t\t}\n\n\t\t\t$.each(Object.assign({}, self._handlers, self.handlers), function(cmd, handler) {\n\t\t\t\tfm.bind(cmd, $.proxy(handler, self));\n\t\t\t});\n\n\t\t\tfor (i = 0; i < this.shortcuts.length; i++) {\n\t\t\t\ts = this.shortcuts[i];\n\t\t\t\tsetCallback(s);\n\t\t\t\t!s.description && (s.description = this.title);\n\t\t\t\tfm.shortcut(s);\n\t\t\t}\n\n\t\t\tif (this.disableOnSearch) {\n\t\t\t\tfm.bind('search searchend', function() {\n\t\t\t\t\tself._disabled = this.type === 'search'? true : ! (this.alwaysEnabled || fm.isCommandEnabled(name));\n\t\t\t\t\tself.update(void(0), self.value);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.init();\n\t\t};\n\n\t\t/**\n\t\t * Command specific init stuffs\n\t\t *\n\t\t * @return void\n\t\t */\n\t\tthis.init = function() {};\n\n\t\t/**\n\t\t * Exec command\n\t\t *\n\t\t * @param  Array         target files hashes\n\t\t * @param  Array|Object  command value\n\t\t * @return $.Deferred\n\t\t */\n\t\tthis.exec = function(files, opts) { \n\t\t\treturn $.Deferred().reject(); \n\t\t};\n\t\t\n\t\tthis.getUndo = function(opts, resData) {\n\t\t\treturn false;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if command disabled.\n\t\t *\n\t\t * @return Boolen\n\t\t */\n\t\tthis.disabled = function() {\n\t\t\treturn this.state < 0;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if command enabled.\n\t\t *\n\t\t * @return Boolen\n\t\t */\n\t\tthis.enabled = function() {\n\t\t\treturn this.state > -1;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if command active.\n\t\t *\n\t\t * @return Boolen\n\t\t */\n\t\tthis.active = function() {\n\t\t\treturn this.state > 0;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return current command state.\n\t\t * Must be overloaded in most commands\n\t\t *\n\t\t * @return Number\n\t\t */\n\t\tthis.getstate = function() {\n\t\t\treturn -1;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Update command state/value\n\t\t * and rize 'change' event if smth changed\n\t\t *\n\t\t * @param  Number  new state or undefined to auto update state\n\t\t * @param  mixed   new value\n\t\t * @return void\n\t\t */\n\t\tthis.update = function(s, v) {\n\t\t\tvar state = this.state,\n\t\t\t\tvalue = this.value;\n\n\t\t\tif (this._disabled && this.fm.searchStatus === 0) {\n\t\t\t\tthis.state = -1;\n\t\t\t} else {\n\t\t\t\tthis.state = s !== void(0) ? s : this.getstate();\n\t\t\t}\n\n\t\t\tthis.value = v;\n\t\t\t\n\t\t\tif (state != this.state || value != this.value) {\n\t\t\t\tthis.change();\n\t\t\t}\n\t\t};\n\t\t\n\t\t/**\n\t\t * Bind handler / fire 'change' event.\n\t\t *\n\t\t * @param  Function|undefined  event callback\n\t\t * @return void\n\t\t */\n\t\tthis.change = function(c) {\n\t\t\tvar cmd, i;\n\t\t\t\n\t\t\tif (typeof(c) === 'function') {\n\t\t\t\tthis.listeners.push(c);\t\t\t\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < this.listeners.length; i++) {\n\t\t\t\t\tcmd = this.listeners[i];\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcmd(this.state, this.value);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.fm.debug('error', e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t};\n\t\t\n\n\t\t/**\n\t\t * With argument check given files hashes and return list of existed files hashes.\n\t\t * Without argument return selected files hashes.\n\t\t *\n\t\t * @param  Array|String|void  hashes\n\t\t * @return Array\n\t\t */\n\t\tthis.hashes = function(hashes) {\n\t\t\treturn hashes\n\t\t\t\t? $.grep(Array.isArray(hashes) ? hashes : [hashes], function(hash) { return fm.file(hash) ? true : false; })\n\t\t\t\t: fm.selected();\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return only existed files from given fils hashes | selected files\n\t\t *\n\t\t * @param  Array|String|void  hashes\n\t\t * @return Array\n\t\t */\n\t\tthis.files = function(hashes) {\n\t\t\tvar fm = this.fm;\n\t\t\t\n\t\t\treturn hashes\n\t\t\t\t? $.map(Array.isArray(hashes) ? hashes : [hashes], function(hash) { return fm.file(hash) || null; })\n\t\t\t\t: fm.selectedFiles();\n\t\t};\n\n\t\t/**\n\t\t * Wrapper to fm.dialog()\n\t\t *\n\t\t * @param  String|DOMElement  content\n\t\t * @param  Object             options\n\t\t * @return Object             jQuery element object\n\t\t */\n\t\tthis.fmDialog = function(content, options) {\n\t\t\tif (options.cssClass) {\n\t\t\t\toptions.cssClass += ' ' + this.dialogClass;\n\t\t\t} else {\n\t\t\t\toptions.cssClass = this.dialogClass;\n\t\t\t}\n\t\t\treturn this.fm.dialog(content, options);\n\t\t};\n\t};\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/resources',[\n\t\"./elFinder\"\n],function(elFinder) {\n\t/**\n\t * elFinder resources registry.\n\t * Store shared data\n\t *\n\t * @type Object\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.resources = {\n\t\t'class' : {\n\t\t\thover       : 'ui-state-hover',\n\t\t\tactive      : 'ui-state-active',\n\t\t\tdisabled    : 'ui-state-disabled',\n\t\t\tdraggable   : 'ui-draggable',\n\t\t\tdroppable   : 'ui-droppable',\n\t\t\tadroppable  : 'elfinder-droppable-active',\n\t\t\tcwdfile     : 'elfinder-cwd-file',\n\t\t\tcwd         : 'elfinder-cwd',\n\t\t\ttree        : 'elfinder-tree',\n\t\t\ttreeroot    : 'elfinder-navbar-root',\n\t\t\tnavdir      : 'elfinder-navbar-dir',\n\t\t\tnavdirwrap  : 'elfinder-navbar-dir-wrapper',\n\t\t\tnavarrow    : 'elfinder-navbar-arrow',\n\t\t\tnavsubtree  : 'elfinder-navbar-subtree',\n\t\t\tnavcollapse : 'elfinder-navbar-collapsed',\n\t\t\tnavexpand   : 'elfinder-navbar-expanded',\n\t\t\ttreedir     : 'elfinder-tree-dir',\n\t\t\tplacedir    : 'elfinder-place-dir',\n\t\t\tsearchbtn   : 'elfinder-button-search',\n\t\t\tediting     : 'elfinder-to-editing',\n\t\t\tpreventback : 'elfinder-prevent-back',\n\t\t\ttabstab     : 'ui-state-default ui-tabs-tab ui-corner-top ui-tab',\n\t\t\ttabsactive  : 'ui-tabs-active ui-state-active'\n\t\t},\n\t\ttpl : {\n\t\t\tperms      : '<span class=\"elfinder-perms\"/>',\n\t\t\tlock       : '<span class=\"elfinder-lock\"/>',\n\t\t\tsymlink    : '<span class=\"elfinder-symlink\"/>',\n\t\t\tnavicon    : '<span class=\"elfinder-nav-icon\"/>',\n\t\t\tnavspinner : '<span class=\"elfinder-spinner elfinder-navbar-spinner\"/>',\n\t\t\tnavdir     : '<div class=\"elfinder-navbar-wrapper{root}\"><span id=\"{id}\" class=\"ui-corner-all elfinder-navbar-dir {cssclass}\"{title}><span class=\"elfinder-navbar-arrow\"/><span class=\"elfinder-navbar-icon\" {style}/>{symlink}{permissions}{name}</span><div class=\"elfinder-navbar-subtree\" style=\"display:none\"/></div>',\n\t\t\tplacedir   : '<div class=\"elfinder-navbar-wrapper\"><span id=\"{id}\" class=\"ui-corner-all elfinder-navbar-dir {cssclass}\"{title}><span class=\"elfinder-navbar-arrow\"/><span class=\"elfinder-navbar-icon\" {style}/>{symlink}{permissions}{name}</span><div class=\"elfinder-navbar-subtree\" style=\"display:none\"/></div>'\n\t\t\t\n\t\t},\n\t\t// mimes.text will be overwritten with connector config if `textMimes` is included in initial response\n\t\t// @see php/elFInder.class.php `public static $textMimes`\n\t\tmimes : {\n\t\t\ttext : [\n\t\t\t\t'application/dash+xml',\n\t\t\t\t'application/docbook+xml',\n\t\t\t\t'application/javascript',\n\t\t\t\t'application/json',\n\t\t\t\t'application/plt',\n\t\t\t\t'application/sat',\n\t\t\t\t'application/sql',\n\t\t\t\t'application/step',\n\t\t\t\t'application/vnd.hp-hpgl',\n\t\t\t\t'application/x-awk',\n\t\t\t\t'application/x-config',\n\t\t\t\t'application/x-csh',\n\t\t\t\t'application/x-empty',\n\t\t\t\t'application/x-mpegurl',\n\t\t\t\t'application/x-perl',\n\t\t\t\t'application/x-php',\n\t\t\t\t'application/x-web-config',\n\t\t\t\t'application/xhtml+xml',\n\t\t\t\t'application/xml',\n\t\t\t\t'audio/x-mp3-playlist',\n\t\t\t\t'image/cgm',\n\t\t\t\t'image/svg+xml',\n\t\t\t\t'image/vnd.dxf',\n\t\t\t\t'model/iges'\n\t\t\t]\n\t\t},\n\t\t\n\t\tmixin : {\n\t\t\tmake : function() {\n\t\t\t\t\"use strict\";\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tcmd  = this.name,\n\t\t\t\t\treq  = this.requestCmd || cmd,\n\t\t\t\t\twz   = fm.getUI('workzone'),\n\t\t\t\t\torg  = (this.origin && this.origin === 'navbar')? 'tree' : 'cwd',\n\t\t\t\t\ttree = (org === 'tree'),\n\t\t\t\t\tfind = tree? 'navHash2Elm' : 'cwdHash2Elm',\n\t\t\t\t\ttarea= (! tree && fm.storage('view') != 'list'),\n\t\t\t\t\tsel  = fm.selected(),\n\t\t\t\t\tmove = this.move || false,\n\t\t\t\t\tempty= wz.hasClass('elfinder-cwd-wrapper-empty'),\n\t\t\t\t\tunselect = function() {\n\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\tinput && input.trigger('blur');\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\trest = function(){\n\t\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\t\toverlay.elfinderoverlay('hide').off('click close', cancel);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (nnode) {\n\t\t\t\t\t\t\tpnode.removeClass('ui-front')\n\t\t\t\t\t\t\t\t.css('position', '')\n\t\t\t\t\t\t\t\t.off('unselect.'+fm.namespace, unselect);\n\t\t\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\t\t\tnnode && nnode.css('max-height', '');\n\t\t\t\t\t\t\t} else if (!tree) {\n\t\t\t\t\t\t\t\tpnode.css('width', '')\n\t\t\t\t\t\t\t\t\t.parent('td').css('overflow', '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, colwidth,\n\t\t\t\t\tdfrd = $.Deferred()\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\tdstCls && dst.attr('class', dstCls);\n\t\t\t\t\t\t\tempty && wz.addClass('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\t\tif (sel) {\n\t\t\t\t\t\t\t\tmove && fm.trigger('unlockfiles', {files: sel});\n\t\t\t\t\t\t\t\tfm.clipboard([]);\n\t\t\t\t\t\t\t\tfm.trigger('selectfiles', { files: sel });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\trest();\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tfm.enable().unbind('open', openCallback).trigger('resMixinMake');\n\t\t\t\t\t\t}),\n\t\t\t\t\tid    = 'tmp_'+parseInt(Math.random()*100000),\n\t\t\t\t\tphash = this.data && this.data.target? this.data.target : (tree? fm.file(sel[0]).hash : fm.cwd().hash),\n\t\t\t\t\tdate = new Date(),\n\t\t\t\t\tfile   = {\n\t\t\t\t\t\thash  : id,\n\t\t\t\t\t\tphash : phash,\n\t\t\t\t\t\tname  : fm.uniqueName(this.prefix, phash),\n\t\t\t\t\t\tmime  : this.mime,\n\t\t\t\t\t\tread  : true,\n\t\t\t\t\t\twrite : true,\n\t\t\t\t\t\tdate  : 'Today '+date.getHours()+':'+date.getMinutes(),\n\t\t\t\t\t\tmove  : move\n\t\t\t\t\t},\n\t\t\t\t\tdum = fm.getUI(org).trigger('create.'+fm.namespace, file),\n\t\t\t\t\tdata = this.data || {},\n\t\t\t\t\tnode = fm[find](id),\n\t\t\t\t\tnnode, pnode,\n\t\t\t\t\toverlay = fm.getUI('overlay'),\n\t\t\t\t\tcleanup = function() {\n\t\t\t\t\t\tif (node && node.length) {\n\t\t\t\t\t\t\tinput.off();\n\t\t\t\t\t\t\tnode.hide();\n\t\t\t\t\t\t\tfm.unselectfiles({files : [id]}).unbind('resize', resize);\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tif (tree) {\n\t\t\t\t\t\t\t\t\tnode.closest('.elfinder-navbar-wrapper').remove();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcancel = function(e) { \n\t\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\t\tpnode.css('z-index', '');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (! inError) {\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tinput = $(tarea? '<textarea/>' : '<input type=\"text\"/>')\n\t\t\t\t\t\t.on('keyup text', function(){\n\t\t\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\t\t\tthis.style.height = '1px';\n\t\t\t\t\t\t\t\tthis.style.height = this.scrollHeight + 'px';\n\t\t\t\t\t\t\t} else if (colwidth) {\n\t\t\t\t\t\t\t\tthis.style.width = colwidth + 'px';\n\t\t\t\t\t\t\t\tif (this.scrollWidth > colwidth) {\n\t\t\t\t\t\t\t\t\tthis.style.width = this.scrollWidth + 10 + 'px';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t} else if (e.keyCode == $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tinput.trigger('blur');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('mousedown click dblclick', function(e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tif (e.type === 'dblclick') {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('blur', function() {\n\t\t\t\t\t\t\tvar name   = $.trim(input.val()),\n\t\t\t\t\t\t\t\tparent = input.parent(),\n\t\t\t\t\t\t\t\tvalid  = true,\n\t\t\t\t\t\t\t\tcut;\n\n\t\t\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\t\t\tpnode.css('z-index', '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (name === '') {\n\t\t\t\t\t\t\t\treturn cancel();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!inError && parent.length) {\n\n\t\t\t\t\t\t\t\tif (fm.options.validName && fm.options.validName.test) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tvalid = fm.options.validName.test(name);\n\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!name || name === '.' || name === '..' || !valid) {\n\t\t\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\t\t\tfm.error(file.mime === 'directory'? 'errInvDirname' : 'errInvName', {modal: true, close: function(){setTimeout(select, 120);}});\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (fm.fileByName(name, phash)) {\n\t\t\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\t\t\tfm.error(['errExists', name], {modal: true, close: function(){setTimeout(select, 120);}});\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcut = (sel && move)? fm.exec('cut', sel) : null;\n\n\t\t\t\t\t\t\t\t$.when(cut)\n\t\t\t\t\t\t\t\t.done(function() {\n\t\t\t\t\t\t\t\t\tvar toast   = {},\n\t\t\t\t\t\t\t\t\t\tnextAct = {};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\trest();\n\t\t\t\t\t\t\t\t\tinput.hide().before($('<span>').text(name));\n\n\t\t\t\t\t\t\t\t\tfm.lockfiles({files : [id]});\n\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\tdata        : Object.assign({cmd : req, name : name, target : phash}, data || {}), \n\t\t\t\t\t\t\t\t\t\t\tnotify      : {type : req, cnt : 1},\n\t\t\t\t\t\t\t\t\t\t\tpreventFail : true,\n\t\t\t\t\t\t\t\t\t\t\tsyncOnFail  : true,\n\t\t\t\t\t\t\t\t\t\t\tnavigate    : {toast : toast},\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : [id]});\n\t\t\t\t\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\t\t\t\t\tinput.show().prev().remove();\n\t\t\t\t\t\t\t\t\t\t\tfm.error(error, {\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (Array.isArray(error) && $.inArray('errUploadMime', error) !== -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.notify('errUploadMime').reject();\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(select, 120);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\tif (data && data.added && data.added[0]) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar item    = data.added[0],\n\t\t\t\t\t\t\t\t\t\t\t\t\tdirhash = item.hash,\n\t\t\t\t\t\t\t\t\t\t\t\t\tnewItem = fm[find](dirhash),\n\t\t\t\t\t\t\t\t\t\t\t\t\tacts    = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'directory' : { cmd: 'open', msg: 'cmdopendir' },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'text'      : { cmd: 'edit', msg: 'cmdedit' },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'default'   : { cmd: 'open', msg: 'cmdopen' }\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttmpMimes;\n\t\t\t\t\t\t\t\t\t\t\t\tif (sel && move) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.one(req+'done', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('paste', dirhash);\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tif (!move) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (fm.mimeIsText(item.mime) && !fm.mimesCanMakeEmpty[item.mime] && fm.mimeTypes[item.mime]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.trigger('canMakeEmptyFile', {mimes: [item.mime], unshift: true});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttmpMimes = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttmpMimes[item.mime] = fm.mimeTypes[item.mime];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.storage('mkfileTextMimes', Object.assign(tmpMimes, fm.storage('mkfileTextMimes') || {}));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tObject.assign(nextAct, nextAction || acts[item.mime] || acts[item.mime.split('/')[0]] || acts[(fm.mimesCanMakeEmpty[item.mime] || $.inArray(item.mime, fm.resources.mimes.text) !== -1) ? 'text' : 'none'] || acts['default']);\n\t\t\t\t\t\t\t\t\t\t\t\t\tObject.assign(toast, nextAct.cmd ? {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tincwd    : {msg: fm.i18n(['complete', fm.i18n('cmd'+cmd)]), action: nextAct},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('cmd'+cmd)]), action: nextAct}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} : {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('cmd'+cmd)])}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('dragenter dragleave dragover drop', function(e) {\n\t\t\t\t\t\t\t// stop bubbling to prevent upload with native drop event\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}),\n\t\t\t\t\tselect = function() {\n\t\t\t\t\t\tvar name = fm.splitFileExtention(input.val())[0];\n\t\t\t\t\t\tif (!inError && fm.UA.Mobile && !fm.UA.iOS) { // since iOS has a bug? (z-index not effect) so disable it\n\t\t\t\t\t\t\toverlay.on('click close', cancel).elfinderoverlay('show');\n\t\t\t\t\t\t\tpnode.css('z-index', overlay.css('z-index') + 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinError = false;\n\t\t\t\t\t\t! fm.enabled() && fm.enable();\n\t\t\t\t\t\tinput.trigger('focus').trigger('select');\n\t\t\t\t\t\tinput[0].setSelectionRange && input[0].setSelectionRange(0, name.length);\n\t\t\t\t\t},\n\t\t\t\t\tresize = function() {\n\t\t\t\t\t\tnode.trigger('scrolltoview', {blink : false});\n\t\t\t\t\t},\n\t\t\t\t\topenCallback = function() {\n\t\t\t\t\t\tdfrd && (dfrd.state() === 'pending') && dfrd.reject();\n\t\t\t\t\t},\n\t\t\t\t\tinError = false,\n\t\t\t\t\tnextAction,\n\t\t\t\t\t// for tree\n\t\t\t\t\tdst, dstCls, collapsed, expanded, arrow, subtree;\n\n\t\t\t\tif (!fm.isCommandEnabled(req, phash) || !node.length) {\n\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t}\n\n\t\t\t\tif ($.isPlainObject(self.nextAction)){\n\t\t\t\t\tnextAction = Object.assign({}, self.nextAction);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (tree) {\n\t\t\t\t\tdst = fm[find](phash);\n\t\t\t\t\tcollapsed = fm.res('class', 'navcollapse');\n\t\t\t\t\texpanded  = fm.res('class', 'navexpand');\n\t\t\t\t\tarrow = fm.res('class', 'navarrow');\n\t\t\t\t\tsubtree = fm.res('class', 'navsubtree');\n\t\t\t\t\t\n\t\t\t\t\tnode.closest('.'+subtree).show();\n\t\t\t\t\tif (! dst.hasClass(collapsed)) {\n\t\t\t\t\t\tdstCls = dst.attr('class');\n\t\t\t\t\t\tdst.addClass(collapsed+' '+expanded+' elfinder-subtree-loaded');\n\t\t\t\t\t}\n\t\t\t\t\tif (dst.is('.'+collapsed+':not(.'+expanded+')')) {\n\t\t\t\t\t\tdst.children('.'+arrow).trigger('click').data('dfrd').done(function() {\n\t\t\t\t\t\t\tif (input.val() === file.name) {\n\t\t\t\t\t\t\t\tinput.val(fm.uniqueName(self.prefix, phash)).trigger('select').trigger('focus');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tnnode = node.contents().filter(function(){ return this.nodeType==3 && $(this).parent().attr('id') === fm.navHash2Id(file.hash); });\n\t\t\t\t\tpnode = nnode.parent();\n\t\t\t\t\tnnode.replaceWith(input.val(file.name));\n\t\t\t\t} else {\n\t\t\t\t\tempty && wz.removeClass('elfinder-cwd-wrapper-empty');\n\t\t\t\t\tnnode = node.find('.elfinder-cwd-filename');\n\t\t\t\t\tpnode = nnode.parent();\n\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\tnnode.css('max-height', 'none');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcolwidth = pnode.width();\n\t\t\t\t\t\tpnode.width(colwidth - 15)\n\t\t\t\t\t\t\t.parent('td').css('overflow', 'visible');\n\t\t\t\t\t}\n\t\t\t\t\tnnode.empty().append(input.val(file.name));\n\t\t\t\t}\n\t\t\t\tpnode.addClass('ui-front')\n\t\t\t\t\t.css('position', 'relative')\n\t\t\t\t\t.on('unselect.'+fm.namespace, unselect);\n\t\t\t\t\n\t\t\t\tfm.bind('resize', resize).one('open', openCallback);\n\t\t\t\t\n\t\t\t\tinput.trigger('keyup');\n\t\t\t\tselect();\n\n\t\t\t\treturn dfrd;\n\n\t\t\t}\n\t\t},\n\t\tblink: function(elm, mode) {\n\t\t\t\"use strict\";\n\t\t\tvar acts = {\n\t\t\t\tslowonce : function(){elm.hide().delay(250).fadeIn(750).delay(500).fadeOut(3500);},\n\t\t\t\tlookme   : function(){elm.show().fadeOut(500).fadeIn(750);}\n\t\t\t}, func;\n\t\t\tmode = mode || 'slowonce';\n\t\t\t\n\t\t\tfunc = acts[mode] || acts['lookme'];\n\t\t\t\n\t\t\telm.stop(true, true);\n\t\t\tfunc();\n\t\t}\n\t};\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/jquery.dialogelfinder',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class dialogelfinder - open elFinder in dialog window\n\t *\n\t * @param  Object  elFinder options with dialog options\n\t * @example\n\t * $(selector).dialogelfinder({\n\t *     // some elfinder options\n\t *     title          : 'My files', // dialog title, default = \"Files\"\n\t *     width          : 850,        // dialog width, default 840\n\t *     autoOpen       : false,      // if false - dialog will not be opened after init, default = true\n\t *     destroyOnClose : true        // destroy elFinder on close dialog, default = false\n\t * })\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.dialogelfinder = function(opts, opts2) {\n\t\t\tvar position = 'elfinderPosition',\n\t\t\tdestroy  = 'elfinderDestroyOnClose',\n\t\t\tnode, pos;\n\n\t\tif ($.isPlainObject(opts)) {\n\t\t\tthis.not('.elfinder').each(function() {\n\n\t\t\t\topts.handlers = opts.handlers || {};\n\n\t\t\t\tvar node    = $(this),\n\t\t\t\t\tdoc     = $(document),\n\t\t\t\t\ttoolbar = $('<div class=\"ui-widget-header dialogelfinder-drag ui-corner-top\">'+(opts.title || 'Files')+'</div>'),\n\t\t\t\t\tbutton  = $('<a href=\"#\" class=\"dialogelfinder-drag-close ui-corner-all\"><span class=\"ui-icon ui-icon-closethick\"> </span></a>')\n\t\t\t\t\t\t.appendTo(toolbar)\n\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tnode.dialogelfinder('close');\n\t\t\t\t\t\t}),\n\t\t\t\t\tinit    = opts.handlers.init,\n\t\t\t\t\telfinder;\n\n\t\t\t\topts.handlers.init = function(e, fm) {\n\t\t\t\t\tnode.prepend(toolbar);\n\t\t\t\t\tinit && init(e, fm);\n\t\t\t\t};\n\n\t\t\t\telfinder = node.addClass('elfinder dialogelfinder touch-punch')\n\t\t\t\t\t.css('position', 'absolute')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.appendTo('body')\n\t\t\t\t\t.draggable({\n\t\t\t\t\t\thandle : '.dialogelfinder-drag',\n\t\t\t\t\t\tcontainment : 'window',\n\t\t\t\t\t\tstop : function() {\n\t\t\t\t\t\t\tnode.trigger('resize');\n\t\t\t\t\t\t\telfinder.trigger('resize');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.elfinder(opts, opts2)\n\t\t\t\t\t.elfinder('instance');\n\t\t\t\t\n\t\t\t\telfinder.reloadCallback = function(o, o2) {\n\t\t\t\t\telfinder.destroy();\n\t\t\t\t\to.handlers.init = init;\n\t\t\t\t\tnode.dialogelfinder(o, o2).dialogelfinder('open');\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tnode.width(parseInt(node.width()) || 840) // fix width if set to \"auto\"\n\t\t\t\t\t.data(destroy, !!opts.destroyOnClose)\n\t\t\t\t\t.find('.elfinder-toolbar').removeClass('ui-corner-top');\n\t\t\t\t\n\t\t\t\topts.position && node.data(position, opts.position);\n\t\t\t\t\n\t\t\t\topts.autoOpen !== false && $(this).dialogelfinder('open');\n\n\t\t\t});\n\t\t} else {\n\t\t\tif (opts === 'open') {\n\t\t\t\tnode = $(this);\n\t\t\t\tpos = node.data(position) || {\n\t\t\t\t\ttop  : parseInt($(document).scrollTop() + ($(window).height() < node.height() ? 2 : ($(window).height() - node.height())/2)),\n\t\t\t\t\tleft : parseInt($(document).scrollLeft() + ($(window).width() < node.width()  ? 2 : ($(window).width()  - node.width())/2))\n\t\t\t\t};\n\n\t\t\t\tif (node.is(':hidden')) {\n\t\t\t\t\tnode.addClass('ui-front').css(pos).show().trigger('resize');\n\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t// fix resize icon position and make elfinder active\n\t\t\t\t\t\tnode.trigger('resize').trigger('mousedown');\n\t\t\t\t\t}, 200);\n\t\t\t\t}\n\t\t\t} else if (opts === 'close') {\n\t\t\t\tnode = $(this).removeClass('ui-front');\n\t\t\t\t\t\n\t\t\t\tif (node.is(':visible')) {\n\t\t\t\t\t!!node.data(destroy)\n\t\t\t\t\t\t? node.elfinder('destroy').remove()\n\t\t\t\t\t\t: node.elfinder('close');\n\t\t\t\t}\n\t\t\t} else if (opts === 'instance') {\n\t\t\t\treturn $(this).getElFinder();\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t};\n\n});\ndefine('skylark-elfinder/i18n/elfinder.en',[\n\t\"../elFinder\"\n],function(elFinder){/**\n * English translation\n * @author Troex Nevelin <troex@fury.scancode.ru>\n * @author Naoki Sawada <hypweb+elfinder@gmail.com>\n * @version 2020-01-16\n */\n// elfinder.en.js is integrated into elfinder.(full|min).js by jake build\n\n\telFinder.prototype.i18.en = {\n\t\ttranslator : 'Troex Nevelin &lt;troex@fury.scancode.ru&gt;, Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;',\n\t\tlanguage   : 'English',\n\t\tdirection  : 'ltr',\n\t\tdateFormat : 'M d, Y h:i A', // will show like: Aug 24, 2018 04:39 PM\n\t\tfancyDateFormat : '$1 h:i A', // will show like: Today 04:39 PM\n\t\tnonameDateFormat : 'ymd-His', // noname upload will show like: 180824-163916\n\t\tmessages   : {\n\n\t\t\t/********************************** errors **********************************/\n\t\t\t'error'                : 'Error',\n\t\t\t'errUnknown'           : 'Unknown error.',\n\t\t\t'errUnknownCmd'        : 'Unknown command.',\n\t\t\t'errJqui'              : 'Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.',\n\t\t\t'errNode'              : 'elFinder requires DOM Element to be created.',\n\t\t\t'errURL'               : 'Invalid elFinder configuration! URL option is not set.',\n\t\t\t'errAccess'            : 'Access denied.',\n\t\t\t'errConnect'           : 'Unable to connect to backend.',\n\t\t\t'errAbort'             : 'Connection aborted.',\n\t\t\t'errTimeout'           : 'Connection timeout.',\n\t\t\t'errNotFound'          : 'Backend not found.',\n\t\t\t'errResponse'          : 'Invalid backend response.',\n\t\t\t'errConf'              : 'Invalid backend configuration.',\n\t\t\t'errJSON'              : 'PHP JSON module not installed.',\n\t\t\t'errNoVolumes'         : 'Readable volumes not available.',\n\t\t\t'errCmdParams'         : 'Invalid parameters for command \"$1\".',\n\t\t\t'errDataNotJSON'       : 'Data is not JSON.',\n\t\t\t'errDataEmpty'         : 'Data is empty.',\n\t\t\t'errCmdReq'            : 'Backend request requires command name.',\n\t\t\t'errOpen'              : 'Unable to open \"$1\".',\n\t\t\t'errNotFolder'         : 'Object is not a folder.',\n\t\t\t'errNotFile'           : 'Object is not a file.',\n\t\t\t'errRead'              : 'Unable to read \"$1\".',\n\t\t\t'errWrite'             : 'Unable to write into \"$1\".',\n\t\t\t'errPerm'              : 'Permission denied.',\n\t\t\t'errLocked'            : '\"$1\" is locked and can not be renamed, moved or removed.',\n\t\t\t'errExists'            : 'Item named \"$1\" already exists.',\n\t\t\t'errInvName'           : 'Invalid file name.',\n\t\t\t'errInvDirname'        : 'Invalid folder name.',  // from v2.1.24 added 12.4.2017\n\t\t\t'errFolderNotFound'    : 'Folder not found.',\n\t\t\t'errFileNotFound'      : 'File not found.',\n\t\t\t'errTrgFolderNotFound' : 'Target folder \"$1\" not found.',\n\t\t\t'errPopup'             : 'Browser prevented opening popup window. To open file enable it in browser options.',\n\t\t\t'errMkdir'             : 'Unable to create folder \"$1\".',\n\t\t\t'errMkfile'            : 'Unable to create file \"$1\".',\n\t\t\t'errRename'            : 'Unable to rename \"$1\".',\n\t\t\t'errCopyFrom'          : 'Copying files from volume \"$1\" not allowed.',\n\t\t\t'errCopyTo'            : 'Copying files to volume \"$1\" not allowed.',\n\t\t\t'errMkOutLink'         : 'Unable to create a link to outside the volume root.', // from v2.1 added 03.10.2015\n\t\t\t'errUpload'            : 'Upload error.',  // old name - errUploadCommon\n\t\t\t'errUploadFile'        : 'Unable to upload \"$1\".', // old name - errUpload\n\t\t\t'errUploadNoFiles'     : 'No files found for upload.',\n\t\t\t'errUploadTotalSize'   : 'Data exceeds the maximum allowed size.', // old name - errMaxSize\n\t\t\t'errUploadFileSize'    : 'File exceeds maximum allowed size.', //  old name - errFileMaxSize\n\t\t\t'errUploadMime'        : 'File type not allowed.',\n\t\t\t'errUploadTransfer'    : '\"$1\" transfer error.',\n\t\t\t'errUploadTemp'        : 'Unable to make temporary file for upload.', // from v2.1 added 26.09.2015\n\t\t\t'errNotReplace'        : 'Object \"$1\" already exists at this location and can not be replaced by object with another type.', // new\n\t\t\t'errReplace'           : 'Unable to replace \"$1\".',\n\t\t\t'errSave'              : 'Unable to save \"$1\".',\n\t\t\t'errCopy'              : 'Unable to copy \"$1\".',\n\t\t\t'errMove'              : 'Unable to move \"$1\".',\n\t\t\t'errCopyInItself'      : 'Unable to copy \"$1\" into itself.',\n\t\t\t'errRm'                : 'Unable to remove \"$1\".',\n\t\t\t'errTrash'             : 'Unable into trash.', // from v2.1.24 added 30.4.2017\n\t\t\t'errRmSrc'             : 'Unable remove source file(s).',\n\t\t\t'errExtract'           : 'Unable to extract files from \"$1\".',\n\t\t\t'errArchive'           : 'Unable to create archive.',\n\t\t\t'errArcType'           : 'Unsupported archive type.',\n\t\t\t'errNoArchive'         : 'File is not archive or has unsupported archive type.',\n\t\t\t'errCmdNoSupport'      : 'Backend does not support this command.',\n\t\t\t'errReplByChild'       : 'The folder \"$1\" can\\'t be replaced by an item it contains.',\n\t\t\t'errArcSymlinks'       : 'For security reason denied to unpack archives contains symlinks or files with not allowed names.', // edited 24.06.2012\n\t\t\t'errArcMaxSize'        : 'Archive files exceeds maximum allowed size.',\n\t\t\t'errResize'            : 'Unable to resize \"$1\".',\n\t\t\t'errResizeDegree'      : 'Invalid rotate degree.',  // added 7.3.2013\n\t\t\t'errResizeRotate'      : 'Unable to rotate image.',  // added 7.3.2013\n\t\t\t'errResizeSize'        : 'Invalid image size.',  // added 7.3.2013\n\t\t\t'errResizeNoChange'    : 'Image size not changed.',  // added 7.3.2013\n\t\t\t'errUsupportType'      : 'Unsupported file type.',\n\t\t\t'errNotUTF8Content'    : 'File \"$1\" is not in UTF-8 and cannot be edited.',  // added 9.11.2011\n\t\t\t'errNetMount'          : 'Unable to mount \"$1\".', // added 17.04.2012\n\t\t\t'errNetMountNoDriver'  : 'Unsupported protocol.',     // added 17.04.2012\n\t\t\t'errNetMountFailed'    : 'Mount failed.',         // added 17.04.2012\n\t\t\t'errNetMountHostReq'   : 'Host required.', // added 18.04.2012\n\t\t\t'errSessionExpires'    : 'Your session has expired due to inactivity.',\n\t\t\t'errCreatingTempDir'   : 'Unable to create temporary directory: \"$1\"',\n\t\t\t'errFtpDownloadFile'   : 'Unable to download file from FTP: \"$1\"',\n\t\t\t'errFtpUploadFile'     : 'Unable to upload file to FTP: \"$1\"',\n\t\t\t'errFtpMkdir'          : 'Unable to create remote directory on FTP: \"$1\"',\n\t\t\t'errArchiveExec'       : 'Error while archiving files: \"$1\"',\n\t\t\t'errExtractExec'       : 'Error while extracting files: \"$1\"',\n\t\t\t'errNetUnMount'        : 'Unable to unmount.', // from v2.1 added 30.04.2012\n\t\t\t'errConvUTF8'          : 'Not convertible to UTF-8', // from v2.1 added 08.04.2014\n\t\t\t'errFolderUpload'      : 'Try the modern browser, If you\\'d like to upload the folder.', // from v2.1 added 26.6.2015\n\t\t\t'errSearchTimeout'     : 'Timed out while searching \"$1\". Search result is partial.', // from v2.1 added 12.1.2016\n\t\t\t'errReauthRequire'     : 'Re-authorization is required.', // from v2.1.10 added 24.3.2016\n\t\t\t'errMaxTargets'        : 'Max number of selectable items is $1.', // from v2.1.17 added 17.10.2016\n\t\t\t'errRestore'           : 'Unable to restore from the trash. Can\\'t identify the restore destination.', // from v2.1.24 added 3.5.2017\n\t\t\t'errEditorNotFound'    : 'Editor not found to this file type.', // from v2.1.25 added 23.5.2017\n\t\t\t'errServerError'       : 'Error occurred on the server side.', // from v2.1.25 added 16.6.2017\n\t\t\t'errEmpty'             : 'Unable to empty folder \"$1\".', // from v2.1.25 added 22.6.2017\n\t\t\t'moreErrors'           : 'There are $1 more errors.', // from v2.1.44 added 9.12.2018\n\n\t\t\t/******************************* commands names ********************************/\n\t\t\t'cmdarchive'   : 'Create archive',\n\t\t\t'cmdback'      : 'Back',\n\t\t\t'cmdcopy'      : 'Copy',\n\t\t\t'cmdcut'       : 'Cut',\n\t\t\t'cmddownload'  : 'Download',\n\t\t\t'cmdduplicate' : 'Duplicate',\n\t\t\t'cmdedit'      : 'Edit file',\n\t\t\t'cmdextract'   : 'Extract files from archive',\n\t\t\t'cmdforward'   : 'Forward',\n\t\t\t'cmdgetfile'   : 'Select files',\n\t\t\t'cmdhelp'      : 'About this software',\n\t\t\t'cmdhome'      : 'Root',\n\t\t\t'cmdinfo'      : 'Get info',\n\t\t\t'cmdmkdir'     : 'New folder',\n\t\t\t'cmdmkdirin'   : 'Into New Folder', // from v2.1.7 added 19.2.2016\n\t\t\t'cmdmkfile'    : 'New file',\n\t\t\t'cmdopen'      : 'Open',\n\t\t\t'cmdpaste'     : 'Paste',\n\t\t\t'cmdquicklook' : 'Preview',\n\t\t\t'cmdreload'    : 'Reload',\n\t\t\t'cmdrename'    : 'Rename',\n\t\t\t'cmdrm'        : 'Delete',\n\t\t\t'cmdtrash'     : 'Into trash', //from v2.1.24 added 29.4.2017\n\t\t\t'cmdrestore'   : 'Restore', //from v2.1.24 added 3.5.2017\n\t\t\t'cmdsearch'    : 'Find files',\n\t\t\t'cmdup'        : 'Go to parent folder',\n\t\t\t'cmdupload'    : 'Upload files',\n\t\t\t'cmdview'      : 'View',\n\t\t\t'cmdresize'    : 'Resize & Rotate',\n\t\t\t'cmdsort'      : 'Sort',\n\t\t\t'cmdnetmount'  : 'Mount network volume', // added 18.04.2012\n\t\t\t'cmdnetunmount': 'Unmount', // from v2.1 added 30.04.2012\n\t\t\t'cmdplaces'    : 'To Places', // added 28.12.2014\n\t\t\t'cmdchmod'     : 'Change mode', // from v2.1 added 20.6.2015\n\t\t\t'cmdopendir'   : 'Open a folder', // from v2.1 added 13.1.2016\n\t\t\t'cmdcolwidth'  : 'Reset column width', // from v2.1.13 added 12.06.2016\n\t\t\t'cmdfullscreen': 'Full Screen', // from v2.1.15 added 03.08.2016\n\t\t\t'cmdmove'      : 'Move', // from v2.1.15 added 21.08.2016\n\t\t\t'cmdempty'     : 'Empty the folder', // from v2.1.25 added 22.06.2017\n\t\t\t'cmdundo'      : 'Undo', // from v2.1.27 added 31.07.2017\n\t\t\t'cmdredo'      : 'Redo', // from v2.1.27 added 31.07.2017\n\t\t\t'cmdpreference': 'Preferences', // from v2.1.27 added 03.08.2017\n\t\t\t'cmdselectall' : 'Select all', // from v2.1.28 added 15.08.2017\n\t\t\t'cmdselectnone': 'Select none', // from v2.1.28 added 15.08.2017\n\t\t\t'cmdselectinvert': 'Invert selection', // from v2.1.28 added 15.08.2017\n\t\t\t'cmdopennew'   : 'Open in new window', // from v2.1.38 added 3.4.2018\n\t\t\t'cmdhide'      : 'Hide (Preference)', // from v2.1.41 added 24.7.2018\n\n\t\t\t/*********************************** buttons ***********************************/\n\t\t\t'btnClose'  : 'Close',\n\t\t\t'btnSave'   : 'Save',\n\t\t\t'btnRm'     : 'Remove',\n\t\t\t'btnApply'  : 'Apply',\n\t\t\t'btnCancel' : 'Cancel',\n\t\t\t'btnNo'     : 'No',\n\t\t\t'btnYes'    : 'Yes',\n\t\t\t'btnMount'  : 'Mount',  // added 18.04.2012\n\t\t\t'btnApprove': 'Goto $1 & approve', // from v2.1 added 26.04.2012\n\t\t\t'btnUnmount': 'Unmount', // from v2.1 added 30.04.2012\n\t\t\t'btnConv'   : 'Convert', // from v2.1 added 08.04.2014\n\t\t\t'btnCwd'    : 'Here',      // from v2.1 added 22.5.2015\n\t\t\t'btnVolume' : 'Volume',    // from v2.1 added 22.5.2015\n\t\t\t'btnAll'    : 'All',       // from v2.1 added 22.5.2015\n\t\t\t'btnMime'   : 'MIME Type', // from v2.1 added 22.5.2015\n\t\t\t'btnFileName':'Filename',  // from v2.1 added 22.5.2015\n\t\t\t'btnSaveClose': 'Save & Close', // from v2.1 added 12.6.2015\n\t\t\t'btnBackup' : 'Backup', // fromv2.1 added 28.11.2015\n\t\t\t'btnRename'    : 'Rename',      // from v2.1.24 added 6.4.2017\n\t\t\t'btnRenameAll' : 'Rename(All)', // from v2.1.24 added 6.4.2017\n\t\t\t'btnPrevious' : 'Prev ($1/$2)', // from v2.1.24 added 11.5.2017\n\t\t\t'btnNext'     : 'Next ($1/$2)', // from v2.1.24 added 11.5.2017\n\t\t\t'btnSaveAs'   : 'Save As', // from v2.1.25 added 24.5.2017\n\n\t\t\t/******************************** notifications ********************************/\n\t\t\t'ntfopen'     : 'Open folder',\n\t\t\t'ntffile'     : 'Open file',\n\t\t\t'ntfreload'   : 'Reload folder content',\n\t\t\t'ntfmkdir'    : 'Creating folder',\n\t\t\t'ntfmkfile'   : 'Creating files',\n\t\t\t'ntfrm'       : 'Delete items',\n\t\t\t'ntfcopy'     : 'Copy items',\n\t\t\t'ntfmove'     : 'Move items',\n\t\t\t'ntfprepare'  : 'Checking existing items',\n\t\t\t'ntfrename'   : 'Rename files',\n\t\t\t'ntfupload'   : 'Uploading files',\n\t\t\t'ntfdownload' : 'Downloading files',\n\t\t\t'ntfsave'     : 'Save files',\n\t\t\t'ntfarchive'  : 'Creating archive',\n\t\t\t'ntfextract'  : 'Extracting files from archive',\n\t\t\t'ntfsearch'   : 'Searching files',\n\t\t\t'ntfresize'   : 'Resizing images',\n\t\t\t'ntfsmth'     : 'Doing something',\n\t\t\t'ntfloadimg'  : 'Loading image',\n\t\t\t'ntfnetmount' : 'Mounting network volume', // added 18.04.2012\n\t\t\t'ntfnetunmount': 'Unmounting network volume', // from v2.1 added 30.04.2012\n\t\t\t'ntfdim'      : 'Acquiring image dimension', // added 20.05.2013\n\t\t\t'ntfreaddir'  : 'Reading folder infomation', // from v2.1 added 01.07.2013\n\t\t\t'ntfurl'      : 'Getting URL of link', // from v2.1 added 11.03.2014\n\t\t\t'ntfchmod'    : 'Changing file mode', // from v2.1 added 20.6.2015\n\t\t\t'ntfpreupload': 'Verifying upload file name', // from v2.1 added 31.11.2015\n\t\t\t'ntfzipdl'    : 'Creating a file for download', // from v2.1.7 added 23.1.2016\n\t\t\t'ntfparents'  : 'Getting path infomation', // from v2.1.17 added 2.11.2016\n\t\t\t'ntfchunkmerge': 'Processing the uploaded file', // from v2.1.17 added 2.11.2016\n\t\t\t'ntftrash'    : 'Doing throw in the trash', // from v2.1.24 added 2.5.2017\n\t\t\t'ntfrestore'  : 'Doing restore from the trash', // from v2.1.24 added 3.5.2017\n\t\t\t'ntfchkdir'   : 'Checking destination folder', // from v2.1.24 added 3.5.2017\n\t\t\t'ntfundo'     : 'Undoing previous operation', // from v2.1.27 added 31.07.2017\n\t\t\t'ntfredo'     : 'Redoing previous undone', // from v2.1.27 added 31.07.2017\n\t\t\t'ntfchkcontent' : 'Checking contents', // from v2.1.41 added 3.8.2018\n\n\t\t\t/*********************************** volumes *********************************/\n\t\t\t'volume_Trash' : 'Trash', //from v2.1.24 added 29.4.2017\n\n\t\t\t/************************************ dates **********************************/\n\t\t\t'dateUnknown' : 'unknown',\n\t\t\t'Today'       : 'Today',\n\t\t\t'Yesterday'   : 'Yesterday',\n\t\t\t'msJan'       : 'Jan',\n\t\t\t'msFeb'       : 'Feb',\n\t\t\t'msMar'       : 'Mar',\n\t\t\t'msApr'       : 'Apr',\n\t\t\t'msMay'       : 'May',\n\t\t\t'msJun'       : 'Jun',\n\t\t\t'msJul'       : 'Jul',\n\t\t\t'msAug'       : 'Aug',\n\t\t\t'msSep'       : 'Sep',\n\t\t\t'msOct'       : 'Oct',\n\t\t\t'msNov'       : 'Nov',\n\t\t\t'msDec'       : 'Dec',\n\t\t\t'January'     : 'January',\n\t\t\t'February'    : 'February',\n\t\t\t'March'       : 'March',\n\t\t\t'April'       : 'April',\n\t\t\t'May'         : 'May',\n\t\t\t'June'        : 'June',\n\t\t\t'July'        : 'July',\n\t\t\t'August'      : 'August',\n\t\t\t'September'   : 'September',\n\t\t\t'October'     : 'October',\n\t\t\t'November'    : 'November',\n\t\t\t'December'    : 'December',\n\t\t\t'Sunday'      : 'Sunday',\n\t\t\t'Monday'      : 'Monday',\n\t\t\t'Tuesday'     : 'Tuesday',\n\t\t\t'Wednesday'   : 'Wednesday',\n\t\t\t'Thursday'    : 'Thursday',\n\t\t\t'Friday'      : 'Friday',\n\t\t\t'Saturday'    : 'Saturday',\n\t\t\t'Sun'         : 'Sun',\n\t\t\t'Mon'         : 'Mon',\n\t\t\t'Tue'         : 'Tue',\n\t\t\t'Wed'         : 'Wed',\n\t\t\t'Thu'         : 'Thu',\n\t\t\t'Fri'         : 'Fri',\n\t\t\t'Sat'         : 'Sat',\n\n\t\t\t/******************************** sort variants ********************************/\n\t\t\t'sortname'          : 'by name',\n\t\t\t'sortkind'          : 'by kind',\n\t\t\t'sortsize'          : 'by size',\n\t\t\t'sortdate'          : 'by date',\n\t\t\t'sortFoldersFirst'  : 'Folders first',\n\t\t\t'sortperm'          : 'by permission', // from v2.1.13 added 13.06.2016\n\t\t\t'sortmode'          : 'by mode',       // from v2.1.13 added 13.06.2016\n\t\t\t'sortowner'         : 'by owner',      // from v2.1.13 added 13.06.2016\n\t\t\t'sortgroup'         : 'by group',      // from v2.1.13 added 13.06.2016\n\t\t\t'sortAlsoTreeview'  : 'Also Treeview',  // from v2.1.15 added 01.08.2016\n\n\t\t\t/********************************** new items **********************************/\n\t\t\t'untitled file.txt' : 'NewFile.txt', // added 10.11.2015\n\t\t\t'untitled folder'   : 'NewFolder',   // added 10.11.2015\n\t\t\t'Archive'           : 'NewArchive',  // from v2.1 added 10.11.2015\n\t\t\t'untitled file'     : 'NewFile.$1',  // from v2.1.41 added 6.8.2018\n\t\t\t'extentionfile'     : '$1: File',    // from v2.1.41 added 6.8.2018\n\t\t\t'extentiontype'     : '$1: $2',      // from v2.1.43 added 17.10.2018\n\n\t\t\t/********************************** messages **********************************/\n\t\t\t'confirmReq'      : 'Confirmation required',\n\t\t\t'confirmRm'       : 'Are you sure you want to permanently remove items?<br/>This cannot be undone!',\n\t\t\t'confirmRepl'     : 'Replace old file with new one? (If it contains folders, it will be merged. To backup and replace, select Backup.)',\n\t\t\t'confirmRest'     : 'Replace existing item with the item in trash?', // fromv2.1.24 added 5.5.2017\n\t\t\t'confirmConvUTF8' : 'Not in UTF-8<br/>Convert to UTF-8?<br/>Contents become UTF-8 by saving after conversion.', // from v2.1 added 08.04.2014\n\t\t\t'confirmNonUTF8'  : 'Character encoding of this file couldn\\'t be detected. It need to temporarily convert to UTF-8 for editting.<br/>Please select character encoding of this file.', // from v2.1.19 added 28.11.2016\n\t\t\t'confirmNotSave'  : 'It has been modified.<br/>Losing work if you do not save changes.', // from v2.1 added 15.7.2015\n\t\t\t'confirmTrash'    : 'Are you sure you want to move items to trash bin?', //from v2.1.24 added 29.4.2017\n\t\t\t'confirmMove'     : 'Are you sure you want to move items to \"$1\"?', //from v2.1.50 added 27.7.2019\n\t\t\t'apllyAll'        : 'Apply to all',\n\t\t\t'name'            : 'Name',\n\t\t\t'size'            : 'Size',\n\t\t\t'perms'           : 'Permissions',\n\t\t\t'modify'          : 'Modified',\n\t\t\t'kind'            : 'Kind',\n\t\t\t'read'            : 'read',\n\t\t\t'write'           : 'write',\n\t\t\t'noaccess'        : 'no access',\n\t\t\t'and'             : 'and',\n\t\t\t'unknown'         : 'unknown',\n\t\t\t'selectall'       : 'Select all items',\n\t\t\t'selectfiles'     : 'Select item(s)',\n\t\t\t'selectffile'     : 'Select first item',\n\t\t\t'selectlfile'     : 'Select last item',\n\t\t\t'viewlist'        : 'List view',\n\t\t\t'viewicons'       : 'Icons view',\n\t\t\t'viewSmall'       : 'Small icons', // from v2.1.39 added 22.5.2018\n\t\t\t'viewMedium'      : 'Medium icons', // from v2.1.39 added 22.5.2018\n\t\t\t'viewLarge'       : 'Large icons', // from v2.1.39 added 22.5.2018\n\t\t\t'viewExtraLarge'  : 'Extra large icons', // from v2.1.39 added 22.5.2018\n\t\t\t'places'          : 'Places',\n\t\t\t'calc'            : 'Calculate',\n\t\t\t'path'            : 'Path',\n\t\t\t'aliasfor'        : 'Alias for',\n\t\t\t'locked'          : 'Locked',\n\t\t\t'dim'             : 'Dimensions',\n\t\t\t'files'           : 'Files',\n\t\t\t'folders'         : 'Folders',\n\t\t\t'items'           : 'Items',\n\t\t\t'yes'             : 'yes',\n\t\t\t'no'              : 'no',\n\t\t\t'link'            : 'Link',\n\t\t\t'searcresult'     : 'Search results',\n\t\t\t'selected'        : 'selected items',\n\t\t\t'about'           : 'About',\n\t\t\t'shortcuts'       : 'Shortcuts',\n\t\t\t'help'            : 'Help',\n\t\t\t'webfm'           : 'Web file manager',\n\t\t\t'ver'             : 'Version',\n\t\t\t'protocolver'     : 'protocol version',\n\t\t\t'homepage'        : 'Project home',\n\t\t\t'docs'            : 'Documentation',\n\t\t\t'github'          : 'Fork us on GitHub',\n\t\t\t'twitter'         : 'Follow us on Twitter',\n\t\t\t'facebook'        : 'Join us on Facebook',\n\t\t\t'team'            : 'Team',\n\t\t\t'chiefdev'        : 'chief developer',\n\t\t\t'developer'       : 'developer',\n\t\t\t'contributor'     : 'contributor',\n\t\t\t'maintainer'      : 'maintainer',\n\t\t\t'translator'      : 'translator',\n\t\t\t'icons'           : 'Icons',\n\t\t\t'dontforget'      : 'and don\\'t forget to take your towel',\n\t\t\t'shortcutsof'     : 'Shortcuts disabled',\n\t\t\t'dropFiles'       : 'Drop files here',\n\t\t\t'or'              : 'or',\n\t\t\t'selectForUpload' : 'Select files',\n\t\t\t'moveFiles'       : 'Move items',\n\t\t\t'copyFiles'       : 'Copy items',\n\t\t\t'restoreFiles'    : 'Restore items', // from v2.1.24 added 5.5.2017\n\t\t\t'rmFromPlaces'    : 'Remove from places',\n\t\t\t'aspectRatio'     : 'Aspect ratio',\n\t\t\t'scale'           : 'Scale',\n\t\t\t'width'           : 'Width',\n\t\t\t'height'          : 'Height',\n\t\t\t'resize'          : 'Resize',\n\t\t\t'crop'            : 'Crop',\n\t\t\t'rotate'          : 'Rotate',\n\t\t\t'rotate-cw'       : 'Rotate 90 degrees CW',\n\t\t\t'rotate-ccw'      : 'Rotate 90 degrees CCW',\n\t\t\t'degree'          : '',\n\t\t\t'netMountDialogTitle' : 'Mount network volume', // added 18.04.2012\n\t\t\t'protocol'            : 'Protocol', // added 18.04.2012\n\t\t\t'host'                : 'Host', // added 18.04.2012\n\t\t\t'port'                : 'Port', // added 18.04.2012\n\t\t\t'user'                : 'User', // added 18.04.2012\n\t\t\t'pass'                : 'Password', // added 18.04.2012\n\t\t\t'confirmUnmount'      : 'Are you sure to unmount $1?',  // from v2.1 added 30.04.2012\n\t\t\t'dropFilesBrowser': 'Drop or Paste files from browser', // from v2.1 added 30.05.2012\n\t\t\t'dropPasteFiles'  : 'Drop files, Paste URLs or images(clipboard) here', // from v2.1 added 07.04.2014\n\t\t\t'encoding'        : 'Encoding', // from v2.1 added 19.12.2014\n\t\t\t'locale'          : 'Locale',   // from v2.1 added 19.12.2014\n\t\t\t'searchTarget'    : 'Target: $1',                // from v2.1 added 22.5.2015\n\t\t\t'searchMime'      : 'Search by input MIME Type', // from v2.1 added 22.5.2015\n\t\t\t'owner'           : 'Owner', // from v2.1 added 20.6.2015\n\t\t\t'group'           : 'Group', // from v2.1 added 20.6.2015\n\t\t\t'other'           : 'Other', // from v2.1 added 20.6.2015\n\t\t\t'execute'         : 'Execute', // from v2.1 added 20.6.2015\n\t\t\t'perm'            : 'Permission', // from v2.1 added 20.6.2015\n\t\t\t'mode'            : 'Mode', // from v2.1 added 20.6.2015\n\t\t\t'emptyFolder'     : 'Folder is empty', // from v2.1.6 added 30.12.2015\n\t\t\t'emptyFolderDrop' : 'Folder is empty\\\\A Drop to add items', // from v2.1.6 added 30.12.2015\n\t\t\t'emptyFolderLTap' : 'Folder is empty\\\\A Long tap to add items', // from v2.1.6 added 30.12.2015\n\t\t\t'quality'         : 'Quality', // from v2.1.6 added 5.1.2016\n\t\t\t'autoSync'        : 'Auto sync',  // from v2.1.6 added 10.1.2016\n\t\t\t'moveUp'          : 'Move up',  // from v2.1.6 added 18.1.2016\n\t\t\t'getLink'         : 'Get URL link', // from v2.1.7 added 9.2.2016\n\t\t\t'selectedItems'   : 'Selected items ($1)', // from v2.1.7 added 2.19.2016\n\t\t\t'folderId'        : 'Folder ID', // from v2.1.10 added 3.25.2016\n\t\t\t'offlineAccess'   : 'Allow offline access', // from v2.1.10 added 3.25.2016\n\t\t\t'reAuth'          : 'To re-authenticate', // from v2.1.10 added 3.25.2016\n\t\t\t'nowLoading'      : 'Now loading...', // from v2.1.12 added 4.26.2016\n\t\t\t'openMulti'       : 'Open multiple files', // from v2.1.12 added 5.14.2016\n\t\t\t'openMultiConfirm': 'You are trying to open the $1 files. Are you sure you want to open in browser?', // from v2.1.12 added 5.14.2016\n\t\t\t'emptySearch'     : 'Search results is empty in search target.', // from v2.1.12 added 5.16.2016\n\t\t\t'editingFile'     : 'It is editing a file.', // from v2.1.13 added 6.3.2016\n\t\t\t'hasSelected'     : 'You have selected $1 items.', // from v2.1.13 added 6.3.2016\n\t\t\t'hasClipboard'    : 'You have $1 items in the clipboard.', // from v2.1.13 added 6.3.2016\n\t\t\t'incSearchOnly'   : 'Incremental search is only from the current view.', // from v2.1.13 added 6.30.2016\n\t\t\t'reinstate'       : 'Reinstate', // from v2.1.15 added 3.8.2016\n\t\t\t'complete'        : '$1 complete', // from v2.1.15 added 21.8.2016\n\t\t\t'contextmenu'     : 'Context menu', // from v2.1.15 added 9.9.2016\n\t\t\t'pageTurning'     : 'Page turning', // from v2.1.15 added 10.9.2016\n\t\t\t'volumeRoots'     : 'Volume roots', // from v2.1.16 added 16.9.2016\n\t\t\t'reset'           : 'Reset', // from v2.1.16 added 1.10.2016\n\t\t\t'bgcolor'         : 'Background color', // from v2.1.16 added 1.10.2016\n\t\t\t'colorPicker'     : 'Color picker', // from v2.1.16 added 1.10.2016\n\t\t\t'8pxgrid'         : '8px Grid', // from v2.1.16 added 4.10.2016\n\t\t\t'enabled'         : 'Enabled', // from v2.1.16 added 4.10.2016\n\t\t\t'disabled'        : 'Disabled', // from v2.1.16 added 4.10.2016\n\t\t\t'emptyIncSearch'  : 'Search results is empty in current view.\\\\A Press [Enter] to expand search target.', // from v2.1.16 added 5.10.2016\n\t\t\t'emptyLetSearch'  : 'First letter search results is empty in current view.', // from v2.1.23 added 24.3.2017\n\t\t\t'textLabel'       : 'Text label', // from v2.1.17 added 13.10.2016\n\t\t\t'minsLeft'        : '$1 mins left', // from v2.1.17 added 13.11.2016\n\t\t\t'openAsEncoding'  : 'Reopen with selected encoding', // from v2.1.19 added 2.12.2016\n\t\t\t'saveAsEncoding'  : 'Save with the selected encoding', // from v2.1.19 added 2.12.2016\n\t\t\t'selectFolder'    : 'Select folder', // from v2.1.20 added 13.12.2016\n\t\t\t'firstLetterSearch': 'First letter search', // from v2.1.23 added 24.3.2017\n\t\t\t'presets'         : 'Presets', // from v2.1.25 added 26.5.2017\n\t\t\t'tooManyToTrash'  : 'It\\'s too many items so it can\\'t into trash.', // from v2.1.25 added 9.6.2017\n\t\t\t'TextArea'        : 'TextArea', // from v2.1.25 added 14.6.2017\n\t\t\t'folderToEmpty'   : 'Empty the folder \"$1\".', // from v2.1.25 added 22.6.2017\n\t\t\t'filderIsEmpty'   : 'There are no items in a folder \"$1\".', // from v2.1.25 added 22.6.2017\n\t\t\t'preference'      : 'Preference', // from v2.1.26 added 28.6.2017\n\t\t\t'language'        : 'Language', // from v2.1.26 added 28.6.2017\n\t\t\t'clearBrowserData': 'Initialize the settings saved in this browser', // from v2.1.26 added 28.6.2017\n\t\t\t'toolbarPref'     : 'Toolbar settings', // from v2.1.27 added 2.8.2017\n\t\t\t'charsLeft'       : '... $1 chars left.',  // from v2.1.29 added 30.8.2017\n\t\t\t'linesLeft'       : '... $1 lines left.',  // from v2.1.52 added 16.1.2020\n\t\t\t'sum'             : 'Sum', // from v2.1.29 added 28.9.2017\n\t\t\t'roughFileSize'   : 'Rough file size', // from v2.1.30 added 2.11.2017\n\t\t\t'autoFocusDialog' : 'Focus on the element of dialog with mouseover',  // from v2.1.30 added 2.11.2017\n\t\t\t'select'          : 'Select', // from v2.1.30 added 23.11.2017\n\t\t\t'selectAction'    : 'Action when select file', // from v2.1.30 added 23.11.2017\n\t\t\t'useStoredEditor' : 'Open with the editor used last time', // from v2.1.30 added 23.11.2017\n\t\t\t'selectinvert'    : 'Invert selection', // from v2.1.30 added 25.11.2017\n\t\t\t'renameMultiple'  : 'Are you sure you want to rename $1 selected items like $2?<br/>This cannot be undone!', // from v2.1.31 added 4.12.2017\n\t\t\t'batchRename'     : 'Batch rename', // from v2.1.31 added 8.12.2017\n\t\t\t'plusNumber'      : '+ Number', // from v2.1.31 added 8.12.2017\n\t\t\t'asPrefix'        : 'Add prefix', // from v2.1.31 added 8.12.2017\n\t\t\t'asSuffix'        : 'Add suffix', // from v2.1.31 added 8.12.2017\n\t\t\t'changeExtention' : 'Change extention', // from v2.1.31 added 8.12.2017\n\t\t\t'columnPref'      : 'Columns settings (List view)', // from v2.1.32 added 6.2.2018\n\t\t\t'reflectOnImmediate' : 'All changes will reflect immediately to the archive.', // from v2.1.33 added 2.3.2018\n\t\t\t'reflectOnUnmount'   : 'Any changes will not reflect until un-mount this volume.', // from v2.1.33 added 2.3.2018\n\t\t\t'unmountChildren' : 'The following volume(s) mounted on this volume also unmounted. Are you sure to unmount it?', // from v2.1.33 added 5.3.2018\n\t\t\t'selectionInfo'   : 'Selection Info', // from v2.1.33 added 7.3.2018\n\t\t\t'hashChecker'     : 'Algorithms to show the file hash', // from v2.1.33 added 10.3.2018\n\t\t\t'infoItems'       : 'Info Items (Selection Info Panel)', // from v2.1.38 added 28.3.2018\n\t\t\t'pressAgainToExit': 'Press again to exit.', // from v2.1.38 added 1.4.2018\n\t\t\t'toolbar'         : 'Toolbar', // from v2.1.38 added 4.4.2018\n\t\t\t'workspace'       : 'Work Space', // from v2.1.38 added 4.4.2018\n\t\t\t'dialog'          : 'Dialog', // from v2.1.38 added 4.4.2018\n\t\t\t'all'             : 'All', // from v2.1.38 added 4.4.2018\n\t\t\t'iconSize'        : 'Icon Size (Icons view)', // from v2.1.39 added 7.5.2018\n\t\t\t'editorMaximized' : 'Open the maximized editor window', // from v2.1.40 added 30.6.2018\n\t\t\t'editorConvNoApi' : 'Because conversion by API is not currently available, please convert on the website.', //from v2.1.40 added 8.7.2018\n\t\t\t'editorConvNeedUpload' : 'After conversion, you must be upload with the item URL or a downloaded file to save the converted file.', //from v2.1.40 added 8.7.2018\n\t\t\t'convertOn'       : 'Convert on the site of $1', // from v2.1.40 added 10.7.2018\n\t\t\t'integrations'    : 'Integrations', // from v2.1.40 added 11.7.2018\n\t\t\t'integrationWith' : 'This elFinder has the following external services integrated. Please check the terms of use, privacy policy, etc. before using it.', // from v2.1.40 added 11.7.2018\n\t\t\t'showHidden'      : 'Show hidden items', // from v2.1.41 added 24.7.2018\n\t\t\t'hideHidden'      : 'Hide hidden items', // from v2.1.41 added 24.7.2018\n\t\t\t'toggleHidden'    : 'Show/Hide hidden items', // from v2.1.41 added 24.7.2018\n\t\t\t'makefileTypes'   : 'File types to enable with \"New file\"', // from v2.1.41 added 7.8.2018\n\t\t\t'typeOfTextfile'  : 'Type of the Text file', // from v2.1.41 added 7.8.2018\n\t\t\t'add'             : 'Add', // from v2.1.41 added 7.8.2018\n\t\t\t'theme'           : 'Theme', // from v2.1.43 added 19.10.2018\n\t\t\t'default'         : 'Default', // from v2.1.43 added 19.10.2018\n\t\t\t'description'     : 'Description', // from v2.1.43 added 19.10.2018\n\t\t\t'website'         : 'Website', // from v2.1.43 added 19.10.2018\n\t\t\t'author'          : 'Author', // from v2.1.43 added 19.10.2018\n\t\t\t'email'           : 'Email', // from v2.1.43 added 19.10.2018\n\t\t\t'license'         : 'License', // from v2.1.43 added 19.10.2018\n\t\t\t'exportToSave'    : 'This item can\\'t be saved. To avoid losing the edits you need to export to your PC.', // from v2.1.44 added 1.12.2018\n\t\t\t'dblclickToSelect': 'Double click on the file to select it.', // from v2.1.47 added 22.1.2019\n\t\t\t'useFullscreen'   : 'Use fullscreen mode', // from v2.1.47 added 19.2.2019\n\n\t\t\t/********************************** mimetypes **********************************/\n\t\t\t'kindUnknown'     : 'Unknown',\n\t\t\t'kindRoot'        : 'Volume Root', // from v2.1.16 added 16.10.2016\n\t\t\t'kindFolder'      : 'Folder',\n\t\t\t'kindSelects'     : 'Selections', // from v2.1.29 added 29.8.2017\n\t\t\t'kindAlias'       : 'Alias',\n\t\t\t'kindAliasBroken' : 'Broken alias',\n\t\t\t// applications\n\t\t\t'kindApp'         : 'Application',\n\t\t\t'kindPostscript'  : 'Postscript document',\n\t\t\t'kindMsOffice'    : 'Microsoft Office document',\n\t\t\t'kindMsWord'      : 'Microsoft Word document',\n\t\t\t'kindMsExcel'     : 'Microsoft Excel document',\n\t\t\t'kindMsPP'        : 'Microsoft Powerpoint presentation',\n\t\t\t'kindOO'          : 'Open Office document',\n\t\t\t'kindAppFlash'    : 'Flash application',\n\t\t\t'kindPDF'         : 'Portable Document Format (PDF)',\n\t\t\t'kindTorrent'     : 'Bittorrent file',\n\t\t\t'kind7z'          : '7z archive',\n\t\t\t'kindTAR'         : 'TAR archive',\n\t\t\t'kindGZIP'        : 'GZIP archive',\n\t\t\t'kindBZIP'        : 'BZIP archive',\n\t\t\t'kindXZ'          : 'XZ archive',\n\t\t\t'kindZIP'         : 'ZIP archive',\n\t\t\t'kindRAR'         : 'RAR archive',\n\t\t\t'kindJAR'         : 'Java JAR file',\n\t\t\t'kindTTF'         : 'True Type font',\n\t\t\t'kindOTF'         : 'Open Type font',\n\t\t\t'kindRPM'         : 'RPM package',\n\t\t\t// texts\n\t\t\t'kindText'        : 'Text document',\n\t\t\t'kindTextPlain'   : 'Plain text',\n\t\t\t'kindPHP'         : 'PHP source',\n\t\t\t'kindCSS'         : 'Cascading style sheet',\n\t\t\t'kindHTML'        : 'HTML document',\n\t\t\t'kindJS'          : 'Javascript source',\n\t\t\t'kindRTF'         : 'Rich Text Format',\n\t\t\t'kindC'           : 'C source',\n\t\t\t'kindCHeader'     : 'C header source',\n\t\t\t'kindCPP'         : 'C++ source',\n\t\t\t'kindCPPHeader'   : 'C++ header source',\n\t\t\t'kindShell'       : 'Unix shell script',\n\t\t\t'kindPython'      : 'Python source',\n\t\t\t'kindJava'        : 'Java source',\n\t\t\t'kindRuby'        : 'Ruby source',\n\t\t\t'kindPerl'        : 'Perl script',\n\t\t\t'kindSQL'         : 'SQL source',\n\t\t\t'kindXML'         : 'XML document',\n\t\t\t'kindAWK'         : 'AWK source',\n\t\t\t'kindCSV'         : 'Comma separated values',\n\t\t\t'kindDOCBOOK'     : 'Docbook XML document',\n\t\t\t'kindMarkdown'    : 'Markdown text', // added 20.7.2015\n\t\t\t// images\n\t\t\t'kindImage'       : 'Image',\n\t\t\t'kindBMP'         : 'BMP image',\n\t\t\t'kindJPEG'        : 'JPEG image',\n\t\t\t'kindGIF'         : 'GIF Image',\n\t\t\t'kindPNG'         : 'PNG Image',\n\t\t\t'kindTIFF'        : 'TIFF image',\n\t\t\t'kindTGA'         : 'TGA image',\n\t\t\t'kindPSD'         : 'Adobe Photoshop image',\n\t\t\t'kindXBITMAP'     : 'X bitmap image',\n\t\t\t'kindPXM'         : 'Pixelmator image',\n\t\t\t// media\n\t\t\t'kindAudio'       : 'Audio media',\n\t\t\t'kindAudioMPEG'   : 'MPEG audio',\n\t\t\t'kindAudioMPEG4'  : 'MPEG-4 audio',\n\t\t\t'kindAudioMIDI'   : 'MIDI audio',\n\t\t\t'kindAudioOGG'    : 'Ogg Vorbis audio',\n\t\t\t'kindAudioWAV'    : 'WAV audio',\n\t\t\t'AudioPlaylist'   : 'MP3 playlist',\n\t\t\t'kindVideo'       : 'Video media',\n\t\t\t'kindVideoDV'     : 'DV movie',\n\t\t\t'kindVideoMPEG'   : 'MPEG movie',\n\t\t\t'kindVideoMPEG4'  : 'MPEG-4 movie',\n\t\t\t'kindVideoAVI'    : 'AVI movie',\n\t\t\t'kindVideoMOV'    : 'Quick Time movie',\n\t\t\t'kindVideoWM'     : 'Windows Media movie',\n\t\t\t'kindVideoFlash'  : 'Flash movie',\n\t\t\t'kindVideoMKV'    : 'Matroska movie',\n\t\t\t'kindVideoOGG'    : 'Ogg movie'\n\t\t}\n\t};\n\n\treturn elFinder;\n})\n\n;\ndefine('skylark-elfinder/ui/button',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar button widget.\n\t * If command has variants - create menu\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\t\n\t\t\tvar c        = 'class',\n\t\t\t\tfm       = cmd.fm,\n\t\t\t\tdisabled = fm.res(c, 'disabled'),\n\t\t\t\tactive   = fm.res(c, 'active'),\n\t\t\t\thover    = fm.res(c, 'hover'),\n\t\t\t\titem     = 'elfinder-button-menu-item',\n\t\t\t\tselected = 'elfinder-button-menu-item-selected',\n\t\t\t\tmenu,\n\t\t\t\ttext     = $('<span class=\"elfinder-button-text\">'+cmd.title+'</span>'),\n\t\t\t\tprvCname = cmd.className? cmd.className : cmd.name,\n\t\t\t\tbutton   = $(this).addClass('ui-state-default elfinder-button')\n\t\t\t\t\t.attr('title', cmd.title)\n\t\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-' + prvCname + '\"/>', text)\n\t\t\t\t\t.on('mouseenter mouseleave', function(e) { !button.hasClass(disabled) && button[e.type == 'mouseleave' ? 'removeClass' : 'addClass'](hover);})\n\t\t\t\t\t.on('click', function(e) { \n\t\t\t\t\t\tif (!button.hasClass(disabled)) {\n\t\t\t\t\t\t\tif (menu && cmd.variants.length >= 1) {\n\t\t\t\t\t\t\t\t// close other menus\n\t\t\t\t\t\t\t\tmenu.is(':hidden') && fm.getUI().click();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tmenu.css(getMenuOffset()).slideToggle({\n\t\t\t\t\t\t\t\t\tduration: 100,\n\t\t\t\t\t\t\t\t\tdone: function(e) {\n\t\t\t\t\t\t\t\t\t\tfm[menu.is(':visible')? 'toFront' : 'toHide'](menu);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.exec(cmd.name, getSelected(), {_userAction: true, _currentType: 'toolbar', _currentNode: button });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\thideMenu = function() {\n\t\t\t\t\tfm.toHide(menu);\n\t\t\t\t},\n\t\t\t\tgetMenuOffset = function() {\n\t\t\t\t\tvar fmNode = fm.getUI(),\n\t\t\t\t\t\tbaseOffset = fmNode.offset(),\n\t\t\t\t\t\tbuttonOffset = button.offset();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttop : buttonOffset.top - baseOffset.top,\n\t\t\t\t\t\tleft : buttonOffset.left - baseOffset.left,\n\t\t\t\t\t\tmaxHeight : fmNode.height() - 40\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tgetSelected = function() {\n\t\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\t\tcwd;\n\t\t\t\t\tif (!sel.length) {\n\t\t\t\t\t\tif (cwd = fm.cwd()) {\n\t\t\t\t\t\t\tsel = [ fm.cwd().hash ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsel = void(0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn sel;\n\t\t\t\t},\n\t\t\t\ttm;\n\t\t\t\t\n\t\t\ttext.hide();\n\t\t\t\n\t\t\t// set self button object to cmd object\n\t\t\tcmd.button = button;\n\t\t\t\n\t\t\t// if command has variants create menu\n\t\t\tif (Array.isArray(cmd.variants)) {\n\t\t\t\tbutton.addClass('elfinder-menubutton');\n\t\t\t\t\n\t\t\t\tmenu = $('<div class=\"ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-' + prvCname + '-menu ui-corner-all\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.appendTo(fm.getUI())\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+item, function() { $(this).toggleClass(hover); })\n\t\t\t\t\t.on('click', '.'+item, function(e) {\n\t\t\t\t\t\tvar opts = $(this).data('value');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tbutton.removeClass(hover);\n\t\t\t\t\t\tfm.toHide(menu);\n\t\t\t\t\t\tif (typeof opts === 'undefined') {\n\t\t\t\t\t\t\topts = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof opts === 'object') {\n\t\t\t\t\t\t\topts._userAction = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.exec(cmd.name, getSelected(), opts);\n\t\t\t\t\t})\n\t\t\t\t\t.on('close', hideMenu);\n\n\t\t\t\tfm.bind('disable select', hideMenu).getUI().on('click', hideMenu);\n\t\t\t\t\n\t\t\t\tcmd.change(function() {\n\t\t\t\t\tmenu.html('');\n\t\t\t\t\t$.each(cmd.variants, function(i, variant) {\n\t\t\t\t\t\tmenu.append($('<div class=\"'+item+'\">'+variant[1]+'</div>').data('value', variant[0]).addClass(variant[0] == cmd.value ? selected : ''));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\t\n\t\t\t\t\n\t\t\tcmd.change(function() {\n\t\t\t\tvar cName;\n\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\tif (cmd.disabled()) {\n\t\t\t\t\t\tbutton.removeClass(active+' '+hover).addClass(disabled);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbutton.removeClass(disabled);\n\t\t\t\t\t\tbutton[cmd.active() ? 'addClass' : 'removeClass'](active);\n\t\t\t\t\t}\n\t\t\t\t\tif (cmd.syncTitleOnChange) {\n\t\t\t\t\t\tcName = cmd.className? cmd.className : cmd.name;\n\t\t\t\t\t\tif (prvCname !== cName) {\n\t\t\t\t\t\t\tbutton.children('.elfinder-button-icon').removeClass('elfinder-button-icon-' + prvCname).addClass('elfinder-button-icon-' + cName);\n\t\t\t\t\t\t\tif (menu) {\n\t\t\t\t\t\t\t\tmenu.removeClass('elfinder-button-' + prvCname + '-menu').addClass('elfinder-button-' + cName + '-menu');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprvCname = cName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttext.html(cmd.title);\n\t\t\t\t\t\tbutton.attr('title', cmd.title);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.change();\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/contextmenu',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder contextmenu\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindercontextmenu = function(fm) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar self   = $(this),\n\t\t\t\tcmItem = 'elfinder-contextmenu-item',\n\t\t\t\tsmItem = 'elfinder-contextsubmenu-item',\n\t\t\t\texIcon = 'elfinder-contextmenu-extra-icon',\n\t\t\t\tcHover = fm.res('class', 'hover'),\n\t\t\t\tdragOpt = {\n\t\t\t\t\tdistance: 8,\n\t\t\t\t\tstart: function() {\n\t\t\t\t\t\tmenu.data('drag', true).data('touching') && menu.find('.'+cHover).removeClass(cHover);\n\t\t\t\t\t},\n\t\t\t\t\tstop: function() {\n\t\t\t\t\t\tmenu.data('draged', true).removeData('drag');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmenu = $(this).addClass('touch-punch ui-helper-reset ui-front ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-'+fm.direction)\n\t\t\t\t\t.hide()\n\t\t\t\t\t.on('touchstart', function(e) {\n\t\t\t\t\t\tmenu.data('touching', true).children().removeClass(cHover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchend', function(e) {\n\t\t\t\t\t\tmenu.removeData('touching');\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+cmItem, function(e) {\n\t\t\t\t\t\t$(this).toggleClass(cHover, (e.type === 'mouseenter' || (! menu.data('draged') && menu.data('submenuKeep'))? true : false));\n\t\t\t\t\t\tif (menu.data('draged') && menu.data('submenuKeep')) {\n\t\t\t\t\t\t\tmenu.find('.elfinder-contextmenu-sub:visible').parent().addClass(cHover);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+exIcon, function(e) {\n\t\t\t\t\t\t$(this).parent().toggleClass(cHover, e.type === 'mouseleave');\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+cmItem+',.'+smItem, function(e) {\n\t\t\t\t\t\tvar setIndex = function(target, sub) {\n\t\t\t\t\t\t\t$.each(sub? subnodes : nodes, function(i, n) {\n\t\t\t\t\t\t\t\tif (target[0] === n) {\n\t\t\t\t\t\t\t\t\t(sub? subnodes : nodes)._cur = i;\n\t\t\t\t\t\t\t\t\tif (sub) {\n\t\t\t\t\t\t\t\t\t\tsubselected = target;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tselected = target;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (e.originalEvent) {\n\t\t\t\t\t\t\tvar target = $(this),\n\t\t\t\t\t\t\t\tunHover = function() {\n\t\t\t\t\t\t\t\t\tif (selected && !selected.children('div.elfinder-contextmenu-sub:visible').length) {\n\t\t\t\t\t\t\t\t\t\tselected.removeClass(cHover);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (e.type === 'mouseenter') {\n\t\t\t\t\t\t\t\t// mouseenter\n\t\t\t\t\t\t\t\tif (target.hasClass(smItem)) {\n\t\t\t\t\t\t\t\t\t// submenu\n\t\t\t\t\t\t\t\t\tif (subselected) {\n\t\t\t\t\t\t\t\t\t\tsubselected.removeClass(cHover);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (selected) {\n\t\t\t\t\t\t\t\t\t\tsubnodes = selected.find('div.'+smItem);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsetIndex(target, true);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// menu\n\t\t\t\t\t\t\t\t\tunHover();\n\t\t\t\t\t\t\t\t\tsetIndex(target);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// mouseleave\n\t\t\t\t\t\t\t\tif (target.hasClass(smItem)) {\n\t\t\t\t\t\t\t\t\t//submenu\n\t\t\t\t\t\t\t\t\tsubselected = null;\n\t\t\t\t\t\t\t\t\tsubnodes = null;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// menu\n\t\t\t\t\t\t\t\t\tunHover();\n\t\t\t\t\t\t\t\t\t(function(sel) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tif (sel === selected) {\n\t\t\t\t\t\t\t\t\t\t\t\tselected = null;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}, 250);\n\t\t\t\t\t\t\t\t\t})(selected);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu', function(){return false;})\n\t\t\t\t\t.on('mouseup', function() {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tmenu.removeData('draged');\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t})\n\t\t\t\t\t.draggable(dragOpt),\n\t\t\t\tltr = fm.direction === 'ltr',\n\t\t\t\tsubpos = ltr? 'left' : 'right',\n\t\t\t\ttypes = Object.assign({}, fm.options.contextmenu),\n\t\t\t\t//tpl     = '<div class=\"'+cmItem+'{className}\"><span class=\"elfinder-button-icon {icon} elfinder-contextmenu-icon\"{style}/><span>{label}</span></div>',\n\t\t\t\ttpl     = '<div class=\"'+cmItem+'{className}\"><span class=\"elfinder-button-icon {icon} elfinder-contextmenu-icon\"{style}/><span>{label}</span></div>', //modified by lwf\n\t\t\t\titem = function(label, icon, callback, opts) {\n\t\t\t\t\tvar className = '',\n\t\t\t\t\t\tstyle = '',\n\t\t\t\t\t\ticonClass = '',\n\t\t\t\t\t\tv, pos;\n\t\t\t\t\tif (opts) {\n\t\t\t\t\t\tif (opts.className) {\n\t\t\t\t\t\t\tclassName = ' ' + opts.className;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.iconClass) {\n\t\t\t\t\t\t\ticonClass = opts.iconClass;\n\t\t\t\t\t\t\ticon = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.iconImg) {\n\t\t\t\t\t\t\tv = opts.iconImg.split(/ +/);\n\t\t\t\t\t\t\tpos = v[1] && v[2]? fm.escape(v[1] + 'px ' + v[2] + 'px') : '';\n\t\t\t\t\t\t\tstyle = ' style=\"background:url(\\''+fm.escape(v[0])+'\\') '+(pos? pos : '0 0')+' no-repeat;'+(pos? '' : 'posbackground-size:contain;')+'\"';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn $(tpl.replace('{icon}', icon ? 'elfinder-button-icon-'+icon : (iconClass? iconClass : ''))\n\t\t\t\t\t\t\t.replace('{label}', label)\n\t\t\t\t\t\t\t.replace('{style}', style)\n\t\t\t\t\t\t\t.replace('{className}', className))\n\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\turlIcon = function(iconUrl) {\n\t\t\t\t\tvar v = iconUrl.split(/ +/),\n\t\t\t\t\t\tpos = v[1] && v[2]? (v[1] + 'px ' + v[2] + 'px') : '';\n\t\t\t\t\treturn {\n\t\t\t\t\t\tbackgroundImage: 'url(\"'+v[0]+'\")',\n\t\t\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t\t\t\tbackgroundPosition: pos? pos : '',\n\t\t\t\t\t\tbackgroundSize: pos? '' : 'contain'\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tbase, cwd,\n\t\t\t\tnodes, selected, subnodes, subselected, autoSyncStop, subHoverTm,\n\n\t\t\t\tautoToggle = function() {\n\t\t\t\t\tvar evTouchStart = 'touchstart.contextmenuAutoToggle';\n\t\t\t\t\tmenu.data('hideTm') && clearTimeout(menu.data('hideTm'));\n\t\t\t\t\tif (menu.is(':visible')) {\n\t\t\t\t\t\tmenu.on('touchstart', function(e) {\n\t\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmenu.stop();\n\t\t\t\t\t\t\tfm.toFront(menu);\n\t\t\t\t\t\t\tmenu.data('hideTm') && clearTimeout(menu.data('hideTm'));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.data('hideTm', setTimeout(function() {\n\t\t\t\t\t\t\tif (menu.is(':visible')) {\n\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file').off(evTouchStart);\n\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file.ui-selected')\n\t\t\t\t\t\t\t\t.one(evTouchStart, function(e) {\n\t\t\t\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tvar tgt = $(e.target);\n\t\t\t\t\t\t\t\t\tif (menu.first().length && !tgt.is('input:checkbox') && !tgt.hasClass('elfinder-cwd-select')) {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t//e.preventDefault();\n\t\t\t\t\t\t\t\t\t\topen(e.originalEvent.touches[0].pageX, e.originalEvent.touches[0].pageY);\n\t\t\t\t\t\t\t\t\t\tcwd.data('longtap', true)\n\t\t\t\t\t\t\t\t\t\ttgt.one('touchend', function() {\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tcwd.removeData('longtap');\n\t\t\t\t\t\t\t\t\t\t\t}, 80);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file').off(evTouchStart);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.one('unselect.'+fm.namespace, function() {\n\t\t\t\t\t\t\t\t\tcwd.find('.elfinder-cwd-file').off(evTouchStart);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tmenu.fadeOut({\n\t\t\t\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\t\t\t\tfail: function() {\n\t\t\t\t\t\t\t\t\t\tmenu.css('opacity', '1').show();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdone: function() {\n\t\t\t\t\t\t\t\t\t\tfm.toHide(menu);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 4500));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tkeyEvts = function(e) {\n\t\t\t\t\tvar code = e.keyCode,\n\t\t\t\t\t\tESC = $.ui.keyCode.ESCAPE,\n\t\t\t\t\t\tENT = $.ui.keyCode.ENTER,\n\t\t\t\t\t\tLEFT = $.ui.keyCode.LEFT,\n\t\t\t\t\t\tRIGHT = $.ui.keyCode.RIGHT,\n\t\t\t\t\t\tUP = $.ui.keyCode.UP,\n\t\t\t\t\t\tDOWN = $.ui.keyCode.DOWN,\n\t\t\t\t\t\tsubent = fm.direction === 'ltr'? RIGHT : LEFT,\n\t\t\t\t\t\tsublev = subent === RIGHT? LEFT : RIGHT;\n\t\t\t\t\t\n\t\t\t\t\tif ($.inArray(code, [ESC, ENT, LEFT, RIGHT, UP, DOWN]) !== -1) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tif (code == ESC || code === sublev) {\n\t\t\t\t\t\t\tif (selected && subnodes && subselected) {\n\t\t\t\t\t\t\t\tsubselected.trigger('mouseleave').trigger('submenuclose');\n\t\t\t\t\t\t\t\tselected.addClass(cHover);\n\t\t\t\t\t\t\t\tsubnodes = null;\n\t\t\t\t\t\t\t\tsubselected = null;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcode == ESC && close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (code == UP || code == DOWN) {\n\t\t\t\t\t\t\tif (subnodes) {\n\t\t\t\t\t\t\t\tif (subselected) {\n\t\t\t\t\t\t\t\t\tsubselected.trigger('mouseleave');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (code == DOWN && (! subselected || subnodes.length <= ++subnodes._cur)) {\n\t\t\t\t\t\t\t\t\tsubnodes._cur = 0;\n\t\t\t\t\t\t\t\t} else if (code == UP && (! subselected || --subnodes._cur < 0)) {\n\t\t\t\t\t\t\t\t\tsubnodes._cur = subnodes.length - 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tsubselected = subnodes.eq(subnodes._cur).trigger('mouseenter');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsubnodes = null;\n\t\t\t\t\t\t\t\tif (selected) {\n\t\t\t\t\t\t\t\t\tselected.trigger('mouseleave');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (code == DOWN && (! selected || nodes.length <= ++nodes._cur)) {\n\t\t\t\t\t\t\t\t\tnodes._cur = 0;\n\t\t\t\t\t\t\t\t} else if (code == UP && (! selected || --nodes._cur < 0)) {\n\t\t\t\t\t\t\t\t\tnodes._cur = nodes.length - 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tselected = nodes.eq(nodes._cur).addClass(cHover);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (selected && (code == ENT || code === subent)) {\n\t\t\t\t\t\t\tif (selected.hasClass('elfinder-contextmenu-group')) {\n\t\t\t\t\t\t\t\tif (subselected) {\n\t\t\t\t\t\t\t\t\tcode == ENT && subselected.click();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tselected.trigger('mouseenter');\n\t\t\t\t\t\t\t\t\tsubnodes = selected.find('div.'+smItem);\n\t\t\t\t\t\t\t\t\tsubnodes._cur = 0;\n\t\t\t\t\t\t\t\t\tsubselected = subnodes.first().addClass(cHover);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcode == ENT && selected.click();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\topen = function(x, y, css) {\n\t\t\t\t\tvar width      = menu.outerWidth(),\n\t\t\t\t\t\theight     = menu.outerHeight(),\n\t\t\t\t\t\tbstyle     = base.attr('style'),\n\t\t\t\t\t\tbpos       = base.offset(),\n\t\t\t\t\t\tbwidth     = base.width(),\n\t\t\t\t\t\tbheight    = base.height(),\n\t\t\t\t\t\tmw         = fm.UA.Mobile? 40 : 2,\n\t\t\t\t\t\tmh         = fm.UA.Mobile? 20 : 2,\n\t\t\t\t\t\tx          = x - (bpos? bpos.left : 0),\n\t\t\t\t\t\ty          = y - (bpos? bpos.top : 0),\n\t\t\t\t\t\tcss        = Object.assign(css || {}, {\n\t\t\t\t\t\t\ttop  : Math.max(0, y + mh + height < bheight ? y + mh : y - (y + height - bheight)),\n\t\t\t\t\t\t\tleft : Math.max(0, (x < width + mw || x + mw + width < bwidth)? x + mw : x - mw - width),\n\t\t\t\t\t\t\topacity : '1'\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tevts;\n\n\t\t\t\t\tautoSyncStop = true;\n\t\t\t\t\tfm.autoSync('stop');\n\t\t\t\t\tbase.width(bwidth);\n\t\t\t\t\tmenu.stop().removeAttr('style').css(css);\n\t\t\t\t\tfm.toFront(menu);\n\t\t\t\t\tmenu.show();\n\t\t\t\t\tbase.attr('style', bstyle);\n\t\t\t\t\t\n\t\t\t\t\tcss[subpos] = parseInt(menu.width());\n\t\t\t\t\tmenu.find('.elfinder-contextmenu-sub').css(css);\n\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t$('div.elfinder div.overflow-scrolling-touch').css('-webkit-overflow-scrolling', 'auto');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tselected = null;\n\t\t\t\t\tsubnodes = null;\n\t\t\t\t\tsubselected = null;\n\t\t\t\t\t$(document).on('keydown.' + fm.namespace, keyEvts);\n\t\t\t\t\tevts = $._data(document).events;\n\t\t\t\t\tif (evts && evts.keydown) {\n\t\t\t\t\t\tevts.keydown.unshift(evts.keydown.pop());\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfm.UA.Mobile && autoToggle();\n\t\t\t\t\t\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tfm.getUI().one('click.' + fm.namespace, close);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tclose = function() {\n\t\t\t\t\tfm.getUI().off('click.' + fm.namespace, close);\n\t\t\t\t\t$(document).off('keydown.' + fm.namespace, keyEvts);\n\n\t\t\t\t\tcurrentType = currentTargets = null;\n\t\t\t\t\t\n\t\t\t\t\tif (menu.is(':visible') || menu.children().length) {\n\t\t\t\t\t\tfm.toHide(menu.removeAttr('style').empty().removeData('submenuKeep'));\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (! menu.draggable('instance')) {\n\t\t\t\t\t\t\t\tmenu.draggable(dragOpt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tif (! menu.hasClass('ui-draggable')) {\n\t\t\t\t\t\t\t\tmenu.draggable(dragOpt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (menu.data('prevNode')) {\n\t\t\t\t\t\t\tmenu.data('prevNode').after(menu);\n\t\t\t\t\t\t\tmenu.removeData('prevNode');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.trigger('closecontextmenu');\n\t\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t\t$('div.elfinder div.overflow-scrolling-touch').css('-webkit-overflow-scrolling', 'touch');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tautoSyncStop && fm.searchStatus.state < 1 && ! fm.searchStatus.ininc && fm.autoSync();\n\t\t\t\t\tautoSyncStop = false;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcreate = function(type, targets) {\n\t\t\t\t\tvar sep    = false,\n\t\t\t\t\t\tinsSep = false,\n\t\t\t\t\t\tdisabled = [],\n\t\t\t\t\t\tisCwd = type === 'cwd',\n\t\t\t\t\t\tselcnt = 0,\n\t\t\t\t\t\tcmdMap;\n\n\t\t\t\t\tcurrentType = type;\n\t\t\t\t\tcurrentTargets = targets;\n\t\t\t\t\t\n\t\t\t\t\t// get current uiCmdMap option\n\t\t\t\t\tif (!(cmdMap = fm.option('uiCmdMap', isCwd? void(0) : targets[0]))) {\n\t\t\t\t\t\tcmdMap = {};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!isCwd) {\n\t\t\t\t\t\tdisabled = fm.getDisabledCmds(targets);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tselcnt = fm.selected().length;\n\t\t\t\t\tif (selcnt > 1) {\n\t\t\t\t\t\tmenu.append('<div class=\"ui-corner-top ui-widget-header elfinder-contextmenu-header\"><span>'\n\t\t\t\t\t\t + fm.i18n('selectedItems', ''+selcnt)\n\t\t\t\t\t\t + '</span></div>');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tnodes = $();\n\t\t\t\t\t$.each(types[type]||[], function(i, name) {\n\t\t\t\t\t\tvar cmd, cmdName, useMap, node, submenu, hover;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (name === '|') {\n\t\t\t\t\t\t\tif (sep) {\n\t\t\t\t\t\t\t\tinsSep = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cmdMap[name]) {\n\t\t\t\t\t\t\tcmdName = cmdMap[name];\n\t\t\t\t\t\t\tuseMap = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcmdName = name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcmd = fm.getCommand(cmdName);\n\n\t\t\t\t\t\tif (cmd && !isCwd && (!fm.searchStatus.state || !cmd.disableOnSearch)) {\n\t\t\t\t\t\t\tcmd.__disabled = cmd._disabled;\n\t\t\t\t\t\t\tcmd._disabled = !(cmd.alwaysEnabled || (fm._commands[cmdName] ? $.inArray(name, disabled) === -1 && (!useMap || !disabled[cmdName]) : false));\n\t\t\t\t\t\t\t$.each(cmd.linkedCmds, function(i, n) {\n\t\t\t\t\t\t\t\tvar c;\n\t\t\t\t\t\t\t\tif (c = fm.getCommand(n)) {\n\t\t\t\t\t\t\t\t\tc.__disabled = c._disabled;\n\t\t\t\t\t\t\t\t\tc._disabled = !(c.alwaysEnabled || (fm._commands[n] ? !disabled[n] : false));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cmd && !cmd._disabled && cmd.getstate(targets) != -1) {\n\t\t\t\t\t\t\tif (cmd.variants) {\n\t\t\t\t\t\t\t\tif (!cmd.variants.length) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tnode = item(cmd.title, cmd.className? cmd.className : cmd.name, function(){}, cmd.contextmenuOpts);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tsubmenu = $('<div class=\"ui-front ui-corner-all elfinder-contextmenu-sub\"/>')\n\t\t\t\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t\t\t\t.css('max-height', fm.getUI().height() - 30)\n\t\t\t\t\t\t\t\t\t.appendTo(node.append('<span class=\"elfinder-contextmenu-arrow\"/>'));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\thover = function(show){\n\t\t\t\t\t\t\t\t\tif (! show) {\n\t\t\t\t\t\t\t\t\t\tsubmenu.hide();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tvar bstyle = base.attr('style');\n\t\t\t\t\t\t\t\t\t\tbase.width(base.width());\n\t\t\t\t\t\t\t\t\t\t// top: '-1000px' to prevent visible scrollbar of window with the elFinder option `height: '100%'`\n\t\t\t\t\t\t\t\t\t\tsubmenu.css({ top: '-1000px', left: 'auto', right: 'auto' });\n\t\t\t\t\t\t\t\t\t\tvar nodeOffset = node.offset(),\n\t\t\t\t\t\t\t\t\t\t\tnodeleft   = nodeOffset.left,\n\t\t\t\t\t\t\t\t\t\t\tnodetop    = nodeOffset.top,\n\t\t\t\t\t\t\t\t\t\t\tnodewidth  = node.outerWidth(),\n\t\t\t\t\t\t\t\t\t\t\twidth      = submenu.outerWidth(true),\n\t\t\t\t\t\t\t\t\t\t\theight     = submenu.outerHeight(true),\n\t\t\t\t\t\t\t\t\t\t\tbaseOffset = base.offset(),\n\t\t\t\t\t\t\t\t\t\t\twwidth     = baseOffset.left + base.width(),\n\t\t\t\t\t\t\t\t\t\t\twheight    = baseOffset.top + base.height(),\n\t\t\t\t\t\t\t\t\t\t\tcltr       = ltr, \n\t\t\t\t\t\t\t\t\t\t\tx          = nodewidth,\n\t\t\t\t\t\t\t\t\t\t\ty, over;\n\t\t\n\t\t\t\t\t\t\t\t\t\tif (ltr) {\n\t\t\t\t\t\t\t\t\t\t\tover = (nodeleft + nodewidth + width) - wwidth;\n\t\t\t\t\t\t\t\t\t\t\tif (over > 10) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (nodeleft > width - 5) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tx = x - 5;\n\t\t\t\t\t\t\t\t\t\t\t\t\tcltr = false;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!fm.UA.Mobile) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx = nodewidth - over;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tover = width - nodeleft;\n\t\t\t\t\t\t\t\t\t\t\tif (over > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tif ((nodeleft + nodewidth + width - 15) < wwidth) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tx = x - 5;\n\t\t\t\t\t\t\t\t\t\t\t\t\tcltr = true;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!fm.UA.Mobile) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tx = nodewidth - over;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tover = (nodetop + 5 + height) - wheight;\n\t\t\t\t\t\t\t\t\t\ty = (over > 0 && nodetop < wheight)? 5 - over : (over > 0? 30 - height : 5);\n\t\t\n\t\t\t\t\t\t\t\t\t\tmenu.find('.elfinder-contextmenu-sub:visible').hide();\n\t\t\t\t\t\t\t\t\t\tsubmenu.css({\n\t\t\t\t\t\t\t\t\t\t\ttop : y,\n\t\t\t\t\t\t\t\t\t\t\tleft : cltr? x : 'auto',\n\t\t\t\t\t\t\t\t\t\t\tright: cltr? 'auto' : x,\n\t\t\t\t\t\t\t\t\t\t\toverflowY: 'auto'\n\t\t\t\t\t\t\t\t\t\t}).show();\n\t\t\t\t\t\t\t\t\t\tbase.attr('style', bstyle);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tnode.addClass('elfinder-contextmenu-group')\n\t\t\t\t\t\t\t\t\t.on('mouseleave', '.elfinder-contextmenu-sub', function(e) {\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t\t\tmenu.removeData('submenuKeep');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('submenuclose', '.elfinder-contextmenu-sub', function(e) {\n\t\t\t\t\t\t\t\t\t\thover(false);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('click', '.'+smItem, function(e){\n\t\t\t\t\t\t\t\t\t\tvar opts, $this;\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t\t\t$this = $(this);\n\t\t\t\t\t\t\t\t\t\t\tif (!cmd.keepContextmenu) {\n\t\t\t\t\t\t\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t$this.removeClass(cHover);\n\t\t\t\t\t\t\t\t\t\t\t\tnode.addClass(cHover);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topts = $this.data('exec');\n\t\t\t\t\t\t\t\t\t\t\tif (typeof opts === 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\t\topts = {};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (typeof opts === 'object') {\n\t\t\t\t\t\t\t\t\t\t\t\topts._userAction = true;\n\t\t\t\t\t\t\t\t\t\t\t\topts._currentType = type;\n\t\t\t\t\t\t\t\t\t\t\t\topts._currentNode = $this;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t!cmd.keepContextmenu && close();\n\t\t\t\t\t\t\t\t\t\t\tfm.exec(cmd.name, targets, opts);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('touchend', function(e) {\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('drag')) {\n\t\t\t\t\t\t\t\t\t\t\thover(true);\n\t\t\t\t\t\t\t\t\t\t\tmenu.data('submenuKeep', true);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('mouseenter mouseleave', function(e){\n\t\t\t\t\t\t\t\t\t\tif (! menu.data('touching')) {\n\t\t\t\t\t\t\t\t\t\t\tif (node.data('timer')) {\n\t\t\t\t\t\t\t\t\t\t\t\tclearTimeout(node.data('timer'));\n\t\t\t\t\t\t\t\t\t\t\t\tnode.removeData('timer');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (!$(e.target).closest('.elfinder-contextmenu-sub', menu).length) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.type === 'mouseleave') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (! menu.data('submenuKeep')) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnode.data('timer', setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnode.removeData('timer');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thover(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, 250));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tnode.data('timer', setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnode.removeData('timer');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thover(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, nodes.find('div.elfinder-contextmenu-sub:visible').length? 250 : 0));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$.each(cmd.variants, function(i, variant) {\n\t\t\t\t\t\t\t\t\tvar item = variant === '|' ? '<div class=\"elfinder-contextmenu-separator\"/>' :\n\t\t\t\t\t\t\t\t\t\t$('<div class=\"'+cmItem+' '+smItem+'\"><span>'+variant[1]+'</span></div>').data('exec', variant[0]),\n\t\t\t\t\t\t\t\t\t\ticonClass, icon;\n\t\t\t\t\t\t\t\t\tif (typeof variant[2] !== 'undefined') {\n\t\t\t\t\t\t\t\t\t\ticon = $('<span/>').addClass('elfinder-button-icon elfinder-contextmenu-icon');\n\t\t\t\t\t\t\t\t\t\tif (! /\\//.test(variant[2])) {\n\t\t\t\t\t\t\t\t\t\t\ticon.addClass('elfinder-button-icon-'+variant[2]);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\ticon.css(urlIcon(variant[2]));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\titem.prepend(icon).addClass(smItem+'-icon');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsubmenu.append(item);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnode = item(cmd.title, cmd.className? cmd.className : cmd.name, function() {\n\t\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t\t!cmd.keepContextmenu && close();\n\t\t\t\t\t\t\t\t\t\tfm.exec(cmd.name, targets, {_userAction: true, _currentType: type, _currentNode: node});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, cmd.contextmenuOpts);\n\t\t\t\t\t\t\t\tif (cmd.extra && cmd.extra.node) {\n\t\t\t\t\t\t\t\t\t$('<span class=\"elfinder-button-icon elfinder-button-icon-'+(cmd.extra.icon || '')+' '+exIcon+'\"/>')\n\t\t\t\t\t\t\t\t\t\t.append(cmd.extra.node).appendTo(node);\n\t\t\t\t\t\t\t\t\t$(cmd.extra.node).trigger('ready', {targets: targets});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnode.remove('.'+exIcon);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (cmd.extendsCmd) {\n\t\t\t\t\t\t\t\tnode.children('span.elfinder-button-icon').addClass('elfinder-button-icon-' + cmd.extendsCmd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (insSep) {\n\t\t\t\t\t\t\t\tmenu.append('<div class=\"elfinder-contextmenu-separator\"/>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmenu.append(node);\n\t\t\t\t\t\t\tsep = true;\n\t\t\t\t\t\t\tinsSep = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cmd && typeof cmd.__disabled !== 'undefined') {\n\t\t\t\t\t\t\tcmd._disabled = cmd.__disabled;\n\t\t\t\t\t\t\tdelete cmd.__disabled;\n\t\t\t\t\t\t\t$.each(cmd.linkedCmds, function(i, n) {\n\t\t\t\t\t\t\t\tvar c;\n\t\t\t\t\t\t\t\tif (c = fm.getCommand(n)) {\n\t\t\t\t\t\t\t\t\tc._disabled = c.__disabled;\n\t\t\t\t\t\t\t\t\tdelete c.__disabled;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tnodes = menu.children('div.'+cmItem);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcreateFromRaw = function(raw) {\n\t\t\t\t\tcurrentType = 'raw';\n\t\t\t\t\t$.each(raw, function(i, data) {\n\t\t\t\t\t\tvar node;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (data === '|') {\n\t\t\t\t\t\t\tmenu.append('<div class=\"elfinder-contextmenu-separator\"/>');\n\t\t\t\t\t\t} else if (data.label && typeof data.callback == 'function') {\n\t\t\t\t\t\t\tnode = item(data.label, data.icon, function() {\n\t\t\t\t\t\t\t\tif (! menu.data('draged')) {\n\t\t\t\t\t\t\t\t\t!data.remain && close();\n\t\t\t\t\t\t\t\t\tdata.callback();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, data.options || null);\n\t\t\t\t\t\t\tmenu.append(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tnodes = menu.children('div.'+cmItem);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcurrentType = null,\n\t\t\t\tcurrentTargets = null;\n\t\t\t\n\t\t\tfm.one('load', function() {\n\t\t\t\tbase = fm.getUI();\n\t\t\t\tcwd = fm.getUI('cwd');\n\t\t\t\tfm.bind('contextmenu', function(e) {\n\t\t\t\t\tvar data = e.data,\n\t\t\t\t\t\tcss = {},\n\t\t\t\t\t\tprevNode;\n\n\t\t\t\t\tif (data.type && data.type !== 'files') {\n\t\t\t\t\t\tcwd.trigger('unselectall');\n\t\t\t\t\t}\n\t\t\t\t\tclose();\n\n\t\t\t\t\tif (data.type && data.targets) {\n\t\t\t\t\t\tfm.trigger('contextmenucreate', data);\n\t\t\t\t\t\tcreate(data.type, data.targets);\n\t\t\t\t\t\tfm.trigger('contextmenucreatedone', data);\n\t\t\t\t\t} else if (data.raw) {\n\t\t\t\t\t\tcreateFromRaw(data.raw);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (menu.children().length) {\n\t\t\t\t\t\tprevNode = data.prevNode || null;\n\t\t\t\t\t\tif (prevNode) {\n\t\t\t\t\t\t\tmenu.data('prevNode', menu.prev());\n\t\t\t\t\t\t\tprevNode.after(menu);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.fitHeight) {\n\t\t\t\t\t\t\tcss = {maxHeight: Math.min(fm.getUI().height(), $(window).height()), overflowY: 'auto'};\n\t\t\t\t\t\t\tmenu.draggable('destroy').removeClass('ui-draggable');\n\t\t\t\t\t\t}\n\t\t\t\t\t\topen(data.x, data.y, css);\n\t\t\t\t\t\t// call opened callback function\n\t\t\t\t\t\tif (data.opened && typeof data.opened === 'function') {\n\t\t\t\t\t\t\tdata.opened.call(menu);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.one('destroy', function() { menu.remove(); })\n\t\t\t\t.bind('disable', close)\n\t\t\t\t.bind('select', function(e){\n\t\t\t\t\t(currentType === 'files' && (!e.data || e.data.selected.toString() !== currentTargets.toString())) && close();\n\t\t\t\t});\n\t\t\t})\n\t\t\t.shortcut({\n\t\t\t\tpattern     : fm.OS === 'mac' ? 'ctrl+m' : 'contextmenu shift+f10',\n\t\t\t\tdescription : 'contextmenu',\n\t\t\t\tcallback    : function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$(document).one('contextmenu.' + fm.namespace, function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\t\ttype, targets, pos, elm;\n\t\t\t\t\t\n\t\t\t\t\tif (sel.length) {\n\t\t\t\t\t\ttype = 'files';\n\t\t\t\t\t\ttargets = sel;\n\t\t\t\t\t\telm = fm.cwdHash2Elm(sel[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype = 'cwd';\n\t\t\t\t\t\ttargets = [ fm.cwd().hash ];\n\t\t\t\t\t\tpos = fm.getUI('workzone').offset();\n\t\t\t\t\t}\n\t\t\t\t\tif (! elm || ! elm.length) {\n\t\t\t\t\t\telm = fm.getUI('workzone');\n\t\t\t\t\t}\n\t\t\t\t\tpos = elm.offset();\n\t\t\t\t\tpos.top += (elm.height() / 2);\n\t\t\t\t\tpos.left += (elm.width() / 2);\n\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t'type'    : type,\n\t\t\t\t\t\t'targets' : targets,\n\t\t\t\t\t\t'x'       : pos.left,\n\t\t\t\t\t\t'y'       : pos.top\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t});\n\t\t\n\t};\n\n});\ndefine('skylark-elfinder/ui/cwd',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * elFinder current working directory ui.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindercwd = function(fm, options) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-cwd').each(function() {\n\t\t\t// fm.time('cwdLoad');\n\t\t\t\n\t\t\tvar mobile = fm.UA.Mobile,\n\t\t\t\tlist = fm.viewType == 'list',\n\n\t\t\t\tundef = 'undefined',\n\t\t\t\t/**\n\t\t\t\t * Select event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtSelect = 'select.'+fm.namespace,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Unselect event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtUnselect = 'unselect.'+fm.namespace,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disable event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtDisable = 'disable.'+fm.namespace,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disable event full name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tevtEnable = 'enable.'+fm.namespace,\n\t\t\t\t\n\t\t\t\tc = 'class',\n\t\t\t\t/**\n\t\t\t\t * File css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclFile       = fm.res(c, 'cwdfile'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Selected css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tfileSelector = '.'+clFile,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Selected css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclSelected = 'ui-selected',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disabled css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDisabled = fm.res(c, 'disabled'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Draggable css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDraggable = fm.res(c, 'draggable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDroppable = fm.res(c, 'droppable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Hover css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclHover     = fm.res(c, 'hover'),\n\n\t\t\t\t/**\n\t\t\t\t * Active css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclActive     = fm.res(c, 'active'),\n\n\t\t\t\t/**\n\t\t\t\t * Hover css class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclDropActive = fm.res(c, 'adroppable'),\n\n\t\t\t\t/**\n\t\t\t\t * Css class for temporary nodes (for mkdir/mkfile) commands\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tclTmp = clFile+'-tmp',\n\n\t\t\t\t/**\n\t\t\t\t * Select checkbox css class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tclSelChk = 'elfinder-cwd-selectchk',\n\n\t\t\t\t/**\n\t\t\t\t * Number of thumbnails to load in one request (new api only)\n\t\t\t\t *\n\t\t\t\t * @type Number\n\t\t\t\t **/\n\t\t\t\ttmbNum = fm.options.loadTmbs > 0 ? fm.options.loadTmbs : 5,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Current search query.\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tquery = '',\n\n\t\t\t\t/**\n\t\t\t\t * Currect clipboard(cut) hashes as object key\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tclipCuts = {},\n\n\t\t\t\t/**\n\t\t\t\t * Parents hashes of cwd\n\t\t\t\t *\n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tcwdParents = [],\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * cwd current hashes\n\t\t\t\t * \n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tcwdHashes = [],\n\n\t\t\t\t/**\n\t\t\t\t * incsearch current hashes\n\t\t\t\t * \n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tincHashes = void 0,\n\n\t\t\t\t/**\n\t\t\t\t * Custom columns name and order\n\t\t\t\t *\n\t\t\t\t * @type Array\n\t\t\t\t */\n\t\t\t\tcustomCols = [],\n\n\t\t\t\t/**\n\t\t\t\t * Current clicked element id of first time for dblclick\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tcurClickId = '',\n\n\t\t\t\t/**\n\t\t\t\t * Custom columns builder\n\t\t\t\t *\n\t\t\t\t * @type Function\n\t\t\t\t */\n\t\t\t\tcustomColsBuild = function() {\n\t\t\t\t\tvar cols = '';\n\t\t\t\t\tfor (var i = 0; i < customCols.length; i++) {\n\t\t\t\t\t\tcols += '<td class=\"elfinder-col-'+customCols[i]+'\">{' + customCols[i] + '}</td>';\n\t\t\t\t\t}\n\t\t\t\t\treturn cols;\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * Make template.row from customCols\n\t\t\t\t *\n\t\t\t\t * @type Function\n\t\t\t\t */\n\t\t\t\tmakeTemplateRow = function() {\n\t\t\t\t\treturn '<tr id=\"{id}\" class=\"'+clFile+' {permsclass} {dirclass}\" title=\"{tooltip}\"{css}><td class=\"elfinder-col-name\"><div class=\"elfinder-cwd-file-wrapper\"><span class=\"elfinder-cwd-icon {mime}\"{style}/>{marker}<span class=\"elfinder-cwd-filename\">{name}</span></div>'+selectCheckbox+'</td>'+customColsBuild()+'</tr>';\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tselectCheckbox = ($.map(options.showSelectCheckboxUA, function(t) {return (fm.UA[t] || t.match(/^all$/i))? true : null;}).length)? '<div class=\"elfinder-cwd-select\"><input type=\"checkbox\" class=\"'+clSelChk+'\"></div>' : '',\n\n\t\t\t\tcolResizing = false,\n\t\t\t\t\n\t\t\t\tcolWidth = null,\n\n\t\t\t\t/**\n\t\t\t\t * Table header height\n\t\t\t\t */\n\t\t\t\tthHeight,\n\n\t\t\t\t/**\n\t\t\t\t * File templates\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\ttemplates = {\n\t\t\t\t\ticon : '<div id=\"{id}\" class=\"'+clFile+' {permsclass} {dirclass} ui-corner-all\" title=\"{tooltip}\"><div class=\"elfinder-cwd-file-wrapper ui-corner-all\"><div class=\"elfinder-cwd-icon {mime} ui-corner-all\" unselectable=\"on\"{style}/>{marker}</div><div class=\"elfinder-cwd-filename\" title=\"{nametitle}\">{name}</div>'+selectCheckbox+'</div>',\n\t\t\t\t\trow  : ''\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tpermsTpl = fm.res('tpl', 'perms'),\n\t\t\t\t\n\t\t\t\tlockTpl = fm.res('tpl', 'lock'),\n\t\t\t\t\n\t\t\t\tsymlinkTpl = fm.res('tpl', 'symlink'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Template placeholders replacement rules\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\treplacement = {\n\t\t\t\t\tid : function(f) {\n\t\t\t\t\t\treturn fm.cwdHash2Id(f.hash);\n\t\t\t\t\t},\n\t\t\t\t\tname : function(f) {\n\t\t\t\t\t\tvar name = fm.escape(f.i18 || f.name);\n\t\t\t\t\t\t!list && (name = name.replace(/([_.])/g, '&#8203;$1'));\n\t\t\t\t\t\treturn name;\n\t\t\t\t\t},\n\t\t\t\t\tnametitle : function(f) {\n\t\t\t\t\t\treturn fm.escape(f.i18 || f.name);\n\t\t\t\t\t},\n\t\t\t\t\tpermsclass : function(f) {\n\t\t\t\t\t\treturn fm.perms2class(f);\n\t\t\t\t\t},\n\t\t\t\t\tperm : function(f) {\n\t\t\t\t\t\treturn fm.formatPermissions(f);\n\t\t\t\t\t},\n\t\t\t\t\tdirclass : function(f) {\n\t\t\t\t\t\tvar cName = f.mime == 'directory' ? 'directory' : '';\n\t\t\t\t\t\tf.isroot && (cName += ' isroot');\n\t\t\t\t\t\tf.csscls && (cName += ' ' + fm.escape(f.csscls));\n\t\t\t\t\t\toptions.getClass && (cName += ' ' + options.getClass(f));\n\t\t\t\t\t\treturn cName;\n\t\t\t\t\t},\n\t\t\t\t\tstyle : function(f) {\n\t\t\t\t\t\treturn f.icon? fm.getIconStyle(f) : '';\n\t\t\t\t\t},\n\t\t\t\t\tmime : function(f) {\n\t\t\t\t\t\tvar cName = fm.mime2class(f.mime);\n\t\t\t\t\t\tf.icon && (cName += ' elfinder-cwd-bgurl');\n\t\t\t\t\t\treturn cName;\n\t\t\t\t\t},\n\t\t\t\t\tsize : function(f) {\n\t\t\t\t\t\treturn (f.mime === 'directory' && !f.size)? '-' : fm.formatSize(f.size);\n\t\t\t\t\t},\n\t\t\t\t\tdate : function(f) {\n\t\t\t\t\t\treturn fm.formatDate(f);\n\t\t\t\t\t},\n\t\t\t\t\tkind : function(f) {\n\t\t\t\t\t\treturn fm.mime2kind(f);\n\t\t\t\t\t},\n\t\t\t\t\tmode : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm) : '';\n\t\t\t\t\t},\n\t\t\t\t\tmodestr : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm, 'string') : '';\n\t\t\t\t\t},\n\t\t\t\t\tmodeoct : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm, 'octal') : '';\n\t\t\t\t\t},\n\t\t\t\t\tmodeboth : function(f) {\n\t\t\t\t\t\treturn f.perm? fm.formatFileMode(f.perm, 'both') : '';\n\t\t\t\t\t},\n\t\t\t\t\tmarker : function(f) {\n\t\t\t\t\t\treturn (f.alias || f.mime == 'symlink-broken' ? symlinkTpl : '')+(!f.read || !f.write ? permsTpl : '')+(f.locked ? lockTpl : '');\n\t\t\t\t\t},\n\t\t\t\t\ttooltip : function(f) {\n\t\t\t\t\t\tvar title = fm.formatDate(f) + (f.size > 0 ? ' ('+fm.formatSize(f.size)+')' : ''),\n\t\t\t\t\t\t\tinfo  = '';\n\t\t\t\t\t\tif (query && f.path) {\n\t\t\t\t\t\t\tinfo = fm.escape(f.path.replace(/\\/[^\\/]*$/, ''));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinfo = f.tooltip? fm.escape(f.tooltip).replace(/\\r/g, '&#13;') : '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tinfo += (info? '&#13;' : '') + fm.escape(f.i18 || f.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn info? info + '&#13;' + title : title;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Type badge CSS added flag\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\taddedBadges = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Type badge style sheet element\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\taddBadgeStyleSheet,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Add type badge CSS into 'head'\n\t\t\t\t * \n\t\t\t\t * @type Fundtion\n\t\t\t\t */\n\t\t\t\taddBadgeStyle = function(mime, name) {\n\t\t\t\t\tvar sel, ext, type;\n\t\t\t\t\tif (mime && ! addedBadges[mime]) {\n\t\t\t\t\t\tif (typeof addBadgeStyleSheet === 'undefined') {\n\t\t\t\t\t\t\tif ($('#elfinderAddBadgeStyle'+fm.namespace).length) {\n\t\t\t\t\t\t\t\t$('#elfinderAddBadgeStyle'+fm.namespace).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taddBadgeStyleSheet = $('<style id=\"addBadgeStyle'+fm.namespace+'\"/>').insertBefore($('head').children(':first')).get(0).sheet || null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (addBadgeStyleSheet) {\n\t\t\t\t\t\t\tmime = mime.toLowerCase();\n\t\t\t\t\t\t\ttype = mime.split('/');\n\t\t\t\t\t\t\text = fm.escape(fm.mimeTypes[mime] || (name.replace(/.bac?k$/i, '').match(/\\.([^.]+)$/) || ['',''])[1]);\n\t\t\t\t\t\t\tif (ext) {\n\t\t\t\t\t\t\t\tsel = '.elfinder-cwd-icon-' + type[0].replace(/(\\.|\\+)/g, '-');\n\t\t\t\t\t\t\t\tif (typeof type[1] !== 'undefined') {\n\t\t\t\t\t\t\t\t\tsel += '.elfinder-cwd-icon-' + type[1].replace(/(\\.|\\+)/g, '-');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\taddBadgeStyleSheet.insertRule(sel + ':before{content:\"' + ext.toLowerCase() + '\"}', 0);\n\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taddedBadges[mime] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return file html\n\t\t\t\t *\n\t\t\t\t * @param  Object  file info\n\t\t\t\t * @return String\n\t\t\t\t **/\n\t\t\t\titemhtml = function(f) {\n\t\t\t\t\tf.mime && f.mime !== 'directory' && !addedBadges[f.mime] && addBadgeStyle(f.mime, f.name);\n\t\t\t\t\treturn templates[list ? 'row' : 'icon']\n\t\t\t\t\t\t\t.replace(/\\{([a-z0-9_]+)\\}/g, function(s, e) { \n\t\t\t\t\t\t\t\treturn replacement[e] ? replacement[e](f, fm) : (f[e] ? f[e] : ''); \n\t\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * jQueery node that will be selected next\n\t\t\t\t * \n\t\t\t\t * @type Object jQuery node\n\t\t\t\t */\n\t\t\t\tselectedNext = $(),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Flag. Required for msie to avoid unselect files on dragstart\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t **/\n\t\t\t\tselectLock = false,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Move selection to prev/next file\n\t\t\t\t *\n\t\t\t\t * @param String  move direction\n\t\t\t\t * @param Boolean append to current selection\n\t\t\t\t * @return void\n\t\t\t\t * @rise select\t\t\t\n\t\t\t\t */\n\t\t\t\tselect = function(keyCode, append) {\n\t\t\t\t\tvar code     = $.ui.keyCode,\n\t\t\t\t\t\tprev     = keyCode == code.LEFT || keyCode == code.UP,\n\t\t\t\t\t\tsel      = cwd.find('[id].'+clSelected),\n\t\t\t\t\t\tselector = prev ? 'first:' : 'last',\n\t\t\t\t\t\ts, n, sib, top, left;\n\n\t\t\t\t\tfunction sibling(n, direction) {\n\t\t\t\t\t\treturn n[direction+'All']('[id]:not(.'+clDisabled+'):not(.elfinder-cwd-parent):first');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (sel.length) {\n\t\t\t\t\t\ts = sel.filter(prev ? ':first' : ':last');\n\t\t\t\t\t\tsib = sibling(s, prev ? 'prev' : 'next');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!sib.length) {\n\t\t\t\t\t\t\t// there is no sibling on required side - do not move selection\n\t\t\t\t\t\t\tn = s;\n\t\t\t\t\t\t} else if (list || keyCode == code.LEFT || keyCode == code.RIGHT) {\n\t\t\t\t\t\t\t// find real prevoius file\n\t\t\t\t\t\t\tn = sib;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// find up/down side file in icons view\n\t\t\t\t\t\t\ttop = s.position().top;\n\t\t\t\t\t\t\tleft = s.position().left;\n\n\t\t\t\t\t\t\tn = s;\n\t\t\t\t\t\t\tif (prev) {\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\tn = n.prev('[id]');\n\t\t\t\t\t\t\t\t} while (n.length && !(n.position().top < top && n.position().left <= left));\n\n\t\t\t\t\t\t\t\tif (n.hasClass(clDisabled)) {\n\t\t\t\t\t\t\t\t\tn = sibling(n, 'next');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\t\t\tn = n.next('[id]');\n\t\t\t\t\t\t\t\t} while (n.length && !(n.position().top > top && n.position().left >= left));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (n.hasClass(clDisabled)) {\n\t\t\t\t\t\t\t\t\tn = sibling(n, 'prev');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// there is row before last one - select last file\n\t\t\t\t\t\t\t\tif (!n.length) {\n\t\t\t\t\t\t\t\t\tsib = cwd.find('[id]:not(.'+clDisabled+'):last');\n\t\t\t\t\t\t\t\t\tif (sib.position().top > top) {\n\t\t\t\t\t\t\t\t\t\tn = sib;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// !append && unselectAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (selectedNext.length) {\n\t\t\t\t\t\t\tn = prev? selectedNext.prev() : selectedNext;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// there are no selected file - select first/last one\n\t\t\t\t\t\t\tn = cwd.find('[id]:not(.'+clDisabled+'):not(.elfinder-cwd-parent):'+(prev ? 'last' : 'first'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (n && n.length && !n.hasClass('elfinder-cwd-parent')) {\n\t\t\t\t\t\tif (s && append) {\n\t\t\t\t\t\t\t// append new files to selected\n\t\t\t\t\t\t\tn = s.add(s[prev ? 'prevUntil' : 'nextUntil']('#'+n.attr('id'))).add(n);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// unselect selected files\n\t\t\t\t\t\t\tsel.trigger(evtUnselect);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// select file(s)\n\t\t\t\t\t\tn.trigger(evtSelect);\n\t\t\t\t\t\t// set its visible\n\t\t\t\t\t\tscrollToView(n.filter(prev ? ':first' : ':last'));\n\t\t\t\t\t\t// update cache/view\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tselectedFiles = {},\n\t\t\t\t\n\t\t\t\tselectFile = function(hash) {\n\t\t\t\t\tfm.cwdHash2Elm(hash).trigger(evtSelect);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tallSelected = false,\n\t\t\t\t\n\t\t\t\tselectAll = function() {\n\t\t\t\t\tvar phash = fm.cwd().hash;\n\n\t\t\t\t\tselectCheckbox && selectAllCheckbox.find('input').prop('checked', true);\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tvar files;\n\t\t\t\t\t\tif (fm.maxTargets && (incHashes || cwdHashes).length > fm.maxTargets) {\n\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\tfiles = $.map(incHashes || cwdHashes, function(hash) { return fm.file(hash) || null; });\n\t\t\t\t\t\t\tfiles = files.slice(0, fm.maxTargets);\n\t\t\t\t\t\t\tselectedFiles = {};\n\t\t\t\t\t\t\t$.each(files, function(i, v) {\n\t\t\t\t\t\t\t\tselectedFiles[v.hash] = true;\n\t\t\t\t\t\t\t\tfm.cwdHash2Elm(v.hash).trigger(evtSelect);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.toast({mode: 'warning', msg: fm.i18n(['errMaxTargets', fm.maxTargets])});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcwd.find('[id]:not(.'+clSelected+'):not(.elfinder-cwd-parent)').trigger(evtSelect);\n\t\t\t\t\t\t\tselectedFiles = fm.arrayFlip(incHashes || cwdHashes, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.data('pending', false);\n\t\t\t\t\t}, 0, {repaint: true});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Unselect all files\n\t\t\t\t *\n\t\t\t\t * @param  Object  options\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tunselectAll = function(opts) {\n\t\t\t\t\tvar o = opts || {};\n\t\t\t\t\tselectCheckbox && selectAllCheckbox.find('input').prop('checked', false);\n\t\t\t\t\tif (Object.keys(selectedFiles).length) {\n\t\t\t\t\t\tselectLock = false;\n\t\t\t\t\t\tselectedFiles = {};\n\t\t\t\t\t\tcwd.find('[id].'+clSelected).trigger(evtUnselect);\n\t\t\t\t\t\tselectCheckbox && cwd.find('input:checkbox.'+clSelChk).prop('checked', false);\n\t\t\t\t\t}\n\t\t\t\t\t!o.notrigger && trigger();\n\t\t\t\t\tselectCheckbox && selectAllCheckbox.data('pending', false);\n\t\t\t\t\tcwd.removeClass('elfinder-cwd-allselected');\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tselectInvert = function() {\n\t\t\t\t\tvar invHashes = {};\n\t\t\t\t\tif (allSelected) {\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t} else if (! Object.keys(selectedFiles).length) {\n\t\t\t\t\t\tselectAll();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.each((incHashes || cwdHashes), function(i, h) {\n\t\t\t\t\t\t\tvar itemNode = fm.cwdHash2Elm(h);\n\t\t\t\t\t\t\tif (! selectedFiles[h]) {\n\t\t\t\t\t\t\t\tinvHashes[h] = true;\n\t\t\t\t\t\t\t\titemNode.length && itemNode.trigger(evtSelect);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\titemNode.length && itemNode.trigger(evtUnselect);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tselectedFiles = invHashes;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return selected files hashes list\n\t\t\t\t *\n\t\t\t\t * @return Array\n\t\t\t\t */\n\t\t\t\tselected = function() {\n\t\t\t\t\treturn Object.keys(selectedFiles);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Last selected node id\n\t\t\t\t * \n\t\t\t\t * @type String|Void\n\t\t\t\t */\n\t\t\t\tlastSelect = void 0,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Fire elfinder \"select\" event and pass selected files to it\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\ttrigger = function() {\n\t\t\t\t\tvar selected = Object.keys(selectedFiles),\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\tselected : selected,\n\t\t\t\t\t\t\torigin : 'cwd'\n\t\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tif (oldSchoolItem && (selected.length > 1 || selected[0] !== fm.cwdId2Hash(\n\t\t\t\t\t\toldSchoolItem.attr('id'))) && oldSchoolItem.hasClass(clSelected)) {\n\t\t\t\t\t\toldSchoolItem.trigger(evtUnselect);\n\t\t\t\t\t}\n\t\t\t\t\tallSelected = selected.length && (selected.length === (incHashes || cwdHashes).length) && (!fm.maxTargets || selected.length <= fm.maxTargets);\n\t\t\t\t\tif (selectCheckbox) {\n\t\t\t\t\t\tselectAllCheckbox.find('input').prop('checked', allSelected);\n\t\t\t\t\t\tcwd[allSelected? 'addClass' : 'removeClass']('elfinder-cwd-allselected');\n\t\t\t\t\t}\n\t\t\t\t\tif (allSelected) {\n\t\t\t\t\t\topts.selectall = true;\n\t\t\t\t\t} else if (! selected.length) {\n\t\t\t\t\t\topts.unselectall = true;\n\t\t\t\t\t}\n\t\t\t\t\tfm.trigger('select', opts);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Scroll file to set it visible\n\t\t\t\t *\n\t\t\t\t * @param DOMElement  file/dir node\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tscrollToView = function(o, blink) {\n\t\t\t\t\tif (! o.length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar ftop    = o.position().top,\n\t\t\t\t\t\tfheight = o.outerHeight(true),\n\t\t\t\t\t\twtop    = wrapper.scrollTop(),\n\t\t\t\t\t\twheight = wrapper.get(0).clientHeight,\n\t\t\t\t\t\tthheight = tableHeader? tableHeader.outerHeight(true) : 0;\n\n\t\t\t\t\tif (ftop + thheight + fheight > wtop + wheight) {\n\t\t\t\t\t\twrapper.scrollTop(parseInt(ftop + thheight + fheight - wheight));\n\t\t\t\t\t} else if (ftop < wtop) {\n\t\t\t\t\t\twrapper.scrollTop(ftop);\n\t\t\t\t\t}\n\t\t\t\t\tlist && wrapper.scrollLeft(0);\n\t\t\t\t\t!!blink && fm.resources.blink(o, 'lookme');\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Files we get from server but not show yet\n\t\t\t\t *\n\t\t\t\t * @type Array\n\t\t\t\t **/\n\t\t\t\tbuffer = [],\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Extra data of buffer\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t **/\n\t\t\t\tbufferExt = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return index of elements with required hash in buffer \n\t\t\t\t *\n\t\t\t\t * @param String  file hash\n\t\t\t\t * @return Number\n\t\t\t\t */\n\t\t\t\tindex = function(hash) {\n\t\t\t\t\tvar l = buffer.length;\n\t\t\t\t\t\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\tif (buffer[l].hash == hash) {\n\t\t\t\t\t\t\treturn l;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn -1;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Scroll start event name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tscrollStartEvent = 'elfscrstart',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Scroll stop event name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t **/\n\t\t\t\tscrollEvent = 'elfscrstop',\n\t\t\t\t\n\t\t\t\tscrolling = false,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * jQuery UI selectable option\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tselectableOption = {\n\t\t\t\t\tdisabled   : true,\n\t\t\t\t\tfilter     : '[id]:first',\n\t\t\t\t\tstop       : trigger,\n\t\t\t\t\tdelay      : 250,\n\t\t\t\t\tappendTo   : 'body',\n\t\t\t\t\tautoRefresh: false,\n\t\t\t\t\tselected   : function(e, ui) { $(ui.selected).trigger(evtSelect); },\n\t\t\t\t\tunselected : function(e, ui) { $(ui.unselected).trigger(evtUnselect); }\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * hashes of items displayed in current view\n\t\t\t\t * \n\t\t\t\t * @type Object  ItemHash => DomId\n\t\t\t\t */\n\t\t\t\tinViewHashes = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Processing when the current view is changed (On open, search, scroll, resize etc.)\n\t\t\t\t * \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\twrapperRepaint = function(init, recnt) {\n\t\t\t\t\tif (!bufferExt.renderd) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar firstNode = (list? cwd.find('tbody:first') : cwd).children('[id]'+(options.oldSchool? ':not(.elfinder-cwd-parent)' : '')+':first');\n\t\t\t\t\tif (!firstNode.length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar selectable = cwd.data('selectable'),\n\t\t\t\t\t\trec = (function() {\n\t\t\t\t\t\t\tvar wos = wrapper.offset(),\n\t\t\t\t\t\t\t\tww = wrapper.width(),\n\t\t\t\t\t\t\t\tw = $(window),\n\t\t\t\t\t\t\t\tx = firstNode.width() / 2,\n\t\t\t\t\t\t\t\tl = Math.min(wos.left - w.scrollLeft() + (fm.direction === 'ltr'? x : ww - x), wos.left + ww - 10),\n\t\t\t\t\t\t\t\tt = wos.top - w.scrollTop() + 10 + (list? thHeight : 0);\n\t\t\t\t\t\t\treturn {left: Math.max(0, Math.round(l)), top: Math.max(0, Math.round(t))};\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\ttgt = init? firstNode : $(document.elementFromPoint(rec.left , rec.top)),\n\t\t\t\t\t\tids = {},\n\t\t\t\t\t\ttmbs = {},\n\t\t\t\t\t\tmulti = 5,\n\t\t\t\t\t\tcnt = Math.ceil((bufferExt.hpi? Math.ceil((wz.data('rectangle').height / bufferExt.hpi) * 1.5) : showFiles) / multi),\n\t\t\t\t\t\tchk = function() {\n\t\t\t\t\t\t\tvar id, hash, file, i;\n\t\t\t\t\t\t\tfor (i = 0; i < multi; i++) {\n\t\t\t\t\t\t\t\tid = tgt.attr('id');\n\t\t\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\t\t\tbufferExt.getTmbs = [];\n\t\t\t\t\t\t\t\t\thash = fm.cwdId2Hash(id);\n\t\t\t\t\t\t\t\t\tinViewHashes[hash] = id;\n\t\t\t\t\t\t\t\t\t// for tmbs\n\t\t\t\t\t\t\t\t\tif (bufferExt.attachTmbs[hash]) {\n\t\t\t\t\t\t\t\t\t\ttmbs[hash] = bufferExt.attachTmbs[hash];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// for selectable\n\t\t\t\t\t\t\t\t\tselectable && (ids[id] = true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// next node\n\t\t\t\t\t\t\t\ttgt = tgt.next();\n\t\t\t\t\t\t\t\tif (!tgt.length) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdone = function() {\n\t\t\t\t\t\t\tvar idsArr;\n\t\t\t\t\t\t\tif (cwd.data('selectable')) {\n\t\t\t\t\t\t\t\tObject.assign(ids, selectedFiles);\n\t\t\t\t\t\t\t\tidsArr = Object.keys(ids);\n\t\t\t\t\t\t\t\tif (idsArr.length) {\n\t\t\t\t\t\t\t\t\tselectableOption.filter = '#'+idsArr.join(', #');\n\t\t\t\t\t\t\t\t\tcwd.selectable('enable').selectable('option', {filter : selectableOption.filter}).selectable('refresh');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (Object.keys(tmbs).length) {\n\t\t\t\t\t\t\t\tbufferExt.getTmbs = [];\n\t\t\t\t\t\t\t\tattachThumbnails(tmbs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetTarget = function() {\n\t\t\t\t\t\t\tif (!tgt.hasClass(clFile)) {\n\t\t\t\t\t\t\t\ttgt = tgt.closest(fileSelector);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tarr, widget;\n\t\t\t\t\t\n\t\t\t\t\tinViewHashes = {};\n\t\t\t\t\tselectable && cwd.selectable('option', 'disabled');\n\t\t\t\t\t\n\t\t\t\t\tif (tgt.length) {\n\t\t\t\t\t\tif (!tgt.hasClass(clFile) && !tgt.closest(fileSelector).length) {\n\t\t\t\t\t\t\t// dialog, serach button etc.\n\t\t\t\t\t\t\twidget = fm.getUI().find('.ui-dialog:visible,.ui-widget:visible');\n\t\t\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\t\t\twidget.hide();\n\t\t\t\t\t\t\t\ttgt = $(document.elementFromPoint(rec.left , rec.top));\n\t\t\t\t\t\t\t\twidget.show();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twidget = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTarget();\n\t\t\t\t\t\tif (!tgt.length) {\n\t\t\t\t\t\t\t// try search 5px down\n\t\t\t\t\t\t\twidget && widget.hide();\n\t\t\t\t\t\t\ttgt = $(document.elementFromPoint(rec.left , rec.top + 5));\n\t\t\t\t\t\t\twidget && widget.show();\n\t\t\t\t\t\t\tsetTarget();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tgt.length) {\n\t\t\t\t\t\tif (tgt.attr('id')) {\n\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\tfor (var i = 0; i < cnt; i++) {\n\t\t\t\t\t\t\t\t\tchk();\n\t\t\t\t\t\t\t\t\tif (! tgt.length) {\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//bufferExt.repaintJob && bufferExt.repaintJob.state() === 'pending' && bufferExt.repaintJob.reject(); // modified by lwf\n\t\t\t\t\t\t\t\tarr = new Array(cnt);\n\t\t\t\t\t\t\t\tbufferExt.repaintJob = fm.asyncJob(function() {\n\t\t\t\t\t\t\t\t\tchk();\n\t\t\t\t\t\t\t\t\tif (! tgt.length) {\n\t\t\t\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t\t\t\t\t//bufferExt.repaintJob && bufferExt.repaintJob.state() === 'pending' && bufferExt.repaintJob.reject();// modified by lwf\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, arr).done(done);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (init && bufferExt.renderd) {\n\t\t\t\t\t\t// In initial request, cwd DOM not renderd so doing lazy check\n\t\t\t\t\t\trecnt = recnt || 0;\n\t\t\t\t\t\tif (recnt < 10) { // Prevent infinite loop\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\twrapperRepaint(init, ++recnt);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Item node of oldScholl \"..\"\n\t\t\t\t */\n\t\t\t\toldSchoolItem = null,\n\n\t\t\t\t/**\n\t\t\t\t * display parent folder with \"..\" name\n\t\t\t\t * \n\t\t\t\t * @param  String  phash\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\toldSchool = function(p) {\n\t\t\t\t\tvar phash = fm.cwd().phash,\n\t\t\t\t\t\tpdir  = fm.file(phash) || null,\n\t\t\t\t\t\tset   = function(pdir) {\n\t\t\t\t\t\t\tif (pdir) {\n\t\t\t\t\t\t\t\toldSchoolItem = $(itemhtml($.extend(true, {}, pdir, {name : '..', i18 : '..', mime : 'directory'})))\n\t\t\t\t\t\t\t\t\t.addClass('elfinder-cwd-parent')\n\t\t\t\t\t\t\t\t\t.on('dblclick', function() {\n\t\t\t\t\t\t\t\t\t\tfm.trigger('select', {selected : [phash]}).exec('open', phash);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t(list ? oldSchoolItem.children('td:first') : oldSchoolItem).children('.elfinder-cwd-select').remove();\n\t\t\t\t\t\t\t\tif (fm.cwdHash2Elm(phash).length) {\n\t\t\t\t\t\t\t\t\tfm.cwdHash2Elm(phash).replaceWith(oldSchoolItem);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(list ? cwd.find('tbody') : cwd).prepend(oldSchoolItem);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\tif (pdir) {\n\t\t\t\t\t\tset(pdir);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tset({hash: phash, read: true, write: true});\n\t\t\t\t\t\tif (fm.getUI('tree').length) {\n\t\t\t\t\t\t\tfm.one('parents', function() {\n\t\t\t\t\t\t\t\tset(fm.file(phash) || null);\n\t\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'parents', target : fm.cwd().hash},\n\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tset(fm.file(phash) || null);\n\t\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tshowFiles = fm.options.showFiles,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Cwd scroll event handler.\n\t\t\t\t * Lazy load - append to cwd not shown files\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\trender = function() {\n\t\t\t\t\tif (bufferExt.rendering || (bufferExt.renderd && ! buffer.length)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar place = (list ? cwd.children('table').children('tbody') : cwd),\n\t\t\t\t\t\tphash,\n\t\t\t\t\t\tchk,\n\t\t\t\t\t\t// created document fragment for jQuery >= 1.12, 2.2, 3.0\n\t\t\t\t\t\t// see Studio-42/elFinder#1544 @ github\n\t\t\t\t\t\tdocFlag = $.htmlPrefilter? true : false,\n\t\t\t\t\t\ttempDom = docFlag? $(document.createDocumentFragment()) : $('<div/>'),\n\t\t\t\t\t\tgo      = function(o){\n\t\t\t\t\t\t\tvar over  = o || null,\n\t\t\t\t\t\t\t\thtml  = [],\n\t\t\t\t\t\t\t\tdirs  = false,\n\t\t\t\t\t\t\t\tatmb  = {},\n\t\t\t\t\t\t\t\tstmb  = (fm.option('tmbUrl') === 'self'),\n\t\t\t\t\t\t\t\tinit  = bufferExt.renderd? false : true,\n\t\t\t\t\t\t\t\tfiles, locks, selected;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfiles = buffer.splice(0, showFiles + (over || 0) / (bufferExt.hpi || 1));\n\t\t\t\t\t\t\tbufferExt.renderd += files.length;\n\t\t\t\t\t\t\tif (! buffer.length) {\n\t\t\t\t\t\t\t\tbottomMarker.hide();\n\t\t\t\t\t\t\t\twrapper.off(scrollEvent, render);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlocks = [];\n\t\t\t\t\t\t\thtml = $.map(files, function(f) {\n\t\t\t\t\t\t\t\tif (f.hash && f.name) {\n\t\t\t\t\t\t\t\t\tif (f.mime == 'directory') {\n\t\t\t\t\t\t\t\t\t\tdirs = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ((f.tmb && (f.tmb != 1 || f.size > 0)) || (stmb && f.mime.indexOf('image/') === 0)) {\n\t\t\t\t\t\t\t\t\t\tatmb[f.hash] = f.tmb || 'self';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tclipCuts[f.hash] && locks.push(f.hash);\n\t\t\t\t\t\t\t\t\treturn itemhtml(f);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// html into temp node\n\t\t\t\t\t\t\ttempDom.empty().append(html.join(''));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// make directory droppable\n\t\t\t\t\t\t\tdirs && !mobile && makeDroppable(tempDom);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// check selected items\n\t\t\t\t\t\t\tselected = [];\n\t\t\t\t\t\t\tif (Object.keys(selectedFiles).length) {\n\t\t\t\t\t\t\t\ttempDom.find('[id]:not(.'+clSelected+'):not(.elfinder-cwd-parent)').each(function() {\n\t\t\t\t\t\t\t\t\tselectedFiles[fm.cwdId2Hash(this.id)] && selected.push($(this));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// append to cwd\n\t\t\t\t\t\t\tplace.append(docFlag? tempDom : tempDom.children());\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// trigger select\n\t\t\t\t\t\t\tif (selected.length) {\n\t\t\t\t\t\t\t\t$.each(selected, function(i, n) { n.trigger(evtSelect); });\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlocks.length && fm.trigger('lockfiles', {files: locks});\n\t\t\t\t\t\t\t!bufferExt.hpi && bottomMarkerShow(place, files.length);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t// show thead\n\t\t\t\t\t\t\t\tcwd.find('thead').show();\n\t\t\t\t\t\t\t\t// fixed table header\n\t\t\t\t\t\t\t\tfixTableHeader({fitWidth: ! colWidth});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (Object.keys(atmb).length) {\n\t\t\t\t\t\t\t\tObject.assign(bufferExt.attachTmbs, atmb);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\tif (! mobile && ! cwd.data('selectable')) {\n\t\t\t\t\t\t\t\t\t// make files selectable\n\t\t\t\t\t\t\t\t\tcwd.selectable(selectableOption).data('selectable', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t! scrolling && wrapper.trigger(scrollEvent);\n\t\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tif (! bufferExt.renderd) {\n\t\t\t\t\t\t// first time to go()\n\t\t\t\t\t\tbufferExt.rendering = true;\n\t\t\t\t\t\t// scroll top on dir load to avoid scroll after page reload\n\t\t\t\t\t\twrapper.scrollTop(0);\n\t\t\t\t\t\tphash = fm.cwd().phash;\n\t\t\t\t\t\tgo();\n\t\t\t\t\t\tif (options.oldSchool) {\n\t\t\t\t\t\t\tif (phash && !query) {\n\t\t\t\t\t\t\t\toldSchool(phash);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\toldSchoolItem = $();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tcolWidth && setColwidth();\n\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbufferExt.itemH = (list? place.find('tr:first') : place.find('[id]:first')).outerHeight(true);\n\t\t\t\t\t\tfm.trigger('cwdrender');\n\t\t\t\t\t\tbufferExt.rendering = false;\n\t\t\t\t\t\twrapperRepaint(true);\n\t\t\t\t\t}\n\t\t\t\t\tif (! bufferExt.rendering && buffer.length) {\n\t\t\t\t\t\t// next go()\n\t\t\t\t\t\tif ((chk = (wrapper.height() + wrapper.scrollTop() + fm.options.showThreshold + bufferExt.row) - (bufferExt.renderd * bufferExt.hpi)) > 0) {\n\t\t\t\t\t\t\tbufferExt.rendering = true;\n\t\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t\tgo(chk);\n\t\t\t\t\t\t\t\tbufferExt.rendering = false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t!fm.enabled() && resize();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresize();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t// fixed table header jQuery object\n\t\t\t\ttableHeader = null,\n\n\t\t\t\t// Is UA support CSS sticky\n\t\t\t\tcssSticky = fm.UA.CSS.positionSticky && fm.UA.CSS.widthMaxContent,\n\t\t\t\t\n\t\t\t\t// To fixed table header colmun\n\t\t\t\tfixTableHeader = function(optsArg) {\n\t\t\t\t\tthHeight = 0;\n\t\t\t\t\tif (! options.listView.fixedHeader) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar setPos = function() {\n\t\t\t\t\t\tvar val, pos;\n\t\t\t\t\t\tpos = (fm.direction === 'ltr')? 'left' : 'right';\n\t\t\t\t\t\tval = ((fm.direction === 'ltr')? wrapper.scrollLeft() : table.outerWidth(true) - wrapper.width() - wrapper.scrollLeft()) * -1;\n\t\t\t\t\t\tif (base.css(pos) !== val) {\n\t\t\t\t\t\t\tbase.css(pos, val);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\topts = optsArg || {},\n\t\t\t\t\tcnt, base, table, htable, thead, tbody, hheight, htr, btr, htd, btd, htw, btw, init;\n\t\t\t\t\t\n\t\t\t\t\ttbody = cwd.find('tbody');\n\t\t\t\t\tbtr = tbody.children('tr:first');\n\t\t\t\t\tif (btr.length && btr.is(':visible')) {\n\t\t\t\t\t\ttable = tbody.parent();\n\t\t\t\t\t\tif (! tableHeader) {\n\t\t\t\t\t\t\tinit = true;\n\t\t\t\t\t\t\ttbody.addClass('elfinder-cwd-fixheader');\n\t\t\t\t\t\t\tthead = cwd.find('thead').attr('id', fm.namespace+'-cwd-thead');\n\t\t\t\t\t\t\thtr = thead.children('tr:first');\n\t\t\t\t\t\t\thheight = htr.outerHeight(true);\n\t\t\t\t\t\t\tcwd.css('margin-top', hheight - parseInt(table.css('padding-top')));\n\t\t\t\t\t\t\tif (cssSticky) {\n\t\t\t\t\t\t\t\ttableHeader = $('<div class=\"elfinder-table-header-sticky\"/>').addClass(cwd.attr('class')).append($('<table/>').append(thead));\n\t\t\t\t\t\t\t\tcwd.after(tableHeader);\n\t\t\t\t\t\t\t\twrapper.on('resize.fixheader', function(e) {\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tbase = $('<div/>').addClass(cwd.attr('class')).append($('<table/>').append(thead));\n\t\t\t\t\t\t\t\ttableHeader = $('<div/>').addClass(wrapper.attr('class') + ' elfinder-cwd-fixheader')\n\t\t\t\t\t\t\t\t\t.removeClass('ui-droppable native-droppable')\n\t\t\t\t\t\t\t\t\t.css(wrapper.position())\n\t\t\t\t\t\t\t\t\t.css({ height: hheight, width: cwd.outerWidth() })\n\t\t\t\t\t\t\t\t\t.append(base);\n\t\t\t\t\t\t\t\tif (fm.direction === 'rtl') {\n\t\t\t\t\t\t\t\t\ttableHeader.css('left', (wrapper.data('width') - wrapper.width()) + 'px');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tsetPos();\n\t\t\t\t\t\t\t\twrapper.after(tableHeader)\n\t\t\t\t\t\t\t\t\t.on('scroll.fixheader resize.fixheader', function(e) {\n\t\t\t\t\t\t\t\t\t\tsetPos();\n\t\t\t\t\t\t\t\t\t\tif (e.type === 'resize') {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\ttableHeader.css(wrapper.position());\n\t\t\t\t\t\t\t\t\t\t\twrapper.data('width', wrapper.css('overflow', 'hidden').width());\n\t\t\t\t\t\t\t\t\t\t\twrapper.css('overflow', 'auto');\n\t\t\t\t\t\t\t\t\t\t\tfixTableHeader();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthead = $('#'+fm.namespace+'-cwd-thead');\n\t\t\t\t\t\t\thtr = thead.children('tr:first');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (init || opts.fitWidth || Math.abs(btr.outerWidth() - htr.outerWidth()) > 2) {\n\t\t\t\t\t\t\tcnt = customCols.length + 1;\n\t\t\t\t\t\t\tfor (var i = 0; i < cnt; i++) {\n\t\t\t\t\t\t\t\thtd = htr.children('td:eq('+i+')');\n\t\t\t\t\t\t\t\tbtd = btr.children('td:eq('+i+')');\n\t\t\t\t\t\t\t\thtw = htd.width();\n\t\t\t\t\t\t\t\tbtw = btd.width();\n\t\t\t\t\t\t\t\tif (typeof htd.data('delta') === 'undefined') {\n\t\t\t\t\t\t\t\t\thtd.data('delta', (htd.outerWidth() - htw) - (btd.outerWidth() - btw));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbtw -= htd.data('delta');\n\t\t\t\t\t\t\t\tif (! init && ! opts.fitWidth && htw === btw) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\thtd.css('width', btw + 'px');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!cssSticky) {\n\t\t\t\t\t\t\ttableHeader.data('widthTimer') && cancelAnimationFrame(tableHeader.data('widthTimer'));\n\t\t\t\t\t\t\ttableHeader.data('widthTimer', requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tif (tableHeader) {\n\t\t\t\t\t\t\t\t\ttableHeader.css('width', mBoard.width() + 'px');\n\t\t\t\t\t\t\t\t\tif (fm.direction === 'rtl') {\n\t\t\t\t\t\t\t\t\t\ttableHeader.css('left', (wrapper.data('width') - wrapper.width()) + 'px');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthHeight = thead.height();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t// Set colmun width\n\t\t\t\tsetColwidth = function() {\n\t\t\t\t\tif (list && colWidth) {\n\t\t\t\t\t\tvar cl = 'elfinder-cwd-colwidth',\n\t\t\t\t\t\tfirst = cwd.find('tr[id]:first'),\n\t\t\t\t\t\tformer;\n\t\t\t\t\t\tif (! first.hasClass(cl)) {\n\t\t\t\t\t\t\tformer = cwd.find('tr.'+cl);\n\t\t\t\t\t\t\tformer.removeClass(cl).find('td').css('width', '');\n\t\t\t\t\t\t\tfirst.addClass(cl);\n\t\t\t\t\t\t\tcwd.find('table:first').css('table-layout', 'fixed');\n\t\t\t\t\t\t\t$.each($.merge(['name'], customCols), function(i, k) {\n\t\t\t\t\t\t\t\tvar w = colWidth[k] || first.find('td.elfinder-col-'+k).width();\n\t\t\t\t\t\t\t\tfirst.find('td.elfinder-col-'+k).width(w);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable options for cwd.\n\t\t\t\t * Drop target is `wrapper`\n\t\t\t\t * Do not add class on childs file over\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tdroppable = Object.assign({}, fm.droppable, {\n\t\t\t\t\tover : function(e, ui) {\n\t\t\t\t\t\tvar dst    = $(this),\n\t\t\t\t\t\t\thelper = ui.helper,\n\t\t\t\t\t\t\tctr    = (e.shiftKey || e.ctrlKey || e.metaKey),\n\t\t\t\t\t\t\thash, status, inParent;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\thelper.data('dropover', helper.data('dropover') + 1);\n\t\t\t\t\t\tdst.data('dropover', true);\n\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\tif (helper.data('namespace') !== fm.namespace || ! fm.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\t\t\tdst.removeClass(clDropActive);\n\t\t\t\t\t\t\t//helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dst.hasClass(fm.res(c, 'cwdfile'))) {\n\t\t\t\t\t\t\thash = fm.cwdId2Hash(dst.attr('id'));\n\t\t\t\t\t\t\tdst.data('dropover', hash);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thash = fm.cwd().hash;\n\t\t\t\t\t\t\tfm.cwd().write && dst.data('dropover', hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinParent = (fm.file(helper.data('files')[0]).phash === hash);\n\t\t\t\t\t\tif (dst.data('dropover') === hash) {\n\t\t\t\t\t\t\t$.each(helper.data('files'), function(i, h) {\n\t\t\t\t\t\t\t\tif (h === hash || (inParent && !ctr && !helper.hasClass('elfinder-drag-helper-plus'))) {\n\t\t\t\t\t\t\t\t\tdst.removeClass(clDropActive);\n\t\t\t\t\t\t\t\t\treturn false; // break $.each\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdst.removeClass(clDropActive);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (helper.data('locked') || inParent) {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-plus';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-move';\n\t\t\t\t\t\t\tif (ctr) {\n\t\t\t\t\t\t\t\tstatus += ' elfinder-drag-helper-plus';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdst.hasClass(clDropActive) && helper.addClass(status);\n\t\t\t\t\t\trequestAnimationFrame(function(){ dst.hasClass(clDropActive) && helper.addClass(status); });\n\t\t\t\t\t},\n\t\t\t\t\tout : function(e, ui) {\n\t\t\t\t\t\tvar helper = ui.helper;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus').data('dropover', Math.max(helper.data('dropover') - 1, 0));\n\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t       .removeClass(clDropActive);\n\t\t\t\t\t},\n\t\t\t\t\tdeactivate : function() {\n\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t       .removeClass(clDropActive);\n\t\t\t\t\t},\n\t\t\t\t\tdrop : function(e, ui) {\n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tfm.droppable.drop.call(this, e, ui);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Make directory droppable\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tmakeDroppable = function(place) {\n\t\t\t\t\tplace = place? place : (list ? cwd.find('tbody') : cwd);\n\t\t\t\t\tvar targets = place.children('.directory:not(.'+clDroppable+',.elfinder-na,.elfinder-ro)');\n\n\t\t\t\t\tif (fm.isCommandEnabled('paste')) {\n\t\t\t\t\t\ttargets.droppable(droppable);\n\t\t\t\t\t}\n\t\t\t\t\tif (fm.isCommandEnabled('upload')) {\n\t\t\t\t\t\ttargets.addClass('native-droppable');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tplace.children('.isroot').each(function(i, n) {\n\t\t\t\t\t\tvar $n   = $(n),\n\t\t\t\t\t\t\thash = fm.cwdId2Hash(n.id);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (fm.isCommandEnabled('paste', hash)) {\n\t\t\t\t\t\t\tif (! $n.hasClass(clDroppable+',elfinder-na,elfinder-ro')) {\n\t\t\t\t\t\t\t\t$n.droppable(droppable);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ($n.hasClass(clDroppable)) {\n\t\t\t\t\t\t\t\t$n.droppable('destroy');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (fm.isCommandEnabled('upload', hash)) {\n\t\t\t\t\t\t\tif (! $n.hasClass('native-droppable,elfinder-na,elfinder-ro')) {\n\t\t\t\t\t\t\t\t$n.addClass('native-droppable');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ($n.hasClass('native-droppable')) {\n\t\t\t\t\t\t\t\t$n.removeClass('native-droppable');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Preload required thumbnails and on load add css to files.\n\t\t\t\t * Return false if required file is not visible yet (in buffer) -\n\t\t\t\t * required for old api to stop loading thumbnails.\n\t\t\t\t *\n\t\t\t\t * @param  Object  file hash -> thumbnail map\n\t\t\t\t * @param  Bool    reload\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tattachThumbnails = function(tmbs, reload) {\n\t\t\t\t\tvar attach = function(node, tmb) {\n\t\t\t\t\t\t\t$('<img/>')\n\t\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\t\tnode.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\");\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchk  = function(hash, tmb) {\n\t\t\t\t\t\t\tvar node = fm.cwdHash2Elm(hash),\n\t\t\t\t\t\t\t\tfile, tmbObj, reloads = [];\n\t\t\n\t\t\t\t\t\t\tif (node.length) {\n\t\t\t\t\t\t\t\tif (tmb != '1') {\n\t\t\t\t\t\t\t\t\tfile = fm.file(hash);\n\t\t\t\t\t\t\t\t\tif (file.tmb !== tmb) {\n\t\t\t\t\t\t\t\t\t\tfile.tmb = tmb;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ttmbObj = fm.tmb(file);\n\t\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\t\tnode.find('.elfinder-cwd-icon').addClass(tmbObj.className).css('background-image', \"url('\"+tmbObj.url+\"')\");\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tattach(node, tmbObj);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdelete bufferExt.attachTmbs[hash];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\t\tloadThumbnails([hash]);\n\t\t\t\t\t\t\t\t\t} else if (! bufferExt.tmbLoading[hash]) {\n\t\t\t\t\t\t\t\t\t\tbufferExt.getTmbs.push(hash);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\tif ($.isPlainObject(tmbs) && Object.keys(tmbs).length) {\n\t\t\t\t\t\tObject.assign(bufferExt.attachTmbs, tmbs);\n\t\t\t\t\t\t$.each(tmbs, chk);\n\t\t\t\t\t\tif (! reload && bufferExt.getTmbs.length && ! Object.keys(bufferExt.tmbLoading).length) {\n\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Load thumbnails from backend.\n\t\t\t\t *\n\t\t\t\t * @param  Array|void reloads  hashes list for reload thumbnail items\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tloadThumbnails = function(reloads) {\n\t\t\t\t\tvar tmbs = [],\n\t\t\t\t\t\treload = false;\n\t\t\t\t\t\n\t\t\t\t\tif (fm.oldAPI) {\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'tmb', current : fm.cwd().hash},\n\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tif (data.images && Object.keys(data.images).length) {\n\t\t\t\t\t\t\t\tattachThumbnails(data.images);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (data.tmb) {\n\t\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} \n\n\t\t\t\t\tif (reloads) {\n\t\t\t\t\t\treload = true;\n\t\t\t\t\t\ttmbs = reloads.splice(0, tmbNum);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttmbs = bufferExt.getTmbs.splice(0, tmbNum);\n\t\t\t\t\t}\n\t\t\t\t\tif (tmbs.length) {\n\t\t\t\t\t\tif (reload || inViewHashes[tmbs[0]] || inViewHashes[tmbs[tmbs.length-1]]) {\n\t\t\t\t\t\t\t$.each(tmbs, function(i, h) {\n\t\t\t\t\t\t\t\tbufferExt.tmbLoading[h] = true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'tmb', targets : tmbs},\n\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tvar errs = [],\n\t\t\t\t\t\t\t\t\tresLen;\n\t\t\t\t\t\t\t\tif (data.images) {\n\t\t\t\t\t\t\t\t\tif (resLen = Object.keys(data.images).length) {\n\t\t\t\t\t\t\t\t\t\tif (resLen < tmbs.length) {\n\t\t\t\t\t\t\t\t\t\t\t$.each(tmbs, function(i, h) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (! data.images[h]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\terrs.push(h);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tattachThumbnails(data.images, reload);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\terrs = tmbs;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// unset error items from bufferExt.attachTmbs\n\t\t\t\t\t\t\t\t\tif (errs.length) {\n\t\t\t\t\t\t\t\t\t\t$.each(errs, function(i, h) {\n\t\t\t\t\t\t\t\t\t\t\tdelete bufferExt.attachTmbs[h];\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (reload) {\n\t\t\t\t\t\t\t\t\tif (reloads.length) {\n\t\t\t\t\t\t\t\t\t\tloadThumbnails(reloads);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\tbufferExt.tmbLoading = {};\n\t\t\t\t\t\t\t\tif (! reload && bufferExt.getTmbs.length) {\n\t\t\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Add new files to cwd/buffer\n\t\t\t\t *\n\t\t\t\t * @param  Array  new files\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tadd = function(files, mode) {\n\t\t\t\t\tvar place    = list ? cwd.find('tbody') : cwd,\n\t\t\t\t\t\tl        = files.length, \n\t\t\t\t\t\tatmb     = {},\n\t\t\t\t\t\tfindNode = function(file) {\n\t\t\t\t\t\t\tvar pointer = cwd.find('[id]:first'), file2;\n\n\t\t\t\t\t\t\twhile (pointer.length) {\n\t\t\t\t\t\t\t\tfile2 = fm.file(fm.cwdId2Hash(pointer.attr('id')));\n\t\t\t\t\t\t\t\tif (!pointer.hasClass('elfinder-cwd-parent') && file2 && fm.compare(file, file2) < 0) {\n\t\t\t\t\t\t\t\t\treturn pointer;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpointer = pointer.next('[id]');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfindIndex = function(file) {\n\t\t\t\t\t\t\tvar l = buffer.length, i;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor (i =0; i < l; i++) {\n\t\t\t\t\t\t\t\tif (fm.compare(file, buffer[i]) < 0) {\n\t\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn l || -1;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// created document fragment for jQuery >= 1.12, 2.2, 3.0\n\t\t\t\t\t\t// see Studio-42/elFinder#1544 @ github\n\t\t\t\t\t\tdocFlag = $.htmlPrefilter? true : false,\n\t\t\t\t\t\ttempDom = docFlag? $(document.createDocumentFragment()) : $('<div/>'),\n\t\t\t\t\t\tfile, hash, node, nodes, ndx, stmb;\n\n\t\t\t\t\tif (l > showFiles) {\n\t\t\t\t\t\t// re-render for performance tune\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t\tselectedFiles = fm.arrayFlip($.map(files, function(f) { return f.hash; }), true);\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// add the item immediately\n\t\t\t\t\t\tl && wz.removeClass('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Self thumbnail\n\t\t\t\t\t\tstmb = (fm.option('tmbUrl') === 'self');\n\t\t\t\t\t\t\n\t\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\t\tfile = files[l];\n\t\t\t\t\t\t\thash = file.hash;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(hash).length) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif ((node = findNode(file)) && ! node.length) {\n\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (! node && (ndx = findIndex(file)) >= 0) {\n\t\t\t\t\t\t\t\tbuffer.splice(ndx, 0, file);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttempDom.empty().append(itemhtml(file));\n\t\t\t\t\t\t\t\t(file.mime === 'directory') && !mobile && makeDroppable(tempDom);\n\t\t\t\t\t\t\t\tnodes = docFlag? tempDom : tempDom.children();\n\t\t\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\t\t\tnode.before(nodes);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tplace.append(nodes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t++bufferExt.renderd;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(hash).length) {\n\t\t\t\t\t\t\t\tif ((file.tmb && (file.tmb != 1 || file.size > 0)) || (stmb && file.mime.indexOf('image/') === 0)) {\n\t\t\t\t\t\t\t\t\tatmb[hash] = file.tmb || 'self';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tsetColwidth();\n\t\t\t\t\t\t\tfixTableHeader({fitWidth: ! colWidth});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbottomMarkerShow(place);\n\t\t\t\t\t\tif (Object.keys(atmb).length) {\n\t\t\t\t\t\t\tObject.assign(bufferExt.attachTmbs, atmb);\n\t\t\t\t\t\t\tif (buffer.length < 1) {\n\t\t\t\t\t\t\t\tloadThumbnails();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Remove files from cwd/buffer\n\t\t\t\t *\n\t\t\t\t * @param  Array  files hashes\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tremove = function(files) {\n\t\t\t\t\tvar l = files.length,\n\t\t\t\t\t\tinSearch = fm.searchStatus.state > 1,\n\t\t\t\t\t\tcurCmd = fm.getCommand(fm.currentReqCmd) || {},\n\t\t\t\t\t\thash, n, ndx, found;\n\n\t\t\t\t\t// removed cwd\n\t\t\t\t\tif (!fm.cwd().hash && !curCmd.noChangeDirOnRemovedCwd) {\n\t\t\t\t\t\t$.each(cwdParents.reverse(), function(i, h) {\n\t\t\t\t\t\t\tif (fm.file(h)) {\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\tfm.one(fm.currentReqCmd + 'done', function() {\n\t\t\t\t\t\t\t\t\t!fm.cwd().hash && fm.exec('open', h);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// fallback to fm.roots[0]\n\t\t\t\t\t\t!found && !fm.cwd().hash && fm.exec('open', fm.roots[Object.keys(fm.roots)[0]]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\thash = files[l];\n\t\t\t\t\t\tif ((n = fm.cwdHash2Elm(hash)).length) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tn.remove();\n\t\t\t\t\t\t\t\t--bufferExt.renderd;\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tfm.debug('error', e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ((ndx = index(hash)) !== -1) {\n\t\t\t\t\t\t\tbuffer.splice(ndx, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselectedFiles[hash] && delete selectedFiles[hash];\n\t\t\t\t\t\tif (inSearch) {\n\t\t\t\t\t\t\tif ((ndx = $.inArray(hash, cwdHashes)) !== -1) {\n\t\t\t\t\t\t\t\tcwdHashes.splice(ndx, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tinSearch && fm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tsetColwidth();\n\t\t\t\t\t\tfixTableHeader({fitWidth: ! colWidth});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcustomColsNameBuild = function() {\n\t\t\t\t\tvar name = '',\n\t\t\t\t\tcustomColsName = '';\n\t\t\t\t\tfor (var i = 0; i < customCols.length; i++) {\n\t\t\t\t\t\tname = fm.getColumnName(customCols[i]);\n\t\t\t\t\t\tcustomColsName +='<td class=\"elfinder-cwd-view-th-'+customCols[i]+' sortable-item\">'+name+'</td>';\n\t\t\t\t\t}\n\t\t\t\t\treturn customColsName;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tsetItemBoxSize = function(boxSize) {\n\t\t\t\t\tvar place, elm;\n\t\t\t\t\tif (!boxSize.height) {\n\t\t\t\t\t\tplace = (list ? cwd.find('tbody') : cwd);\n\t\t\t\t\t\telm = place.find(list? 'tr:first' : '[id]:first');\n\t\t\t\t\t\tboxSize.height = elm.outerHeight(true);\n\t\t\t\t\t\tif (!list) {\n\t\t\t\t\t\t\tboxSize.width = elm.outerWidth(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tbottomMarkerShow = function(cur, cnt) {\n\t\t\t\t\tvar place = cur || (list ? cwd.find('tbody') : cwd),\n\t\t\t\t\t\tboxSize = itemBoxSize[fm.viewType],\n\t\t\t\t\t\tcol = 1,\n\t\t\t\t\t\trow;\n\n\t\t\t\t\tif (buffer.length > 0) {\n\t\t\t\t\t\tif (!bufferExt.hpi) {\n\t\t\t\t\t\t\tsetItemBoxSize(boxSize);\n\t\t\t\t\t\t\tif (! list) {\n\t\t\t\t\t\t\t\tcol = Math.floor(place.width() / boxSize.width);\n\t\t\t\t\t\t\t\tbufferExt.row = boxSize.height;\n\t\t\t\t\t\t\t\tbufferExt.hpi = bufferExt.row / col;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tbufferExt.row = bufferExt.hpi = boxSize.height;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (!list) {\n\t\t\t\t\t\t\tcol = Math.floor(place.width() / boxSize.width);\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow = Math.ceil((buffer.length + (cnt || 0)) / col);\n\t\t\t\t\t\tif (list && tableHeader) {\n\t\t\t\t\t\t\t++row;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbottomMarker.css({top: (bufferExt.row * row) + 'px'}).show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\twrapperContextMenu = {\n\t\t\t\t\tcontextmenu : function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif (cwd.data('longtap') !== void(0)) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t'type'    : 'cwd',\n\t\t\t\t\t\t\t'targets' : [fm.cwd().hash],\n\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\ttouchstart : function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cwd.data('longtap') !== false) {\n\t\t\t\t\t\t\twrapper.data('touching', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY});\n\t\t\t\t\t\t\tcwd.data('tmlongtap', setTimeout(function(){\n\t\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\t\tcwd.data('longtap', true);\n\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t'type'    : 'cwd',\n\t\t\t\t\t\t\t\t\t'targets' : [fm.cwd().hash],\n\t\t\t\t\t\t\t\t\t'x'       : wrapper.data('touching').x,\n\t\t\t\t\t\t\t\t\t'y'       : wrapper.data('touching').y\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcwd.data('longtap', null);\n\t\t\t\t\t},\n\t\t\t\t\ttouchend : function(e) {\n\t\t\t\t\t\tif (e.type === 'touchmove') {\n\t\t\t\t\t\t\tif (! wrapper.data('touching') ||\n\t\t\t\t\t\t\t\t\t( Math.abs(wrapper.data('touching').x - e.originalEvent.touches[0].pageX)\n\t\t\t\t\t\t\t\t\t+ Math.abs(wrapper.data('touching').y - e.originalEvent.touches[0].pageY)) > 4) {\n\t\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcwd.removeData('longtap');\n\t\t\t\t\t\t\t}, 80);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclearTimeout(cwd.data('tmlongtap'));\n\t\t\t\t\t},\n\t\t\t\t\tclick : function(e) {\n\t\t\t\t\t\tif (cwd.data('longtap')) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Update directory content\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tcontent = function() {\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tvar phash, emptyMethod, thtr;\n\n\t\t\t\t\t\twz.append(selectAllCheckbox).removeClass('elfinder-cwd-wrapper-empty elfinder-search-result elfinder-incsearch-result elfinder-letsearch-result');\n\t\t\t\t\t\tif (fm.searchStatus.state > 1 || fm.searchStatus.ininc) {\n\t\t\t\t\t\t\twz.addClass('elfinder-search-result' + (fm.searchStatus.ininc? ' elfinder-'+(query.substr(0,1) === '/' ? 'let':'inc')+'search-result' : ''));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// abort attachThumbJob\n\t\t\t\t\t\tbufferExt.attachThumbJob && bufferExt.attachThumbJob._abort();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// destroy selectable for GC\n\t\t\t\t\t\tcwd.data('selectable') && cwd.selectable('disable').selectable('destroy').removeData('selectable');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// notify cwd init\n\t\t\t\t\t\tfm.trigger('cwdinit');\n\t\t\t\t\t\t\n\t\t\t\t\t\tselectedNext = $();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// to avoid problem with draggable\n\t\t\t\t\t\t\tcwd.empty();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tcwd.html('');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (tableHeader) {\n\t\t\t\t\t\t\twrapper.off('scroll.fixheader resize.fixheader');\n\t\t\t\t\t\t\ttableHeader.remove();\n\t\t\t\t\t\t\ttableHeader = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcwd.removeClass('elfinder-cwd-view-icons elfinder-cwd-view-list')\n\t\t\t\t\t\t\t.addClass('elfinder-cwd-view-'+(list ? 'list' :'icons'))\n\t\t\t\t\t\t\t.attr('style', '')\n\t\t\t\t\t\t\t.css('height', 'auto');\n\t\t\t\t\t\tbottomMarker.hide();\n\n\t\t\t\t\t\twrapper[list ? 'addClass' : 'removeClass']('elfinder-cwd-wrapper-list')._padding = parseInt(wrapper.css('padding-top')) + parseInt(wrapper.css('padding-bottom'));\n\t\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\t\twrapper.removeClass('overflow-scrolling-touch').addClass('overflow-scrolling-touch');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tcwd.html('<table><thead/><tbody/></table>');\n\t\t\t\t\t\t\tthtr = $('<tr class=\"ui-state-default\"><td class=\"elfinder-cwd-view-th-name\">'+fm.getColumnName('name')+'</td>'+customColsNameBuild()+'</tr>');\n\t\t\t\t\t\t\tcwd.find('thead').hide().append(thtr).find('td:first').append(selectAllCheckbox);\n\t\t\t\t\t\t\tif ($.fn.sortable) {\n\t\t\t\t\t\t\t\tthtr.addClass('touch-punch touch-punch-keep-default')\n\t\t\t\t\t\t\t\t\t.sortable({\n\t\t\t\t\t\t\t\t\taxis: 'x',\n\t\t\t\t\t\t\t\t\tdistance: 8,\n\t\t\t\t\t\t\t\t\titems: '> .sortable-item',\n\t\t\t\t\t\t\t\t\tstart: function(e, ui) {\n\t\t\t\t\t\t\t\t\t\t$(ui.item[0]).data('dragging', true);\n\t\t\t\t\t\t\t\t\t\tui.placeholder\n\t\t\t\t\t\t\t\t\t\t\t.width(ui.helper.removeClass('ui-state-hover').width())\n\t\t\t\t\t\t\t\t\t\t\t.removeClass('ui-state-active')\n\t\t\t\t\t\t\t\t\t\t\t.addClass('ui-state-hover')\n\t\t\t\t\t\t\t\t\t\t\t.css('visibility', 'visible');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tupdate: function(e, ui){\n\t\t\t\t\t\t\t\t\t\tvar target = $(ui.item[0]).attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', ''),\n\t\t\t\t\t\t\t\t\t\t\tprev, done;\n\t\t\t\t\t\t\t\t\t\tcustomCols = $.map($(this).children(), function(n) {\n\t\t\t\t\t\t\t\t\t\t\tvar name = $(n).attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', '');\n\t\t\t\t\t\t\t\t\t\t\tif (! done) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (target === name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdone = true;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprev = name;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn (name === 'name')? null : name;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\ttemplates.row = makeTemplateRow();\n\t\t\t\t\t\t\t\t\t\tfm.storage('cwdCols', customCols);\n\t\t\t\t\t\t\t\t\t\tprev = '.elfinder-col-'+prev+':first';\n\t\t\t\t\t\t\t\t\t\ttarget = '.elfinder-col-'+target+':first';\n\t\t\t\t\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t\t\t\t\tcwd.find('tbody tr').each(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t\t\t\t\t\t\t\t$this.children(prev).after($this.children(target));\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tstop: function(e, ui) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t$(ui.item[0]).removeData('dragging');\n\t\t\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthtr.find('td').addClass('touch-punch').resizable({\n\t\t\t\t\t\t\t\thandles: fm.direction === 'ltr'? 'e' : 'w',\n\t\t\t\t\t\t\t\tstart: function(e, ui) {\n\t\t\t\t\t\t\t\t\tvar target = cwd.find('td.elfinder-col-'\n\t\t\t\t\t\t\t\t\t\t+ ui.element.attr('class').split(' ')[0].replace('elfinder-cwd-view-th-', '')\n\t\t\t\t\t\t\t\t\t\t+ ':first');\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tui.element\n\t\t\t\t\t\t\t\t\t\t.data('dragging', true)\n\t\t\t\t\t\t\t\t\t\t.data('resizeTarget', target)\n\t\t\t\t\t\t\t\t\t\t.data('targetWidth', target.width());\n\t\t\t\t\t\t\t\t\tcolResizing = true;\n\t\t\t\t\t\t\t\t\tif (cwd.find('table').css('table-layout') !== 'fixed') {\n\t\t\t\t\t\t\t\t\t\tcwd.find('tbody tr:first td').each(function() {\n\t\t\t\t\t\t\t\t\t\t\t$(this).width($(this).width());\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tcwd.find('table').css('table-layout', 'fixed');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tresize: function(e, ui) {\n\t\t\t\t\t\t\t\t\tui.element.data('resizeTarget').width(ui.element.data('targetWidth') - (ui.originalSize.width - ui.size.width));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tstop : function(e, ui) {\n\t\t\t\t\t\t\t\t\tcolResizing = false;\n\t\t\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t\t\t\tcolWidth = {};\n\t\t\t\t\t\t\t\t\tcwd.find('tbody tr:first td').each(function() {\n\t\t\t\t\t\t\t\t\t\tvar name = $(this).attr('class').split(' ')[0].replace('elfinder-col-', '');\n\t\t\t\t\t\t\t\t\t\tcolWidth[name] = $(this).width();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfm.storage('cwdColWidth', colWidth);\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tui.element.removeData('dragging');\n\t\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.find('.ui-resizable-handle').addClass('ui-icon ui-icon-grip-dotted-vertical');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbuffer = $.map(incHashes || cwdHashes, function(hash) { return fm.file(hash) || null; });\n\t\t\t\t\t\t\n\t\t\t\t\t\tbuffer = fm.sortFiles(buffer);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (incHashes) {\n\t\t\t\t\t\t\tincHashes = $.map(buffer, function(f) { return f.hash; });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcwdHashes = $.map(buffer, function(f) { return f.hash; });\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tbufferExt = {\n\t\t\t\t\t\t\trenderd: 0,\n\t\t\t\t\t\t\tattachTmbs: {},\n\t\t\t\t\t\t\tgetTmbs: [],\n\t\t\t\t\t\t\ttmbLoading: {},\n\t\t\t\t\t\t\tlazyOpts: { tm : 0 }\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\twz[(buffer.length < 1) ? 'addClass' : 'removeClass']('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\twrapper.off(scrollEvent, render).on(scrollEvent, render).trigger(scrollEvent);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// set droppable\n\t\t\t\t\t\tif (!fm.cwd().write) {\n\t\t\t\t\t\t\twrapper.removeClass('native-droppable')\n\t\t\t\t\t\t\t       .droppable('disable')\n\t\t\t\t\t\t\t       .removeClass('ui-state-disabled'); // for old jQueryUI see https://bugs.jqueryui.com/ticket/5974\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twrapper[fm.isCommandEnabled('upload')? 'addClass' : 'removeClass']('native-droppable');\n\t\t\t\t\t\t\twrapper.droppable(fm.isCommandEnabled('paste')? 'enable' : 'disable');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * CWD node itself\n\t\t\t\t *\n\t\t\t\t * @type JQuery\n\t\t\t\t **/\n\t\t\t\tcwd = $(this)\n\t\t\t\t\t.addClass('ui-helper-clearfix elfinder-cwd')\n\t\t\t\t\t.attr('unselectable', 'on')\n\t\t\t\t\t// fix ui.selectable bugs and add shift+click support \n\t\t\t\t\t.on('click.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tvar p    = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\ttgt  = $(e.target),\n\t\t\t\t\t\t\tprev,\n\t\t\t\t\t\t\tnext,\n\t\t\t\t\t\t\tpl,\n\t\t\t\t\t\t\tnl,\n\t\t\t\t\t\t\tsib;\n\n\t\t\t\t\t\tif (selectCheckbox && (tgt.is('input:checkbox.'+clSelChk) || tgt.hasClass('elfinder-cwd-select'))) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tp.trigger(p.hasClass(clSelected) ? evtUnselect : evtSelect);\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\ttgt.prop('checked', p.hasClass(clSelected));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cwd.data('longtap') || tgt.hasClass('elfinder-cwd-nonselect')) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!curClickId) {\n\t\t\t\t\t\t\tcurClickId = p.attr('id');\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcurClickId = '';\n\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\t\tprev = p.prevAll(lastSelect || '.'+clSelected+':first');\n\t\t\t\t\t\t\tnext = p.nextAll(lastSelect || '.'+clSelected+':first');\n\t\t\t\t\t\t\tpl   = prev.length;\n\t\t\t\t\t\t\tnl   = next.length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.shiftKey && (pl || nl)) {\n\t\t\t\t\t\t\tsib = pl ? p.prevUntil('#'+prev.attr('id')) : p.nextUntil('#'+next.attr('id'));\n\t\t\t\t\t\t\tsib = sib.add(p);\n\t\t\t\t\t\t\tif (!pl) {\n\t\t\t\t\t\t\t\tsib  = $(sib.get().reverse());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsib.trigger(evtSelect);\n\t\t\t\t\t\t} else if (e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\t\tp.trigger(p.hasClass(clSelected) ? evtUnselect : evtSelect);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (wrapper.data('touching') && p.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\t\tfm.dblclick({file : fm.cwdId2Hash(this.id)});\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\t\tp.trigger(evtSelect);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t})\n\t\t\t\t\t// call fm.open()\n\t\t\t\t\t.on('dblclick.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tif (curClickId) {\n\t\t\t\t\t\t\tvar hash = fm.cwdId2Hash(curClickId);\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tif (this.id !== curClickId) {\n\t\t\t\t\t\t\t\t$(this).trigger(evtUnselect);\n\t\t\t\t\t\t\t\t$('#'+curClickId).trigger(evtSelect);\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.dblclick({file : hash});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// for touch device\n\t\t\t\t\t.on('touchstart.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar p   = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\ttgt = $(e.target),\n\t\t\t\t\t\t\tnodeName = e.target.nodeName,\n\t\t\t\t\t\t\tsel;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((nodeName === 'INPUT' && e.target.type === 'text') || nodeName === 'TEXTAREA' || tgt.hasClass('elfinder-cwd-nonselect')) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now name editing\n\t\t\t\t\t\tif (p.find('input:text,textarea').length) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\twrapper.data('touching', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY});\n\t\t\t\t\t\tif (selectCheckbox && (tgt.is('input:checkbox.'+clSelChk) || tgt.hasClass('elfinder-cwd-select'))) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsel = p.prevAll('.'+clSelected+':first').length +\n\t\t\t\t\t\t      p.nextAll('.'+clSelected+':first').length;\n\t\t\t\t\t\tcwd.data('longtap', null);\n\t\t\t\t\t\tif (Object.keys(selectedFiles).length\n\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t(list && e.target.nodeName !== 'TD')\n\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t(!list && this !== e.target)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcwd.data('longtap', false);\n\t\t\t\t\t\t\tp.addClass(clHover);\n\t\t\t\t\t\t\tp.data('tmlongtap', setTimeout(function(){\n\t\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\t\tcwd.data('longtap', true);\n\t\t\t\t\t\t\t\tp.trigger(evtSelect);\n\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t'type'    : 'files',\n\t\t\t\t\t\t\t\t\t'targets' : fm.selected(),\n\t\t\t\t\t\t\t\t\t'x'       : e.originalEvent.touches[0].pageX,\n\t\t\t\t\t\t\t\t\t'y'       : e.originalEvent.touches[0].pageY\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchmove.'+fm.namespace+' touchend.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tvar tgt = $(e.target),\n\t\t\t\t\t\t\tp;\n\t\t\t\t\t\tif (selectCheckbox && (tgt.is('input:checkbox.'+clSelChk) || tgt.hasClass('elfinder-cwd-select'))) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.target.nodeName == 'INPUT' || e.target.nodeName == 'TEXTAREA') {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tp = this.id ? $(this) : $(this).parents('[id]:first');\n\t\t\t\t\t\tclearTimeout(p.data('tmlongtap'));\n\t\t\t\t\t\tif (e.type === 'touchmove') {\n\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\tp.removeClass(clHover);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (wrapper.data('touching') && !cwd.data('longtap') && p.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\twrapper.data('touching', null);\n\t\t\t\t\t\t\t\tfm.dblclick({file : fm.cwdId2Hash(this.id)});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tcwd.removeData('longtap');\n\t\t\t\t\t\t\t}, 80);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// attach draggable\n\t\t\t\t\t.on('mouseenter.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tif (scrolling) { return; }\n\t\t\t\t\t\tvar $this = $(this), helper = null;\n\n\t\t\t\t\t\tif (!mobile && !$this.data('dragRegisted') && !$this.hasClass(clTmp) && !$this.hasClass(clDraggable) && !$this.hasClass(clDisabled)) {\n\t\t\t\t\t\t\t$this.data('dragRegisted', true);\n\t\t\t\t\t\t\tif (!fm.isCommandEnabled('copy', fm.searchStatus.state > 1 || $this.hasClass('isroot')? fm.cwdId2Hash($this.attr('id')) : void 0)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.on('mousedown', function(e) {\n\t\t\t\t\t\t\t\t// shiftKey or altKey + drag start for HTML5 native drag function\n\t\t\t\t\t\t\t\t// Note: can no use shiftKey with the Google Chrome \n\t\t\t\t\t\t\t\tvar metaKey = options.metakeyDragout && !fm.UA.IE && (e.shiftKey || e.altKey),\n\t\t\t\t\t\t\t\t\tdisable = false;\n\t\t\t\t\t\t\t\tif (metaKey && cwd.data('selectable')) {\n\t\t\t\t\t\t\t\t\t// destroy jQuery-ui selectable while trigger native drag\n\t\t\t\t\t\t\t\t\tcwd.selectable('disable').selectable('destroy').removeData('selectable');\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function(){\n\t\t\t\t\t\t\t\t\t\tcwd.selectable(selectableOption).selectable('option', {disabled: false}).selectable('refresh').data('selectable', true);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$this.removeClass('ui-state-disabled');\n\t\t\t\t\t\t\t\tif (metaKey) {\n\t\t\t\t\t\t\t\t\t$this.draggable('option', 'disabled', true).attr('draggable', 'true');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (!$this.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\t\t\t\t\tdisable = $(e.target).closest('span,tr').is('tr');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdisable = $(e.target).hasClass('elfinder-cwd-file');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (disable) {\n\t\t\t\t\t\t\t\t\t\t// removeClass('ui-state-disabled') for old version of jQueryUI\n\t\t\t\t\t\t\t\t\t\t$this.draggable('option', 'disabled', true).removeClass('ui-state-disabled');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t$this.draggable('option', 'disabled', false)\n\t\t\t\t\t\t\t\t\t\t\t  .removeAttr('draggable')\n\t\t\t\t\t\t\t\t\t\t      .draggable('option', 'cursorAt', {left: 50 - parseInt($(e.currentTarget).css('margin-left')), top: 47});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragstart', function(e) {\n\t\t\t\t\t\t\t\tvar dt = e.dataTransfer || e.originalEvent.dataTransfer || null;\n\t\t\t\t\t\t\t\thelper = null;\n\t\t\t\t\t\t\t\tif (dt && !fm.UA.IE) {\n\t\t\t\t\t\t\t\t\tvar p = this.id ? $(this) : $(this).parents('[id]:first'),\n\t\t\t\t\t\t\t\t\t\telm   = $('<span>'),\n\t\t\t\t\t\t\t\t\t\turl   = '',\n\t\t\t\t\t\t\t\t\t\tdurl  = null,\n\t\t\t\t\t\t\t\t\t\tmurl  = null,\n\t\t\t\t\t\t\t\t\t\tfiles = [],\n\t\t\t\t\t\t\t\t\t\ticon  = function(f) {\n\t\t\t\t\t\t\t\t\t\t\tvar mime = f.mime, i, tmb = fm.tmb(f);\n\t\t\t\t\t\t\t\t\t\t\ti = '<div class=\"elfinder-cwd-icon elfinder-cwd-icon-drag '+fm.mime2class(mime)+' ui-corner-all\"/>';\n\t\t\t\t\t\t\t\t\t\t\tif (tmb) {\n\t\t\t\t\t\t\t\t\t\t\t\ti = $(i).addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\").get(0).outerHTML;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t\t\t\t}, l, geturl = [];\n\t\t\t\t\t\t\t\t\tp.trigger(evtSelect);\n\t\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t\t\t$.each(selectedFiles, function(v){\n\t\t\t\t\t\t\t\t\t\tvar file = fm.file(v),\n\t\t\t\t\t\t\t\t\t\t\tfurl = file.url;\n\t\t\t\t\t\t\t\t\t\tif (file && file.mime !== 'directory') {\n\t\t\t\t\t\t\t\t\t\t\tif (!furl) {\n\t\t\t\t\t\t\t\t\t\t\t\tfurl = fm.url(file.hash);\n\t\t\t\t\t\t\t\t\t\t\t} else if (furl == '1') {\n\t\t\t\t\t\t\t\t\t\t\t\tgeturl.push(v);\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (furl) {\n\t\t\t\t\t\t\t\t\t\t\t\tfurl = fm.convAbsUrl(furl);\n\t\t\t\t\t\t\t\t\t\t\t\tfiles.push(v);\n\t\t\t\t\t\t\t\t\t\t\t\t$('<a>').attr('href', furl).text(furl).appendTo(elm);\n\t\t\t\t\t\t\t\t\t\t\t\turl += furl + \"\\n\";\n\t\t\t\t\t\t\t\t\t\t\t\tif (!durl) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdurl = file.mime + ':' + file.name + ':' + furl;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tif (!murl) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmurl = furl + \"\\n\" + file.name;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (geturl.length) {\n\t\t\t\t\t\t\t\t\t\t$.each(geturl, function(i, v){\n\t\t\t\t\t\t\t\t\t\t\tvar rfile = fm.file(v);\n\t\t\t\t\t\t\t\t\t\t\trfile.url = '';\n\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : v},\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'url', cnt : 1},\n\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\trfile.url = data.url? data.url : '1';\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t} else if (url) {\n\t\t\t\t\t\t\t\t\t\tif (dt.setDragImage) {\n\t\t\t\t\t\t\t\t\t\t\thelper = $('<div class=\"elfinder-drag-helper html5-native\"></div>').append(icon(fm.file(files[0]))).appendTo($(document.body));\n\t\t\t\t\t\t\t\t\t\t\tif ((l = files.length) > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\thelper.append(icon(fm.file(files[l-1])) + '<span class=\"elfinder-drag-num\">'+l+'</span>');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdt.setDragImage(helper.get(0), 50, 47);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdt.effectAllowed = 'copyLink';\n\t\t\t\t\t\t\t\t\t\tdt.setData('DownloadURL', durl);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/x-moz-url', murl);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/uri-list', url);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/plain', url);\n\t\t\t\t\t\t\t\t\t\tdt.setData('text/html', elm.html());\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom', window.location.href + fm.cwd().hash);\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom:' + dt.getData('elfinderfrom'), '');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragend', function(e){\n\t\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\t\thelper && helper.remove();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.draggable(fm.draggable);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// add hover class to selected file\n\t\t\t\t\t.on(evtSelect, fileSelector, function(e) {\n\t\t\t\t\t\tvar $this = $(this),\n\t\t\t\t\t\t\tid    = fm.cwdId2Hash($this.attr('id'));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!selectLock && !$this.hasClass(clDisabled)) {\n\t\t\t\t\t\t\tlastSelect = '#'+ this.id;\n\t\t\t\t\t\t\t$this.addClass(clSelected).children().addClass(clHover).find('input:checkbox.'+clSelChk).prop('checked', true);\n\t\t\t\t\t\t\tif (! selectedFiles[id]) {\n\t\t\t\t\t\t\t\tselectedFiles[id] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// will be selected next\n\t\t\t\t\t\t\tselectedNext = cwd.find('[id].'+clSelected+':last').next();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// remove hover class from unselected file\n\t\t\t\t\t.on(evtUnselect, fileSelector, function(e) {\n\t\t\t\t\t\tvar $this = $(this), \n\t\t\t\t\t\t\tid    = fm.cwdId2Hash($this.attr('id'));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!selectLock) {\n\t\t\t\t\t\t\t$this.removeClass(clSelected).children().removeClass(clHover).find('input:checkbox.'+clSelChk).prop('checked', false);\n\t\t\t\t\t\t\tif (cwd.hasClass('elfinder-cwd-allselected')) {\n\t\t\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.children('input').prop('checked', false);\n\t\t\t\t\t\t\t\tcwd.removeClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tselectedFiles[id] && delete selectedFiles[id];\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t})\n\t\t\t\t\t// disable files wich removing or moving\n\t\t\t\t\t.on(evtDisable, fileSelector, function() {\n\t\t\t\t\t\tvar $this  = $(this).removeClass(clHover+' '+clSelected).addClass(clDisabled), \n\t\t\t\t\t\t\tchild  = $this.children(),\n\t\t\t\t\t\t\ttarget = (list ? $this : child.find('div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename'));\n\t\t\t\t\t\t\n\t\t\t\t\t\tchild.removeClass(clHover+' '+clSelected);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$this.hasClass(clDroppable) && $this.droppable('disable');\n\t\t\t\t\t\ttarget.hasClass(clDraggable) && target.draggable('disable');\n\t\t\t\t\t})\n\t\t\t\t\t// if any files was not removed/moved - unlock its\n\t\t\t\t\t.on(evtEnable, fileSelector, function() {\n\t\t\t\t\t\tvar $this  = $(this).removeClass(clDisabled), \n\t\t\t\t\t\t\ttarget = list ? $this : $this.children('div.elfinder-cwd-file-wrapper,div.elfinder-cwd-filename');\n\t\t\t\t\t\t\n\t\t\t\t\t\t$this.hasClass(clDroppable) && $this.droppable('enable');\t\n\t\t\t\t\t\ttarget.hasClass(clDraggable) && target.draggable('enable');\n\t\t\t\t\t})\n\t\t\t\t\t.on('scrolltoview', fileSelector, function(e, data) {\n\t\t\t\t\t\tscrollToView($(this), (data && typeof data.blink !== 'undefined')? data.blink : true);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter.'+fm.namespace+' mouseleave.'+fm.namespace, fileSelector, function(e) {\n\t\t\t\t\t\tvar enter = (e.type === 'mouseenter');\n\t\t\t\t\t\tif (enter && (scrolling || fm.UA.Mobile)) { return; }\n\t\t\t\t\t\tfm.trigger('hover', {hash : fm.cwdId2Hash($(this).attr('id')), type : e.type});\n\t\t\t\t\t\t$(this).toggleClass(clHover, (e.type == 'mouseenter'));\n\t\t\t\t\t})\n\t\t\t\t\t// for file contextmenu\n\t\t\t\t\t.on('mouseenter.'+fm.namespace+' mouseleave.'+fm.namespace, '.elfinder-cwd-file-wrapper,.elfinder-cwd-filename', function(e) {\n\t\t\t\t\t\tvar enter = (e.type === 'mouseenter');\n\t\t\t\t\t\tif (enter && scrolling) { return; }\n\t\t\t\t\t\t$(this).closest(fileSelector).children('.elfinder-cwd-file-wrapper,.elfinder-cwd-filename').toggleClass(clActive, (e.type == 'mouseenter'));\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu.'+fm.namespace, function(e) {\n\t\t\t\t\t\tvar file = $(e.target).closest(fileSelector);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.get(0) === e.target && !selectedFiles[fm.cwdId2Hash(file.get(0).id)]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// now filename editing\n\t\t\t\t\t\tif (file.find('input:text,textarea').length) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.length && (e.target.nodeName != 'TD' || selectedFiles[fm.cwdId2Hash(file.get(0).id)])) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tif (!file.hasClass(clDisabled) && !wrapper.data('touching')) {\n\t\t\t\t\t\t\t\tif (!file.hasClass(clSelected)) {\n\t\t\t\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\t\t\t\tfile.trigger(evtSelect);\n\t\t\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t'type'    : 'files',\n\t\t\t\t\t\t\t\t\t'targets' : fm.selected(),\n\t\t\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// unselect all on cwd click\n\t\t\t\t\t.on('click.'+fm.namespace, function(e) {\n\t\t\t\t\t\tif (e.target === this && ! cwd.data('longtap')) {\n\t\t\t\t\t\t\t!e.shiftKey && !e.ctrlKey && !e.metaKey && unselectAll();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// prepend fake file/dir\n\t\t\t\t\t.on('create.'+fm.namespace, function(e, f) {\n\t\t\t\t\t\tvar parent = list ? cwd.find('tbody') : cwd,\n\t\t\t\t\t\t\tp = parent.find('.elfinder-cwd-parent'),\n\t\t\t\t\t\t\tlock = f.move || false,\n\t\t\t\t\t\t\tfile = $(itemhtml(f)).addClass(clTmp),\n\t\t\t\t\t\t\tselected = fm.selected();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (selected.length) {\n\t\t\t\t\t\t\tlock && fm.trigger('lockfiles', {files: selected});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (p.length) {\n\t\t\t\t\t\t\tp.after(file);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparent.prepend(file);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsetColwidth();\n\t\t\t\t\t\twrapper.scrollTop(0).scrollLeft(0);\n\t\t\t\t\t})\n\t\t\t\t\t// unselect all selected files\n\t\t\t\t\t.on('unselectall', unselectAll)\n\t\t\t\t\t.on('selectfile', function(e, id) {\n\t\t\t\t\t\tfm.cwdHash2Elm(id).trigger(evtSelect);\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t})\n\t\t\t\t\t.on('colwidth', function() {\n\t\t\t\t\t\tif (list) {\n\t\t\t\t\t\t\tcwd.find('table').css('table-layout', '')\n\t\t\t\t\t\t\t\t.find('td').css('width', '');\n\t\t\t\t\t\t\tfixTableHeader({fitWidth: true});\n\t\t\t\t\t\t\tfm.storage('cwdColWidth', colWidth = null);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('iconpref', function(e, data) {\n\t\t\t\t\t\tcwd.removeClass(function(i, cName) {\n\t\t\t\t\t\t\treturn (cName.match(/\\belfinder-cwd-size\\S+/g) || []).join(' ');\n\t\t\t\t\t\t});\n\t\t\t\t\t\ticonSize = data? (parseInt(data.size) || 0) : 0;\n\t\t\t\t\t\tif (!list) {\n\t\t\t\t\t\t\tif (iconSize > 0) {\n\t\t\t\t\t\t\t\tcwd.addClass('elfinder-cwd-size' + iconSize);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (bufferExt.renderd) {\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\titemBoxSize.icons = {};\n\t\t\t\t\t\t\t\t\tbufferExt.hpi = null;\n\t\t\t\t\t\t\t\t\tbottomMarkerShow(cwd, bufferExt.renderd);\n\t\t\t\t\t\t\t\t\twrapperRepaint();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// Change icon size with mouse wheel event\n\t\t\t\t\t.on('onwheel' in document ? 'wheel' : 'mousewheel', function(e) {\n\t\t\t\t\t\tvar tm, size, delta;\n\t\t\t\t\t\tif (!list && ((e.ctrlKey && !e.metaKey) || (!e.ctrlKey && e.metaKey))) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\ttm = cwd.data('wheelTm');\n\t\t\t\t\t\t\tif (typeof tm !== 'undefined') {\n\t\t\t\t\t\t\t\tclearTimeout(tm);\n\t\t\t\t\t\t\t\tcwd.data('wheelTm', setTimeout(function() {\n\t\t\t\t\t\t\t\t\tcwd.removeData('wheelTm');\n\t\t\t\t\t\t\t\t}, 200));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcwd.data('wheelTm', false);\n\t\t\t\t\t\t\t\tsize = iconSize || 0;\n\t\t\t\t\t\t\t\tdelta = e.originalEvent.deltaY ? e.originalEvent.deltaY : -(e.originalEvent.wheelDelta);\n\t\t\t\t\t\t\t\tif (delta > 0) {\n\t\t\t\t\t\t\t\t\tif (iconSize > 0) {\n\t\t\t\t\t\t\t\t\t\tsize = iconSize - 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (iconSize < options.iconsView.sizeMax) {\n\t\t\t\t\t\t\t\t\t\tsize = iconSize + 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (size !== iconSize) {\n\t\t\t\t\t\t\t\t\tfm.storage('iconsize', size);\n\t\t\t\t\t\t\t\t\tcwd.trigger('iconpref', {size: size});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\twrapper = $('<div class=\"elfinder-cwd-wrapper\"/>')\n\t\t\t\t\t// make cwd itself droppable for folders from nav panel\n\t\t\t\t\t.droppable(Object.assign({}, droppable, {autoDisable: false}))\n\t\t\t\t\t.on('contextmenu.'+fm.namespace, wrapperContextMenu.contextmenu)\n\t\t\t\t\t.on('touchstart.'+fm.namespace, wrapperContextMenu.touchstart)\n\t\t\t\t\t.on('touchmove.'+fm.namespace+' touchend.'+fm.namespace, wrapperContextMenu.touchend)\n\t\t\t\t\t.on('click.'+fm.namespace, wrapperContextMenu.click)\n\t\t\t\t\t.on('scroll.'+fm.namespace, function() {\n\t\t\t\t\t\tif (! scrolling) {\n\t\t\t\t\t\t\tcwd.data('selectable') && cwd.selectable('disable');\n\t\t\t\t\t\t\twrapper.trigger(scrollStartEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tscrolling = true;\n\t\t\t\t\t\tbufferExt.scrtm && cancelAnimationFrame(bufferExt.scrtm);\n\t\t\t\t\t\tif (bufferExt.scrtm && Math.abs((bufferExt.scrolltop || 0) - (bufferExt.scrolltop = (this.scrollTop || $(this).scrollTop()))) < 5) {\n\t\t\t\t\t\t\tbufferExt.scrtm = 0;\n\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbufferExt.scrtm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\tbufferExt.scrtm = 0;\n\t\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on(scrollEvent, function() {\n\t\t\t\t\t\tscrolling = false;\n\t\t\t\t\t\twrapperRepaint();\n\t\t\t\t\t}),\n\t\t\t\t\n\t\t\t\tbottomMarker = $('<div>&nbsp;</div>')\n\t\t\t\t\t.css({position: 'absolute', width: '1px', height: '1px'})\n\t\t\t\t\t.hide(),\n\t\t\t\t\n\t\t\t\tselectAllCheckbox = selectCheckbox? $('<div class=\"elfinder-cwd-selectall\"><input type=\"checkbox\"/></div>')\n\t\t\t\t\t.attr('title', fm.i18n('selectall'))\n\t\t\t\t\t.on('touchstart mousedown click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif ($(this).data('pending') || e.type === 'click') {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselectAllCheckbox.data('pending', true);\n\t\t\t\t\t\tif (cwd.hasClass('elfinder-cwd-allselected')) {\n\t\t\t\t\t\t\tselectAllCheckbox.find('input').prop('checked', false);\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselectAll();\n\t\t\t\t\t\t}\n\t\t\t\t\t}) : $(),\n\t\t\t\t\n\t\t\t\trestm = null,\n\t\t\t\tresize = function(init) {\n\t\t\t\t\tvar initHeight = function() {\n\t\t\t\t\t\tif (typeof bufferExt.renderd !== 'undefined') {\n\t\t\t\t\t\t\tvar h = 0;\n\t\t\t\t\t\t\twrapper.siblings('div.elfinder-panel:visible').each(function() {\n\t\t\t\t\t\t\t\th += $(this).outerHeight(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\twrapper.height(wz.height() - h - wrapper._padding);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tinit && initHeight();\n\t\t\t\t\t\n\t\t\t\t\trestm && cancelAnimationFrame(restm);\n\t\t\t\t\trestm = requestAnimationFrame(function(){\n\t\t\t\t\t\t!init && initHeight();\n\t\t\t\t\t\tvar wph, cwdoh;\n\t\t\t\t\t\t// fix cwd height if it less then wrapper\n\t\t\t\t\t\tcwd.css('height', 'auto');\n\t\t\t\t\t\twph = wrapper[0].clientHeight - parseInt(wrapper.css('padding-top')) - parseInt(wrapper.css('padding-bottom')) - parseInt(cwd.css('margin-top')),\n\t\t\t\t\t\tcwdoh = cwd.outerHeight(true);\n\t\t\t\t\t\tif (cwdoh < wph) {\n\t\t\t\t\t\t\tcwd.height(wph);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tlist && ! colResizing && (init? wrapper.trigger('resize.fixheader') : fixTableHeader());\n\t\t\t\t\t\n\t\t\t\t\twrapperRepaint();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t// elfinder node\n\t\t\t\tparent = $(this).parent().on('resize', resize),\n\t\t\t\t\n\t\t\t\t// workzone node \n\t\t\t\twz = parent.children('.elfinder-workzone').append(wrapper.append(this).append(bottomMarker)),\n\t\t\t\t\n\t\t\t\t// message board\n\t\t\t\tmBoard = $('<div class=\"elfinder-cwd-message-board\"/>').insertAfter(cwd),\n\n\t\t\t\t// Volume expires\n\t\t\t\tvExpires = $('<div class=\"elfinder-cwd-expires\" />'),\n\n\t\t\t\tvExpiresTm,\n\n\t\t\t\tshowVolumeExpires = function() {\n\t\t\t\t\tvar remain, sec, int;\n\t\t\t\t\tvExpiresTm && clearTimeout(vExpiresTm);\n\t\t\t\t\tif (curVolId && fm.volumeExpires[curVolId]) {\n\t\t\t\t\t\tsec = fm.volumeExpires[curVolId] - ((+new Date()) / 1000);\n\t\t\t\t\t\tint = (sec % 60) + 0.1;\n\t\t\t\t\t\tremain = Math.floor(sec / 60);\n\t\t\t\t\t\tvExpires.html(fm.i18n(['minsLeft', remain])).show();\n\t\t\t\t\t\tif (remain) {\n\t\t\t\t\t\t\tvExpiresTm = setTimeout(showVolumeExpires, int * 1000);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// each item box size\n\t\t\t\titemBoxSize = {\n\t\t\t\t\ticons : {},\n\t\t\t\t\tlist : {}\n\t\t\t\t},\n\n\t\t\t\t// has UI tree\n\t\t\t\thasUiTree,\n\n\t\t\t\t// Icon size of icons view\n\t\t\t\ticonSize,\n\n\t\t\t\t// Current volume id\n\t\t\t\tcurVolId,\n\t\t\t\t\n\t\t\t\twinScrTm;\n\n\t\t\t// IE < 11 not support CSS `pointer-events: none`\n\t\t\tif (!fm.UA.ltIE10) {\n\t\t\t\tmBoard.append($('<div class=\"elfinder-cwd-trash\" />').html(fm.i18n('volume_Trash')))\n\t\t\t\t      .append(vExpires);\n\t\t\t}\n\n\t\t\t// setup by options\n\t\t\treplacement = Object.assign(replacement, options.replacement || {});\n\t\t\t\n\t\t\ttry {\n\t\t\t\tcolWidth = fm.storage('cwdColWidth')? fm.storage('cwdColWidth') : null;\n\t\t\t} catch(e) {\n\t\t\t\tcolWidth = null;\n\t\t\t}\n\t\t\t\n\t\t\t// setup costomCols\n\t\t\tfm.bind('columnpref', function(e) {\n\t\t\t\tvar opts = e.data || {};\n\t\t\t\tif (customCols = fm.storage('cwdCols')) {\n\t\t\t\t\tcustomCols = $.grep(customCols, function(n) {\n\t\t\t\t\t\treturn (options.listView.columns.indexOf(n) !== -1)? true : false;\n\t\t\t\t\t});\n\t\t\t\t\tif (options.listView.columns.length > customCols.length) {\n\t\t\t\t\t\t$.each(options.listView.columns, function(i, n) {\n\t\t\t\t\t\t\tif (customCols.indexOf(n) === -1) {\n\t\t\t\t\t\t\t\tcustomCols.push(n);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcustomCols = options.listView.columns;\n\t\t\t\t}\n\t\t\t\t// column names array that hidden\n\t\t\t\tvar columnhides = fm.storage('columnhides') || null;\n\t\t\t\tif (columnhides && Object.keys(columnhides).length)\n\t\t\t\tcustomCols = $.grep(customCols, function(n) {\n\t\t\t\t\treturn columnhides[n]? false : true;\n\t\t\t\t});\n\t\t\t\t// make template with customCols\n\t\t\t\ttemplates.row = makeTemplateRow();\n\t\t\t\t// repaint if need it\n\t\t\t\tlist && opts.repaint && content();\n\t\t\t}).trigger('columnpref');\n\n\t\t\tif (mobile) {\n\t\t\t\t// for iOS5 bug\n\t\t\t\t$('body').on('touchstart touchmove touchend', function(e){});\n\t\t\t}\n\t\t\t\n\t\t\tselectCheckbox && cwd.addClass('elfinder-has-checkbox');\n\t\t\t\n\t\t\t$(window).on('scroll.'+fm.namespace, function() {\n\t\t\t\twinScrTm && cancelAnimationFrame(winScrTm);\n\t\t\t\twinScrTm = requestAnimationFrame(function() {\n\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\t$(document).on('keydown.'+fm.namespace, function(e) {\n\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\n\t\t\t\t\tif (! fm.getUI().find('.ui-widget:visible').length) {\n\t\t\t\t\t\tunselectAll();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tfm\n\t\t\t\t.one('init', function(){\n\t\t\t\t\tvar style = document.createElement('style'),\n\t\t\t\t\tsheet, node, base, resizeTm, iconSize, i = 0;\n\t\t\t\t\tif (document.head) {\n\t\t\t\t\t\tdocument.head.appendChild(style);\n\t\t\t\t\t\tsheet = style.sheet;\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyFolder')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty .native-droppable .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyFolder'+(mobile? 'LTap' : 'Drop'))+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty .ui-droppable-disabled .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyFolder')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptySearch')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-incsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyIncSearch')+'\" }', i++);\n\t\t\t\t\t\tsheet.insertRule('.elfinder-cwd-wrapper-empty.elfinder-search-result.elfinder-letsearch-result .elfinder-cwd:not(.elfinder-table-header-sticky):after{ content:\"'+fm.i18n('emptyLetSearch')+'\" }', i++);\n\t\t\t\t\t}\n\t\t\t\t\tif (iconSize = (fm.storage('iconsize') || options.iconsView.size || 0)) {\n\t\t\t\t\t\ticonSize = Math.min(iconSize, options.iconsView.sizeMax);\n\t\t\t\t\t\tcwd.trigger('iconpref', {size: iconSize});\n\t\t\t\t\t}\n\t\t\t\t\tif (! mobile) {\n\t\t\t\t\t\tfm.one('open', function() {\n\t\t\t\t\t\t\tsheet && fm.zIndex && sheet.insertRule('.ui-selectable-helper{z-index:'+fm.zIndex+';}', i++);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbase = $('<div style=\"position:absolute\"/>');\n\t\t\t\t\t\tnode = fm.getUI();\n\t\t\t\t\t\tnode.on('resize', function(e, data) {\n\t\t\t\t\t\t\tvar offset;\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tif (data && data.fullscreen) {\n\t\t\t\t\t\t\t\toffset = node.offset();\n\t\t\t\t\t\t\t\tif (data.fullscreen === 'on') {\n\t\t\t\t\t\t\t\t\tbase.css({top:offset.top * -1 , left:offset.left * -1 }).appendTo(node);\n\t\t\t\t\t\t\t\t\tselectableOption.appendTo = base;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tbase.detach();\n\t\t\t\t\t\t\t\t\tselectableOption.appendTo = 'body';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcwd.data('selectable') && cwd.selectable('option', {appendTo : selectableOption.appendTo});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\thasUiTree = fm.getUI('tree').length;\n\t\t\t\t})\n\t\t\t\t.bind('enable', function() {\n\t\t\t\t\tresize();\n\t\t\t\t})\n\t\t\t\t.bind('request.open', function() {\n\t\t\t\t\tbufferExt.getTmbs = [];\n\t\t\t\t})\n\t\t\t\t.one('open', function() {\n\t\t\t\t\tif (fm.maxTargets) {\n\t\t\t\t\t\ttmbNum = Math.min(fm.maxTargets, tmbNum);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('open add remove searchend', function() {\n\t\t\t\t\tvar phash = fm.cwd().hash,\n\t\t\t\t\t\ttype = this.type;\n\t\t\t\t\tif (type === 'open' || type === 'searchend' || fm.searchStatus.state < 2) {\n\t\t\t\t\t\tcwdHashes = $.map(fm.files(phash), function(f) { return f.hash; });\n\t\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t}\n\t\t\t\t\tif (type === 'open') {\n\t\t\t\t\t\tvar inTrash = function() {\n\t\t\t\t\t\t\t\tvar isIn = false;\n\t\t\t\t\t\t\t\t$.each(cwdParents, function(i, h) {\n\t\t\t\t\t\t\t\t\tif (fm.trashes[h]) {\n\t\t\t\t\t\t\t\t\t\tisIn = true;\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn isIn;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treq = phash?\n\t\t\t\t\t\t\t\t(! fm.file(phash) || hasUiTree?\n\t\t\t\t\t\t\t\t\t(! hasUiTree?\n\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\tcmd    : 'parents',\n\t\t\t\t\t\t\t\t\t\t\t\ttarget : fm.cwd().hash\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t\t\t}) : (function() {\n\t\t\t\t\t\t\t\t\t\t\tvar dfd = $.Deferred();\n\t\t\t\t\t\t\t\t\t\t\tfm.one('treesync', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\te.data.always(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t\t\t\t\t\t})()\n\t\t\t\t\t\t\t\t\t) : null\n\t\t\t\t\t\t\t\t) : null,\n\t\t\t\t\t\t\tcwdObj = fm.cwd();\n\t\t\t\t\t\t// add/remove volume id class\n\t\t\t\t\t\tif (cwdObj.volumeid !== curVolId) {\n\t\t\t\t\t\t\tvExpires.empty().hide();\n\t\t\t\t\t\t\tif (curVolId) {\n\t\t\t\t\t\t\t\twrapper.removeClass('elfinder-cwd-wrapper-' + curVolId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcurVolId = cwdObj.volumeid;\n\t\t\t\t\t\t\tshowVolumeExpires();\n\t\t\t\t\t\t\twrapper.addClass('elfinder-cwd-wrapper-' + curVolId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// add/remove trash class\n\t\t\t\t\t\t$.when(req).done(function() {\n\t\t\t\t\t\t\tcwdParents = fm.parents(cwdObj.hash);\n\t\t\t\t\t\t\twrapper[inTrash()? 'addClass':'removeClass']('elfinder-cwd-wrapper-trash');\n\t\t\t\t\t\t});\n\t\t\t\t\t\tincHashes = void 0;\n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('search', function(e) {\n\t\t\t\t\tcwdHashes = $.map(e.data.files, function(f) { return f.hash; });\n\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\tincHashes = void 0;\n\t\t\t\t\tfm.searchStatus.ininc = false;\n\t\t\t\t\tcontent();\n\t\t\t\t\tfm.autoSync('stop');\n\t\t\t\t})\n\t\t\t\t.bind('searchend', function(e) {\n\t\t\t\t\tif (query || incHashes) {\n\t\t\t\t\t\tquery = '';\n\t\t\t\t\t\tif (incHashes) {\n\t\t\t\t\t\t\tfm.trigger('incsearchend', e.data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!e.data || !e.data.noupdate) {\n\t\t\t\t\t\t\t\tcontent();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfm.autoSync();\n\t\t\t\t})\n\t\t\t\t.bind('searchstart', function(e) {\n\t\t\t\t\tunselectAll();\n\t\t\t\t\tquery = e.data.query;\n\t\t\t\t})\n\t\t\t\t.bind('incsearchstart', function(e) {\n\t\t\t\t\tvar q = e.data.query || '',\n\t\t\t\t\t\ttype =  e.data.type || 'SearchName',\n\t\t\t\t\t\tsearchTypes = fm.options.commandsOptions.search.searchTypes || {};\n\n\t\t\t\t\tif ((searchTypes[type] && searchTypes[type].incsearch) || type === 'SearchName') {\n\t\t\t\t\t\tselectedFiles = {};\n\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t// incremental search\n\t\t\t\t\t\t\tvar regex, incSearch, fst = '';\n\t\t\t\t\t\t\tquery = q;\n\t\t\t\t\t\t\tif (q) {\n\t\t\t\t\t\t\t\tif (q.substr(0,1) === '/') {\n\t\t\t\t\t\t\t\t\tq = q.substr(1);\n\t\t\t\t\t\t\t\t\tfst = '^';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tregex = new RegExp(fst + q.replace(/([\\\\*\\;\\.\\?\\[\\]\\{\\}\\(\\)\\^\\$\\-\\|])/g, '\\\\$1'), 'i');\n\t\t\t\t\t\t\t\tif (type === 'SearchName') {\n\t\t\t\t\t\t\t\t\tincHashes = $.grep(cwdHashes, function(hash) {\n\t\t\t\t\t\t\t\t\t\tvar file = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\treturn (file && (file.name.match(regex) || (file.i18 && file.i18.match(regex))))? true : false;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tincSearch = searchTypes[type].incsearch;\n\t\t\t\t\t\t\t\t\tif (typeof incSearch === 'string') {\n\t\t\t\t\t\t\t\t\t\tincHashes = $.grep(cwdHashes, function(hash) {\n\t\t\t\t\t\t\t\t\t\t\tvar file = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\t\treturn (file && file[incSearch] && (file[incSearch] + '').match(regex))? true : false;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (typeof incSearch === 'function') {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tincHashes = $.grep(incSearch({val: q, regex: regex}, cwdHashes, fm), function(hash) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn fm.file(hash)? true : false;\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\t\tincHashes = [];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.trigger('incsearch', { hashes: incHashes, query: q })\n\t\t\t\t\t\t\t\t\t.searchStatus.ininc = true;\n\t\t\t\t\t\t\t\tcontent();\n\t\t\t\t\t\t\t\tfm.autoSync('stop');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.trigger('incsearchend');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('incsearchend', function(e) {\n\t\t\t\t\tquery = '';\n\t\t\t\t\tfm.searchStatus.ininc = false;\n\t\t\t\t\tincHashes = void 0;\n\t\t\t\t\tif (!e.data || !e.data.noupdate) {\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t}\n\t\t\t\t\tfm.autoSync();\n\t\t\t\t})\n\t\t\t\t.bind('sortchange', function() {\n\t\t\t\t\tvar lastScrollLeft = wrapper.scrollLeft(),\n\t\t\t\t\t\tallsel = cwd.hasClass('elfinder-cwd-allselected');\n\t\t\t\t\t\n\t\t\t\t\tcontent();\n\t\t\t\t\tfm.one('cwdrender', function() {\n\t\t\t\t\t\twrapper.scrollLeft(lastScrollLeft);\n\t\t\t\t\t\tif (allsel) {\n\t\t\t\t\t\t\tselectedFiles = fm.arrayFlip(incHashes || cwdHashes, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t(allsel || Object.keys(selectedFiles).length) && trigger();\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.bind('viewchange', function() {\n\t\t\t\t\tvar l      = fm.viewType != 'list',\n\t\t\t\t\t\tallsel = cwd.hasClass('elfinder-cwd-allselected');\n\t\t\t\t\t\n\t\t\t\t\tif (l != list) {\n\t\t\t\t\t\tlist = l;\n\t\t\t\t\t\tfm.viewType = list? 'list' : 'icons';\n\t\t\t\t\t\tif (iconSize) {\n\t\t\t\t\t\t\tfm.one('cwdinit', function() {\n\t\t\t\t\t\t\t\tcwd.trigger('iconpref', {size: iconSize});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontent();\n\t\t\t\t\t\tresize();\n\n\t\t\t\t\t\tif (allsel) {\n\t\t\t\t\t\t\tcwd.addClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\tselectAllCheckbox.find('input').prop('checked', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tObject.keys(selectedFiles).length && trigger();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('wzresize', function() {\n\t\t\t\t\tvar place = list ? cwd.find('tbody') : cwd,\n\t\t\t\t\t\tcwdOffset;\n\t\t\t\t\tresize(true);\n\t\t\t\t\tif (bufferExt.hpi) {\n\t\t\t\t\t\tbottomMarkerShow(place, place.find('[id]').length);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcwdOffset = cwd.offset();\n\t\t\t\t\twz.data('rectangle', Object.assign(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidth: wz.width(),\n\t\t\t\t\t\t\theight: wz.height(),\n\t\t\t\t\t\t\tcwdEdge: (fm.direction === 'ltr')? cwdOffset.left : cwdOffset.left + cwd.width()\n\t\t\t\t\t\t},\n\t\t\t\t\t\twz.offset())\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tbufferExt.itemH = (list? place.find('tr:first') : place.find('[id]:first')).outerHeight(true);\n\t\t\t\t})\n\t\t\t\t.bind('changeclipboard', function(e) {\n\t\t\t\t\tclipCuts = {};\n\t\t\t\t\tif (e.data && e.data.clipboard && e.data.clipboard.length) {\n\t\t\t\t\t\t$.each(e.data.clipboard, function(i, f) {\n\t\t\t\t\t\t\tif (f.cut) {\n\t\t\t\t\t\t\t\tclipCuts[f.hash] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('resMixinMake', function() {\n\t\t\t\t\tsetColwidth();\n\t\t\t\t})\n\t\t\t\t.bind('tmbreload', function(e) {\n\t\t\t\t\tvar imgs = {},\n\t\t\t\t\t\tfiles = (e.data && e.data.files)? e.data.files : null;\n\t\t\t\t\t\n\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\tif (f.tmb && f.tmb != '1') {\n\t\t\t\t\t\t\timgs[f.hash] = f.tmb;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (Object.keys(imgs).length) {\n\t\t\t\t\t\tattachThumbnails(imgs, true);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.add(function(e) {\n\t\t\t\t\tvar regex = query? new RegExp(query.replace(/([\\\\*\\;\\.\\?\\[\\]\\{\\}\\(\\)\\^\\$\\-\\|])/g, '\\\\$1'), 'i') : null,\n\t\t\t\t\t\tmime  = fm.searchStatus.mime,\n\t\t\t\t\t\tinSearch = fm.searchStatus.state > 1,\n\t\t\t\t\t\tphash = inSearch && fm.searchStatus.target? fm.searchStatus.target : fm.cwd().hash,\n\t\t\t\t\t\tcurPath = fm.path(phash),\n\t\t\t\t\t\tinTarget = function(f) {\n\t\t\t\t\t\t\tvar res, parents, path;\n\t\t\t\t\t\t\tres = (f.phash === phash);\n\t\t\t\t\t\t\tif (!res && inSearch) {\n\t\t\t\t\t\t\t\tpath = f.path || fm.path(f.hash);\n\t\t\t\t\t\t\t\tres = (curPath && path.indexOf(curPath) === 0);\n\t\t\t\t\t\t\t\tif (! res && fm.searchStatus.mixed) {\n\t\t\t\t\t\t\t\t\tres = $.grep(fm.searchStatus.mixed, function(vid) { return f.hash.indexOf(vid) === 0? true : false; }).length? true : false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (res && inSearch) {\n\t\t\t\t\t\t\t\tif (mime) {\n\t\t\t\t\t\t\t\t\tres = (f.mime.indexOf(mime) === 0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tres = (f.name.match(regex) || (f.i18 && f.i18.match(regex)))? true : false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfiles = $.grep(e.data.added || [], function(f) { return inTarget(f)? true : false ;});\n\t\t\t\t\tadd(files);\n\t\t\t\t\tif (fm.searchStatus.state === 2) {\n\t\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\t\tif ($.inArray(f.hash, cwdHashes) === -1) {\n\t\t\t\t\t\t\t\tcwdHashes.push(f.hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t}\n\t\t\t\t\tlist && resize();\n\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t})\n\t\t\t\t.change(function(e) {\n\t\t\t\t\tvar phash = fm.cwd().hash,\n\t\t\t\t\t\tsel   = fm.selected(),\n\t\t\t\t\t\tfiles, added;\n\n\t\t\t\t\tif (query) {\n\t\t\t\t\t\t$.each(e.data.changed || [], function(i, file) {\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(file.hash).length) {\n\t\t\t\t\t\t\t\tremove([file.hash]);\n\t\t\t\t\t\t\t\tadd([file], 'change');\n\t\t\t\t\t\t\t\t$.inArray(file.hash, sel) !== -1 && selectFile(file.hash);\n\t\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.each($.grep(e.data.changed || [], function(f) { return f.phash == phash ? true : false; }), function(i, file) {\n\t\t\t\t\t\t\tif (fm.cwdHash2Elm(file.hash).length) {\n\t\t\t\t\t\t\t\tremove([file.hash]);\n\t\t\t\t\t\t\t\tadd([file], 'change');\n\t\t\t\t\t\t\t\t$.inArray(file.hash, sel) !== -1 && selectFile(file.hash);\n\t\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (added) {\n\t\t\t\t\t\tfm.trigger('cwdhasheschange', cwdHashes);\n\t\t\t\t\t\tlist && resize();\n\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\ttrigger();\n\t\t\t\t})\n\t\t\t\t.remove(function(e) {\n\t\t\t\t\tvar place = list ? cwd.find('tbody') : cwd;\n\t\t\t\t\tremove(e.data.removed || []);\n\t\t\t\t\ttrigger();\n\t\t\t\t\tif (buffer.length < 1 && place.children(fileSelector + (options.oldSchool? ':not(.elfinder-cwd-parent)' : '')).length < 1) {\n\t\t\t\t\t\twz.addClass('elfinder-cwd-wrapper-empty');\n\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.find('input').prop('checked', false);\n\t\t\t\t\t\tbottomMarker.hide();\n\t\t\t\t\t\twrapper.off(scrollEvent, render);\n\t\t\t\t\t\tresize();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbottomMarkerShow(place);\n\t\t\t\t\t\twrapper.trigger(scrollEvent);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// select dragged file if no selected, disable selectable\n\t\t\t\t.dragstart(function(e) {\n\t\t\t\t\tvar target = $(e.data.target),\n\t\t\t\t\t\toe     = e.data.originalEvent;\n\n\t\t\t\t\tif (target.hasClass(clFile)) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!target.hasClass(clSelected)) {\n\t\t\t\t\t\t\t!(oe.ctrlKey || oe.metaKey || oe.shiftKey) && unselectAll({ notrigger: true });\n\t\t\t\t\t\t\ttarget.trigger(evtSelect);\n\t\t\t\t\t\t\ttrigger();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcwd.removeClass(clDisabled).data('selectable') && cwd.selectable('disable');\n\t\t\t\t\tselectLock = true;\n\t\t\t\t})\n\t\t\t\t// enable selectable\n\t\t\t\t.dragstop(function() {\n\t\t\t\t\tcwd.data('selectable') && cwd.selectable('enable');\n\t\t\t\t\tselectLock = false;\n\t\t\t\t})\n\t\t\t\t.bind('lockfiles unlockfiles selectfiles unselectfiles', function(e) {\n\t\t\t\t\tvar events = {\n\t\t\t\t\t\t\tlockfiles     : evtDisable ,\n\t\t\t\t\t\t\tunlockfiles   : evtEnable ,\n\t\t\t\t\t\t\tselectfiles   : evtSelect,\n\t\t\t\t\t\t\tunselectfiles : evtUnselect },\n\t\t\t\t\t\tevent  = events[e.type],\n\t\t\t\t\t\tfiles  = e.data.files || [],\n\t\t\t\t\t\tl      = files.length,\n\t\t\t\t\t\thelper = e.data.helper || $(),\n\t\t\t\t\t\tparents, ctr, add;\n\n\t\t\t\t\tif (l > 0) {\n\t\t\t\t\t\tparents = fm.parents(files[0]);\n\t\t\t\t\t}\n\t\t\t\t\tif (event === evtSelect || event === evtUnselect) {\n\t\t\t\t\t\tadd  = (event === evtSelect),\n\t\t\t\t\t\t$.each(files, function(i, hash) {\n\t\t\t\t\t\t\tvar all = cwd.hasClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\tif (! selectedFiles[hash]) {\n\t\t\t\t\t\t\t\tadd && (selectedFiles[hash] = true);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (all) {\n\t\t\t\t\t\t\t\t\tselectCheckbox && selectAllCheckbox.children('input').prop('checked', false);\n\t\t\t\t\t\t\t\t\tcwd.removeClass('elfinder-cwd-allselected');\n\t\t\t\t\t\t\t\t\tall = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t! add && delete selectedFiles[hash];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (!helper.data('locked')) {\n\t\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tfm.cwdHash2Elm(files[l]).trigger(event);\n\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t! e.data.inselect && trigger();\n\t\t\t\t\t}\n\t\t\t\t\tif (wrapper.data('dropover') && parents.indexOf(wrapper.data('dropover')) !== -1) {\n\t\t\t\t\t\tctr = e.type !== 'lockfiles';\n\t\t\t\t\t\thelper.toggleClass('elfinder-drag-helper-plus', ctr);\n\t\t\t\t\t\twrapper.toggleClass(clDropActive, ctr);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// select new files after some actions\n\t\t\t\t.bind('mkdir mkfile duplicate upload rename archive extract paste multiupload', function(e) {\n\t\t\t\t\tif (e.type == 'upload' && e.data._multiupload) return;\n\t\t\t\t\tvar phash = fm.cwd().hash, files;\n\t\t\t\t\t\n\t\t\t\t\tunselectAll({ notrigger: true });\n\n\t\t\t\t\t$.each((e.data.added || []).concat(e.data.changed || []), function(i, file) { \n\t\t\t\t\t\tfile && file.phash == phash && selectFile(file.hash);\n\t\t\t\t\t});\n\t\t\t\t\ttrigger();\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     :'ctrl+a', \n\t\t\t\t\tdescription : 'selectall',\n\t\t\t\t\tcallback    : selectAll\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     :'ctrl+shift+i', \n\t\t\t\t\tdescription : 'selectinvert',\n\t\t\t\t\tcallback    : selectInvert\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'left right up down shift+left shift+right shift+up shift+down',\n\t\t\t\t\tdescription : 'selectfiles',\n\t\t\t\t\ttype        : 'keydown' , //fm.UA.Firefox || fm.UA.Opera ? 'keypress' : 'keydown',\n\t\t\t\t\tcallback    : function(e) { select(e.keyCode, e.shiftKey); }\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'home',\n\t\t\t\t\tdescription : 'selectffile',\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tscrollToView(cwd.find('[id]:first').trigger(evtSelect));\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'end',\n\t\t\t\t\tdescription : 'selectlfile',\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tunselectAll({ notrigger: true });\n\t\t\t\t\t\tscrollToView(cwd.find('[id]:last').trigger(evtSelect)) ;\n\t\t\t\t\t\ttrigger();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'page_up',\n\t\t\t\t\tdescription : 'pageTurning',\n\t\t\t\t\tcallback    : function(e) {\n\t\t\t\t\t\tif (bufferExt.itemH) {\n\t\t\t\t\t\t\twrapper.scrollTop(\n\t\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\t\twrapper.scrollTop()\n\t\t\t\t\t\t\t\t\t- (Math.floor((wrapper.height() + (list? bufferExt.itemH * -1 : 16)) / bufferExt.itemH)) * bufferExt.itemH\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).shortcut({\n\t\t\t\t\tpattern     : 'page_down',\n\t\t\t\t\tdescription : 'pageTurning',\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tif (bufferExt.itemH) {\n\t\t\t\t\t\t\twrapper.scrollTop(\n\t\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\t\twrapper.scrollTop()\n\t\t\t\t\t\t\t\t\t+ (Math.floor((wrapper.height() + (list? bufferExt.itemH * -1 : 16)) / bufferExt.itemH)) * bufferExt.itemH\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t});\n\t\t\n\t\t// fm.timeEnd('cwdLoad')\n\t\t\n\t\treturn this;\n\t};\n\n});\ndefine('skylark-elfinder/ui/dialog',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder dialog\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderdialog = function(opts, fm) {\n\t\t\"use strict\";\n\t\tvar platformWin = (window.navigator.platform.indexOf('Win') != -1),\n\t\t\tdelta       = {},\n\t\t\tsyncSize    = { enabled: false, width: false, height: false, defaultSize: null },\n\t\t\tfitSize     = function(dialog) {\n\t\t\t\tvar opts, node;\n\t\t\t\tif (syncSize.enabled) {\n\t\t\t\t\tnode = fm.options.dialogContained? elfNode : $(window);\n\t\t\t\t\topts = {\n\t\t\t\t\t\tmaxWidth : syncSize.width?  node.width() - delta.width  : null,\n\t\t\t\t\t\tmaxHeight: syncSize.height? node.height() - delta.height : null\n\t\t\t\t\t};\n\t\t\t\t\tObject.assign(restoreStyle, opts);\n\t\t\t\t\tdialog.css(opts).trigger('resize');\n\t\t\t\t\tif (dialog.data('hasResizable') && (dialog.resizable('option', 'maxWidth') < opts.maxWidth || dialog.resizable('option', 'maxHeight') < opts.maxHeight)) {\n\t\t\t\t\t\tdialog.resizable('option', opts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tsyncFunc    = function(e) {\n\t\t\t\tvar dialog = e.data;\n\t\t\t\tsyncTm && cancelAnimationFrame(syncTm);\n\t\t\t\tsyncTm = requestAnimationFrame(function() {\n\t\t\t\t\tvar opts, offset;\n\t\t\t\t\tif (syncSize.enabled) {\n\t\t\t\t\t\tfitSize(dialog);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tcheckEditing = function() {\n\t\t\t\tvar cldialog = 'elfinder-dialog',\n\t\t\t\t\tdialogs = elfNode.children('.' + cldialog + '.' + fm.res('class', 'editing') + ':visible');\n\t\t\t\tfm[dialogs.length? 'disable' : 'enable']();\n\t\t\t},\n\t\t\tpropagationEvents = {},\n\t\t\tsyncTm, dialog, elfNode, restoreStyle;\n\t\t\n\t\tif (fm && fm.ui) {\n\t\t\telfNode = fm.getUI();\n\t\t} else {\n\t\t\telfNode = this.closest('.elfinder');\n\t\t\tif (! fm) {\n\t\t\t\tfm = elfNode.elfinder('instance');\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (typeof opts  === 'string') {\n\t\t\tif ((dialog = this.closest('.ui-dialog')).length) {\n\t\t\t\tif (opts === 'open') {\n\t\t\t\t\tif (dialog.css('display') === 'none') {\n\t\t\t\t\t\t// Need dialog.show() and hide() to detect elements size in open() callbacks\n\t\t\t\t\t\tdialog.trigger('posinit').show().trigger('open').hide();\n\t\t\t\t\t\tdialog.fadeIn(120, function() {\n\t\t\t\t\t\t\tfm.trigger('dialogopened', {dialog: dialog});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else if (opts === 'close' || opts === 'destroy') {\n\t\t\t\t\tdialog.stop(true);\n\t\t\t\t\tif (dialog.is(':visible') || elfNode.is(':hidden')) {\n\t\t\t\t\t\tdialog.trigger('close');\n\t\t\t\t\t\tfm.trigger('dialogclosed', {dialog: dialog});\n\t\t\t\t\t}\n\t\t\t\t\tif (opts === 'destroy') {\n\t\t\t\t\t\tdialog.remove();\n\t\t\t\t\t\tfm.trigger('dialogremoved', {dialog: dialog});\n\t\t\t\t\t} else if (dialog.data('minimized')) {\n\t\t\t\t\t\tdialog.data('minimized').close();\n\t\t\t\t\t}\n\t\t\t\t} else if (opts === 'toTop') {\n\t\t\t\t\tdialog.trigger('totop');\n\t\t\t\t\tfm.trigger('dialogtotoped', {dialog: dialog});\n\t\t\t\t} else if (opts === 'posInit') {\n\t\t\t\t\tdialog.trigger('posinit');\n\t\t\t\t\tfm.trigger('dialogposinited', {dialog: dialog});\n\t\t\t\t} else if (opts === 'tabstopsInit') {\n\t\t\t\t\tdialog.trigger('tabstopsInit');\n\t\t\t\t\tfm.trigger('dialogtabstopsinited', {dialog: dialog});\n\t\t\t\t} else if (opts === 'checkEditing') {\n\t\t\t\t\tcheckEditing();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\t\t\n\t\topts = Object.assign({}, $.fn.elfinderdialog.defaults, opts);\n\t\t\n\t\tif (opts.allowMinimize && opts.allowMinimize === 'auto') {\n\t\t\topts.allowMinimize = this.find('textarea,input').length? true : false; \n\t\t}\n\t\topts.openMaximized = opts.allowMinimize && opts.openMaximized;\n\t\tif (opts.headerBtnPos && opts.headerBtnPos === 'auto') {\n\t\t\topts.headerBtnPos = platformWin? 'right' : 'left';\n\t\t}\n\t\tif (opts.headerBtnOrder && opts.headerBtnOrder === 'auto') {\n\t\t\topts.headerBtnOrder = platformWin? 'close:maximize:minimize' : 'close:minimize:maximize';\n\t\t}\n\t\t\n\t\tif (opts.modal && opts.allowMinimize) {\n\t\t\topts.allowMinimize = false;\n\t\t}\n\t\t\n\t\tif (fm.options.dialogContained) {\n\t\t\tsyncSize.width = syncSize.height = syncSize.enabled = true;\n\t\t} else {\n\t\t\tsyncSize.width = (opts.maxWidth === 'window');\n\t\t\tsyncSize.height = (opts.maxHeight === 'window');\n\t\t\tif (syncSize.width || syncSize.height) {\n\t\t\t\tsyncSize.enabled = true;\n\t\t\t}\n\t\t}\n\n\t\tpropagationEvents = fm.arrayFlip(opts.propagationEvents, true);\n\t\t\n\t\tthis.filter(':not(.ui-dialog-content)').each(function() {\n\t\t\tvar self       = $(this).addClass('ui-dialog-content ui-widget-content'),\n\t\t\t\tclactive   = 'elfinder-dialog-active',\n\t\t\t\tcldialog   = 'elfinder-dialog',\n\t\t\t\tclnotify   = 'elfinder-dialog-notify',\n\t\t\t\tclhover    = 'ui-state-hover',\n\t\t\t\tcltabstop  = 'elfinder-tabstop',\n\t\t\t\tcl1stfocus = 'elfinder-focus',\n\t\t\t\tclmodal    = 'elfinder-dialog-modal',\n\t\t\t\tid         = parseInt(Math.random()*1000000),\n\t\t\t\ttitlebar   = $('<div class=\"ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix\"><span class=\"elfinder-dialog-title\">'+opts.title+'</span></div>'),\n\t\t\t\tbuttonset  = $('<div class=\"ui-dialog-buttonset\"/>'),\n\t\t\t\tbuttonpane = $('<div class=\" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content\"/>')\n\t\t\t\t\t.append(buttonset),\n\t\t\t\tbtnWidth   = 0,\n\t\t\t\tbtnCnt     = 0,\n\t\t\t\ttabstops   = $(),\n\t\t\t\tevCover    = $('<div style=\"width:100%;height:100%;position:absolute;top:0px;left:0px;\"/>').hide(),\n\t\t\t\tnumberToTel = function() {\n\t\t\t\t\tif (opts.optimizeNumber) {\n\t\t\t\t\t\tdialog.find('input[type=number]').each(function() {\n\t\t\t\t\t\t\t$(this).attr('inputmode', 'numeric');\n\t\t\t\t\t\t\t$(this).attr('pattern', '[0-9]*');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttabstopsInit = function() {\n\t\t\t\t\ttabstops = dialog.find('.'+cltabstop);\n\t\t\t\t\tif (tabstops.length) {\n\t\t\t\t\t\ttabstops.attr('tabindex', '-1');\n\t\t\t\t\t\tif (! tabstops.filter('.'+cl1stfocus).length) {\n\t\t\t\t\t\t\tbuttonset.children('.'+cltabstop+':'+(platformWin? 'first' : 'last')).addClass(cl1stfocus);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttabstopNext = function(cur) {\n\t\t\t\t\tvar elms = tabstops.filter(':visible:enabled'),\n\t\t\t\t\t\tnode = cur? null : elms.filter('.'+cl1stfocus+':first');\n\t\t\t\t\t\t\n\t\t\t\t\tif (! node || ! node.length) {\n\t\t\t\t\t\tnode = elms.first();\n\t\t\t\t\t}\n\t\t\t\t\tif (cur) {\n\t\t\t\t\t\t$.each(elms, function(i, elm) {\n\t\t\t\t\t\t\tif (elm === cur && elms[i+1]) {\n\t\t\t\t\t\t\t\tnode = elms.eq(i+1);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\ttabstopPrev = function(cur) {\n\t\t\t\t\tvar elms = tabstops.filter(':visible:enabled'),\n\t\t\t\t\t\tnode = elms.last();\n\t\t\t\t\t$.each(elms, function(i, elm) {\n\t\t\t\t\t\tif (elm === cur && elms[i-1]) {\n\t\t\t\t\t\t\tnode = elms.eq(i-1);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\tmakeHeaderBtn = function() {\n\t\t\t\t\t$.each(opts.headerBtnOrder.split(':').reverse(), function(i, v) {\n\t\t\t\t\t\theaderBtns[v] && headerBtns[v]();\n\t\t\t\t\t});\n\t\t\t\t\tif (platformWin) {\n\t\t\t\t\t\ttitlebar.children('.elfinder-titlebar-button').addClass('elfinder-titlebar-button-right');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\theaderBtns = {\n\t\t\t\t\tclose: function() {\n\t\t\t\t\t\ttitlebar.prepend($('<span class=\"ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button\"><span class=\"ui-icon ui-icon-closethick\"/></span>')\n\t\t\t\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tself.elfinderdialog('close');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tmaximize: function() {\n\t\t\t\t\t\tif (opts.allowMaximize) {\n\t\t\t\t\t\t\tdialog.on('resize', function(e, data) {\n\t\t\t\t\t\t\t\tvar full, elm;\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tif (data && data.maximize) {\n\t\t\t\t\t\t\t\t\telm = titlebar.find('.elfinder-titlebar-full');\n\t\t\t\t\t\t\t\t\tfull = (data.maximize === 'on');\n\t\t\t\t\t\t\t\t\telm.children('span.ui-icon')\n\t\t\t\t\t\t\t\t\t\t.toggleClass('ui-icon-plusthick', ! full)\n\t\t\t\t\t\t\t\t\t\t.toggleClass('ui-icon-arrowreturnthick-1-s', full);\n\t\t\t\t\t\t\t\t\tif (full) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tdialog.hasClass('ui-draggable') && dialog.draggable('disable');\n\t\t\t\t\t\t\t\t\t\t\tdialog.hasClass('ui-resizable') && dialog.resizable('disable');\n\t\t\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t\t\t\tself.css('width', '100%').css('height', dialog.height() - dialog.children('.ui-dialog-titlebar').outerHeight(true) - buttonpane.outerHeight(true));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tself.attr('style', elm.data('style'));\n\t\t\t\t\t\t\t\t\t\telm.removeData('style');\n\t\t\t\t\t\t\t\t\t\tposCheck();\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tdialog.hasClass('ui-draggable') && dialog.draggable('enable');\n\t\t\t\t\t\t\t\t\t\t\tdialog.hasClass('ui-resizable') && dialog.resizable('enable');\n\t\t\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdialog.trigger('resize', {init: true});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\ttitlebar.prepend($('<span class=\"ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-full\"><span class=\"ui-icon ui-icon-plusthick\"/></span>')\n\t\t\t\t\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\t\t\t\t\tvar elm = $(this);\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\tif (!dialog.hasClass('elfinder-maximized') && typeof elm.data('style') === 'undefined') {\n\t\t\t\t\t\t\t\t\t\tself.height(self.height());\n\t\t\t\t\t\t\t\t\t\telm.data('style', self.attr('style') || '');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.toggleMaximize(dialog);\n\t\t\t\t\t\t\t\t\ttypeof(opts.maximize) === 'function' && opts.maximize.call(self[0]);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t},\n\t\t\t\t\tminimize: function() {\n\t\t\t\t\t\tvar btn, mnode, doffset;\n\t\t\t\t\t\tif (opts.allowMinimize) {\n\t\t\t\t\t\t\tbtn = $('<span class=\"ui-widget-header ui-corner-all elfinder-titlebar-button elfinder-titlebar-minimize\"><span class=\"ui-icon ui-icon-minusthick\"/></span>')\n\t\t\t\t\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\t\t\t\t\tvar $this = $(this),\n\t\t\t\t\t\t\t\t\t\ttray = fm.getUI('bottomtray'),\n\t\t\t\t\t\t\t\t\t\tdumStyle = { width: 70, height: 24 },\n\t\t\t\t\t\t\t\t\t\tdum = $('<div/>').css(dumStyle).addClass(dialog.get(0).className + ' elfinder-dialog-minimized'),\n\t\t\t\t\t\t\t\t\t\tclose = function() {\n\t\t\t\t\t\t\t\t\t\t\tmnode.remove();\n\t\t\t\t\t\t\t\t\t\t\tdialog.removeData('minimized').show();\n\t\t\t\t\t\t\t\t\t\t\tself.elfinderdialog('close');\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tpos = {};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\tif (!dialog.data('minimized')) {\n\t\t\t\t\t\t\t\t\t\t// minimize\n\t\t\t\t\t\t\t\t\t\tdoffset = dialog.data('minimized', {\n\t\t\t\t\t\t\t\t\t\t\tdialog : function() { return mnode; },\n\t\t\t\t\t\t\t\t\t\t\tshow : function() { mnode.show(); },\n\t\t\t\t\t\t\t\t\t\t\thide : function() { mnode.hide(); },\n\t\t\t\t\t\t\t\t\t\t\tclose : close,\n\t\t\t\t\t\t\t\t\t\t\ttitle : function(v) { mnode.children('.ui-dialog-titlebar').children('.elfinder-dialog-title').text(v); }\n\t\t\t\t\t\t\t\t\t\t}).position();\n\t\t\t\t\t\t\t\t\t\tmnode = dialog.clone().on('mousedown', function() {\n\t\t\t\t\t\t\t\t\t\t\t$this.trigger('mousedown');\n\t\t\t\t\t\t\t\t\t\t}).removeClass('ui-draggable ui-resizable elfinder-frontmost');\n\t\t\t\t\t\t\t\t\t\ttray.append(dum);\n\t\t\t\t\t\t\t\t\t\tObject.assign(pos, dum.offset(), dumStyle);\n\t\t\t\t\t\t\t\t\t\tdum.remove();\n\t\t\t\t\t\t\t\t\t\tmnode.height(dialog.height()).children('.ui-dialog-content:first').empty();\n\t\t\t\t\t\t\t\t\t\tfm.toHide(dialog.before(mnode));\n\t\t\t\t\t\t\t\t\t\tmnode.children('.ui-dialog-content:first,.ui-dialog-buttonpane,.ui-resizable-handle').remove();\n\t\t\t\t\t\t\t\t\t\tmnode.find('.elfinder-titlebar-minimize,.elfinder-titlebar-full').remove();\n\t\t\t\t\t\t\t\t\t\tmnode.find('.ui-dialog-titlebar-close').on('mousedown', function(e) {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tmnode.animate(pos, function() {\n\t\t\t\t\t\t\t\t\t\t\tmnode.attr('style', '')\n\t\t\t\t\t\t\t\t\t\t\t.css({ maxWidth: dialog.width() })\n\t\t\t\t\t\t\t\t\t\t\t.addClass('elfinder-dialog-minimized')\n\t\t\t\t\t\t\t\t\t\t\t.appendTo(tray);\n\t\t\t\t\t\t\t\t\t\t\tcheckEditing();\n\t\t\t\t\t\t\t\t\t\t\ttypeof(opts.minimize) === 'function' && opts.minimize.call(self[0]);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t//restore\n\t\t\t\t\t\t\t\t\t\tdialog.removeData('minimized').before(mnode.css(Object.assign({'position': 'absolute'}, mnode.offset())));\n\t\t\t\t\t\t\t\t\t\tfm.toFront(mnode);\n\t\t\t\t\t\t\t\t\t\tmnode.animate(Object.assign({ width: dialog.width(), height: dialog.height() }, doffset), function() {\n\t\t\t\t\t\t\t\t\t\t\tdialog.show();\n\t\t\t\t\t\t\t\t\t\t\tfm.toFront(dialog);\n\t\t\t\t\t\t\t\t\t\t\tmnode.remove();\n\t\t\t\t\t\t\t\t\t\t\tposCheck();\n\t\t\t\t\t\t\t\t\t\t\tcheckEditing();\n\t\t\t\t\t\t\t\t\t\t\tdialog.trigger('resize', {init: true});\n\t\t\t\t\t\t\t\t\t\t\ttypeof(opts.minimize) === 'function' && opts.minimize.call(self[0]);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\ttitlebar.on('dblclick', function(e) {\n\t\t\t\t\t\t\t\t$(this).children('.elfinder-titlebar-minimize').trigger('mousedown');\n\t\t\t\t\t\t\t}).prepend(btn);\n\t\t\t\t\t\t\tdialog.on('togleminimize', function() {\n\t\t\t\t\t\t\t\tbtn.trigger('mousedown');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdialog = $('<div class=\"ui-front ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog touch-punch '+cldialog+' '+opts.cssClass+'\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.append(self)\n\t\t\t\t\t.appendTo(elfNode)\n\t\t\t\t\t.draggable({\n\t\t\t\t\t\tcontainment : fm.options.dialogContained? elfNode : null,\n\t\t\t\t\t\thandle : '.ui-dialog-titlebar',\n\t\t\t\t\t\tstart : function() {\n\t\t\t\t\t\t\tevCover.show();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdrag : function(e, ui) {\n\t\t\t\t\t\t\tvar top = ui.offset.top,\n\t\t\t\t\t\t\t\tleft = ui.offset.left;\n\t\t\t\t\t\t\tif (top < 0) {\n\t\t\t\t\t\t\t\tui.position.top = ui.position.top - top;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (left < 0) {\n\t\t\t\t\t\t\t\tui.position.left = ui.position.left - left;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (fm.options.dialogContained) {\n\t\t\t\t\t\t\t\tui.position.top < 0 && (ui.position.top = 0);\n\t\t\t\t\t\t\t\tui.position.left < 0 && (ui.position.left = 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstop : function(e, ui) {\n\t\t\t\t\t\t\tevCover.hide();\n\t\t\t\t\t\t\tdialog.css({height : opts.height});\n\t\t\t\t\t\t\tself.data('draged', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.css({\n\t\t\t\t\t\twidth     : opts.width,\n\t\t\t\t\t\theight    : opts.height,\n\t\t\t\t\t\tminWidth  : opts.minWidth,\n\t\t\t\t\t\tminHeight : opts.minHeight,\n\t\t\t\t\t\tmaxWidth  : opts.maxWidth,\n\t\t\t\t\t\tmaxHeight : opts.maxHeight\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchstart touchmove touchend click dblclick mouseup mouseenter mouseleave mouseout mouseover mousemove', function(e) {\n\t\t\t\t\t\t// stopPropagation of user action events\n\t\t\t\t\t\t!propagationEvents[e.type] && e.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\t\t!propagationEvents[e.type] && e.stopPropagation();\n\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\tif (dialog.is(':visible') && !dialog.hasClass('elfinder-frontmost')) {\n\t\t\t\t\t\t\t\ttoFocusNode = $(':focus');\n\t\t\t\t\t\t\t\tif (!toFocusNode.length) {\n\t\t\t\t\t\t\t\t\ttoFocusNode = void(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdialog.trigger('totop');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('open', function() {\n\t\t\t\t\t\tdialog.data('margin-y', self.outerHeight(true) - self.height());\n\t\t\t\t\t\tif (syncSize.enabled) {\n\t\t\t\t\t\t\tif (opts.height && opts.height !== 'auto') {\n\t\t\t\t\t\t\t\tdialog.trigger('resize', {init: true});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!syncSize.defaultSize) {\n\t\t\t\t\t\t\t\tsyncSize.defaultSize = { width: self.width(), height: self.height() };\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfitSize(dialog);\n\t\t\t\t\t\t\tdialog.trigger('resize').trigger('posinit');\n\t\t\t\t\t\t\telfNode.on('resize.'+fm.namespace, dialog, syncFunc);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!dialog.hasClass(clnotify)) {\n\t\t\t\t\t\t\telfNode.children('.'+cldialog+':visible:not(.'+clnotify+')').each(function() {\n\t\t\t\t\t\t\t\tvar d     = $(this),\n\t\t\t\t\t\t\t\t\ttop   = parseInt(d.css('top')),\n\t\t\t\t\t\t\t\t\tleft  = parseInt(d.css('left')),\n\t\t\t\t\t\t\t\t\t_top  = parseInt(dialog.css('top')),\n\t\t\t\t\t\t\t\t\t_left = parseInt(dialog.css('left')),\n\t\t\t\t\t\t\t\t\tct    = Math.abs(top - _top) < 10,\n\t\t\t\t\t\t\t\t\tcl    = Math.abs(left - _left) < 10;\n\n\t\t\t\t\t\t\t\tif (d[0] != dialog[0] && (ct || cl)) {\n\t\t\t\t\t\t\t\t\tdialog.css({\n\t\t\t\t\t\t\t\t\t\ttop  : ct ? (top + 10) : _top,\n\t\t\t\t\t\t\t\t\t\tleft : cl ? (left + 10) : _left\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} \n\t\t\t\t\t\t\n\t\t\t\t\t\tif (dialog.data('modal')) {\n\t\t\t\t\t\t\tdialog.addClass(clmodal);\n\t\t\t\t\t\t\tfm.getUI('overlay').elfinderoverlay('show');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdialog.trigger('totop');\n\t\t\t\t\t\t\n\t\t\t\t\t\topts.openMaximized && fm.toggleMaximize(dialog);\n\n\t\t\t\t\t\tfm.trigger('dialogopen', {dialog: dialog});\n\n\t\t\t\t\t\ttypeof(opts.open) == 'function' && $.proxy(opts.open, self[0])();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (opts.closeOnEscape) {\n\t\t\t\t\t\t\t$(document).on('keydown.'+id, function(e) {\n\t\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE && dialog.hasClass('elfinder-frontmost')) {\n\t\t\t\t\t\t\t\t\tself.elfinderdialog('close');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.hasClass(fm.res('class', 'editing')) && checkEditing();\n\t\t\t\t\t})\n\t\t\t\t\t.on('close', function(e) {\n\t\t\t\t\t\tvar dialogs, dfd;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (opts.beforeclose && typeof opts.beforeclose === 'function') {\n\t\t\t\t\t\t\tdfd = opts.beforeclose();\n\t\t\t\t\t\t\tif (!dfd || !dfd.promise) {\n\t\t\t\t\t\t\t\tdfd = !dfd? $.Deferred().reject() : $.Deferred().resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd = $.Deferred().resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdfd.done(function() {\n\t\t\t\t\t\t\tsyncSize.enabled && elfNode.off('resize.'+fm.namespace, syncFunc);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (opts.closeOnEscape) {\n\t\t\t\t\t\t\t\t$(document).off('keyup.'+id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (opts.allowMaximize) {\n\t\t\t\t\t\t\t\tfm.toggleMaximize(dialog, false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfm.toHide(dialog);\n\t\t\t\t\t\t\tdialog.data('modal') && fm.getUI('overlay').elfinderoverlay('hide');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (typeof(opts.close) == 'function') {\n\t\t\t\t\t\t\t\t$.proxy(opts.close, self[0])();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (opts.destroyOnClose && dialog.parent().length) {\n\t\t\t\t\t\t\t\tdialog.hide().remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// get focus to next dialog\n\t\t\t\t\t\t\tdialogs = elfNode.children('.'+cldialog+':visible');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdialog.hasClass(fm.res('class', 'editing')) && checkEditing();\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('totop frontmost', function() {\n\t\t\t\t\t\tvar s = fm.storage('autoFocusDialog');\n\t\t\t\t\t\t\n\t\t\t\t\t\tdialog.data('focusOnMouseOver', s? (s > 0) : fm.options.uiOptions.dialog.focusOnMouseOver);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (dialog.data('minimized')) {\n\t\t\t\t\t\t\ttitlebar.children('.elfinder-titlebar-minimize').trigger('mousedown');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!dialog.data('modal') && fm.getUI('overlay').is(':visible')) {\n\t\t\t\t\t\t\tfm.getUI('overlay').before(dialog);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.toFront(dialog);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telfNode.children('.'+cldialog+':not(.'+clmodal+')').removeClass(clactive);\n\t\t\t\t\t\tdialog.addClass(clactive);\n\n\t\t\t\t\t\t! fm.UA.Mobile && (toFocusNode || tabstopNext()).trigger('focus');\n\n\t\t\t\t\t\ttoFocusNode = void(0);\n\t\t\t\t\t})\n\t\t\t\t\t.on('posinit', function() {\n\t\t\t\t\t\tvar css = opts.position,\n\t\t\t\t\t\t\tnodeOffset, minTop, minLeft, outerSize, win, winSize, nodeFull;\n\t\t\t\t\t\tif (dialog.hasClass('elfinder-maximized')) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (! css && ! dialog.data('resizing')) {\n\t\t\t\t\t\t\tnodeFull = elfNode.hasClass('elfinder-fullscreen') || fm.options.enableAlways;\n\t\t\t\t\t\t\tdialog.css(nodeFull? {\n\t\t\t\t\t\t\t\tmaxWidth  : '100%',\n\t\t\t\t\t\t\t\tmaxHeight : '100%',\n\t\t\t\t\t\t\t\toverflow   : 'auto'\n\t\t\t\t\t\t\t} : restoreStyle);\n\t\t\t\t\t\t\tif (fm.UA.Mobile && !nodeFull && dialog.data('rotated') === fm.UA.Rotated) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.data('rotated', fm.UA.Rotated);\n\t\t\t\t\t\t\twin = $(window);\n\t\t\t\t\t\t\tnodeOffset = elfNode.offset();\n\t\t\t\t\t\t\touterSize = {\n\t\t\t\t\t\t\t\twidth : dialog.outerWidth(true),\n\t\t\t\t\t\t\t\theight: dialog.outerHeight(true)\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\touterSize.right = nodeOffset.left + outerSize.width;\n\t\t\t\t\t\t\touterSize.bottom = nodeOffset.top + outerSize.height;\n\t\t\t\t\t\t\twinSize = {\n\t\t\t\t\t\t\t\tscrLeft: win.scrollLeft(),\n\t\t\t\t\t\t\t\tscrTop : win.scrollTop(),\n\t\t\t\t\t\t\t\twidth  : win.width(),\n\t\t\t\t\t\t\t\theight : win.height()\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\twinSize.right = winSize.scrLeft + winSize.width;\n\t\t\t\t\t\t\twinSize.bottom = winSize.scrTop + winSize.height;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (fm.options.dialogContained || nodeFull) {\n\t\t\t\t\t\t\t\tminTop = 0;\n\t\t\t\t\t\t\t\tminLeft = 0;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tminTop = nodeOffset.top * -1 + winSize.scrTop;\n\t\t\t\t\t\t\t\tminLeft = nodeOffset.left * -1 + winSize.scrLeft;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcss = {\n\t\t\t\t\t\t\t\ttop  : outerSize.height >= winSize.height? minTop  : Math.max(minTop, parseInt((elfNode.height() - outerSize.height)/2 - 42)),\n\t\t\t\t\t\t\t\tleft : outerSize.width  >= winSize.width ? minLeft : Math.max(minLeft, parseInt((elfNode.width() - outerSize.width)/2))\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (outerSize.right + css.left > winSize.right) {\n\t\t\t\t\t\t\t\tcss.left = Math.max(minLeft, winSize.right - outerSize.right);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (outerSize.bottom + css.top > winSize.bottom) {\n\t\t\t\t\t\t\t\tcss.top = Math.max(minTop, winSize.bottom - outerSize.bottom);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.absolute) {\n\t\t\t\t\t\t\tcss.position = 'absolute';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcss && dialog.css(css);\n\t\t\t\t\t})\n\t\t\t\t\t.on('resize', function(e, data) {\n\t\t\t\t\t\tvar oh = 0, init = data && data.init, h, minH, maxH, autoH;\n\t\t\t\t\t\tif ((data && (data.minimize || data.maxmize)) || dialog.data('minimized')) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tdialog.children('.ui-widget-header,.ui-dialog-buttonpane').each(function() {\n\t\t\t\t\t\t\toh += $(this).outerHeight(true);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tautoH = (opts.height === 'auto')? true : false;\n\t\t\t\t\t\tif (autoH) {\n\t\t\t\t\t\t\tself.css({'max-height': '', 'height': 'auto'});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!init && syncSize.enabled && !e.originalEvent && !dialog.hasClass('elfinder-maximized')) {\n\t\t\t\t\t\t\th = dialog.height();\n\t\t\t\t\t\t\tminH = dialog.css('min-height') || h;\n\t\t\t\t\t\t\tmaxH = dialog.css('max-height') || h;\n\t\t\t\t\t\t\tif (minH.match(/%/)) {\n\t\t\t\t\t\t\t\tminH = Math.floor((parseInt(minH) / 100) * dialog.parent().height());\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tminH = parseInt(minH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (maxH.match(/%/)) {\n\t\t\t\t\t\t\t\tmaxH = Math.floor((parseInt(maxH) / 100) * dialog.parent().height());\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tmaxH = parseInt(maxH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\th = Math.min((autoH? dialog.height() : syncSize.defaultSize.height), Math.max(maxH, minH) - oh - dialog.data('margin-y'));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\th = dialog.height() - oh - dialog.data('margin-y');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.css(autoH? 'max-height' : 'height', h);\n\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tposCheck();\n\t\t\t\t\t\tminH = self.height();\n\t\t\t\t\t\tminH = (h < minH)? (minH + oh + dialog.data('margin-y')) : opts.minHeight;\n\t\t\t\t\t\tdialog.css('min-height', minH);\n\t\t\t\t\t\tdialog.data('hasResizable') && dialog.resizable('option', { minHeight: minH });\n\t\t\t\t\t\tif (typeof(opts.resize) === 'function') {\n\t\t\t\t\t\t\t$.proxy(opts.resize, self[0])(e, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('tabstopsInit', tabstopsInit)\n\t\t\t\t\t.on('focus', '.'+cltabstop, function() {\n\t\t\t\t\t\t$(this).addClass(clhover).parent('label').addClass(clhover);\n\t\t\t\t\t\tthis.id && $(this).parent().find('label[for='+this.id+']').addClass(clhover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('click', 'select.'+cltabstop, function() {\n\t\t\t\t\t\tvar node = $(this);\n\t\t\t\t\t\tnode.data('keepFocus')? node.removeData('keepFocus') : node.data('keepFocus', true);\n\t\t\t\t\t})\n\t\t\t\t\t.on('blur', '.'+cltabstop, function() {\n\t\t\t\t\t\t$(this).removeClass(clhover).removeData('keepFocus').parent('label').removeClass(clhover);\n\t\t\t\t\t\tthis.id && $(this).parent().find('label[for='+this.id+']').removeClass(clhover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+cltabstop+',label', function(e) {\n\t\t\t\t\t\tvar $this = $(this), labelfor;\n\t\t\t\t\t\tif (this.nodeName === 'LABEL') {\n\t\t\t\t\t\t\tif (!$this.children('.'+cltabstop).length && (!(labelfor = $this.attr('for')) || !$('#'+labelfor).hasClass(cltabstop))) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.btnHoverFocus && dialog.data('focusOnMouseOver')) {\n\t\t\t\t\t\t\tif (e.type === 'mouseenter' && ! $(':focus').data('keepFocus')) {\n\t\t\t\t\t\t\t\t$this.trigger('focus');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.toggleClass(clhover, e.type == 'mouseenter');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('keydown', '.'+cltabstop, function(e) {\n\t\t\t\t\t\tvar $this = $(this),\n\t\t\t\t\t\t\tesc, move, moveTo;\n\t\t\t\t\t\tif ($this.is(':focus')) {\n\t\t\t\t\t\t\tesc = e.keyCode === $.ui.keyCode.ESCAPE;\n\t\t\t\t\t\t\tif (e.keyCode === $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t$this.trigger('click');\n\t\t\t\t\t\t\t}  else if (((e.keyCode === $.ui.keyCode.TAB) && e.shiftKey) || e.keyCode === $.ui.keyCode.LEFT || e.keyCode == $.ui.keyCode.UP) {\n\t\t\t\t\t\t\t\tmove = 'prev';\n\t\t\t\t\t\t\t}  else if (e.keyCode === $.ui.keyCode.TAB || e.keyCode == $.ui.keyCode.RIGHT || e.keyCode == $.ui.keyCode.DOWN) {\n\t\t\t\t\t\t\t\tmove = 'next';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (move\n\t\t\t\t\t\t\t\t\t&&\n\t\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t\t($this.is('textarea') && !(e.ctrlKey || e.metaKey))\n\t\t\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\t\t($this.is('select,span.ui-slider-handle') && e.keyCode !== $.ui.keyCode.TAB)\n\t\t\t\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t\t\t($this.is('input:not(:checkbox,:radio)') && (!(e.ctrlKey || e.metaKey) && e.keyCode === $.ui.keyCode[move === 'prev'? 'LEFT':'RIGHT']))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!esc) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t} else if ($this.is('input:not(:checkbox,:radio),textarea')) {\n\t\t\t\t\t\t\t\tif ($this.val() !== '') {\n\t\t\t\t\t\t\t\t\t$this.val('');\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (move) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t(move === 'prev'? tabstopPrev : tabstopNext)(this).trigger('focus');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.data({modal: opts.modal}),\n\t\t\t\tposCheck = function() {\n\t\t\t\t\tvar node = fm.getUI(),\n\t\t\t\t\t\tpos;\n\t\t\t\t\tif (node.hasClass('elfinder-fullscreen')) {\n\t\t\t\t\t\tpos = dialog.position();\n\t\t\t\t\t\tdialog.css('top', Math.max(Math.min(Math.max(pos.top, 0), node.height() - 100), 0));\n\t\t\t\t\t\tdialog.css('left', Math.max(Math.min(Math.max(pos.left, 0), node.width() - 200), 0));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmaxSize, toFocusNode;\n\t\t\t\n\t\t\tdialog.prepend(titlebar);\n\n\t\t\tmakeHeaderBtn();\n\n\t\t\t$.each(opts.buttons, function(name, cb) {\n\t\t\t\tvar button = $('<button type=\"button\" class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only '\n\t\t\t\t\t\t+'elfinder-btncnt-'+(btnCnt++)+' '\n\t\t\t\t\t\t+cltabstop\n\t\t\t\t\t\t+'\"><span class=\"ui-button-text\">'+name+'</span></button>')\n\t\t\t\t\t.on('click', $.proxy(cb, self[0]));\n\t\t\t\tif (cb._cssClass) {\n\t\t\t\t\tbutton.addClass(cb._cssClass);\n\t\t\t\t}\n\t\t\t\tif (platformWin) {\n\t\t\t\t\tbuttonset.append(button);\n\t\t\t\t} else {\n\t\t\t\t\tbuttonset.prepend(button);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (buttonset.children().length) {\n\t\t\t\tdialog.append(buttonpane);\n\t\t\t\t\n\t\t\t\tdialog.show();\n\t\t\t\tbuttonpane.find('button').each(function(i, btn) {\n\t\t\t\t\tbtnWidth += $(btn).outerWidth(true);\n\t\t\t\t});\n\t\t\t\tdialog.hide();\n\t\t\t\tbtnWidth += 20;\n\t\t\t\t\n\t\t\t\tif (dialog.width() < btnWidth) {\n\t\t\t\t\tdialog.width(btnWidth);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tdialog.append(evCover);\n\t\t\t\n\t\t\tif (syncSize.enabled) {\n\t\t\t\tdelta.width = dialog.outerWidth(true) - dialog.width() + ((dialog.outerWidth() - dialog.width()) / 2);\n\t\t\t\tdelta.height = dialog.outerHeight(true) - dialog.height() + ((dialog.outerHeight() - dialog.height()) / 2);\n\t\t\t}\n\t\t\t\n\t\t\tif (fm.options.dialogContained) {\n\t\t\t\tmaxSize = {\n\t\t\t\t\tmaxWidth: elfNode.width() - delta.width,\n\t\t\t\t\tmaxHeight: elfNode.height() - delta.height\n\t\t\t\t};\n\t\t\t\topts.maxWidth = opts.maxWidth? Math.min(maxSize.maxWidth, opts.maxWidth) : maxSize.maxWidth;\n\t\t\t\topts.maxHeight = opts.maxHeight? Math.min(maxSize.maxHeight, opts.maxHeight) : maxSize.maxHeight;\n\t\t\t\tdialog.css(maxSize);\n\t\t\t}\n\t\t\t\n\t\t\trestoreStyle = {\n\t\t\t\tmaxWidth  : dialog.css('max-width'),\n\t\t\t\tmaxHeight : dialog.css('max-height'),\n\t\t\t\toverflow   : dialog.css('overflow')\n\t\t\t};\n\t\t\t\n\t\t\tif (opts.resizable) {\n\t\t\t\tdialog.resizable({\n\t\t\t\t\tminWidth   : opts.minWidth,\n\t\t\t\t\tminHeight  : opts.minHeight,\n\t\t\t\t\tmaxWidth   : opts.maxWidth,\n\t\t\t\t\tmaxHeight  : opts.maxHeight,\n\t\t\t\t\tstart      : function() {\n\t\t\t\t\t\tevCover.show();\n\t\t\t\t\t\tif (dialog.data('resizing') !== true && dialog.data('resizing')) {\n\t\t\t\t\t\t\tclearTimeout(dialog.data('resizing'));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdialog.data('resizing', true);\n\t\t\t\t\t},\n\t\t\t\t\tstop       : function(e, ui) {\n\t\t\t\t\t\tevCover.hide();\n\t\t\t\t\t\tdialog.data('resizing', setTimeout(function() {\n\t\t\t\t\t\t\tdialog.data('resizing', false);\n\t\t\t\t\t\t}, 200));\n\t\t\t\t\t\tif (syncSize.enabled) {\n\t\t\t\t\t\t\tsyncSize.defaultSize = { width: self.width(), height: self.height() };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).data('hasResizable', true);\n\t\t\t} \n\t\t\t\n\t\t\tnumberToTel();\n\t\t\t\n\t\t\ttabstopsInit();\n\t\t\t\n\t\t\ttypeof(opts.create) == 'function' && $.proxy(opts.create, this)();\n\t\t\t\n\t\t\tif (opts.autoOpen) {\n\t\t\t\tif (opts.open) {\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tself.elfinderdialog('open');\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tself.elfinderdialog('open');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (opts.resize) {\n\t\t\t\tfm.bind('themechange', function() {\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tdialog.data('margin-y', self.outerHeight(true) - self.height());\n\t\t\t\t\t\tdialog.trigger('resize', {init: true});\n\t\t\t\t\t}, 300);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn this;\n\t};\n\n\t$.fn.elfinderdialog.defaults = {\n\t\tcssClass  : '',\n\t\ttitle     : '',\n\t\tmodal     : false,\n\t\tresizable : true,\n\t\tautoOpen  : true,\n\t\tcloseOnEscape : true,\n\t\tdestroyOnClose : false,\n\t\tbuttons   : {},\n\t\tbtnHoverFocus : true,\n\t\tposition  : null,\n\t\tabsolute  : false,\n\t\twidth     : 320,\n\t\theight    : 'auto',\n\t\tminWidth  : 200,\n\t\tminHeight : 70,\n\t\tmaxWidth  : null,\n\t\tmaxHeight : null,\n\t\tallowMinimize : 'auto',\n\t\tallowMaximize : false,\n\t\topenMaximized : false,\n\t\theaderBtnPos : 'auto',\n\t\theaderBtnOrder : 'auto',\n\t\toptimizeNumber : true,\n\t\tpropagationEvents : ['mousemove', 'mouseup']\n\t};\n\n});\ndefine('skylark-elfinder/ui/fullscreenbutton',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar button to switch full scrren mode.\n\t *\n\t * @author Naoki Sawada\n\t **/\n\n\t$.fn.elfinderfullscreenbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar button = $(this).elfinderbutton(cmd),\n\t\t\t\ticon   = button.children('.elfinder-button-icon'),\n\t\t\t\ttm;\n\t\t\tcmd.change(function() {\n\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\tvar fullscreen = cmd.value;\n\t\t\t\t\ticon.addClass('elfinder-button-icon-fullscreen').toggleClass('elfinder-button-icon-unfullscreen', fullscreen);\n\t\t\t\t\tcmd.className = fullscreen? 'unfullscreen' : '';\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/navbar',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elfindernav - elFinder container for diretories tree and places\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindernavbar = function(fm, opts) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-navbar').each(function() {\n\t\t\tvar nav    = $(this).hide().addClass('ui-state-default elfinder-navbar'),\n\t\t\t\tparent = nav.css('overflow', 'hidden').parent(),\n\t\t\t\twz     = parent.children('.elfinder-workzone').append(nav),\n\t\t\t\tltr    = fm.direction == 'ltr',\n\t\t\t\tdelta, deltaW, handle, swipeHandle, autoHide, setWidth, navdock,\n\t\t\t\tsetWzRect = function() {\n\t\t\t\t\tvar cwd = fm.getUI('cwd'),\n\t\t\t\t\t\twz  = fm.getUI('workzone'),\n\t\t\t\t\t\twzRect = wz.data('rectangle'),\n\t\t\t\t\t\tcwdOffset = cwd.offset();\n\t\t\t\t\twz.data('rectangle', Object.assign(wzRect, { cwdEdge: (fm.direction === 'ltr')? cwdOffset.left : cwdOffset.left + cwd.width() }));\n\t\t\t\t},\n\t\t\t\tsetDelta = function() {\n\t\t\t\t\tnav.css('overflow', 'hidden');\n\t\t\t\t\tdelta  = Math.round(nav.outerHeight() - nav.height());\n\t\t\t\t\tdeltaW = Math.round(navdock.outerWidth() - navdock.innerWidth());\n\t\t\t\t\tnav.css('overflow', 'auto');\n\t\t\t\t};\n\n\t\t\tfm.one('init', function() {\n\t\t\t\tnavdock = fm.getUI('navdock');\n\t\t\t\tvar set = function() {\n\t\t\t\t\t\tsetDelta();\n\t\t\t\t\t\tfm.bind('wzresize', function() {\n\t\t\t\t\t\t\tvar navdockH = 0;\n\t\t\t\t\t\t\tnavdock.width(nav.outerWidth() - deltaW);\n\t\t\t\t\t\t\tif (navdock.children().length > 1) {\n\t\t\t\t\t\t\t\tnavdockH = navdock.outerHeight(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnav.height(wz.height() - navdockH - delta);\n\t\t\t\t\t\t}).trigger('wzresize');\n\t\t\t\t\t};\n\t\t\t\tif (fm.cssloaded) {\n\t\t\t\t\tset();\n\t\t\t\t} else {\n\t\t\t\t\tfm.one('cssloaded', set);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.one('opendone',function() {\n\t\t\t\thandle && handle.trigger('resize');\n\t\t\t\tnav.css('overflow', 'auto');\n\t\t\t}).bind('themechange', setDelta);\n\t\t\t\n\t\t\tif (fm.UA.Touch) {\n\t\t\t\tautoHide = fm.storage('autoHide') || {};\n\t\t\t\tif (typeof autoHide.navbar === 'undefined') {\n\t\t\t\t\tautoHide.navbar = (opts.autoHideUA && opts.autoHideUA.length > 0 && $.grep(opts.autoHideUA, function(v){ return fm.UA[v]? true : false; }).length);\n\t\t\t\t\tfm.storage('autoHide', autoHide);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (autoHide.navbar) {\n\t\t\t\t\tfm.one('init', function() {\n\t\t\t\t\t\tif (nav.children().length) {\n\t\t\t\t\t\t\tfm.uiAutoHide.push(function(){ nav.stop(true, true).trigger('navhide', { duration: 'slow', init: true }); });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.bind('load', function() {\n\t\t\t\t\tif (nav.children().length) {\n\t\t\t\t\t\tswipeHandle = $('<div class=\"elfinder-navbar-swipe-handle\"/>').hide().appendTo(wz);\n\t\t\t\t\t\tif (swipeHandle.css('pointer-events') !== 'none') {\n\t\t\t\t\t\t\tswipeHandle.remove();\n\t\t\t\t\t\t\tswipeHandle = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tnav.on('navshow navhide', function(e, data) {\n\t\t\t\t\tvar mode     = (e.type === 'navshow')? 'show' : 'hide',\n\t\t\t\t\t\tduration = (data && data.duration)? data.duration : 'fast',\n\t\t\t\t\t\thandleW = (data && data.handleW)? data.handleW : Math.max(50, fm.getUI().width() / 10);\n\t\t\t\t\tnav.stop(true, true)[mode]({\n\t\t\t\t\t\tduration: duration,\n\t\t\t\t\t\tstep    : function() {\n\t\t\t\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\tif (swipeHandle) {\n\t\t\t\t\t\t\t\tif (mode === 'show') {\n\t\t\t\t\t\t\t\t\tswipeHandle.stop(true, true).hide();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tswipeHandle.width(handleW? handleW : '');\n\t\t\t\t\t\t\t\t\tfm.resources.blink(swipeHandle, 'slowonce');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.trigger('navbar'+ mode);\n\t\t\t\t\t\t\tdata.init && fm.trigger('uiautohide');\n\t\t\t\t\t\t\tsetWzRect();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tautoHide.navbar = (mode !== 'show');\n\t\t\t\t\tfm.storage('autoHide', Object.assign(fm.storage('autoHide'), {navbar: autoHide.navbar}));\n\t\t\t\t}).on('touchstart', function(e) {\n\t\t\t\t\tif ($(this)['scroll' + (fm.direction === 'ltr'? 'Right' : 'Left')]() > 5) {\n\t\t\t\t\t\te.originalEvent._preventSwipeX = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tif (! fm.UA.Mobile) {\n\t\t\t\thandle = nav.resizable({\n\t\t\t\t\t\thandles : ltr ? 'e' : 'w',\n\t\t\t\t\t\tminWidth : opts.minWidth || 150,\n\t\t\t\t\t\tmaxWidth : opts.maxWidth || 500,\n\t\t\t\t\t\tresize : function() {\n\t\t\t\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstop : function(e, ui) {\n\t\t\t\t\t\t\tfm.storage('navbarWidth', ui.size.width);\n\t\t\t\t\t\t\tsetWzRect();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('resize scroll', function(e) {\n\t\t\t\t\t\tvar $this = $(this),\n\t\t\t\t\t\t\ttm = $this.data('posinit');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (! ltr && e.type === 'resize') {\n\t\t\t\t\t\t\tnav.css('left', 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\t\t\t$this.data('posinit', requestAnimationFrame(function() {\n\t\t\t\t\t\t\tvar offset = (fm.UA.Opera && nav.scrollLeft())? 20 : 2;\n\t\t\t\t\t\t\thandle.css('top', 0).css({\n\t\t\t\t\t\t\t\ttop  : parseInt(nav.scrollTop())+'px',\n\t\t\t\t\t\t\t\tleft : ltr ? 'auto' : parseInt(nav.scrollRight() -  offset) * -1,\n\t\t\t\t\t\t\t\tright: ltr ? parseInt(nav.scrollLeft() - offset) * -1 : 'auto'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (e.type === 'resize') {\n\t\t\t\t\t\t\t\tfm.getUI('cwd').trigger('resize');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t})\n\t\t\t\t\t.children('.ui-resizable-handle').addClass('ui-front');\n\t\t\t}\n\n\t\t\tif (setWidth = fm.storage('navbarWidth')) {\n\t\t\t\tnav.width(setWidth);\n\t\t\t} else {\n\t\t\t\tif (fm.UA.Mobile) {\n\t\t\t\t\tfm.one(fm.cssloaded? 'init' : 'cssloaded', function() {\n\t\t\t\t\t\tvar set = function() {\n\t\t\t\t\t\t\tsetWidth = nav.parent().width() / 2;\n\t\t\t\t\t\t\tif (nav.data('defWidth') > setWidth) {\n\t\t\t\t\t\t\t\tnav.width(setWidth);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnav.width(nav.data('defWidth'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnav.data('width', nav.width());\n\t\t\t\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\t\t};\n\t\t\t\t\t\tnav.data('defWidth', nav.width());\n\t\t\t\t\t\t$(window).on('resize.' + fm.namespace, set);\n\t\t\t\t\t\tset();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t});\n\t\t\n\t\treturn this;\n\t};\n\n});\ndefine('skylark-elfinder/ui/navdock',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elfindernavdock - elFinder container for preview etc at below the navbar\n\t *\n\t * @author Naoki Sawada\n\t **/\n\t$.fn.elfindernavdock = function(fm, opts) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-navdock').each(function() {\n\t\t\tvar self = $(this).hide().addClass('ui-state-default elfinder-navdock touch-punch'),\n\t\t\t\tnode = self.parent(),\n\t\t\t\twz   = node.children('.elfinder-workzone').append(self),\n\t\t\t\tresize = function(to, h) {\n\t\t\t\t\tvar curH = h || self.height(),\n\t\t\t\t\t\tdiff = to - curH,\n\t\t\t\t\t\tlen  = Object.keys(sizeSyncs).length,\n\t\t\t\t\t\tcalc = len? diff / len : 0,\n\t\t\t\t\t\tovf;\n\t\t\t\t\tif (diff) {\n\t\t\t\t\t\tovf = self.css('overflow');\n\t\t\t\t\t\tself.css('overflow', 'hidden');\n\t\t\t\t\t\tself.height(to);\n\t\t\t\t\t\t$.each(sizeSyncs, function(id, n) {\n\t\t\t\t\t\t\tn.height(n.height() + calc).trigger('resize.' + fm.namespace);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\t\tself.css('overflow', ovf);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandle = $('<div class=\"ui-front ui-resizable-handle ui-resizable-n\"/>').appendTo(self),\n\t\t\t\tsizeSyncs = {},\n\t\t\t\tresizeFn = [],\n\t\t\t\tinitMaxHeight = (parseInt(opts.initMaxHeight) || 50) / 100,\n\t\t\t\tmaxHeight = (parseInt(opts.maxHeight) || 90) / 100,\n\t\t\t\tbasicHeight, hasNode;\n\t\t\t\n\t\t\t\n\t\t\tself.data('addNode', function(cNode, opts) {\n\t\t\t\tvar wzH = fm.getUI('workzone').height(),\n\t\t\t\t\timaxH = wzH * initMaxHeight,\n\t\t\t\t\tcurH, tH, mH;\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tfirst: false,\n\t\t\t\t\tsizeSync: true,\n\t\t\t\t\tinit: false\n\t\t\t\t}, opts);\n\t\t\t\tif (!cNode.attr('id')) {\n\t\t\t\t\tcNode.attr('id', fm.namespace+'-navdock-' + (+new Date()));\n\t\t\t\t}\n\t\t\t\topts.sizeSync && (sizeSyncs[cNode.attr('id')] = cNode);\n\t\t\t\tcurH = self.height();\n\t\t\t\ttH = curH + cNode.outerHeight(true);\n\t\t\t\t\n\t\t\t\tif (opts.first) {\n\t\t\t\t\thandle.after(cNode);\n\t\t\t\t} else {\n\t\t\t\t\tself.append(cNode);\n\t\t\t\t}\n\t\t\t\thasNode = true;\n\t\t\t\tself.resizable('enable').height(tH).show();\n\t\t\t\t\n\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\n\t\t\t\tif (opts.init) {\n\t\t\t\t\tmH = fm.storage('navdockHeight');\n\t\t\t\t\tif (mH) {\n\t\t\t\t\t\ttH = mH;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttH = tH > imaxH? imaxH : tH;\n\t\t\t\t\t}\n\t\t\t\t\tbasicHeight = tH;\n\t\t\t\t}\n\t\t\t\tresize(Math.min(tH, wzH * maxHeight));\n\t\t\t\t\n\t\t\t\treturn self;\n\t\t\t}).data('removeNode', function(nodeId, appendTo) {\n\t\t\t\tvar cNode = $('#'+nodeId);\n\t\t\t\tdelete sizeSyncs[nodeId];\n\t\t\t\tself.height(self.height() - $('#'+nodeId).outerHeight(true));\n\t\t\t\tif (appendTo) {\n\t\t\t\t\tif (appendTo === 'detach') {\n\t\t\t\t\t\tcNode = cNode.detach();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tappendTo.append(cNode);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcNode.remove();\n\t\t\t\t}\n\t\t\t\tif (self.children().length <= 1) {\n\t\t\t\t\thasNode = false;\n\t\t\t\t\tself.resizable('disable').height(0).hide();\n\t\t\t\t}\n\t\t\t\tfm.trigger('wzresize');\n\t\t\t\treturn cNode;\n\t\t\t});\n\t\t\t\n\t\t\tif (! opts.disabled) {\n\t\t\t\tfm.one('init', function() {\n\t\t\t\t\tvar ovf;\n\t\t\t\t\tif (fm.getUI('navbar').children().not('.ui-resizable-handle').length) {\n\t\t\t\t\t\tself.data('dockEnabled', true);\n\t\t\t\t\t\tself.resizable({\n\t\t\t\t\t\t\tmaxHeight: fm.getUI('workzone').height() * maxHeight,\n\t\t\t\t\t\t\thandles: { n: handle },\n\t\t\t\t\t\t\tstart: function(e, ui) {\n\t\t\t\t\t\t\t\tovf = self.css('overflow');\n\t\t\t\t\t\t\t\tself.css('overflow', 'hidden');\n\t\t\t\t\t\t\t\tfm.trigger('navdockresizestart', {event: e, ui: ui}, true);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresize: function(e, ui) {\n\t\t\t\t\t\t\t\tself.css('top', '');\n\t\t\t\t\t\t\t\tfm.trigger('wzresize', { inNavdockResize : true });\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstop: function(e, ui) {\n\t\t\t\t\t\t\t\tfm.trigger('navdockresizestop', {event: e, ui: ui}, true);\n\t\t\t\t\t\t\t\tself.css('top', '');\n\t\t\t\t\t\t\t\tbasicHeight = ui.size.height;\n\t\t\t\t\t\t\t\tfm.storage('navdockHeight', basicHeight);\n\t\t\t\t\t\t\t\tresize(basicHeight, ui.originalSize.height);\n\t\t\t\t\t\t\t\tself.css('overflow', ovf);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.bind('wzresize', function(e) {\n\t\t\t\t\t\t\tvar minH, maxH, h;\n\t\t\t\t\t\t\tif (self.is(':visible')) {\n\t\t\t\t\t\t\t\tmaxH = fm.getUI('workzone').height() * maxHeight;\n\t\t\t\t\t\t\t\tif (! e.data || ! e.data.inNavdockResize) {\n\t\t\t\t\t\t\t\t\th = self.height();\n\t\t\t\t\t\t\t\t\tif (maxH < basicHeight) {\n\t\t\t\t\t\t\t\t\t\tif (Math.abs(h - maxH) > 1) {\n\t\t\t\t\t\t\t\t\t\t\tresize(maxH);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (Math.abs(h - basicHeight) > 1) {\n\t\t\t\t\t\t\t\t\t\t\tresize(basicHeight);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tself.resizable('option', 'maxHeight', maxH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).bind('themechange', function() {\n\t\t\t\t\t\t\tvar oldH = Math.round(self.height());\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tvar curH = Math.round(self.height()),\n\t\t\t\t\t\t\t\t\tdiff = oldH - curH;\n\t\t\t\t\t\t\t\tif (diff !== 0) {\n\t\t\t\t\t\t\t\t\tresize(self.height(),  curH - diff);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tfm.bind('navbarshow navbarhide', function(e) {\n\t\t\t\t\t\tself[hasNode && e.type === 'navbarshow'? 'show' : 'hide']();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t};\n\n});\ndefine('skylark-elfinder/ui/overlay',[\n\t\"skylark-jquery\"\n],function($) {\n\t$.fn.elfinderoverlay = function(opts) {\n\t\t\"use strict\";\n\t\tvar fm = this.parent().elfinder('instance'),\n\t\t\to, cnt, show, hide;\n\t\t\n\t\tthis.filter(':not(.elfinder-overlay)').each(function() {\n\t\t\topts = Object.assign({}, opts);\n\t\t\t$(this).addClass('ui-front ui-widget-overlay elfinder-overlay')\n\t\t\t\t.hide()\n\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t})\n\t\t\t\t.data({\n\t\t\t\t\tcnt  : 0,\n\t\t\t\t\tshow : typeof(opts.show) == 'function' ? opts.show : function() { },\n\t\t\t\t\thide : typeof(opts.hide) == 'function' ? opts.hide : function() { }\n\t\t\t\t});\n\t\t});\n\t\t\n\t\tif (opts == 'show') {\n\t\t\to    = this.eq(0);\n\t\t\tcnt  = o.data('cnt') + 1;\n\t\t\tshow = o.data('show');\n\n\t\t\tfm.toFront(o);\n\t\t\to.data('cnt', cnt);\n\n\t\t\tif (o.is(':hidden')) {\n\t\t\t\to.show();\n\t\t\t\tshow();\n\t\t\t}\n\t\t} \n\t\t\n\t\tif (opts == 'hide') {\n\t\t\to    = this.eq(0);\n\t\t\tcnt  = o.data('cnt') - 1;\n\t\t\thide = o.data('hide');\n\t\t\t\n\t\t\to.data('cnt', cnt);\n\t\t\t\t\n\t\t\tif (cnt <= 0) {\n\t\t\t\to.hide();\n\t\t\t\thide();\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn this;\n\t};\n\n});\ndefine('skylark-elfinder/ui/panel',[\n\t\"skylark-jquery\"\n],function($) {\n\t$.fn.elfinderpanel = function(fm) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar panel = $(this).addClass('elfinder-panel ui-state-default ui-corner-all'),\n\t\t\t\tmargin = 'margin-'+(fm.direction == 'ltr' ? 'left' : 'right');\n\t\t\t\n\t\t\tfm.one('load', function(e) {\n\t\t\t\tvar navbar = fm.getUI('navbar');\n\t\t\t\t\n\t\t\t\tpanel.css(margin, parseInt(navbar.outerWidth(true)));\n\t\t\t\tnavbar.on('resize', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tpanel.is(':visible') && panel.css(margin, parseInt(navbar.outerWidth(true)));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/path',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elFinder ui\n\t * Display current folder path in statusbar.\n\t * Click on folder name in path - open folder\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderpath = function(fm, options) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar query  = '',\n\t\t\t\ttarget = '',\n\t\t\t\tmimes  = [],\n\t\t\t\tplace  = 'statusbar',\n\t\t\t\tclHover= fm.res('class', 'hover'),\n\t\t\t\tprefix = 'path' + (elFinder.prototype.uniqueid? elFinder.prototype.uniqueid : '') + '-',\n\t\t\t\twzbase = $('<div class=\"ui-widget-header ui-helper-clearfix elfinder-workzone-path\"/>'),\n\t\t\t\tpath   = $(this).addClass('elfinder-path').html('&nbsp;')\n\t\t\t\t\t.on('mousedown', 'span.elfinder-path-dir', function(e) {\n\t\t\t\t\t\tvar hash = $(this).attr('id').substr(prefix.length);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tif (hash != fm.cwd().hash) {\n\t\t\t\t\t\t\t$(this).addClass(clHover);\n\t\t\t\t\t\t\tif (query) {\n\t\t\t\t\t\t\t\tfm.exec('search', query, { target: hash, mime: mimes.join(' ') });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.trigger('select', {selected : [hash]}).exec('open', hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.prependTo(fm.getUI('statusbar').show()),\n\t\t\t\troots = $('<div class=\"elfinder-path-roots\"/>').on('click', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\n\t\t\t\t\tvar roots = $.map(fm.roots, function(h) { return fm.file(h); }),\n\t\t\t\t\traw = [];\n\n\t\t\t\t\t$.each(roots, function(i, f) {\n\t\t\t\t\t\tif (! f.phash && fm.root(fm.cwd().hash, true) !== f.hash) {\n\t\t\t\t\t\t\traw.push({\n\t\t\t\t\t\t\t\tlabel    : fm.escape(f.i18 || f.name),\n\t\t\t\t\t\t\t\ticon     : 'home',\n\t\t\t\t\t\t\t\tcallback : function() { fm.exec('open', f.hash); },\n\t\t\t\t\t\t\t\toptions  : {\n\t\t\t\t\t\t\t\t\ticonClass : f.csscls || '',\n\t\t\t\t\t\t\t\t\ticonImg   : f.icon   || ''\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\traw: raw,\n\t\t\t\t\t\tx: e.pageX,\n\t\t\t\t\t\ty: e.pageY\n\t\t\t\t\t});\n\t\t\t\t}).append('<span class=\"elfinder-button-icon elfinder-button-icon-menu\" />').appendTo(wzbase),\n\t\t\t\trender = function(cwd) {\n\t\t\t\t\tvar dirs = [],\n\t\t\t\t\t\tnames = [];\n\t\t\t\t\t$.each(fm.parents(cwd), function(i, hash) {\n\t\t\t\t\t\tvar c = (cwd === hash)? 'elfinder-path-dir elfinder-path-cwd' : 'elfinder-path-dir',\n\t\t\t\t\t\t\tf = fm.file(hash),\n\t\t\t\t\t\t\tname = fm.escape(f.i18 || f.name);\n\t\t\t\t\t\tnames.push(name);\n\t\t\t\t\t\tdirs.push('<span id=\"'+prefix+hash+'\" class=\"'+c+'\" title=\"'+names.join(fm.option('separator'))+'\">'+name+'</span>');\n\t\t\t\t\t});\n\t\t\t\t\treturn dirs.join('<span class=\"elfinder-path-other\">'+fm.option('separator')+'</span>');\n\t\t\t\t},\n\t\t\t\ttoWorkzone = function() {\n\t\t\t\t\tvar prev;\n\t\t\t\t\tpath.children('span.elfinder-path-dir').attr('style', '');\n\t\t\t\t\tprev = fm.direction === 'ltr'? $('#'+prefix + fm.cwd().hash).prevAll('span.elfinder-path-dir:first') : $();\n\t\t\t\t\tpath.scrollLeft(prev.length? prev.position().left : 0);\n\t\t\t\t},\n\t\t\t\tfit = function() {\n\t\t\t\t\tif (fm.UA.CSS.flex) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar dirs = path.children('span.elfinder-path-dir'),\n\t\t\t\t\t\tcnt  = dirs.length,\n\t\t\t\t\t\tm, bg = 0, ids;\n\t\t\t\t\t\n\t\t\t\t\tif (place === 'workzone' || cnt < 2) {\n\t\t\t\t\t\tdirs.attr('style', '');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tpath.width(path.css('max-width'));\n\t\t\t\t\tdirs.css({maxWidth: (100/cnt)+'%', display: 'inline-block'});\n\t\t\t\t\tm = path.width() - 9;\n\t\t\t\t\tpath.children('span.elfinder-path-other').each(function() {\n\t\t\t\t\t\tm -= $(this).width();\n\t\t\t\t\t});\n\t\t\t\t\tids = [];\n\t\t\t\t\tdirs.each(function(i) {\n\t\t\t\t\t\tvar dir = $(this),\n\t\t\t\t\t\t\tw   = dir.width();\n\t\t\t\t\t\tm -= w;\n\t\t\t\t\t\tif (w < this.scrollWidth) {\n\t\t\t\t\t\t\tids.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tpath.width('');\n\t\t\t\t\tif (ids.length) {\n\t\t\t\t\t\tif (m > 0) {\n\t\t\t\t\t\t\tm = m / ids.length;\n\t\t\t\t\t\t\t$.each(ids, function(i, k) {\n\t\t\t\t\t\t\t\tvar d = $(dirs[k]);\n\t\t\t\t\t\t\t\td.css('max-width', d.width() + m);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdirs.last().attr('style', '');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdirs.attr('style', '');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thasUiTree, hasUiStat;\n\n\t\t\tfm.one('init', function() {\n\t\t\t\thasUiTree = fm.getUI('tree').length;\n\t\t\t\thasUiStat = fm.getUI('stat').length;\n\t\t\t\tif (! hasUiTree && options.toWorkzoneWithoutNavbar) {\n\t\t\t\t\twzbase.append(path).insertBefore(fm.getUI('workzone'));\n\t\t\t\t\tplace = 'workzone';\n\t\t\t\t\tfm.bind('open', toWorkzone)\n\t\t\t\t\t.one('opendone', function() {\n\t\t\t\t\t\tfm.getUI().trigger('resize');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('open searchend parents', function() {\n\t\t\t\tvar dirs = [];\n\n\t\t\t\tquery  = '';\n\t\t\t\ttarget = '';\n\t\t\t\tmimes  = [];\n\t\t\t\t\n\t\t\t\tpath.html(render(fm.cwd().hash));\n\t\t\t\tif (Object.keys(fm.roots).length > 1) {\n\t\t\t\t\tpath.css('margin', '');\n\t\t\t\t\troots.show();\n\t\t\t\t} else {\n\t\t\t\t\tpath.css('margin', 0);\n\t\t\t\t\troots.hide();\n\t\t\t\t}\n\t\t\t\t!hasUiStat && fit();\n\t\t\t})\n\t\t\t.bind('searchstart', function(e) {\n\t\t\t\tif (e.data) {\n\t\t\t\t\tquery  = e.data.query || '';\n\t\t\t\t\ttarget = e.data.target || '';\n\t\t\t\t\tmimes  = e.data.mimes || [];\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('search', function(e) {\n\t\t\t\tvar dirs = [],\n\t\t\t\t\thtml = '';\n\t\t\t\tif (target) {\n\t\t\t\t\thtml = render(target);\n\t\t\t\t} else {\n\t\t\t\t\thtml = fm.i18n('btnAll');\n\t\t\t\t}\n\t\t\t\tpath.html('<span class=\"elfinder-path-other\">'+fm.i18n('searcresult') + ': </span>' + html);\n\t\t\t\tfit();\n\t\t\t})\n\t\t\t// on swipe to navbar show/hide\n\t\t\t.bind('navbarshow navbarhide', function() {\n\t\t\t\tvar wz = fm.getUI('workzone');\n\t\t\t\tif (this.type === 'navbarshow') {\n\t\t\t\t\tfm.unbind('open', toWorkzone);\n\t\t\t\t\tpath.prependTo(fm.getUI('statusbar'));\n\t\t\t\t\twzbase.detach();\n\t\t\t\t\tplace = 'statusbar';\n\t\t\t\t} else {\n\t\t\t\t\twzbase.append(path).insertBefore(wz);\n\t\t\t\t\tplace = 'workzone';\n\t\t\t\t\ttoWorkzone();\n\t\t\t\t\tfm.bind('open', toWorkzone);\n\t\t\t\t}\n\t\t\t\tfm.trigger('uiresize');\n\t\t\t})\n\t\t\t.bind('resize uistatchange', fit);\n\t\t});\n\t};\n\n});\n\ndefine('skylark-elfinder/ui/places',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elFinder places/favorites ui\n\t *\n\t * @author Dmitry (dio) Levashov\n\t * @author Naoki Sawada\n\t **/\n\t$.fn.elfinderplaces = function(fm, opts) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar dirs      = {},\n\t\t\t\tc         = 'class',\n\t\t\t\tnavdir    = fm.res(c, 'navdir'),\n\t\t\t\tcollapsed = fm.res(c, 'navcollapse'),\n\t\t\t\texpanded  = fm.res(c, 'navexpand'),\n\t\t\t\thover     = fm.res(c, 'hover'),\n\t\t\t\tclroot    = fm.res(c, 'treeroot'),\n\t\t\t\tdropover  = fm.res(c, 'adroppable'),\n\t\t\t\ttpl       = fm.res('tpl', 'placedir'),\n\t\t\t\tptpl      = fm.res('tpl', 'perms'),\n\t\t\t\tspinner   = $(fm.res('tpl', 'navspinner')),\n\t\t\t\tsuffix    = opts.suffix? opts.suffix : '',\n\t\t\t\tkey       = 'places' + suffix,\n\t\t\t\tmenuTimer = null,\n\t\t\t\t/**\n\t\t\t\t * Convert places dir node into dir hash\n\t\t\t\t *\n\t\t\t\t * @param  String  directory id\n\t\t\t\t * @return String\n\t\t\t\t **/\n\t\t\t\tid2hash   = function(id) { return id.substr(6);\t},\n\t\t\t\t/**\n\t\t\t\t * Convert places dir hash into dir node id\n\t\t\t\t *\n\t\t\t\t * @param  String  directory id\n\t\t\t\t * @return String\n\t\t\t\t **/\n\t\t\t\thash2id   = function(hash) { return 'place-'+hash; },\n\n\t\t\t\t/**\n\t\t\t\t * Convert places dir hash into dir node elment (jQuery object)\n\t\t\t\t *\n\t\t\t\t * @param  String  directory id\n\t\t\t\t * @return Object\n\t\t\t\t **/\n\t\t\t\thash2elm  = function(hash) { return $(document.getElementById(hash2id(hash))); },\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Save current places state\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tsave      = function() {\n\t\t\t\t\tvar hashes = [], data = {};\n\t\t\t\t\t\n\t\t\t\t\thashes = $.map(subtree.children().find('[id]'), function(n) {\n\t\t\t\t\t\treturn id2hash(n.id);\n\t\t\t\t\t});\n\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\t$.each(hashes.reverse(), function(i, h) {\n\t\t\t\t\t\t\tdata[h] = dirs[h];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfm.storage(key, data);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Init dir at places\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tinit = function() {\n\t\t\t\t\tvar dat, hashes;\n\t\t\t\t\tkey = 'places'+(opts.suffix? opts.suffix : ''),\n\t\t\t\t\tdirs = {};\n\t\t\t\t\tdat = fm.storage(key);\n\t\t\t\t\tif (typeof dat === 'string') {\n\t\t\t\t\t\t// old data type elFinder <= 2.1.12\n\t\t\t\t\t\tdat = $.grep(dat.split(','), function(hash) { return hash? true : false;});\n\t\t\t\t\t\t$.each(dat, function(i, d) {\n\t\t\t\t\t\t\tvar dir = d.split('#');\n\t\t\t\t\t\t\tdirs[dir[0]] = dir[1]? dir[1] : dir[0];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if ($.isPlainObject(dat)) {\n\t\t\t\t\t\tdirs = dat;\n\t\t\t\t\t}\n\t\t\t\t\t// allow modify `dirs`\n\t\t\t\t\t/**\n\t\t\t\t\t * example for preset places\n\t\t\t\t\t * \n\t\t\t\t\t * elfinderInstance.bind('placesload', function(e, fm) {\n\t\t\t\t\t * \t//if (fm.storage(e.data.storageKey) === null) { // for first time only\n\t\t\t\t\t * \tif (!fm.storage(e.data.storageKey)) {           // for empty places\n\t\t\t\t\t * \t\te.data.dirs[targetHash] = fallbackName;     // preset folder\n\t\t\t\t\t * \t}\n\t\t\t\t\t * }\n\t\t\t\t\t **/\n\t\t\t\t\tfm.trigger('placesload', {dirs: dirs, storageKey: key}, true);\n\t\t\t\t\t\n\t\t\t\t\thashes = Object.keys(dirs);\n\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\troot.prepend(spinner);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'info', targets : hashes},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar exists = {};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdata.files && data.files.length && fm.cache(data.files);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$.each(data.files, function(i, f) {\n\t\t\t\t\t\t\t\tvar hash = f.hash;\n\t\t\t\t\t\t\t\texists[hash] = f;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.each(dirs, function(h, f) {\n\t\t\t\t\t\t\t\tadd(exists[h] || Object.assign({notfound: true}, f));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (fm.storage('placesState') > 0) {\n\t\t\t\t\t\t\t\troot.trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Return node for given dir object\n\t\t\t\t *\n\t\t\t\t * @param  Object  directory object\n\t\t\t\t * @return jQuery\n\t\t\t\t **/\n\t\t\t\tcreate    = function(dir, hash) {\n\t\t\t\t\treturn $(tpl.replace(/\\{id\\}/, hash2id(dir? dir.hash : hash))\n\t\t\t\t\t\t\t.replace(/\\{name\\}/, fm.escape(dir? dir.i18 || dir.name : hash))\n\t\t\t\t\t\t\t.replace(/\\{cssclass\\}/, dir? (fm.perms2class(dir) + (dir.notfound? ' elfinder-na' : '') + (dir.csscls? ' '+dir.csscls : '')) : '')\n\t\t\t\t\t\t\t.replace(/\\{permissions\\}/, (dir && (!dir.read || !dir.write || dir.notfound))? ptpl : '')\n\t\t\t\t\t\t\t.replace(/\\{title\\}/, dir? (' title=\"' + fm.escape(fm.path(dir.hash, true) || dir.i18 || dir.name) + '\"') : '')\n\t\t\t\t\t\t\t.replace(/\\{symlink\\}/, '')\n\t\t\t\t\t\t\t.replace(/\\{style\\}/, (dir && dir.icon)? fm.getIconStyle(dir) : ''));\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Add new node into places\n\t\t\t\t *\n\t\t\t\t * @param  Object  directory object\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tadd = function(dir) {\n\t\t\t\t\tvar node, hash;\n\n\t\t\t\t\tif (dir.mime !== 'directory') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\thash = dir.hash;\n\t\t\t\t\tif (!fm.files().hasOwnProperty(hash)) {\n\t\t\t\t\t\t// update cache\n\t\t\t\t\t\tfm.trigger('tree', {tree: [dir]});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tnode = create(dir, hash);\n\t\t\t\t\t\n\t\t\t\t\tdirs[hash] = dir;\n\t\t\t\t\tsubtree.prepend(node);\n\t\t\t\t\troot.addClass(collapsed);\n\t\t\t\t\tsortBtn.toggle(subtree.children().length > 1);\n\t\t\t\t\t\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Remove dir from places\n\t\t\t\t *\n\t\t\t\t * @param  String  directory hash\n\t\t\t\t * @return String  removed name\n\t\t\t\t **/\n\t\t\t\tremove = function(hash) {\n\t\t\t\t\tvar name = null, tgt, cnt;\n\n\t\t\t\t\tif (dirs[hash]) {\n\t\t\t\t\t\tdelete dirs[hash];\n\t\t\t\t\t\ttgt = hash2elm(hash);\n\t\t\t\t\t\tif (tgt.length) {\n\t\t\t\t\t\t\tname = tgt.text();\n\t\t\t\t\t\t\ttgt.parent().remove();\n\t\t\t\t\t\t\tcnt = subtree.children().length;\n\t\t\t\t\t\t\tsortBtn.toggle(cnt > 1);\n\t\t\t\t\t\t\tif (! cnt) {\n\t\t\t\t\t\t\t\troot.removeClass(collapsed);\n\t\t\t\t\t\t\t\tplaces.removeClass(expanded);\n\t\t\t\t\t\t\t\tsubtree.slideToggle(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn name;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Move up dir on places\n\t\t\t\t *\n\t\t\t\t * @param  String  directory hash\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tmoveup = function(hash) {\n\t\t\t\t\tvar self = hash2elm(hash),\n\t\t\t\t\t\ttgt  = self.parent(),\n\t\t\t\t\t\tprev = tgt.prev('div'),\n\t\t\t\t\t\tcls  = 'ui-state-hover',\n\t\t\t\t\t\tctm  = fm.getUI('contextmenu');\n\t\t\t\t\t\n\t\t\t\t\tmenuTimer && clearTimeout(menuTimer);\n\t\t\t\t\t\n\t\t\t\t\tif (prev.length) {\n\t\t\t\t\t\tctm.find(':first').data('placesHash', hash);\n\t\t\t\t\t\tself.addClass(cls);\n\t\t\t\t\t\ttgt.insertBefore(prev);\n\t\t\t\t\t\tprev = tgt.prev('div');\n\t\t\t\t\t\tmenuTimer = setTimeout(function() {\n\t\t\t\t\t\t\tself.removeClass(cls);\n\t\t\t\t\t\t\tif (ctm.find(':first').data('placesHash') === hash) {\n\t\t\t\t\t\t\t\tctm.hide().empty();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(!prev.length) {\n\t\t\t\t\t\tself.removeClass(cls);\n\t\t\t\t\t\tctm.hide().empty();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Update dir at places\n\t\t\t\t *\n\t\t\t\t * @param  Object   directory\n\t\t\t\t * @param  String   previous hash\n\t\t\t\t * @return Boolean\n\t\t\t\t **/\n\t\t\t\tupdate = function(dir, preHash) {\n\t\t\t\t\tvar hash = dir.hash,\n\t\t\t\t\t\ttgt  = hash2elm(preHash || hash),\n\t\t\t\t\t\tnode = create(dir, hash);\n\n\t\t\t\t\tif (tgt.length > 0) {\n\t\t\t\t\t\ttgt.parent().replaceWith(node);\n\t\t\t\t\t\tdirs[hash] = dir;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Remove all dir from places\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tclear = function() {\n\t\t\t\t\tsubtree.empty();\n\t\t\t\t\troot.removeClass(collapsed);\n\t\t\t\t\tplaces.removeClass(expanded);\n\t\t\t\t\tsubtree.slideToggle(false);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Sort places dirs A-Z\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t **/\n\t\t\t\tsort = function() {\n\t\t\t\t\t$.each(dirs, function(h, f) {\n\t\t\t\t\t\tvar dir = fm.file(h) || f,\n\t\t\t\t\t\t\tnode = create(dir, h),\n\t\t\t\t\t\t\tret = null;\n\t\t\t\t\t\tif (!dir) {\n\t\t\t\t\t\t\tnode.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (subtree.children().length) {\n\t\t\t\t\t\t\t$.each(subtree.children(), function() {\n\t\t\t\t\t\t\t\tvar current =  $(this);\n\t\t\t\t\t\t\t\tif ((dir.i18 || dir.name).localeCompare(current.children('.'+navdir).text()) < 0) {\n\t\t\t\t\t\t\t\t\tret = !node.insertBefore(current);\n\t\t\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (ret !== null) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t!hash2elm(h).length && subtree.append(node);\n\t\t\t\t\t});\n\t\t\t\t\tsave();\n\t\t\t\t},\n\t\t\t\t// sort button\n\t\t\t\tsortBtn = $('<span class=\"elfinder-button-icon elfinder-button-icon-sort elfinder-places-root-icon\" title=\"'+fm.i18n('cmdsort')+'\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tsubtree.empty();\n\t\t\t\t\t\tsort();\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t\t/**\n\t\t\t\t * Node - wrapper for places root\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\twrapper = create({\n\t\t\t\t\t\thash  : 'root-'+fm.namespace, \n\t\t\t\t\t\tname  : fm.i18n(opts.name, 'places'),\n\t\t\t\t\t\tread  : true,\n\t\t\t\t\t\twrite : true\n\t\t\t\t\t}),\n\t\t\t\t/**\n\t\t\t\t * Places root node\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\troot = wrapper.children('.'+navdir)\n\t\t\t\t\t.addClass(clroot)\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (root.hasClass(collapsed)) {\n\t\t\t\t\t\t\tplaces.toggleClass(expanded);\n\t\t\t\t\t\t\tsubtree.slideToggle();\n\t\t\t\t\t\t\tfm.storage('placesState', places.hasClass(expanded)? 1 : 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.append(sortBtn),\n\t\t\t\t/**\n\t\t\t\t * Container for dirs\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\tsubtree = wrapper.children('.'+fm.res(c, 'navsubtree')),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Main places container\n\t\t\t\t *\n\t\t\t\t * @type jQuery\n\t\t\t\t **/\n\t\t\t\tplaces = $(this).addClass(fm.res(c, 'tree')+' elfinder-places ui-corner-all')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.append(wrapper)\n\t\t\t\t\t.appendTo(fm.getUI('navbar'))\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+navdir, function(e) {\n\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', (e.type == 'mouseenter'));\n\t\t\t\t\t})\n\t\t\t\t\t.on('click', '.'+navdir, function(e) {\n\t\t\t\t\t\tvar p = $(this);\n\t\t\t\t\t\tif (p.data('longtap')) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t! p.hasClass('elfinder-na') && fm.exec('open', p.attr('id').substr(6));\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu', '.'+navdir+':not(.'+clroot+')', function(e) {\n\t\t\t\t\t\tvar self = $(this),\n\t\t\t\t\t\t\thash = self.attr('id').substr(6);\n\t\t\t\t\t\t\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw : [{\n\t\t\t\t\t\t\t\tlabel    : fm.i18n('moveUp'),\n\t\t\t\t\t\t\t\ticon     : 'up',\n\t\t\t\t\t\t\t\tremain   : true,\n\t\t\t\t\t\t\t\tcallback : function() { moveup(hash); save(); }\n\t\t\t\t\t\t\t},'|',{\n\t\t\t\t\t\t\t\tlabel    : fm.i18n('rmFromPlaces'),\n\t\t\t\t\t\t\t\ticon     : 'rm',\n\t\t\t\t\t\t\t\tcallback : function() { remove(hash); save(); }\n\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.getUI('contextmenu').children().on('mouseenter', function() {\n\t\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.bind('closecontextmenu', function() {\n\t\t\t\t\t\t\tself.removeClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.droppable({\n\t\t\t\t\t\ttolerance  : 'pointer',\n\t\t\t\t\t\taccept     : '.elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file',\n\t\t\t\t\t\thoverClass : fm.res('class', 'adroppable'),\n\t\t\t\t\t\tclasses    : { // Deprecated hoverClass jQueryUI>=1.12.0\n\t\t\t\t\t\t\t'ui-droppable-hover': fm.res('class', 'adroppable')\n\t\t\t\t\t\t},\n\t\t\t\t\t\tover       : function(e, ui) {\n\t\t\t\t\t\t\tvar helper = ui.helper,\n\t\t\t\t\t\t\t\tdir    = $.grep(helper.data('files'), function(h) { return (fm.file(h).mime === 'directory' && !dirs[h])? true : false; });\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\thelper.data('dropover', helper.data('dropover') + 1);\n\t\t\t\t\t\t\tif (fm.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\t\t\t\tif (dir.length > 0) {\n\t\t\t\t\t\t\t\t\thelper.addClass('elfinder-drag-helper-plus');\n\t\t\t\t\t\t\t\t\tfm.trigger('unlockfiles', {files : helper.data('files'), helper: helper});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$(this).removeClass(dropover);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tout : function(e, ui) {\n\t\t\t\t\t\t\tvar helper = ui.helper;\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus').data('dropover', Math.max(helper.data('dropover') - 1, 0));\n\t\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t\t       .removeClass(dropover);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdrop       : function(e, ui) {\n\t\t\t\t\t\t\tvar helper  = ui.helper,\n\t\t\t\t\t\t\t\tresolve = true;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$.each(helper.data('files'), function(i, hash) {\n\t\t\t\t\t\t\t\tvar dir = fm.file(hash);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (dir && dir.mime == 'directory' && !dirs[dir.hash]) {\n\t\t\t\t\t\t\t\t\tadd(dir);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t\tresolve && helper.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// for touch device\n\t\t\t\t\t.on('touchstart', '.'+navdir+':not(.'+clroot+')', function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar hash = $(this).attr('id').substr(6),\n\t\t\t\t\t\tp = $(this)\n\t\t\t\t\t\t.addClass(hover)\n\t\t\t\t\t\t.data('longtap', null)\n\t\t\t\t\t\t.data('tmlongtap', setTimeout(function(){\n\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\tp.data('longtap', true);\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\traw : [{\n\t\t\t\t\t\t\t\t\tlabel    : fm.i18n('rmFromPlaces'),\n\t\t\t\t\t\t\t\t\ticon     : 'rm',\n\t\t\t\t\t\t\t\t\tcallback : function() { remove(hash); save(); }\n\t\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\t\t'x'       : e.originalEvent.touches[0].pageX,\n\t\t\t\t\t\t\t\t'y'       : e.originalEvent.touches[0].pageY\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 500));\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchmove touchend', '.'+navdir+':not(.'+clroot+')', function(e) {\n\t\t\t\t\t\tclearTimeout($(this).data('tmlongtap'));\n\t\t\t\t\t\tif (e.type == 'touchmove') {\n\t\t\t\t\t\t\t$(this).removeClass(hover);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\tif ($.fn.sortable) {\n\t\t\t\tsubtree.addClass('touch-punch')\n\t\t\t\t.sortable({\n\t\t\t\t\tappendTo : fm.getUI(),\n\t\t\t\t\trevert   : false,\n\t\t\t\t\thelper   : function(e) {\n\t\t\t\t\t\tvar dir = $(e.target).parent();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tdir.children().removeClass('ui-state-hover');\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn $('<div class=\"ui-widget elfinder-place-drag elfinder-'+fm.direction+'\"/>')\n\t\t\t\t\t\t\t\t.append($('<div class=\"elfinder-navbar\"/>').show().append(dir.clone()));\n\n\t\t\t\t\t},\n\t\t\t\t\tstop     : function(e, ui) {\n\t\t\t\t\t\tvar target = $(ui.item[0]),\n\t\t\t\t\t\t\ttop    = places.offset().top,\n\t\t\t\t\t\t\tleft   = places.offset().left,\n\t\t\t\t\t\t\twidth  = places.width(),\n\t\t\t\t\t\t\theight = places.height(),\n\t\t\t\t\t\t\tx      = e.pageX,\n\t\t\t\t\t\t\ty      = e.pageY;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!(x > left && x < left+width && y > top && y < y+height)) {\n\t\t\t\t\t\t\tremove(id2hash(target.children(':first').attr('id')));\n\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tupdate   : function(e, ui) {\n\t\t\t\t\t\tsave();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// \"on regist\" for command exec\n\t\t\t$(this).on('regist', function(e, files){\n\t\t\t\tvar added = false;\n\t\t\t\t$.each(files, function(i, dir) {\n\t\t\t\t\tif (dir && dir.mime == 'directory' && !dirs[dir.hash]) {\n\t\t\t\t\t\tif (add(dir)) {\n\t\t\t\t\t\t\tadded = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tadded && save();\n\t\t\t});\n\t\t\n\n\t\t\t// on fm load - show places and load files from backend\n\t\t\tfm.one('load', function() {\n\t\t\t\tvar dat, hashes;\n\t\t\t\t\n\t\t\t\tif (fm.oldAPI) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tplaces.show().parent().show();\n\n\t\t\t\tinit();\n\n\t\t\t\tfm.change(function(e) {\n\t\t\t\t\tvar changed = false;\n\t\t\t\t\t$.each(e.data.changed, function(i, file) {\n\t\t\t\t\t\tif (dirs[file.hash]) {\n\t\t\t\t\t\t\tif (file.mime !== 'directory') {\n\t\t\t\t\t\t\t\tif (remove(file.hash)) {\n\t\t\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (update(file)) {\n\t\t\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tchanged && save();\n\t\t\t\t})\n\t\t\t\t.bind('rename', function(e) {\n\t\t\t\t\tvar changed = false;\n\t\t\t\t\tif (e.data.removed) {\n\t\t\t\t\t\t$.each(e.data.removed, function(i, hash) {\n\t\t\t\t\t\t\tif (e.data.added[i]) {\n\t\t\t\t\t\t\t\tif (update(e.data.added[i], hash)) {\n\t\t\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tchanged && save();\n\t\t\t\t})\n\t\t\t\t.bind('rm paste', function(e) {\n\t\t\t\t\tvar names = [],\n\t\t\t\t\t\tchanged = false;\n\t\t\t\t\tif (e.data.removed) {\n\t\t\t\t\t\t$.each(e.data.removed, function(i, hash) {\n\t\t\t\t\t\t\tvar name = remove(hash);\n\t\t\t\t\t\t\tname && names.push(name);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (names.length) {\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (e.data.added && names.length) {\n\t\t\t\t\t\t$.each(e.data.added, function(i, file) {\n\t\t\t\t\t\t\tif ($.inArray(file.name, names) !== 1) {\n\t\t\t\t\t\t\t\tfile.mime == 'directory' && add(file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tchanged && save();\n\t\t\t\t})\n\t\t\t\t.bind('sync netmount', function() {\n\t\t\t\t\tvar ev = this,\n\t\t\t\t\t\topSuffix = opts.suffix? opts.suffix : '',\n\t\t\t\t\t\thashes;\n\t\t\t\t\t\n\t\t\t\t\tif (ev.type === 'sync') {\n\t\t\t\t\t\t// check is change of opts.suffix\n\t\t\t\t\t\tif (suffix !== opSuffix) {\n\t\t\t\t\t\t\tsuffix = opSuffix;\n\t\t\t\t\t\t\tclear();\n\t\t\t\t\t\t\tinit();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\thashes = Object.keys(dirs);\n\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\troot.prepend(spinner);\n\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'info', targets : hashes},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar exists  = {},\n\t\t\t\t\t\t\t\tupdated = false,\n\t\t\t\t\t\t\t\tcwd     = fm.cwd().hash;\n\t\t\t\t\t\t\t$.each(data.files || [], function(i, file) {\n\t\t\t\t\t\t\t\tvar hash = file.hash;\n\t\t\t\t\t\t\t\texists[hash] = file;\n\t\t\t\t\t\t\t\tif (!fm.files().hasOwnProperty(file.hash)) {\n\t\t\t\t\t\t\t\t\t// update cache\n\t\t\t\t\t\t\t\t\tfm.updateCache({tree: [file]});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$.each(dirs, function(h, f) {\n\t\t\t\t\t\t\t\tif (Boolean(f.notfound) === Boolean(exists[h])) {\n\t\t\t\t\t\t\t\t\tif ((f.phash === cwd && ev.type !== 'netmount') || (exists[h] && exists[h].mime !== 'directory')) {\n\t\t\t\t\t\t\t\t\t\tif (remove(h)) {\n\t\t\t\t\t\t\t\t\t\t\tupdated = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (update(exists[h] || Object.assign({notfound: true}, f))) {\n\t\t\t\t\t\t\t\t\t\t\tupdated = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if (exists[h] && exists[h].phash != cwd) {\n\t\t\t\t\t\t\t\t\t// update permission of except cwd\n\t\t\t\t\t\t\t\t\tupdate(exists[h]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tupdated && save();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/searchbutton',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar search button widget.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindersearchbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar result = false,\n\t\t\t\tfm     = cmd.fm,\n\t\t\t\tdisabled = fm.res('class', 'disabled'),\n\t\t\t\tisopts = cmd.options.incsearch || { enable: false },\n\t\t\t\tsTypes = cmd.options.searchTypes,\n\t\t\t\tid     = function(name){return fm.namespace + fm.escape(name);},\n\t\t\t\ttoolbar= fm.getUI('toolbar'),\n\t\t\t\tbtnCls = fm.res('class', 'searchbtn'),\n\t\t\t\tbutton = $(this)\n\t\t\t\t\t.hide()\n\t\t\t\t\t.addClass('ui-widget-content elfinder-button '+btnCls)\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}),\n\t\t\t\tgetMenuOffset = function() {\n\t\t\t\t\tvar fmNode = fm.getUI(),\n\t\t\t\t\t\tbaseOffset = fmNode.offset(),\n\t\t\t\t\t\tbuttonOffset = button.offset();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttop : buttonOffset.top - baseOffset.top,\n\t\t\t\t\t\tmaxHeight : fmNode.height() - 40\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tsearch = function() {\n\t\t\t\t\tinput.data('inctm') && clearTimeout(input.data('inctm'));\n\t\t\t\t\tvar val = $.trim(input.val()),\n\t\t\t\t\t\tfrom = !$('#' + id('SearchFromAll')).prop('checked'),\n\t\t\t\t\t\tmime = $('#' + id('SearchMime')).prop('checked'),\n\t\t\t\t\t\ttype = '';\n\t\t\t\t\tif (from) {\n\t\t\t\t\t\tif ($('#' + id('SearchFromVol')).prop('checked')) {\n\t\t\t\t\t\t\tfrom = fm.root(fm.cwd().hash);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrom = fm.cwd().hash;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (mime) {\n\t\t\t\t\t\tmime = val;\n\t\t\t\t\t\tval = '.';\n\t\t\t\t\t}\n\t\t\t\t\tif (typeSet) {\n\t\t\t\t\t\ttype = typeSet.children('input:checked').val();\n\t\t\t\t\t}\n\t\t\t\t\tif (val) {\n\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t\tcmd.exec(val, from, mime, type).done(function() {\n\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\tabort();\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.trigger('searchend');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tabort = function() {\n\t\t\t\t\tinput.data('inctm') && clearTimeout(input.data('inctm'));\n\t\t\t\t\tinput.val('').trigger('blur');\n\t\t\t\t\tif (result || incVal) {\n\t\t\t\t\t\tresult = false;\n\t\t\t\t\t\tincVal = '';\n\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\tfm.trigger('searchend');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tincVal = '',\n\t\t\t\tinput  = $('<input type=\"text\" size=\"42\"/>')\n\t\t\t\t\t.on('focus', function() {\n\t\t\t\t\t\t// close other menus\n\t\t\t\t\t\t!button.hasClass('ui-state-active') && fm.getUI().click();\n\t\t\t\t\t\tinFocus = true;\n\t\t\t\t\t\tincVal = '';\n\t\t\t\t\t\tbutton.addClass('ui-state-active');\n\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t\topts && opts.css(getMenuOffset()).slideDown(function() {\n\t\t\t\t\t\t\t// Care for on browser window re-active\n\t\t\t\t\t\t\tbutton.addClass('ui-state-active');\n\t\t\t\t\t\t\tfm.toFront(opts);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('blur', function() {\n\t\t\t\t\t\tinFocus = false;\n\t\t\t\t\t\tif (opts) {\n\t\t\t\t\t\t\tif (!opts.data('infocus')) {\n\t\t\t\t\t\t\t\topts.slideUp(function() {\n\t\t\t\t\t\t\t\t\tbutton.removeClass('ui-state-active');\n\t\t\t\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t\t\t\t\tfm.toHide(opts);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topts.data('infocus', false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbutton.removeClass('ui-state-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.appendTo(button)\n\t\t\t\t\t// to avoid fm shortcuts on arrows\n\t\t\t\t\t.on('keypress', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (e.keyCode === $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\tsearch();\n\t\t\t\t\t\t} else if (e.keyCode === $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tabort();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\topts, typeSet, cwdReady, inFocus;\n\t\t\t\n\t\t\tif (isopts.enable) {\n\t\t\t\tisopts.minlen = isopts.minlen || 2;\n\t\t\t\tisopts.wait = isopts.wait || 500;\n\t\t\t\tinput\n\t\t\t\t\t.attr('title', fm.i18n('incSearchOnly'))\n\t\t\t\t\t.on('compositionstart', function() {\n\t\t\t\t\t\tinput.data('composing', true);\n\t\t\t\t\t})\n\t\t\t\t\t.on('compositionend', function() {\n\t\t\t\t\t\tinput.removeData('composing');\n\t\t\t\t\t\tinput.trigger('input'); // for IE, edge\n\t\t\t\t\t})\n\t\t\t\t\t.on('input', function() {\n\t\t\t\t\t\tif (! input.data('composing')) {\n\t\t\t\t\t\t\tinput.data('inctm') && clearTimeout(input.data('inctm'));\n\t\t\t\t\t\t\tinput.data('inctm', setTimeout(function() {\n\t\t\t\t\t\t\t\tvar val = input.val();\n\t\t\t\t\t\t\t\tif (val.length === 0 || val.length >= isopts.minlen) {\n\t\t\t\t\t\t\t\t\t(incVal !== val) && fm.trigger('incsearchstart', {\n\t\t\t\t\t\t\t\t\t\tquery: val,\n\t\t\t\t\t\t\t\t\t\ttype: typeSet? typeSet.children('input:checked').val() : 'searchName'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tincVal = val;\n\t\t\t\t\t\t\t\t\tif (val === '' && fm.searchStatus.state > 1 && fm.searchStatus.query) {\n\t\t\t\t\t\t\t\t\t\tinput.val(fm.searchStatus.query).trigger('select');\n\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, isopts.wait));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (fm.UA.ltIE8) {\n\t\t\t\t\tinput.on('keydown', function(e) {\n\t\t\t\t\t\t\tif (e.keyCode === 229) {\n\t\t\t\t\t\t\t\tinput.data('imetm') && clearTimeout(input.data('imetm'));\n\t\t\t\t\t\t\t\tinput.data('composing', true);\n\t\t\t\t\t\t\t\tinput.data('imetm', setTimeout(function() {\n\t\t\t\t\t\t\t\t\tinput.removeData('composing');\n\t\t\t\t\t\t\t\t}, 100));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('keyup', function(e) {\n\t\t\t\t\t\t\tinput.data('imetm') && clearTimeout(input.data('imetm'));\n\t\t\t\t\t\t\tif (input.data('composing')) {\n\t\t\t\t\t\t\t\te.keyCode === $.ui.keyCode.ENTER && input.trigger('compositionend');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tinput.trigger('input');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t$('<span class=\"ui-icon ui-icon-search\" title=\"'+cmd.title+'\"/>')\n\t\t\t\t.appendTo(button)\n\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (button.hasClass('ui-state-active')) {\n\t\t\t\t\t\tsearch();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t\t$('<span class=\"ui-icon ui-icon-close\"/>')\n\t\t\t\t.appendTo(button)\n\t\t\t\t.on('mousedown', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (input.val() === '' && !button.hasClass('ui-state-active')) {\n\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tabort();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\n\t\t\t// wait when button will be added to DOM\n\t\t\tfm.bind('toolbarload', function(){\n\t\t\t\tvar parent = button.parent();\n\t\t\t\tif (parent.length) {\n\t\t\t\t\ttoolbar.prepend(button.show());\n\t\t\t\t\tparent.remove();\n\t\t\t\t\t// position icons for ie7\n\t\t\t\t\tif (fm.UA.ltIE7) {\n\t\t\t\t\t\tvar icon = button.children(fm.direction == 'ltr' ? '.ui-icon-close' : '.ui-icon-search');\n\t\t\t\t\t\ticon.css({\n\t\t\t\t\t\t\tright : '',\n\t\t\t\t\t\t\tleft  : parseInt(button.width())-icon.outerWidth(true)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tfm\n\t\t\t\t.one('init', function() {\n\t\t\t\t\tfm.getUI('cwd').on('touchstart click', function() {\n\t\t\t\t\t\tinFocus && input.trigger('blur');\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.one('open', function() {\n\t\t\t\t\topts = (fm.api < 2.1)? null : $('<div class=\"ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-search-menu ui-corner-all\"/>')\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<div class=\"buttonset\"/>')\n\t\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchFromCwd')+'\" name=\"serchfrom\" type=\"radio\" checked=\"checked\"/><label for=\"'+id('SearchFromCwd')+'\">'+fm.i18n('btnCwd')+'</label>'),\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchFromVol')+'\" name=\"serchfrom\" type=\"radio\"/><label for=\"'+id('SearchFromVol')+'\">'+fm.i18n('btnVolume')+'</label>'),\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchFromAll')+'\" name=\"serchfrom\" type=\"radio\"/><label for=\"'+id('SearchFromAll')+'\">'+fm.i18n('btnAll')+'</label>')\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$('<div class=\"buttonset elfinder-search-type\"/>')\n\t\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\t\t$('<input id=\"'+id('SearchName')+'\" name=\"serchcol\" type=\"radio\" checked=\"checked\" value=\"SearchName\"/><label for=\"'+id('SearchName')+'\">'+fm.i18n('btnFileName')+'</label>')\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t.appendTo(fm.getUI());\n\t\t\t\t\tif (opts) {\n\t\t\t\t\t\tif (sTypes) {\n\t\t\t\t\t\t\ttypeSet = opts.find('.elfinder-search-type');\n\t\t\t\t\t\t\t$.each(cmd.options.searchTypes, function(i, v) {\n\t\t\t\t\t\t\t\ttypeSet.append($('<input id=\"'+id(i)+'\" name=\"serchcol\" type=\"radio\" value=\"'+fm.escape(i)+'\"/><label for=\"'+id(i)+'\">'+fm.i18n(v.name)+'</label>'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\topts.find('div.buttonset').buttonset();\n\t\t\t\t\t\t$('#'+id('SearchFromAll')).next('label').attr('title', fm.i18n('searchTarget', fm.i18n('btnAll')));\n\t\t\t\t\t\tif (sTypes) {\n\t\t\t\t\t\t\t$.each(sTypes, function(i, v) {\n\t\t\t\t\t\t\t\tif (v.title) {\n\t\t\t\t\t\t\t\t\t$('#'+id(i)).next('label').attr('title', fm.i18n(v.title));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\topts.on('mousedown', 'div.buttonset', function(e){\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\topts.data('infocus', true);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('click', 'input', function(e) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t$.trim(input.val())? search() : input.trigger('focus');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('close', function() {\n\t\t\t\t\t\t\t\tinput.trigger('blur');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('searchend', function() {\n\t\t\t\t\tinput.val('');\n\t\t\t\t})\n\t\t\t\t.bind('open parents', function() {\n\t\t\t\t\tvar dirs    = [],\n\t\t\t\t\t\tvolroot = fm.file(fm.root(fm.cwd().hash));\n\t\t\t\t\t\n\t\t\t\t\tif (volroot) {\n\t\t\t\t\t\t$.each(fm.parents(fm.cwd().hash), function(i, hash) {\n\t\t\t\t\t\t\tdirs.push(fm.file(hash).name);\n\t\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t\t$('#'+id('SearchFromCwd')).next('label').attr('title', fm.i18n('searchTarget', dirs.join(fm.option('separator'))));\n\t\t\t\t\t\t$('#'+id('SearchFromVol')).next('label').attr('title', fm.i18n('searchTarget', volroot.name));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.bind('open', function() {\n\t\t\t\t\tincVal && abort();\n\t\t\t\t})\n\t\t\t\t.bind('cwdinit', function() {\n\t\t\t\t\tcwdReady = false;\n\t\t\t\t})\n\t\t\t\t.bind('cwdrender',function() {\n\t\t\t\t\tcwdReady = true;\n\t\t\t\t})\n\t\t\t\t.bind('keydownEsc', function() {\n\t\t\t\t\tif (incVal && incVal.substr(0, 1) === '/') {\n\t\t\t\t\t\tincVal = '';\n\t\t\t\t\t\tinput.val('');\n\t\t\t\t\t\tfm.trigger('searchend');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'ctrl+f f3',\n\t\t\t\t\tdescription : cmd.title,\n\t\t\t\t\tcallback    : function() { \n\t\t\t\t\t\tinput.trigger('select').trigger('focus');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.shortcut({\n\t\t\t\t\tpattern     : 'a b c d e f g h i j k l m n o p q r s t u v w x y z dig0 dig1 dig2 dig3 dig4 dig5 dig6 dig7 dig8 dig9 num0 num1 num2 num3 num4 num5 num6 num7 num8 num9',\n\t\t\t\t\tdescription : fm.i18n('firstLetterSearch'),\n\t\t\t\t\tcallback    : function(e) { \n\t\t\t\t\t\tif (! cwdReady) { return; }\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar code = e.originalEvent.keyCode,\n\t\t\t\t\t\t\tnext = function() {\n\t\t\t\t\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\t\t\t\t\tkey = $.ui.keyCode[(!sel.length || fm.cwdHash2Elm(sel[0]).next('[id]').length)? 'RIGHT' : 'HOME'];\n\t\t\t\t\t\t\t\t$(document).trigger($.Event('keydown', { keyCode: key, ctrlKey : false, shiftKey : false, altKey : false, metaKey : false }));\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tval;\n\t\t\t\t\t\tif (code >= 96 && code <= 105) {\n\t\t\t\t\t\t\tcode -= 48;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tval = '/' + String.fromCharCode(code);\n\t\t\t\t\t\tif (incVal !== val) {\n\t\t\t\t\t\t\tinput.val(val);\n\t\t\t\t\t\t\tincVal = val;\n\t\t\t\t\t\t\tfm\n\t\t\t\t\t\t\t\t.trigger('incsearchstart', { query: val })\n\t\t\t\t\t\t\t\t.one('cwdrender', next);\n\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/sortbutton',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar button menu with sort variants.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindersortbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar fm       = cmd.fm,\n\t\t\t\tname     = cmd.name,\n\t\t\t\tc        = 'class',\n\t\t\t\tdisabled = fm.res(c, 'disabled'),\n\t\t\t\thover    = fm.res(c, 'hover'),\n\t\t\t\titem     = 'elfinder-button-menu-item',\n\t\t\t\tselected = item+'-selected',\n\t\t\t\tasc      = selected+'-asc',\n\t\t\t\tdesc     = selected+'-desc',\n\t\t\t\ttext     = $('<span class=\"elfinder-button-text\">'+cmd.title+'</span>'),\n\t\t\t\tbutton   = $(this).addClass('ui-state-default elfinder-button elfinder-menubutton elfiner-button-'+name)\n\t\t\t\t\t.attr('title', cmd.title)\n\t\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-'+name+'\"/>', text)\n\t\t\t\t\t.on('mouseenter mouseleave', function(e) { !button.hasClass(disabled) && button.toggleClass(hover, e.type === 'mouseenter'); })\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\tif (!button.hasClass(disabled)) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tmenu.is(':hidden') && fm.getUI().click();\n\t\t\t\t\t\t\tmenu.css(getMenuOffset()).slideToggle({\n\t\t\t\t\t\t\t\tduration: 100,\n\t\t\t\t\t\t\t\tdone: function(e) {\n\t\t\t\t\t\t\t\t\tfm[menu.is(':visible')? 'toFront' : 'toHide'](menu);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\thide = function() { fm.toHide(menu); },\n\t\t\t\tmenu = $('<div class=\"ui-front ui-widget ui-widget-content elfinder-button-menu elfinder-button-sort-menu ui-corner-all\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.appendTo(fm.getUI())\n\t\t\t\t\t.on('mouseenter mouseleave', '.'+item, function(e) { $(this).toggleClass(hover, e.type === 'mouseenter'); })\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.on('close', hide),\n\t\t\t\tupdate = function() {\n\t\t\t\t\tmenu.children('[rel]').removeClass(selected+' '+asc+' '+desc)\n\t\t\t\t\t\t.filter('[rel=\"'+fm.sortType+'\"]')\n\t\t\t\t\t\t.addClass(selected+' '+(fm.sortOrder == 'asc' ? asc : desc));\n\n\t\t\t\t\tmenu.children('.elfinder-sort-stick').toggleClass(selected, fm.sortStickFolders);\n\t\t\t\t\tmenu.children('.elfinder-sort-tree').toggleClass(selected, fm.sortAlsoTreeview);\n\t\t\t\t},\n\t\t\t\tgetMenuOffset = function() {\n\t\t\t\t\tvar baseOffset = fm.getUI().offset(),\n\t\t\t\t\t\tbuttonOffset = button.offset();\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttop : buttonOffset.top - baseOffset.top,\n\t\t\t\t\t\tleft : buttonOffset.left - baseOffset.left\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\ttm;\n\t\t\t\t\n\t\t\ttext.hide();\n\t\t\t\n\t\t\t$.each(fm.sortRules, function(name, value) {\n\t\t\t\tmenu.append($('<div class=\"'+item+'\" rel=\"'+name+'\"><span class=\"ui-icon ui-icon-arrowthick-1-n\"/><span class=\"ui-icon ui-icon-arrowthick-1-s\"/>'+fm.i18n('sort'+name)+'</div>').data('type', name));\n\t\t\t});\n\t\t\t\n\t\t\tmenu.children().on('click', function(e) {\n\t\t\t\tcmd.exec([], $(this).removeClass(hover).attr('rel'));\n\t\t\t});\n\t\t\t\n\t\t\t$('<div class=\"'+item+' '+item+'-separated elfinder-sort-ext elfinder-sort-stick\"><span class=\"ui-icon ui-icon-check\"/>'+fm.i18n('sortFoldersFirst')+'</div>')\n\t\t\t\t.appendTo(menu)\n\t\t\t\t.on('click', function() {\n\t\t\t\t\tcmd.exec([], 'stick');\n\t\t\t\t});\n\n\t\t\tfm.one('init', function() {\n\t\t\t\tif (fm.ui.tree && fm.options.sortAlsoTreeview !== null) {\n\t\t\t\t\t$('<div class=\"'+item+' '+item+'-separated elfinder-sort-ext elfinder-sort-tree\"><span class=\"ui-icon ui-icon-check\"/>'+fm.i18n('sortAlsoTreeview')+'</div>')\n\t\t\t\t\t.appendTo(menu)\n\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\tcmd.exec([], 'tree');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('disable select', hide)\n\t\t\t.bind('sortchange', update).getUI().on('click', hide);\n\t\t\t\n\t\t\tif (menu.children().length > 1) {\n\t\t\t\tcmd.change(function() {\n\t\t\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\tbutton.toggleClass(disabled, cmd.disabled());\n\t\t\t\t\t\t\tupdate();\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.change();\n\t\t\t} else {\n\t\t\t\tbutton.addClass(disabled);\n\t\t\t}\n\n\t\t});\n\t\t\n\t};\n\n});\ndefine('skylark-elfinder/ui/stat',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elFinder ui\n\t * Display number of files/selected files and its size in statusbar\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderstat = function(fm) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar size       = $(this).addClass('elfinder-stat-size'),\n\t\t\t\tsel        = $('<div class=\"elfinder-stat-selected\"/>')\n\t\t\t\t\t.on('click', 'a', function(e) {\n\t\t\t\t\t\tvar hash = $(this).data('hash');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfm.exec('opendir', [ hash ]);\n\t\t\t\t\t}),\n\t\t\t\ttitleitems = fm.i18n('items'),\n\t\t\t\ttitlesel   = fm.i18n('selected'),\n\t\t\t\ttitlesize  = fm.i18n('size'),\n\t\t\t\tsetstat    = function(files) {\n\t\t\t\t\tvar c = 0, \n\t\t\t\t\t\ts = 0,\n\t\t\t\t\t\tcwd = fm.cwd(),\n\t\t\t\t\t\tcalc = true,\n\t\t\t\t\t\thasSize = true;\n\n\t\t\t\t\tif (cwd.sizeInfo || cwd.size) {\n\t\t\t\t\t\ts = cwd.size;\n\t\t\t\t\t\tcalc = false;\n\t\t\t\t\t}\n\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\tc++;\n\t\t\t\t\t\tif (calc) {\n\t\t\t\t\t\t\ts += parseInt(file.size) || 0;\n\t\t\t\t\t\t\tif (hasSize === true && file.mime === 'directory' && !file.sizeInfo) {\n\t\t\t\t\t\t\t\thasSize = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tsize.html(titleitems+': <span class=\"elfinder-stat-incsearch\"></span>'+c+',&nbsp;<span class=\"elfinder-stat-size'+(hasSize? ' elfinder-stat-size-recursive' : '')+'\">'+fm.i18n(hasSize? 'sum' : 'size')+': '+fm.formatSize(s)+'</span>')\n\t\t\t\t\t\t.attr('title', size.text());\n\t\t\t\t\tfm.trigger('uistatchange');\n\t\t\t\t},\n\t\t\t\tsetIncsearchStat = function(data) {\n\t\t\t\t\tsize.find('span.elfinder-stat-incsearch').html(data? data.hashes.length + ' / ' : '');\n\t\t\t\t\tsize.attr('title', size.text());\n\t\t\t\t\tfm.trigger('uistatchange');\n\t\t\t\t},\n\t\t\t\tsetSelect = function(files) {\n\t\t\t\t\tvar s = 0,\n\t\t\t\t\t\tc = 0,\n\t\t\t\t\t\tdirs = [],\n\t\t\t\t\t\tpath, file;\n\n\t\t\t\t\tif (files.length === 1) {\n\t\t\t\t\t\tfile = files[0];\n\t\t\t\t\t\ts = file.size;\n\t\t\t\t\t\tif (fm.searchStatus.state === 2) {\n\t\t\t\t\t\t\tpath = fm.escape(file.path? file.path.replace(/\\/[^\\/]*$/, '') : '..');\n\t\t\t\t\t\t\tdirs.push('<a href=\"#elf_'+file.phash+'\" data-hash=\"'+file.hash+'\" title=\"'+path+'\">'+path+'</a>');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdirs.push(fm.escape(file.i18 || file.name));\n\t\t\t\t\t\tsel.html(dirs.join('/') + (s > 0 ? ', '+fm.formatSize(s) : ''));\n\t\t\t\t\t} else if (files.length) {\n\t\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t\ts += parseInt(file.size)||0;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsel.html(c ? titlesel+': '+c+', '+titlesize+': '+fm.formatSize(s) : '&nbsp;');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsel.html('');\n\t\t\t\t\t}\n\t\t\t\t\tsel.attr('title', sel.text());\n\t\t\t\t\tfm.trigger('uistatchange');\n\t\t\t\t};\n\n\t\t\tfm.getUI('statusbar').prepend(size).append(sel).show();\n\t\t\tif (fm.UA.Mobile && $.fn.tooltip) {\n\t\t\t\tfm.getUI('statusbar').tooltip({\n\t\t\t\t\tclasses: {\n\t\t\t\t\t\t'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'\n\t\t\t\t\t},\n\t\t\t\t\ttooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',\n\t\t\t\t\ttrack: true\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tfm\n\t\t\t.bind('cwdhasheschange', function(e) {\n\t\t\t\tsetstat($.map(e.data, function(h) { return fm.file(h); }));\n\t\t\t})\n\t\t\t.change(function(e) {\n\t\t\t\tvar files = e.data.changed || [],\n\t\t\t\t\tcwdHash = fm.cwd().hash;\n\t\t\t\t$.each(files, function() {\n\t\t\t\t\tif (this.hash === cwdHash) {\n\t\t\t\t\t\tif (this.size) {\n\t\t\t\t\t\t\tsize.children('.elfinder-stat-size').addClass('elfinder-stat-size-recursive').html(fm.i18n('sum')+': '+fm.formatSize(this.size));\n\t\t\t\t\t\t\tsize.attr('title', size.text());\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.select(function() {\n\t\t\t\tsetSelect(fm.selectedFiles());\n\t\t\t})\n\t\t\t.bind('open', function() {\n\t\t\t\tsetSelect([]);\n\t\t\t})\n\t\t\t.bind('incsearch', function(e) {\n\t\t\t\tsetIncsearchStat(e.data);\n\t\t\t})\n\t\t\t.bind('incsearchend', function() {\n\t\t\t\tsetIncsearchStat();\n\t\t\t})\n\t\t\t;\n\t\t});\n\t};\n\n\treturn $;\n});\n\ndefine('skylark-elfinder/ui/toast',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toast\n\t * \n\t * This was created inspired by the toastr. Thanks to developers of toastr.\n\t * CodeSeven/toastr: http://johnpapa.net <https://github.com/CodeSeven/toastr>\n\t *\n\t * @author Naoki Sawada\n\t **/\n\t$.fn.elfindertoast = function(opts, fm) {\n\t\t\"use strict\";\n\t\tvar defOpts = Object.assign({\n\t\t\tmode: 'success', // or 'info', 'warning' and 'error'\n\t\t\tmsg: '',\n\t\t\tshowMethod: 'fadeIn', //fadeIn, slideDown, and show are built into jQuery\n\t\t\tshowDuration: 300,\n\t\t\tshowEasing: 'swing', //swing and linear are built into jQuery\n\t\t\tonShown: undefined,\n\t\t\thideMethod: 'fadeOut',\n\t\t\thideDuration: 1500,\n\t\t\thideEasing: 'swing',\n\t\t\tonHidden: undefined,\n\t\t\ttimeOut: 3000,\n\t\t\textNode: undefined,\n\t\t\tbutton: undefined,\n\t\t\twidth: undefined\n\t\t}, $.isPlainObject(fm.options.uiOptions.toast.defaults)? fm.options.uiOptions.toast.defaults : {});\n\t\treturn this.each(function() {\n\t\t\topts = Object.assign({}, defOpts, opts || {});\n\t\t\t\n\t\t\tvar self = $(this),\n\t\t\t\tshow = function(notm) {\n\t\t\t\t\tself.stop();\n\t\t\t\t\tfm.toFront(self);\n\t\t\t\t\tself[opts.showMethod]({\n\t\t\t\t\t\tduration: opts.showDuration,\n\t\t\t\t\t\teasing: opts.showEasing,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\topts.onShown && opts.onShown();\n\t\t\t\t\t\t\tif (!notm && opts.timeOut) {\n\t\t\t\t\t\t\t\trmTm = setTimeout(rm, opts.timeOut);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\trm = function() {\n\t\t\t\t\tself[opts.hideMethod]({\n\t\t\t\t\t\tduration: opts.hideDuration,\n\t\t\t\t\t\teasing: opts.hideEasing,\n\t\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\t\topts.onHidden && opts.onHidden();\n\t\t\t\t\t\t\tself.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\trmTm;\n\t\t\t\n\t\t\tself.on('click', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\trmTm && clearTimeout(rmTm);\n\t\t\t\topts.onHidden && opts.onHidden();\n\t\t\t\tself.stop().remove();\n\t\t\t}).on('mouseenter mouseleave', function(e) {\n\t\t\t\tif (opts.timeOut) {\n\t\t\t\t\trmTm && clearTimeout(rmTm);\n\t\t\t\t\trmTm = null;\n\t\t\t\t\tif (e.type === 'mouseenter') {\n\t\t\t\t\t\tshow(true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trmTm = setTimeout(rm, opts.timeOut);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).hide().addClass('toast-' + opts.mode).append($('<div class=\"elfinder-toast-msg\"/>').html(opts.msg.replace(/%([a-zA-Z0-9]+)%/g, function(m, m1) {\n\t\t\t\treturn fm.i18n(m1);\n\t\t\t})));\n\t\t\t\n\t\t\tif (opts.extNode) {\n\t\t\t\tself.append(opts.extNode);\n\t\t\t}\n\n\t\t\tif (opts.button) {\n\t\t\t\tself.append(\n\t\t\t\t\t$('<button class=\"ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop\"/>')\n\t\t\t\t\t.append($('<span class=\"ui-button-text\"/>').text(fm.i18n(opts.button.text)))\n\t\t\t\t\t.on('mouseenter mouseleave', function(e) { \n\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type == 'mouseenter');\n\t\t\t\t\t})\n\t\t\t\t\t.on('click', opts.button.click || function(){})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (opts.width) {\n\t\t\t\tself.css('max-width', opts.width);\n\t\t\t}\n\t\t\t\n\t\t\tshow();\n\t\t});\n\t};\n\n\treturn $;\n});\n\ndefine('skylark-elfinder/ui/toolbar',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindertoolbar = function(fm, opts) {\n\t\t\"use strict\";\n\t\tthis.not('.elfinder-toolbar').each(function() {\n\t\t\tvar commands = fm._commands,\n\t\t\t\tself     = $(this).addClass('ui-helper-clearfix ui-widget-header elfinder-toolbar'),\n\t\t\t\toptions  = {\n\t\t\t\t\t// default options\n\t\t\t\t\tdisplayTextLabel: false,\n\t\t\t\t\tlabelExcludeUA: ['Mobile'],\n\t\t\t\t\tautoHideUA: ['Mobile'],\n\t\t\t\t\tshowPreferenceButton: 'none'\n\t\t\t\t},\n\t\t\t\tfilter   = function(opts) {\n\t\t\t\t\treturn $.grep(opts, function(v) {\n\t\t\t\t\t\tif ($.isPlainObject(v)) {\n\t\t\t\t\t\t\toptions = Object.assign(options, v);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\trender = function(disabled){\n\t\t\t\t\tvar name,cmdPref;\n\t\t\t\t\t\n\t\t\t\t\t$.each(buttons, function(i, b) { b.detach(); });\n\t\t\t\t\tself.empty();\n\t\t\t\t\tl = panels.length;\n\t\t\t\t\twhile (l--) {\n\t\t\t\t\t\tif (panels[l]) {\n\t\t\t\t\t\t\tpanel = $('<div class=\"ui-widget-content ui-corner-all elfinder-buttonset\"/>');\n\t\t\t\t\t\t\ti = panels[l].length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\tname = panels[l][i];\n\t\t\t\t\t\t\t\tif ((!disabled || !disabled[name]) && (cmd = commands[name])) {\n\t\t\t\t\t\t\t\t\tbutton = 'elfinder'+cmd.options.ui;\n\t\t\t\t\t\t\t\t\tif (! buttons[name] && $.fn[button]) {\n\t\t\t\t\t\t\t\t\t\tbuttons[name] = $('<div/>')[button](cmd);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (buttons[name]) {\n\t\t\t\t\t\t\t\t\t\tbuttons[name].children('.elfinder-button-text')[textLabel? 'show' : 'hide']();\n\t\t\t\t\t\t\t\t\t\tpanel.prepend(buttons[name]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpanel.children().length && self.prepend(panel);\n\t\t\t\t\t\t\tpanel.children(':gt(0)').before('<span class=\"ui-widget-content elfinder-toolbar-button-separator\"/>');\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (cmdPref = commands['preference']) {\n\t\t\t\t\t\t//cmdPref.state = !self.children().length? 0 : -1;\n\t\t\t\t\t\tif (options.showPreferenceButton === 'always' || (!self.children().length && options.showPreferenceButton === 'auto')) {\n\t\t\t\t\t\t\t//cmdPref.state = 0;\n\t\t\t\t\t\t\tpanel = $('<div class=\"ui-widget-content ui-corner-all elfinder-buttonset\"/>');\n\t\t\t\t\t\t\tname = 'preference';\n\t\t\t\t\t\t\tbutton = 'elfinder'+cmd.options.ui;\n\t\t\t\t\t\t\tbuttons[name] = $('<div/>')[button](cmdPref);\n\t\t\t\t\t\t\tbuttons[name].children('.elfinder-button-text')[textLabel? 'show' : 'hide']();\n\t\t\t\t\t\t\tpanel.prepend(buttons[name]);\n\t\t\t\t\t\t\tself.append(panel);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t(! self.data('swipeClose') && self.children().length)? self.show() : self.hide();\n\t\t\t\t\tprevHeight = self[0].clientHeight;\n\t\t\t\t\tfm.trigger('toolbarload').trigger('uiresize');\n\t\t\t\t},\n\t\t\t\tbuttons = {},\n\t\t\t\tpanels   = filter(opts || []),\n\t\t\t\tdispre   = null,\n\t\t\t\tuiCmdMapPrev = '',\n\t\t\t\tprevHeight = 0,\n\t\t\t\tcontextRaw = [],\n\t\t\t\tl, i, cmd, panel, button, swipeHandle, autoHide, textLabel, resizeTm;\n\t\t\t\n\t\t\t// normalize options\n\t\t\toptions.showPreferenceButton = options.showPreferenceButton.toLowerCase();\n\t\t\t\n\t\t\tif (options.displayTextLabel !== 'none') {\n\t\t\t\t// correction of options.displayTextLabel\n\t\t\t\ttextLabel = fm.storage('toolbarTextLabel');\n\t\t\t\tif (textLabel === null) {\n\t\t\t\t\ttextLabel = (options.displayTextLabel && (! options.labelExcludeUA || ! options.labelExcludeUA.length || ! $.grep(options.labelExcludeUA, function(v){ return fm.UA[v]? true : false; }).length));\n\t\t\t\t} else {\n\t\t\t\t\ttextLabel = (textLabel == 1);\n\t\t\t\t}\n\t\t\t\tcontextRaw.push({\n\t\t\t\t\tlabel    : fm.i18n('textLabel'),\n\t\t\t\t\ticon     : 'text',\n\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\ttextLabel = ! textLabel;\n\t\t\t\t\t\tself.css('height', '').find('.elfinder-button-text')[textLabel? 'show':'hide']();\n\t\t\t\t\t\tfm.trigger('uiresize').storage('toolbarTextLabel', textLabel? '1' : '0');\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (options.preferenceInContextmenu && commands['preference']) {\n\t\t\t\tcontextRaw.push({\n\t\t\t\t\tlabel    : fm.i18n('toolbarPref'),\n\t\t\t\t\ticon     : 'preference',\n\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\tfm.exec('preference', void(0), {tab: 'toolbar'});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// add contextmenu\n\t\t\tif (contextRaw.length) {\n\t\t\t\tself.on('contextmenu', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: contextRaw,\n\t\t\t\t\t\t\tx: e.pageX,\n\t\t\t\t\t\t\ty: e.pageY\n\t\t\t\t\t\t});\n\t\t\t\t\t}).on('touchstart', function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.data('tmlongtap') && clearTimeout(self.data('tmlongtap'));\n\t\t\t\t\t\tself.removeData('longtap')\n\t\t\t\t\t\t\t.data('longtap', {x: e.originalEvent.touches[0].pageX, y: e.originalEvent.touches[0].pageY})\n\t\t\t\t\t\t\t.data('tmlongtap', setTimeout(function() {\n\t\t\t\t\t\t\t\tself.removeData('longtapTm')\n\t\t\t\t\t\t\t\t\t.trigger({\n\t\t\t\t\t\t\t\t\t\ttype: 'contextmenu',\n\t\t\t\t\t\t\t\t\t\tpageX: self.data('longtap').x,\n\t\t\t\t\t\t\t\t\t\tpageY: self.data('longtap').y\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.data('longtap', {longtap: true});\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t}).on('touchmove touchend', function(e) {\n\t\t\t\t\t\tif (self.data('tmlongtap')) {\n\t\t\t\t\t\t\tif (e.type === 'touchend' ||\n\t\t\t\t\t\t\t\t\t( Math.abs(self.data('longtap').x - e.originalEvent.touches[0].pageX)\n\t\t\t\t\t\t\t\t\t+ Math.abs(self.data('longtap').y - e.originalEvent.touches[0].pageY)) > 4)\n\t\t\t\t\t\t\tclearTimeout(self.data('tmlongtap'));\n\t\t\t\t\t\t\tself.removeData('longtapTm');\n\t\t\t\t\t\t}\n\t\t\t\t\t}).on('click', function(e) {\n\t\t\t\t\t\tif (self.data('longtap') && self.data('longtap').longtap) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}).on('touchend click', '.elfinder-button', function(e) {\n\t\t\t\t\t\tif (self.data('longtap') && self.data('longtap').longtap) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tself.prev().length && self.parent().prepend(this);\n\t\t\t\n\t\t\trender();\n\t\t\t\n\t\t\tfm.bind('open sync select toolbarpref', function() {\n\t\t\t\tvar disabled = Object.assign({}, fm.option('disabledFlip')),\n\t\t\t\t\tuserHides = fm.storage('toolbarhides'),\n\t\t\t\t\tdoRender, sel, disabledKeys;\n\t\t\t\t\n\t\t\t\tif (! userHides && Array.isArray(options.defaultHides)) {\n\t\t\t\t\tuserHides = {};\n\t\t\t\t\t$.each(options.defaultHides, function() {\n\t\t\t\t\t\tuserHides[this] = true;\n\t\t\t\t\t});\n\t\t\t\t\tfm.storage('toolbarhides', userHides);\n\t\t\t\t}\n\t\t\t\tif (this.type === 'select') {\n\t\t\t\t\tif (fm.searchStatus.state < 2) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tsel = fm.selected();\n\t\t\t\t\tif (sel.length) {\n\t\t\t\t\t\tdisabled = fm.getDisabledCmds(sel, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(userHides, function(n) {\n\t\t\t\t\tif (!disabled[n]) {\n\t\t\t\t\t\tdisabled[n] = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (Object.keys(fm.commandMap).length) {\n\t\t\t\t\t$.each(fm.commandMap, function(from, to){\n\t\t\t\t\t\tif (to === 'hidden') {\n\t\t\t\t\t\t\tdisabled[from] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdisabledKeys = Object.keys(disabled);\n\t\t\t\tif (!dispre || dispre.toString() !== disabledKeys.sort().toString()) {\n\t\t\t\t\trender(disabledKeys.length? disabled : null);\n\t\t\t\t\tdoRender = true;\n\t\t\t\t}\n\t\t\t\tdispre = disabledKeys.sort();\n\n\t\t\t\tif (doRender || uiCmdMapPrev !== JSON.stringify(fm.commandMap)) {\n\t\t\t\t\tuiCmdMapPrev = JSON.stringify(fm.commandMap);\n\t\t\t\t\tif (! doRender) {\n\t\t\t\t\t\t// reset toolbar\n\t\t\t\t\t\t$.each($('div.elfinder-button'), function(){\n\t\t\t\t\t\t\tvar origin = $(this).data('origin');\n\t\t\t\t\t\t\tif (origin) {\n\t\t\t\t\t\t\t\t$(this).after(origin).detach();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (Object.keys(fm.commandMap).length) {\n\t\t\t\t\t\t$.each(fm.commandMap, function(from, to){\n\t\t\t\t\t\t\tvar cmd = fm._commands[to],\n\t\t\t\t\t\t\t\tbutton = cmd? 'elfinder'+cmd.options.ui : null,\n\t\t\t\t\t\t\t\tbtn;\n\t\t\t\t\t\t\tif (button && $.fn[button]) {\n\t\t\t\t\t\t\t\tbtn = buttons[from];\n\t\t\t\t\t\t\t\tif (btn) {\n\t\t\t\t\t\t\t\t\tif (! buttons[to] && $.fn[button]) {\n\t\t\t\t\t\t\t\t\t\tbuttons[to] = $('<div/>')[button](cmd);\n\t\t\t\t\t\t\t\t\t\tif (buttons[to]) {\n\t\t\t\t\t\t\t\t\t\t\tbuttons[to].children('.elfinder-button-text')[textLabel? 'show' : 'hide']();\n\t\t\t\t\t\t\t\t\t\t\tif (cmd.extendsCmd) {\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons[to].children('span.elfinder-button-icon').addClass('elfinder-button-icon-' + cmd.extendsCmd);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (buttons[to]) {\n\t\t\t\t\t\t\t\t\t\tbtn.after(buttons[to]);\n\t\t\t\t\t\t\t\t\t\tbuttons[to].data('origin', btn.detach());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).bind('resize', function(e) {\n\t\t\t\tresizeTm && cancelAnimationFrame(resizeTm);\n\t\t\t\tresizeTm = requestAnimationFrame(function() {\n\t\t\t\t\tvar h = self[0].clientHeight;\n\t\t\t\t\tif (prevHeight !== h) {\n\t\t\t\t\t\tprevHeight = h;\n\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\tif (fm.UA.Touch) {\n\t\t\t\tautoHide = fm.storage('autoHide') || {};\n\t\t\t\tif (typeof autoHide.toolbar === 'undefined') {\n\t\t\t\t\tautoHide.toolbar = (options.autoHideUA && options.autoHideUA.length > 0 && $.grep(options.autoHideUA, function(v){ return fm.UA[v]? true : false; }).length);\n\t\t\t\t\tfm.storage('autoHide', autoHide);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (autoHide.toolbar) {\n\t\t\t\t\tfm.one('init', function() {\n\t\t\t\t\t\tfm.uiAutoHide.push(function(){ self.stop(true, true).trigger('toggle', { duration: 500, init: true }); });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.bind('load', function() {\n\t\t\t\t\tswipeHandle = $('<div class=\"elfinder-toolbar-swipe-handle\"/>').hide().appendTo(fm.getUI());\n\t\t\t\t\tif (swipeHandle.css('pointer-events') !== 'none') {\n\t\t\t\t\t\tswipeHandle.remove();\n\t\t\t\t\t\tswipeHandle = null;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.on('toggle', function(e, data) {\n\t\t\t\t\tvar wz    = fm.getUI('workzone'),\n\t\t\t\t\t\ttoshow= self.is(':hidden'),\n\t\t\t\t\t\twzh   = wz.height(),\n\t\t\t\t\t\th     = self.height(),\n\t\t\t\t\t\ttbh   = self.outerHeight(true),\n\t\t\t\t\t\tdelta = tbh - h,\n\t\t\t\t\t\topt   = Object.assign({\n\t\t\t\t\t\t\tstep: function(now) {\n\t\t\t\t\t\t\t\twz.height(wzh + (toshow? (now + delta) * -1 : h - now));\n\t\t\t\t\t\t\t\tfm.trigger('resize');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\talways: function() {\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tself.css('height', '');\n\t\t\t\t\t\t\t\t\tfm.trigger('uiresize');\n\t\t\t\t\t\t\t\t\tif (swipeHandle) {\n\t\t\t\t\t\t\t\t\t\tif (toshow) {\n\t\t\t\t\t\t\t\t\t\t\tswipeHandle.stop(true, true).hide();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tswipeHandle.height(data.handleH? data.handleH : '');\n\t\t\t\t\t\t\t\t\t\t\tfm.resources.blink(swipeHandle, 'slowonce');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ttoshow && self.scrollTop('0px');\n\t\t\t\t\t\t\t\t\tdata.init && fm.trigger('uiautohide');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, data);\n\t\t\t\t\tself.data('swipeClose', ! toshow).stop(true, true).animate({height : 'toggle'}, opt);\n\t\t\t\t\tautoHide.toolbar = !toshow;\n\t\t\t\t\tfm.storage('autoHide', Object.assign(fm.storage('autoHide'), {toolbar: autoHide.toolbar}));\n\t\t\t\t}).on('touchstart', function(e) {\n\t\t\t\t\tif (self.scrollBottom() > 5) {\n\t\t\t\t\t\te.originalEvent._preventSwipeY = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn this;\n\t};\n\n\n\treturn $;\n});\n\ndefine('skylark-elfinder/ui/tree',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder folders tree\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfindertree = function(fm, opts) {\n\t\t\"use strict\";\n\t\tvar treeclass = fm.res('class', 'tree');\n\t\t\n\t\tthis.not('.'+treeclass).each(function() {\n\n\t\t\tvar c = 'class', mobile = fm.UA.Mobile,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Root directory class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\troot      = fm.res(c, 'treeroot'),\n\n\t\t\t\t/**\n\t\t\t\t * Open root dir if not opened yet\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\topenRoot  = opts.openRootOnLoad,\n\n\t\t\t\t/**\n\t\t\t\t * Open current work dir if not opened yet\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\topenCwd   = opts.openCwdOnOpen,\n\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Auto loading current directory parents and do expand their node\n\t\t\t\t *\n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\tsyncTree  = openCwd || opts.syncTree,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Subtree class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tsubtree   = fm.res(c, 'navsubtree'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tnavdir    = fm.res(c, 'treedir'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory CSS selector\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tselNavdir = 'span.' + navdir,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Collapsed arrow class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tcollapsed = fm.res(c, 'navcollapse'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Expanded arrow class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\texpanded  = fm.res(c, 'navexpand'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Class name to mark arrow for directory with already loaded children\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tloaded    = 'elfinder-subtree-loaded',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Class name to mark need subdirs request\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tchksubdir = 'elfinder-subtree-chksubdir',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Arraw class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tarrow = fm.res(c, 'navarrow'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Current directory class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tactive    = fm.res(c, 'active'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable dirs dropover class\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdropover = fm.res(c, 'adroppable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Hover class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\thover    = fm.res(c, 'hover'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Disabled dir class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdisabled = fm.res(c, 'disabled'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Draggable dir class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdraggable = fm.res(c, 'draggable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable dir  class name\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tdroppable = fm.res(c, 'droppable'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * root wrapper class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\twrapperRoot = 'elfinder-navbar-wrapper-root',\n\n\t\t\t\t/**\n\t\t\t\t * Un-disabled cmd `paste` volume's root wrapper class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tpastable = 'elfinder-navbar-wrapper-pastable',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Un-disabled cmd `upload` volume's root wrapper class\n\t\t\t\t * \n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tuploadable = 'elfinder-navbar-wrapper-uploadable',\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Is position x inside Navbar\n\t\t\t\t * \n\t\t\t\t * @param x Numbar\n\t\t\t\t * \n\t\t\t\t * @return\n\t\t\t\t */\n\t\t\t\tinsideNavbar = function(x) {\n\t\t\t\t\tvar left = navbar.offset().left;\n\t\t\t\t\t\t\n\t\t\t\t\treturn left <= x && x <= left + navbar.width();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * To call subdirs elements queue\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tsubdirsQue = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * To exec subdirs elements ids\n\t\t\t\t * \n\t\t\t\t */\n\t\t\t\tsubdirsExecQue = [],\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Request subdirs to backend\n\t\t\t\t * \n\t\t\t\t * @param id String\n\t\t\t\t * \n\t\t\t\t * @return Deferred\n\t\t\t\t */\n\t\t\t\tsubdirs = function(ids) {\n\t\t\t\t\tvar targets = [];\n\t\t\t\t\t$.each(ids, function(i, id) {\n\t\t\t\t\t\tsubdirsQue[id] && targets.push(fm.navId2Hash(id));\n\t\t\t\t\t\tdelete subdirsQue[id];\n\t\t\t\t\t});\n\t\t\t\t\tif (targets.length) {\n\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcmd: 'subdirs',\n\t\t\t\t\t\t\t\ttargets: targets,\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).done(function(res) {\n\t\t\t\t\t\t\tif (res && res.subdirs) {\n\t\t\t\t\t\t\t\t$.each(res.subdirs, function(hash, subdirs) {\n\t\t\t\t\t\t\t\t\tvar elm = fm.navHash2Elm(hash);\n\t\t\t\t\t\t\t\t\telm.removeClass(chksubdir);\n\t\t\t\t\t\t\t\t\telm[subdirs? 'addClass' : 'removeClass'](collapsed);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tsubdirsJobRes = null,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * To check target element is in window of subdirs\n\t\t\t\t * \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tcheckSubdirs = function() {\n\t\t\t\t\tvar ids = Object.keys(subdirsQue);\n\t\t\t\t\tif (ids.length) {\n\t\t\t\t\t\tsubdirsJobRes && subdirsJobRes._abort();\n\t\t\t\t\t\texecSubdirsTm && clearTimeout(execSubdirsTm);\n\t\t\t\t\t\tsubdirsExecQue = [];\n\t\t\t\t\t\tsubdirsJobRes = fm.asyncJob(function(id) {\n\t\t\t\t\t\t\treturn fm.isInWindow($('#'+id))? id : null;\n\t\t\t\t\t\t}, ids, { numPerOnce: 200 })\n\t\t\t\t\t\t.done(function(arr) {\n\t\t\t\t\t\t\tif (arr.length) {\n\t\t\t\t\t\t\t\tsubdirsExecQue = arr;\n\t\t\t\t\t\t\t\texecSubdirs();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tsubdirsPending = 0,\n\t\t\t\texecSubdirsTm,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Exec subdirs as batch request\n\t\t\t\t * \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\texecSubdirs = function() {\n\t\t\t\t\tvar cnt = opts.subdirsMaxConn - subdirsPending,\n\t\t\t\t\t\tatOnce = fm.maxTargets? Math.min(fm.maxTargets, opts.subdirsAtOnce) : opts.subdirsAtOnce,\n\t\t\t\t\t\ti, ids;\n\t\t\t\t\texecSubdirsTm && cancelAnimationFrame(execSubdirsTm);\n\t\t\t\t\tif (subdirsExecQue.length) {\n\t\t\t\t\t\tif (cnt > 0) {\n\t\t\t\t\t\t\tfor (i = 0; i < cnt; i++) {\n\t\t\t\t\t\t\t\tif (subdirsExecQue.length) {\n\t\t\t\t\t\t\t\t\tsubdirsPending++;\n\t\t\t\t\t\t\t\t\tsubdirs(subdirsExecQue.splice(0, atOnce)).always(function() {\n\t\t\t\t\t\t\t\t\t\tsubdirsPending--;\n\t\t\t\t\t\t\t\t\t\texecSubdirs();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texecSubdirsTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tsubdirsExecQue.length && execSubdirs();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tdrop = fm.droppable.drop,\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Droppable options\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\tdroppableopts = $.extend(true, {}, fm.droppable, {\n\t\t\t\t\t// show subfolders on dropover\n\t\t\t\t\tover : function(e, ui) {\n\t\t\t\t\t\tvar dst    = $(this),\n\t\t\t\t\t\t\thelper = ui.helper,\n\t\t\t\t\t\t\tcl     = hover+' '+dropover,\n\t\t\t\t\t\t\thash, status;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\thelper.data('dropover', helper.data('dropover') + 1);\n\t\t\t\t\t\tdst.data('dropover', true);\n\t\t\t\t\t\tif (ui.helper.data('namespace') !== fm.namespace || ! fm.insideWorkzone(e.pageX, e.pageY)) {\n\t\t\t\t\t\t\tdst.removeClass(cl);\n\t\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (! insideNavbar(e.clientX)) {\n\t\t\t\t\t\t\tdst.removeClass(cl);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\tdst.addClass(hover);\n\t\t\t\t\t\tif (dst.is('.'+collapsed+':not(.'+expanded+')')) {\n\t\t\t\t\t\t\tdst.data('expandTimer', setTimeout(function() {\n\t\t\t\t\t\t\t\tdst.is('.'+collapsed+'.'+hover) && dst.children('.'+arrow).trigger('click');\n\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dst.is('.elfinder-ro,.elfinder-na')) {\n\t\t\t\t\t\t\tdst.removeClass(dropover);\n\t\t\t\t\t\t\t//helper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thash = fm.navId2Hash(dst.attr('id'));\n\t\t\t\t\t\tdst.data('dropover', hash);\n\t\t\t\t\t\t$.each(ui.helper.data('files'), function(i, h) {\n\t\t\t\t\t\t\tif (h === hash || (fm.file(h).phash === hash && !ui.helper.hasClass('elfinder-drag-helper-plus'))) {\n\t\t\t\t\t\t\t\tdst.removeClass(cl);\n\t\t\t\t\t\t\t\treturn false; // break $.each\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (helper.data('locked')) {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-plus';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstatus = 'elfinder-drag-helper-move';\n\t\t\t\t\t\t\tif (e.shiftKey || e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\t\t\tstatus += ' elfinder-drag-helper-plus';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdst.hasClass(dropover) && helper.addClass(status);\n\t\t\t\t\t\trequestAnimationFrame(function(){ dst.hasClass(dropover) && helper.addClass(status); });\n\t\t\t\t\t},\n\t\t\t\t\tout : function(e, ui) {\n\t\t\t\t\t\tvar dst    = $(this),\n\t\t\t\t\t\t\thelper = ui.helper;\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (insideNavbar(e.clientX)) {\n\t\t\t\t\t\t\thelper.removeClass('elfinder-drag-helper-move elfinder-drag-helper-plus');\n\t\t\t\t\t\t}\n\t\t\t\t\t\thelper.data('dropover', Math.max(helper.data('dropover') - 1, 0));\n\t\t\t\t\t\tdst.data('expandTimer') && clearTimeout(dst.data('expandTimer'));\n\t\t\t\t\t\tdst.removeData('dropover')\n\t\t\t\t\t\t   .removeClass(hover+' '+dropover);\n\t\t\t\t\t},\n\t\t\t\t\tdeactivate : function() {\n\t\t\t\t\t\t$(this).removeData('dropover')\n\t\t\t\t\t\t       .removeClass(hover+' '+dropover);\n\t\t\t\t\t},\n\t\t\t\t\tdrop : function(e, ui) {\n\t\t\t\t\t\tinsideNavbar(e.clientX) && drop.call(this, e, ui);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\t\n\t\t\t\tspinner = $(fm.res('tpl', 'navspinner')),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\ttpl = fm.res('tpl', 'navdir'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Permissions marker html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tptpl = fm.res('tpl', 'perms'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Lock marker html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tltpl = fm.res('tpl', 'lock'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Symlink marker html template\n\t\t\t\t *\n\t\t\t\t * @type String\n\t\t\t\t */\n\t\t\t\tstpl = fm.res('tpl', 'symlink'),\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Directory hashes that has more pages\n\t\t\t\t * \n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\thasMoreDirs = {},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Html template replacement methods\n\t\t\t\t *\n\t\t\t\t * @type Object\n\t\t\t\t */\n\t\t\t\treplace = {\n\t\t\t\t\tid          : function(dir) { return fm.navHash2Id(dir.hash); },\n\t\t\t\t\tname        : function(dir) { return fm.escape(dir.i18 || dir.name); },\n\t\t\t\t\tcssclass    : function(dir) {\n\t\t\t\t\t\tvar cname = (dir.phash && ! dir.isroot ? '' : root)+' '+navdir+' '+fm.perms2class(dir);\n\t\t\t\t\t\tdir.dirs && !dir.link && (cname += ' ' + collapsed) && dir.dirs == -1 && (cname += ' ' + chksubdir);\n\t\t\t\t\t\topts.getClass && (cname += ' ' + opts.getClass(dir));\n\t\t\t\t\t\tdir.csscls && (cname += ' ' + fm.escape(dir.csscls));\n\t\t\t\t\t\treturn cname;\n\t\t\t\t\t},\n\t\t\t\t\ttitle       : function(dir) { return opts.attrTitle? (' title=\"' + fm.escape(fm.path(dir.hash, true) || dir.i18 || dir.name) + '\"') : ''; },\n\t\t\t\t\troot        : function(dir) {\n\t\t\t\t\t\tvar cls = '';\n\t\t\t\t\t\tif (!dir.phash || dir.isroot) {\n\t\t\t\t\t\t\tcls += ' '+wrapperRoot;\n\t\t\t\t\t\t\tif (!dir.disabled || dir.disabled.length < 1) {\n\t\t\t\t\t\t\t\tcls += ' '+pastable+' '+uploadable;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ($.inArray('paste', dir.disabled) === -1) {\n\t\t\t\t\t\t\t\t\tcls += ' '+pastable;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ($.inArray('upload', dir.disabled) === -1) {\n\t\t\t\t\t\t\t\t\tcls += ' '+uploadable;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn cls;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tpermissions : function(dir) { return !dir.read || !dir.write ? ptpl : ''; },\n\t\t\t\t\tsymlink     : function(dir) { return dir.alias ? stpl : ''; },\n\t\t\t\t\tstyle       : function(dir) { return dir.icon ? fm.getIconStyle(dir) : ''; }\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return html for given dir\n\t\t\t\t *\n\t\t\t\t * @param  Object  directory\n\t\t\t\t * @return String\n\t\t\t\t */\n\t\t\t\titemhtml = function(dir) {\n\t\t\t\t\treturn tpl.replace(/(?:\\{([a-z]+)\\})/ig, function(m, key) {\n\t\t\t\t\t\tvar res = replace[key] ? replace[key](dir) : (dir[key] || '');\n\t\t\t\t\t\tif (key === 'id' && dir.dirs == -1) {\n\t\t\t\t\t\t\tsubdirsQue[res] = res;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Return only dirs from files list\n\t\t\t\t *\n\t\t\t\t * @param  Array   files list\n\t\t\t\t * @param  Boolean do check exists\n\t\t\t\t * @return Array\n\t\t\t\t */\n\t\t\t\tfilter = function(files, checkExists) {\n\t\t\t\t\treturn $.map(files || [], function(f) {\n\t\t\t\t\t\treturn (f.mime === 'directory' && (!checkExists || fm.navHash2Elm(f.hash).length)) ? f : null;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Find parent subtree for required directory\n\t\t\t\t *\n\t\t\t\t * @param  String  dir hash\n\t\t\t\t * @return jQuery\n\t\t\t\t */\n\t\t\t\tfindSubtree = function(hash) {\n\t\t\t\t\treturn hash ? fm.navHash2Elm(hash).next('.'+subtree) : tree;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Find directory (wrapper) in required node\n\t\t\t\t * before which we can insert new directory\n\t\t\t\t *\n\t\t\t\t * @param  jQuery  parent directory\n\t\t\t\t * @param  Object  new directory\n\t\t\t\t * @return jQuery\n\t\t\t\t */\n\t\t\t\tfindSibling = function(subtree, dir) {\n\t\t\t\t\tvar node = subtree.children(':first'),\n\t\t\t\t\t\tinfo;\n\n\t\t\t\t\twhile (node.length) {\n\t\t\t\t\t\tinfo = fm.file(fm.navId2Hash(node.children('[id]').attr('id')));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((info = fm.file(fm.navId2Hash(node.children('[id]').attr('id')))) \n\t\t\t\t\t\t&& compare(dir, info) < 0) {\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = node.next();\n\t\t\t\t\t}\n\t\t\t\t\treturn subtree.children('button.elfinder-navbar-pager-next');\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Add new dirs in tree\n\t\t\t\t *\n\t\t\t\t * @param  Array  dirs list\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tupdateTree = function(dirs) {\n\t\t\t\t\tvar length  = dirs.length,\n\t\t\t\t\t\torphans = [],\n\t\t\t\t\t\ti = length,\n\t\t\t\t\t\ttgts = $(),\n\t\t\t\t\t\tdone = {},\n\t\t\t\t\t\tcwd = fm.cwd(),\n\t\t\t\t\t\tappend = function(parent, dirs, start, direction) {\n\t\t\t\t\t\t\tvar hashes = {},\n\t\t\t\t\t\t\t\tcurStart = 0,\n\t\t\t\t\t\t\t\tmax = fm.newAPI? Math.min(10000, Math.max(10, opts.subTreeMax)) : 10000,\n\t\t\t\t\t\t\t\tsetHashes = function() {\n\t\t\t\t\t\t\t\t\thashes = {};\n\t\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\thashes[d.hash] = i;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchange = function(mode) {\n\t\t\t\t\t\t\t\t\tif (mode === 'prepare') {\n\t\t\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\t\td.node && parent.append(d.node.hide());\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (mode === 'done') {\n\t\t\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\t\td.node && d.node.detach().show();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdate = function(e, data) {\n\t\t\t\t\t\t\t\t\tvar i, changed;\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.select) {\n\t\t\t\t\t\t\t\t\t\trender(getStart(data.select));\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.change) {\n\t\t\t\t\t\t\t\t\t\tchange(data.change);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.removed && data.removed.length) {\n\t\t\t\t\t\t\t\t\t\tdirs = $.grep(dirs, function(d) {\n\t\t\t\t\t\t\t\t\t\t\tif (data.removed.indexOf(d.hash) === -1) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t!changed && (changed = true);\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tdirs = dirs.concat($.grep(data.added, function(d) {\n\t\t\t\t\t\t\t\t\t\t\tif (hashes[d.hash] === void(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\t!changed && (changed = true);\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (changed) {\n\t\t\t\t\t\t\t\t\t\tdirs.sort(compare);\n\t\t\t\t\t\t\t\t\t\tsetHashes();\n\t\t\t\t\t\t\t\t\t\trender(curStart);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tgetStart = function(target) {\n\t\t\t\t\t\t\t\t\tif (hashes[target] !== void(0)) {\n\t\t\t\t\t\t\t\t\t\treturn Math.floor(hashes[target] / max) * max;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn void(0);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttarget = fm.navId2Hash(parent.prev('[id]').attr('id')),\n\t\t\t\t\t\t\t\trender = function(start, direction) {\n\t\t\t\t\t\t\t\t\tvar html = [],\n\t\t\t\t\t\t\t\t\t\tnodes = {},\n\t\t\t\t\t\t\t\t\t\ttotal, page, s, parts, prev, next, prevBtn, nextBtn;\n\t\t\t\t\t\t\t\t\tdelete hasMoreDirs[target];\n\t\t\t\t\t\t\t\t\tcurStart = start;\n\t\t\t\t\t\t\t\t\tparent.off('update.'+fm.namespace, update);\n\t\t\t\t\t\t\t\t\tif (dirs.length > max) {\n\t\t\t\t\t\t\t\t\t\tparent.on('update.'+fm.namespace, update);\n\t\t\t\t\t\t\t\t\t\tif (start === void(0)) {\n\t\t\t\t\t\t\t\t\t\t\ts = 0;\n\t\t\t\t\t\t\t\t\t\t\tsetHashes();\n\t\t\t\t\t\t\t\t\t\t\tstart = getStart(cwd.hash);\n\t\t\t\t\t\t\t\t\t\t\tif (start === void(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\tstart = 0;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tparts = dirs.slice(start, start + max);\n\t\t\t\t\t\t\t\t\t\thasMoreDirs[target] = parent;\n\t\t\t\t\t\t\t\t\t\tprev = start? Math.max(-1, start - max) : -1;\n\t\t\t\t\t\t\t\t\t\tnext = (start + max >= dirs.length)? 0 : start + max;\n\t\t\t\t\t\t\t\t\t\ttotal = Math.ceil(dirs.length/max);\n\t\t\t\t\t\t\t\t\t\tpage = Math.ceil(start/max);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$.each(parts || dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\t\thtml.push(itemhtml(d));\n\t\t\t\t\t\t\t\t\t\tif (d.node) {\n\t\t\t\t\t\t\t\t\t\t\tnodes[d.hash] = d.node;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (prev > -1) {\n\t\t\t\t\t\t\t\t\t\tprevBtn = $('<button class=\"elfinder-navbar-pager elfinder-navbar-pager-prev\"/>')\n\t\t\t\t\t\t\t\t\t\t\t.text(fm.i18n('btnPrevious', page, total))\n\t\t\t\t\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprimary: \"ui-icon-caret-1-n\"\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\trender(prev, 'up');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tprevBtn = $();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (next) {\n\t\t\t\t\t\t\t\t\t\tnextBtn = $('<button class=\"elfinder-navbar-pager elfinder-navbar-pager-next\"/>')\n\t\t\t\t\t\t\t\t\t\t\t.text(fm.i18n('btnNext', page + 2, total))\n\t\t\t\t\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprimary: \"ui-icon-caret-1-s\"\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\trender(next, 'down');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tnextBtn = $();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdetach();\n\t\t\t\t\t\t\t\t\tparent.empty()[parts? 'addClass' : 'removeClass']('elfinder-navbar-hasmore').append(prevBtn, html.join(''), nextBtn);\n\t\t\t\t\t\t\t\t\t$.each(nodes, function(h, n) {\n\t\t\t\t\t\t\t\t\t\tfm.navHash2Elm(h).parent().replaceWith(n);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (direction) {\n\t\t\t\t\t\t\t\t\t\tautoScroll(fm.navHash2Id(parts[direction === 'up'? parts.length - 1 : 0].hash));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t! mobile && fm.lazy(function() { updateDroppable(null, parent); });\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdetach = function() {\n\t\t\t\t\t\t\t\t\t$.each(parent.children('.elfinder-navbar-wrapper'), function(i, elm) {\n\t\t\t\t\t\t\t\t\t\tvar n = $(elm),\n\t\t\t\t\t\t\t\t\t\t\tch = n.children('[id]:first'),\n\t\t\t\t\t\t\t\t\t\t\th, c;\n\t\t\t\t\t\t\t\t\t\tif (ch.hasClass(loaded)) {\n\t\t\t\t\t\t\t\t\t\t\th = fm.navId2Hash(ch.attr('id'));\n\t\t\t\t\t\t\t\t\t\t\tif (h && (c = hashes[h]) !== void(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\tdirs[c].node = n.detach();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\trender();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdir, html, parent, sibling, init, atonce = {}, updates = [], base, node,\n\t\t\t\t\t\tlastKey, lastNodes = {};\n\t\t\t\t\t\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tdir = dirs[i];\n\n\t\t\t\t\t\tif (done[dir.hash] || fm.navHash2Elm(dir.hash).length) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdone[dir.hash] = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ((parent = findSubtree(dir.phash)).length) {\n\t\t\t\t\t\t\tlastKey = dir.phash || 'treeroot';\n\t\t\t\t\t\t\tif (typeof lastNodes[lastKey] === 'undefined') {\n\t\t\t\t\t\t\t\tlastNodes[lastKey] = parent.children(':last');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinit = !lastNodes[lastKey].length;\n\t\t\t\t\t\t\tif (dir.phash && (init || parent.hasClass('elfinder-navbar-hasmore') || (sibling = findSibling(parent, dir)).length)) {\n\t\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\t\tif (!atonce[dir.phash]) {\n\t\t\t\t\t\t\t\t\t\tatonce[dir.phash] = [];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tatonce[dir.phash].push(dir);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\t\t\t\t\tnode = itemhtml(dir);\n\t\t\t\t\t\t\t\t\t\tsibling.before(node);\n\t\t\t\t\t\t\t\t\t\t! mobile && (tgts = tgts.add(node));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tupdates.push(dir);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnode = itemhtml(dir);\n\t\t\t\t\t\t\t\tif (init) {\n\t\t\t\t\t\t\t\t\tparent.prepend(node);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlastNodes[lastKey].after(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!dir.phash || dir.isroot) {\n\t\t\t\t\t\t\t\t\tbase = fm.navHash2Elm(dir.hash).parent();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t! mobile && updateDroppable(null, base);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\torphans.push(dir);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// When init, html append at once\n\t\t\t\t\tif (Object.keys(atonce).length){\n\t\t\t\t\t\t$.each(atonce, function(p, dirs){\n\t\t\t\t\t\t\tvar parent = findSubtree(p),\n\t\t\t\t\t\t\t    html   = [];\n\t\t\t\t\t\t\tdirs.sort(compare);\n\t\t\t\t\t\t\tappend(parent, dirs);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (updates.length) {\n\t\t\t\t\t\tparent.trigger('update.' + fm.namespace, { added : updates });\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (orphans.length && orphans.length < length) {\n\t\t\t\t\t\tupdateTree(orphans);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} \n\t\t\t\t\t\n\t\t\t\t\t! mobile && tgts.length && fm.lazy(function() { updateDroppable(tgts); });\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * sort function by dir.name\n\t\t\t\t * \n\t\t\t\t */\n\t\t\t\tcompare = function(dir1, dir2) {\n\t\t\t\t\tif (! fm.sortAlsoTreeview) {\n\t\t\t\t\t\treturn fm.sortRules.name(dir1, dir2);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar asc   = fm.sortOrder == 'asc',\n\t\t\t\t\t\t\ttype  = fm.sortType,\n\t\t\t\t\t\t\trules = fm.sortRules,\n\t\t\t\t\t\t\tres;\n\t\t\t\t\t\t\n\t\t\t\t\t\tres = asc? rules[fm.sortType](dir1, dir2) : rules[fm.sortType](dir2, dir1);\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn type !== 'name' && res === 0\n\t\t\t\t\t\t\t? res = asc ? rules.name(dir1, dir2) : rules.name(dir2, dir1)\n\t\t\t\t\t\t\t: res;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t/**\n\t\t\t\t * Timer ID of autoScroll\n\t\t\t\t * \n\t\t\t\t * @type  Integer\n\t\t\t\t */\n\t\t\t\tautoScrTm,\n\n\t\t\t\t/**\n\t\t\t\t * Auto scroll to cwd\n\t\t\t\t *\n\t\t\t\t * @return Object  jQuery Deferred\n\t\t\t\t */\n\t\t\t\tautoScroll = function(target) {\n\t\t\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\t\t\tcurrent, parent, top, treeH, bottom, tgtTop;\n\t\t\t\t\tautoScrTm && clearTimeout(autoScrTm);\n\t\t\t\t\tautoScrTm = setTimeout(function() {\n\t\t\t\t\t\tcurrent = $(document.getElementById((target || fm.navHash2Id(fm.cwd().hash))));\n\t\t\t\t\t\tif (current.length) {\n\t\t\t\t\t\t\t// expand parents directory\n\t\t\t\t\t\t\t(openCwd? current : current.parent()).parents('.elfinder-navbar-wrapper').children('.'+loaded).addClass(expanded).next('.'+subtree).show();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tparent = tree.parent().stop(false, true);\n\t\t\t\t\t\t\ttop = parent.offset().top;\n\t\t\t\t\t\t\ttreeH = parent.height();\n\t\t\t\t\t\t\tbottom = top + treeH - current.outerHeight();\n\t\t\t\t\t\t\ttgtTop = current.offset().top;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (tgtTop < top || tgtTop > bottom) {\n\t\t\t\t\t\t\t\tparent.animate({\n\t\t\t\t\t\t\t\t\tscrollTop : parent.scrollTop() + tgtTop - top - treeH / 3\n\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\tduration : opts.durations.autoScroll,\n\t\t\t\t\t\t\t\t\tcomplete : function() {\tdfrd.resolve(); }\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100);\n\t\t\t\t\treturn dfrd;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Get hashes array of items of the bottom of the leaf root back from the target\n\t\t\t\t * \n\t\t\t\t * @param Object elFinder item(directory) object\n\t\t\t\t * @return Array hashes\n\t\t\t\t */\n\t\t\t\tgetEnds = function(d) {\n\t\t\t\t\tvar cur = d || fm.cwd(),\n\t\t\t\t\t\tres = cur.hash? [ cur.hash ] : [],\n\t\t\t\t\t\tphash, root, dir;\n\t\t\t\t\t\n\t\t\t\t\troot = fm.root(cur.hash);\n\t\t\t\t\tdir = fm.file(root);\n\t\t\t\t\twhile (dir && (phash = dir.phash)) {\n\t\t\t\t\t\tres.unshift(phash);\n\t\t\t\t\t\troot = fm.root(phash);\n\t\t\t\t\t\tdir = fm.file(root);\n\t\t\t\t\t\tif (fm.navHash2Elm(dir.hash).hasClass(loaded)) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn res;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Select pages back in order to display the target\n\t\t\t\t * \n\t\t\t\t * @param Object elFinder item(directory) object\n\t\t\t\t * @return Object jQuery node object of target node\n\t\t\t\t */\n\t\t\t\tselectPages = function(current) {\n\t\t\t\t\tvar cur = current || fm.cwd(),\n\t\t\t\t\t\tcurHash = cur.hash,\n\t\t\t\t\t\tnode = fm.navHash2Elm(curHash);\n\t\t\t\t\n\t\t\t\t\tif (!node.length) {\n\t\t\t\t\t\twhile(cur && cur.phash) {\n\t\t\t\t\t\t\tif (hasMoreDirs[cur.phash] && !fm.navHash2Elm(cur.hash).length) {\n\t\t\t\t\t\t\t\thasMoreDirs[cur.phash].trigger('update.'+fm.namespace, { select : cur.hash });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcur = fm.file(cur.phash);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = fm.navHash2Elm(curHash);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Flag indicating that synchronization is currently in progress\n\t\t\t\t * \n\t\t\t\t * @type Boolean\n\t\t\t\t */\n\t\t\t\tsyncing,\n\n\t\t\t\t/**\n\t\t\t\t * Mark current directory as active\n\t\t\t\t * If current directory is not in tree - load it and its parents\n\t\t\t\t *\n\t\t\t\t * @param Array directory objects of cwd\n\t\t\t\t * @param Boolean do auto scroll\n\t\t\t\t * @return Object jQuery Deferred\n\t\t\t\t */\n\t\t\t\tsync = function(cwdDirs, aScr) {\n\t\t\t\t\tvar cwd     = fm.cwd(),\n\t\t\t\t\t\tcwdhash = cwd.hash,\n\t\t\t\t\t\tautoScr = aScr === void(0)? syncTree : aScr,\n\t\t\t\t\t\tloadParents = function(dir) {\n\t\t\t\t\t\t\tvar dfd  = $.Deferred(),\n\t\t\t\t\t\t\t\treqs = [],\n\t\t\t\t\t\t\t\tends = getEnds(dir),\n\t\t\t\t\t\t\t\tmakeReq = function(cmd, h, until) {\n\t\t\t\t\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\t\t\t\t\tcmd    : cmd,\n\t\t\t\t\t\t\t\t\t\t\ttarget : h\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tif (until) {\n\t\t\t\t\t\t\t\t\t\tdata.until = until;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : data,\n\t\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbaseHash, baseId;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treqs = $.map(ends, function(h) {\n\t\t\t\t\t\t\t\tvar d = fm.file(h),\n\t\t\t\t\t\t\t\t\tisRoot = d? fm.isRoot(d) : false,\n\t\t\t\t\t\t\t\t\tnode = fm.navHash2Elm(h),\n\t\t\t\t\t\t\t\t\tgetPhash = function(h, dep) {\n\t\t\t\t\t\t\t\t\t\tvar d, ph,\n\t\t\t\t\t\t\t\t\t\t\tdepth = dep || 1;\n\t\t\t\t\t\t\t\t\t\tph = (d = fm.file(h))? d.phash : false;\n\t\t\t\t\t\t\t\t\t\tif (ph && depth > 1) {\n\t\t\t\t\t\t\t\t\t\t\treturn getPhash(ph, --depth);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn ph;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tuntil,\n\t\t\t\t\t\t\t\t\tclosest = (function() {\n\t\t\t\t\t\t\t\t\t\tvar phash = getPhash(h);\n\t\t\t\t\t\t\t\t\t\tuntil = phash;\n\t\t\t\t\t\t\t\t\t\twhile (phash) {\n\t\t\t\t\t\t\t\t\t\t\tif (fm.navHash2Elm(phash).hasClass(loaded)) {\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tuntil = phash;\n\t\t\t\t\t\t\t\t\t\t\tphash = getPhash(phash);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!phash) {\n\t\t\t\t\t\t\t\t\t\t\tuntil = void(0);\n\t\t\t\t\t\t\t\t\t\t\tphash = fm.root(h);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn phash;\n\t\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t\t\tcmd;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (!node.hasClass(loaded) && (isRoot || !d || !fm.navHash2Elm(d.phash).hasClass(loaded))) {\n\t\t\t\t\t\t\t\t\tif (isRoot || closest === getPhash(h) || closest === getPhash(h, 2)) {\n\t\t\t\t\t\t\t\t\t\tuntil = void(0);\n\t\t\t\t\t\t\t\t\t\tcmd = 'tree';\n\t\t\t\t\t\t\t\t\t\tif (!isRoot) {\n\t\t\t\t\t\t\t\t\t\t\th = getPhash(h);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcmd = 'parents';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!baseHash) {\n\t\t\t\t\t\t\t\t\t\tbaseHash = (cmd === 'tree')? h : closest;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn makeReq(cmd, h, until);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (reqs.length) {\n\t\t\t\t\t\t\t\tselectPages(fm.file(baseHash));\n\t\t\t\t\t\t\t\tbaseId = fm.navHash2Id(baseHash);\n\t\t\t\t\t\t\t\tautoScr && autoScroll(baseId);\n\t\t\t\t\t\t\t\tbaseNode = $('#'+baseId);\n\t\t\t\t\t\t\t\tspinner = $(fm.res('tpl', 'navspinner')).insertBefore(baseNode.children('.'+arrow));\n\t\t\t\t\t\t\t\tbaseNode.removeClass(collapsed);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$.when.apply($, reqs)\n\t\t\t\t\t\t\t\t.done(function() {\n\t\t\t\t\t\t\t\t\tvar res = {},data, treeDirs, dirs, argLen, i;\n\t\t\t\t\t\t\t\t\targLen = arguments.length;\n\t\t\t\t\t\t\t\t\tif (argLen > 0) {\n\t\t\t\t\t\t\t\t\t\tfor (i = 0; i < argLen; i++) {\n\t\t\t\t\t\t\t\t\t\t\tdata = arguments[i].tree || [];\n\t\t\t\t\t\t\t\t\t\t\tres[ends[i]] = Object.assign([], filter(data));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdfd.resolve(res);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn dfd.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdone= function(res, dfrd) {\n\t\t\t\t\t\t\tvar open = function() {\n\t\t\t\t\t\t\t\t\tif (openRoot && baseNode) {\n\t\t\t\t\t\t\t\t\t\tfindSubtree(baseNode.hash).show().prev(selNavdir).addClass(expanded);\n\t\t\t\t\t\t\t\t\t\topenRoot = false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (autoScr) {\n\t\t\t\t\t\t\t\t\t\tautoScroll().done(checkSubdirs);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcurrent;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t$.each(res, function(endHash, dirs) {\n\t\t\t\t\t\t\t\t\tdirs && updateTree(dirs);\n\t\t\t\t\t\t\t\t\tselectPages(fm.file(endHash));\n\t\t\t\t\t\t\t\t\tdirs && updateArrows(dirs, loaded);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (cwdDirs) {\n\t\t\t\t\t\t\t\t(fm.api < 2.1) && cwdDirs.push(cwd);\n\t\t\t\t\t\t\t\tupdateTree(cwdDirs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// set current node\n\t\t\t\t\t\t\tcurrent = selectPages();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!current.hasClass(active)) {\n\t\t\t\t\t\t\t\ttree.find(selNavdir+'.'+active).removeClass(active);\n\t\t\t\t\t\t\t\tcurrent.addClass(active);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// mark as loaded to cwd parents\n\t\t\t\t\t\t\tcurrent.parents('.elfinder-navbar-wrapper').children('.'+navdir).addClass(loaded);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\tfm.lazy(open).done(function() {\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topen();\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trmSpinner = function(fail) {\n\t\t\t\t\t\t\tif (baseNode) {\n\t\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t\t\tbaseNode.addClass(collapsed + (fail? '' : (' ' + loaded)));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\t\tbaseNode, spinner;\n\t\t\t\t\t\n\t\t\t\t\tif (!fm.navHash2Elm(cwdhash).length) {\n\t\t\t\t\t\tsyncing = true;\n\t\t\t\t\t\tloadParents()\n\t\t\t\t\t\t.done(function(res) {\n\t\t\t\t\t\t\tdone(res, dfrd);\n\t\t\t\t\t\t\trmSpinner();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function() { \n\t\t\t\t\t\t\trmSpinner(true);\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\tsyncing = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdone(void(0), dfrd);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// trigger 'treesync' with my $.Deferred\n\t\t\t\t\tfm.trigger('treesync', dfrd);\n\n\t\t\t\t\treturn dfrd;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Make writable and not root dirs droppable\n\t\t\t\t *\n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tupdateDroppable = function(target, node) {\n\t\t\t\t\tvar limit = 100,\n\t\t\t\t\t\tnext;\n\t\t\t\t\t\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tif (!node || node.closest('div.'+wrapperRoot).hasClass(uploadable)) {\n\t\t\t\t\t\t\t(node || tree.find('div.'+uploadable)).find(selNavdir+':not(.elfinder-ro,.elfinder-na)').addClass('native-droppable');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!node || node.closest('div.'+wrapperRoot).hasClass(pastable)) {\n\t\t\t\t\t\t\ttarget = (node || tree.find('div.'+pastable)).find(selNavdir+':not(.'+droppable+')');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget = $();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\t// check leaf roots\n\t\t\t\t\t\t\tnode.children('div.'+wrapperRoot).each(function() {\n\t\t\t\t\t\t\t\tupdateDroppable(null, $(this));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// make droppable on async\n\t\t\t\t\tif (target.length) {\n\t\t\t\t\t\tfm.asyncJob(function(elm) {\n\t\t\t\t\t\t\t$(elm).droppable(droppableopts);\n\t\t\t\t\t\t}, $.makeArray(target), {\n\t\t\t\t\t\t\tinterval : 20,\n\t\t\t\t\t\t\tnumPerOnce : 100\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Check required folders for subfolders and update arrow classes\n\t\t\t\t *\n\t\t\t\t * @param  Array  folders to check\n\t\t\t\t * @param  String css class \n\t\t\t\t * @return void\n\t\t\t\t */\n\t\t\t\tupdateArrows = function(dirs, cls) {\n\t\t\t\t\tvar sel = cls == loaded\n\t\t\t\t\t\t\t? '.'+collapsed+':not(.'+loaded+')'\n\t\t\t\t\t\t\t: ':not(.'+collapsed+')';\n\t\t\t\t\t\n\t\t\t\t\t$.each(dirs, function(i, dir) {\n\t\t\t\t\t\tfm.navHash2Elm(dir.phash).filter(sel)\n\t\t\t\t\t\t\t.filter(function() { return $.grep($(this).next('.'+subtree).children(), function(n) {\n\t\t\t\t\t\t\t\treturn ($(n).children().hasClass(root))? false : true;\n\t\t\t\t\t\t\t}).length > 0; })\n\t\t\t\t\t\t\t.addClass(cls);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Navigation tree\n\t\t\t\t *\n\t\t\t\t * @type JQuery\n\t\t\t\t */\n\t\t\t\ttree = $(this).addClass(treeclass)\n\t\t\t\t\t// make dirs draggable and toggle hover class\n\t\t\t\t\t.on('mouseenter mouseleave', selNavdir, function(e) {\n\t\t\t\t\t\tvar enter = (e.type === 'mouseenter');\n\t\t\t\t\t\tif (enter && scrolling) { return; }\n\t\t\t\t\t\tvar link  = $(this),\n\t\t\t\t\t\t\thash, dir; \n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!link.hasClass(dropover+' '+disabled)) {\n\t\t\t\t\t\t\tif (!mobile && enter && !link.data('dragRegisted') && !link.hasClass(root+' '+draggable+' elfinder-na elfinder-wo')) {\n\t\t\t\t\t\t\t\tlink.data('dragRegisted', true);\n\t\t\t\t\t\t\t\tif (fm.isCommandEnabled('copy', (hash = fm.navId2Hash(link.attr('id'))))) {\n\t\t\t\t\t\t\t\t\tlink.draggable(fm.draggable);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlink.toggleClass(hover, enter);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// update title attr if necessary\n\t\t\t\t\t\tif (enter && opts.attrTitle) {\n\t\t\t\t\t\t\tdir = fm.file(hash || fm.navId2Hash(link.attr('id')));\n\t\t\t\t\t\t\tif (!dir.isroot && link.attr('title') === (dir.i18 || dir.name)) {\n\t\t\t\t\t\t\t\tlink.attr('title', fm.path(hash, true));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// native drag enter\n\t\t\t\t\t.on('dragenter', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar dst = $(this);\n\t\t\t\t\t\t\tdst.addClass(hover);\n\t\t\t\t\t\t\tif (dst.is('.'+collapsed+':not(.'+expanded+')')) {\n\t\t\t\t\t\t\t\tdst.data('expandTimer', setTimeout(function() {\n\t\t\t\t\t\t\t\t\tdst.is('.'+collapsed+'.'+hover) && dst.children('.'+arrow).trigger('click');\n\t\t\t\t\t\t\t\t}, 500));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// native drag leave\n\t\t\t\t\t.on('dragleave', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\tvar dst = $(this);\n\t\t\t\t\t\t\tdst.data('expandTimer') && clearTimeout(dst.data('expandTimer'));\n\t\t\t\t\t\t\tdst.removeClass(hover);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// open dir or open subfolders in tree\n\t\t\t\t\t.on('click', selNavdir, function(e) {\n\t\t\t\t\t\tvar link = $(this),\n\t\t\t\t\t\t\thash = fm.navId2Hash(link.attr('id')),\n\t\t\t\t\t\t\tfile = fm.file(hash);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (link.data('longtap')) {\n\t\t\t\t\t\t\tlink.removeData('longtap');\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!link.hasClass(active)) {\n\t\t\t\t\t\t\ttree.find(selNavdir+'.'+active).removeClass(active);\n\t\t\t\t\t\t\tlink.addClass(active);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (hash != fm.cwd().hash && !link.hasClass(disabled)) {\n\t\t\t\t\t\t\tfm.exec('open', hash).done(function() {\n\t\t\t\t\t\t\t\tfm.one('opendone', function() {\n\t\t\t\t\t\t\t\t\tfm.select({selected: [hash], origin: 'navbar'});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (link.hasClass(collapsed)) {\n\t\t\t\t\t\t\t\t//link.children('.'+arrow).trigger('click');  // modified by lwf\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.select({selected: [hash], origin: 'navbar'});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// for touch device\n\t\t\t\t\t.on('touchstart', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar evt = e.originalEvent,\n\t\t\t\t\t\t\tp;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (e.target.nodeName === 'INPUT') {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tp = $(this).addClass(hover)\n\t\t\t\t\t\t.removeData('longtap')\n\t\t\t\t\t\t.data('tmlongtap', setTimeout(function(e){\n\t\t\t\t\t\t\t// long tap\n\t\t\t\t\t\t\tp.data('longtap', true);\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t'type'    : 'navbar',\n\t\t\t\t\t\t\t\t'targets' : [fm.navId2Hash(p.attr('id'))],\n\t\t\t\t\t\t\t\t'x'       : evt.touches[0].pageX,\n\t\t\t\t\t\t\t\t'y'       : evt.touches[0].pageY\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 500));\n\t\t\t\t\t})\n\t\t\t\t\t.on('touchmove touchend', selNavdir, function(e) {\n\t\t\t\t\t\tif (e.target.nodeName === 'INPUT') {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclearTimeout($(this).data('tmlongtap'));\n\t\t\t\t\t\t$(this).removeData('tmlongtap');\n\t\t\t\t\t\tif (e.type == 'touchmove') {\n\t\t\t\t\t\t\t$(this).removeClass(hover);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t// toggle subfolders in tree\n\t\t\t\t\t.on('click', selNavdir+'.'+collapsed+' .'+arrow, function(e) {\n\t\t\t\t\t\tvar arrow = $(this),\n\t\t\t\t\t\t\tlink  = arrow.parent(selNavdir),\n\t\t\t\t\t\t\tstree = link.next('.'+subtree),\n\t\t\t\t\t\t\tdfrd  = $.Deferred(),\n\t\t\t\t\t\t\tslideTH = 30, cnt;\n\n\t\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\t\tif (link.hasClass(loaded)) {\n\t\t\t\t\t\t\tlink.toggleClass(expanded);\n\t\t\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\t\t\tcnt = link.hasClass(expanded)? stree.children().length + stree.find('div.elfinder-navbar-subtree[style*=block]').children().length : stree.find('div:visible').length;\n\t\t\t\t\t\t\t\tif (cnt > slideTH) {\n\t\t\t\t\t\t\t\t\tstree.toggle();\n\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tstree.stop(true, true)[link.hasClass(expanded)? 'slideDown' : 'slideUp'](opts.durations.slideUpDown, function(){\n\t\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tspinner.insertBefore(arrow);\n\t\t\t\t\t\t\tlink.removeClass(collapsed);\n\n\t\t\t\t\t\t\tfm.request({cmd : 'tree', target : fm.navId2Hash(link.attr('id'))})\n\t\t\t\t\t\t\t\t.done(function(data) { \n\t\t\t\t\t\t\t\t\tupdateTree(Object.assign([], filter(data.tree))); \n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (stree.children().length) {\n\t\t\t\t\t\t\t\t\t\tlink.addClass(collapsed+' '+expanded);\n\t\t\t\t\t\t\t\t\t\tif (stree.children().length > slideTH) {\n\t\t\t\t\t\t\t\t\t\t\tstree.show();\n\t\t\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tstree.stop(true, true).slideDown(opts.durations.slideUpDown, function(){\n\t\t\t\t\t\t\t\t\t\t\t\tfm.draggingUiHelper && fm.draggingUiHelper.data('refreshPositions', 1);\n\t\t\t\t\t\t\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t\t\t\tlink.addClass(loaded);\n\t\t\t\t\t\t\t\t\tfm.one('treedone', function() {\n\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tarrow.data('dfrd', dfrd);\n\t\t\t\t\t})\n\t\t\t\t\t.on('contextmenu', selNavdir, function(e) {\n\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now dirname editing\n\t\t\t\t\t\tif (self.find('input:text').length) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tif (!self.data('tmlongtap')) {\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t'type'    : 'navbar',\n\t\t\t\t\t\t\t\t'targets' : [fm.navId2Hash($(this).attr('id'))],\n\t\t\t\t\t\t\t\t'x'       : e.pageX,\n\t\t\t\t\t\t\t\t'y'       : e.pageY\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.getUI('contextmenu').children().on('mouseenter', function() {\n\t\t\t\t\t\t\tself.addClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.bind('closecontextmenu', function() {\n\t\t\t\t\t\t\tself.removeClass('ui-state-hover');\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('scrolltoview', selNavdir, function(e, data) {\n\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\tautoScroll(self.attr('id')).done(function() {\n\t\t\t\t\t\t\tif (!data || data.blink === 'undefined' || data.blink) {\n\t\t\t\t\t\t\t\tfm.resources.blink(self, 'lookme');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t// prepend fake dir\n\t\t\t\t\t.on('create.'+fm.namespace, function(e, item) {\n\t\t\t\t\t\tvar pdir = findSubtree(item.phash),\n\t\t\t\t\t\t\tlock = item.move || false,\n\t\t\t\t\t\t\tdir  = $(itemhtml(item)).addClass('elfinder-navbar-wrapper-tmp'),\n\t\t\t\t\t\t\tselected = fm.selected();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tlock && selected.length && fm.trigger('lockfiles', {files: selected});\n\t\t\t\t\t\tpdir.prepend(dir);\n\t\t\t\t\t}),\n\t\t\t\tscrolling = false,\n\t\t\t\tnavbarScrTm,\n\t\t\t\t// move tree into navbar\n\t\t\t\tnavbar = fm.getUI('navbar').append(tree).show().on('scroll', function() {\n\t\t\t\t\tscrolling = true;\n\t\t\t\t\tnavbarScrTm && cancelAnimationFrame(navbarScrTm);\n\t\t\t\t\tnavbarScrTm = requestAnimationFrame(function() {\n\t\t\t\t\t\tscrolling = false;\n\t\t\t\t\t\tcheckSubdirs();\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t\t\n\t\t\t\tprevSortTreeview = fm.sortAlsoTreeview;\n\t\t\t\t\n\t\t\tfm.open(function(e) {\n\t\t\t\tvar data = e.data,\n\t\t\t\t\tdirs = filter(data.files),\n\t\t\t\t\tcontextmenu = fm.getUI('contextmenu');\n\n\t\t\t\tdata.init && tree.empty();\n\n\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\tnavbar.removeClass('overflow-scrolling-touch').addClass('overflow-scrolling-touch');\n\t\t\t\t}\n\n\t\t\t\tif (dirs.length) {\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tif (!contextmenu.data('cmdMaps')) {\n\t\t\t\t\t\t\tcontextmenu.data('cmdMaps', {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\tsync(dirs);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tsync();\n\t\t\t\t}\n\t\t\t})\n\t\t\t// add new dirs\n\t\t\t.add(function(e) {\n\t\t\t\tvar dirs = filter(e.data.added);\n\n\t\t\t\tif (dirs.length) {\n\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\tupdateArrows(dirs, collapsed);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// update changed dirs\n\t\t\t.change(function(e) {\n\t\t\t\t// do ot perfome while syncing\n\t\t\t\tif (syncing) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar dirs = filter(e.data.changed, true),\n\t\t\t\t\tlength = dirs.length,\n\t\t\t\t\tl    = length,\n\t\t\t\t\ttgts = $(),\n\t\t\t\t\tchanged = {},\n\t\t\t\t\tdir, phash, node, tmp, realParent, reqParent, realSibling, reqSibling, isExpanded, isLoaded, parent, subdirs;\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'prepare' });\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\twhile (l--) {\n\t\t\t\t\tdir = dirs[l];\n\t\t\t\t\tphash = dir.phash;\n\t\t\t\t\tif ((node = fm.navHash2Elm(dir.hash)).length) {\n\t\t\t\t\t\tparent = node.parent();\n\t\t\t\t\t\tif (phash) {\n\t\t\t\t\t\t\trealParent  = node.closest('.'+subtree);\n\t\t\t\t\t\t\treqParent   = findSubtree(phash);\n\t\t\t\t\t\t\trealSibling = node.parent().next();\n\t\t\t\t\t\t\treqSibling  = findSibling(reqParent, dir);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!reqParent.length) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (reqParent[0] !== realParent[0] || realSibling.get(0) !== reqSibling.get(0)) {\n\t\t\t\t\t\t\t\treqSibling.length ? reqSibling.before(parent) : reqParent.append(parent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tisExpanded = node.hasClass(expanded);\n\t\t\t\t\t\tisLoaded   = node.hasClass(loaded);\n\t\t\t\t\t\ttmp        = $(itemhtml(dir));\n\t\t\t\t\t\tnode.replaceWith(tmp.children(selNavdir));\n\t\t\t\t\t\t! mobile && updateDroppable(null, parent);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (dir.dirs\n\t\t\t\t\t\t&& (isExpanded || isLoaded) \n\t\t\t\t\t\t&& (node = fm.navHash2Elm(dir.hash))\n\t\t\t\t\t\t&& node.next('.'+subtree).children().length) {\n\t\t\t\t\t\t\tisExpanded && node.addClass(expanded);\n\t\t\t\t\t\t\tisLoaded && node.addClass(loaded);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsubdirs |= dir.dirs == -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// to check subdirs\n\t\t\t\tif (subdirs) {\n\t\t\t\t\tcheckSubdirs();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'done' });\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tlength && sync(void(0), false);\n\t\t\t})\n\t\t\t// remove dirs\n\t\t\t.remove(function(e) {\n\t\t\t\tvar dirs = e.data.removed,\n\t\t\t\t\tl    = dirs.length,\n\t\t\t\t\tnode, stree, removed;\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { removed : dirs });\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'prepare' });\n\t\t\t\t});\n\n\t\t\t\twhile (l--) {\n\t\t\t\t\tif ((node = fm.navHash2Elm(dirs[l])).length) {\n\t\t\t\t\t\tremoved = true;\n\t\t\t\t\t\tstree = node.closest('.'+subtree);\n\t\t\t\t\t\tnode.parent().detach();\n\t\t\t\t\t\tif (!stree.children().length) {\n\t\t\t\t\t\t\tstree.hide().prev(selNavdir).removeClass(collapsed+' '+expanded+' '+loaded);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tremoved && fm.getUI('navbar').children('.ui-resizable-handle').trigger('resize');\n\t\t\t\t\n\t\t\t\t$.each(hasMoreDirs, function(h, node) {\n\t\t\t\t\tnode.trigger('update.'+fm.namespace, { change: 'done' });\n\t\t\t\t});\n\t\t\t})\n\t\t\t// lock/unlock dirs while moving\n\t\t\t.bind('lockfiles unlockfiles', function(e) {\n\t\t\t\tvar lock = e.type == 'lockfiles',\n\t\t\t\t\thelperLocked = e.data.helper? e.data.helper.data('locked') : false,\n\t\t\t\t\tact  = (lock && !helperLocked) ? 'disable' : 'enable',\n\t\t\t\t\tdirs = $.grep(e.data.files||[], function(h) {  \n\t\t\t\t\t\tvar dir = fm.file(h);\n\t\t\t\t\t\treturn dir && dir.mime == 'directory' ? true : false;\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t$.each(dirs, function(i, hash) {\n\t\t\t\t\tvar dir = fm.navHash2Elm(hash);\n\t\t\t\t\t\n\t\t\t\t\tif (dir.length && !helperLocked) {\n\t\t\t\t\t\tdir.hasClass(draggable) && dir.draggable(act);\n\t\t\t\t\t\tdir.hasClass(droppable) && dir.droppable(act);\n\t\t\t\t\t\tdir[lock ? 'addClass' : 'removeClass'](disabled);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.bind('sortchange', function() {\n\t\t\t\tif (fm.sortAlsoTreeview || prevSortTreeview !== fm.sortAlsoTreeview) {\n\t\t\t\t\tvar dirs,\n\t\t\t\t\t\tends = [],\n\t\t\t\t\t\tendsMap = {},\n\t\t\t\t\t\tendsVid = {},\n\t\t\t\t\t\ttopVid = '',\n\t\t\t\t\t\tsingle = false,\n\t\t\t\t\t\tcurrent;\n\t\t\t\t\t\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tdirs = filter(fm.files());\n\t\t\t\t\t\tprevSortTreeview = fm.sortAlsoTreeview;\n\t\t\t\t\t\t\n\t\t\t\t\t\ttree.empty();\n\t\t\t\t\t\t\n\t\t\t\t\t\t// append volume roots at first\n\t\t\t\t\t\tupdateTree($.map(fm.roots, function(h) {\n\t\t\t\t\t\t\tvar dir = fm.file(h);\n\t\t\t\t\t\t\treturn dir && !dir.phash? dir : null;\n\t\t\t\t\t\t}));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!Object.keys(hasMoreDirs).length) {\n\t\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\t\tcurrent = selectPages();\n\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tends = getEnds();\n\t\t\t\t\t\t\tif (ends.length > 1) {\n\t\t\t\t\t\t\t\t$.each(ends, function(i, end) {\n\t\t\t\t\t\t\t\t\tvar vid = fm.file(fm.root(end)).volumeid; \n\t\t\t\t\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\t\t\t\t\ttopVid = vid;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tendsVid[vid] = end;\n\t\t\t\t\t\t\t\t\tendsMap[end] = [];\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\t\t\tif (!d.volumeid) {\n\t\t\t\t\t\t\t\t\t\tsingle = true;\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tendsMap[endsVid[d.volumeid] || endsVid[topVid]].push(d);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsingle = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (single) {\n\t\t\t\t\t\t\t\t$.each(ends, function(i, endHash) {\n\t\t\t\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\t\t\t\tcurrent = selectPages(fm.file(endHash));\n\t\t\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$.each(endsMap, function(endHash, dirs) {\n\t\t\t\t\t\t\t\t\tupdateTree(dirs);\n\t\t\t\t\t\t\t\t\tcurrent = selectPages(fm.file(endHash));\n\t\t\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tsync();\n\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\t\t\n\t\treturn this;\n\t};\n\n\n\treturn $;\n});\n\ndefine('skylark-elfinder/ui/uploadButton',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar's button tor upload file\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderuploadbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar fm = cmd.fm,\n\t\t\t\tbutton = $(this).elfinderbutton(cmd)\n\t\t\t\t\t.off('click'), \n\t\t\t\tform = $('<form/>').appendTo(button),\n\t\t\t\tinput = $('<input type=\"file\" multiple=\"true\" title=\"'+cmd.fm.i18n('selectForUpload')+'\"/>')\n\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\tvar _input = $(this);\n\t\t\t\t\t\tif (_input.val()) {\n\t\t\t\t\t\t\tfm.exec('upload', {input : _input.remove()[0]}, void(0), fm.cwd().hash);\n\t\t\t\t\t\t\tinput.clone(true).appendTo(form);\n\t\t\t\t\t\t} \n\t\t\t\t\t})\n\t\t\t\t\t.on('dragover', function(e) {\n\t\t\t\t\t\te.originalEvent.dataTransfer.dropEffect = 'copy';\n\t\t\t\t\t}),\n\t\t\t\ttm;\n\n\t\t\tform.append(input.clone(true));\n\t\t\t\t\t\n\t\t\tcmd.change(function() {\n\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\tvar toShow = cmd.disabled();\n\t\t\t\t\tif (form.is('visible')) {\n\t\t\t\t\t\t!toShow && form.hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoShow && form.show();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.change();\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/viewbutton',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class  elFinder toolbar button to switch current directory view.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderviewbutton = function(cmd) {\n\t\t\"use strict\";\n\t\treturn this.each(function() {\n\t\t\tvar button = $(this).elfinderbutton(cmd),\n\t\t\t\ticon   = button.children('.elfinder-button-icon'),\n\t\t\t\ttext   = button.children('.elfinder-button-text'),\n\t\t\t\ttm;\n\n\t\t\tcmd.change(function() {\n\t\t\t\ttm && cancelAnimationFrame(tm);\n\t\t\t\ttm = requestAnimationFrame(function() {\n\t\t\t\t\tvar icons = cmd.value == 'icons';\n\n\t\t\t\t\ticon.toggleClass('elfinder-button-icon-view-list', icons);\n\t\t\t\t\tcmd.className = icons? 'view-list' : '';\n\t\t\t\t\tcmd.title = cmd.fm.i18n(icons ? 'viewlist' : 'viewicons');\n\t\t\t\t\tbutton.attr('title', cmd.title);\n\t\t\t\t\ttext.html(cmd.title);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n});\ndefine('skylark-elfinder/ui/workzone',[\n\t\"skylark-jquery\"\n],function($) {\n\t/**\n\t * @class elfinderworkzone - elFinder container for nav and current directory\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t$.fn.elfinderworkzone = function(fm) {\n\t\t\"use strict\";\n\t\tvar cl = 'elfinder-workzone';\n\t\t\n\t\tthis.not('.'+cl).each(function() {\n\t\t\tvar wz     = $(this).addClass(cl),\n\t\t\t\tprevH  = Math.round(wz.height()),\n\t\t\t\tparent = wz.parent(),\n\t\t\t\tsetDelta = function() {\n\t\t\t\t\twdelta = wz.outerHeight(true) - wz.height();\n\t\t\t\t},\n\t\t\t\tfitsize = function(e) {\n\t\t\t\t\tvar height = parent.height() - wdelta,\n\t\t\t\t\t\tstyle  = parent.attr('style'),\n\t\t\t\t\t\tcurH   = Math.round(wz.height());\n\t\t\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tparent.css('overflow', 'hidden')\n\t\t\t\t\t\t.children(':visible:not(.'+cl+')').each(function() {\n\t\t\t\t\t\t\tvar ch = $(this);\n\t\t\t\n\t\t\t\t\t\t\tif (ch.css('position') != 'absolute' && ch.css('position') != 'fixed') {\n\t\t\t\t\t\t\t\theight -= ch.outerHeight(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\tparent.attr('style', style || '');\n\t\t\t\t\t\n\t\t\t\t\theight = Math.max(0, Math.round(height));\n\t\t\t\t\tif (prevH !== height || curH !== height) {\n\t\t\t\t\t\tprevH  = Math.round(wz.height());\n\t\t\t\t\t\twz.height(height);\n\t\t\t\t\t\tfm.trigger('wzresize');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcssloaded = function() {\n\t\t\t\t\twdelta = wz.outerHeight(true) - wz.height();\n\t\t\t\t\tfitsize();\n\t\t\t\t},\n\t\t\t\twdelta;\n\t\t\t\n\t\t\tsetDelta();\n\t\t\tparent.on('resize.' + fm.namespace, fitsize);\n\t\t\tfm.one('cssloaded', cssloaded)\n\t\t\t  .bind('uiresize', fitsize)\n\t\t\t  .bind('themechange', setDelta);\n\t\t});\n\t\treturn this;\n\t};\n\n});\ndefine('skylark-elfinder/commands/archive',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.archive = function() {\n\t\t\"use strict\";\n\t\tvar self  = this,\n\t\t\tfm    = self.fm,\n\t\t\tmimes = [],\n\t\t\tdfrd;\n\t\t\t\n\t\tthis.variants = [];\n\t\t\n\t\tthis.disableOnSearch = false;\n\t\t\n\t\tthis.nextAction = {};\n\t\t\n\t\t/**\n\t\t * Update mimes on open/reload\n\t\t *\n\t\t * @return void\n\t\t **/\n\t\tfm.bind('open reload', function() {\n\t\t\tself.variants = [];\n\t\t\t$.each((mimes = fm.option('archivers')['create'] || []), function(i, mime) {\n\t\t\t\tself.variants.push([mime, fm.mime2kind(mime)]);\n\t\t\t});\n\t\t\tself.change();\n\t\t});\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length,\n\t\t\t\tchk = (cnt && ! fm.isRoot(sel[0]) && (fm.file(sel[0].phash) || {}).write && ! $.grep(sel, function(f){ return f.read ? false : true; }).length),\n\t\t\t\tcwdId;\n\t\t\t\n\t\t\tif (chk && fm.searchStatus.state > 1) {\n\t\t\t\tcwdId = fm.cwd().volumeid;\n\t\t\t\tchk = (cnt === $.grep(sel, function(f) { return f.read && f.hash.indexOf(cwdId) === 0 ? true : false; }).length);\n\t\t\t}\n\t\t\t\n\t\t\treturn chk && !this._disabled && mimes.length && (cnt || (dfrd && dfrd.state() == 'pending')) ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, type) {\n\t\t\tvar files = this.files(hashes),\n\t\t\t\tcnt   = files.length,\n\t\t\t\tmime  = type || mimes[0],\n\t\t\t\tcwd   = fm.file(files[0].phash) || null,\n\t\t\t\terror = ['errArchive', 'errPerm', 'errCreatingTempDir', 'errFtpDownloadFile', 'errFtpUploadFile', 'errFtpMkdir', 'errArchiveExec', 'errExtractExec', 'errRm'],\n\t\t\t\ti, open;\n\n\t\t\tdfrd = $.Deferred().fail(function(error) {\n\t\t\t\terror && fm.error(error);\n\t\t\t});\n\n\t\t\tif (! (cnt && mimes.length && $.inArray(mime, mimes) !== -1)) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tif (!cwd.write) {\n\t\t\t\treturn dfrd.reject(error);\n\t\t\t}\n\t\t\t\n\t\t\tfor (i = 0; i < cnt; i++) {\n\t\t\t\tif (!files[i].read) {\n\t\t\t\t\treturn dfrd.reject(error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tself.mime   = mime;\n\t\t\tself.prefix = ((cnt > 1)? 'Archive' : files[0].name) + (fm.option('archivers')['createext']? '.' + fm.option('archivers')['createext'][mime] : '');\n\t\t\tself.data   = {targets : self.hashes(hashes), type : mime};\n\t\t\t\n\t\t\tif (fm.cwd().hash !== cwd.hash) {\n\t\t\t\topen = fm.exec('open', cwd.hash).done(function() {\n\t\t\t\t\tfm.one('cwdrender', function() {\n\t\t\t\t\t\tfm.selectfiles({files : hashes});\n\t\t\t\t\t\tdfrd = $.proxy(fm.res('mixin', 'make'), self)();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfm.selectfiles({files : hashes});\n\t\t\t\tdfrd = $.proxy(fm.res('mixin', 'make'), self)();\n\t\t\t}\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/back',[\n\t\"../elFinder\"\n],function(elFinder){\n\t(elFinder.prototype.commands.back = function() {\n\t\t\"use strict\";\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts      = [{\n\t\t\tpattern     : 'ctrl+left backspace'\n\t\t}];\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn this.fm.history.canBack() ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\treturn this.fm.history.back();\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/chmod',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.chmod = function() {\n\t\t\"use strict\";\n\t\tthis.updateOnSelect = false;\n\t\tvar fm  = this.fm,\n\t\t\tlevel = {\n\t\t\t\t0 : 'owner',\n\t\t\t\t1 : 'group',\n\t\t\t\t2 : 'other'\n\t\t\t},\n\t\t\tmsg = {\n\t\t\t\tread     : fm.i18n('read'),\n\t\t\t\twrite    : fm.i18n('write'),\n\t\t\t\texecute  : fm.i18n('execute'),\n\t\t\t\tperm     : fm.i18n('perm'),\n\t\t\t\tkind     : fm.i18n('kind'),\n\t\t\t\tfiles    : fm.i18n('files')\n\t\t\t},\n\t\t\tisPerm = function(perm){\n\t\t\t\treturn (!isNaN(parseInt(perm, 8) && parseInt(perm, 8) <= 511) || perm.match(/^([r-][w-][x-]){3}$/i));\n\t\t\t};\n\n\t\tthis.tpl = {\n\t\t\tmain       : '<div class=\"ui-helper-clearfix elfinder-info-title\"><span class=\"elfinder-cwd-icon {class} ui-corner-all\"/>{title}</div>'\n\t\t\t\t\t\t+'{dataTable}',\n\t\t\titemTitle  : '<strong>{name}</strong><span id=\"elfinder-info-kind\">{kind}</span>',\n\t\t\tgroupTitle : '<strong>{items}: {num}</strong>',\n\t\t\tdataTable  : '<table id=\"{id}-table-perm\"><tr><td>{0}</td><td>{1}</td><td>{2}</td></tr></table>'\n\t\t\t\t\t\t+'<div class=\"\">'+msg.perm+': <input class=\"elfinder-tabstop elfinder-focus\" id=\"{id}-perm\" type=\"text\" size=\"4\" maxlength=\"3\" value=\"{value}\"></div>',\n\t\t\tfieldset   : '<fieldset id=\"{id}-fieldset-{level}\"><legend>{f_title}{name}</legend>'\n\t\t\t\t\t\t+'<input type=\"checkbox\" value=\"4\" class=\"elfinder-tabstop\" id=\"{id}-read-{level}-perm\"{checked-r}> <label for=\"{id}-read-{level}-perm\">'+msg.read+'</label><br>'\n\t\t\t\t\t\t+'<input type=\"checkbox\" value=\"6\" class=\"elfinder-tabstop\" id=\"{id}-write-{level}-perm\"{checked-w}> <label for=\"{id}-write-{level}-perm\">'+msg.write+'</label><br>'\n\t\t\t\t\t\t+'<input type=\"checkbox\" value=\"5\" class=\"elfinder-tabstop\" id=\"{id}-execute-{level}-perm\"{checked-x}> <label for=\"{id}-execute-{level}-perm\">'+msg.execute+'</label><br>'\n\t\t};\n\n\t\tthis.shortcuts = [{\n\t\t\t//pattern     : 'ctrl+p'\n\t\t}];\n\n\t\tthis.getstate = function(sel) {\n\t\t\tvar fm = this.fm;\n\t\t\tsel = sel || fm.selected();\n\t\t\tif (sel.length == 0) {\n\t\t\t\tsel = [ fm.cwd().hash ];\n\t\t\t}\n\t\t\treturn this.checkstate(this.files(sel)) ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.checkstate = function(sel) {\n\t\t\tvar cnt = sel.length;\n\t\t\tif (!cnt) return false;\n\t\t\tvar chk = $.grep(sel, function(f) {\n\t\t\t\treturn (f.isowner && f.perm && isPerm(f.perm) && (cnt == 1 || f.mime != 'directory')) ? true : false;\n\t\t\t}).length;\n\t\t\treturn (cnt == chk)? true : false;\n\t\t};\n\n\t\tthis.exec = function(select) {\n\t\t\tvar hashes  = this.hashes(select),\n\t\t\t\tfiles   = this.files(hashes);\n\t\t\tif (! files.length) {\n\t\t\t\thashes = [ this.fm.cwd().hash ];\n\t\t\t\tfiles   = this.files(hashes);\n\t\t\t}\n\t\t\tvar fm  = this.fm,\n\t\t\tdfrd    = $.Deferred().always(function() {\n\t\t\t\tfm.enable();\n\t\t\t}),\n\t\t\ttpl     = this.tpl,\n\t\t\tcnt     = files.length,\n\t\t\tfile    = files[0],\n\t\t\tid = fm.namespace + '-perm-' + file.hash,\n\t\t\tview    = tpl.main,\n\t\t\tchecked = ' checked=\"checked\"',\n\t\t\tbuttons = function() {\n\t\t\t\tvar buttons = {};\n\t\t\t\tbuttons[fm.i18n('btnApply')] = save;\n\t\t\t\tbuttons[fm.i18n('btnCancel')] = function() { dialog.elfinderdialog('close'); };\n\t\t\t\treturn buttons;\n\t\t\t},\n\t\t\tsave = function() {\n\t\t\t\tvar perm = $.trim($('#'+id+'-perm').val()),\n\t\t\t\t\treqData;\n\t\t\t\t\n\t\t\t\tif (!isPerm(perm)) return false;\n\t\t\t\t\n\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\n\t\t\t\treqData = {\n\t\t\t\t\tcmd     : 'chmod',\n\t\t\t\t\ttargets : hashes,\n\t\t\t\t\tmode    : perm\n\t\t\t\t};\n\t\t\t\tfm.request({\n\t\t\t\t\tdata : reqData,\n\t\t\t\t\tnotify : {type : 'chmod', cnt : cnt}\n\t\t\t\t})\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tif (data.changed && data.changed.length) {\n\t\t\t\t\t\tdata.undo = {\n\t\t\t\t\t\t\tcmd : 'chmod',\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\tvar reqs = [];\n\t\t\t\t\t\t\t\t$.each(prevVals, function(perm, hashes) {\n\t\t\t\t\t\t\t\t\treqs.push(fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'chmod', targets : hashes, mode : perm},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'undo', cnt : hashes.length}\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn $.when.apply(null, reqs);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdata.redo = {\n\t\t\t\t\t\t\tcmd : 'chmod',\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\tdata : reqData,\n\t\t\t\t\t\t\t\t\tnotify : {type : 'redo', cnt : hashes.length}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetperm = function() {\n\t\t\t\tvar perm = '';\n\t\t\t\tvar _perm;\n\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t_perm = 0;\n\t\t\t\t\tif ($(\"#\"+id+\"-read-\"+level[i]+'-perm').is(':checked')) {\n\t\t\t\t\t\t_perm = (_perm | 4);\n\t\t\t\t\t}\n\t\t\t\t\tif ($(\"#\"+id+\"-write-\"+level[i]+'-perm').is(':checked')) {\n\t\t\t\t\t\t_perm = (_perm | 2);\n\t\t\t\t\t}\n\t\t\t\t\tif ($(\"#\"+id+\"-execute-\"+level[i]+'-perm').is(':checked')) {\n\t\t\t\t\t\t_perm = (_perm | 1);\n\t\t\t\t\t}\n\t\t\t\t\tperm += _perm.toString(8);\n\t\t\t\t}\n\t\t\t\t$('#'+id+'-perm').val(perm);\n\t\t\t},\n\t\t\tsetcheck = function(perm) {\n\t\t\t\tvar _perm;\n\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t_perm = parseInt(perm.slice(i, i+1), 8);\n\t\t\t\t\t$(\"#\"+id+\"-read-\"+level[i]+'-perm').prop(\"checked\", false);\n\t\t\t\t\t$(\"#\"+id+\"-write-\"+level[i]+'-perm').prop(\"checked\", false);\n\t\t\t\t\t$(\"#\"+id+\"-execute-\"+level[i]+'-perm').prop(\"checked\", false);\n\t\t\t\t\tif ((_perm & 4) == 4) {\n\t\t\t\t\t\t$(\"#\"+id+\"-read-\"+level[i]+'-perm').prop(\"checked\", true);\n\t\t\t\t\t}\n\t\t\t\t\tif ((_perm & 2) == 2) {\n\t\t\t\t\t\t$(\"#\"+id+\"-write-\"+level[i]+'-perm').prop(\"checked\", true);\n\t\t\t\t\t}\n\t\t\t\t\tif ((_perm & 1) == 1) {\n\t\t\t\t\t\t$(\"#\"+id+\"-execute-\"+level[i]+'-perm').prop(\"checked\", true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsetperm();\n\t\t\t},\n\t\t\tmakeperm = function(files) {\n\t\t\t\tvar perm = '777', ret = '', chk, _chk, _perm;\n\t\t\t\tvar len = files.length;\n\t\t\t\tfor (var i2 = 0; i2 < len; i2++) {\n\t\t\t\t\tchk = getPerm(files[i2].perm);\n\t\t\t\t\tif (! prevVals[chk]) {\n\t\t\t\t\t\tprevVals[chk] = [];\n\t\t\t\t\t}\n\t\t\t\t\tprevVals[chk].push(files[i2].hash);\n\t\t\t\t\tret = '';\n\t\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t\t_chk = parseInt(chk.slice(i, i+1), 8);\n\t\t\t\t\t\t_perm = parseInt(perm.slice(i, i+1), 8);\n\t\t\t\t\t\tif ((_chk & 4) != 4 && (_perm & 4) == 4) {\n\t\t\t\t\t\t\t_perm -= 4;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((_chk & 2) != 2 && (_perm & 2) == 2) {\n\t\t\t\t\t\t\t_perm -= 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ((_chk & 1) != 1 && (_perm & 1) == 1) {\n\t\t\t\t\t\t\t_perm -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tret += _perm.toString(8);\n\t\t\t\t\t}\n\t\t\t\t\tperm = ret;\n\t\t\t\t}\n\t\t\t\treturn perm;\n\t\t\t},\n\t\t\tmakeName = function(name) {\n\t\t\t\treturn name? ':'+name : '';\n\t\t\t},\n\t\t\tmakeDataTable = function(perm, f) {\n\t\t\t\tvar _perm, fieldset;\n\t\t\t\tvar value = '';\n\t\t\t\tvar dataTable = tpl.dataTable;\n\t\t\t\tfor (var i = 0; i < 3; i++){\n\t\t\t\t\t_perm = parseInt(perm.slice(i, i+1), 8);\n\t\t\t\t\tvalue += _perm.toString(8);\n\t\t\t\t\tfieldset = tpl.fieldset.replace('{f_title}', fm.i18n(level[i])).replace('{name}', makeName(f[level[i]])).replace(/\\{level\\}/g, level[i]);\n\t\t\t\t\tdataTable = dataTable.replace('{'+i+'}', fieldset)\n\t\t\t\t\t                     .replace('{checked-r}', ((_perm & 4) == 4)? checked : '')\n\t\t\t\t\t                     .replace('{checked-w}', ((_perm & 2) == 2)? checked : '')\n\t\t\t\t\t                     .replace('{checked-x}', ((_perm & 1) == 1)? checked : '');\n\t\t\t\t}\n\t\t\t\tdataTable = dataTable.replace('{value}', value).replace('{valueCaption}', msg['perm']);\n\t\t\t\treturn dataTable;\n\t\t\t},\n\t\t\tgetPerm = function(perm){\n\t\t\t\tif (isNaN(parseInt(perm, 8))) {\n\t\t\t\t\tvar mode_array = perm.split('');\n\t\t\t\t\tvar a = [];\n\n\t\t\t\t\tfor (var i = 0, l = mode_array.length; i < l; i++) {\n\t\t\t\t\t\tif (i === 0 || i === 3 || i === 6) {\n\t\t\t\t\t\t\tif (mode_array[i].match(/[r]/i)) {\n\t\t\t\t\t\t\t\ta.push(1);\n\t\t\t\t\t\t\t} else if (mode_array[i].match(/[-]/)) {\n\t\t\t\t\t\t\t\ta.push(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ( i === 1 || i === 4 || i === 7) {\n\t\t\t\t\t\t\t if (mode_array[i].match(/[w]/i)) {\n\t\t\t\t\t\t\t\ta.push(1);\n\t\t\t\t\t\t\t} else if (mode_array[i].match(/[-]/)) {\n\t\t\t\t\t\t\t\ta.push(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (mode_array[i].match(/[x]/i)) {\n\t\t\t\t\t\t\t\ta.push(1);\n\t\t\t\t\t\t\t} else if (mode_array[i].match(/[-]/)) {\n\t\t\t\t\t\t\t\ta.push(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\ta.splice(3, 0, \",\");\n\t\t\t\t\ta.splice(7, 0, \",\");\n\n\t\t\t\t\tvar b = a.join(\"\");\n\t\t\t\t\tvar b_array = b.split(\",\");\n\t\t\t\t\tvar c = [];\n\t\t\t\t\n\t\t\t\t\tfor (var j = 0, m = b_array.length; j < m; j++) {\n\t\t\t\t\t\tvar p = parseInt(b_array[j], 2).toString(8);\n\t\t\t\t\t\tc.push(p);\n\t\t\t\t\t}\n\n\t\t\t\t\tperm = c.join('');\n\t\t\t\t} else {\n\t\t\t\t\tperm = parseInt(perm, 8).toString(8);\n\t\t\t\t}\n\t\t\t\treturn perm;\n\t\t\t},\n\t\t\topts    = {\n\t\t\t\ttitle : this.title,\n\t\t\t\twidth : 'auto',\n\t\t\t\tbuttons : buttons(),\n\t\t\t\tclose : function() { $(this).elfinderdialog('destroy'); }\n\t\t\t},\n\t\t\tdialog = fm.getUI().find('#'+id),\n\t\t\tprevVals = {},\n\t\t\ttmb = '', title, dataTable;\n\n\t\t\tif (dialog.length) {\n\t\t\t\tdialog.elfinderdialog('toTop');\n\t\t\t\treturn $.Deferred().resolve();\n\t\t\t}\n\n\t\t\tview  = view.replace('{class}', cnt > 1 ? 'elfinder-cwd-icon-group' : fm.mime2class(file.mime));\n\t\t\tif (cnt > 1) {\n\t\t\t\ttitle = tpl.groupTitle.replace('{items}', fm.i18n('items')).replace('{num}', cnt);\n\t\t\t} else {\n\t\t\t\ttitle = tpl.itemTitle.replace('{name}', file.name).replace('{kind}', fm.mime2kind(file));\n\t\t\t\ttmb = fm.tmb(file);\n\t\t\t}\n\n\t\t\tdataTable = makeDataTable(makeperm(files), files.length == 1? files[0] : {});\n\n\t\t\tview = view.replace('{title}', title).replace('{dataTable}', dataTable).replace(/{id}/g, id);\n\n\t\t\tdialog = this.fmDialog(view, opts);\n\t\t\tdialog.attr('id', id);\n\n\t\t\t// load thumbnail\n\t\t\tif (tmb) {\n\t\t\t\t$('<img/>')\n\t\t\t\t\t.on('load', function() { dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\"); })\n\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t}\n\n\t\t\t$('#' + id + '-table-perm :checkbox').on('click', function(){setperm('perm');});\n\t\t\t$('#' + id + '-perm').on('keydown', function(e) {\n\t\t\t\tvar c = e.keyCode;\n\t\t\t\tif (c == $.ui.keyCode.ENTER) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tsave();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}).on('focus', function(e){\n\t\t\t\t$(this).trigger('select');\n\t\t\t}).on('keyup', function(e) {\n\t\t\t\tif ($(this).val().length == 3) {\n\t\t\t\t\t$(this).trigger('select');\n\t\t\t\t\tsetcheck($(this).val());\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\t};\n\t\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/colwidth',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.colwidth = function() {\n\t\t\"use strict\";\n\t\tthis.alwaysEnabled = true;\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn this.fm.getUI('cwd').find('table').css('table-layout') === 'fixed' ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tthis.fm.getUI('cwd').trigger('colwidth');\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\t\t\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/copy',[\n\t\"../elFinder\"\n],function(elFinder){\n\n\telFinder.prototype.commands.copy = function() {\n\t\t\"use strict\";\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+c ctrl+insert'\n\t\t}];\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\n\t\t\treturn cnt && $.grep(sel, function(f) { return f.read ? true : false; }).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar fm   = this.fm,\n\t\t\t\tdfrd = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tfm.error(error);\n\t\t\t\t\t});\n\n\t\t\t$.each(this.files(hashes), function(i, file) {\n\t\t\t\tif (! file.read) {\n\t\t\t\t\treturn !dfrd.reject(['errCopy', file.name, 'errPerm']);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd.state() == 'rejected' ? dfrd : dfrd.resolve(fm.clipboard(this.hashes(hashes)));\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/cut',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.cut = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+x shift+insert'\n\t\t}];\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\t\t\t\n\t\t\treturn cnt && $.grep(sel, function(f) { return f.read && ! f.locked && ! fm.isRoot(f) ? true : false; }).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar dfrd = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tfm.error(error);\n\t\t\t\t\t});\n\n\t\t\t$.each(this.files(hashes), function(i, file) {\n\t\t\t\tif (!(file.read && ! file.locked && ! fm.isRoot(file)) ) {\n\t\t\t\t\treturn !dfrd.reject(['errCopy', file.name, 'errPerm']);\n\t\t\t\t}\n\t\t\t\tif (file.locked) {\n\t\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd.state() == 'rejected' ? dfrd : dfrd.resolve(fm.clipboard(this.hashes(hashes), true));\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/download',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.zipdl = function() {};\n\telFinder.prototype.commands.download = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\t\tfm     = this.fm,\n\t\t\tczipdl = null,\n\t\t\tzipOn  = false,\n\t\t\tmixed  = false,\n\t\t\tdlntf  = false,\n\t\t\tcpath  = window.location.pathname || '/',\n\t\t\tfilter = function(hashes, inExec) {\n\t\t\t\tvar volumeid, mixedCmd;\n\t\t\t\t\n\t\t\t\tif (czipdl !== null) {\n\t\t\t\t\tif (fm.searchStatus.state > 1) {\n\t\t\t\t\t\tmixed = fm.searchStatus.mixed;\n\t\t\t\t\t} else if (fm.leafRoots[fm.cwd().hash]) {\n\t\t\t\t\t\tvolumeid = fm.cwd().volumeid;\n\t\t\t\t\t\t$.each(hashes, function(i, h) {\n\t\t\t\t\t\t\tif (h.indexOf(volumeid) !== 0) {\n\t\t\t\t\t\t\t\tmixed = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tzipOn = (fm.isCommandEnabled('zipdl', hashes[0]));\n\t\t\t\t}\n\n\t\t\t\tif (mixed) {\n\t\t\t\t\tmixedCmd = czipdl? 'zipdl' : 'download';\n\t\t\t\t\thashes = $.grep(hashes, function(h) {\n\t\t\t\t\t\tvar f = fm.file(h),\n\t\t\t\t\t\t\tres = (! f || (! czipdl && f.mime === 'directory') || ! fm.isCommandEnabled(mixedCmd, h))? false : true;\n\t\t\t\t\t\tif (f && inExec && ! res) {\n\t\t\t\t\t\t\tfm.cwdHash2Elm(f.hash).trigger('unselect');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t});\n\t\t\t\t\tif (! hashes.length) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (!fm.isCommandEnabled('download', hashes[0])) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn $.grep(self.files(hashes), function(f) { \n\t\t\t\t\tvar res = (! f.read || (! zipOn && f.mime == 'directory')) ? false : true;\n\t\t\t\t\tif (inExec && ! res) {\n\t\t\t\t\t\tfm.cwdHash2Elm(f.hash).trigger('unselect');\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t});\n\t\t\t};\n\t\t\n\t\tthis.linkedCmds = ['zipdl'];\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'shift+enter'\n\t\t}];\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel    = this.hashes(select),\n\t\t\t\tcnt    = sel.length,\n\t\t\t\tmaxReq = this.options.maxRequests || 10,\n\t\t\t\tmixed  = false,\n\t\t\t\tcroot  = '';\n\t\t\t\n\t\t\tif (cnt < 1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tcnt = filter(sel).length;\n\t\t\t\n\t\t\treturn  (cnt && (zipOn || (cnt <= maxReq && ((!fm.UA.IE && !fm.UA.Mobile) || cnt == 1))) ? 0 : -1);\n\t\t};\n\t\t\n\t\tfm.bind('contextmenu', function(e){\n\t\t\tvar fm = self.fm,\n\t\t\t\thelper = null,\n\t\t\t\ttargets, file, link,\n\t\t\t\tgetExtra = function(file) {\n\t\t\t\t\tvar link = file.url || fm.url(file.hash);\n\t\t\t\t\treturn {\n\t\t\t\t\t\ticon: 'link',\n\t\t\t\t\t\tnode: $('<a/>')\n\t\t\t\t\t\t\t.attr({href: link, target: '_blank', title: fm.i18n('link')})\n\t\t\t\t\t\t\t.text(file.name)\n\t\t\t\t\t\t\t.on('mousedown click touchstart touchmove touchend contextmenu', function(e){\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragstart', function(e) {\n\t\t\t\t\t\t\t\tvar dt = e.dataTransfer || e.originalEvent.dataTransfer || null;\n\t\t\t\t\t\t\t\thelper = null;\n\t\t\t\t\t\t\t\tif (dt) {\n\t\t\t\t\t\t\t\t\tvar icon  = function(f) {\n\t\t\t\t\t\t\t\t\t\t\tvar mime = f.mime, i, tmb = fm.tmb(f);\n\t\t\t\t\t\t\t\t\t\t\ti = '<div class=\"elfinder-cwd-icon '+fm.mime2class(mime)+' ui-corner-all\"/>';\n\t\t\t\t\t\t\t\t\t\t\tif (tmb) {\n\t\t\t\t\t\t\t\t\t\t\t\ti = $(i).addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\").get(0).outerHTML;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tdt.effectAllowed = 'copyLink';\n\t\t\t\t\t\t\t\t\tif (dt.setDragImage) {\n\t\t\t\t\t\t\t\t\t\thelper = $('<div class=\"elfinder-drag-helper html5-native\">').append(icon(file)).appendTo($(document.body));\n\t\t\t\t\t\t\t\t\t\tdt.setDragImage(helper.get(0), 50, 47);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (!fm.UA.IE) {\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom', window.location.href + file.phash);\n\t\t\t\t\t\t\t\t\t\tdt.setData('elfinderfrom:' + dt.getData('elfinderfrom'), '');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('dragend', function(e) {\n\t\t\t\t\t\t\t\thelper && helper.remove();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\tself.extra = null;\n\t\t\tif (e.data) {\n\t\t\t\ttargets = e.data.targets || [];\n\t\t\t\tif (targets.length === 1 && (file = fm.file(targets[0])) && file.mime !== 'directory') {\n\t\t\t\t\tif (file.url != '1') {\n\t\t\t\t\t\tself.extra = getExtra(file);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Get URL ondemand\n\t\t\t\t\t\tvar node;\n\t\t\t\t\t\tself.extra = {\n\t\t\t\t\t\t\ticon: 'link',\n\t\t\t\t\t\t\tnode: $('<a/>')\n\t\t\t\t\t\t\t\t.attr({href: '#', title: fm.i18n('getLink'), draggable: 'false'})\n\t\t\t\t\t\t\t\t.text(file.name)\n\t\t\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tvar parent = node.parent();\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\tparent.removeClass('ui-state-disabled').addClass('elfinder-button-icon-spinner');\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\t\tparent.removeClass('elfinder-button-icon-spinner');\n\t\t\t\t\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\t\t\t\trfile.url = data.url;\n\t\t\t\t\t\t\t\t\t\t\tnode.replaceWith(getExtra(file).node);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tparent.addClass('ui-state-disabled');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t};\n\t\t\t\t\t\tnode = self.extra.node;\n\t\t\t\t\t\tnode.ready(function(){\n\t\t\t\t\t\t\trequestAnimationFrame(function(){\n\t\t\t\t\t\t\t\tnode.parent().addClass('ui-state-disabled').css('pointer-events', 'auto');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}).one('open', function() {\n\t\t\tif (fm.api >= 2.1012) {\n\t\t\t\tczipdl = fm.getCommand('zipdl');\n\t\t\t}\n\t\t\tdlntf = fm.cookieEnabled && fm.api > 2.1038 && !fm.isCORS;\n\t\t});\n\t\t\n\t\tthis.exec = function(select) {\n\t\t\tvar hashes  = this.hashes(select),\n\t\t\t\tfm      = this.fm,\n\t\t\t\tbase    = fm.options.url,\n\t\t\t\tfiles   = filter(hashes, true),\n\t\t\t\tdfrd    = $.Deferred(),\n\t\t\t\tiframes = '',\n\t\t\t\tcdata   = '',\n\t\t\t\ttargets = {},\n\t\t\t\ti, url,\n\t\t\t\tlinkdl  = false,\n\t\t\t\tgetTask = function(hashes) {\n\t\t\t\t\treturn function() {\n\t\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\t\troot = fm.file(fm.root(hashes[0])),\n\t\t\t\t\t\t\tsingle = (hashes.length === 1),\n\t\t\t\t\t\t\tvolName = root? (root.i18 || root.name) : null,\n\t\t\t\t\t\t\tdir, dlName, phash;\n\t\t\t\t\t\tif (single) {\n\t\t\t\t\t\t\tif (dir = fm.file(hashes[0])) {\n\t\t\t\t\t\t\t\tdlName = (dir.i18 || dir.name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$.each(hashes, function() {\n\t\t\t\t\t\t\t\tvar d = fm.file(this);\n\t\t\t\t\t\t\t\tif (d && (!phash || phash === d.phash)) {\n\t\t\t\t\t\t\t\t\tphash = d.phash;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tphash = null;\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (phash && (dir = fm.file(phash))) {\n\t\t\t\t\t\t\t\tdlName = (dir.i18 || dir.name) + '-' + hashes.length;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (dlName) {\n\t\t\t\t\t\t\tvolName = dlName;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvolName && (volName = ' (' + volName + ')');\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'zipdl', targets : hashes},\n\t\t\t\t\t\t\tnotify : {type : 'zipdl', cnt : 1, hideCnt : true, msg : fm.i18n('ntfzipdl') + volName},\n\t\t\t\t\t\t\tcancel : true,\n\t\t\t\t\t\t\teachCancel : true,\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t}).done(function(e) {\n\t\t\t\t\t\t\tvar zipdl, dialog, btn = {}, dllink, form, iframe, m,\n\t\t\t\t\t\t\t\tuniq = 'dlw' + (+new Date()),\n\t\t\t\t\t\t\t\tzipdlFn = function(url) {\n\t\t\t\t\t\t\t\t\tdllink = $('<a/>')\n\t\t\t\t\t\t\t\t\t\t.attr('href', url)\n\t\t\t\t\t\t\t\t\t\t.attr('download', fm.escape(dlName))\n\t\t\t\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\tdialog && dialog.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (linkdl) {\n\t\t\t\t\t\t\t\t\t\tdllink.attr('target', '_blank')\n\t\t\t\t\t\t\t\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-download\"></span>'+fm.escape(dlName));\n\t\t\t\t\t\t\t\t\t\tbtn[fm.i18n('btnCancel')] = function() {\n\t\t\t\t\t\t\t\t\t\t\tdialog.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tdialog = self.fmDialog(dllink, {\n\t\t\t\t\t\t\t\t\t\t\ttitle: fm.i18n('link'),\n\t\t\t\t\t\t\t\t\t\t\tbuttons: btn,\n\t\t\t\t\t\t\t\t\t\t\twidth: '200px',\n\t\t\t\t\t\t\t\t\t\t\tdestroyOnClose: true,\n\t\t\t\t\t\t\t\t\t\t\tclose: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t(dfd.state() !== 'resolved') && dfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tclick(dllink.hide().appendTo('body').get(0));\n\t\t\t\t\t\t\t\t\t\tdllink.remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (e.error) {\n\t\t\t\t\t\t\t\tfm.error(e.error);\n\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t} else if (e.zipdl) {\n\t\t\t\t\t\t\t\tzipdl = e.zipdl;\n\t\t\t\t\t\t\t\tif (dlName) {\n\t\t\t\t\t\t\t\t\tm = fm.splitFileExtention(zipdl.name || '');\n\t\t\t\t\t\t\t\t\tdlName += m[1]? ('.' + m[1]) : '.zip';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdlName = zipdl.name;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ((html5dl && (!fm.UA.Safari || fm.isSameOrigin(fm.options.url))) || linkdl) {\n\t\t\t\t\t\t\t\t\turl = fm.options.url + (fm.options.url.indexOf('?') === -1 ? '?' : '&')\n\t\t\t\t\t\t\t\t\t+ 'cmd=zipdl&download=1';\n\t\t\t\t\t\t\t\t\t$.each([hashes[0], zipdl.file, dlName, zipdl.mime], function(key, val) {\n\t\t\t\t\t\t\t\t\t\turl += '&targets%5B%5D='+encodeURIComponent(val);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$.each(fm.customData, function(key, val) {\n\t\t\t\t\t\t\t\t\t\turl += '&'+encodeURIComponent(key)+'='+encodeURIComponent(val);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\turl += '&'+encodeURIComponent(dlName);\n\t\t\t\t\t\t\t\t\tif (fm.hasParrotHeaders()) {\n\t\t\t\t\t\t\t\t\t\tfm.getBinaryByUrl({url: url}, function(blob) {\n\t\t\t\t\t\t\t\t\t\t\tif (blob instanceof Blob) {\n\t\t\t\t\t\t\t\t\t\t\t\turl = (window.URL || window.webkitURL).createObjectURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\tzipdlFn(url);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.error(['errUploadTransfer', fm.i18n('kindZIP')]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tzipdlFn(url);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tform = $('<form action=\"'+fm.options.url+'\" method=\"post\" target=\"'+uniq+'\" style=\"display:none\"/>')\n\t\t\t\t\t\t\t\t\t.append('<input type=\"hidden\" name=\"cmd\" value=\"zipdl\"/>')\n\t\t\t\t\t\t\t\t\t.append('<input type=\"hidden\" name=\"download\" value=\"1\"/>');\n\t\t\t\t\t\t\t\t\t$.each([hashes[0], zipdl.file, dlName, zipdl.mime], function(key, val) {\n\t\t\t\t\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"targets[]\" value=\"'+fm.escape(val)+'\"/>');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$.each(fm.customData, function(key, val) {\n\t\t\t\t\t\t\t\t\t\tform.append('<input type=\"hidden\" name=\"'+key+'\" value=\"'+fm.escape(val)+'\"/>');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tform.attr('target', uniq).appendTo('body');\n\t\t\t\t\t\t\t\t\tiframe = $('<iframe style=\"display:none\" name=\"'+uniq+'\">')\n\t\t\t\t\t\t\t\t\t\t.appendTo('body')\n\t\t\t\t\t\t\t\t\t\t.ready(function() {\n\t\t\t\t\t\t\t\t\t\t\tform.submit().remove();\n\t\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tiframe.remove();\n\t\t\t\t\t\t\t\t\t\t\t}, 20000); // give 20 sec file to be saved\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn dfd.promise();\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t// use MouseEvent to click element for Safari etc\n\t\t\t\tclick = function(a) {\n\t\t\t\t\tvar clickEv;\n\t\t\t\t\tif (typeof MouseEvent === 'function') {\n\t\t\t\t\t\tclickEv = new MouseEvent('click');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclickEv = document.createEvent('MouseEvents');\n\t\t\t\t\t\tclickEv.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n\t\t\t\t\t}\n\t\t\t\t\tfm.pauseUnloadCheck(true);\n\t\t\t\t\ta.dispatchEvent(clickEv);\n\t\t\t\t},\n\t\t\t\tcheckCookie = function(id) {\n\t\t\t\t\tvar name = 'elfdl' + id,\n\t\t\t\t\t\tparts;\n\t\t\t\t\tparts = document.cookie.split(name + \"=\");\n\t\t\t\t\tif (parts.length === 2) {\n\t\t\t\t\t\tntftm && clearTimeout(ntftm);\n\t\t\t\t\t\tdocument.cookie = name + '=; path=' + cpath + '; max-age=0';\n\t\t\t\t\t\tcloseNotify();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(function() { checkCookie(id); }, 200);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcloseNotify = function() {\n\t\t\t\t\tif (fm.ui.notify.children('.elfinder-notify-download').length) {\n\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\ttype : 'download',\n\t\t\t\t\t\t\tcnt : -1\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treqids = [],\n\t\t\t\tlink, html5dl, fileCnt, clickEv, cid, ntftm, reqid, getUrlDfrd, urls;\n\t\t\t\t\n\t\t\tif (!files.length) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tfileCnt = $.grep(files, function(f) { return f.mime === 'directory'? false : true; }).length;\n\t\t\tlink = $('<a>').hide().appendTo('body');\n\t\t\thtml5dl = (typeof link.get(0).download === 'string');\n\t\t\t\n\t\t\tif (zipOn && (fileCnt !== files.length || fileCnt >= (this.options.minFilesZipdl || 1))) {\n\t\t\t\tlink.remove();\n\t\t\t\tlinkdl = (!html5dl && fm.UA.Mobile);\n\t\t\t\tif (mixed) {\n\t\t\t\t\ttargets = {};\n\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\tvar p = f.hash.split('_', 2);\n\t\t\t\t\t\tif (! targets[p[0]]) {\n\t\t\t\t\t\t\ttargets[p[0]] = [ f.hash ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttargets[p[0]].push(f.hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (!linkdl && fm.UA.Mobile && Object.keys(targets).length > 1) {\n\t\t\t\t\t\tlinkdl = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttargets = [ $.map(files, function(f) { return f.hash; }) ];\n\t\t\t\t}\n\t\t\t\tdfrd = fm.sequence($.map(targets, function(t) { return getTask(t); })).always(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tfm.trigger('download', {files : files});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn dfrd;\n\t\t\t} else {\n\t\t\t\treqids = [];\n\t\t\t\tgetUrlDfrd = $.Deferred().done(function(urls) {\n\t\t\t\t\tfor (i = 0; i < urls.length; i++) {\n\t\t\t\t\t\turl = urls[i];\n\t\t\t\t\t\tif (dlntf && url.substr(0, fm.options.url.length) === fm.options.url) {\n\t\t\t\t\t\t\treqid = fm.getRequestId();\n\t\t\t\t\t\t\treqids.push(reqid);\n\t\t\t\t\t\t\turl += '&cpath=' + cpath + '&reqid=' + reqid;\n\t\t\t\t\t\t\tntftm = setTimeout(function() {\n\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\ttype : 'download',\n\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\tcancel : (fm.UA.IE || fm.UA.Edge)? void(0) : function() {\n\t\t\t\t\t\t\t\t\t\tif (reqids.length) {\n\t\t\t\t\t\t\t\t\t\t\t$.each(reqids, function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd: 'abort',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: this\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault: true\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treqids = [];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, fm.notifyDelay);\n\t\t\t\t\t\t\tcheckCookie(reqid);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (html5dl && (!fm.UA.Safari || fm.isSameOrigin(url))) {\n\t\t\t\t\t\t\tclick(link.attr('href', url)\n\t\t\t\t\t\t\t\t.attr('download', fm.escape(files[i].name))\n\t\t\t\t\t\t\t\t.get(0)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (fm.UA.Mobile) {\n\t\t\t\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\t\t\tif (! window.open(url)) {\n\t\t\t\t\t\t\t\t\t\tfm.error('errPopup');\n\t\t\t\t\t\t\t\t\t\tntftm && cleaerTimeout(ntftm);\n\t\t\t\t\t\t\t\t\t\tcloseNotify();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tiframes += '<iframe class=\"downloader\" id=\"downloader-' + files[i].hash+'\" style=\"display:none\" src=\"'+url+'\"/>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlink.remove();\n\t\t\t\t\t$(iframes)\n\t\t\t\t\t\t.appendTo('body')\n\t\t\t\t\t\t.ready(function() {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t$(iframes).each(function() {\n\t\t\t\t\t\t\t\t\t$('#' + $(this).attr('id')).remove();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 20000 + (10000 * i)); // give 20 sec + 10 sec for each file to be saved\n\t\t\t\t\t\t});\n\t\t\t\t\tfm.trigger('download', {files : files});\n\t\t\t\t\tdfrd.resolve();\n\t\t\t\t});\n\t\t\t\tfileCnt = files.length;\n\t\t\t\turls = [];\n\t\t\t\tfor (i = 0; i < files.length; i++) {\n\t\t\t\t\tfm.openUrl(files[i].hash, true, function(v) {\n\t\t\t\t\t\tv && urls.push(v);\n\t\t\t\t\t\tif (--fileCnt < 1) {\n\t\t\t\t\t\t\tgetUrlDfrd.resolve(urls);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/duplicate',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.duplicate = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm;\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\n\t\t\treturn cnt && fm.cwd().write && $.grep(sel, function(f) { return f.read && f.phash === fm.cwd().hash && ! fm.isRoot(f)? true : false; }).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar fm     = this.fm,\n\t\t\t\tfiles  = this.files(hashes),\n\t\t\t\tcnt    = files.length,\n\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t}), \n\t\t\t\targs = [];\n\t\t\t\t\n\t\t\tif (! cnt) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\t$.each(files, function(i, file) {\n\t\t\t\tif (!file.read || !fm.file(file.phash).write) {\n\t\t\t\t\treturn !dfrd.reject(['errCopy', file.name, 'errPerm']);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (dfrd.state() == 'rejected') {\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t\t\n\t\t\treturn fm.request({\n\t\t\t\tdata   : {cmd : 'duplicate', targets : this.hashes(hashes)},\n\t\t\t\tnotify : {type : 'copy', cnt : cnt},\n\t\t\t\tnavigate : {\n\t\t\t\t\ttoast : {\n\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('cmdduplicate')])}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/edit',[\n\t\"../elFinder\"\n],function(elFinder){\n\n\telFinder.prototype.commands.edit = function() {\n\t\t\"use strict\";\n\t\tvar self  = this,\n\t\t\tfm    = this.fm,\n\t\t\tclsEditing = fm.res('class', 'editing'),\n\t\t\tmimesSingle = [],\n\t\t\tmimes = [],\n\t\t\tallowAll = false,\n\t\t\trtrim = function(str){\n\t\t\t\treturn str.replace(/\\s+$/, '');\n\t\t\t},\n\t\t\tgetEncSelect = function(heads) {\n\t\t\t\tvar sel = $('<select class=\"ui-corner-all\"/>'),\n\t\t\t\t\thval;\n\t\t\t\tif (heads) {\n\t\t\t\t\t$.each(heads, function(i, head) {\n\t\t\t\t\t\thval = fm.escape(head.value);\n\t\t\t\t\t\tsel.append('<option value=\"'+hval+'\">'+(head.caption? fm.escape(head.caption) : hval)+'</option>');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t$.each(self.options.encodings, function(i, v) {\n\t\t\t\t\tsel.append('<option value=\"'+v+'\">'+v+'</option>');\n\t\t\t\t});\n\t\t\t\treturn sel;\n\t\t\t},\n\t\t\tgetDlgWidth = function() {\n\t\t\t\tvar win = fm.options.dialogContained? fm.getUI() : $(window),\n\t\t\t\t\tm, width;\n\t\t\t\tif (typeof self.options.dialogWidth === 'string' && (m = self.options.dialogWidth.match(/(\\d+)%/))) {\n\t\t\t\t\twidth = parseInt(win.width() * (m[1] / 100));\n\t\t\t\t} else {\n\t\t\t\t\twidth = parseInt(self.options.dialogWidth || 650);\n\t\t\t\t}\n\t\t\t\treturn Math.min(width, win.width());\n\t\t\t},\n\t\t\tgetDlgHeight = function() {\n\t\t\t\tif (!self.options.dialogHeight) {\n\t\t\t\t\treturn void(0);\n\t\t\t\t}\n\t\t\t\tvar win = fm.options.dialogContained? fm.getUI() : $(window),\n\t\t\t\t\tm, height;\n\t\t\t\tif (typeof self.options.dialogHeight === 'string' && (m = self.options.dialogHeight.match(/(\\d+)%/))) {\n\t\t\t\t\theight = parseInt(win.height() * (m[1] / 100));\n\t\t\t\t} else {\n\t\t\t\t\theight = parseInt(self.options.dialogHeight || win.height());\n\t\t\t\t}\n\t\t\t\treturn Math.min(height, win.height());\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Return files acceptable to edit\n\t\t\t *\n\t\t\t * @param  Array  files hashes\n\t\t\t * @return Array\n\t\t\t **/\n\t\t\tfilter = function(files) {\n\t\t\t\tvar cnt = files.length,\n\t\t\t\t\tmime, ext, skip;\n\t\t\t\t\n\t\t\t\tif (cnt > 1) {\n\t\t\t\t\tmime = files[0].mime;\n\t\t\t\t\text = files[0].name.replace(/^.*(\\.[^.]+)$/, '$1');\n\t\t\t\t}\n\t\t\t\treturn $.grep(files, function(file) {\n\t\t\t\t\tvar res;\n\t\t\t\t\tif (skip || file.mime === 'directory') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tres = file.read\n\t\t\t\t\t\t&& (allowAll || fm.mimeIsText(file.mime) || $.inArray(file.mime, cnt === 1? mimesSingle : mimes) !== -1) \n\t\t\t\t\t\t&& (!self.onlyMimes.length || $.inArray(file.mime, self.onlyMimes) !== -1)\n\t\t\t\t\t\t&& (cnt === 1 || (file.mime === mime && file.name.substr(ext.length * -1) === ext))\n\t\t\t\t\t\t&& (fm.uploadMimeCheck(file.mime, file.phash)? true : false)\n\t\t\t\t\t\t&& setEditors(file, cnt)\n\t\t\t\t\t\t&& Object.keys(editors).length;\n\t\t\t\t\tif (!res) {\n\t\t\t\t\t\tskip = true;\n\t\t\t\t\t}\n\t\t\t\t\treturn res;\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tfileSync = function(hash) {\n\t\t\t\tvar old = fm.file(hash),\n\t\t\t\t\tf;\n\t\t\t\tfm.request({\n\t\t\t\t\tcmd: 'info',\n\t\t\t\t\ttargets: [hash],\n\t\t\t\t\tpreventDefault: true\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tvar changed;\n\t\t\t\t\tif (data && data.files && data.files.length) {\n\t\t\t\t\t\tf = data.files[0];\n\t\t\t\t\t\tif (old.ts != f.ts || old.size != f.size) {\n\t\t\t\t\t\t\tchanged = { changed: [ f ] };\n\t\t\t\t\t\t\tfm.updateCache(changed);\n\t\t\t\t\t\t\tfm.change(changed);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Open dialog with textarea to edit file\n\t\t\t *\n\t\t\t * @param  String  id       dialog id\n\t\t\t * @param  Object  file     file object\n\t\t\t * @param  String  content  file content\n\t\t\t * @return $.Deferred\n\t\t\t **/\n\t\t\tdialog = function(id, file, content, encoding, editor, toasts) {\n\n\t\t\t\tvar dfrd = $.Deferred(),\n\t\t\t\t\t_loaded = false,\n\t\t\t\t\tloaded = function() {\n\t\t\t\t\t\tif (!_loaded) {\n\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\tmode: 'warning',\n\t\t\t\t\t\t\t\tmsg: fm.i18n('nowLoading')\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\tmakeToasts = function() {\n\t\t\t\t\t\t// make toast message\n\t\t\t\t\t\tif (toasts && Array.isArray(toasts)) {\n\t\t\t\t\t\t\t$.each(toasts, function() {\n\t\t\t\t\t\t\t\tthis.msg && fm.toast(this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsave = function() {\n\t\t\t\t\t\tvar encord = selEncoding? selEncoding.val():void(0),\n\t\t\t\t\t\t\tsaveDfd = $.Deferred().fail(function(err) {\n\t\t\t\t\t\t\t\tdialogNode.show().find('button.elfinder-btncnt-0,button.elfinder-btncnt-1').hide();\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tconf, res, tm;\n\t\t\t\t\t\tif (!loaded()) {\n\t\t\t\t\t\t\treturn saveDfd.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ta.editor) {\n\t\t\t\t\t\t\tta.editor.save(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\tif (conf.info && (conf.info.schemeContent || conf.info.arrayBufferContent)) {\n\t\t\t\t\t\t\t\tencord = 'scheme';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tres = getContent();\n\t\t\t\t\t\tsetOld(res);\n\t\t\t\t\t\tif (res.promise) {\n\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\ttype : 'chkcontent',\n\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\thideCnt: true,\n\t\t\t\t\t\t\t\t\tcancel : function() {\n\t\t\t\t\t\t\t\t\t\tres.reject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\tres.always(function() {\n\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\tfm.notify({ type : 'chkcontent', cnt: -1 });\n\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\tdfrd.notifyWith(ta, [encord, ta.data('hash'), old, saveDfd]);\n\t\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\t\tsaveDfd.reject(err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd.notifyWith(ta, [encord, ta.data('hash'), old, saveDfd]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn saveDfd;\n\t\t\t\t\t},\n\t\t\t\t\tsaveon = function() {\n\t\t\t\t\t\tif (!loaded()) { return; }\n\t\t\t\t\t\tsave().fail(function(err) {\n\t\t\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tcancel = function() {\n\t\t\t\t\t\tta.elfinderdialog('close');\n\t\t\t\t\t},\n\t\t\t\t\tsavecl = function() {\n\t\t\t\t\t\tif (!loaded()) { return; }\n\t\t\t\t\t\tdialogNode.hide();\n\t\t\t\t\t\tsave().done(function() {\n\t\t\t\t\t\t\t_loaded = false;\n\t\t\t\t\t\t\tdialogNode.show();\n\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\tdialogNode.show();\n\t\t\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tsaveAs = function() {\n\t\t\t\t\t\tif (!loaded()) { return; }\n\t\t\t\t\t\tvar prevOld = old,\n\t\t\t\t\t\t\tphash = file.phash,\n\t\t\t\t\t\t\tfail = function(err) {\n\t\t\t\t\t\t\t\tdialogs.addClass(clsEditing).fadeIn(function() {\n\t\t\t\t\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\told = prevOld;\n\t\t\t\t\t\t\t\tfm.disable();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmake = function() {\n\t\t\t\t\t\t\t\tself.mime = saveAsFile.mime || file.mime;\n\t\t\t\t\t\t\t\tself.prefix = (saveAsFile.name || file.name).replace(/ \\d+(\\.[^.]+)?$/, '$1');\n\t\t\t\t\t\t\t\tself.requestCmd = 'mkfile';\n\t\t\t\t\t\t\t\tself.nextAction = {};\n\t\t\t\t\t\t\t\tself.data = {target : phash};\n\t\t\t\t\t\t\t\t$.proxy(fm.res('mixin', 'make'), self)()\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\tvar oldHash;\n\t\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\t\toldHash = ta.data('hash');\n\t\t\t\t\t\t\t\t\t\t\tta.data('hash', data.added[0].hash);\n\t\t\t\t\t\t\t\t\t\t\tsave().done(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t_loaded = false;\n\t\t\t\t\t\t\t\t\t\t\t\tdialogNode.show();\n\t\t\t\t\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\t\t\t\t\tdialogs.fadeIn();\n\t\t\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('rm', [data.added[0].hash], { forceRm: true, quiet: true });\n\t\t\t\t\t\t\t\t\t\t\t\tta.data('hash', oldHash);\n\t\t\t\t\t\t\t\t\t\t\t\tdialogNode.find('button.elfinder-btncnt-2').hide();\n\t\t\t\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.progress(function(err) {\n\t\t\t\t\t\t\t\t\t\tif (err && err === 'errUploadMime') {\n\t\t\t\t\t\t\t\t\t\t\tta.trigger('saveAsFail');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.fail(fail)\n\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\tdelete self.mime;\n\t\t\t\t\t\t\t\t\t\tdelete self.prefix;\n\t\t\t\t\t\t\t\t\t\tdelete self.nextAction;\n\t\t\t\t\t\t\t\t\t\tdelete self.data;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', { files: [ file.hash ] });\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treqOpen = null,\n\t\t\t\t\t\t\treqInfo = null,\n\t\t\t\t\t\t\tdialogs = fm.getUI().children('.' + self.dialogClass + ':visible');\n\t\t\t\t\t\t\tif (dialogNode.is(':hidden')) {\n\t\t\t\t\t\t\t\tdialogs = dialogs.add(dialogNode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialogs.removeClass(clsEditing).fadeOut();\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.enable();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (fm.searchStatus.state < 2 && phash !== fm.cwd().hash) {\n\t\t\t\t\t\t\treqOpen = fm.exec('open', [phash], {thash: phash});\n\t\t\t\t\t\t} else if (!fm.file(phash)) {\n\t\t\t\t\t\t\treqInfo = fm.request({cmd: 'info', targets: [phash]}); \n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$.when([reqOpen, reqInfo]).done(function() {\n\t\t\t\t\t\t\tif (reqInfo) {\n\t\t\t\t\t\t\t\tfm.one('infodone', function() {\n\t\t\t\t\t\t\t\t\tfm.file(phash)? make() : fail('errFolderNotFound');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treqOpen? fm.one('cwdrender', make) : make();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).fail(fail);\n\t\t\t\t\t},\n\t\t\t\t\tchanged = function() {\n\t\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\t\tres, tm;\n\t\t\t\t\t\tif (!_loaded) {\n\t\t\t\t\t\t\treturn dfd.resolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tta.editor && ta.editor.save(ta[0], ta.editor.instance);\n\t\t\t\t\t\tres = getContent();\n\t\t\t\t\t\tif (res && res.promise) {\n\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\tfm.notify({\n\t\t\t\t\t\t\t\t\ttype : 'chkcontent',\n\t\t\t\t\t\t\t\t\tcnt : 1,\n\t\t\t\t\t\t\t\t\thideCnt: true,\n\t\t\t\t\t\t\t\t\tcancel : function() {\n\t\t\t\t\t\t\t\t\t\tres.reject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\tres.always(function() {\n\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\tfm.notify({ type : 'chkcontent', cnt: -1 });\n\t\t\t\t\t\t\t}).done(function(d) {\n\t\t\t\t\t\t\t\tdfd.resolve(old !== d);\n\t\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\t\tdfd.resolve(err || (old === undefined? false : true));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd.resolve(old !== res);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t},\n\t\t\t\t\topts = {\n\t\t\t\t\t\ttitle   : fm.escape(file.name),\n\t\t\t\t\t\twidth   : getDlgWidth(),\n\t\t\t\t\t\theight  : getDlgHeight(),\n\t\t\t\t\t\tbuttons : {},\n\t\t\t\t\t\tcssClass  : clsEditing,\n\t\t\t\t\t\tmaxWidth  : 'window',\n\t\t\t\t\t\tmaxHeight : 'window',\n\t\t\t\t\t\tallowMinimize : true,\n\t\t\t\t\t\tallowMaximize : true,\n\t\t\t\t\t\topenMaximized : editorMaximized() || (editor && editor.info && editor.info.openMaximized),\n\t\t\t\t\t\tbtnHoverFocus : false,\n\t\t\t\t\t\tcloseOnEscape : false,\n\t\t\t\t\t\tpropagationEvents : ['mousemove', 'mouseup', 'click'],\n\t\t\t\t\t\tminimize : function() {\n\t\t\t\t\t\t\tvar conf;\n\t\t\t\t\t\t\tif (ta.editor && dialogNode.closest('.ui-dialog').is(':hidden')) {\n\t\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\t\tif (conf.info && conf.info.syncInterval) {\n\t\t\t\t\t\t\t\t\tfileSync(file.hash);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclose   : function() {\n\t\t\t\t\t\t\tvar close = function() {\n\t\t\t\t\t\t\t\t\tvar conf;\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\tif (ta.editor) {\n\t\t\t\t\t\t\t\t\t\tta.editor.close(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\t\t\t\tif (conf.info && conf.info.syncInterval) {\n\t\t\t\t\t\t\t\t\t\t\tfileSync(file.hash);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonlySaveAs = (typeof saveAsFile.name !== 'undefined'),\n\t\t\t\t\t\t\t\taccept = onlySaveAs? {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveAs',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(saveAs);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveClose',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\tsave().done(function() {\n\t\t\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tchanged().done(function(change) {\n\t\t\t\t\t\t\t\tvar msgs = ['confirmNotSave'];\n\t\t\t\t\t\t\t\tif (change) {\n\t\t\t\t\t\t\t\t\tif (typeof change === 'string') {\n\t\t\t\t\t\t\t\t\t\tmsgs.unshift(change);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\t\t\t\t\t\ttext   : msgs,\n\t\t\t\t\t\t\t\t\t\taccept : accept,\n\t\t\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnClose',\n\t\t\t\t\t\t\t\t\t\t\tcallback : close\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tbuttons : onlySaveAs? null : [{\n\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveAs',\n\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(saveAs);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tclose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\topen    : function() {\n\t\t\t\t\t\t\tvar loadRes, conf, interval;\n\t\t\t\t\t\t\tta.initEditArea.call(ta, id, file, content, fm);\n\t\t\t\t\t\t\tif (ta.editor) {\n\t\t\t\t\t\t\t\tloadRes = ta.editor.load(ta[0]) || null;\n\t\t\t\t\t\t\t\tif (loadRes && loadRes.done) {\n\t\t\t\t\t\t\t\t\tloadRes.always(function() {\n\t\t\t\t\t\t\t\t\t\t_loaded = true;\n\t\t\t\t\t\t\t\t\t}).done(function(instance) {\n\t\t\t\t\t\t\t\t\t\tta.editor.instance = instance;\n\t\t\t\t\t\t\t\t\t\tta.editor.focus(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\t\tsetOld(getContent());\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\t\tdialogNode.trigger('resize');\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}).always(makeToasts);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t_loaded = true;\n\t\t\t\t\t\t\t\t\tif (loadRes && (typeof loadRes === 'string' || Array.isArray(loadRes))) {\n\t\t\t\t\t\t\t\t\t\tfm.error(loadRes);\n\t\t\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tta.editor.instance = loadRes;\n\t\t\t\t\t\t\t\t\tta.editor.focus(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\tsetOld(getContent());\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\tdialogNode.trigger('resize');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tmakeToasts();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconf = ta.editor.confObj;\n\t\t\t\t\t\t\t\tif (conf.info && conf.info.syncInterval) {\n\t\t\t\t\t\t\t\t\tif (interval = parseInt(conf.info.syncInterval)) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tautoSync(interval);\n\t\t\t\t\t\t\t\t\t\t}, interval);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t_loaded = true;\n\t\t\t\t\t\t\t\tsetOld(getContent());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresize : function(e, data) {\n\t\t\t\t\t\t\tta.editor && ta.editor.resize(ta[0], ta.editor.instance, e, data || {});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgetContent = function() {\n\t\t\t\t\t\tvar res = ta.getContent.call(ta, ta[0]);\n\t\t\t\t\t\tif (res === undefined || res === false || res === null) {\n\t\t\t\t\t\t\tres = $.Deferred().reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t},\n\t\t\t\t\tsetOld = function(res) {\n\t\t\t\t\t\tif (res && res.promise) {\n\t\t\t\t\t\t\tres.done(function(d) {\n\t\t\t\t\t\t\t\told = d;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\told = res;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tautoSync = function(interval) {\n\t\t\t\t\t\tif (dialogNode.is(':visible')) {\n\t\t\t\t\t\t\tfileSync(file.hash);\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tautoSync(interval);\n\t\t\t\t\t\t\t}, interval);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tstateChange = function() {\n\t\t\t\t\t\tif (selEncoding) {\n\t\t\t\t\t\t\tchanged().done(function(change) {\n\t\t\t\t\t\t\t\tif (change) {\n\t\t\t\t\t\t\t\t\tselEncoding.attr('title', fm.i18n('saveAsEncoding')).addClass('elfinder-edit-changed');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tselEncoding.attr('title', fm.i18n('openAsEncoding')).removeClass('elfinder-edit-changed');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsaveAsFile = {},\n\t\t\t\t\tta, old, dialogNode, selEncoding, extEditor, maxW, syncInterval;\n\t\t\t\t\t\n\t\t\t\tif (editor) {\n\t\t\t\t\tif (editor.html) {\n\t\t\t\t\t\tta = $(editor.html);\n\t\t\t\t\t}\n\t\t\t\t\textEditor = {\n\t\t\t\t\t\tinit     : editor.init || null,\n\t\t\t\t\t\tload     : editor.load,\n\t\t\t\t\t\tgetContent : editor.getContent || null,\n\t\t\t\t\t\tsave     : editor.save,\n\t\t\t\t\t\tbeforeclose : typeof editor.beforeclose == 'function' ? editor.beforeclose : void 0,\n\t\t\t\t\t\tclose    : typeof editor.close == 'function' ? editor.close : function() {},\n\t\t\t\t\t\tfocus    : typeof editor.focus == 'function' ? editor.focus : function() {},\n\t\t\t\t\t\tresize   : typeof editor.resize == 'function' ? editor.resize : function() {},\n\t\t\t\t\t\tinstance : null,\n\t\t\t\t\t\tdoSave   : saveon,\n\t\t\t\t\t\tdoCancel : cancel,\n\t\t\t\t\t\tdoClose  : savecl,\n\t\t\t\t\t\tfile     : file,\n\t\t\t\t\t\tfm       : fm,\n\t\t\t\t\t\tconfObj  : editor,\n\t\t\t\t\t\ttrigger  : function(evName, data) {\n\t\t\t\t\t\t\tfm.trigger('editEditor' + evName, Object.assign({}, editor.info || {}, data));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!ta) {\n\t\t\t\t\tif (!fm.mimeIsText(file.mime)) {\n\t\t\t\t\t\treturn dfrd.reject('errEditorNotFound');\n\t\t\t\t\t}\n\t\t\t\t\t(function() {\n\t\t\t\t\t\tta = $('<textarea class=\"elfinder-file-edit\" rows=\"20\" id=\"'+id+'-ta\"></textarea>')\n\t\t\t\t\t\t\t.on('input propertychange', stateChange);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!editor || !editor.info || editor.info.useTextAreaEvent) {\n\t\t\t\t\t\t\tta.on('keydown', function(e) {\n\t\t\t\t\t\t\t\tvar code = e.keyCode,\n\t\t\t\t\t\t\t\t\tvalue, start;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tif (code == $.ui.keyCode.TAB) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t// insert tab on tab press\n\t\t\t\t\t\t\t\t\tif (this.setSelectionRange) {\n\t\t\t\t\t\t\t\t\t\tvalue = this.value;\n\t\t\t\t\t\t\t\t\t\tstart = this.selectionStart;\n\t\t\t\t\t\t\t\t\t\tthis.value = value.substr(0, start) + \"\\t\" + value.substr(this.selectionEnd);\n\t\t\t\t\t\t\t\t\t\tstart += 1;\n\t\t\t\t\t\t\t\t\t\tthis.setSelectionRange(start, start);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\t\t\t\t\t\t// close on ctrl+w/q\n\t\t\t\t\t\t\t\t\tif (code == 'Q'.charCodeAt(0) || code == 'W'.charCodeAt(0)) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (code == 'S'.charCodeAt(0)) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tsaveon();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('mouseenter', function(){this.focus();});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tta.initEditArea = function(id, file, content) {\n\t\t\t\t\t\t\t// ta.hide() for performance tune. Need ta.show() in `load()` if use textarea node.\n\t\t\t\t\t\t\tta.hide().val(content);\n\t\t\t\t\t\t\tthis._setupSelEncoding(content);\n\t\t\t\t\t\t};\n\t\t\t\t\t})();\n\t\t\t\t}\n\n\t\t\t\t// extended function to setup selector of encoding for text editor\n\t\t\t\tta._setupSelEncoding = function(content) {\n\t\t\t\t\tvar heads = (encoding && encoding !== 'unknown')? [{value: encoding}] : [],\n\t\t\t\t\t\twfake = $('<select/>').hide(),\n\t\t\t\t\t\tsetSelW = function(init) {\n\t\t\t\t\t\t\tinit && wfake.appendTo(selEncoding.parent());\n\t\t\t\t\t\t\twfake.empty().append($('<option/>').text(selEncoding.val()));\n\t\t\t\t\t\t\tselEncoding.width(wfake.width());\n\t\t\t\t\t\t};\n\t\t\t\t\tif (content === '' || ! encoding || encoding !== 'UTF-8') {\n\t\t\t\t\t\theads.push({value: 'UTF-8'});\n\t\t\t\t\t}\n\t\t\t\t\tselEncoding = getEncSelect(heads).on('touchstart', function(e) {\n\t\t\t\t\t\t// for touch punch event handler\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}).on('change', function() {\n\t\t\t\t\t\t// reload to change encoding if not edited\n\t\t\t\t\t\tchanged().done(function(change) {\n\t\t\t\t\t\t\tif (! change && getContent() !== '') {\n\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t\tedit(file, selEncoding.val(), editor).fail(function(err) { err && fm.error(err); });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetSelW();\n\t\t\t\t\t}).on('mouseover', stateChange);\n\t\t\t\t\tta.parent().next().prepend($('<div class=\"ui-dialog-buttonset elfinder-edit-extras\"/>').append(selEncoding));\n\t\t\t\t\tsetSelW(true);\n\t\t\t\t};\n\n\t\t\t\tta.data('hash', file.hash);\n\t\t\t\t\n\t\t\t\tif (extEditor) {\n\t\t\t\t\tta.editor = extEditor;\n\t\t\t\t\t\n\t\t\t\t\tif (typeof extEditor.beforeclose === 'function') {\n\t\t\t\t\t\topts.beforeclose = function() {\n\t\t\t\t\t\t\treturn extEditor.beforeclose(ta[0], extEditor.instance);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (typeof extEditor.init === 'function') {\n\t\t\t\t\t\tta.initEditArea = extEditor.init;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (typeof extEditor.getContent === 'function') {\n\t\t\t\t\t\tta.getContent = extEditor.getContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (! ta.initEditArea) {\n\t\t\t\t\tta.initEditArea = function() {};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (! ta.getContent) {\n\t\t\t\t\tta.getContent = function() {\n\t\t\t\t\t\treturn rtrim(ta.val());\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!editor || !editor.info || !editor.info.preventGet) {\n\t\t\t\t\topts.buttons[fm.i18n('btnSave')]      = saveon;\n\t\t\t\t\topts.buttons[fm.i18n('btnSaveClose')] = savecl;\n\t\t\t\t\topts.buttons[fm.i18n('btnSaveAs')]    = saveAs;\n\t\t\t\t\topts.buttons[fm.i18n('btnCancel')]    = cancel;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (editor && typeof editor.prepare === 'function') {\n\t\t\t\t\teditor.prepare(ta, opts, file);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdialogNode = self.fmDialog(ta, opts)\n\t\t\t\t\t.attr('id', id)\n\t\t\t\t\t.on('keydown keyup keypress', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.css({ overflow: 'hidden', minHeight: '7em' })\n\t\t\t\t\t.addClass('elfinder-edit-editor')\n\t\t\t\t\t.closest('.ui-dialog')\n\t\t\t\t\t.on('changeType', function(e, data) {\n\t\t\t\t\t\tif (data.extention && data.mime) {\n\t\t\t\t\t\t\tvar ext = data.extention,\n\t\t\t\t\t\t\t\tmime = data.mime,\n\t\t\t\t\t\t\t\tbtnSet = $(this).children('.ui-dialog-buttonpane').children('.ui-dialog-buttonset');\n\t\t\t\t\t\t\tbtnSet.children('.elfinder-btncnt-0,.elfinder-btncnt-1').hide();\n\t\t\t\t\t\t\tsaveAsFile.name = fm.splitFileExtention(file.name)[0] + '.' + data.extention;\n\t\t\t\t\t\t\tsaveAsFile.mime = data.mime;\n\t\t\t\t\t\t\tif (!data.keepEditor) {\n\t\t\t\t\t\t\t\tbtnSet.children('.elfinder-btncnt-2').trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// care to viewport scale change with mobile devices\n\t\t\t\tmaxW = (fm.options.dialogContained? fm.getUI() : $(window)).width();\n\t\t\t\t(dialogNode.width() > maxW) && dialogNode.width(maxW);\n\t\t\t\t\n\t\t\t\treturn dfrd.promise();\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Get file content and\n\t\t\t * open dialog with textarea to edit file content\n\t\t\t *\n\t\t\t * @param  String  file hash\n\t\t\t * @return jQuery.Deferred\n\t\t\t **/\n\t\t\tedit = function(file, convert, editor) {\n\t\t\t\tvar hash   = file.hash,\n\t\t\t\t\topts   = fm.options,\n\t\t\t\t\tdfrd   = $.Deferred(), \n\t\t\t\t\tid     = 'edit-'+fm.namespace+'-'+file.hash,\n\t\t\t\t\td      = fm.getUI().find('#'+id),\n\t\t\t\t\tconv   = !convert? 0 : convert,\n\t\t\t\t\tnoContent = false,\n\t\t\t\t\treq, error, res;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (d.length) {\n\t\t\t\t\td.elfinderdialog('toTop');\n\t\t\t\t\treturn dfrd.resolve();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!file.read || (!file.write && (!editor.info || !editor.info.converter))) {\n\t\t\t\t\terror = ['errOpen', file.name, 'errPerm'];\n\t\t\t\t\treturn dfrd.reject(error);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (editor && editor.info) {\n\t\t\t\t\tif (typeof editor.info.edit === 'function') {\n\t\t\t\t\t\tres = editor.info.edit.call(fm, file, editor);\n\t\t\t\t\t\tif (res.promise) {\n\t\t\t\t\t\t\tres.done(function() {\n\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres? dfrd.resolve() : dfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dfrd;\n\t\t\t\t\t}\n\n\t\t\t\t\tnoContent = editor.info.preventGet || editor.info.noContent;\n\t\t\t\t\tif (editor.info.urlAsContent || noContent) {\n\t\t\t\t\t\treq = $.Deferred();\n\t\t\t\t\t\tif (editor.info.urlAsContent) {\n\t\t\t\t\t\t\tfm.url(hash, { async: true, onetime: true, temporary: true }).done(function(url) {\n\t\t\t\t\t\t\t\treq.resolve({content: url});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treq.resolve({});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (conv) {\n\t\t\t\t\t\t\tfile.encoding = conv;\n\t\t\t\t\t\t\tfm.cache(file, 'change');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treq = fm.request({\n\t\t\t\t\t\t\tdata           : {cmd : 'get', target : hash, conv : conv, _t : file.ts},\n\t\t\t\t\t\t\toptions        : {type: 'get', cache : true},\n\t\t\t\t\t\t\tnotify         : {type : 'file', cnt : 1},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treq.done(function(data) {\n\t\t\t\t\t\tvar selEncoding, reg, m, res;\n\t\t\t\t\t\tif (data.doconv) {\n\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\t\t\t\ttext   : data.doconv === 'unknown'? 'confirmNonUTF8' : 'confirmConvUTF8',\n\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnConv',\n\t\t\t\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\t\t\t\tdfrd = edit(file, selEncoding.val(), editor);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\t\t\t\tcallback : function() { dfrd.reject(); }\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\toptionsCallback : function(options) {\n\t\t\t\t\t\t\t\t\toptions.create = function() {\n\t\t\t\t\t\t\t\t\t\tvar base = $('<div class=\"elfinder-dialog-confirm-encoding\"/>'),\n\t\t\t\t\t\t\t\t\t\t\thead = {value: data.doconv},\n\t\t\t\t\t\t\t\t\t\t\tdetected;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (data.doconv === 'unknown') {\n\t\t\t\t\t\t\t\t\t\t\thead.caption = '-';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tselEncoding = getEncSelect([head]);\n\t\t\t\t\t\t\t\t\t\t$(this).next().find('.ui-dialog-buttonset')\n\t\t\t\t\t\t\t\t\t\t\t.prepend(base.append($('<label>'+fm.i18n('encoding')+' </label>').append(selEncoding)));\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!noContent && fm.mimeIsText(file.mime)) {\n\t\t\t\t\t\t\t\treg = new RegExp('^(data:'+file.mime.replace(/([.+])/g, '\\\\$1')+';base64,)', 'i');\n\t\t\t\t\t\t\t\tif (!editor.info.dataScheme) {\n\t\t\t\t\t\t\t\t\tif (window.atob && (m = data.content.match(reg))) {\n\t\t\t\t\t\t\t\t\t\tdata.content = atob(data.content.substr(m[1].length));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (window.btoa && !data.content.match(reg)) {\n\t\t\t\t\t\t\t\t\t\tdata.content = 'data:'+file.mime+';base64,'+btoa(data.content);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog(id, file, data.content, data.encoding, editor, data.toasts)\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.progress(function(encoding, newHash, data, saveDfd) {\n\t\t\t\t\t\t\t\t\tvar ta = this;\n\t\t\t\t\t\t\t\t\tif (newHash) {\n\t\t\t\t\t\t\t\t\t\thash = newHash;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\toptions : {type : 'post'},\n\t\t\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\t\t\tcmd     : 'put',\n\t\t\t\t\t\t\t\t\t\t\ttarget  : hash,\n\t\t\t\t\t\t\t\t\t\t\tencoding : encoding || data.encoding,\n\t\t\t\t\t\t\t\t\t\t\tcontent : data\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'save', cnt : 1},\n\t\t\t\t\t\t\t\t\t\tsyncOnFail : true,\n\t\t\t\t\t\t\t\t\t\tpreventFail : true,\n\t\t\t\t\t\t\t\t\t\tnavigate : {\n\t\t\t\t\t\t\t\t\t\t\ttarget : 'changed',\n\t\t\t\t\t\t\t\t\t\t\ttoast : {\n\t\t\t\t\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('btnSave')])}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\tsaveDfd.reject();\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function(){\n\t\t\t\t\t\t\t\t\t\t\tta.trigger('focus');\n\t\t\t\t\t\t\t\t\t\t\tta.editor && ta.editor.focus(ta[0], ta.editor.instance);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tsaveDfd.resolve();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tvar err = fm.parseError(error);\n\t\t\t\t\t\terr = Array.isArray(err)? err[0] : err;\n\t\t\t\t\t\tif (file.encoding) {\n\t\t\t\t\t\t\tfile.encoding = '';\n\t\t\t\t\t\t\tfm.cache(file, 'change');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t(err !== 'errConvUTF8') && fm.sync();\n\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn dfrd.promise();\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Current editors of selected files\n\t\t\t * \n\t\t\t * @type Object\n\t\t\t */\n\t\t\teditors = {},\n\t\t\t\n\t\t\t/**\n\t\t\t * Fallback editor (Simple text editor)\n\t\t\t * \n\t\t\t * @type Object\n\t\t\t */\n\t\t\tfallbackEditor = {\n\t\t\t\t// Simple Text (basic textarea editor)\n\t\t\t\tinfo : {\n\t\t\t\t\tid : 'textarea',\n\t\t\t\t\tname : 'TextArea',\n\t\t\t\t\tuseTextAreaEvent : true\n\t\t\t\t},\n\t\t\t\tload : function(textarea) {\n\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\tthis.trigger('Prepare', {\n\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\teditorObj: void(0),\n\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\topts: {}\n\t\t\t\t\t});\n\t\t\t\t\ttextarea.setSelectionRange && textarea.setSelectionRange(0, 0);\n\t\t\t\t\t$(textarea).trigger('focus').show();\n\t\t\t\t},\n\t\t\t\tsave : function(){}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Set current editors\n\t\t\t * \n\t\t\t * @param  Object  file object\n\t\t\t * @param  Number  cnt  count of selected items\n\t\t\t * @return Void\n\t\t\t */\n\t\t\tsetEditors = function(file, cnt) {\n\t\t\t\tvar mimeMatch = function(fileMime, editorMimes){\n\t\t\t\t\t\tif (!editorMimes) {\n\t\t\t\t\t\t\treturn fm.mimeIsText(fileMime);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (editorMimes[0] === '*' || $.inArray(fileMime, editorMimes) !== -1) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar i, l;\n\t\t\t\t\t\t\tl = editorMimes.length;\n\t\t\t\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\t\t\t\tif (fileMime.indexOf(editorMimes[i]) === 0) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\textMatch = function(fileName, editorExts){\n\t\t\t\t\t\tif (!editorExts || !editorExts.length) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar ext = fileName.replace(/^.+\\.([^.]+)|(.+)$/, '$1$2').toLowerCase(),\n\t\t\t\t\t\ti, l;\n\t\t\t\t\t\tl = editorExts.length;\n\t\t\t\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\t\t\t\tif (ext === editorExts[i].toLowerCase()) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\toptEditors = self.options.editors || [],\n\t\t\t\t\tcwdWrite = fm.cwd().write;\n\t\t\t\t\n\t\t\t\tstored = fm.storage('storedEditors') || {};\n\t\t\t\teditors = {};\n\t\t\t\tif (!optEditors.length) {\n\t\t\t\t\toptEditors = [fallbackEditor];\n\t\t\t\t}\n\t\t\t\t$.each(optEditors, function(i, editor) {\n\t\t\t\t\tvar name;\n\t\t\t\t\tif ((cnt === 1 || !editor.info.single)\n\t\t\t\t\t\t\t&& ((!editor.info || !editor.info.converter)? file.write : cwdWrite)\n\t\t\t\t\t\t\t&& (file.size > 0 || (!editor.info.converter && editor.info.canMakeEmpty !== false && fm.mimesCanMakeEmpty[file.mime]))\n\t\t\t\t\t\t\t&& (!editor.info.maxSize || file.size <= editor.info.maxSize)\n\t\t\t\t\t\t\t&& mimeMatch(file.mime, editor.mimes || null)\n\t\t\t\t\t\t\t&& extMatch(file.name, editor.exts || null)\n\t\t\t\t\t\t\t&& typeof editor.load == 'function'\n\t\t\t\t\t\t\t&& typeof editor.save == 'function') {\n\t\t\t\t\t\t\n\t\t\t\t\t\tname = editor.info.name? editor.info.name : ('Editor ' + i);\n\t\t\t\t\t\teditor.id = editor.info.id? editor.info.id : ('editor' + i),\n\t\t\t\t\t\teditor.name = name;\n\t\t\t\t\t\teditor.i18n = fm.i18n(name);\n\t\t\t\t\t\teditors[editor.id] = editor;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn Object.keys(editors).length? true : false;\n\t\t\t},\n\t\t\tstore = function(mime, editor) {\n\t\t\t\tif (mime && editor) {\n\t\t\t\t\tif (!$.isPlainObject(stored)) {\n\t\t\t\t\t\tstored = {};\n\t\t\t\t\t}\n\t\t\t\t\tstored[mime] = editor.id;\n\t\t\t\t\tfm.storage('storedEditors', stored);\n\t\t\t\t\tfm.trigger('selectfiles', {files : fm.selected()});\n\t\t\t\t}\n\t\t\t},\n\t\t\tuseStoredEditor = function() {\n\t\t\t\tvar d = fm.storage('useStoredEditor');\n\t\t\t\treturn d? (d > 0) : self.options.useStoredEditor;\n\t\t\t},\n\t\t\teditorMaximized = function() {\n\t\t\t\tvar d = fm.storage('editorMaximized');\n\t\t\t\treturn d? (d > 0) : self.options.editorMaximized;\n\t\t\t},\n\t\t\tgetSubMenuRaw = function(files, callback) {\n\t\t\t\tvar subMenuRaw = [];\n\t\t\t\t$.each(editors, function(id, ed) {\n\t\t\t\t\tsubMenuRaw.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel    : fm.escape(ed.i18n),\n\t\t\t\t\t\t\ticon     : ed.info && ed.info.icon? ed.info.icon : 'edit',\n\t\t\t\t\t\t\toptions  : { iconImg: ed.info && ed.info.iconImg? fm.baseUrl + ed.info.iconImg : void(0) },\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\tstore(files[0].mime, ed);\n\t\t\t\t\t\t\t\tcallback && callback.call(ed);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\t\t\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\treturn subMenuRaw;\n\t\t\t},\n\t\t\tgetStoreId = function(name) {\n\t\t\t\t// for compatibility to previous version\n\t\t\t\treturn name.toLowerCase().replace(/ +/g, '');\n\t\t\t},\n\t\t\tgetStoredEditor = function(mime) {\n\t\t\t\tvar name = stored[mime];\n\t\t\t\treturn name && Object.keys(editors).length? editors[getStoreId(name)] : void(0);\n\t\t\t},\n\t\t\tinfoRequest = function() {\n\n\t\t\t},\n\t\t\tstored;\n\t\t\n\t\t// make public method\n\t\tthis.getEncSelect = getEncSelect;\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+e'\n\t\t}];\n\t\t\n\t\tthis.init = function() {\n\t\t\tvar self = this,\n\t\t\t\tfm   = this.fm,\n\t\t\t\topts = this.options,\n\t\t\t\tcmdChecks = [],\n\t\t\t\tccData, dfd;\n\t\t\t\n\t\t\tthis.onlyMimes = this.options.mimes || [];\n\t\t\t\n\t\t\tfm.one('open', function() {\n\t\t\t\t// editors setup\n\t\t\t\tif (opts.editors && Array.isArray(opts.editors)) {\n\t\t\t\t\tfm.trigger('canMakeEmptyFile', {mimes: Object.keys(fm.storage('mkfileTextMimes') || {}).concat(opts.makeTextMimes || ['text/plain'])});\n\t\t\t\t\t$.each(opts.editors, function(i, editor) {\n\t\t\t\t\t\tif (editor.info && editor.info.cmdCheck) {\n\t\t\t\t\t\t\tcmdChecks.push(editor.info.cmdCheck);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (cmdChecks.length) {\n\t\t\t\t\t\tif (fm.api >= 2.1030) {\n\t\t\t\t\t\t\tdfd = fm.request({\n\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\tcmd: 'editor',\n\t\t\t\t\t\t\t\t\tname: cmdChecks,\n\t\t\t\t\t\t\t\t\tmethod: 'enabled'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t}).done(function(d) {\n\t\t\t\t\t\t\t\tccData = d;\n\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\tccData = {};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tccData = {};\n\t\t\t\t\t\t\tdfd = $.Deferred().resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfd = $.Deferred().resolve();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdfd.always(function() {\n\t\t\t\t\t\tif (ccData) {\n\t\t\t\t\t\t\topts.editors = $.grep(opts.editors, function(e) {\n\t\t\t\t\t\t\t\tif (e.info && e.info.cmdCheck) {\n\t\t\t\t\t\t\t\t\treturn ccData[e.info.cmdCheck]? true : false;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.each(opts.editors, function(i, editor) {\n\t\t\t\t\t\t\tif (editor.setup && typeof editor.setup === 'function') {\n\t\t\t\t\t\t\t\teditor.setup.call(editor, opts, fm);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!editor.disabled) {\n\t\t\t\t\t\t\t\tif (editor.mimes && Array.isArray(editor.mimes)) {\n\t\t\t\t\t\t\t\t\tmimesSingle = mimesSingle.concat(editor.mimes);\n\t\t\t\t\t\t\t\t\tif (!editor.info || !editor.info.single) {\n\t\t\t\t\t\t\t\t\t\tmimes = mimes.concat(editor.mimes);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!allowAll && editor.mimes && editor.mimes[0] === '*') {\n\t\t\t\t\t\t\t\t\tallowAll = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!editor.info) {\n\t\t\t\t\t\t\t\t\teditor.info = {};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (editor.info.integrate) {\n\t\t\t\t\t\t\t\t\tfm.trigger('helpIntegration', Object.assign({cmd: 'edit'}, editor.info.integrate));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (editor.info.canMakeEmpty) {\n\t\t\t\t\t\t\t\t\tfm.trigger('canMakeEmptyFile', {mimes: Array.isArray(editor.info.canMakeEmpty)? editor.info.canMakeEmpty : editor.mimes});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tmimesSingle = ($.uniqueSort || $.unique)(mimesSingle);\n\t\t\t\t\t\tmimes = ($.uniqueSort || $.unique)(mimes);\n\t\t\t\t\t\t\n\t\t\t\t\t\topts.editors = $.grep(opts.editors, function(e) {\n\t\t\t\t\t\t\treturn e.disabled? false : true;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('select', function() {\n\t\t\t\teditors = null;\n\t\t\t})\n\t\t\t.bind('contextmenucreate', function(e) {\n\t\t\t\tvar file, editor,\n\t\t\t\t\tsingle = function(editor) {\n\t\t\t\t\t\tvar title = self.title;\n\t\t\t\t\t\tfm.one('contextmenucreatedone', function() {\n\t\t\t\t\t\t\tself.title = title;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tself.title = fm.escape(editor.i18n);\n\t\t\t\t\t\tif (editor.info && editor.info.iconImg) {\n\t\t\t\t\t\t\tself.contextmenuOpts = {\n\t\t\t\t\t\t\t\ticonImg: fm.baseUrl + editor.info.iconImg\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete self.variants;\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tself.contextmenuOpts = void(0);\n\t\t\t\tif (e.data.type === 'files' && self.enabled()) {\n\t\t\t\t\tfile = fm.file(e.data.targets[0]);\n\t\t\t\t\tif (setEditors(file, e.data.targets.length)) {\n\t\t\t\t\t\tif (Object.keys(editors).length > 1) {\n\t\t\t\t\t\t\tif (!useStoredEditor() || !(editor = getStoredEditor(file.mime))) {\n\t\t\t\t\t\t\t\tdelete self.extra;\n\t\t\t\t\t\t\t\tself.variants = [];\n\t\t\t\t\t\t\t\t$.each(editors, function(id, editor) {\n\t\t\t\t\t\t\t\t\tself.variants.push([{ editor: editor }, editor.i18n, editor.info && editor.info.iconImg? fm.baseUrl + editor.info.iconImg : 'edit']);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsingle(editor);\n\t\t\t\t\t\t\t\tself.extra = {\n\t\t\t\t\t\t\t\t\ticon: 'menu',\n\t\t\t\t\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t\t\t\t\t.attr({title: fm.i18n('select')})\n\t\t\t\t\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(this);\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\t\t\t\t\t\traw: getSubMenuRaw(fm.selectedFiles(), function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar hashes = fm.selected();\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('edit', hashes, {editor: this});\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.trigger('selectfiles', {files : hashes});\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\t\t\t\t\t\t\ty: node.offset().top\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsingle(editors[Object.keys(editors)[0]]);\n\t\t\t\t\t\t\tdelete self.extra;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('canMakeEmptyFile', function(e) {\n\t\t\t\tif (e.data && e.data.resetTexts) {\n\t\t\t\t\tvar defs = fm.arrayFlip(self.options.makeTextMimes || ['text/plain']),\n\t\t\t\t\t\thides = self.getMkfileHides();\n\n\t\t\t\t\t$.each((fm.storage('mkfileTextMimes') || {}), function(mime, type) {\n\t\t\t\t\t\tif (!defs[mime]) {\n\t\t\t\t\t\t\tdelete fm.mimesCanMakeEmpty[mime];\n\t\t\t\t\t\t\tdelete hides[mime];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tfm.storage('mkfileTextMimes', null);\n\t\t\t\t\tif (Object.keys(hides).length) {\n\t\t\t\t\t\tfm.storage('mkfileHides', hides);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.storage('mkfileHides', null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\n\t\t\treturn cnt && filter(sel).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(select, opts) {\n\t\t\tvar fm    = this.fm, \n\t\t\t\tfiles = filter(this.files(select)),\n\t\t\t\thashes = $.map(files, function(f) { return f.hash; }),\n\t\t\t\tlist  = [],\n\t\t\t\teditor = opts && opts.editor? opts.editor : null,\n\t\t\t\tnode = $(opts && opts._currentNode? opts._currentNode : fm.cwdHash2Elm(hashes[0])),\n\t\t\t\tgetEditor = function() {\n\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\tstoredId;\n\t\t\t\t\t\n\t\t\t\t\tif (!editor && Object.keys(editors).length > 1) {\n\t\t\t\t\t\tif (useStoredEditor() && (editor = getStoredEditor(files[0].mime))) {\n\t\t\t\t\t\t\treturn dfd.resolve(editor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: getSubMenuRaw(files, function() {\n\t\t\t\t\t\t\t\tdfd.resolve(this);\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\t\ty: node.offset().top + 22,\n\t\t\t\t\t\t\topened: function() {\n\t\t\t\t\t\t\t\tfm.one('closecontextmenu',function() {\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\tif (dfd.state() === 'pending') {\n\t\t\t\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.trigger('selectfiles', {files : hashes});\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn dfd;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tObject.keys(editors).length > 1 && editor && store(files[0].mime, editor);\n\t\t\t\t\t\treturn dfd.resolve(editor? editor : (Object.keys(editors).length? editors[Object.keys(editors)[0]] : null));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\tfile;\n\n\t\t\tif (editors === null) {\n\t\t\t\tsetEditors(files[0], hashes.length);\n\t\t\t}\n\t\t\t\n\t\t\tif (!node.length) {\n\t\t\t\tnode = fm.getUI('cwd');\n\t\t\t}\n\t\t\t\n\t\t\tgetEditor().done(function(editor) {\n\t\t\t\twhile ((file = files.shift())) {\n\t\t\t\t\tlist.push(edit(file, (file.encoding || void(0)), editor).fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (list.length) { \n\t\t\t\t\t$.when.apply(null, list).done(function() {\n\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfrd.reject();\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\tdfrd.reject();\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t\tthis.getMkfileHides = function() {\n\t\t\treturn fm.storage('mkfileHides') || fm.arrayFlip(self.options.mkfileHideMimes || []);\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/empty',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"empty\".\n\t * Empty the folder\n\t *\n\t * @type  elFinder.command\n\t * @author  Naoki Sawada\n\t */\n\telFinder.prototype.commands.empty = function() {\n\t\t\"use strict\";\n\t\tvar self, fm,\n\t\t\tselFiles = function(select) {\n\t\t\t\tvar sel = self.files(select);\n\t\t\t\tif (!sel.length) {\n\t\t\t\t\tsel = [ fm.cwd() ];\n\t\t\t\t}\n\t\t\t\treturn sel;\n\t\t\t};\n\t\t\n\t\tthis.linkedCmds = ['rm'];\n\t\t\n\t\tthis.init = function() {\n\t\t\t// lazy assign to make possible to become superclass\n\t\t\tself = this;\n\t\t\tfm = this.fm;\n\t\t};\n\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = selFiles(select),\n\t\t\t\tcnt;\n\t\t\t\n\t\t\tcnt = sel.length;\n\t\t\treturn $.grep(sel, function(f) { return f.read && f.write && f.mime === 'directory' ? true : false; }).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar dirs = selFiles(hashes),\n\t\t\t\tcnt  = dirs.length,\n\t\t\t\tdfrd = $.Deferred()\n\t\t\t\t\t.done(function() {\n\t\t\t\t\t\tvar data = {changed: {}};\n\t\t\t\t\t\tfm.toast({msg: fm.i18n(['\"'+success.join('\", ')+'\"', 'complete', fm.i18n('cmdempty')])});\n\t\t\t\t\t\t$.each(dirs, function(i, dir) {\n\t\t\t\t\t\t\tdata.changed[dir.hash] = dir;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.change(data);\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tvar cwd = fm.cwd().hash;\n\t\t\t\t\t\tfm.trigger('selectfiles', {files: $.map(dirs, function(d) { return cwd === d.phash? d.hash : null; })});\n\t\t\t\t\t}),\n\t\t\t\tsuccess = [],\n\t\t\t\tdone = function(res) {\n\t\t\t\t\tif (typeof res === 'number') {\n\t\t\t\t\t\tsuccess.push(dirs[res].name);\n\t\t\t\t\t\tdelete dirs[res].dirs;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres && fm.error(res);\n\t\t\t\t\t}\n\t\t\t\t\t(--cnt < 1) && dfrd[success.length? 'resolve' : 'reject']();\n\t\t\t\t};\n\n\t\t\t$.each(dirs, function(i, dir) {\n\t\t\t\tvar tm;\n\t\t\t\tif (!(dir.write && dir.mime === 'directory')) {\n\t\t\t\t\tdone(['errEmpty', dir.name, 'errPerm']);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tif (!fm.isCommandEnabled('rm', dir.hash)) {\n\t\t\t\t\tdone(['errCmdNoSupport', '\"rm\"']);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\tfm.notify({type : 'search', cnt : 1, hideCnt : cnt > 1? false : true});\n\t\t\t\t}, fm.notifyDelay);\n\t\t\t\tfm.request({\n\t\t\t\t\tdata : {cmd  : 'open', target : dir.hash},\n\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\tasNotOpen : true\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tvar targets = [];\n\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\tif (fm.ui.notify.children('.elfinder-notify-search').length) {\n\t\t\t\t\t\tfm.notify({type : 'search', cnt : -1, hideCnt : cnt > 1? false : true});\n\t\t\t\t\t}\n\t\t\t\t\tif (data && data.files && data.files.length) {\n\t\t\t\t\t\tif (data.files.length > fm.maxTargets) {\n\t\t\t\t\t\t\tdone(['errEmpty', dir.name, 'errMaxTargets', fm.maxTargets]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\t\t\t$.each(data.files, function(i, f) {\n\t\t\t\t\t\t\t\tif (!f.write || f.locked) {\n\t\t\t\t\t\t\t\t\tdone(['errEmpty', dir.name, 'errRm', f.name, 'errPerm']);\n\t\t\t\t\t\t\t\t\ttargets = [];\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttargets.push(f.hash);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (targets.length) {\n\t\t\t\t\t\t\t\tfm.exec('rm', targets, { _userAction : true, addTexts : [ fm.i18n('folderToEmpty', dir.name) ] })\n\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', {files: fm.selected()});\n\t\t\t\t\t\t\t\t\tdone(fm.parseError(error) || '');\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function() { done(i); });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.toast({ mode: 'warning', msg: fm.i18n('filderIsEmpty', dir.name)});\n\t\t\t\t\t\tdone('');\n\t\t\t\t\t}\n\t\t\t\t}).fail(function(error) {\n\t\t\t\t\tdone(fm.parseError(error) || '');\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/extract',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"extract\"\n\t * Extract files from archive\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.extract = function() {\n\t\t\"use strict\";\n\t\tvar self    = this,\n\t\t\tfm      = self.fm,\n\t\t\tmimes   = [],\n\t\t\tfilter  = function(files) {\n\t\t\t\treturn $.grep(files, function(file) { \n\t\t\t\t\treturn file.read && $.inArray(file.mime, mimes) !== -1 ? true : false;\n\t\t\t\t});\n\t\t\t};\n\t\t\n\t\tthis.variants = [];\n\t\tthis.disableOnSearch = true;\n\t\t\n\t\t// Update mimes list on open/reload\n\t\tfm.bind('open reload', function() {\n\t\t\tmimes = fm.option('archivers')['extract'] || [];\n\t\t\tif (fm.api > 2) {\n\t\t\t\tself.variants = [[{makedir: true}, fm.i18n('cmdmkdir')], [{}, fm.i18n('btnCwd')]];\n\t\t\t} else {\n\t\t\t\tself.variants = [[{}, fm.i18n('btnCwd')]];\n\t\t\t}\n\t\t\tself.change();\n\t\t});\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\t\t\t\n\t\t\treturn cnt && this.fm.cwd().write && filter(sel).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, opts) {\n\t\t\tvar files    = this.files(hashes),\n\t\t\t\tdfrd     = $.Deferred(),\n\t\t\t\tcnt      = files.length,\n\t\t\t\tmakedir  = opts && opts.makedir ? 1 : 0,\n\t\t\t\ti, error,\n\t\t\t\tdecision;\n\n\t\t\tvar overwriteAll = false;\n\t\t\tvar omitAll = false;\n\t\t\tvar mkdirAll = 0;\n\n\t\t\tvar names = $.map(fm.files(hashes), function(file) { return file.name; });\n\t\t\tvar map = {};\n\t\t\t$.grep(fm.files(hashes), function(file) {\n\t\t\t\tmap[file.name] = file;\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\t\n\t\t\tvar decide = function(decision) {\n\t\t\t\tswitch (decision) {\n\t\t\t\t\tcase 'overwrite_all' :\n\t\t\t\t\t\toverwriteAll = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'omit_all':\n\t\t\t\t\t\tomitAll = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar unpack = function(file) {\n\t\t\t\tif (!(file.read && fm.file(file.phash).write)) {\n\t\t\t\t\terror = ['errExtract', file.name, 'errPerm'];\n\t\t\t\t\tfm.error(error);\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t} else if ($.inArray(file.mime, mimes) === -1) {\n\t\t\t\t\terror = ['errExtract', file.name, 'errNoArchive'];\n\t\t\t\t\tfm.error(error);\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t} else {\n\t\t\t\t\tfm.request({\n\t\t\t\t\t\tdata:{cmd:'extract', target:file.hash, makedir:makedir},\n\t\t\t\t\t\tnotify:{type:'extract', cnt:1},\n\t\t\t\t\t\tsyncOnFail:true,\n\t\t\t\t\t\tnavigate:{\n\t\t\t\t\t\t\ttoast : makedir? {\n\t\t\t\t\t\t\t\tincwd    : {msg: fm.i18n(['complete', fm.i18n('cmdextract')]), action: {cmd: 'open', msg: 'cmdopen'}},\n\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('cmdextract')]), action: {cmd: 'open', msg: 'cmdopen'}}\n\t\t\t\t\t\t\t} : {\n\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('cmdextract')])}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function (error) {\n\t\t\t\t\t\tif (dfrd.state() != 'rejected') {\n\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.done(function () {\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tvar confirm = function(files, index) {\n\t\t\t\tvar file = files[index],\n\t\t\t\tname = fm.splitFileExtention(file.name)[0],\n\t\t\t\texisted = ($.inArray(name, names) >= 0),\n\t\t\t\tnext = function(){\n\t\t\t\t\tif((index+1) < cnt) {\n\t\t\t\t\t\tconfirm(files, index+1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (!makedir && existed && map[name].mime != 'directory') {\n\t\t\t\t\tfm.confirm(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle : fm.i18n('ntfextract'),\n\t\t\t\t\t\t\ttext  : ['errExists', name, 'confirmRepl'],\n\t\t\t\t\t\t\taccept:{\n\t\t\t\t\t\t\t\tlabel : 'btnYes',\n\t\t\t\t\t\t\t\tcallback:function (all) {\n\t\t\t\t\t\t\t\t\tdecision = all ? 'overwrite_all' : 'overwrite';\n\t\t\t\t\t\t\t\t\tdecide(decision);\n\t\t\t\t\t\t\t\t\tif(!overwriteAll && !omitAll) {\n\t\t\t\t\t\t\t\t\t\tif('overwrite' == decision) {\n\t\t\t\t\t\t\t\t\t\t\tunpack(file);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif((index+1) < cnt) {\n\t\t\t\t\t\t\t\t\t\t\tconfirm(files, index+1);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else if(overwriteAll) {\n\t\t\t\t\t\t\t\t\t\tfor (i = index; i < cnt; i++) {\n\t\t\t\t\t\t\t\t\t\t\tunpack(files[i]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treject : {\n\t\t\t\t\t\t\t\tlabel : 'btnNo',\n\t\t\t\t\t\t\t\tcallback:function (all) {\n\t\t\t\t\t\t\t\t\tdecision = all ? 'omit_all' : 'omit';\n\t\t\t\t\t\t\t\t\tdecide(decision);\n\t\t\t\t\t\t\t\t\tif(!overwriteAll && !omitAll && (index+1) < cnt) {\n\t\t\t\t\t\t\t\t\t\tconfirm(files, index+1);\n\t\t\t\t\t\t\t\t\t} else if (omitAll) {\n\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\t\t\tcallback:function () {\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tall : ((index+1) < cnt)\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else if (!makedir) {\n\t\t\t\t\tif (mkdirAll == 0) {\n\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\ttitle : fm.i18n('cmdextract'),\n\t\t\t\t\t\t\ttext  : [fm.i18n('cmdextract')+' \"'+file.name+'\"', 'confirmRepl'],\n\t\t\t\t\t\t\taccept:{\n\t\t\t\t\t\t\t\tlabel : 'btnYes',\n\t\t\t\t\t\t\t\tcallback:function (all) {\n\t\t\t\t\t\t\t\t\tall && (mkdirAll = 1);\n\t\t\t\t\t\t\t\t\tunpack(file);\n\t\t\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\treject : {\n\t\t\t\t\t\t\t\tlabel : 'btnNo',\n\t\t\t\t\t\t\t\tcallback:function (all) {\n\t\t\t\t\t\t\t\t\tall && (mkdirAll = -1);\n\t\t\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\t\t\tcallback:function () {\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tall : ((index+1) < cnt)\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(mkdirAll > 0) && unpack(file);\n\t\t\t\t\t\tnext();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tunpack(file);\n\t\t\t\t\tnext();\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tif (!(this.enabled() && cnt && mimes.length)) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tif(cnt > 0) {\n\t\t\t\tconfirm(files, 0);\n\t\t\t}\n\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/forward',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"forward\"\n\t * Open next visited folder\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t(elFinder.prototype.commands.forward = function() {\n\t\t\"use strict\";\n\t\tthis.alwaysEnabled = true;\n\t\tthis.updateOnSelect = true;\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+right'\n\t\t}];\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn this.fm.history.canForward() ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\treturn this.fm.history.forward();\n\t\t};\n\t\t\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/fullscreen',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"fullscreen\"\n\t * elFinder node to full scrren mode\n\t *\n\t * @author Naoki Sawada\n\t **/\n\n\telFinder.prototype.commands.fullscreen = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\t\tfm     = this.fm,\n\t\t\tupdate = function(e, data) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t\tif (data && data.fullscreen) {\n\t\t\t\t\tself.update(void(0), (data.fullscreen === 'on'));\n\t\t\t\t}\n\t\t\t};\n\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.syncTitleOnChange = true;\n\t\tthis.value = false;\n\n\t\tthis.options = {\n\t\t\tui : 'fullscreenbutton'\n\t\t};\n\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar node = fm.getUI().get(0),\n\t\t\t\tfull = (node === fm.toggleFullscreen(node));\n\t\t\tself.title = fm.i18n(full ? 'reinstate' : 'cmdfullscreen');\n\t\t\tself.update(void(0), full);\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\t\t\n\t\tfm.bind('init', function() {\n\t\t\tfm.getUI().off('resize.' + fm.namespace, update).on('resize.' + fm.namespace, update);\n\t\t});\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/getfile',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"getfile\". \n\t * Return selected files info into outer callback.\n\t * For use elFinder with wysiwyg editors etc.\n\t *\n\t * @author Dmitry (dio) Levashov, dio@std42.ru\n\t **/\n\t(elFinder.prototype.commands.getfile = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\t\tfm     = this.fm,\n\t\t\tfilter = function(files) {\n\t\t\t\tvar o = self.options;\n\n\t\t\t\tfiles = $.grep(files, function(file) {\n\t\t\t\t\treturn (file.mime != 'directory' || o.folders) && file.read ? true : false;\n\t\t\t\t});\n\n\t\t\t\treturn o.multiple || files.length == 1 ? files : [];\n\t\t\t};\n\t\t\n\t\tthis.alwaysEnabled = true;\n\t\tthis.callback      = fm.options.getFileCallback;\n\t\tthis._disabled     = typeof(this.callback) == 'function';\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\t\t\t\t\n\t\t\treturn this.callback && cnt && filter(sel).length == cnt ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar fm    = this.fm,\n\t\t\t\topts  = this.options,\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tcnt   = files.length,\n\t\t\t\turl   = fm.option('url'),\n\t\t\t\ttmb   = fm.option('tmbUrl'),\n\t\t\t\tdfrd  = $.Deferred()\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tvar res,\n\t\t\t\t\t\t\tdone = function() {\n\t\t\t\t\t\t\t\tif (opts.oncomplete == 'close') {\n\t\t\t\t\t\t\t\t\tfm.hide();\n\t\t\t\t\t\t\t\t} else if (opts.oncomplete == 'destroy') {\n\t\t\t\t\t\t\t\t\tfm.destroy();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail = function(error) {\n\t\t\t\t\t\t\t\tif (opts.onerror == 'close') {\n\t\t\t\t\t\t\t\t\tfm.hide();\n\t\t\t\t\t\t\t\t} else if (opts.onerror == 'destroy') {\n\t\t\t\t\t\t\t\t\tfm.destroy();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\tfm.trigger('getfile', {files : data});\n\t\t\t\t\t\t\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tres = self.callback(data, fm);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tfail(['Error in `getFileCallback`.', e.message]);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (typeof res === 'object' && typeof res.done === 'function') {\n\t\t\t\t\t\t\tres.done(done).fail(fail);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\tresult = function(file) {\n\t\t\t\t\treturn opts.onlyURL\n\t\t\t\t\t\t? opts.multiple ? $.map(files, function(f) { return f.url; }) : files[0].url\n\t\t\t\t\t\t: opts.multiple ? files : files[0];\n\t\t\t\t},\n\t\t\t\treq = [], \n\t\t\t\ti, file, dim;\n\n\t\t\tfor (i = 0; i < cnt; i++) {\n\t\t\t\tfile = files[i];\n\t\t\t\tif (file.mime == 'directory' && !opts.folders) {\n\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t}\n\t\t\t\tfile.baseUrl = url;\n\t\t\t\tif (file.url == '1') {\n\t\t\t\t\treq.push(fm.request({\n\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\tnotify : {type : 'url', cnt : 1, hideCnt : true},\n\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\tvar rfile = fm.file(this.hash);\n\t\t\t\t\t\t\trfile.url = this.url = data.url;\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(file)));\n\t\t\t\t} else {\n\t\t\t\t\tfile.url = fm.url(file.hash);\n\t\t\t\t}\n\t\t\t\tif (! opts.onlyURL) {\n\t\t\t\t\tif (opts.getPath) {\n\t\t\t\t\t\tfile.path = fm.path(file.hash);\n\t\t\t\t\t\tif (file.path === '' && file.phash) {\n\t\t\t\t\t\t\t// get parents\n\t\t\t\t\t\t\t(function() {\n\t\t\t\t\t\t\t\tvar dfd  = $.Deferred();\n\t\t\t\t\t\t\t\treq.push(dfd);\n\t\t\t\t\t\t\t\tfm.path(file.hash, false, {})\n\t\t\t\t\t\t\t\t\t.done(function(path) {\n\t\t\t\t\t\t\t\t\t\tfile.path = path;\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\t\tfile.path = '';\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (file.tmb && file.tmb != 1) {\n\t\t\t\t\t\tfile.tmb = tmb + file.tmb;\n\t\t\t\t\t}\n\t\t\t\t\tif (!file.width && !file.height) {\n\t\t\t\t\t\tif (file.dim) {\n\t\t\t\t\t\t\tdim = file.dim.split('x');\n\t\t\t\t\t\t\tfile.width = dim[0];\n\t\t\t\t\t\t\tfile.height = dim[1];\n\t\t\t\t\t\t} else if (opts.getImgSize && file.mime.indexOf('image') !== -1) {\n\t\t\t\t\t\t\treq.push(fm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'dim', target : file.hash},\n\t\t\t\t\t\t\t\tnotify : {type : 'dim', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tif (data.dim) {\n\t\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\n\t\t\t\t\t\t\t\t\tvar rfile = fm.file(this.hash);\n\t\t\t\t\t\t\t\t\trfile.width = this.width = dim[0];\n\t\t\t\t\t\t\t\t\trfile.height = this.height = dim[1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}.bind(file)));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (req.length) {\n\t\t\t\t$.when.apply(null, req).always(function() {\n\t\t\t\t\tdfrd.resolve(result(files));\n\t\t\t\t});\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t\t\n\t\t\treturn dfrd.resolve(result(files));\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/help',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"help\"\n\t * \"About\" dialog\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t(elFinder.prototype.commands.help = function() {\n\t\t\"use strict\";\n\t\tvar fm   = this.fm,\n\t\t\tself = this,\n\t\t\tlinktpl = '<div class=\"elfinder-help-link\"> <a href=\"{url}\">{link}</a></div>',\n\t\t\tlinktpltgt = '<div class=\"elfinder-help-link\"> <a href=\"{url}\" target=\"_blank\">{link}</a></div>',\n\t\t\tatpl    = '<div class=\"elfinder-help-team\"><div>{author}</div>{work}</div>',\n\t\t\turl     = /\\{url\\}/,\n\t\t\tlink    = /\\{link\\}/,\n\t\t\tauthor  = /\\{author\\}/,\n\t\t\twork    = /\\{work\\}/,\n\t\t\tr       = 'replace',\n\t\t\tprim    = 'ui-priority-primary',\n\t\t\tsec     = 'ui-priority-secondary',\n\t\t\tlic     = 'elfinder-help-license',\n\t\t\ttab     = '<li class=\"' + fm.res('class', 'tabstab') + ' elfinder-help-tab-{id}\"><a href=\"#'+fm.namespace+'-help-{id}\" class=\"ui-tabs-anchor\">{title}</a></li>',\n\t\t\thtml    = ['<div class=\"ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help\">', \n\t\t\t\t\t'<ul class=\"ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top\">'],\n\t\t\tstpl    = '<div class=\"elfinder-help-shortcut\"><div class=\"elfinder-help-shortcut-pattern\">{pattern}</div> {descrip}</div>',\n\t\t\tsep     = '<div class=\"elfinder-help-separator\"/>',\n\t\t\tselfUrl = $('base').length? document.location.href.replace(/#.*$/, '') : '',\n\t\t\tclTabActive = fm.res('class', 'tabsactive'),\n\t\t\t\n\t\t\tgetTheme = function() {\n\t\t\t\tvar src;\n\t\t\t\tif (fm.theme && fm.theme.author) {\n\t\t\t\t\tsrc = atpl[r]('elfinder-help-team', 'elfinder-help-team elfinder-help-term-theme')[r](author, fm.i18n(fm.theme.author) + (fm.theme.email? ' &lt;'+fm.theme.email+'&gt;' : ''))[r](work, fm.i18n('theme') + ' ('+fm.i18n(fm.theme.name)+')');\n\t\t\t\t} else {\n\t\t\t\t\tsrc = '<div class=\"elfinder-help-team elfinder-help-term-theme\" style=\"display:none\"></div>';\n\t\t\t\t}\n\t\t\t\treturn src;\n\t\t\t},\n\n\t\t\tabout = function() {\n\t\t\t\thtml.push('<div id=\"'+fm.namespace+'-help-about\" class=\"ui-tabs-panel ui-widget-content ui-corner-bottom\"><div class=\"elfinder-help-logo\"/>');\n\t\t\t\thtml.push('<h3>elFinder</h3>');\n\t\t\t\thtml.push('<div class=\"'+prim+'\">'+fm.i18n('webfm')+'</div>');\n\t\t\t\thtml.push('<div class=\"'+sec+'\">'+fm.i18n('ver')+': '+fm.version+'</div>');\n\t\t\t\thtml.push('<div class=\"'+sec+'\">'+fm.i18n('protocolver')+': <span class=\"apiver\"></span></div>');\n\t\t\t\thtml.push('<div class=\"'+sec+'\">jQuery/jQuery UI: '+$().jquery+'/'+$.ui.version+'</div>');\n\n\t\t\t\thtml.push(sep);\n\t\t\t\t\n\t\t\t\thtml.push(linktpltgt[r](url, 'https://studio-42.github.io/elFinder/')[r](link, fm.i18n('homepage')));\n\t\t\t\thtml.push(linktpltgt[r](url, 'https://github.com/Studio-42/elFinder/wiki')[r](link, fm.i18n('docs')));\n\t\t\t\thtml.push(linktpltgt[r](url, 'https://github.com/Studio-42/elFinder')[r](link, fm.i18n('github')));\n\t\t\t\t//html.push(linktpltgt[r](url, 'http://twitter.com/elrte_elfinder')[r](link, fm.i18n('twitter')));\n\t\t\t\t\n\t\t\t\thtml.push(sep);\n\t\t\t\t\n\t\t\t\thtml.push('<div class=\"'+prim+'\">'+fm.i18n('team')+'</div>');\n\t\t\t\t\n\t\t\t\thtml.push(atpl[r](author, 'Dmitry \"dio\" Levashov &lt;dio@std42.ru&gt;')[r](work, fm.i18n('chiefdev')));\n\t\t\t\thtml.push(atpl[r](author, 'Naoki Sawada &lt;hypweb+elfinder@gmail.com&gt;')[r](work, fm.i18n('developer')));\n\t\t\t\thtml.push(atpl[r](author, 'Troex Nevelin &lt;troex@fury.scancode.ru&gt;')[r](work, fm.i18n('maintainer')));\n\t\t\t\thtml.push(atpl[r](author, 'Alexey Sukhotin &lt;strogg@yandex.ru&gt;')[r](work, fm.i18n('contributor')));\n\t\t\t\t\n\t\t\t\tif (fm.i18[fm.lang].translator) {\n\t\t\t\t\t$.each(fm.i18[fm.lang].translator.split(', '), function() {\n\t\t\t\t\t\thtml.push(atpl[r](author, $.trim(this))[r](work, fm.i18n('translator')+' ('+fm.i18[fm.lang].language+')'));\n\t\t\t\t\t});\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml.push(getTheme());\n\n\t\t\t\thtml.push(sep);\n\t\t\t\thtml.push('<div class=\"'+lic+'\">'+fm.i18n('icons')+': Pixelmixer, <a href=\"http://p.yusukekamiyamane.com\" target=\"_blank\">Fugue</a>, <a href=\"https://icons8.com\" target=\"_blank\">Icons8</a></div>');\n\t\t\t\t\n\t\t\t\thtml.push(sep);\n\t\t\t\thtml.push('<div class=\"'+lic+'\">Licence: 3-clauses BSD Licence</div>');\n\t\t\t\thtml.push('<div class=\"'+lic+'\">Copyright  2009-2020, Studio 42</div>');\n\t\t\t\thtml.push('<div class=\"'+lic+'\"> '+fm.i18n('dontforget')+' </div>');\n\t\t\t\thtml.push('</div>');\n\t\t\t},\n\t\t\tshortcuts = function() {\n\t\t\t\tvar sh = fm.shortcuts();\n\t\t\t\t// shortcuts tab\n\t\t\t\thtml.push('<div id=\"'+fm.namespace+'-help-shortcuts\" class=\"ui-tabs-panel ui-widget-content ui-corner-bottom\">');\n\t\t\t\t\n\t\t\t\tif (sh.length) {\n\t\t\t\t\thtml.push('<div class=\"ui-widget-content elfinder-help-shortcuts\">');\n\t\t\t\t\t$.each(sh, function(i, s) {\n\t\t\t\t\t\thtml.push(stpl.replace(/\\{pattern\\}/, s[0]).replace(/\\{descrip\\}/, s[1]));\n\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\thtml.push('</div>');\n\t\t\t\t} else {\n\t\t\t\t\thtml.push('<div class=\"elfinder-help-disabled\">'+fm.i18n('shortcutsof')+'</div>');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\thtml.push('</div>');\n\t\t\t\t\n\t\t\t},\n\t\t\thelp = function() {\n\t\t\t\t// help tab\n\t\t\t\thtml.push('<div id=\"'+fm.namespace+'-help-help\" class=\"ui-tabs-panel ui-widget-content ui-corner-bottom\">');\n\t\t\t\thtml.push('<a href=\"https://github.com/Studio-42/elFinder/wiki\" target=\"_blank\" class=\"elfinder-dont-panic\"><span>DON\\'T PANIC</span></a>');\n\t\t\t\thtml.push('</div>');\n\t\t\t\t// end help\n\t\t\t},\n\t\t\tuseInteg = false,\n\t\t\tintegrations = function() {\n\t\t\t\tuseInteg = true;\n\t\t\t\thtml.push('<div id=\"'+fm.namespace+'-help-integrations\" class=\"ui-tabs-panel ui-widget-content ui-corner-bottom\"/>');\n\t\t\t},\n\t\t\tuseDebug = false,\n\t\t\tdebug = function() {\n\t\t\t\tuseDebug = true;\n\t\t\t\t// debug tab\n\t\t\t\thtml.push('<div id=\"'+fm.namespace+'-help-debug\" class=\"ui-tabs-panel ui-widget-content ui-corner-bottom\">');\n\t\t\t\thtml.push('<div class=\"ui-widget-content elfinder-help-debug\"><ul></ul></div>');\n\t\t\t\thtml.push('</div>');\n\t\t\t\t// end debug\n\t\t\t},\n\t\t\tdebugRender = function() {\n\t\t\t\tvar render = function(elm, obj) {\n\t\t\t\t\t$.each(obj, function(k, v) {\n\t\t\t\t\t\telm.append($('<dt/>').text(k));\n\t\t\t\t\t\tif (typeof v === 'undefined') {\n\t\t\t\t\t\t\telm.append($('<dd/>').append($('<span/>').text('undfined')));\n\t\t\t\t\t\t} else if (typeof v === 'object' && !v) {\n\t\t\t\t\t\t\telm.append($('<dd/>').append($('<span/>').text('null')));\n\t\t\t\t\t\t} else if (typeof v === 'object' && ($.isPlainObject(v) || v.length)) {\n\t\t\t\t\t\t\telm.append( $('<dd/>').append(render($('<dl/>'), v)));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telm.append($('<dd/>').append($('<span/>').text((v && typeof v === 'object')? '[]' : (v? v : '\"\"'))));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn elm;\n\t\t\t\t},\n\t\t\t\tcnt = debugUL.children('li').length,\n\t\t\t\ttargetL, target, tabId,\n\t\t\t\tinfo, lastUL, lastDIV;\n\t\t\t\t\n\t\t\t\tif (self.debug.options || self.debug.debug) {\n\t\t\t\t\tif (cnt >= 5) {\n\t\t\t\t\t\tlastUL = debugUL.children('li:last');\n\t\t\t\t\t\tlastDIV = debugDIV.children('div:last');\n\t\t\t\t\t\tif (lastDIV.is(':hidden')) {\n\t\t\t\t\t\t\tlastUL.remove();\n\t\t\t\t\t\t\tlastDIV.remove();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlastUL.prev().remove();\n\t\t\t\t\t\t\tlastDIV.prev().remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\ttabId = fm.namespace + '-help-debug-' + (+new Date());\n\t\t\t\t\ttargetL = $('<li/>').html('<a href=\"'+selfUrl+'#'+tabId+'\">'+self.debug.debug.cmd+'</a>').prependTo(debugUL);\n\t\t\t\t\ttarget = $('<div id=\"'+tabId+'\"/>').data('debug', self.debug);\n\t\t\t\t\t\n\t\t\t\t\ttargetL.on('click.debugrender', function() {\n\t\t\t\t\t\tvar debug = target.data('debug');\n\t\t\t\t\t\ttarget.removeData('debug');\n\t\t\t\t\t\tif (debug) {\n\t\t\t\t\t\t\ttarget.hide();\n\t\t\t\t\t\t\tif (debug.debug) {\n\t\t\t\t\t\t\t\tinfo = $('<fieldset>').append($('<legend/>').text('debug'), render($('<dl/>'), debug.debug));\n\t\t\t\t\t\t\t\ttarget.append(info);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (debug.options) {\n\t\t\t\t\t\t\t\tinfo = $('<fieldset>').append($('<legend/>').text('options'), render($('<dl/>'), debug.options));\n\t\t\t\t\t\t\t\ttarget.append(info);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttarget.show();\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttargetL.off('click.debugrender');\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tdebugUL.after(target);\n\t\t\t\t\t\n\t\t\t\t\topened && debugDIV.tabs('refresh');\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontent = '',\n\t\t\topened, tabInteg, integDIV, tabDebug, debugDIV, debugUL;\n\t\t\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.state = -1;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'f1',\n\t\t\tdescription : this.title\n\t\t}];\n\t\t\n\t\tfm.bind('load', function() {\n\t\t\tvar parts = self.options.view || ['about', 'shortcuts', 'help', 'integrations', 'debug'],\n\t\t\t\ti, helpSource, tabBase, tabNav, tabs, delta;\n\t\t\t\n\t\t\t// remove 'preference' tab, it moved to command 'preference'\n\t\t\tif ((i = $.inArray('preference', parts)) !== -1) {\n\t\t\t\tparts.splice(i, 1);\n\t\t\t}\n\t\t\t\n\t\t\t// debug tab require jQueryUI Tabs Widget\n\t\t\tif (! $.fn.tabs) {\n\t\t\t\tif ((i = $.inArray(parts, 'debug')) !== -1) {\n\t\t\t\t\tparts.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t$.each(parts, function(i, title) {\n\t\t\t\thtml.push(tab[r](/\\{id\\}/g, title)[r](/\\{title\\}/, fm.i18n(title)));\n\t\t\t});\n\t\t\t\n\t\t\thtml.push('</ul>');\n\n\t\t\t$.inArray('about', parts) !== -1 && about();\n\t\t\t$.inArray('shortcuts', parts) !== -1 && shortcuts();\n\t\t\tif ($.inArray('help', parts) !== -1) {\n\t\t\t\thelpSource = fm.i18nBaseUrl + 'help/%s.html.js';\n\t\t\t\thelp();\n\t\t\t}\n\t\t\t$.inArray('integrations', parts) !== -1 && integrations();\n\t\t\t$.inArray('debug', parts) !== -1 && debug();\n\t\t\t\n\t\t\thtml.push('</div>');\n\t\t\tcontent = $(html.join(''));\n\t\t\t\n\t\t\tcontent.find('.ui-tabs-nav li')\n\t\t\t\t.on('mouseenter mouseleave', function(e) {\n\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type === 'mouseenter');\n\t\t\t\t})\n\t\t\t\t.on('focus blur', 'a', function(e) {\n\t\t\t\t\t$(e.delegateTarget).toggleClass('ui-state-focus', e.type === 'focusin');\n\t\t\t\t})\n\t\t\t\t.children()\n\t\t\t\t.on('click', function(e) {\n\t\t\t\t\tvar link = $(this);\n\t\t\t\t\t\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\n\t\t\t\t\tlink.parent().addClass(clTabActive).siblings().removeClass(clTabActive);\n\t\t\t\t\tcontent.children('.ui-tabs-panel').hide().filter(link.attr('href')).show();\n\t\t\t\t})\n\t\t\t\t.filter(':first').trigger('click');\n\t\t\t\n\t\t\tif (useInteg) {\n\t\t\t\ttabInteg = content.find('.elfinder-help-tab-integrations').hide();\n\t\t\t\tintegDIV = content.find('#'+fm.namespace+'-help-integrations').hide().append($('<div class=\"elfinder-help-integrations-desc\"/>').html(fm.i18n('integrationWith')));\n\t\t\t\tfm.bind('helpIntegration', function(e) {\n\t\t\t\t\tvar ul = integDIV.children('ul:first'),\n\t\t\t\t\t\tdata, elm, cmdUL, cmdCls;\n\t\t\t\t\tif (e.data) {\n\t\t\t\t\t\tif ($.isPlainObject(e.data)) {\n\t\t\t\t\t\t\tdata = Object.assign({\n\t\t\t\t\t\t\t\tlink: '',\n\t\t\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\t\t\tbanner: ''\n\t\t\t\t\t\t\t}, e.data);\n\t\t\t\t\t\t\tif (data.title || data.link) {\n\t\t\t\t\t\t\t\tif (!data.title) {\n\t\t\t\t\t\t\t\t\tdata.title = data.link;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (data.link) {\n\t\t\t\t\t\t\t\t\telm = $('<a/>').attr('href', data.link).attr('target', '_blank').text(data.title);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\telm = $('<span/>').text(data.title);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (data.banner) {\n\t\t\t\t\t\t\t\t\telm = $('<span/>').append($('<img/>').attr(data.banner), elm);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telm = $(e.data);\n\t\t\t\t\t\t\telm.filter('a').each(function() {\n\t\t\t\t\t\t\t\tvar tgt = $(this);\n\t\t\t\t\t\t\t\tif (!tgt.attr('target')) {\n\t\t\t\t\t\t\t\t\ttgt.attr('target', '_blank');;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (elm) {\n\t\t\t\t\t\t\ttabInteg.show();\n\t\t\t\t\t\t\tif (!ul.length) {\n\t\t\t\t\t\t\t\tul = $('<ul class=\"elfinder-help-integrations\"/>').appendTo(integDIV);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (data && data.cmd) {\n\t\t\t\t\t\t\t\tcmdCls = 'elfinder-help-integration-' + data.cmd;\n\t\t\t\t\t\t\t\tcmdUL = ul.find('ul.' + cmdCls);\n\t\t\t\t\t\t\t\tif (!cmdUL.length) {\n\t\t\t\t\t\t\t\t\tcmdUL = $('<ul class=\"'+cmdCls+'\"/>');\n\t\t\t\t\t\t\t\t\tul.append($('<li/>').append($('<span/>').html(fm.i18n('cmd'+data.cmd))).append(cmdUL));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telm = cmdUL.append($('<li/>').append(elm));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tul.append($('<li/>').append(elm));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).bind('themechange', function() {\n\t\t\t\t\tcontent.find('div.elfinder-help-term-theme').replaceWith(getTheme());\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// debug\n\t\t\tif (useDebug) {\n\t\t\t\ttabDebug = content.find('.elfinder-help-tab-debug').hide();\n\t\t\t\tdebugDIV = content.find('#'+fm.namespace+'-help-debug').children('div:first');\n\t\t\t\tdebugUL = debugDIV.children('ul:first').on('click', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t});\n\n\t\t\t\tself.debug = {};\n\t\t\n\t\t\t\tfm.bind('backenddebug', function(e) {\n\t\t\t\t\t// CAUTION: DO NOT TOUCH `e.data`\n\t\t\t\t\tif (useDebug && e.data && e.data.debug) {\n\t\t\t\t\t\tself.debug = { options : e.data.options, debug : Object.assign({ cmd : fm.currentReqCmd }, e.data.debug) };\n\t\t\t\t\t\tif (self.dialog) {\n\t\t\t\t\t\t\tdebugRender();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcontent.find('#'+fm.namespace+'-help-about').find('.apiver').text(fm.api);\n\t\t\tself.dialog = self.fmDialog(content, {\n\t\t\t\t\ttitle : self.title,\n\t\t\t\t\twidth : 530,\n\t\t\t\t\tmaxWidth: 'window',\n\t\t\t\t\tmaxHeight: 'window',\n\t\t\t\t\tautoOpen : false,\n\t\t\t\t\tdestroyOnClose : false,\n\t\t\t\t\tclose : function() {\n\t\t\t\t\t\tif (useDebug) {\n\t\t\t\t\t\t\ttabDebug.hide();\n\t\t\t\t\t\t\tdebugDIV.tabs('destroy');\n\t\t\t\t\t\t}\n\t\t\t\t\t\topened = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on('click', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t})\n\t\t\t\t.css({\n\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t});\n\t\t\t\n\t\t\ttabBase = self.dialog.children('.ui-tabs');\n\t\t\ttabNav = tabBase.children('.ui-tabs-nav:first');\n\t\t\ttabs = tabBase.children('.ui-tabs-panel');\n\t\t\tdelta = self.dialog.outerHeight(true) - self.dialog.height();\n\t\t\tself.dialog.closest('.ui-dialog').on('resize', function() {\n\t\t\t\ttabs.height(self.dialog.height() - delta - tabNav.outerHeight(true) - 20);\n\t\t\t});\n\t\t\t\n\t\t\tif (helpSource) {\n\t\t\t\tself.dialog.one('initContents', function() {\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: self.options.helpSource? self.options.helpSource : helpSource.replace('%s', fm.lang),\n\t\t\t\t\t\tdataType: 'html'\n\t\t\t\t\t}).done(function(source) {\n\t\t\t\t\t\t$('#'+fm.namespace+'-help-help').html(source);\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\turl: helpSource.replace('%s', 'en'),\n\t\t\t\t\t\t\tdataType: 'html'\n\t\t\t\t\t\t}).done(function(source) {\n\t\t\t\t\t\t\t$('#'+fm.namespace+'-help-help').html(source);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tself.state = 0;\n\n\t\t\tfm.trigger('helpBuilded', self.dialog);\n\t\t}).one('open', function() {\n\t\t\tvar debug = false;\n\t\t\tfm.one('backenddebug', function() {\n\t\t\t\tdebug =true;\n\t\t\t}).one('opendone', function() {\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tif (! debug && useDebug) {\n\t\t\t\t\t\tuseDebug = false;\n\t\t\t\t\t\ttabDebug.hide();\n\t\t\t\t\t\tdebugDIV.hide();\n\t\t\t\t\t\tdebugUL.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function(sel, opts) {\n\t\t\tvar tab = opts? opts.tab : void(0),\n\t\t\t\tdebugShow = function() {\n\t\t\t\t\tif (useDebug) {\n\t\t\t\t\t\tdebugDIV.tabs();\n\t\t\t\t\t\tdebugUL.find('a:first').trigger('click');\n\t\t\t\t\t\ttabDebug.show();\n\t\t\t\t\t\topened = true;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\tdebugShow();\n\t\t\tthis.dialog.trigger('initContents').elfinderdialog('open').find((tab? '.elfinder-help-tab-'+tab : '.ui-tabs-nav li') + ' a:first').trigger('click');\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/hidden',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"hidden\"\n\t * Always hidden command for uiCmdMap\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.hidden = function() {\n\t\t\"use strict\";\n\t\tthis.hidden = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.getstate = function() {\n\t\t\treturn -1;\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/hide',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"hide\".\n\t * folders/files to hide as personal setting.\n\t *\n\t * @type  elFinder.command\n\t * @author  Naoki Sawada\n\t */\n\telFinder.prototype.commands.hide = function() {\n\t\t\"use strict\";\n\n\t\tvar self = this,\n\t\t\tnameCache = {},\n\t\t\thideData, hideCnt, cMenuType, sOrigin;\n\n\t\tthis.syncTitleOnChange = true;\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern : 'ctrl+shift+dot',\n\t\t\tdescription : this.fm.i18n('toggleHidden')\n\t\t}];\n\n\t\tthis.init = function() {\n\t\t\tvar fm = this.fm;\n\t\t\t\n\t\t\thideData = fm.storage('hide') || {items: {}};\n\t\t\thideCnt = Object.keys(hideData.items).length;\n\n\t\t\tthis.title = fm.i18n(hideData.show? 'hideHidden' : 'showHidden');\n\t\t\tself.update(void(0), self.title);\n\t\t};\n\n\t\tthis.fm.bind('select contextmenucreate closecontextmenu', function(e, fm) {\n\t\t\tvar sel = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected();\n\t\t\tif (e.type === 'select' && e.data) {\n\t\t\t\tsOrigin = e.data.origin;\n\t\t\t} else if (e.type === 'contextmenucreate') {\n\t\t\t\tcMenuType = e.data.type;\n\t\t\t}\n\t\t\tif (!sel.length || (((e.type !== 'contextmenucreate' && sOrigin !== 'navbar') || cMenuType === 'cwd') && sel[0] === fm.cwd().hash)) {\n\t\t\t\tself.title = fm.i18n(hideData.show? 'hideHidden' : 'showHidden');\n\t\t\t} else {\n\t\t\t\tself.title = fm.i18n('cmdhide');\n\t\t\t}\n\t\t\tif (e.type !== 'closecontextmenu') {\n\t\t\t\tself.update(cMenuType === 'cwd'? (hideCnt? 0 : -1) : void(0), self.title);\n\t\t\t} else {\n\t\t\t\tcMenuType = '';\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.update(void(0), self.title);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.getstate = function(sel) {\n\t\t\treturn (this.fm.cookieEnabled && cMenuType !== 'cwd' && (sel || this.fm.selected()).length) || hideCnt? 0 : -1;\n\t\t};\n\n\t\tthis.exec = function(hashes, opts) {\n\t\t\tvar fm = this.fm,\n\t\t\t\tdfrd = $.Deferred()\n\t\t\t\t\t.done(function() {\n\t\t\t\t\t\tfm.trigger('hide', {items: items, opts: opts});\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tfm.error(error);\n\t\t\t\t\t}),\n\t\t\t\to = opts || {},\n\t\t\t\titems = o.targets? o.targets : (hashes || fm.selected()),\n\t\t\t\tadded = [],\n\t\t\t\tremoved = [],\n\t\t\t\tnotifyto, files, res;\n\n\t\t\thideData = fm.storage('hide') || {};\n\t\t\tif (!$.isPlainObject(hideData)) {\n\t\t\t\thideData = {};\n\t\t\t}\n\t\t\tif (!$.isPlainObject(hideData.items)) {\n\t\t\t\thideData.items = {};\n\t\t\t}\n\t\t\tif (opts._currentType === 'shortcut' || !items.length || (opts._currentType !== 'navbar' && sOrigin !=='navbar' && items[0] === fm.cwd().hash)) {\n\t\t\t\tif (hideData.show) {\n\t\t\t\t\to.hide = true;\n\t\t\t\t} else if (Object.keys(hideData.items).length) {\n\t\t\t\t\to.show = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (o.reset) {\n\t\t\t\to.show = true;\n\t\t\t\thideCnt = 0;\n\t\t\t}\n\t\t\tif (o.show || o.hide) {\n\t\t\t\tif (o.show) {\n\t\t\t\t\thideData.show = true;\n\t\t\t\t} else {\n\t\t\t\t\tdelete hideData.show;\n\t\t\t\t}\n\t\t\t\tif (o.show) {\n\t\t\t\t\tfm.storage('hide', o.reset? null : hideData);\n\t\t\t\t\tself.title = fm.i18n('hideHidden');\n\t\t\t\t\tself.update(o.reset? -1 : void(0), self.title);\n\t\t\t\t\t$.each(hideData.items, function(h) {\n\t\t\t\t\t\tvar f = fm.file(h, true);\n\t\t\t\t\t\tif (f && (fm.searchStatus.state || !f.phash || fm.file(f.phash))) {\n\t\t\t\t\t\t\tadded.push(f);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (added.length) {\n\t\t\t\t\t\tfm.updateCache({added: added});\n\t\t\t\t\t\tfm.add({added: added});\n\t\t\t\t\t}\n\t\t\t\t\tif (o.reset) {\n\t\t\t\t\t\thideData = {items: {}};\n\t\t\t\t\t}\n\t\t\t\t\treturn dfrd.resolve();\n\t\t\t\t}\n\t\t\t\titems = Object.keys(hideData.items);\n\t\t\t}\n\n\t\t\tif (items.length) {\n\t\t\t\t$.each(items, function(i, h) {\n\t\t\t\t\tvar f;\n\t\t\t\t\tif (!hideData.items[h]) {\n\t\t\t\t\t\tf = fm.file(h);\n\t\t\t\t\t\tif (f) {\n\t\t\t\t\t\t\tnameCache[h] = f.i18 || f.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thideData.items[h] = nameCache[h]? nameCache[h] : h;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thideCnt = Object.keys(hideData.items).length;\n\t\t\t\tfiles = this.files(items);\n\t\t\t\tfm.storage('hide', hideData);\n\t\t\t\tfm.remove({removed: items});\n\t\t\t\tif (hideData.show) {\n\t\t\t\t\tthis.exec(void(0), {hide: true});\n\t\t\t\t}\n\t\t\t\tif (!o.hide) {\n\t\t\t\t\tres = {};\n\t\t\t\t\tres.undo = {\n\t\t\t\t\t\tcmd : 'hide',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tvar nData = fm.storage('hide');\n\t\t\t\t\t\t\tif (nData) {\n\t\t\t\t\t\t\t\t$.each(items, function(i, h) {\n\t\t\t\t\t\t\t\t\tdelete nData.items[h];\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\thideCnt = Object.keys(nData.items).length;\n\t\t\t\t\t\t\t\tfm.storage('hide', nData);\n\t\t\t\t\t\t\t\tfm.trigger('hide', {items: items, opts: {}});\n\t\t\t\t\t\t\t\tself.update(hideCnt? 0 : -1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.updateCache({added: files});\n\t\t\t\t\t\t\tfm.add({added: files});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tres.redo = {\n\t\t\t\t\t\tcmd : 'hide',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\treturn fm.exec('hide', void(0), {targets: items});\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn dfrd.state() == 'rejected' ? dfrd : dfrd.resolve(res);\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/home',[\n\t\"../elFinder\"\n],function(elFinder){\n\t(elFinder.prototype.commands.home = function() {\n\t\t\"use strict\";\n\t\tthis.title = 'Home';\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+home ctrl+shift+up',\n\t\t\tdescription : 'Home'\n\t\t}];\n\t\t\n\t\tthis.getstate = function() {\n\t\t\tvar root = this.fm.root(),\n\t\t\t\tcwd  = this.fm.cwd().hash;\n\t\t\t\t\n\t\t\treturn root && cwd && root != cwd ? 0: -1;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\treturn this.fm.exec('open', this.fm.root());\n\t\t};\n\t\t\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/info',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"info\". \n\t * Display dialog with file properties.\n\t *\n\t * @author Dmitry (dio) Levashov, dio@std42.ru\n\t **/\n\t(elFinder.prototype.commands.info = function() {\n\t\t\"use strict\";\n\t\tvar m   = 'msg',\n\t\t\tfm  = this.fm,\n\t\t\tspclass = 'elfinder-spinner',\n\t\t\tbtnclass = 'elfinder-info-button',\n\t\t\tmsg = {\n\t\t\t\tcalc     : fm.i18n('calc'),\n\t\t\t\tsize     : fm.i18n('size'),\n\t\t\t\tunknown  : fm.i18n('unknown'),\n\t\t\t\tpath     : fm.i18n('path'),\n\t\t\t\taliasfor : fm.i18n('aliasfor'),\n\t\t\t\tmodify   : fm.i18n('modify'),\n\t\t\t\tperms    : fm.i18n('perms'),\n\t\t\t\tlocked   : fm.i18n('locked'),\n\t\t\t\tdim      : fm.i18n('dim'),\n\t\t\t\tkind     : fm.i18n('kind'),\n\t\t\t\tfiles    : fm.i18n('files'),\n\t\t\t\tfolders  : fm.i18n('folders'),\n\t\t\t\troots    : fm.i18n('volumeRoots'),\n\t\t\t\titems    : fm.i18n('items'),\n\t\t\t\tyes      : fm.i18n('yes'),\n\t\t\t\tno       : fm.i18n('no'),\n\t\t\t\tlink     : fm.i18n('link'),\n\t\t\t\towner    : fm.i18n('owner'),\n\t\t\t\tgroup    : fm.i18n('group'),\n\t\t\t\tperm     : fm.i18n('perm'),\n\t\t\t\tgetlink  : fm.i18n('getLink')\n\t\t\t},\n\t\t\tapplyZWSP = function(str, remove) {\n\t\t\t\tif (remove) {\n\t\t\t\t\treturn str.replace(/\\u200B/g, '');\n\t\t\t\t} else {\n\t\t\t\t\treturn str.replace(/(\\/|\\\\)/g, \"$1\\u200B\");\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\tthis.items = ['size', 'aliasfor', 'path', 'link', 'dim', 'modify', 'perms', 'locked', 'owner', 'group', 'perm'];\n\t\tif (this.options.custom && Object.keys(this.options.custom).length) {\n\t\t\t$.each(this.options.custom, function(name, details) {\n\t\t\t\tdetails.label && this.items.push(details.label);\n\t\t\t});\n\t\t}\n\n\t\tthis.tpl = {\n\t\t\tmain       : '<div class=\"ui-helper-clearfix elfinder-info-title {dirclass}\"><span class=\"elfinder-cwd-icon {class} ui-corner-all\"{style}/>{title}</div><table class=\"elfinder-info-tb\">{content}</table>',\n\t\t\titemTitle  : '<strong>{name}</strong><span class=\"elfinder-info-kind\">{kind}</span>',\n\t\t\tgroupTitle : '<strong>{items}: {num}</strong>',\n\t\t\trow        : '<tr><td class=\"elfinder-info-label\">{label} : </td><td class=\"{class}\">{value}</td></tr>',\n\t\t\tspinner    : '<span>{text}</span> <span class=\"'+spclass+' '+spclass+'-{name}\"/>'\n\t\t};\n\t\t\n\t\tthis.alwaysEnabled = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+i'\n\t\t}];\n\t\t\n\t\tthis.init = function() {\n\t\t\t$.each(msg, function(k, v) {\n\t\t\t\tmsg[k] = fm.i18n(v);\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar files   = this.files(hashes);\n\t\t\tif (! files.length) {\n\t\t\t\tfiles   = this.files([ this.fm.cwd().hash ]);\n\t\t\t}\n\t\t\tvar self    = this,\n\t\t\t\tfm      = this.fm,\n\t\t\t\to       = this.options,\n\t\t\t\ttpl     = this.tpl,\n\t\t\t\trow     = tpl.row,\n\t\t\t\tcnt     = files.length,\n\t\t\t\tcontent = [],\n\t\t\t\tview    = tpl.main,\n\t\t\t\tl       = '{label}',\n\t\t\t\tv       = '{value}',\n\t\t\t\treqs    = [],\n\t\t\t\treqDfrd = null,\n\t\t\t\topts    = {\n\t\t\t\t\ttitle : fm.i18n('selectionInfo'),\n\t\t\t\t\twidth : 'auto',\n\t\t\t\t\tclose : function() {\n\t\t\t\t\t\t$(this).elfinderdialog('destroy');\n\t\t\t\t\t\tif (reqDfrd && reqDfrd.state() === 'pending') {\n\t\t\t\t\t\t\treqDfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.grep(reqs, function(r) {\n\t\t\t\t\t\t\tr && r.state() === 'pending' && r.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcount = [],\n\t\t\t\treplSpinner = function(msg, name, className) {\n\t\t\t\t\tdialog.find('.'+spclass+'-'+name).parent().html(msg).addClass(className || '');\n\t\t\t\t},\n\t\t\t\tid = fm.namespace+'-info-'+$.map(files, function(f) { return f.hash; }).join('-'),\n\t\t\t\tdialog = fm.getUI().find('#'+id),\n\t\t\t\tcustomActions = [],\n\t\t\t\tstyle = '',\n\t\t\t\thashClass = 'elfinder-font-mono elfinder-info-hash',\n\t\t\t\tgetHashAlgorisms = [],\n\t\t\t\tndialog  = fm.ui.notify,\n\t\t\t\tsize, tmb, file, title, dcnt, rdcnt, path, hideItems, hashProg;\n\n\t\t\tif (ndialog.is(':hidden') && ndialog.children('.elfinder-notify').length) {\n\t\t\t\tndialog.elfinderdialog('open').height('auto');\n\t\t\t}\n\n\t\t\tif (!cnt) {\n\t\t\t\treturn $.Deferred().reject();\n\t\t\t}\n\t\t\t\t\n\t\t\tif (dialog.length) {\n\t\t\t\tdialog.elfinderdialog('toTop');\n\t\t\t\treturn $.Deferred().resolve();\n\t\t\t}\n\t\t\t\n\t\t\thideItems = fm.storage('infohides') || fm.arrayFlip(o.hideItems, true);\n\n\t\t\tif (cnt === 1) {\n\t\t\t\tfile = files[0];\n\t\t\t\t\n\t\t\t\tif (file.icon) {\n\t\t\t\t\tstyle = ' '+fm.getIconStyle(file);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tview  = view.replace('{dirclass}', file.csscls? fm.escape(file.csscls) : '').replace('{class}', fm.mime2class(file.mime)).replace('{style}', style);\n\t\t\t\ttitle = tpl.itemTitle.replace('{name}', fm.escape(file.i18 || file.name)).replace('{kind}', '<span title=\"'+fm.escape(file.mime)+'\">'+fm.mime2kind(file)+'</span>');\n\n\t\t\t\ttmb = fm.tmb(file);\n\t\t\t\t\n\t\t\t\tif (!file.read) {\n\t\t\t\t\tsize = msg.unknown;\n\t\t\t\t} else if (file.mime != 'directory' || file.alias) {\n\t\t\t\t\tsize = fm.formatSize(file.size);\n\t\t\t\t} else {\n\t\t\t\t\tsize = tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'size');\n\t\t\t\t\tcount.push(file.hash);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t!hideItems.size && content.push(row.replace(l, msg.size).replace(v, size));\n\t\t\t\t!hideItems.aleasfor && file.alias && content.push(row.replace(l, msg.aliasfor).replace(v, file.alias));\n\t\t\t\tif (!hideItems.path) {\n\t\t\t\t\tif (path = fm.path(file.hash, true)) {\n\t\t\t\t\t\tcontent.push(row.replace(l, msg.path).replace(v, applyZWSP(fm.escape(path))).replace('{class}', 'elfinder-info-path'));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontent.push(row.replace(l, msg.path).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'path')).replace('{class}', 'elfinder-info-path'));\n\t\t\t\t\t\treqs.push(fm.path(file.hash, true, {notify: null})\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\treplSpinner(msg.unknown, 'path');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(path) {\n\t\t\t\t\t\t\treplSpinner(applyZWSP(path), 'path');\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!hideItems.link && file.read) {\n\t\t\t\t\tvar href,\n\t\t\t\t\tname_esc = fm.escape(file.name);\n\t\t\t\t\tif (file.url == '1') {\n\t\t\t\t\t\tcontent.push(row.replace(l, msg.link).replace(v, '<button class=\"'+btnclass+' '+spclass+'-url\">'+msg.getlink+'</button>'));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (file.url) {\n\t\t\t\t\t\t\thref = file.url;\n\t\t\t\t\t\t} else if (file.mime === 'directory') {\n\t\t\t\t\t\t\tif (o.nullUrlDirLinkSelf && file.url === null) {\n\t\t\t\t\t\t\t\tvar loc = window.location;\n\t\t\t\t\t\t\t\thref = loc.pathname + loc.search + '#elf_' + file.hash;\n\t\t\t\t\t\t\t} else if (file.url !== '' && fm.option('url', (!fm.isRoot(file) && file.phash) || file.hash)) {\n\t\t\t\t\t\t\t\thref = fm.url(file.hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thref = fm.url(file.hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t\thref && content.push(row.replace(l, msg.link).replace(v,  '<a href=\"'+href+'\" target=\"_blank\">'+name_esc+'</a>'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (!hideItems.dim) {\n\t\t\t\t\tif (file.dim) { // old api\n\t\t\t\t\t\tcontent.push(row.replace(l, msg.dim).replace(v, file.dim));\n\t\t\t\t\t} else if (file.mime.indexOf('image') !== -1) {\n\t\t\t\t\t\tif (file.width && file.height) {\n\t\t\t\t\t\t\tcontent.push(row.replace(l, msg.dim).replace(v, file.width+'x'+file.height));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontent.push(row.replace(l, msg.dim).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'dim')));\n\t\t\t\t\t\t\treqs.push(fm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'dim', target : file.hash},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\treplSpinner(msg.unknown, 'dim');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\treplSpinner(data.dim || msg.unknown, 'dim');\n\t\t\t\t\t\t\t\tif (data.dim) {\n\t\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\n\t\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\t\trfile.width = dim[0];\n\t\t\t\t\t\t\t\t\trfile.height = dim[1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t!hideItems.modify && content.push(row.replace(l, msg.modify).replace(v, fm.formatDate(file)));\n\t\t\t\t!hideItems.perms && content.push(row.replace(l, msg.perms).replace(v, fm.formatPermissions(file)));\n\t\t\t\t!hideItems.locked && content.push(row.replace(l, msg.locked).replace(v, file.locked ? msg.yes : msg.no));\n\t\t\t\t!hideItems.owner && file.owner && content.push(row.replace(l, msg.owner).replace(v, file.owner));\n\t\t\t\t!hideItems.group && file.group && content.push(row.replace(l, msg.group).replace(v, file.group));\n\t\t\t\t!hideItems.perm && file.perm && content.push(row.replace(l, msg.perm).replace(v, fm.formatFileMode(file.perm)));\n\t\t\t\t\n\t\t\t\t// Get MD5, SHA hashes\n\t\t\t\tif (window.ArrayBuffer && (fm.options.cdns.sparkmd5 || fm.options.cdns.jssha) && file.mime !== 'directory' && file.size > 0 && (!o.showHashMaxsize || file.size <= o.showHashMaxsize)) {\n\t\t\t\t\tgetHashAlgorisms = [];\n\t\t\t\t\t$.each(fm.storage('hashchekcer') || o.showHashAlgorisms, function(i, n) {\n\t\t\t\t\t\tif (!file[n]) {\n\t\t\t\t\t\t\tcontent.push(row.replace(l, fm.i18n(n)).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', n)));\n\t\t\t\t\t\t\tgetHashAlgorisms.push(n);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontent.push(row.replace(l, fm.i18n(n)).replace(v, file[n]).replace('{class}', hashClass));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (getHashAlgorisms.length) {\n\t\t\t\t\t\thashProg = $('<div class=\"elfinder-quicklook-info-progress\"/>');\n\t\t\t\t\t\treqs.push(\n\t\t\t\t\t\t\tfm.getContentsHashes(file.hash, getHashAlgorisms, o.showHashOpts, { progressBar : hashProg }).progress(function(hashes) {\n\t\t\t\t\t\t\t\t$.each(getHashAlgorisms, function(i, n) {\n\t\t\t\t\t\t\t\t\tif (hashes[n]) {\n\t\t\t\t\t\t\t\t\t\treplSpinner(hashes[n], n, hashClass);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\t$.each(getHashAlgorisms, function(i, n) {\n\t\t\t\t\t\t\t\t\treplSpinner(msg.unknown, n);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Add custom info fields\n\t\t\t\tif (o.custom) {\n\t\t\t\t\t$.each(o.custom, function(name, details) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t  !hideItems[details.label]\n\t\t\t\t\t\t    &&\n\t\t\t\t\t\t  (!details.mimes || $.grep(details.mimes, function(m){return (file.mime === m || file.mime.indexOf(m+'/') === 0)? true : false;}).length)\n\t\t\t\t\t\t    &&\n\t\t\t\t\t\t  (!details.hashRegex || file.hash.match(details.hashRegex))\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Add to the content\n\t\t\t\t\t\t\tcontent.push(row.replace(l, fm.i18n(details.label)).replace(v , details.tpl.replace('{id}', id)));\n\t\t\t\t\t\t\t// Register the action\n\t\t\t\t\t\t\tif (details.action && (typeof details.action == 'function')) {\n\t\t\t\t\t\t\t\tcustomActions.push(details.action);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tview  = view.replace('{class}', 'elfinder-cwd-icon-group');\n\t\t\t\ttitle = tpl.groupTitle.replace('{items}', msg.items).replace('{num}', cnt);\n\t\t\t\tdcnt  = $.grep(files, function(f) { return f.mime == 'directory' ? true : false ; }).length;\n\t\t\t\tif (!dcnt) {\n\t\t\t\t\tsize = 0;\n\t\t\t\t\t$.each(files, function(h, f) { \n\t\t\t\t\t\tvar s = parseInt(f.size);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (s >= 0 && size >= 0) {\n\t\t\t\t\t\t\tsize += s;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsize = 'unknown';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tcontent.push(row.replace(l, msg.kind).replace(v, msg.files));\n\t\t\t\t\t!hideItems.size && content.push(row.replace(l, msg.size).replace(v, fm.formatSize(size)));\n\t\t\t\t} else {\n\t\t\t\t\trdcnt = $.grep(files, function(f) { return f.mime === 'directory' && (! f.phash || f.isroot)? true : false ; }).length;\n\t\t\t\t\tdcnt -= rdcnt;\n\t\t\t\t\tcontent.push(row.replace(l, msg.kind).replace(v, (rdcnt === cnt || dcnt === cnt)? msg[rdcnt? 'roots' : 'folders'] : $.map({roots: rdcnt, folders: dcnt, files: cnt - rdcnt - dcnt}, function(c, t) { return c? msg[t]+' '+c : null; }).join(', ')));\n\t\t\t\t\t!hideItems.size && content.push(row.replace(l, msg.size).replace(v, tpl.spinner.replace('{text}', msg.calc).replace('{name}', 'size')));\n\t\t\t\t\tcount = $.map(files, function(f) { return f.hash; });\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tview = view.replace('{title}', title).replace('{content}', content.join('').replace(/{class}/g, ''));\n\t\t\t\n\t\t\tdialog = self.fmDialog(view, opts);\n\t\t\tdialog.attr('id', id).one('mousedown', '.elfinder-info-path', function() {\n\t\t\t\t$(this).html(applyZWSP($(this).html(), true));\n\t\t\t});\n\n\t\t\tif (getHashAlgorisms.length) {\n\t\t\t\thashProg.appendTo(dialog.find('.'+spclass+'-'+getHashAlgorisms[0]).parent());\n\t\t\t}\n\n\t\t\tif (fm.UA.Mobile && $.fn.tooltip) {\n\t\t\t\tdialog.children('.ui-dialog-content .elfinder-info-title').tooltip({\n\t\t\t\t\tclasses: {\n\t\t\t\t\t\t'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'\n\t\t\t\t\t},\n\t\t\t\t\ttooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',\n\t\t\t\t\ttrack: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (file && file.url == '1') {\n\t\t\t\tdialog.on('click', '.'+spclass+'-url', function(){\n\t\t\t\t\t$(this).parent().html(tpl.spinner.replace('{text}', fm.i18n('ntfurl')).replace('{name}', 'url'));\n\t\t\t\t\tfm.request({\n\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\treplSpinner(name_esc, 'url');\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\treplSpinner('<a href=\"'+data.url+'\" target=\"_blank\">'+name_esc+'</a>' || name_esc, 'url');\n\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\trfile.url = data.url;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treplSpinner(name_esc, 'url');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// load thumbnail\n\t\t\tif (tmb) {\n\t\t\t\t$('<img/>')\n\t\t\t\t\t.on('load', function() { dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\"); })\n\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t}\n\t\t\t\n\t\t\t// send request to count total size\n\t\t\tif (count.length) {\n\t\t\t\treqDfrd = fm.getSize(count).done(function(data) {\n\t\t\t\t\treplSpinner(data.formated, 'size');\n\t\t\t\t}).fail(function() {\n\t\t\t\t\treplSpinner(msg.unknown, 'size');\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// call custom actions\n\t\t\tif (customActions.length) {\n\t\t\t\t$.each(customActions, function(i, action) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\taction(file, fm, dialog);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tfm.debug('error', e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\t\t\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/mkdir',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"mkdir\"\n\t * Create new folder\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.mkdir = function() {\n\t\t\"use strict\";\n\t\tvar fm   = this.fm,\n\t\t\tself = this,\n\t\t\tcurOrg;\n\t\t\n\t\tthis.value           = '';\n\t\tthis.disableOnSearch = true;\n\t\tthis.updateOnSelect  = false;\n\t\tthis.syncTitleOnChange = true;\n\t\tthis.mime            = 'directory';\n\t\tthis.prefix          = 'untitled folder';\n\t\tthis.exec            = function(select, cOpts) {\n\t\t\tvar onCwd;\n\n\t\t\tif (select && select.length && cOpts && cOpts._currentType && cOpts._currentType === 'navbar') {\n\t\t\t\tthis.origin = cOpts._currentType;\n\t\t\t\tthis.data = {\n\t\t\t\t\ttarget: select[0]\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tonCwd = fm.cwd().hash === select[0];\n\t\t\t\tthis.origin = curOrg && !onCwd? curOrg : 'cwd';\n\t\t\t\tdelete this.data;\n\t\t\t}\n\t\t\tif (! select && ! this.options.intoNewFolderToolbtn) {\n\t\t\t\tfm.getUI('cwd').trigger('unselectall');\n\t\t\t}\n\t\t\t//this.move = (!onCwd && curOrg !== 'navbar' && fm.selected().length)? true : false;\n\t\t\tthis.move = this.value === fm.i18n('cmdmkdirin');\n\t\t\treturn $.proxy(fm.res('mixin', 'make'), self)();\n\t\t};\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+shift+n'\n\t\t}];\n\n\t\tthis.init = function() {\n\t\t\tif (this.options.intoNewFolderToolbtn) {\n\t\t\t\tthis.syncTitleOnChange = true;\n\t\t\t}\n\t\t};\n\t\t\n\t\tfm.bind('select contextmenucreate closecontextmenu', function(e) {\n\t\t\tvar sel = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected();\n\t\t\t\n\t\t\tself.className = 'mkdir';\n\t\t\tcurOrg = e.data && sel.length? (e.data.origin || e.data.type || '') : '';\n\t\t\tif (!self.options.intoNewFolderToolbtn && curOrg === '') {\n\t\t\t\tcurOrg = 'cwd';\n\t\t\t}\n\t\t\tif (sel.length && curOrg !== 'navbar' && curOrg !== 'cwd' && fm.cwd().hash !== sel[0]) {\n\t\t\t\tself.title = fm.i18n('cmdmkdirin');\n\t\t\t\tself.className += ' elfinder-button-icon-mkdirin';\n\t\t\t} else {\n\t\t\t\tself.title = fm.i18n('cmdmkdir');\n\t\t\t}\n\t\t\tif (e.type !== 'closecontextmenu') {\n\t\t\t\tself.update(void(0), self.title);\n\t\t\t} else {\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.update(void(0), self.title);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar cwd = fm.cwd(),\n\t\t\t\tsel = (curOrg === 'navbar' || (select && select[0] !== cwd.hash))? this.files(select || fm.selected()) : [],\n\t\t\t\tcnt = sel.length;\n\n\t\t\tif (curOrg === 'navbar') {\n\t\t\t\treturn cnt && sel[0].write && sel[0].read? 0 : -1;  \n\t\t\t} else {\n\t\t\t\treturn cwd.write && (!cnt || $.grep(sel, function(f) { return f.read && ! f.locked? true : false; }).length == cnt)? 0 : -1;\n\t\t\t}\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/mkfile',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"mkfile\"\n\t * Create new empty file\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.mkfile = function() {\n\t\t\"use strict\";\n\t\tvar self = this;\n\n\t\tthis.disableOnSearch = true;\n\t\tthis.updateOnSelect  = false;\n\t\tthis.mime            = 'text/plain';\n\t\tthis.prefix          = 'untitled file.txt';\n\t\tthis.variants        = [];\n\n\t\tthis.getTypeName = function(mime, type) {\n\t\t\tvar fm = self.fm,\n\t\t\t\tname;\n\t\t\tif (name = fm.messages['kind' + fm.kinds[mime]]) {\n\t\t\t\tname = fm.i18n(['extentiontype', type.toUpperCase(), name]);\n\t\t\t} else {\n\t\t\t\tname = fm.i18n(['extentionfile', type.toUpperCase()]);\n\t\t\t}\n\t\t\treturn name;\n\t\t};\n\n\t\tthis.fm.bind('open reload canMakeEmptyFile', function() {\n\t\t\tvar fm = self.fm,\n\t\t\t\thides = fm.getCommand('edit').getMkfileHides();\n\t\t\tself.variants = [];\n\t\t\tif (fm.mimesCanMakeEmpty) {\n\t\t\t\t$.each(fm.mimesCanMakeEmpty, function(mime, type) {\n\t\t\t\t\ttype && !hides[mime] && fm.uploadMimeCheck(mime) && self.variants.push([mime, self.getTypeName(mime, type)]);\n\t\t\t\t});\n\t\t\t}\n\t\t\tself.change();\n\t\t});\n\n\t\tthis.getstate = function() {\n\t\t\treturn this.fm.cwd().write ? 0 : -1;\n\t\t};\n\n\t\tthis.exec = function(_dum, mime) {\n\t\t\tvar fm = self.fm,\n\t\t\t\ttype, err;\n\t\t\tif (type = fm.mimesCanMakeEmpty[mime]) {\n\t\t\t\tif (fm.uploadMimeCheck(mime)) {\n\t\t\t\t\tthis.mime = mime;\n\t\t\t\t\tthis.prefix = fm.i18n(['untitled file', type]);\n\t\t\t\t\treturn $.proxy(fm.res('mixin', 'make'), self)();\n\t\t\t\t}\n\t\t\t\terr = ['errMkfile', self.getTypeName(mime, type)];\n\t\t\t}\n\t\t\treturn $.Deferred().reject(err);\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/netmount',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"netmount\"\n\t * Mount network volume with user credentials.\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.netmount = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\thasMenus = false,\n\t\t\tcontent;\n\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\n\t\tthis.drivers = [];\n\t\t\n\t\tthis.handlers = {\n\t\t\tload : function() {\n\t\t\t\tvar fm = self.fm;\n\t\t\t\tif (fm.cookieEnabled) {\n\t\t\t\t\tfm.one('open', function() {\n\t\t\t\t\t\tself.drivers = fm.netDrivers;\n\t\t\t\t\t\tif (self.drivers.length) {\n\t\t\t\t\t\t\t$.each(self.drivers, function() {\n\t\t\t\t\t\t\t\tvar d = self.options[this];\n\t\t\t\t\t\t\t\tif (d) {\n\t\t\t\t\t\t\t\t\thasMenus = true;\n\t\t\t\t\t\t\t\t\tif (d.integrateInfo) {\n\t\t\t\t\t\t\t\t\t\tfm.trigger('helpIntegration', Object.assign({cmd: 'netmount'}, d.integrateInfo));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.getstate = function() {\n\t\t\treturn hasMenus ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar fm = self.fm,\n\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\to = self.options,\n\t\t\t\tcreate = function() {\n\t\t\t\t\tvar winFocus = function() {\n\t\t\t\t\t\t\tinputs.protocol.trigger('change', 'winfocus');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\tprotocol : $('<select/>')\n\t\t\t\t\t\t\t.on('change', function(e, data){\n\t\t\t\t\t\t\t\tvar protocol = this.value;\n\t\t\t\t\t\t\t\tcontent.find('.elfinder-netmount-tr').hide();\n\t\t\t\t\t\t\t\tcontent.find('.elfinder-netmount-tr-'+protocol).show();\n\t\t\t\t\t\t\t\tdialogNode && dialogNode.children('.ui-dialog-buttonpane:first').find('button').show();\n\t\t\t\t\t\t\t\tif (typeof o[protocol].select == 'function') {\n\t\t\t\t\t\t\t\t\to[protocol].select(fm, e, data);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.addClass('ui-corner-all')\n\t\t\t\t\t\t},\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\ttitle          : fm.i18n('netMountDialogTitle'),\n\t\t\t\t\t\t\tresizable      : true,\n\t\t\t\t\t\t\tmodal          : true,\n\t\t\t\t\t\t\tdestroyOnClose : false,\n\t\t\t\t\t\t\topen           : function() {\n\t\t\t\t\t\t\t\t$(window).on('focus.'+fm.namespace, winFocus);\n\t\t\t\t\t\t\t\tinputs.protocol.trigger('change');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tclose          : function() { \n\t\t\t\t\t\t\t\tdfrd.state() == 'pending' && dfrd.reject();\n\t\t\t\t\t\t\t\t$(window).off('focus.'+fm.namespace, winFocus);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbuttons        : {}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdoMount = function() {\n\t\t\t\t\t\t\tvar protocol = inputs.protocol.val(),\n\t\t\t\t\t\t\t\tdata = {cmd : 'netmount', protocol: protocol},\n\t\t\t\t\t\t\t\tcur = o[protocol],\n\t\t\t\t\t\t\t\tmnt2res;\n\t\t\t\t\t\t\t$.each(content.find('input.elfinder-netmount-inputs-'+protocol), function(name, input) {\n\t\t\t\t\t\t\t\tvar val, elm;\n\t\t\t\t\t\t\t\telm = $(input);\n\t\t\t\t\t\t\t\tif (elm.is(':radio,:checkbox')) {\n\t\t\t\t\t\t\t\t\tif (elm.is(':checked')) {\n\t\t\t\t\t\t\t\t\t\tval = $.trim(elm.val());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tval = $.trim(elm.val());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (val) {\n\t\t\t\t\t\t\t\t\tdata[input.name] = val;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!data.host) {\n\t\t\t\t\t\t\t\treturn fm.trigger('error', {error : 'errNetMountHostReq', opts : {modal: true}});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.mnt2res) {\n\t\t\t\t\t\t\t\tmnt2res = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfm.request({data : data, notify : {type : 'netmount', cnt : 1, hideCnt : true}})\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tvar pdir;\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tmnt2res && inputs.protocol.trigger('change', 'reset');\n\t\t\t\t\t\t\t\t\t\tif (data.added[0].phash) {\n\t\t\t\t\t\t\t\t\t\t\tif (pdir = fm.file(data.added[0].phash)) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (! pdir.dirs) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpdir.dirs = 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.change({ changed: [ pdir ] });\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfm.one('netmountdone', function() {\n\t\t\t\t\t\t\t\t\t\t\tfm.exec('open', data.added[0].hash);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\tif (cur.fail && typeof cur.fail == 'function') {\n\t\t\t\t\t\t\t\t\t\tcur.fail(fm, fm.parseError(error));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t});\n\t\t\n\t\t\t\t\t\t\tself.dialog.elfinderdialog('close');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tform = $('<form autocomplete=\"off\"/>').on('keydown', 'input', function(e) {\n\t\t\t\t\t\t\tvar comp = true,\n\t\t\t\t\t\t\t\tnext;\n\t\t\t\t\t\t\tif (e.keyCode === $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\t\t$.each(form.find('input:visible:not(.elfinder-input-optional)'), function() {\n\t\t\t\t\t\t\t\t\tif ($(this).val() === '') {\n\t\t\t\t\t\t\t\t\t\tcomp = false;\n\t\t\t\t\t\t\t\t\t\tnext = $(this);\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (comp) {\n\t\t\t\t\t\t\t\t\tdoMount();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tnext.trigger('focus');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\thidden  = $('<div/>'),\n\t\t\t\t\t\tdialog;\n\n\t\t\t\t\tcontent = $('<table class=\"elfinder-info-tb elfinder-netmount-tb\"/>')\n\t\t\t\t\t\t.append($('<tr/>').append($('<td>'+fm.i18n('protocol')+'</td>')).append($('<td/>').append(inputs.protocol)));\n\n\t\t\t\t\t$.each(self.drivers, function(i, protocol) {\n\t\t\t\t\t\tif (o[protocol]) {\n\t\t\t\t\t\t\tinputs.protocol.append('<option value=\"'+protocol+'\">'+fm.i18n(o[protocol].name || protocol)+'</option>');\n\t\t\t\t\t\t\t$.each(o[protocol].inputs, function(name, input) {\n\t\t\t\t\t\t\t\tinput.attr('name', name);\n\t\t\t\t\t\t\t\tif (input.attr('type') != 'hidden') {\n\t\t\t\t\t\t\t\t\tinput.addClass('ui-corner-all elfinder-netmount-inputs-'+protocol);\n\t\t\t\t\t\t\t\t\tcontent.append($('<tr/>').addClass('elfinder-netmount-tr elfinder-netmount-tr-'+protocol).append($('<td>'+fm.i18n(name)+'</td>')).append($('<td/>').append(input)));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tinput.addClass('elfinder-netmount-inputs-'+protocol);\n\t\t\t\t\t\t\t\t\thidden.append(input);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\to[protocol].protocol = inputs.protocol;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tcontent.append(hidden);\n\t\t\t\t\t\n\t\t\t\t\tcontent.find('.elfinder-netmount-tr').hide();\n\t\t\t\t\tcontent.find('.elfinder-netmount-tr-' + self.drivers[0]).show();\n\n\t\t\t\t\topts.buttons[fm.i18n('btnMount')] = doMount;\n\n\t\t\t\t\topts.buttons[fm.i18n('btnCancel')] = function() {\n\t\t\t\t\t\tself.dialog.elfinderdialog('close');\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tcontent.find('select,input').addClass('elfinder-tabstop');\n\t\t\t\t\t\n\t\t\t\t\tdialog = self.fmDialog(form.append(content), opts).ready(function() {\n\t\t\t\t\t\tinputs.protocol.trigger('change');\n\t\t\t\t\t\tdialog.elfinderdialog('posInit');\n\t\t\t\t\t});\n\t\t\t\t\tdialogNode = dialog.closest('.ui-dialog');\n\t\t\t\t\treturn dialog;\n\t\t\t\t},\n\t\t\t\tdialogNode;\n\t\t\t\n\t\t\tif (!self.dialog) {\n\t\t\t\tself.dialog = create();\n\t\t\t} else {\n\t\t\t\tself.dialog.elfinderdialog('open');\n\t\t\t}\n\n\t\t\treturn dfrd.promise();\n\t\t};\n\n\t\tself.fm.bind('netmount', function(e) {\n\t\t\tvar d = e.data || null,\n\t\t\t\to = self.options;\n\t\t\tif (d && d.protocol) {\n\t\t\t\tif (o[d.protocol] && typeof o[d.protocol].done == 'function') {\n\t\t\t\t\to[d.protocol].done(self.fm, d);\n\t\t\t\t\tcontent.find('select,input').addClass('elfinder-tabstop');\n\t\t\t\t\tself.dialog.elfinderdialog('tabstopsInit');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t};\n\n\telFinder.prototype.commands.netunmount = function() {\n\t\tvar self = this;\n\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\n\t\tthis.drivers = [];\n\t\t\n\t\tthis.handlers = {\n\t\t\tload : function() {\n\t\t\t\tthis.drivers = this.fm.netDrivers;\n\t\t\t}\n\t\t};\n\n\t\tthis.getstate = function(sel) {\n\t\t\tvar fm = this.fm,\n\t\t\t\tfile;\n\t\t\treturn !!sel && this.drivers.length && !this._disabled && (file = fm.file(sel[0])) && file.netkey ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar self   = this,\n\t\t\t\tfm     = this.fm,\n\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t}),\n\t\t\t\tdrive  = fm.file(hashes[0]),\n\t\t\t\tchildrenRoots = function(hash) {\n\t\t\t\t\tvar roots = [],\n\t\t\t\t\t\twork;\n\t\t\t\t\tif (fm.leafRoots) {\n\t\t\t\t\t\twork = [];\n\t\t\t\t\t\t$.each(fm.leafRoots, function(phash, hashes) {\n\t\t\t\t\t\t\tvar parents = fm.parents(phash),\n\t\t\t\t\t\t\t\tidx, deep;\n\t\t\t\t\t\t\tif ((idx = $.inArray(hash, parents)) !== -1) {\n\t\t\t\t\t\t\t\tidx = parents.length - idx;\n\t\t\t\t\t\t\t\t$.each(hashes, function(i, h) {\n\t\t\t\t\t\t\t\t\twork.push({i: idx, hash: h});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (work.length) {\n\t\t\t\t\t\t\twork.sort(function(a, b) { return a.i < b.i; });\n\t\t\t\t\t\t\t$.each(work, function(i, o) {\n\t\t\t\t\t\t\t\troots.push(o.hash);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn roots;\n\t\t\t\t};\n\n\t\t\tif (this._disabled) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\n\t\t\tif (dfrd.state() == 'pending') {\n\t\t\t\tfm.confirm({\n\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\ttext   : fm.i18n('confirmUnmount', drive.name),\n\t\t\t\t\taccept : {\n\t\t\t\t\t\tlabel    : 'btnUnmount',\n\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\tvar target =  drive.hash,\n\t\t\t\t\t\t\t\troots = childrenRoots(target),\n\t\t\t\t\t\t\t\trequests = [],\n\t\t\t\t\t\t\t\tremoved = [],\n\t\t\t\t\t\t\t\tdoUmount = function() {\n\t\t\t\t\t\t\t\t\t$.when(requests).done(function() {\n\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\tdata   : {cmd  : 'netmount', protocol : 'netunmount', host: drive.netkey, user : target, pass : 'dum'}, \n\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'netunmount', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\tdrive.volumeid && delete fm.volumeExpires[drive.volumeid];\n\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\t\t\tif (removed.length) {\n\t\t\t\t\t\t\t\t\t\t\tfm.remove({ removed: removed });\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (roots.length) {\n\t\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\t\ttitle : self.title,\n\t\t\t\t\t\t\t\t\ttext  : (function() {\n\t\t\t\t\t\t\t\t\t\tvar msgs = ['unmountChildren'];\n\t\t\t\t\t\t\t\t\t\t$.each(roots, function(i, hash) {\n\t\t\t\t\t\t\t\t\t\t\tmsgs.push([fm.file(hash).name]);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn msgs;\n\t\t\t\t\t\t\t\t\t})(),\n\t\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\t\tlabel : 'btnUnmount',\n\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t$.each(roots, function(i, hash) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar d = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\t\t\tif (d.netkey) {\n\t\t\t\t\t\t\t\t\t\t\t\t\trequests.push(fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata   : {cmd  : 'netmount', protocol : 'netunmount', host: d.netkey, user : d.hash, pass : 'dum'}, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'netunmount', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data.removed) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.volumeid && delete fm.volumeExpires[d.volumeid];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremoved = removed.concat(data.removed);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tdoUmount();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trequests = null;\n\t\t\t\t\t\t\t\tdoUmount();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcancel : {\n\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\tcallback : function() { dfrd.reject(); }\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/open',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"open\"\n\t * Enter folder or open files in new windows\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/  \n\t(elFinder.prototype.commands.open = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm,\n\t\t\tself = this;\n\t\tthis.alwaysEnabled = true;\n\t\tthis.noChangeDirOnRemovedCwd = true;\n\t\t\n\t\tthis._handlers = {\n\t\t\tdblclick : function(e) {\n\t\t\t\tvar arg = e.data && e.data.file? [ e.data.file ]: void(0);\n\t\t\t\tif (self.getstate(arg) === 0) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfm.exec('open', arg);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'select enable disable reload' : function(e) { this.update(e.type == 'disable' ? -1 : void(0));  }\n\t\t};\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+down numpad_enter'+(fm.OS != 'mac' && ' enter')\n\t\t}];\n\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\t\t\t\n\t\t\treturn cnt == 1 \n\t\t\t\t? (sel[0].read ? 0 : -1)\n\t\t\t\t: (cnt && !fm.UA.Mobile) ? ($.grep(sel, function(file) { return file.mime == 'directory' || ! file.read ? false : true;}).length == cnt ? 0 : -1) : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpts) {\n\t\t\tvar dfrd  = $.Deferred().fail(function(error) { error && fm.error(error); }),\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tcnt   = files.length,\n\t\t\t\tthash = (typeof cOpts == 'object')? cOpts.thash : false,\n\t\t\t\topts  = this.options,\n\t\t\t\tinto  = opts.into || 'window',\n\t\t\t\tfile, url, s, w, imgW, imgH, winW, winH, reg, link, html5dl, inline,\n\t\t\t\tselAct, cmd;\n\n\t\t\tif (!cnt && !thash) {\n\t\t\t\t{\n\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// open folder\n\t\t\tif (thash || (cnt == 1 && (file = files[0]) && file.mime == 'directory')) {\n\t\t\t\tif (!thash && file && !file.read) {\n\t\t\t\t\treturn dfrd.reject(['errOpen', file.name, 'errPerm']);\n\t\t\t\t} else {\n\t\t\t\t\tif (fm.keyState.ctrlKey && (fm.keyState.shiftKey || typeof fm.options.getFileCallback !== 'function')) {\n\t\t\t\t\t\tif (fm.getCommand('opennew')) {\n\t\t\t\t\t\t\treturn fm.exec('opennew', [thash? thash : file.hash]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\tdata   : {cmd  : 'open', target : thash || file.hash},\n\t\t\t\t\t\tnotify : {type : 'open', cnt : 1, hideCnt : true},\n\t\t\t\t\t\tsyncOnFail : true,\n\t\t\t\t\t\tlazy : false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfiles = $.grep(files, function(file) { return file.mime != 'directory' ? true : false; });\n\t\t\t\n\t\t\t// nothing to open or files and folders selected - do nothing\n\t\t\tif (cnt != files.length) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tvar doOpen = function() {\n\t\t\t\tvar openCB = function(url) {\n\t\t\t\t\t\tvar link = $('<a>').hide().appendTo($('body'));\n\t\t\t\t\t\tif (fm.UA.Mobile || !inline) {\n\t\t\t\t\t\t\tif (html5dl) {\n\t\t\t\t\t\t\t\tif (!inline) {\n\t\t\t\t\t\t\t\t\tlink.attr('download', file.name);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlink.attr('target', '_blank');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tlink.attr('href', url).get(0).click();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twnd = window.open(url);\n\t\t\t\t\t\t\t\tif (!wnd) {\n\t\t\t\t\t\t\t\t\treturn dfrd.reject('errPopup');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgetOnly = (typeof opts.method === 'string' && opts.method.toLowerCase() === 'get');\n\t\t\t\t\t\t\tif (!getOnly\n\t\t\t\t\t\t\t\t&& url.indexOf(fm.options.url) === 0\n\t\t\t\t\t\t\t\t&& fm.customData\n\t\t\t\t\t\t\t\t&& Object.keys(fm.customData).length\n\t\t\t\t\t\t\t\t// Since playback by POST request can not be done in Chrome, media allows GET request\n\t\t\t\t\t\t\t\t&& !file.mime.match(/^(?:video|audio)/)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// Send request as 'POST' method to hide custom data at location bar\n\t\t\t\t\t\t\t\turl = '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (into === 'window') {\n\t\t\t\t\t\t\t\t// set window size for image if set\n\t\t\t\t\t\t\t\timgW = winW = Math.round(2 * screen.availWidth / 3);\n\t\t\t\t\t\t\t\timgH = winH = Math.round(2 * screen.availHeight / 3);\n\t\t\t\t\t\t\t\tif (parseInt(file.width) && parseInt(file.height)) {\n\t\t\t\t\t\t\t\t\timgW = parseInt(file.width);\n\t\t\t\t\t\t\t\t\timgH = parseInt(file.height);\n\t\t\t\t\t\t\t\t} else if (file.dim) {\n\t\t\t\t\t\t\t\t\ts = file.dim.split('x');\n\t\t\t\t\t\t\t\t\timgW = parseInt(s[0]);\n\t\t\t\t\t\t\t\t\timgH = parseInt(s[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (winW >= imgW && winH >= imgH) {\n\t\t\t\t\t\t\t\t\twinW = imgW;\n\t\t\t\t\t\t\t\t\twinH = imgH;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ((imgW - winW) > (imgH - winH)) {\n\t\t\t\t\t\t\t\t\t\twinH = Math.round(imgH * (winW / imgW));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\twinW = Math.round(imgW * (winH / imgH));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tw = 'width='+winW+',height='+winH;\n\t\t\t\t\t\t\t\twnd = window.open(url, target, w + ',top=50,left=50,scrollbars=yes,resizable=yes,titlebar=no');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (into === 'tabs') {\n\t\t\t\t\t\t\t\t\ttarget = file.hash;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twnd = window.open('about:blank', target);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (!wnd) {\n\t\t\t\t\t\t\t\treturn dfrd.reject('errPopup');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (url === '') {\n\t\t\t\t\t\t\t\tvar form = document.createElement(\"form\");\n\t\t\t\t\t\t\t\tform.action = fm.options.url;\n\t\t\t\t\t\t\t\tform.method = 'POST';\n\t\t\t\t\t\t\t\tform.target = target;\n\t\t\t\t\t\t\t\tform.style.display = 'none';\n\t\t\t\t\t\t\t\tvar params = Object.assign({}, fm.customData, {\n\t\t\t\t\t\t\t\t\tcmd: 'file',\n\t\t\t\t\t\t\t\t\ttarget: file.hash,\n\t\t\t\t\t\t\t\t\t_t: file.ts || parseInt(+new Date()/1000)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$.each(params, function(key, val)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar input = document.createElement(\"input\");\n\t\t\t\t\t\t\t\t\tinput.name = key;\n\t\t\t\t\t\t\t\t\tinput.value = val;\n\t\t\t\t\t\t\t\t\tform.appendChild(input);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdocument.body.appendChild(form);\n\t\t\t\t\t\t\t\tform.submit();\n\t\t\t\t\t\t\t} else if (into !== 'window') {\n\t\t\t\t\t\t\t\twnd.location = url;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$(wnd).trigger('focus');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlink.remove();\n\t\t\t\t\t},\n\t\t\t\t\twnd, target, getOnly;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\treg = new RegExp(fm.option('dispInlineRegex'), 'i');\n\t\t\t\t} catch(e) {\n\t\t\t\t\treg = false;\n\t\t\t\t}\n\t\t\n\t\t\t\t// open files\n\t\t\t\thtml5dl  = (typeof $('<a>').get(0).download === 'string');\n\t\t\t\tcnt = files.length;\n\t\t\t\twhile (cnt--) {\n\t\t\t\t\ttarget = 'elf_open_window';\n\t\t\t\t\tfile = files[cnt];\n\t\t\t\t\t\n\t\t\t\t\tif (!file.read) {\n\t\t\t\t\t\treturn dfrd.reject(['errOpen', file.name, 'errPerm']);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tinline = (reg && file.mime.match(reg));\n\t\t\t\t\tfm.openUrl(file.hash, !inline, openCB);\n\t\t\t\t}\n\t\t\t\treturn dfrd.resolve(hashes);\n\t\t\t};\n\t\t\t\n\t\t\tif (cnt > 1) {\n\t\t\t\tfm.confirm({\n\t\t\t\t\ttitle: 'openMulti',\n\t\t\t\t\ttext : ['openMultiConfirm', cnt + ''],\n\t\t\t\t\taccept : {\n\t\t\t\t\t\tlabel : 'cmdopen',\n\t\t\t\t\t\tcallback : function() { doOpen(); }\n\t\t\t\t\t},\n\t\t\t\t\tcancel : {\n\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\tcallback : function() { \n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tbuttons : (fm.getCommand('zipdl') && fm.isCommandEnabled('zipdl', fm.cwd().hash))? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel : 'cmddownload',\n\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\tfm.exec('download', hashes);\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t] : []\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tselAct = fm.storage('selectAction') || opts.selectAction;\n\t\t\t\tif (selAct) {\n\t\t\t\t\t$.each(selAct.split('/'), function() {\n\t\t\t\t\t\tvar cmdName = this.valueOf();\n\t\t\t\t\t\tif (cmdName !== 'open' && (cmd = fm.getCommand(cmdName)) && cmd.enabled()) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcmd = null;\n\t\t\t\t\t});\n\t\t\t\t\tif (cmd) {\n\t\t\t\t\t\treturn fm.exec(cmd.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdoOpen();\n\t\t\t}\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/opendir',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"opendir\"\n\t * Enter parent folder\n\t *\n\t * @author Naoki Sawada\n\t **/  \n\telFinder.prototype.commands.opendir = function() {\n\t\t\"use strict\";\n\t\tthis.alwaysEnabled = true;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\tvar sel = this.fm.selected(),\n\t\t\t\tcnt = sel.length,\n\t\t\t\twz;\n\t\t\tif (cnt !== 1) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\twz = this.fm.getUI('workzone');\n\t\t\treturn wz.hasClass('elfinder-search-result')? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar fm    = this.fm,\n\t\t\t\tdfrd  = $.Deferred(),\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tcnt   = files.length,\n\t\t\t\thash, pcheck = null;\n\n\t\t\tif (!cnt || !files[0].phash) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\n\t\t\thash = files[0].phash;\n\t\t\tfm.trigger('searchend', { noupdate: true });\n\t\t\tfm.request({\n\t\t\t\tdata   : {cmd  : 'open', target : hash},\n\t\t\t\tnotify : {type : 'open', cnt : 1, hideCnt : true},\n\t\t\t\tsyncOnFail : false\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/opennew',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"opennew\"\n\t * Open folder in new window\n\t *\n\t * @author Naoki Sawada\n\t **/  \n\telFinder.prototype.commands.opennew = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm;\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern  : (typeof(fm.options.getFileCallback) === 'function'? 'shift+' : '') + 'ctrl+enter'\n\t\t}];\n\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length;\n\t\t\t\n\t\t\treturn cnt === 1 \n\t\t\t\t? (sel[0].mime === 'directory' && sel[0].read? 0 : -1) \n\t\t\t\t: -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar dfrd  = $.Deferred(),\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tcnt   = files.length,\n\t\t\t\topts  = this.options,\n\t\t\t\tfile, loc, url, win;\n\n\t\t\t// open folder to new tab (window)\n\t\t\tif (cnt === 1 && (file = files[0]) && file.mime === 'directory') {\n\t\t\t\tloc = window.location;\n\t\t\t\tif (opts.url) {\n\t\t\t\t\turl = opts.url;\n\t\t\t\t} else {\n\t\t\t\t\turl = loc.pathname;\n\t\t\t\t}\n\t\t\t\tif (opts.useOriginQuery) {\n\t\t\t\t\tif (!url.match(/\\?/)) {\n\t\t\t\t\t\turl += loc.search;\n\t\t\t\t\t} else if (loc.search) {\n\t\t\t\t\t\turl += '&' + loc.search.substr(1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\turl += '#elf_' + file.hash;\n\t\t\t\twin = window.open(url, '_blank');\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\twin.focus();\n\t\t\t\t}, 1000);\n\t\t\t\treturn dfrd.resolve();\n\t\t\t} else {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/paste',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"paste\"\n\t * Paste filesfrom clipboard into directory.\n\t * If files pasted in its parent directory - files duplicates will created\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.paste = function() {\n\t\t\"use strict\";\n\t\tthis.updateOnSelect  = false;\n\t\t\n\t\tthis.handlers = {\n\t\t\tchangeclipboard : function() { this.update(); }\n\t\t};\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+v shift+insert'\n\t\t}];\n\t\t\n\t\tthis.getstate = function(dst) {\n\t\t\tif (this._disabled) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (dst) {\n\t\t\t\tif (Array.isArray(dst)) {\n\t\t\t\t\tif (dst.length != 1) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tdst = this.fm.file(dst[0]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdst = this.fm.cwd();\n\t\t\t}\n\n\t\t\treturn this.fm.clipboard().length && dst.mime == 'directory' && dst.write ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(select, cOpts) {\n\t\t\tvar self   = this,\n\t\t\t\tfm     = self.fm,\n\t\t\t\topts   = cOpts || {},\n\t\t\t\tdst    = select ? this.files(select)[0] : fm.cwd(),\n\t\t\t\tfiles  = fm.clipboard(),\n\t\t\t\tcnt    = files.length,\n\t\t\t\tcut    = cnt ? files[0].cut : false,\n\t\t\t\tcmd    = opts._cmd? opts._cmd : (cut? 'move' : 'copy'),\n\t\t\t\terror  = 'err' + cmd.charAt(0).toUpperCase() + cmd.substr(1),\n\t\t\t\tfpaste = [],\n\t\t\t\tfcopy  = [],\n\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tfm.unlockfiles({files : $.map(files, function(f) { return f.hash; })});\n\t\t\t\t\t}),\n\t\t\t\tcopy  = function(files) {\n\t\t\t\t\treturn files.length && fm._commands.duplicate\n\t\t\t\t\t\t? fm.exec('duplicate', files)\n\t\t\t\t\t\t: $.Deferred().resolve();\n\t\t\t\t},\n\t\t\t\tpaste = function(files) {\n\t\t\t\t\tvar dfrd      = $.Deferred(),\n\t\t\t\t\t\texisted   = [],\n\t\t\t\t\t\thashes  = {},\n\t\t\t\t\t\tintersect = function(files, names) {\n\t\t\t\t\t\t\tvar ret = [], \n\t\t\t\t\t\t\t\ti   = files.length;\n\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\t$.inArray(files[i].name, names) !== -1 && ret.unshift(i);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tconfirm   = function(ndx) {\n\t\t\t\t\t\t\tvar i    = existed[ndx],\n\t\t\t\t\t\t\t\tfile = files[i],\n\t\t\t\t\t\t\t\tlast = ndx == existed.length-1;\n\n\t\t\t\t\t\t\tif (!file) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\ttitle  : fm.i18n(cmd + 'Files'),\n\t\t\t\t\t\t\t\ttext   : ['errExists', file.name, cmd === 'restore'? 'confirmRest' : 'confirmRepl'], \n\t\t\t\t\t\t\t\tall    : !last,\n\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnYes',\n\t\t\t\t\t\t\t\t\tcallback : function(all) {\n\t\t\t\t\t\t\t\t\t\t!last && !all\n\t\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\n\t\t\t\t\t\t\t\t\t\t\t: paste(files);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\treject : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnNo',\n\t\t\t\t\t\t\t\t\tcallback : function(all) {\n\t\t\t\t\t\t\t\t\t\tvar i;\n\n\t\t\t\t\t\t\t\t\t\tif (all) {\n\t\t\t\t\t\t\t\t\t\t\ti = existed.length;\n\t\t\t\t\t\t\t\t\t\t\twhile (ndx < i--) {\n\t\t\t\t\t\t\t\t\t\t\t\tfiles[existed[i]].remove = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfiles[existed[ndx]].remove = true;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t!last && !all\n\t\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\n\t\t\t\t\t\t\t\t\t\t\t: paste(files);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbuttons : [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlabel : 'btnBackup',\n\t\t\t\t\t\t\t\t\t\tcallback : function(all) {\n\t\t\t\t\t\t\t\t\t\t\tvar i;\n\t\t\t\t\t\t\t\t\t\t\tif (all) {\n\t\t\t\t\t\t\t\t\t\t\t\ti = existed.length;\n\t\t\t\t\t\t\t\t\t\t\t\twhile (ndx < i--) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles[existed[i]].rename = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tfiles[existed[ndx]].rename = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t!last && !all\n\t\t\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\n\t\t\t\t\t\t\t\t\t\t\t\t: paste(files);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tvalid     = function(names) {\n\t\t\t\t\t\t\tvar exists = {}, existedArr;\n\t\t\t\t\t\t\tif (names) {\n\t\t\t\t\t\t\t\tif (Array.isArray(names)) {\n\t\t\t\t\t\t\t\t\tif (names.length) {\n\t\t\t\t\t\t\t\t\t\tif (typeof names[0] == 'string') {\n\t\t\t\t\t\t\t\t\t\t\t// elFinder <= 2.1.6 command `is` results\n\t\t\t\t\t\t\t\t\t\t\texisted = intersect(files, names);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t$.each(names, function(i, v) {\n\t\t\t\t\t\t\t\t\t\t\t\texists[v.name] = v.hash;\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\texisted = intersect(files, $.map(exists, function(h, n) { return n; }));\n\t\t\t\t\t\t\t\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (exists[file.name]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\thashes[exists[file.name]] = file.name;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\texistedArr = [];\n\t\t\t\t\t\t\t\t\texisted = $.map(names, function(n) {\n\t\t\t\t\t\t\t\t\t\tif (typeof n === 'string') {\n\t\t\t\t\t\t\t\t\t\t\treturn n;\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// support to >=2.1.11 plugin Normalizer, Sanitizer\n\t\t\t\t\t\t\t\t\t\t\texistedArr = existedArr.concat(n);\n\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (existedArr.length) {\n\t\t\t\t\t\t\t\t\t\texisted = existed.concat(existedArr);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\texisted = intersect(files, existed);\n\t\t\t\t\t\t\t\t\thashes = names;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\texisted.length ? confirm(0) : paste(files);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpaste     = function(selFiles) {\n\t\t\t\t\t\t\tvar renames = [],\n\t\t\t\t\t\t\t\tfiles  = $.grep(selFiles, function(file) { \n\t\t\t\t\t\t\t\t\tif (file.rename) {\n\t\t\t\t\t\t\t\t\t\trenames.push(file.name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn !file.remove ? true : false;\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tcnt    = files.length,\n\t\t\t\t\t\t\t\tgroups = {},\n\t\t\t\t\t\t\t\targs   = [],\n\t\t\t\t\t\t\t\ttargets, reqData;\n\n\t\t\t\t\t\t\tif (!cnt) {\n\t\t\t\t\t\t\t\treturn dfrd.resolve();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttargets = $.map(files, function(f) { return f.hash; });\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treqData = {cmd : 'paste', dst : dst.hash, targets : targets, cut : cut ? 1 : 0, renames : renames, hashes : hashes, suffix : fm.options.backupSuffix};\n\t\t\t\t\t\t\tif (fm.api < 2.1) {\n\t\t\t\t\t\t\t\treqData.src = files[0].phash;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\tdata   : reqData,\n\t\t\t\t\t\t\t\t\tnotify : {type : cmd, cnt : cnt},\n\t\t\t\t\t\t\t\t\tcancel : true,\n\t\t\t\t\t\t\t\t\tnavigate : { \n\t\t\t\t\t\t\t\t\t\ttoast  : opts.noToast? {} : {\n\t\t\t\t\t\t\t\t\t\t\tinbuffer : {msg: fm.i18n(['complete', fm.i18n('cmd' + cmd)]), action: {\n\t\t\t\t\t\t\t\t\t\t\t\tcmd: 'open',\n\t\t\t\t\t\t\t\t\t\t\t\tmsg: 'cmdopendir',\n\t\t\t\t\t\t\t\t\t\t\t\tdata: [dst.hash],\n\t\t\t\t\t\t\t\t\t\t\t\tdone: 'select',\n\t\t\t\t\t\t\t\t\t\t\t\tcwdNot: dst.hash\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tvar dsts = {},\n\t\t\t\t\t\t\t\t\t\tadded = data.added && data.added.length? data.added : null;\n\t\t\t\t\t\t\t\t\tif (cut && added) {\n\t\t\t\t\t\t\t\t\t\t// undo/redo\n\t\t\t\t\t\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\t\t\t\t\t\tvar phash = f.phash,\n\t\t\t\t\t\t\t\t\t\t\t\tsrcHash = function(name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar hash;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.each(added, function(i, f) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (f.name === name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thash = f.hash;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn hash;\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tshash = srcHash(f.name);\n\t\t\t\t\t\t\t\t\t\t\tif (shash) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (dsts[phash]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdsts[phash].push(shash);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdsts[phash] = [ shash ];\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (Object.keys(dsts).length) {\n\t\t\t\t\t\t\t\t\t\t\tdata.undo = {\n\t\t\t\t\t\t\t\t\t\t\t\tcmd : 'move',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar reqs = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.each(dsts, function(dst, targets) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treqs.push(fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'paste', dst : dst, targets : targets, cut : 1},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'undo', cnt : targets.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $.when.apply(null, reqs);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\tdata.redo = {\n\t\t\t\t\t\t\t\t\t\t\t\tcmd : 'move',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata : reqData,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'redo', cnt : cnt}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function(flg) {\n\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\tif (flg === 0) {\n\t\t\t\t\t\t\t\t\t\t// canceling\n\t\t\t\t\t\t\t\t\t\tfm.sync();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : files});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinternames;\n\n\t\t\t\t\tif (!fm.isCommandEnabled(self.name, dst.hash) || !files.length) {\n\t\t\t\t\t\treturn dfrd.resolve();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (fm.oldAPI) {\n\t\t\t\t\t\tpaste(files);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!fm.option('copyOverwrite', dst.hash)) {\n\t\t\t\t\t\t\tpaste(files);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tinternames = $.map(files, function(f) { return f.name; });\n\t\t\t\t\t\t\tdst.hash == fm.cwd().hash\n\t\t\t\t\t\t\t\t? valid($.map(fm.files(), function(file) { return file.phash == dst.hash ? {hash: file.hash, name: file.name} : null; }))\n\t\t\t\t\t\t\t\t: fm.request({\n\t\t\t\t\t\t\t\t\tdata : {cmd : 'ls', target : dst.hash, intersect : internames},\n\t\t\t\t\t\t\t\t\tnotify : {type : 'prepare', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\t\t\t\tvalid(data.list);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn dfrd;\n\t\t\t\t},\n\t\t\t\tparents, fparents, cutDfrd;\n\n\n\t\t\tif (!cnt || !dst || dst.mime != 'directory') {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\t\n\t\t\tif (!dst.write)\t{\n\t\t\t\treturn dfrd.reject([error, files[0].name, 'errPerm']);\n\t\t\t}\n\t\t\t\n\t\t\tparents = fm.parents(dst.hash);\n\t\t\t\n\t\t\t$.each(files, function(i, file) {\n\t\t\t\tif (!file.read) {\n\t\t\t\t\treturn !dfrd.reject([error, file.name, 'errPerm']);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (cut && file.locked) {\n\t\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif ($.inArray(file.hash, parents) !== -1) {\n\t\t\t\t\treturn !dfrd.reject(['errCopyInItself', file.name]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (file.mime && file.mime !== 'directory' && ! fm.uploadMimeCheck(file.mime, dst.hash)) {\n\t\t\t\t\treturn !dfrd.reject([error, file.name, 'errUploadMime']);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfparents = fm.parents(file.hash);\n\t\t\t\tfparents.pop();\n\t\t\t\tif ($.inArray(dst.hash, fparents) !== -1) {\n\t\t\t\t\t\n\t\t\t\t\tif ($.grep(fparents, function(h) { var d = fm.file(h); return d.phash == dst.hash && d.name == file.name ? true : false; }).length) {\n\t\t\t\t\t\treturn !dfrd.reject(['errReplByChild', file.name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (file.phash == dst.hash) {\n\t\t\t\t\tfcopy.push(file.hash);\n\t\t\t\t} else {\n\t\t\t\t\tfpaste.push({\n\t\t\t\t\t\thash  : file.hash,\n\t\t\t\t\t\tphash : file.phash,\n\t\t\t\t\t\tname  : file.name\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (dfrd.state() === 'rejected') {\n\t\t\t\treturn dfrd;\n\t\t\t}\n\n\t\t\tcutDfrd = $.Deferred();\n\t\t\tif (cut && self.options.moveConfirm) {\n\t\t\t\tfm.confirm({\n\t\t\t\t\ttitle  : 'moveFiles',\n\t\t\t\t\ttext   : fm.i18n('confirmMove', dst.i18 || dst.name),\n\t\t\t\t\taccept : {\n\t\t\t\t\t\tlabel    : 'btnYes',\n\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\tcutDfrd.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcancel : {\n\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tcutDfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcutDfrd.resolve();\n\t\t\t}\n\n\t\t\tcutDfrd.done(function() {\n\t\t\t\t$.when(\n\t\t\t\t\tcopy(fcopy),\n\t\t\t\t\tpaste(fpaste)\n\t\t\t\t)\n\t\t\t\t.done(function(cr, pr) {\n\t\t\t\t\tdfrd.resolve(pr && pr.undo? pr : void(0));\n\t\t\t\t})\n\t\t\t\t.fail(function() {\n\t\t\t\t\tdfrd.reject();\n\t\t\t\t})\n\t\t\t\t.always(function() {\n\t\t\t\t\tcut && fm.clipboard([]);\n\t\t\t\t});\n\t\t\t}).fail(function() {\n\t\t\t\tdfrd.reject();\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/places',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"places\"\n\t * Regist to Places\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.places = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\tfm     = this.fm,\n\t\tfilter = function(hashes) {\n\t\t\treturn $.grep(self.files(hashes), function(f) { return f.mime == 'directory' ? true : false; });\n\t\t},\n\t\tplaces = null;\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.hashes(select),\n\t\t\tcnt = sel.length;\n\t\t\t\n\t\t\treturn  places && cnt && cnt == filter(sel).length ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar files = this.files(hashes);\n\t\t\tplaces.trigger('regist', [ files ]);\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\t\t\n\t\tfm.one('load', function(){\n\t\t\tplaces = fm.ui.places;\n\t\t});\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/preference',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"preference\"\n\t * \"Preference\" dialog\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.preference = function() {\n\t\tvar self    = this,\n\t\t\tfm      = this.fm,\n\t\t\tr       = 'replace',\n\t\t\ttab     = '<li class=\"' + fm.res('class', 'tabstab') + ' elfinder-preference-tab-{id}\"><a href=\"#'+fm.namespace+'-preference-{id}\" id=\"'+fm.namespace+'-preference-tab-{id}\" class=\"ui-tabs-anchor {class}\">{title}</a></li>',\n\t\t\tbase    = $('<div class=\"ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-preference\">'), \n\t\t\tul      = $('<ul class=\"ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-top\">'),\n\t\t\ttabs    = $('<div class=\"elfinder-preference-tabs ui-tabs-panel ui-widget-content ui-corner-bottom\"/>'),\n\t\t\tsep     = '<div class=\"elfinder-preference-separator\"/>',\n\t\t\tselfUrl = $('base').length? document.location.href.replace(/#.*$/, '') : '',\n\t\t\tselectTab = function(tab) {\n\t\t\t\t$('#'+fm.namespace+'-preference-tab-'+tab).trigger('mouseover').trigger('click');\n\t\t\t\topenTab = tab;\n\t\t\t},\n\t\t\tclTabActive = fm.res('class', 'tabsactive'),\n\t\t\tbuild   = function() {\n\t\t\t\tvar cats = self.options.categories || {\n\t\t\t\t\t\t'language' : ['language'],\n\t\t\t\t\t\t'theme' : ['theme'],\n\t\t\t\t\t\t'toolbar' : ['toolbarPref'],\n\t\t\t\t\t\t'workspace' : ['iconSize','columnPref', 'selectAction', 'makefileTypes', 'useStoredEditor', 'editorMaximized', 'useFullscreen', 'showHidden'],\n\t\t\t\t\t\t'dialog' : ['autoFocusDialog'],\n\t\t\t\t\t\t'selectionInfo' : ['infoItems', 'hashChecker'],\n\t\t\t\t\t\t'reset' : ['clearBrowserData'],\n\t\t\t\t\t\t'all' : true\n\t\t\t\t\t},\n\t\t\t\t\tforms = self.options.prefs || ['language', 'theme', 'toolbarPref', 'iconSize', 'columnPref', 'selectAction', 'makefileTypes', 'useStoredEditor', 'editorMaximized', 'useFullscreen', 'showHidden', 'infoItems', 'hashChecker', 'autoFocusDialog', 'clearBrowserData'];\n\t\t\t\t\n\t\t\t\tif (!fm.cookieEnabled) {\n\t\t\t\t\tdelete cats.language;\n\t\t\t\t}\n\n\t\t\t\tforms = fm.arrayFlip(forms, true);\n\t\t\t\t\n\t\t\t\tif (fm.options.getFileCallback) {\n\t\t\t\t\tdelete forms.selectAction;\n\t\t\t\t}\n\t\t\t\tif (!fm.UA.Fullscreen) {\n\t\t\t\t\tdelete forms.useFullscreen;\n\t\t\t\t}\n\n\t\t\t\tforms.language && (forms.language = (function() {\n\t\t\t\t\tvar langSel = $('<select/>').on('change', function() {\n\t\t\t\t\t\t\tvar lang = $(this).val();\n\t\t\t\t\t\t\tfm.storage('lang', lang);\n\t\t\t\t\t\t\t$('#'+fm.id).elfinder('reload');\n\t\t\t\t\t\t}),\n\t\t\t\t\t\toptTags = [],\n\t\t\t\t\t\tlangs = self.options.langs || {\n\t\t\t\t\t\t\tar: '',\n\t\t\t\t\t\t\tbg: '',\n\t\t\t\t\t\t\tca: 'Catal',\n\t\t\t\t\t\t\tcs: 'etina',\n\t\t\t\t\t\t\tda: 'Dansk',\n\t\t\t\t\t\t\tde: 'Deutsch',\n\t\t\t\t\t\t\tel: '',\n\t\t\t\t\t\t\ten: 'English',\n\t\t\t\t\t\t\tes: 'Espaol',\n\t\t\t\t\t\t\tfa: '',\n\t\t\t\t\t\t\tfo: 'Froyskt',\n\t\t\t\t\t\t\tfr: 'Franais',\n\t\t\t\t\t\t\tfr_CA: 'Franais (Canada)',\n\t\t\t\t\t\t\the: '',\n\t\t\t\t\t\t\thr: 'Hrvatski',\n\t\t\t\t\t\t\thu: 'Magyar',\n\t\t\t\t\t\t\tid: 'Bahasa Indonesia',\n\t\t\t\t\t\t\tit: 'Italiano',\n\t\t\t\t\t\t\tja: '',\n\t\t\t\t\t\t\tko: '',\n\t\t\t\t\t\t\tnl: 'Nederlands',\n\t\t\t\t\t\t\tno: 'Norsk',\n\t\t\t\t\t\t\tpl: 'Polski',\n\t\t\t\t\t\t\tpt_BR: 'Portugus',\n\t\t\t\t\t\t\tro: 'Romn',\n\t\t\t\t\t\t\tru: 'P',\n\t\t\t\t\t\t\tsi: '',\n\t\t\t\t\t\t\tsk: 'Slovenina',\n\t\t\t\t\t\t\tsl: 'Slovenina',\n\t\t\t\t\t\t\tsr: 'Srpski',\n\t\t\t\t\t\t\tsv: 'Svenska',\n\t\t\t\t\t\t\ttr: 'Trke',\n\t\t\t\t\t\t\tug_CN: '',\n\t\t\t\t\t\t\tuk: '',\n\t\t\t\t\t\t\tvi: 'Ting Vit',\n\t\t\t\t\t\t\tzh_CN: '',\n\t\t\t\t\t\t\tzh_TW: ''\n\t\t\t\t\t\t};\n\t\t\t\t\tif (!fm.cookieEnabled) {\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\t\t\t\t\t$.each(langs, function(lang, name) {\n\t\t\t\t\t\toptTags.push('<option value=\"'+lang+'\">'+name+'</option>');\n\t\t\t\t\t});\n\t\t\t\t\treturn langSel.append(optTags.join('')).val(fm.lang);\n\t\t\t\t})());\n\t\t\t\t\n\t\t\t\tforms.theme && (forms.theme = (function() {\n\t\t\t\t\tvar cnt = fm.options.themes? Object.keys(fm.options.themes).length : 0;\n\t\t\t\t\tif (cnt === 0 || (cnt === 1 && fm.options.themes.default)) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tvar themeSel = $('<select/>').on('change', function() {\n\t\t\t\t\t\t\tvar theme = $(this).val();\n\t\t\t\t\t\t\tfm.changeTheme(theme).storage('theme', theme);\n\t\t\t\t\t\t}),\n\t\t\t\t\t\toptTags = [],\n\t\t\t\t\t\ttpl = {\n\t\t\t\t\t\t\timage: '<img class=\"elfinder-preference-theme elfinder-preference-theme-image\" src=\"$2\" />',\n\t\t\t\t\t\t\tlink: '<a href=\"$1\" target=\"_blank\" title=\"$3\">$2</a>',\n\t\t\t\t\t\t\tdata: '<dt>$1</dt><dd><span class=\"elfinder-preference-theme elfinder-preference-theme-$0\">$2</span></dd>'\n\t\t\t\t\t\t},\n\t\t\t\t\t\titems = ['image', 'description', 'author', 'email', 'license'],\n\t\t\t\t\t\trender = function(key, data) {\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdefBtn = $('<button class=\"ui-button ui-corner-all ui-widget elfinder-preference-theme-default\"/>').text(fm.i18n('default')).on('click', function(e) {\n\t\t\t\t\t\t\tthemeSel.val('default').trigger('change');\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tlist = $('<div class=\"elfinder-reference-hide-taball\"/>').on('click', 'button', function() {\n\t\t\t\t\t\t\t\tvar val = $(this).data('themeid');\n\t\t\t\t\t\t\t\tthemeSel.val(val).trigger('change');\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (!fm.options.themes.default) {\n\t\t\t\t\t\tthemeSel.append('<option value=\"default\">'+fm.i18n('default')+'</option>');\n\t\t\t\t\t}\n\t\t\t\t\t$.each(fm.options.themes, function(id, val) {\n\t\t\t\t\t\tvar opt = $('<option class=\"elfinder-theme-option-'+id+'\" value=\"'+id+'\">'+fm.i18n(id)+'</option>'),\n\t\t\t\t\t\t\tdsc = $('<fieldset class=\"ui-widget ui-widget-content ui-corner-all elfinder-theme-list-'+id+'\"><legend>'+fm.i18n(id)+'</legend><div><span class=\"elfinder-spinner\"/></div></fieldset>'),\n\t\t\t\t\t\t\ttm;\n\t\t\t\t\t\tthemeSel.append(opt);\n\t\t\t\t\t\tlist.append(dsc);\n\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\tdsc.find('span.elfinder-spinner').replaceWith(fm.i18n(['errRead', id]));\n\t\t\t\t\t\t}, 10000);\n\t\t\t\t\t\tfm.getTheme(id).always(function() {\n\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\tvar link, val = $(), dl = $('<dl/>');\n\t\t\t\t\t\t\tlink = data.link? tpl.link.replace(/\\$1/g, data.link).replace(/\\$3/g, fm.i18n('website')) : '$2';\n\t\t\t\t\t\t\tif (data.name) {\n\t\t\t\t\t\t\t\topt.html(fm.i18n(data.name));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdsc.children('legend').html(link.replace(/\\$2/g, fm.i18n(data.name) || id));\n\t\t\t\t\t\t\t$.each(items, function(i, key) {\n\t\t\t\t\t\t\t\tvar t = tpl[key] || tpl.data,\n\t\t\t\t\t\t\t\t\telm;\n\t\t\t\t\t\t\t\tif (data[key]) {\n\t\t\t\t\t\t\t\t\telm = t.replace(/\\$0/g, fm.escape(key)).replace(/\\$1/g, fm.i18n(key)).replace(/\\$2/g, fm.i18n(data[key]));\n\t\t\t\t\t\t\t\t\tif (key === 'image' && data.link) {\n\t\t\t\t\t\t\t\t\t\telm = $(elm).on('click', function() {\n\t\t\t\t\t\t\t\t\t\t\tthemeSel.val(id).trigger('change');\n\t\t\t\t\t\t\t\t\t\t}).attr('title', fm.i18n('select'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdl.append(elm);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tval = val.add(dl);\n\t\t\t\t\t\t\tval = val.add($('<div class=\"elfinder-preference-theme-btn\"/>').append($('<button class=\"ui-button ui-corner-all ui-widget\"/>').data('themeid', id).html(fm.i18n('select'))));\n\t\t\t\t\t\t\tdsc.find('span.elfinder-spinner').replaceWith(val);\n\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\tdsc.find('span.elfinder-spinner').replaceWith(fm.i18n(['errRead', id]));\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\treturn $('<div/>').append(themeSel.val(fm.theme && fm.theme.id? fm.theme.id : 'default'), defBtn, list);\n\t\t\t\t})());\n\n\t\t\t\tforms.toolbarPref && (forms.toolbarPref = (function() {\n\t\t\t\t\tvar pnls = $.map(fm.options.uiOptions.toolbar, function(v) {\n\t\t\t\t\t\t\treturn $.isArray(v)? v : null;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\ttags = [],\n\t\t\t\t\t\thides = fm.storage('toolbarhides') || {};\n\t\t\t\t\t$.each(pnls, function() {\n\t\t\t\t\t\tvar cmd = this,\n\t\t\t\t\t\t\tname = fm.i18n('cmd'+cmd);\n\t\t\t\t\t\tif (name === 'cmd'+cmd) {\n\t\t\t\t\t\t\tname = fm.i18n(cmd);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttags.push('<span class=\"elfinder-preference-toolbar-item\"><label><input type=\"checkbox\" value=\"'+cmd+'\" '+(hides[cmd]? '' : 'checked')+'/>'+name+'</label></span>');\n\t\t\t\t\t});\n\t\t\t\t\treturn $(tags.join(' ')).on('change', 'input', function() {\n\t\t\t\t\t\tvar v = $(this).val(),\n\t\t\t\t\t\t\to = $(this).is(':checked');\n\t\t\t\t\t\tif (!o && !hides[v]) {\n\t\t\t\t\t\t\thides[v] = true;\n\t\t\t\t\t\t} else if (o && hides[v]) {\n\t\t\t\t\t\t\tdelete hides[v];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.storage('toolbarhides', hides);\n\t\t\t\t\t\tfm.trigger('toolbarpref');\n\t\t\t\t\t});\n\t\t\t\t})());\n\t\t\t\t\n\t\t\t\tforms.iconSize && (forms.iconSize = (function() {\n\t\t\t\t\tvar max = fm.options.uiOptions.cwd.iconsView.sizeMax || 3,\n\t\t\t\t\t\tsize = fm.storage('iconsize') || fm.options.uiOptions.cwd.iconsView.size || 0,\n\t\t\t\t\t\tsld = $('<div class=\"touch-punch\"/>').slider({\n\t\t\t\t\t\t\tclasses: {\n\t\t\t\t\t\t\t\t'ui-slider-handle': 'elfinder-tabstop',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tvalue: size,\n\t\t\t\t\t\t\tmax: max,\n\t\t\t\t\t\t\tslide: function(e, ui) {\n\t\t\t\t\t\t\t\tfm.getUI('cwd').trigger('iconpref', {size: ui.value});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchange: function(e, ui) {\n\t\t\t\t\t\t\t\tfm.storage('iconsize', ui.value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\tfm.getUI('cwd').on('iconpref', function(e, data) {\n\t\t\t\t\t\tsld.slider('option', 'value', data.size);\n\t\t\t\t\t});\n\t\t\t\t\treturn sld;\n\t\t\t\t})());\n\n\t\t\t\tforms.columnPref && (forms.columnPref = (function() {\n\t\t\t\t\tvar cols = fm.options.uiOptions.cwd.listView.columns,\n\t\t\t\t\t\ttags = [],\n\t\t\t\t\t\thides = fm.storage('columnhides') || {};\n\t\t\t\t\t$.each(cols, function() {\n\t\t\t\t\t\tvar key = this,\n\t\t\t\t\t\t\tname = fm.getColumnName(key);\n\t\t\t\t\t\ttags.push('<span class=\"elfinder-preference-column-item\"><label><input type=\"checkbox\" value=\"'+key+'\" '+(hides[key]? '' : 'checked')+'/>'+name+'</label></span>');\n\t\t\t\t\t});\n\t\t\t\t\treturn $(tags.join(' ')).on('change', 'input', function() {\n\t\t\t\t\t\tvar v = $(this).val(),\n\t\t\t\t\t\t\to = $(this).is(':checked');\n\t\t\t\t\t\tif (!o && !hides[v]) {\n\t\t\t\t\t\t\thides[v] = true;\n\t\t\t\t\t\t} else if (o && hides[v]) {\n\t\t\t\t\t\t\tdelete hides[v];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.storage('columnhides', hides);\n\t\t\t\t\t\tfm.trigger('columnpref', { repaint: true });\n\t\t\t\t\t});\n\t\t\t\t})());\n\t\t\t\t\n\t\t\t\tforms.selectAction && (forms.selectAction = (function() {\n\t\t\t\t\tvar actSel = $('<select/>').on('change', function() {\n\t\t\t\t\t\t\tvar act = $(this).val();\n\t\t\t\t\t\t\tfm.storage('selectAction', act === 'default'? null : act);\n\t\t\t\t\t\t}),\n\t\t\t\t\t\toptTags = [],\n\t\t\t\t\t\tacts = self.options.selectActions,\n\t\t\t\t\t\tdefAct = fm.getCommand('open').options.selectAction || 'open';\n\t\t\t\t\t\n\t\t\t\t\tif ($.inArray(defAct, acts) === -1) {\n\t\t\t\t\t\tacts.unshift(defAct);\n\t\t\t\t\t}\n\t\t\t\t\t$.each(acts, function(i, act) {\n\t\t\t\t\t\tvar names = $.map(act.split('/'), function(cmd) {\n\t\t\t\t\t\t\tvar name = fm.i18n('cmd'+cmd);\n\t\t\t\t\t\t\tif (name === 'cmd'+cmd) {\n\t\t\t\t\t\t\t\tname = fm.i18n(cmd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn name;\n\t\t\t\t\t\t});\n\t\t\t\t\t\toptTags.push('<option value=\"'+act+'\">'+names.join('/')+'</option>');\n\t\t\t\t\t});\n\t\t\t\t\treturn actSel.append(optTags.join('')).val(fm.storage('selectAction') || defAct);\n\t\t\t\t})());\n\t\t\t\t\n\t\t\t\tforms.makefileTypes && (forms.makefileTypes = (function() {\n\t\t\t\t\tvar hides = fm.getCommand('edit').getMkfileHides(),\n\t\t\t\t\t\tgetTag = function() {\n\t\t\t\t\t\t\tvar tags = [];\n\t\t\t\t\t\t\t// re-assign hides\n\t\t\t\t\t\t\thides = fm.getCommand('edit').getMkfileHides();\n\t\t\t\t\t\t\t$.each(fm.mimesCanMakeEmpty, function(mime, type) {\n\t\t\t\t\t\t\t\tvar name = fm.getCommand('mkfile').getTypeName(mime, type);\n\t\t\t\t\t\t\t\ttags.push('<span class=\"elfinder-preference-column-item\" title=\"'+fm.escape(name)+'\"><label><input type=\"checkbox\" value=\"'+mime+'\" '+(hides[mime]? '' : 'checked')+'/>'+type+'</label></span>');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn tags.join(' ');\n\t\t\t\t\t\t},\n\t\t\t\t\t\telm = $('<div/>').on('change', 'input', function() {\n\t\t\t\t\t\t\tvar v = $(this).val(),\n\t\t\t\t\t\t\t\to = $(this).is(':checked');\n\t\t\t\t\t\t\tif (!o && !hides[v]) {\n\t\t\t\t\t\t\t\thides[v] = true;\n\t\t\t\t\t\t\t} else if (o && hides[v]) {\n\t\t\t\t\t\t\t\tdelete hides[v];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.storage('mkfileHides', hides);\n\t\t\t\t\t\t\tfm.trigger('canMakeEmptyFile');\n\t\t\t\t\t\t}).append(getTag()),\n\t\t\t\t\t\tadd = $('<div/>').append(\n\t\t\t\t\t\t\t$('<input type=\"text\" placeholder=\"'+fm.i18n('typeOfTextfile')+'\"/>').on('keydown', function(e) {\n\t\t\t\t\t\t\t\t(e.keyCode === $.ui.keyCode.ENTER) && $(this).next().trigger('click');\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t$('<button class=\"ui-button\"/>').html(fm.i18n('add')).on('click', function() {\n\t\t\t\t\t\t\t\tvar input = $(this).prev(),\n\t\t\t\t\t\t\t\t\tval = input.val(),\n\t\t\t\t\t\t\t\t\tuiToast = fm.getUI('toast'),\n\t\t\t\t\t\t\t\t\terr = function() {\n\t\t\t\t\t\t\t\t\t\tuiToast.appendTo(input.closest('.ui-dialog'));\n\t\t\t\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\t\t\t\tmsg: fm.i18n('errUsupportType'),\n\t\t\t\t\t\t\t\t\t\t\tmode: 'warning',\n\t\t\t\t\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\t\t\t\t\tuiToast.children().length === 1 && uiToast.appendTo(fm.getUI());\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tinput.trigger('focus');\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttmpMimes;\n\t\t\t\t\t\t\t\tif (!val.match(/\\//)) {\n\t\t\t\t\t\t\t\t\tval = fm.arrayFlip(fm.mimeTypes)[val];\n\t\t\t\t\t\t\t\t\tif (!val) {\n\t\t\t\t\t\t\t\t\t\treturn err();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tinput.val(val);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!fm.mimeIsText(val) || !fm.mimeTypes[val]) {\n\t\t\t\t\t\t\t\t\treturn err();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.trigger('canMakeEmptyFile', {mimes: [val], unshift: true});\n\t\t\t\t\t\t\t\ttmpMimes = {};\n\t\t\t\t\t\t\t\ttmpMimes[val] = fm.mimeTypes[val];\n\t\t\t\t\t\t\t\tfm.storage('mkfileTextMimes', Object.assign(tmpMimes, fm.storage('mkfileTextMimes') || {}));\n\t\t\t\t\t\t\t\tinput.val('');\n\t\t\t\t\t\t\t\tuiToast.appendTo(input.closest('.ui-dialog'));\n\t\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\t\tmsg: fm.i18n(['complete', val + ' (' + tmpMimes[val] + ')']),\n\t\t\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\t\t\tuiToast.children().length === 1 && uiToast.appendTo(fm.getUI());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t$('<button class=\"ui-button\"/>').html(fm.i18n('reset')).on('click', function() {\n\t\t\t\t\t\t\t\tfm.one('canMakeEmptyFile', {done: function() {\n\t\t\t\t\t\t\t\t\telm.empty().append(getTag());\n\t\t\t\t\t\t\t\t}});\n\t\t\t\t\t\t\t\tfm.trigger('canMakeEmptyFile', {resetTexts: true});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t),\n\t\t\t\t\t\ttm;\n\t\t\t\t\tfm.bind('canMakeEmptyFile', {done: function(e) {\n\t\t\t\t\t\tif (e.data && e.data.mimes && e.data.mimes.length) {\n\t\t\t\t\t\t\telm.empty().append(getTag());\n\t\t\t\t\t\t}\n\t\t\t\t\t}});\n\t\t\t\t\treturn $('<div/>').append(elm, add);\n\t\t\t\t})());\n\n\t\t\t\tforms.useStoredEditor && (forms.useStoredEditor = $('<input type=\"checkbox\"/>').prop('checked', (function() {\n\t\t\t\t\tvar s = fm.storage('useStoredEditor');\n\t\t\t\t\treturn s? (s > 0) : fm.options.commandsOptions.edit.useStoredEditor;\n\t\t\t\t})()).on('change', function(e) {\n\t\t\t\t\tfm.storage('useStoredEditor', $(this).is(':checked')? 1 : -1);\n\t\t\t\t}));\n\n\t\t\t\tforms.editorMaximized && (forms.editorMaximized = $('<input type=\"checkbox\"/>').prop('checked', (function() {\n\t\t\t\t\tvar s = fm.storage('editorMaximized');\n\t\t\t\t\treturn s? (s > 0) : fm.options.commandsOptions.edit.editorMaximized;\n\t\t\t\t})()).on('change', function(e) {\n\t\t\t\t\tfm.storage('editorMaximized', $(this).is(':checked')? 1 : -1);\n\t\t\t\t}));\n\n\t\t\t\tforms.useFullscreen && (forms.useFullscreen = $('<input type=\"checkbox\"/>').prop('checked', (function() {\n\t\t\t\t\tvar s = fm.storage('useFullscreen');\n\t\t\t\t\treturn s? (s > 0) : fm.options.commandsOptions.fullscreen.mode === 'screen';\n\t\t\t\t})()).on('change', function(e) {\n\t\t\t\t\tfm.storage('useFullscreen', $(this).is(':checked')? 1 : -1);\n\t\t\t\t}));\n\n\t\t\t\tif (forms.showHidden) {\n\t\t\t\t\t(function() {\n\t\t\t\t\t\tvar setTitle = function() {\n\t\t\t\t\t\t\t\tvar s = fm.storage('hide'),\n\t\t\t\t\t\t\t\t\tt = [],\n\t\t\t\t\t\t\t\t\tv;\n\t\t\t\t\t\t\t\tif (s && s.items) {\n\t\t\t\t\t\t\t\t\t$.each(s.items, function(h, n) {\n\t\t\t\t\t\t\t\t\t\tt.push(fm.escape(n));\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telms.prop('disabled', !t.length)[t.length? 'removeClass' : 'addClass']('ui-state-disabled');\n\t\t\t\t\t\t\t\tv = t.length? t.join('\\n') : '';\n\t\t\t\t\t\t\t\tforms.showHidden.attr('title',v);\n\t\t\t\t\t\t\t\tuseTooltip && forms.showHidden.tooltip('option', 'content', v.replace(/\\n/g, '<br>')).tooltip('close');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchk = $('<input type=\"checkbox\"/>').prop('checked', (function() {\n\t\t\t\t\t\t\t\tvar s = fm.storage('hide');\n\t\t\t\t\t\t\t\treturn s && s.show;\n\t\t\t\t\t\t\t})()).on('change', function(e) {\n\t\t\t\t\t\t\t\tvar o = {};\n\t\t\t\t\t\t\t\to[$(this).is(':checked')? 'show' : 'hide'] = true;\n\t\t\t\t\t\t\t\tfm.exec('hide', void(0), o);\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tbtn = $('<button class=\"ui-button ui-corner-all ui-widget\"/>').append(fm.i18n('reset')).on('click', function() {\n\t\t\t\t\t\t\t\tfm.exec('hide', void(0), {reset: true});\n\t\t\t\t\t\t\t\t$(this).parent().find('input:first').prop('checked', false);\n\t\t\t\t\t\t\t\tsetTitle();\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\telms = $().add(chk).add(btn),\n\t\t\t\t\t\t\tuseTooltip;\n\t\t\t\t\t\t\n\t\t\t\t\t\tforms.showHidden = $('<div/>').append(chk, btn);\n\t\t\t\t\t\tfm.bind('hide', function(e) {\n\t\t\t\t\t\t\tvar d = e.data;\n\t\t\t\t\t\t\tif (!d.opts || (!d.opts.show && !d.opts.hide)) {\n\t\t\t\t\t\t\t\tsetTitle();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (fm.UA.Mobile && $.fn.tooltip) {\n\t\t\t\t\t\t\tuseTooltip = true;\n\t\t\t\t\t\t\tforms.showHidden.tooltip({\n\t\t\t\t\t\t\t\tclasses: {\n\t\t\t\t\t\t\t\t\t'ui-tooltip': 'elfinder-ui-tooltip ui-widget-shadow'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttooltipClass: 'elfinder-ui-tooltip ui-widget-shadow',\n\t\t\t\t\t\t\t\ttrack: true\n\t\t\t\t\t\t\t}).css('user-select', 'none');\n\t\t\t\t\t\t\tbtn.css('user-select', 'none');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetTitle();\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tforms.infoItems && (forms.infoItems = (function() {\n\t\t\t\t\tvar items = fm.getCommand('info').items,\n\t\t\t\t\t\ttags = [],\n\t\t\t\t\t\thides = fm.storage('infohides') || fm.arrayFlip(fm.options.commandsOptions.info.hideItems, true);\n\t\t\t\t\t$.each(items, function() {\n\t\t\t\t\t\tvar key = this,\n\t\t\t\t\t\t\tname = fm.i18n(key);\n\t\t\t\t\t\ttags.push('<span class=\"elfinder-preference-info-item\"><label><input type=\"checkbox\" value=\"'+key+'\" '+(hides[key]? '' : 'checked')+'/>'+name+'</label></span>');\n\t\t\t\t\t});\n\t\t\t\t\treturn $(tags.join(' ')).on('change', 'input', function() {\n\t\t\t\t\t\tvar v = $(this).val(),\n\t\t\t\t\t\t\to = $(this).is(':checked');\n\t\t\t\t\t\tif (!o && !hides[v]) {\n\t\t\t\t\t\t\thides[v] = true;\n\t\t\t\t\t\t} else if (o && hides[v]) {\n\t\t\t\t\t\t\tdelete hides[v];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.storage('infohides', hides);\n\t\t\t\t\t\tfm.trigger('infopref', { repaint: true });\n\t\t\t\t\t});\n\t\t\t\t})());\n\t\t\t\t\n\t\t\t\tforms.hashChecker && fm.hashCheckers.length && (forms.hashChecker = (function() {\n\t\t\t\t\tvar tags = [],\n\t\t\t\t\t\tenabled = fm.arrayFlip(fm.storage('hashchekcer') || fm.options.commandsOptions.info.showHashAlgorisms, true);\n\t\t\t\t\t$.each(fm.hashCheckers, function() {\n\t\t\t\t\t\tvar cmd = this,\n\t\t\t\t\t\t\tname = fm.i18n(cmd);\n\t\t\t\t\t\ttags.push('<span class=\"elfinder-preference-hashchecker-item\"><label><input type=\"checkbox\" value=\"'+cmd+'\" '+(enabled[cmd]? 'checked' : '')+'/>'+name+'</label></span>');\n\t\t\t\t\t});\n\t\t\t\t\treturn $(tags.join(' ')).on('change', 'input', function() {\n\t\t\t\t\t\tvar v = $(this).val(),\n\t\t\t\t\t\t\to = $(this).is(':checked');\n\t\t\t\t\t\tif (o) {\n\t\t\t\t\t\t\tenabled[v] = true;\n\t\t\t\t\t\t} else if (enabled[v]) {\n\t\t\t\t\t\t\tdelete enabled[v];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.storage('hashchekcer', $.grep(fm.hashCheckers, function(v) {\n\t\t\t\t\t\t\treturn enabled[v];\n\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t\t})());\n\n\t\t\t\tforms.autoFocusDialog && (forms.autoFocusDialog = $('<input type=\"checkbox\"/>').prop('checked', (function() {\n\t\t\t\t\tvar s = fm.storage('autoFocusDialog');\n\t\t\t\t\treturn s? (s > 0) : fm.options.uiOptions.dialog.focusOnMouseOver;\n\t\t\t\t})()).on('change', function(e) {\n\t\t\t\t\tfm.storage('autoFocusDialog', $(this).is(':checked')? 1 : -1);\n\t\t\t\t}));\n\t\t\t\t\n\t\t\t\tforms.clearBrowserData && (forms.clearBrowserData = $('<button/>').text(fm.i18n('reset')).button().on('click', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfm.storage();\n\t\t\t\t\t$('#'+fm.id).elfinder('reload');\n\t\t\t\t}));\n\t\t\t\t\n\t\t\t\t$.each(cats, function(id, prefs) {\n\t\t\t\t\tvar dls, found;\n\t\t\t\t\tif (prefs === true) {\n\t\t\t\t\t\tfound = 1;\n\t\t\t\t\t} else if (prefs) {\n\t\t\t\t\t\tdls = $();\n\t\t\t\t\t\t$.each(prefs, function(i, n) {\n\t\t\t\t\t\t\tvar f, title, chks = '', cbox;\n\t\t\t\t\t\t\tif (f = forms[n]) {\n\t\t\t\t\t\t\t\tfound = 2;\n\t\t\t\t\t\t\t\ttitle = fm.i18n(n);\n\t\t\t\t\t\t\t\tcbox = $(f).filter('input[type=\"checkbox\"]');\n\t\t\t\t\t\t\t\tif (!cbox.length) {\n\t\t\t\t\t\t\t\t\tcbox = $(f).find('input[type=\"checkbox\"]');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (cbox.length === 1) {\n\t\t\t\t\t\t\t\t\tif (!cbox.attr('id')) {\n\t\t\t\t\t\t\t\t\t\tcbox.attr('id', 'elfinder-preference-'+n+'-checkbox');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ttitle = '<label for=\"'+cbox.attr('id')+'\">'+title+'</label>';\n\t\t\t\t\t\t\t\t} else if (cbox.length > 1) {\n\t\t\t\t\t\t\t\t\tchks = ' elfinder-preference-checkboxes';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdls = dls.add($('<dt class=\"elfinder-preference-'+n+chks+'\">'+title+'</dt>')).add($('<dd class=\"elfinder-preference-'+n+chks+'\"/>').append(f));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (found) {\n\t\t\t\t\t\tul.append(tab[r](/\\{id\\}/g, id)[r](/\\{title\\}/, fm.i18n(id))[r](/\\{class\\}/, openTab === id? 'elfinder-focus' : ''));\n\t\t\t\t\t\tif (found === 2) {\n\t\t\t\t\t\t\ttabs.append(\n\t\t\t\t\t\t\t\t$('<div id=\"'+fm.namespace+'-preference-'+id+'\" class=\"elfinder-preference-content\"/>')\n\t\t\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t\t\t.append($('<dl/>').append(dls))\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tul.on('click', 'a', function(e) {\n\t\t\t\t\tvar t = $(e.target),\n\t\t\t\t\t\th = t.attr('href');\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tul.children().removeClass(clTabActive);\n\t\t\t\t\tt.removeClass('ui-state-hover').parent().addClass(clTabActive);\n\n\t\t\t\t\tif (h.match(/all$/)) {\n\t\t\t\t\t\ttabs.addClass('elfinder-preference-taball').children().show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttabs.removeClass('elfinder-preference-taball').children().hide();\n\t\t\t\t\t\t$(h).show();\n\t\t\t\t\t}\n\t\t\t\t}).on('focus blur', 'a', function(e) {\n\t\t\t\t\t$(this).parent().toggleClass('ui-state-focus', e.type === 'focusin');\n\t\t\t\t}).on('mouseenter mouseleave', 'li', function(e) {\n\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type === 'mouseenter');\n\t\t\t\t});\n\n\t\t\t\ttabs.find('a,input,select,button').addClass('elfinder-tabstop');\n\t\t\t\tbase.append(ul, tabs);\n\n\t\t\t\tdialog = self.fmDialog(base, {\n\t\t\t\t\ttitle : self.title,\n\t\t\t\t\twidth : self.options.width || 600,\n\t\t\t\t\theight: self.options.height || 400,\n\t\t\t\t\tmaxWidth: 'window',\n\t\t\t\t\tmaxHeight: 'window',\n\t\t\t\t\tautoOpen : false,\n\t\t\t\t\tdestroyOnClose : false,\n\t\t\t\t\tallowMinimize : false,\n\t\t\t\t\topen : function() {\n\t\t\t\t\t\topenTab && selectTab(openTab);\n\t\t\t\t\t\topenTab = null;\n\t\t\t\t\t},\n\t\t\t\t\tresize : function() {\n\t\t\t\t\t\ttabs.height(dialog.height() - ul.outerHeight(true) - (tabs.outerHeight(true) - tabs.height()) - 5);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on('click', function(e) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t})\n\t\t\t\t.css({\n\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t});\n\n\t\t\t\tdialog.closest('.ui-dialog')\n\t\t\t\t.css({\n\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t})\n\t\t\t\t.addClass('elfinder-bg-translucent');\n\t\t\t\t\n\t\t\t\topenTab = 'all';\n\t\t\t},\n\t\t\tdialog, openTab;\n\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+comma',\n\t\t\tdescription : this.title\n\t\t}];\n\n\t\tthis.alwaysEnabled  = true;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function(sel, cOpts) {\n\t\t\t!dialog && build();\n\t\t\tif (cOpts) {\n\t\t\t\tif (cOpts.tab) {\n\t\t\t\t\tselectTab(cOpts.tab);\n\t\t\t\t} else if (cOpts._currentType === 'cwd') {\n\t\t\t\t\tselectTab('workspace');\n\t\t\t\t}\n\t\t\t}\n\t\t\tdialog.elfinderdialog('open');\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/quicklook',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"quicklook\"\n\t * Fast preview for some files types\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t(elFinder.prototype.commands.quicklook = function() {\n\t\t\"use strict\";\n\t\tvar self       = this,\n\t\t\tfm         = self.fm,\n\t\t\t/**\n\t\t\t * window closed state\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\tclosed     = 0,\n\t\t\t/**\n\t\t\t * window animated state\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\tanimated   = 1,\n\t\t\t/**\n\t\t\t * window opened state\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\topened     = 2,\n\t\t\t/**\n\t\t\t * window docked state\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\tdocked     = 3,\n\t\t\t/**\n\t\t\t * window docked and hidden state\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\tdockedhidden = 4,\n\t\t\t/**\n\t\t\t * window state\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\tstate      = closed,\n\t\t\t/**\n\t\t\t * Event name of update\n\t\t\t * for fix conflicts with Prototype.JS\n\t\t\t * \n\t\t\t * `@see https://github.com/Studio-42/elFinder/pull/2346\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tevUpdate = Element.update? 'quicklookupdate' : 'update',\n\t\t\t/**\n\t\t\t * navbar icon class\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tnavicon    = 'elfinder-quicklook-navbar-icon',\n\t\t\t/**\n\t\t\t * navbar \"fullscreen\" icon class\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tfullscreen = 'elfinder-quicklook-fullscreen',\n\t\t\t/**\n\t\t\t * info wrapper class\n\t\t\t * \n\t\t\t * @type String\n\t\t\t */\n\t\t\tinfocls    = 'elfinder-quicklook-info-wrapper',\n\t\t\t/**\n\t\t\t * Triger keydown/keypress event with left/right arrow key code\n\t\t\t *\n\t\t\t * @param  Number  left/right arrow key code\n\t\t\t * @return void\n\t\t\t **/\n\t\t\tnavtrigger = function(code) {\n\t\t\t\t$(document).trigger($.Event('keydown', { keyCode: code, ctrlKey : false, shiftKey : false, altKey : false, metaKey : false }));\n\t\t\t},\n\t\t\t/**\n\t\t\t * Return css for closed window\n\t\t\t *\n\t\t\t * @param  jQuery  file node in cwd\n\t\t\t * @return void\n\t\t\t **/\n\t\t\tclosedCss = function(node) {\n\t\t\t\tvar elf = fm.getUI().offset(),\n\t\t\t\t\tbase = (function() {\n\t\t\t\t\t\tvar target = node.find('.elfinder-cwd-file-wrapper');\n\t\t\t\t\t\treturn target.length? target : node;\n\t\t\t\t\t})(),\n\t\t\t\t\tbaseOffset = base.offset() || { top: 0, left: 0 };\n\t\t\t\treturn {\n\t\t\t\t\topacity : 0,\n\t\t\t\t\twidth   : base.width(),\n\t\t\t\t\theight  : base.height() - 30,\n\t\t\t\t\ttop     : baseOffset.top - elf.top,\n\t\t\t\t\tleft    : baseOffset.left  - elf.left\n\t\t\t\t};\n\t\t\t},\n\t\t\t/**\n\t\t\t * Return css for opened window\n\t\t\t *\n\t\t\t * @return void\n\t\t\t **/\n\t\t\topenedCss = function() {\n\t\t\t\tvar contain = self.options.contain || fm.options.dialogContained,\n\t\t\t\t\twin = contain? fm.getUI() : $(window),\n\t\t\t\t\telf = fm.getUI().offset(),\n\t\t\t\t\tw = Math.min(width, win.width()-10),\n\t\t\t\t\th = Math.min(height, win.height()-80);\n\t\t\t\treturn {\n\t\t\t\t\topacity : 1,\n\t\t\t\t\twidth  : w,\n\t\t\t\t\theight : h,\n\t\t\t\t\ttop    : parseInt((win.height() - h - 60) / 2 + (contain? 0 : win.scrollTop() - elf.top)),\n\t\t\t\t\tleft   : parseInt((win.width() - w) / 2 + (contain? 0 : win.scrollLeft() - elf.left))\n\t\t\t\t};\n\t\t\t},\n\t\t\t\n\t\t\tmediaNode = {},\n\t\t\tsupport = function(codec, name) {\n\t\t\t\tvar node  = name || codec.substr(0, codec.indexOf('/')),\n\t\t\t\t\tmedia = mediaNode[node]? mediaNode[node] : (mediaNode[node] = document.createElement(node)),\n\t\t\t\t\tvalue = false;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tvalue = media.canPlayType && media.canPlayType(codec);\n\t\t\t\t} catch(e) {}\n\t\t\t\t\n\t\t\t\treturn (value && value !== '' && value != 'no')? true : false;\n\t\t\t},\n\t\t\t\n\t\t\tplatformWin = (window.navigator.platform.indexOf('Win') != -1),\n\t\t\t\n\t\t\t/**\n\t\t\t * Opened window width (from config)\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\twidth, \n\t\t\t/**\n\t\t\t * Opened window height (from config)\n\t\t\t *\n\t\t\t * @type Number\n\t\t\t **/\n\t\t\theight, \n\t\t\t/**\n\t\t\t * Previous style before docked\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tprevStyle,\n\t\t\t/**\n\t\t\t * elFinder node\n\t\t\t *\n\t\t\t * @type jQuery\n\t\t\t **/\n\t\t\tparent, \n\t\t\t/**\n\t\t\t * elFinder current directory node\n\t\t\t *\n\t\t\t * @type jQuery\n\t\t\t **/\n\t\t\tcwd, \n\t\t\t/**\n\t\t\t * Current directory hash\n\t\t\t *\n\t\t\t * @type String\n\t\t\t **/\n\t\t\tcwdHash,\n\t\t\tdockEnabled = false,\n\t\t\tnavdrag = false,\n\t\t\tnavmove = false,\n\t\t\tnavtm   = null,\n\t\t\tleftKey = $.ui.keyCode.LEFT,\n\t\t\trightKey = $.ui.keyCode.RIGHT,\n\t\t\tcoverEv = 'mousemove touchstart ' + ('onwheel' in document? 'wheel' : 'onmousewheel' in document? 'mousewheel' : 'DOMMouseScroll'),\n\t\t\ttitle   = $('<span class=\"elfinder-dialog-title elfinder-quicklook-title\"/>'),\n\t\t\ticon    = $('<div/>'),\n\t\t\tinfo    = $('<div class=\"elfinder-quicklook-info\"/>'),//.hide(),\n\t\t\tcover   = $('<div class=\"ui-front elfinder-quicklook-cover\"/>'),\n\t\t\tfsicon  = $('<div class=\"'+navicon+' '+navicon+'-fullscreen\"/>')\n\t\t\t\t.on('click touchstart', function(e) {\n\t\t\t\t\tif (navmove) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar win     = self.window,\n\t\t\t\t\t\tfull    = win.hasClass(fullscreen),\n\t\t\t\t\t\t$window = $(window),\n\t\t\t\t\t\tresize  = function() { self.preview.trigger('changesize'); };\n\t\t\t\t\t\t\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\n\t\t\t\t\tif (full) {\n\t\t\t\t\t\tnavStyle = '';\n\t\t\t\t\t\tnavShow();\n\t\t\t\t\t\twin.toggleClass(fullscreen)\n\t\t\t\t\t\t.css(win.data('position'));\n\t\t\t\t\t\t$window.trigger(self.resize).off(self.resize, resize);\n\t\t\t\t\t\tnavbar.off('mouseenter mouseleave');\n\t\t\t\t\t\tcover.off(coverEv);\n\t\t\t\t\t} else {\n\t\t\t\t\t\twin.toggleClass(fullscreen)\n\t\t\t\t\t\t.data('position', {\n\t\t\t\t\t\t\tleft   : win.css('left'), \n\t\t\t\t\t\t\ttop    : win.css('top'), \n\t\t\t\t\t\t\twidth  : win.width(), \n\t\t\t\t\t\t\theight : win.height(),\n\t\t\t\t\t\t\tdisplay: 'block'\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.removeAttr('style');\n\n\t\t\t\t\t\t$(window).on(self.resize, resize)\n\t\t\t\t\t\t.trigger(self.resize);\n\n\t\t\t\t\t\tcover.on(coverEv, function(e) {\n\t\t\t\t\t\t\tif (! navdrag) {\n\t\t\t\t\t\t\t\tif (e.type === 'mousemove' || e.type === 'touchstart') {\n\t\t\t\t\t\t\t\t\tnavShow();\n\t\t\t\t\t\t\t\t\tnavtm = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tif (fm.UA.Mobile || navbar.parent().find('.elfinder-quicklook-navbar:hover').length < 1) {\n\t\t\t\t\t\t\t\t\t\t\tnavbar.fadeOut('slow', function() {\n\t\t\t\t\t\t\t\t\t\t\t\tcover.show();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, 3000);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (cover.is(':visible')) {\n\t\t\t\t\t\t\t\t\tcoverHide();\n\t\t\t\t\t\t\t\t\tcover.data('tm', setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tcover.show();\n\t\t\t\t\t\t\t\t\t}, 3000));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).show().trigger('mousemove');\n\t\t\t\t\t\t\n\t\t\t\t\t\tnavbar.on('mouseenter mouseleave', function(e) {\n\t\t\t\t\t\t\tif (! navdrag) {\n\t\t\t\t\t\t\t\tif (e.type === 'mouseenter') {\n\t\t\t\t\t\t\t\t\tnavShow();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcover.trigger('mousemove');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (fm.zIndex) {\n\t\t\t\t\t\twin.css('z-index', fm.zIndex + 1);\n\t\t\t\t\t}\n\t\t\t\t\tif (fm.UA.Mobile) {\n\t\t\t\t\t\tnavbar.attr('style', navStyle);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnavbar.attr('style', navStyle).draggable(full ? 'destroy' : {\n\t\t\t\t\t\t\tstart: function() {\n\t\t\t\t\t\t\t\tnavdrag = true;\n\t\t\t\t\t\t\t\tnavmove = true;\n\t\t\t\t\t\t\t\tcover.show();\n\t\t\t\t\t\t\t\tnavShow();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstop: function() {\n\t\t\t\t\t\t\t\tnavdrag = false;\n\t\t\t\t\t\t\t\tnavStyle = self.navbar.attr('style');\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tnavmove = false;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t$(this).toggleClass(navicon+'-fullscreen-off');\n\t\t\t\t\tvar collection = win;\n\t\t\t\t\tif (parent.is('.ui-resizable')) {\n\t\t\t\t\t\tcollection = collection.add(parent);\n\t\t\t\t\t}\n\t\t\t\t\tcollection.resizable(full ? 'enable' : 'disable').removeClass('ui-state-disabled');\n\n\t\t\t\t\twin.trigger('viewchange');\n\t\t\t\t}\n\t\t\t),\n\t\t\t\n\t\t\tupdateOnSel = function() {\n\t\t\t\tself.update(void(0), (function() {\n\t\t\t\t\tvar fm = self.fm,\n\t\t\t\t\t\tfiles = fm.selectedFiles(),\n\t\t\t\t\t\tcnt = files.length,\n\t\t\t\t\t\tinDock = self.docked(),\n\t\t\t\t\t\tgetInfo = function() {\n\t\t\t\t\t\t\tvar ts = 0;\n\t\t\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\t\t\tvar t = parseInt(f.ts);\n\t\t\t\t\t\t\t\tif (ts >= 0) {\n\t\t\t\t\t\t\t\t\tif (t > ts) {\n\t\t\t\t\t\t\t\t\t\tts = t;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tts = 'unknown';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\thash : files[0].hash  + '/' + (+new Date()),\n\t\t\t\t\t\t\t\tname : fm.i18n('items') + ': ' + cnt,\n\t\t\t\t\t\t\t\tmime : 'group',\n\t\t\t\t\t\t\t\tsize : spinner,\n\t\t\t\t\t\t\t\tts   : ts,\n\t\t\t\t\t\t\t\tfiles : $.map(files, function(f) { return f.hash; }),\n\t\t\t\t\t\t\t\tgetSize : true\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\tif (! cnt) {\n\t\t\t\t\t\tcnt = 1;\n\t\t\t\t\t\tfiles = [fm.cwd()];\n\t\t\t\t\t}\n\t\t\t\t\treturn (cnt === 1)? files[0] : getInfo();\n\t\t\t\t})());\n\t\t\t},\n\t\t\t\n\t\t\tnavShow = function() {\n\t\t\t\tif (self.window.hasClass(fullscreen)) {\n\t\t\t\t\tnavtm && clearTimeout(navtm);\n\t\t\t\t\tnavtm = null;\n\t\t\t\t\t// if use `show()` it make infinite loop with old jQuery (jQuery/jQuery UI: 1.8.0/1.9.0)\n\t\t\t\t\t// see #1478 https://github.com/Studio-42/elFinder/issues/1478\n\t\t\t\t\tnavbar.stop(true, true).css('display', 'block');\n\t\t\t\t\tcoverHide();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tcoverHide = function() {\n\t\t\t\tcover.data('tm') && clearTimeout(cover.data('tm'));\n\t\t\t\tcover.removeData('tm');\n\t\t\t\tcover.hide();\n\t\t\t},\n\t\t\t\t\n\t\t\tprev = $('<div class=\"'+navicon+' '+navicon+'-prev\"/>').on('click touchstart', function(e) { ! navmove && navtrigger(leftKey); return false; }),\n\t\t\tnext = $('<div class=\"'+navicon+' '+navicon+'-next\"/>').on('click touchstart', function(e) { ! navmove && navtrigger(rightKey); return false; }),\n\t\t\tnavbar  = $('<div class=\"elfinder-quicklook-navbar\"/>')\n\t\t\t\t.append(prev)\n\t\t\t\t.append(fsicon)\n\t\t\t\t.append(next)\n\t\t\t\t.append('<div class=\"elfinder-quicklook-navbar-separator\"/>')\n\t\t\t\t.append($('<div class=\"'+navicon+' '+navicon+'-close\"/>').on('click touchstart', function(e) { ! navmove && self.window.trigger('close'); return false; }))\n\t\t\t,\n\t\t\ttitleClose = $('<span class=\"ui-front ui-icon elfinder-icon-close ui-icon-closethick\"/>').on('mousedown', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tself.window.trigger('close');\n\t\t\t}),\n\t\t\ttitleDock = $('<span class=\"ui-front ui-icon elfinder-icon-minimize ui-icon-minusthick\"/>').on('mousedown', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tif (! self.docked()) {\n\t\t\t\t\tself.window.trigger('navdockin');\n\t\t\t\t} else {\n\t\t\t\t\tself.window.trigger('navdockout');\n\t\t\t\t}\n\t\t\t}),\n\t\t\tspinner = '<span class=\"elfinder-spinner-text\">' + fm.i18n('calc') + '</span>' + '<span class=\"elfinder-spinner\"/>',\n\t\t\tnavStyle = '',\n\t\t\tinit = true,\n\t\t\tdockHeight,\tgetSize, tm4cwd, dockedNode, selectTm;\n\n\t\t/**\n\t\t * Any flags for each plugin\n\t\t */\n\t\tthis.flags = {};\n\t\t\n\t\tthis.cover = cover;\n\t\tthis.evUpdate = evUpdate;\n\t\t(this.navbar = navbar)._show = navShow;\n\t\tthis.resize = 'resize.'+fm.namespace;\n\t\tthis.info = $('<div/>').addClass(infocls)\n\t\t\t.append(icon)\n\t\t\t.append(info);\n\t\tthis.autoPlay = function() {\n\t\t\tif (self.opened()) {\n\t\t\t\treturn !! self.options[self.docked()? 'dockAutoplay' : 'autoplay'];\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\tthis.preview = $('<div class=\"elfinder-quicklook-preview ui-helper-clearfix\"/>')\n\t\t\t// clean info/icon\n\t\t\t.on('change', function() {\n\t\t\t\tnavShow();\n\t\t\t\tnavbar.attr('style', navStyle);\n\t\t\t\tself.docked() && navbar.hide();\n\t\t\t\tself.preview.attr('style', '').removeClass('elfinder-overflow-auto');\n\t\t\t\tself.info.attr('style', '').hide();\n\t\t\t\tself.cover.removeClass('elfinder-quicklook-coverbg');\n\t\t\t\ticon.removeAttr('class').attr('style', '');\n\t\t\t\tinfo.html('');\n\t\t\t})\n\t\t\t// update info/icon\n\t\t\t.on(evUpdate, function(e) {\n\t\t\t\tvar preview = self.preview,\n\t\t\t\t\tfile    = e.file,\n\t\t\t\t\ttpl     = '<div class=\"elfinder-quicklook-info-data\">{value}</div>',\n\t\t\t\t\tupdate  = function() {\n\t\t\t\t\t\tvar win = self.window.css('overflow', 'hidden');\n\t\t\t\t\t\tname = fm.escape(file.i18 || file.name);\n\t\t\t\t\t\t!file.read && e.stopImmediatePropagation();\n\t\t\t\t\t\tself.window.data('hash', file.hash);\n\t\t\t\t\t\tself.preview.off('changesize').trigger('change').children().remove();\n\t\t\t\t\t\ttitle.html(name);\n\t\t\t\t\t\t\n\t\t\t\t\t\tprev.css('visibility', '');\n\t\t\t\t\t\tnext.css('visibility', '');\n\t\t\t\t\t\tif (file.hash === fm.cwdId2Hash(cwd.find('[id]:not(.elfinder-cwd-parent):first').attr('id'))) {\n\t\t\t\t\t\t\tprev.css('visibility', 'hidden');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (file.hash === fm.cwdId2Hash(cwd.find('[id]:last').attr('id'))) {\n\t\t\t\t\t\t\tnext.css('visibility', 'hidden');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.mime === 'directory') {\n\t\t\t\t\t\t\tgetSizeHashes = [ file.hash ];\n\t\t\t\t\t\t} else if (file.mime === 'group' && file.getSize) {\n\t\t\t\t\t\t\tgetSizeHashes = file.files;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tinfo.html(\n\t\t\t\t\t\t\ttpl.replace(/\\{value\\}/, name)\n\t\t\t\t\t\t\t+ tpl.replace(/\\{value\\}/, fm.mime2kind(file))\n\t\t\t\t\t\t\t+ tpl.replace(/\\{value\\}/, getSizeHashes.length ? spinner : fm.formatSize(file.size))\n\t\t\t\t\t\t\t+ tpl.replace(/\\{value\\}/, fm.i18n('modify')+': '+ fm.formatDate(file))\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (getSizeHashes.length) {\n\t\t\t\t\t\t\tgetSize = fm.getSize(getSizeHashes).done(function(data) {\n\t\t\t\t\t\t\t\tinfo.find('span.elfinder-spinner').parent().html(data.formated);\n\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\tinfo.find('span.elfinder-spinner').parent().html(fm.i18n('unknown'));\n\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\tgetSize = null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tgetSize._hash = file.hash;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\ticon.addClass('elfinder-cwd-icon ui-corner-all '+fm.mime2class(file.mime));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (file.icon) {\n\t\t\t\t\t\t\ticon.css(fm.getIconStyle(file, true));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.info.attr('class', infocls);\n\t\t\t\t\t\tif (file.csscls) {\n\t\t\t\t\t\t\tself.info.addClass(file.csscls);\n\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t\tif (file.read && (tmb = fm.tmb(file))) {\n\t\t\t\t\t\t\t$('<img/>')\n\t\t\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t\t\t.appendTo(self.preview)\n\t\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\t\ticon.addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\");\n\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.info.delay(100).fadeIn(10);\n\t\t\t\t\t\tif (self.window.hasClass(fullscreen)) {\n\t\t\t\t\t\t\tcover.trigger('mousemove');\n\t\t\t\t\t\t}\n\t\t\t\t\t\twin.css('overflow', '');\n\t\t\t\t\t},\n\t\t\t\t\ttmb, name, getSizeHashes = [];\n\n\t\t\t\tif (file && ! Object.keys(file).length) {\n\t\t\t\t\tfile = fm.cwd();\n\t\t\t\t}\n\t\t\t\tif (file && getSize && getSize.state() === 'pending' && getSize._hash !== file.hash) {\n\t\t\t\t\tgetSize.reject();\n\t\t\t\t}\n\t\t\t\tif (file && (e.forceUpdate || self.window.data('hash') !== file.hash)) {\n\t\t\t\t\tupdate();\n\t\t\t\t} else { \n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.window = $('<div class=\"ui-front ui-helper-reset ui-widget elfinder-quicklook touch-punch\" style=\"position:absolute\"/>')\n\t\t\t.hide()\n\t\t\t.addClass(fm.UA.Touch? 'elfinder-touch' : '')\n\t\t\t.on('click', function(e) {\n\t\t\t\tvar win = this;\n\t\t\t\te.stopPropagation();\n\t\t\t\tif (state === opened) {\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tstate === opened && fm.toFront(win);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.append(\n\t\t\t\t$('<div class=\"ui-dialog-titlebar ui-widget-header ui-corner-top ui-helper-clearfix elfinder-quicklook-titlebar\"/>')\n\t\t\t\t.append(\n\t\t\t\t\t$('<span class=\"ui-widget-header ui-dialog-titlebar-close ui-corner-all elfinder-titlebar-button elfinder-quicklook-titlebar-icon'+(platformWin? ' elfinder-titlebar-button-right' : '')+'\"/>').append(\n\t\t\t\t\t\ttitleClose, titleDock\n\t\t\t\t\t),\n\t\t\t\t\ttitle\n\t\t\t\t),\n\t\t\t\tthis.preview,\n\t\t\t\tself.info.hide(),\n\t\t\t\tcover.hide(),\n\t\t\t\tnavbar\n\t\t\t)\n\t\t\t.draggable({handle : 'div.elfinder-quicklook-titlebar'})\n\t\t\t.on('open', function(e, clcss) {\n\t\t\t\tvar win  = self.window, \n\t\t\t\t\tfile = self.value,\n\t\t\t\t\tnode = fm.getUI('cwd'),\n\t\t\t\t\topen = function(status) {\n\t\t\t\t\t\tstate = status;\n\t\t\t\t\t\tself.update(1, self.value);\n\t\t\t\t\t\tself.change();\n\t\t\t\t\t\twin.trigger('resize.' + fm.namespace);\n\t\t\t\t\t};\n\n\t\t\t\tif (!init && state === closed) {\n\t\t\t\t\tif (file && file.hash !== cwdHash) {\n\t\t\t\t\t\tnode = fm.cwdHash2Elm(file.hash.split('/', 2)[0]);\n\t\t\t\t\t}\n\t\t\t\t\tnavStyle = '';\n\t\t\t\t\tnavbar.attr('style', '');\n\t\t\t\t\tstate = animated;\n\t\t\t\t\tnode.trigger('scrolltoview');\n\t\t\t\t\tcoverHide();\n\t\t\t\t\twin.css(clcss || closedCss(node))\n\t\t\t\t\t\t.show()\n\t\t\t\t\t\t.animate(openedCss(), 550, function() {\n\t\t\t\t\t\t\topen(opened);\n\t\t\t\t\t\t\tnavShow();\n\t\t\t\t\t\t});\n\t\t\t\t\tfm.toFront(win);\n\t\t\t\t} else if (state === dockedhidden) {\n\t\t\t\t\tfm.getUI('navdock').data('addNode')(dockedNode);\n\t\t\t\t\topen(docked);\n\t\t\t\t\tself.preview.trigger('changesize');\n\t\t\t\t\tfm.storage('previewDocked', '1');\n\t\t\t\t\tif (fm.getUI('navdock').width() === 0) {\n\t\t\t\t\t\twin.trigger('navdockout');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('close', function(e, dfd) {\n\t\t\t\tvar win     = self.window,\n\t\t\t\t\tpreview = self.preview.trigger('change'),\n\t\t\t\t\tfile    = self.value,\n\t\t\t\t\thash    = (win.data('hash') || '').split('/', 2)[0],\n\t\t\t\t\tclose   = function(status, winhide) {\n\t\t\t\t\t\tstate = status;\n\t\t\t\t\t\twinhide && fm.toHide(win);\n\t\t\t\t\t\tpreview.children().remove();\n\t\t\t\t\t\tself.update(0, self.value);\n\t\t\t\t\t\twin.data('hash', '');\n\t\t\t\t\t\tdfd && dfd.resolve();\n\t\t\t\t\t},\n\t\t\t\t\tnode;\n\t\t\t\t\t\n\t\t\t\tif (self.opened()) {\n\t\t\t\t\tgetSize && getSize.state() === 'pending' && getSize.reject();\n\t\t\t\t\tif (! self.docked()) {\n\t\t\t\t\t\tstate = animated;\n\t\t\t\t\t\twin.hasClass(fullscreen) && fsicon.click();\n\t\t\t\t\t\t(hash && (node = cwd.find('#'+hash)).length)\n\t\t\t\t\t\t\t? win.animate(closedCss(node), 500, function() {\n\t\t\t\t\t\t\t\tpreview.off('changesize');\n\t\t\t\t\t\t\t\tclose(closed, true);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: close(closed, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdockedNode = fm.getUI('navdock').data('removeNode')(self.window.attr('id'), 'detach');\n\t\t\t\t\t\tclose(dockedhidden);\n\t\t\t\t\t\tfm.storage('previewDocked', '2');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('navdockin', function(e, data) {\n\t\t\t\tvar w      = self.window,\n\t\t\t\t\tbox    = fm.getUI('navdock'),\n\t\t\t\t\theight = dockHeight || box.width(),\n\t\t\t\t\topts   = data || {};\n\t\t\t\t\n\t\t\t\tif (init) {\n\t\t\t\t\topts.init = true;\n\t\t\t\t}\n\t\t\t\tstate = docked;\n\t\t\t\tprevStyle = w.attr('style');\n\t\t\t\tw.toggleClass('ui-front').removeClass('ui-widget').draggable('disable').resizable('disable').removeAttr('style').css({\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: height,\n\t\t\t\t\tboxSizing: 'border-box',\n\t\t\t\t\tpaddingBottom: 0,\n\t\t\t\t\tzIndex: 'unset'\n\t\t\t\t});\n\t\t\t\tnavbar.hide();\n\t\t\t\ttitleDock.toggleClass('ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize');\n\t\t\t\t\n\t\t\t\tfm.toHide(w, true);\n\t\t\t\tbox.data('addNode')(w, opts);\n\t\t\t\t\n\t\t\t\tself.preview.trigger('changesize');\n\t\t\t\t\n\t\t\t\tfm.storage('previewDocked', '1');\n\t\t\t})\n\t\t\t.on('navdockout', function(e) {\n\t\t\t\tvar w   = self.window,\n\t\t\t\t\tbox = fm.getUI('navdock'),\n\t\t\t\t\tdfd = $.Deferred(),\n\t\t\t\t\tclcss = closedCss(self.preview);\n\t\t\t\t\n\t\t\t\tdockHeight = w.outerHeight();\n\t\t\t\tbox.data('removeNode')(w.attr('id'), fm.getUI());\n\t\t\t\tw.toggleClass('ui-front').addClass('ui-widget').draggable('enable').resizable('enable').attr('style', prevStyle);\n\t\t\t\ttitleDock.toggleClass('ui-icon-plusthick ui-icon-minusthick elfinder-icon-full elfinder-icon-minimize');\n\t\t\t\t\n\t\t\t\tstate = closed;\n\t\t\t\tw.trigger('open', clcss);\n\t\t\t\t\n\t\t\t\tfm.storage('previewDocked', '0');\n\t\t\t})\n\t\t\t.on('resize.' + fm.namespace, function() {\n\t\t\t\tself.preview.trigger('changesize'); \n\t\t\t});\n\n\t\t/**\n\t\t * This command cannot be disable by backend\n\t\t *\n\t\t * @type Boolean\n\t\t **/\n\t\tthis.alwaysEnabled = true;\n\t\t\n\t\t/**\n\t\t * Selected file\n\t\t *\n\t\t * @type Object\n\t\t **/\n\t\tthis.value = null;\n\t\t\n\t\tthis.handlers = {\n\t\t\t// save selected file\n\t\t\tselect : function(e, d) {\n\t\t\t\tselectTm && cancelAnimationFrame(selectTm);\n\t\t\t\tif (! e.data || ! e.data.selected || ! e.data.selected.length) {\n\t\t\t\t\tselectTm = requestAnimationFrame(function() {\n\t\t\t\t\t\tself.opened() && updateOnSel();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tself.opened() && updateOnSel();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror  : function() { self.window.is(':visible') && self.window.trigger('close'); },\n\t\t\t'searchshow searchhide' : function() { this.opened() && this.window.trigger('close'); },\n\t\t\tnavbarshow : function() {\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.docked() && self.preview.trigger('changesize');\n\t\t\t\t});\n\t\t\t},\n\t\t\tdestroy : function() { self.window.remove(); }\n\t\t};\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'space'\n\t\t}];\n\t\t\n\t\tthis.support = {\n\t\t\taudio : {\n\t\t\t\togg : support('audio/ogg;'),\n\t\t\t\twebm: support('audio/webm;'),\n\t\t\t\tmp3 : support('audio/mpeg;'),\n\t\t\t\twav : support('audio/wav;'),\n\t\t\t\tm4a : support('audio/mp4;') || support('audio/x-m4a;') || support('audio/aac;'),\n\t\t\t\tflac: support('audio/flac;'),\n\t\t\t\tamr : support('audio/amr;')\n\t\t\t},\n\t\t\tvideo : {\n\t\t\t\togg  : support('video/ogg;'),\n\t\t\t\twebm : support('video/webm;'),\n\t\t\t\tmp4  : support('video/mp4;'),\n\t\t\t\tmkv  : support('video/x-matroska;') || support('video/webm;'),\n\t\t\t\t'3gp': support('video/3gpp;') || support('video/mp4;'), // try as mp4\n\t\t\t\tm3u8 : support('application/x-mpegURL', 'video') || support('application/vnd.apple.mpegURL', 'video'),\n\t\t\t\tmpd  : support('application/dash+xml', 'video')\n\t\t\t}\n\t\t};\n\t\t// for GC\n\t\tmediaNode = {};\n\t\t\n\t\t/**\n\t\t * Return true if quickLoock window is hiddenReturn true if quickLoock window is visible and not animated\n\t\t *\n\t\t * @return Boolean\n\t\t **/\n\t\tthis.closed = function() {\n\t\t\treturn (state == closed || state == dockedhidden);\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if quickLoock window is visible and not animated\n\t\t *\n\t\t * @return Boolean\n\t\t **/\n\t\tthis.opened = function() {\n\t\t\treturn state == opened || state == docked;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Return true if quickLoock window is in NavDock\n\t\t *\n\t\t * @return Boolean\n\t\t **/\n\t\tthis.docked = function() {\n\t\t\treturn state == docked;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Adds an integration into help dialog.\n\t\t *\n\t\t * @param Object opts  options\n\t\t */\n\t\tthis.addIntegration = function(opts) {\n\t\t\trequestAnimationFrame(function() {\n\t\t\t\tfm.trigger('helpIntegration', Object.assign({cmd: 'quicklook'}, opts));\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Init command.\n\t\t * Add default plugins and init other plugins\n\t\t *\n\t\t * @return Object\n\t\t **/\n\t\tthis.init = function() {\n\t\t\tvar o       = this.options, \n\t\t\t\twin     = this.window,\n\t\t\t\tpreview = this.preview,\n\t\t\t\ti, p, cwdDispInlineRegex;\n\t\t\t\n\t\t\twidth  = o.width  > 0 ? parseInt(o.width)  : 450;\t\n\t\t\theight = o.height > 0 ? parseInt(o.height) : 300;\n\t\t\tif (o.dockHeight !== 'auto') {\n\t\t\t\tdockHeight = parseInt(o.dockHeight);\n\t\t\t\tif (! dockHeight) {\n\t\t\t\t\tdockHeight = void(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfm.one('load', function() {\n\t\t\t\t\n\t\t\t\tdockEnabled = fm.getUI('navdock').data('dockEnabled');\n\t\t\t\t\n\t\t\t\t! dockEnabled && titleDock.hide();\n\t\t\t\t\n\t\t\t\tparent = fm.getUI();\n\t\t\t\tcwd    = fm.getUI('cwd');\n\n\t\t\t\tif (fm.zIndex) {\n\t\t\t\t\twin.css('z-index', fm.zIndex + 1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twin.appendTo(parent);\n\t\t\t\t\n\t\t\t\t// close window on escape\n\t\t\t\t$(document).on('keydown.'+fm.namespace, function(e) {\n\t\t\t\t\te.keyCode == $.ui.keyCode.ESCAPE && self.opened() && ! self.docked() && win.hasClass('elfinder-frontmost') && win.trigger('close');\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\twin.resizable({ \n\t\t\t\t\thandles   : 'se', \n\t\t\t\t\tminWidth  : 350, \n\t\t\t\t\tminHeight : 120, \n\t\t\t\t\tresize    : function() { \n\t\t\t\t\t\t// use another event to avoid recursion in fullscreen mode\n\t\t\t\t\t\t// may be there is clever solution, but i cant find it :(\n\t\t\t\t\t\tpreview.trigger('changesize'); \n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.change(function() {\n\t\t\t\t\tif (self.opened()) {\n\t\t\t\t\t\tif (self.value) {\n\t\t\t\t\t\t\tif (self.value.tmb && self.value.tmb == 1) {\n\t\t\t\t\t\t\t\t// try re-get file object\n\t\t\t\t\t\t\t\tself.value = Object.assign({}, fm.file(self.value.hash));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpreview.trigger($.Event(evUpdate, {file : self.value}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tpreview.on(evUpdate, function(e) {\n\t\t\t\t\tvar file, hash, serach;\n\t\t\t\t\t\n\t\t\t\t\tif (file = e.file) {\n\t\t\t\t\t\thash = file.hash;\n\t\t\t\t\t\tserach = (fm.searchStatus.mixed && fm.searchStatus.state > 1);\n\t\t\t\t\t\n\t\t\t\t\t\tif (file.mime !== 'directory') {\n\t\t\t\t\t\t\tif (parseInt(file.size) || file.mime.match(o.mimeRegexNotEmptyCheck)) {\n\t\t\t\t\t\t\t\t// set current dispInlineRegex\n\t\t\t\t\t\t\t\tself.dispInlineRegex = cwdDispInlineRegex;\n\t\t\t\t\t\t\t\tif (serach || fm.optionsByHashes[hash]) {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tself.dispInlineRegex = new RegExp(fm.option('dispInlineRegex', hash), 'i');\n\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tself.dispInlineRegex = new RegExp(!fm.isRoot(file)? fm.option('dispInlineRegex', file.phash) : fm.options.dispInlineRegex, 'i');\n\t\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\t\tself.dispInlineRegex = /^$/;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t//  do not preview of file that size = 0\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.dispInlineRegex = /^$/;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.info.show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$.each(fm.commands.quicklook.plugins || [], function(i, plugin) {\n\t\t\t\t\tif (typeof(plugin) == 'function') {\n\t\t\t\t\t\tnew plugin(self);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).one('open', function() {\n\t\t\t\tvar dock = Number(fm.storage('previewDocked') || o.docked),\n\t\t\t\t\twin;\n\t\t\t\tif (dockEnabled && dock >= 1) {\n\t\t\t\t\twin = self.window;\n\t\t\t\t\tself.exec();\n\t\t\t\t\twin.trigger('navdockin', { init : true });\n\t\t\t\t\tif (dock === 2) {\n\t\t\t\t\t\twin.trigger('close');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.update(void(0), fm.cwd());\n\t\t\t\t\t\tself.change();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tinit = false;\n\t\t\t}).bind('open', function() {\n\t\t\t\tcwdHash = fm.cwd().hash;\n\t\t\t\tself.value = fm.cwd();\n\t\t\t\t// set current volume dispInlineRegex\n\t\t\t\ttry {\n\t\t\t\t\tcwdDispInlineRegex = new RegExp(fm.option('dispInlineRegex'), 'i');\n\t\t\t\t} catch(e) {\n\t\t\t\t\tcwdDispInlineRegex = /^$/;\n\t\t\t\t}\n\t\t\t}).bind('change', function(e) {\n\t\t\t\tif (e.data && e.data.changed && self.opened()) {\n\t\t\t\t\t$.each(e.data.changed, function() {\n\t\t\t\t\t\tif (self.window.data('hash') === this.hash) {\n\t\t\t\t\t\t\tself.window.data('hash', null);\n\t\t\t\t\t\t\tself.preview.trigger(evUpdate);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).bind('navdockresizestart navdockresizestop', function(e) {\n\t\t\t\tcover[e.type === 'navdockresizestart'? 'show' : 'hide']();\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn self.opened()? 1 : 0;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tself.closed() && updateOnSel();\n\t\t\tself.enabled() && self.window.trigger(self.opened() ? 'close' : 'open');\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\n\t\tthis.hideinfo = function() {\n\t\t\tthis.info.stop(true, true).hide();\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/quicklook.plugins',[\n\t\"../elFinder\"\n],function(elFinder){\n\telFinder.prototype.commands.quicklook.plugins = [\n\t\t\n\t\t/**\n\t\t * Images preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar mimes   = ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml', 'image/x-ms-bmp'],\n\t\t\t\tgetDimSize = ql.fm.returnBytes((ql.options.getDimThreshold || 0)),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tWebP, flipMime;\n\t\t\t\n\t\t\t// webp support\n\t\t\tWebP = new Image();\n\t\t\tWebP.onload = WebP.onerror = function() {\n\t\t\t\tif (WebP.height == 2) {\n\t\t\t\t\tmimes.push('image/webp');\n\t\t\t\t}\n\t\t\t};\n\t\t\tWebP.src='data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';\n\t\t\t\n\t\t\t// what kind of images we can display\n\t\t\t$.each(navigator.mimeTypes, function(i, o) {\n\t\t\t\tvar mime = o.type;\n\t\t\t\t\n\t\t\t\tif (mime.indexOf('image/') === 0 && $.inArray(mime, mimes)) {\n\t\t\t\t\tmimes.push(mime);\n\t\t\t\t} \n\t\t\t});\n\t\t\t\t\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar fm   = ql.fm,\n\t\t\t\t\tfile = e.file,\n\t\t\t\t\tshowed = false,\n\t\t\t\t\tdimreq = null,\n\t\t\t\t\tsetdim  = function(dim) {\n\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\trfile.width = dim[0];\n\t\t\t\t\t\trfile.height = dim[1];\n\t\t\t\t\t},\n\t\t\t\t\tshow = function() {\n\t\t\t\t\t\tvar elm, varelm, memSize, width, height, prop;\n\t\t\t\t\t\t\n\t\t\t\t\t\tdimreq && dimreq.state && dimreq.state() === 'pending' && dimreq.reject();\n\t\t\t\t\t\tif (showed) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshowed = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\telm = img.get(0);\n\t\t\t\t\t\tmemSize = file.width && file.height? {w: file.width, h: file.height} : (elm.naturalWidth? null : {w: img.width(), h: img.height()});\n\t\t\t\t\t\n\t\t\t\t\t\tmemSize && img.removeAttr('width').removeAttr('height');\n\t\t\t\t\t\t\n\t\t\t\t\t\twidth  = file.width || elm.naturalWidth || elm.width || img.width();\n\t\t\t\t\t\theight = file.height || elm.naturalHeight || elm.height || img.height();\n\t\t\t\t\t\tif (!file.width || !file.height) {\n\t\t\t\t\t\t\tsetdim([width, height]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tmemSize && img.width(memSize.w).height(memSize.h);\n\n\t\t\t\t\t\tprop = (width/height).toFixed(2);\n\t\t\t\t\t\tpreview.on('changesize', function() {\n\t\t\t\t\t\t\tvar pw = parseInt(preview.width()),\n\t\t\t\t\t\t\t\tph = parseInt(preview.height()),\n\t\t\t\t\t\t\t\tw, h;\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (prop < (pw/ph).toFixed(2)) {\n\t\t\t\t\t\t\t\th = ph;\n\t\t\t\t\t\t\t\tw = Math.floor(h * prop);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tw = pw;\n\t\t\t\t\t\t\t\th = Math.floor(w/prop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\timg.width(w).height(h).css('margin-top', h < ph ? Math.floor((ph - h)/2) : 0);\n\t\t\t\t\t\t\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.trigger('changesize');\n\t\t\t\t\t\t\n\t\t\t\t\t\t//show image\n\t\t\t\t\t\timg.fadeIn(100);\n\t\t\t\t\t},\n\t\t\t\t\thideInfo = function() {\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t// hide info/icon\n\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t},\n\t\t\t\t\turl, img, loading, prog, m, opDfd;\n\n\t\t\t\tif (!flipMime) {\n\t\t\t\t\tflipMime = fm.arrayFlip(mimes);\n\t\t\t\t}\n\t\t\t\tif (flipMime[file.mime] && ql.dispInlineRegex.test(file.mime)) {\n\t\t\t\t\t// this is our file - stop event propagation\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\n\t\t\t\t\timg = $('<img/>')\n\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t.appendTo(preview)\n\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\thideInfo();\n\t\t\t\t\t\t\tshow();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\timg.attr('src', url);\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (file.width && file.height) {\n\t\t\t\t\t\tshow();\n\t\t\t\t\t} else if (file.size > getDimSize) {\n\t\t\t\t\t\tdimreq = fm.request({\n\t\t\t\t\t\t\tdata : {cmd : 'dim', target : file.hash},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tif (data.dim) {\n\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\n\t\t\t\t\t\t\t\tfile.width = dim[0];\n\t\t\t\t\t\t\t\tfile.height = dim[1];\n\t\t\t\t\t\t\t\tsetdim(dim);\n\t\t\t\t\t\t\t\tshow();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * TIFF image preview\n\t\t *\n\t\t * @param  object  ql  elFinder.commands.quicklook\n\t\t */\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm   = ql.fm,\n\t\t\t\tmime = 'image/tiff',\n\t\t\t\tpreview = ql.preview;\n\t\t\tif (window.Worker && window.Uint8Array) {\n\t\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\t\tvar file = e.file,\n\t\t\t\t\t\terr = function(e) {\n\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\tfm.debug('error', e);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetdim = function(dim) {\n\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\trfile.width = dim[0];\n\t\t\t\t\t\t\trfile.height = dim[1];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tloading, prog, url, base, wk, opDfd;\n\t\t\t\t\tif (file.mime === mime) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\topDfd = fm.getContents(file.hash, 'arraybuffer', { progressBar: prog }).done(function(data) {\n\t\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\t\tbase = $('<div/>').css({width:'100%',height:'100%'}).hide().appendTo(preview);\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\twk = fm.getWorker();\n\t\t\t\t\t\t\t\t\twk.onmessage = function(res) {\n\t\t\t\t\t\t\t\t\t\tvar data = res.data,\n\t\t\t\t\t\t\t\t\t\t\tcv, co, id, prop;\n\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t\tcv = document.createElement('canvas');\n\t\t\t\t\t\t\t\t\t\tco = cv.getContext('2d');\n\t\t\t\t\t\t\t\t\t\tcv.width = data.width;\n\t\t\t\t\t\t\t\t\t\tcv.height = data.height;\n\t\t\t\t\t\t\t\t\t\tid = co.createImageData(data.width, data.height);\n\t\t\t\t\t\t\t\t\t\t(id).data.set(new Uint8Array(data.image));\n\t\t\t\t\t\t\t\t\t\tco.putImageData(id, 0, 0);\n\t\t\t\t\t\t\t\t\t\tbase.append(cv).show();\n\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\tprop = (data.width/data.height).toFixed(2);\n\t\t\t\t\t\t\t\t\t\tpreview.on('changesize', function() {\n\t\t\t\t\t\t\t\t\t\t\tvar pw = parseInt(preview.width()),\n\t\t\t\t\t\t\t\t\t\t\t\tph = parseInt(preview.height()),\n\t\t\t\t\t\t\t\t\t\t\t\tw, h;\n\t\t\t\t\t\t\t\t\t\t\tif (prop < (pw/ph).toFixed(2)) {\n\t\t\t\t\t\t\t\t\t\t\t\th = ph;\n\t\t\t\t\t\t\t\t\t\t\t\tw = Math.floor(h * prop);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tw = pw;\n\t\t\t\t\t\t\t\t\t\t\t\th = Math.floor(w/prop);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t$(cv).width(w).height(h).css('margin-top', h < ph ? Math.floor((ph - h)/2) : 0);\n\t\t\t\t\t\t\t\t\t\t}).trigger('changesize');\n\t\t\t\t\t\t\t\t\t\tif (!file.width || !file.height) {\n\t\t\t\t\t\t\t\t\t\t\tsetdim([data.width, data.height]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\twk.onerror = err;\n\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\tscripts: [fm.options.cdns.tiff, fm.getWorkerUrl('quicklook.tiff.js')],\n\t\t\t\t\t\t\t\t\t\tdata: { data: data }\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\terr(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\terr();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * PSD(Adobe Photoshop data) preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = fm.arrayFlip(['image/vnd.adobe.photoshop', 'image/x-photoshop']),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tload    = function(url, img, loading) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tfm.replaceXhrSend();\n\t\t\t\t\t\tPSD.fromURL(url).then(function(psd) {\n\t\t\t\t\t\t\tvar prop;\n\t\t\t\t\t\t\timg.attr('src', psd.image.toBase64());\n\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tprop = (img.width()/img.height()).toFixed(2);\n\t\t\t\t\t\t\t\tpreview.on('changesize', function() {\n\t\t\t\t\t\t\t\t\tvar pw = parseInt(preview.width()),\n\t\t\t\t\t\t\t\t\t\tph = parseInt(preview.height()),\n\t\t\t\t\t\t\t\t\t\tw, h;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (prop < (pw/ph).toFixed(2)) {\n\t\t\t\t\t\t\t\t\t\th = ph;\n\t\t\t\t\t\t\t\t\t\tw = Math.floor(h * prop);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tw = pw;\n\t\t\t\t\t\t\t\t\t\th = Math.floor(w/prop);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\timg.width(w).height(h).css('margin-top', h < ph ? Math.floor((ph - h)/2) : 0);\n\t\t\t\t\t\t\t\t}).trigger('changesize');\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t// hide info/icon\n\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\t//show image\n\t\t\t\t\t\t\t\timg.fadeIn(100);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\timg.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfm.restoreXhrSend();\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tfm.restoreXhrSend();\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\timg.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tPSD;\n\t\t\t\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file,\n\t\t\t\t\turl, img, loading, prog, m,\n\t\t\t\t\t_define, _require, opDfd;\n\n\t\t\t\tif (mimes[file.mime] && fm.options.cdns.psd && ! fm.UA.ltIE10 && ql.dispInlineRegex.test(file.mime)) {\n\t\t\t\t\t// this is our file - stop event propagation\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\topDfd = fm.openUrl(file.hash, 'sameorigin', function(url) {\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\timg = $('<img/>').hide().appendTo(preview);\n\t\t\t\t\t\t\tif (PSD) {\n\t\t\t\t\t\t\t\tload(url, img, loading);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t_define = window.define;\n\t\t\t\t\t\t\t\t_require = window.require;\n\t\t\t\t\t\t\t\twindow.require = null;\n\t\t\t\t\t\t\t\twindow.define = null;\n\t\t\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t\t\t[ fm.options.cdns.psd ],\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\tPSD = require('psd');\n\t\t\t\t\t\t\t\t\t\t_define? (window.define = _define) : (delete window.define);\n\t\t\t\t\t\t\t\t\t\t_require? (window.require = _require) : (delete window.require);\n\t\t\t\t\t\t\t\t\t\tload(url, img, loading);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * HTML preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = fm.arrayFlip(['text/html', 'application/xhtml+xml']),\n\t\t\t\tpreview = ql.preview;\n\t\t\t\t\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file, jqxhr, loading, prog;\n\t\t\t\t\n\t\t\t\tif (mimes[file.mime] && ql.dispInlineRegex.test(file.mime) && (!ql.options.getSizeMax || file.size <= ql.options.getSizeMax)) {\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\tjqxhr.state() == 'pending' && jqxhr.reject();\n\t\t\t\t\t}).addClass('elfinder-overflow-auto');\n\t\t\t\t\t\n\t\t\t\t\tjqxhr = fm.request({\n\t\t\t\t\t\tdata           : {cmd : 'get', target : file.hash, conv : 1, _t : file.ts},\n\t\t\t\t\t\toptions        : {type: 'get', cache : true},\n\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\tprogressBar    : prog\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\tvar doc = $('<iframe class=\"elfinder-quicklook-preview-html\"/>').appendTo(preview)[0].contentWindow.document;\n\t\t\t\t\t\tdoc.open();\n\t\t\t\t\t\tdoc.write(data.content);\n\t\t\t\t\t\tdoc.close();\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * MarkDown preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = fm.arrayFlip(['text/x-markdown']),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tmarked  = null,\n\t\t\t\tshow = function(data, loading) {\n\t\t\t\t\tql.hideinfo();\n\t\t\t\t\tvar doc = $('<iframe class=\"elfinder-quicklook-preview-html\"/>').appendTo(preview)[0].contentWindow.document;\n\t\t\t\t\tdoc.open();\n\t\t\t\t\tdoc.write(marked(data.content));\n\t\t\t\t\tdoc.close();\n\t\t\t\t\tloading.remove();\n\t\t\t\t},\n\t\t\t\terror = function(loading) {\n\t\t\t\t\tmarked = false;\n\t\t\t\t\tloading.remove();\n\t\t\t\t};\n\t\t\t\t\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file, jqxhr, loading, prog;\n\t\t\t\t\n\t\t\t\tif (mimes[file.mime] && fm.options.cdns.marked && marked !== false && ql.dispInlineRegex.test(file.mime) && (!ql.options.getSizeMax || file.size <= ql.options.getSizeMax)) {\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\tjqxhr.state() == 'pending' && jqxhr.reject();\n\t\t\t\t\t}).addClass('elfinder-overflow-auto');\n\t\t\t\t\t\n\t\t\t\t\tjqxhr = fm.request({\n\t\t\t\t\t\tdata           : {cmd : 'get', target : file.hash, conv : 1, _t : file.ts},\n\t\t\t\t\t\toptions        : {type: 'get', cache : true},\n\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\tprogressBar    : prog\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tif (marked || window.marked) {\n\t\t\t\t\t\t\tif (!marked) {\n\t\t\t\t\t\t\t\tmarked = window.marked;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tshow(data, loading);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.loadScript([fm.options.cdns.marked],\n\t\t\t\t\t\t\t\tfunction(res) { \n\t\t\t\t\t\t\t\t\tmarked = res || window.marked || false;\n\t\t\t\t\t\t\t\t\tdelete window.marked;\n\t\t\t\t\t\t\t\t\tif (marked) {\n\t\t\t\t\t\t\t\t\t\tshow(data, loading);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\terror(loading);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\t\terror: function() {\n\t\t\t\t\t\t\t\t\t\terror(loading);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\terror(loading);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * PDF/ODT/ODS/ODP preview with ViewerJS\n\t\t * \n\t\t * @param elFinder.commands.quicklook\n\t\t */\n\t\t function(ql) {\n\t\t\tif (ql.options.viewerjs) {\n\t\t\t\tvar fm      = ql.fm,\n\t\t\t\t\tpreview = ql.preview,\n\t\t\t\t\topts    = ql.options.viewerjs,\n\t\t\t\t\tmimes   = opts.url? fm.arrayFlip(opts.mimes || []) : [],\n\t\t\t\t\twin     = ql.window,\n\t\t\t\t\tnavi    = ql.navbar,\n\t\t\t\t\tsetNavi = function() {\n\t\t\t\t\t\tnavi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '30px' : '');\n\t\t\t\t\t};\n\n\t\t\t\tif (opts.url) {\n\t\t\t\t\tpreview.on('update', function(e) {\n\t\t\t\t\t\tvar file = e.file, node, loading, prog, opDfd;\n\n\t\t\t\t\t\tif (mimes[file.mime] && (file.mime !== 'application/pdf' || !opts.pdfNative || !ql.flags.pdfNative)) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\t\topDfd = fm.openUrl(file.hash, 'sameorigin', function(url) {\n\t\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\t\tnode = $('<iframe class=\"elfinder-quicklook-preview-iframe\"/>')\n\t\t\t\t\t\t\t\t\t\t.css('background-color', 'transparent')\n\t\t\t\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\t\tnode.css('background-color', '#fff');\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.appendTo(preview)\n\t\t\t\t\t\t\t\t\t\t.attr('src', opts.url + '#' + url);\n\n\t\t\t\t\t\t\t\t\twin.on('viewchange.viewerjs', setNavi);\n\t\t\t\t\t\t\t\t\tsetNavi();\n\n\t\t\t\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\t\t\t\twin.off('viewchange.viewerjs');\n\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\tnode.off('load').remove();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * PDF preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmime    = 'application/pdf',\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tactive  = false,\n\t\t\t\turlhash = '',\n\t\t\t\tfirefox, toolbar;\n\t\t\t\t\n\t\t\tif ((fm.UA.Safari && fm.OS === 'mac' && !fm.UA.iOS) || fm.UA.IE || fm.UA.Firefox) {\n\t\t\t\tactive = true;\n\t\t\t} else {\n\t\t\t\t$.each(navigator.plugins, function(i, plugins) {\n\t\t\t\t\t$.each(plugins, function(i, plugin) {\n\t\t\t\t\t\tif (plugin.type === mime) {\n\t\t\t\t\t\t\treturn !(active = true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tql.flags.pdfNative = active;\n\t\t\tif (active) {\n\t\t\t\tif (typeof ql.options.pdfToolbar !== 'undefined' && !ql.options.pdfToolbar) {\n\t\t\t\t\turlhash = '#toolbar=0';\n\t\t\t\t}\n\t\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\t\tvar file = e.file,\n\t\t\t\t\t\topDfd;\n\t\t\t\t\t\n\t\t\t\t\tif (active && file.mime === mime && ql.dispInlineRegex.test(file.mime)) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\tql.cover.addClass('elfinder-quicklook-coverbg');\n\t\t\t\t\t\t\t\t$('<object class=\"elfinder-quicklook-preview-pdf\" data=\"'+url+urlhash+'\" type=\"application/pdf\" />')\n\t\t\t\t\t\t\t\t\t.on('error', function(e) {\n\t\t\t\t\t\t\t\t\t\tactive = false;\n\t\t\t\t\t\t\t\t\t\tql.update(void(0), fm.cwd());\n\t\t\t\t\t\t\t\t\t\tql.update(void(0), file);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.appendTo(preview);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t\n\t\t/**\n\t\t * Flash preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmime    = 'application/x-shockwave-flash',\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tactive  = false;\n\n\t\t\t$.each(navigator.plugins, function(i, plugins) {\n\t\t\t\t$.each(plugins, function(i, plugin) {\n\t\t\t\t\tif (plugin.type === mime) {\n\t\t\t\t\t\treturn !(active = true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\tactive && preview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file,\n\t\t\t\t\tnode, opDfd;\n\t\t\t\t\t\n\t\t\t\tif (file.mime === mime && ql.dispInlineRegex.test(file.mime)) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\tnode = $('<embed class=\"elfinder-quicklook-preview-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" src=\"'+url+'\" quality=\"high\" type=\"application/x-shockwave-flash\" wmode=\"transparent\" />')\n\t\t\t\t\t\t\t\t.appendTo(preview);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * HTML5 audio preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm       = ql.fm,\n\t\t\t\tpreview  = ql.preview,\n\t\t\t\tmimes    = {\n\t\t\t\t\t'audio/mpeg'    : 'mp3',\n\t\t\t\t\t'audio/mpeg3'   : 'mp3',\n\t\t\t\t\t'audio/mp3'     : 'mp3',\n\t\t\t\t\t'audio/x-mpeg3' : 'mp3',\n\t\t\t\t\t'audio/x-mp3'   : 'mp3',\n\t\t\t\t\t'audio/x-wav'   : 'wav',\n\t\t\t\t\t'audio/wav'     : 'wav',\n\t\t\t\t\t'audio/x-m4a'   : 'm4a',\n\t\t\t\t\t'audio/aac'     : 'm4a',\n\t\t\t\t\t'audio/mp4'     : 'm4a',\n\t\t\t\t\t'audio/x-mp4'   : 'm4a',\n\t\t\t\t\t'audio/ogg'     : 'ogg',\n\t\t\t\t\t'audio/webm'    : 'webm',\n\t\t\t\t\t'audio/flac'    : 'flac',\n\t\t\t\t\t'audio/x-flac'  : 'flac',\n\t\t\t\t\t'audio/amr'     : 'amr'\n\t\t\t\t},\n\t\t\t\tnode, curHash,\n\t\t\t\twin  = ql.window,\n\t\t\t\tnavi = ql.navbar,\n\t\t\t\tAMR, autoplay,\n\t\t\t\tcontrolsList = typeof ql.options.mediaControlsList === 'string' && ql.options.mediaControlsList? ' controlsList=\"' + fm.escape(ql.options.mediaControlsList) + '\"' : '',\n\t\t\t\tsetNavi = function() {\n\t\t\t\t\tnavi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '50px' : '');\n\t\t\t\t},\n\t\t\t\tgetNode = function(src, hash) {\n\t\t\t\t\treturn $('<audio class=\"elfinder-quicklook-preview-audio ui-front\" controls' + controlsList + ' preload=\"auto\" autobuffer><source src=\"'+src+'\" /></audio>')\n\t\t\t\t\t\t.on('change', function(e) {\n\t\t\t\t\t\t\t// Firefox fire change event on seek or volume change\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('error', function(e) {\n\t\t\t\t\t\t\tnode && node.data('hash') === hash && reset();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.data('hash', hash)\n\t\t\t\t\t\t.appendTo(preview);\n\t\t\t\t},\n\t\t\t\tamrToWavUrl = function(hash) {\n\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\tloader = $.Deferred().done(function() {\n\t\t\t\t\t\t\tvar opDfd;\n\t\t\t\t\t\t\topDfd = fm.getContents(hash, 'arraybuffer', { progressBar: prog }).done(function(data) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tvar buffer = AMR.toWAV(new Uint8Array(data));\n\t\t\t\t\t\t\t\t\tif (buffer) {\n\t\t\t\t\t\t\t\t\t\tdfd.resolve(URL.createObjectURL(new Blob([buffer], { type: 'audio/x-wav' })));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\tAMR = false;\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t_AMR;\n\t\t\t\t\tif (window.TextEncoder && window.URL && URL.createObjectURL && typeof AMR === 'undefined') {\n\t\t\t\t\t\t// previous window.AMR\n\t\t\t\t\t\t_AMR = window.AMR;\n\t\t\t\t\t\tdelete window.AMR;\n\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t[ fm.options.cdns.amr ],\n\t\t\t\t\t\t\tfunction() { \n\t\t\t\t\t\t\t\tAMR = window.AMR? window.AMR : false;\n\t\t\t\t\t\t\t\t// restore previous window.AMR\n\t\t\t\t\t\t\t\twindow.AMR = _AMR;\n\t\t\t\t\t\t\t\tloader[AMR? 'resolve':'reject']();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\terror: function() {\n\t\t\t\t\t\t\t\t\tloader.reject();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tloader[AMR? 'resolve':'reject']();\n\t\t\t\t\t}\n\t\t\t\t\treturn dfd;\n\t\t\t\t},\n\t\t\t\tplay = function(player) {\n\t\t\t\t\tvar hash = node.data('hash'),\n\t\t\t\t\t\tplayPromise;\n\t\t\t\t\tautoplay && (playPromise = player.play());\n\t\t\t\t\t// uses \"playPromise['catch']\" instead \"playPromise.catch\" to support Old IE\n\t\t\t\t\tif (playPromise && playPromise['catch']) {\n\t\t\t\t\t\tplayPromise['catch'](function(e) {\n\t\t\t\t\t\t\tif (!player.paused) {\n\t\t\t\t\t\t\t\tnode && node.data('hash') === hash && reset();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treset = function() {\n\t\t\t\t\tif (node && node.parent().length) {\n\t\t\t\t\t\tvar elm = node[0],\n\t\t\t\t\t\t\turl = node.children('source').attr('src');\n\t\t\t\t\t\twin.off('viewchange.audio');\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telm.pause();\n\t\t\t\t\t\t\tnode.empty();\n\t\t\t\t\t\t\tif (url.match(/^blob:/)) {\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telm.src = '';\n\t\t\t\t\t\t\telm.load();\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\tnode = null;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloading, prog;\n\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file,\n\t\t\t\t\ttype = mimes[file.mime],\n\t\t\t\t\thtml5, opDfd;\n\n\t\t\t\tif (mimes[file.mime] && ql.dispInlineRegex.test(file.mime) && ((html5 = ql.support.audio[type]) || (type === 'amr'))) {\n\t\t\t\t\tautoplay = ql.autoPlay();\n\t\t\t\t\tcurHash = file.hash;\n\t\t\t\t\tif (!html5) {\n\t\t\t\t\t\tif (fm.options.cdns.amr && type === 'amr' && AMR !== false) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\t\tnode = getNode('', curHash);\n\t\t\t\t\t\t\tamrToWavUrl(file.hash).done(function(url) {\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\tif (curHash === file.hash) {\n\t\t\t\t\t\t\t\t\tvar elm = node[0];\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tnode.children('source').attr('src', url);\n\t\t\t\t\t\t\t\t\t\telm.pause();\n\t\t\t\t\t\t\t\t\t\telm.load();\n\t\t\t\t\t\t\t\t\t\tplay(elm);\n\t\t\t\t\t\t\t\t\t\twin.on('viewchange.audio', setNavi);\n\t\t\t\t\t\t\t\t\t\tsetNavi();\n\t\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\topDfd = fm.openUrl(curHash, false, function(url) {\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\tnode = getNode(url, curHash);\n\t\t\t\t\t\t\t\tplay(node[0]);\n\t\t\t\t\t\t\t\twin.on('viewchange.audio', setNavi);\n\t\t\t\t\t\t\t\tsetNavi();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).one('change', reset);\n\t\t},\n\t\t\n\t\t/**\n\t\t * HTML5 video preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm       = ql.fm,\n\t\t\t\tpreview  = ql.preview,\n\t\t\t\tmimes    = {\n\t\t\t\t\t'video/mp4'       : 'mp4',\n\t\t\t\t\t'video/x-m4v'     : 'mp4',\n\t\t\t\t\t'video/quicktime' : 'mp4',\n\t\t\t\t\t'video/mpeg'      : 'mpeg',\n\t\t\t\t\t'video/ogg'       : 'ogg',\n\t\t\t\t\t'application/ogg' : 'ogg',\n\t\t\t\t\t'video/webm'      : 'webm',\n\t\t\t\t\t'video/x-matroska': 'mkv',\n\t\t\t\t\t'video/3gpp'      : '3gp',\n\t\t\t\t\t'application/vnd.apple.mpegurl' : 'm3u8',\n\t\t\t\t\t'application/x-mpegurl' : 'm3u8',\n\t\t\t\t\t'application/dash+xml'  : 'mpd',\n\t\t\t\t\t'video/x-flv'     : 'flv',\n\t\t\t\t\t'video/x-msvideo' : 'avi'\n\t\t\t\t},\n\t\t\t\tnode,\n\t\t\t\twin  = ql.window,\n\t\t\t\tnavi = ql.navbar,\n\t\t\t\tcHls, cDash, pDash, cFlv, cVideojs, autoplay, tm, loading, prog,\n\t\t\t\tcontrolsList = typeof ql.options.mediaControlsList === 'string' && ql.options.mediaControlsList? ' controlsList=\"' + fm.escape(ql.options.mediaControlsList) + '\"' : '',\n\t\t\t\tsetNavi = function() {\n\t\t\t\t\tif (fm.UA.iOS) {\n\t\t\t\t\t\tif (win.hasClass('elfinder-quicklook-fullscreen')) {\n\t\t\t\t\t\t\tpreview.css('height', '-webkit-calc(100% - 50px)');\n\t\t\t\t\t\t\tnavi._show();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpreview.css('height', '');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnavi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '50px' : '');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trender = function(file, opts) {\n\t\t\t\t\tvar errTm = function(e) {\n\t\t\t\t\t\t\tif (err > 1) {\n\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t!canPlay && reset(true);\n\t\t\t\t\t\t\t\t}, 800);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\terr = 0, \n\t\t\t\t\t\tcanPlay;\n\t\t\t\t\t//reset();\n\t\t\t\t\tpDash = null;\n\t\t\t\t\topts = opts || {};\n\t\t\t\t\tql.hideinfo();\n\t\t\t\t\tnode = $('<video class=\"elfinder-quicklook-preview-video\" controls' + controlsList + ' preload=\"auto\" autobuffer playsinline>'\n\t\t\t\t\t\t\t+'</video>')\n\t\t\t\t\t\t.on('change', function(e) {\n\t\t\t\t\t\t\t// Firefox fire change event on seek or volume change\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('timeupdate progress', errTm)\n\t\t\t\t\t\t.on('canplay', function() {\n\t\t\t\t\t\t\tcanPlay = true;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.data('hash', file.hash);\n\t\t\t\t\t// can not handling error event with jQuery `on` event handler\n\t\t\t\t\tnode[0].addEventListener('error', function(e) {\n\t\t\t\t\t\tif (opts.src && fm.convAbsUrl(opts.src) === fm.convAbsUrl(e.target.src)) {\n\t\t\t\t\t\t\t++err;\n\t\t\t\t\t\t\terrTm();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, true);\n\n\t\t\t\t\tif (opts.src) {\n\t\t\t\t\t\tnode.append('<source src=\"'+opts.src+'\" type=\"'+file.mime+'\"/><source src=\"'+opts.src+'\"/>');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tnode.appendTo(preview);\n\n\t\t\t\t\twin.on('viewchange.video', setNavi);\n\t\t\t\t\tsetNavi();\n\t\t\t\t},\n\t\t\t\tloadHls = function(file) {\n\t\t\t\t\tvar hls, opDfd;\n\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\trender(file);\n\t\t\t\t\t\t\thls = new cHls();\n\t\t\t\t\t\t\thls.loadSource(url);\n\t\t\t\t\t\t\thls.attachMedia(node[0]);\n\t\t\t\t\t\t\tif (autoplay) {\n\t\t\t\t\t\t\t\thls.on(cHls.Events.MANIFEST_PARSED, function() {\n\t\t\t\t\t\t\t\t\tplay(node[0]);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tloadDash = function(file) {\n\t\t\t\t\tvar opDfd;\n\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\tvar debug;\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\trender(file);\n\t\t\t\t\t\t\tpDash = window.dashjs.MediaPlayer().create();\n\t\t\t\t\t\t\tdebug = pDash.getDebug();\n\t\t\t\t\t\t\tif (debug.setLogLevel) {\n\t\t\t\t\t\t\t\tdebug.setLogLevel(dashjs.Debug.LOG_LEVEL_FATAL);\n\t\t\t\t\t\t\t} else if (debug.setLogToBrowserConsole) {\n\t\t\t\t\t\t\t\tdebug.setLogToBrowserConsole(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpDash.initialize(node[0], url, autoplay);\n\t\t\t\t\t\t\tpDash.on('error', function(e) {\n\t\t\t\t\t\t\t\treset(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tloadFlv = function(file) {\n\t\t\t\t\tvar opDfd\n\t\t\t\t\tif (!cFlv.isSupported()) {\n\t\t\t\t\t\tcFlv = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\tvar player = cFlv.createPlayer({\n\t\t\t\t\t\t\t\ttype: 'flv',\n\t\t\t\t\t\t\t\turl: url\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\trender(file);\n\t\t\t\t\t\t\tplayer.on(cFlv.Events.ERROR, function() {\n\t\t\t\t\t\t\t\tplayer.destroy();\n\t\t\t\t\t\t\t\treset(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tplayer.attachMediaElement(node[0]);\n\t\t\t\t\t\t\tplayer.load();\n\t\t\t\t\t\t\tplay(player);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tloadVideojs = function(file) {\n\t\t\t\t\tvar opDfd;\n\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\trender(file);\n\t\t\t\t\t\t\tnode[0].src = url;\n\t\t\t\t\t\t\tcVideojs(node[0], {\n\t\t\t\t\t\t\t\tsrc: url\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tplay = function(player) {\n\t\t\t\t\tvar hash = node.data('hash'),\n\t\t\t\t\t\tplayPromise;\n\t\t\t\t\tautoplay && (playPromise = player.play());\n\t\t\t\t\t// uses \"playPromise['catch']\" instead \"playPromise.catch\" to support Old IE\n\t\t\t\t\tif (playPromise && playPromise['catch']) {\n\t\t\t\t\t\tplayPromise['catch'](function(e) {\n\t\t\t\t\t\t\tif (!player.paused) {\n\t\t\t\t\t\t\t\tnode && node.data('hash') === hash && reset(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treset = function(showInfo) {\n\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\tif (node && node.parent().length) {\n\t\t\t\t\t\tvar elm = node[0];\n\t\t\t\t\t\twin.off('viewchange.video');\n\t\t\t\t\t\tpDash && pDash.reset();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\telm.pause();\n\t\t\t\t\t\t\tnode.empty();\n\t\t\t\t\t\t\telm.src = '';\n\t\t\t\t\t\t\telm.load();\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\tnode = null;\n\t\t\t\t\t}\n\t\t\t\t\tshowInfo && ql.info.show();\n\t\t\t\t};\n\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file,\n\t\t\t\t\tmime = file.mime.toLowerCase(),\n\t\t\t\t\ttype = mimes[mime],\n\t\t\t\t\tstock, playPromise, opDfd;\n\t\t\t\t\n\t\t\t\tif (mimes[mime] && ql.dispInlineRegex.test(file.mime) /*&& (((type === 'm3u8' || (type === 'mpd' && !fm.UA.iOS) || type === 'flv') && !fm.UA.ltIE10) || ql.support.video[type])*/) {\n\t\t\t\t\tautoplay = ql.autoPlay();\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>');\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\tif (ql.support.video[type] && (type !== 'm3u8' || fm.UA.Safari)) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tloading.appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\topDfd = fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\trender(file, { src: url });\n\t\t\t\t\t\t\t\tplay(node[0]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (cHls !== false && fm.options.cdns.hls && type === 'm3u8') {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tloading.appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tif (cHls) {\n\t\t\t\t\t\t\t\tloadHls(file);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstock = window.Hls;\n\t\t\t\t\t\t\t\tdelete window.Hls;\n\t\t\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t\t\t[ fm.options.cdns.hls ],\n\t\t\t\t\t\t\t\t\tfunction(res) { \n\t\t\t\t\t\t\t\t\t\tcHls = res || window.Hls || false;\n\t\t\t\t\t\t\t\t\t\twindow.Hls = stock;\n\t\t\t\t\t\t\t\t\t\tcHls && loadHls(file);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\t\t\terror : function() {\n\t\t\t\t\t\t\t\t\t\t\tcHls = false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (cDash !== false && fm.options.cdns.dash && type === 'mpd') {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tloading.appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tif (cDash) {\n\t\t\t\t\t\t\t\tloadDash(file);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t\t\t[ fm.options.cdns.dash ],\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t// dashjs require window.dashjs in global scope\n\t\t\t\t\t\t\t\t\t\tcDash = window.dashjs? true : false;\n\t\t\t\t\t\t\t\t\t\tcDash && loadDash(file);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\t\t\terror : function() {\n\t\t\t\t\t\t\t\t\t\t\tcDash = false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (cFlv !== false && fm.options.cdns.flv && type === 'flv') {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tloading.appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tif (cFlv) {\n\t\t\t\t\t\t\t\tloadFlv(file);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tstock = window.flvjs;\n\t\t\t\t\t\t\t\tdelete window.flvjs;\n\t\t\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t\t\t[ fm.options.cdns.flv ],\n\t\t\t\t\t\t\t\t\tfunction(res) { \n\t\t\t\t\t\t\t\t\t\tcFlv = res || window.flvjs || false;\n\t\t\t\t\t\t\t\t\t\twindow.flvjs = stock;\n\t\t\t\t\t\t\t\t\t\tcFlv && loadFlv(file);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\t\t\terror : function() {\n\t\t\t\t\t\t\t\t\t\t\tcFlv = false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (fm.options.cdns.videojs) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tloading.appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tif (cVideojs) {\n\t\t\t\t\t\t\t\tloadVideojs(file);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t\t\t[ fm.options.cdns.videojs + '/video.min.js' ],\n\t\t\t\t\t\t\t\t\tfunction(res) { \n\t\t\t\t\t\t\t\t\t\tcVideojs = res || window.videojs || false;\n\t\t\t\t\t\t\t\t\t\t//window.flvjs = stock;\n\t\t\t\t\t\t\t\t\t\tcVideojs && loadVideojs(file);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\t\t\terror : function() {\n\t\t\t\t\t\t\t\t\t\t\tcVideojs = false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t).loadCss([fm.options.cdns.videojs + '/video-js.min.css']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).one('change', reset);\n\t\t},\n\t\t\n\t\t/**\n\t\t * Audio/video preview plugin using browser plugins\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar preview = ql.preview,\n\t\t\t\tmimes   = [],\n\t\t\t\tnode,\n\t\t\t\twin  = ql.window,\n\t\t\t\tnavi = ql.navbar;\n\t\t\t\t\n\t\t\t$.each(navigator.plugins, function(i, plugins) {\n\t\t\t\t$.each(plugins, function(i, plugin) {\n\t\t\t\t\t(plugin.type.indexOf('audio/') === 0 || plugin.type.indexOf('video/') === 0) && mimes.push(plugin.type);\n\t\t\t\t});\n\t\t\t});\n\t\t\tmimes = ql.fm.arrayFlip(mimes);\n\t\t\t\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file  = e.file,\n\t\t\t\t\tmime  = file.mime,\n\t\t\t\t\tvideo, opDfd, loading, prog,\n\t\t\t\t\tsetNavi = function() {\n\t\t\t\t\t\tnavi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? '50px' : '');\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (mimes[file.mime] && ql.dispInlineRegex.test(file.mime)) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\topDfd = ql.fm.openUrl(file.hash, false, function(url) {\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t(video = mime.indexOf('video/') === 0) && ql.hideinfo();\n\t\t\t\t\t\t\tnode = $('<embed src=\"'+url+'\" type=\"'+mime+'\" class=\"elfinder-quicklook-preview-'+(video ? 'video' : 'audio')+'\"/>')\n\t\t\t\t\t\t\t\t.appendTo(preview);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\twin.on('viewchange.embed', setNavi);\n\t\t\t\t\t\t\tsetNavi();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, { progressBar: prog });\n\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).one('change', function() {\n\t\t\t\tif (node && node.parent().length) {\n\t\t\t\t\twin.off('viewchange.embed');\n\t\t\t\t\tnode.remove();\n\t\t\t\t\tnode= null;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t},\n\n\t\t/**\n\t\t * Archive(zip|gzip|tar|bz2) preview plugin using https://github.com/imaya/zlib.js\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = fm.arrayFlip(['application/zip', 'application/x-gzip', 'application/x-tar', 'application/x-bzip2']),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tsizeMax = fm.returnBytes(ql.options.unzipMaxSize || 0),\n\t\t\t\tZlib    = (fm.options.cdns.zlibUnzip && fm.options.cdns.zlibGunzip)? true : false,\n\t\t\t\tbzip2   = fm.options.cdns.bzip2? true : false;\n\n\t\t\tif (window.Worker && window.Uint8Array && window.DataView) {\n\t\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\t\tvar file  = e.file,\n\t\t\t\t\t\tisTar = (file.mime === 'application/x-tar'),\n\t\t\t\t\t\tisBzip2 = (file.mime === 'application/x-bzip2'),\n\t\t\t\t\t\tisZlib = (file.mime === 'application/zip' || file.mime === 'application/x-gzip');\n\t\t\t\t\tif (mimes[file.mime] && (!sizeMax || file.size <= sizeMax) && (\n\t\t\t\t\t\t\tisTar\n\t\t\t\t\t\t\t|| (isBzip2 && bzip2)\n\t\t\t\t\t\t\t|| (isZlib && Zlib)\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\tvar jqxhr, wk, loading, prog, url,\n\t\t\t\t\t\t\treq = function() {\n\t\t\t\t\t\t\t\tjqxhr = fm.getContents(file.hash, 'arraybuffer', { progressBar: prog })\n\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tvar unzip, filenames,\n\t\t\t\t\t\t\t\t\t\terr = function(e) {\n\t\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\t\tif (isZlib) {\n\t\t\t\t\t\t\t\t\t\t\t\tZlib = false;\n\t\t\t\t\t\t\t\t\t\t\t} else if (isBzip2) {\n\t\t\t\t\t\t\t\t\t\t\t\tbzip2 = false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tfm.debug('error', e);\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\twk = fm.getWorker();\n\t\t\t\t\t\t\t\t\t\twk.onmessage = function(res) {\n\t\t\t\t\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\t\tif (!res.data || res.data.error) {\n\t\t\t\t\t\t\t\t\t\t\t\tnew Error(res.data && res.data.error? res.data.error : '');\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tmakeList(res.data.files);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\twk.onerror = err;\n\t\t\t\t\t\t\t\t\t\tif (file.mime === 'application/x-tar') {\n\t\t\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\t\t\tscripts: [fm.getWorkerUrl('quicklook.unzip.js')],\n\t\t\t\t\t\t\t\t\t\t\t\tdata: { type: 'tar', bin: data }\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else if (file.mime === 'application/zip') {\n\t\t\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\t\t\tscripts: [fm.options.cdns.zlibUnzip, fm.getWorkerUrl('quicklook.unzip.js')],\n\t\t\t\t\t\t\t\t\t\t\t\tdata: { type: 'zip', bin: data }\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else if (file.mime === 'application/x-gzip') {\n\t\t\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\t\t\tscripts: [fm.options.cdns.zlibGunzip, fm.getWorkerUrl('quicklook.unzip.js')],\n\t\t\t\t\t\t\t\t\t\t\t\tdata: { type: 'gzip', bin: data }\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t} else if (file.mime === 'application/x-bzip2') {\n\t\t\t\t\t\t\t\t\t\t\twk.postMessage({\n\t\t\t\t\t\t\t\t\t\t\t\tscripts: [fm.options.cdns.bzip2, fm.getWorkerUrl('quicklook.unzip.js')],\n\t\t\t\t\t\t\t\t\t\t\t\tdata: { type: 'bzip2', bin: data }\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\terr(e);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmakeList = function(filenames) {\n\t\t\t\t\t\t\t\tvar header, list, doc, tsize = 0;\n\t\t\t\t\t\t\t\tif (filenames && filenames.length) {\n\t\t\t\t\t\t\t\t\tfilenames = $.map(filenames, function(str) {\n\t\t\t\t\t\t\t\t\t\treturn fm.decodeRawString(str);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfilenames.sort();\n\t\t\t\t\t\t\t\t\tlist = fm.escape(filenames.join(\"\\n\").replace(/\\{formatSize\\((\\d+)\\)\\}/g, function(m, s) {\n\t\t\t\t\t\t\t\t\t\ttsize += parseInt(s);\n\t\t\t\t\t\t\t\t\t\treturn fm.formatSize(s);\n\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\theader = '<strong>'+fm.escape(file.mime)+'</strong> ('+fm.formatSize(file.size)+' / '+fm.formatSize(tsize)+')'+'<hr/>';\n\t\t\t\t\t\t\t\t\tdoc = $('<div class=\"elfinder-quicklook-preview-archive-wrapper\">'+header+'<pre class=\"elfinder-quicklook-preview-text\">'+list+'</pre></div>')\n\t\t\t\t\t\t\t\t\t\t.on('touchstart', function(e) {\n\t\t\t\t\t\t\t\t\t\t\tif ($(this)['scroll' + (fm.direction === 'ltr'? 'Right' : 'Left')]() > 5) {\n\t\t\t\t\t\t\t\t\t\t\t\te.originalEvent._preventSwipeX = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.appendTo(preview);\n\t\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// this is our file - stop event propagation\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\tjqxhr.state() === 'pending' && jqxhr.reject();\n\t\t\t\t\t\t\twk && wk.terminate();\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\treq();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * RAR Archive preview plugin using https://github.com/43081j/rar.js\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = fm.arrayFlip(['application/x-rar']),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tRAR;\n\n\t\t\tif (window.DataView) {\n\t\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\t\tvar file = e.file;\n\t\t\t\t\tif (mimes[file.mime] && fm.options.cdns.rar && RAR !== false) {\n\t\t\t\t\t\tvar loading, prog, url, archive, abort,\n\t\t\t\t\t\t\tgetList = function(url) {\n\t\t\t\t\t\t\t\tif (abort) {\n\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tarchive = RAR({\n\t\t\t\t\t\t\t\t\t\tfile: url,\n\t\t\t\t\t\t\t\t\t\ttype: 2,\n\t\t\t\t\t\t\t\t\t\txhrHeaders: fm.customHeaders,\n\t\t\t\t\t\t\t\t\t\txhrFields: fm.xhrFields\n\t\t\t\t\t\t\t\t\t}, function(err) {\n\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\tvar filenames = [],\n\t\t\t\t\t\t\t\t\t\t\theader, doc;\n\t\t\t\t\t\t\t\t\t\tif (abort || err) {\n\t\t\t\t\t\t\t\t\t\t\t// An error occurred (not a rar, read error, etc)\n\t\t\t\t\t\t\t\t\t\t\terr && fm.debug('error', err);\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t$.each(archive.entries, function() {\n\t\t\t\t\t\t\t\t\t\t\tfilenames.push(this.path + (this.size? ' (' + fm.formatSize(this.size) + ')' : ''));\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tif (filenames.length) {\n\t\t\t\t\t\t\t\t\t\t\tfilenames = $.map(filenames, function(str) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn fm.decodeRawString(str);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tfilenames.sort();\n\t\t\t\t\t\t\t\t\t\t\theader = '<strong>'+fm.escape(file.mime)+'</strong> ('+fm.formatSize(file.size)+')'+'<hr/>';\n\t\t\t\t\t\t\t\t\t\t\tdoc = $('<div class=\"elfinder-quicklook-preview-archive-wrapper\">'+header+'<pre class=\"elfinder-quicklook-preview-text\">'+fm.escape(filenames.join(\"\\n\"))+'</pre></div>')\n\t\t\t\t\t\t\t\t\t\t\t\t.on('touchstart', function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($(this)['scroll' + (fm.direction === 'ltr'? 'Right' : 'Left')]() > 5) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.originalEvent._preventSwipeX = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t.appendTo(preview);\n\t\t\t\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\terror = function() {\n\t\t\t\t\t\t\t\tRAR = false;\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t_RAR, opDfd;\n\n\t\t\t\t\t\t// this is our file - stop event propagation\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\tarchive && (archive.abort = true);\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\tabort = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\topDfd = fm.openUrl(file.hash, 'sameorigin', function(url) {\n\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\tif (RAR) {\n\t\t\t\t\t\t\t\t\tgetList(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (window.RarArchive) {\n\t\t\t\t\t\t\t\t\t\t_RAR = window.RarArchive;\n\t\t\t\t\t\t\t\t\t\tdelete window.RarArchive;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.loadScript(\n\t\t\t\t\t\t\t\t\t\t[ fm.options.cdns.rar ],\n\t\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t\tif (fm.hasRequire) {\n\t\t\t\t\t\t\t\t\t\t\t\trequire(['rar'], function(RarArchive) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tRAR = RarArchive;\n\t\t\t\t\t\t\t\t\t\t\t\t\tgetList(url);\n\t\t\t\t\t\t\t\t\t\t\t\t}, error);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tif (RAR = window.RarArchive) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (_RAR) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twindow.RarArchive = _RAR;\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelete window.RarArchive;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tgetList(url);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\terror();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\t\t\t\terror : error\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, { progressBar: prog, temporary: true });\n\t\t\t\t\t\t// stop loading on change file if not loaded yet\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\topDfd && opDfd.state && opDfd.state() === 'pending' && opDfd.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * CAD-Files and 3D-Models online viewer on sharecad.org\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = fm.arrayFlip(ql.options.sharecadMimes || []),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\twin     = ql.window,\n\t\t\t\tnode;\n\t\t\t\t\n\t\t\tif (ql.options.sharecadMimes.length) {\n\t\t\t\tql.addIntegration({\n\t\t\t\t\ttitle: 'ShareCAD.org CAD and 3D-Models viewer',\n\t\t\t\t\tlink: 'https://sharecad.org/DWGOnlinePlugin'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file;\n\t\t\t\tif (mimes[file.mime.toLowerCase()] && !fm.option('onetimeUrl', file.hash)) {\n\t\t\t\t\tvar win     = ql.window,\n\t\t\t\t\t\tloading, prog, url;\n\t\t\t\t\t\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tif (file.url == '1') {\n\t\t\t\t\t\tpreview.hide();\n\t\t\t\t\t\t$('<div class=\"elfinder-quicklook-info-data\"><button class=\"elfinder-info-button\">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))\n\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\t\tself.html('<span class=\"elfinder-spinner\">');\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\t\t\tprogressBar : prog\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\tself.html('');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\tfile.url = rfile.url = data.url || '';\n\t\t\t\t\t\t\t\tif (file.url) {\n\t\t\t\t\t\t\t\t\tpreview.trigger({\n\t\t\t\t\t\t\t\t\t\ttype: ql.evUpdate,\n\t\t\t\t\t\t\t\t\t\tfile: file,\n\t\t\t\t\t\t\t\t\t\tforceUpdate: true\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (file.url !== '' && file.url != '1') {\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\tnode.off('load').remove();\n\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t}).addClass('elfinder-overflow-auto');\n\t\t\t\t\t\t\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\t\n\t\t\t\t\t\turl = fm.convAbsUrl(fm.url(file.hash));\n\t\t\t\t\t\tnode = $('<iframe class=\"elfinder-quicklook-preview-iframe\" scrolling=\"no\"/>')\n\t\t\t\t\t\t\t.css('background-color', 'transparent')\n\t\t\t\t\t\t\t.appendTo(preview)\n\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\tql.preview.after(ql.info);\n\t\t\t\t\t\t\t\t$(this).css('background-color', '#fff').show();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\tql.preview.after(ql.info);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.attr('src', '//sharecad.org/cadframe/load?url=' + encodeURIComponent(url));\n\t\t\t\t\t\t\n\t\t\t\t\t\tql.info.after(ql.preview);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * KML preview with GoogleMaps API\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t */\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = {\n\t\t\t\t\t'application/vnd.google-earth.kml+xml' : true,\n\t\t\t\t\t'application/vnd.google-earth.kmz' : true\n\t\t\t\t},\n\t\t\t\tpreview = ql.preview,\n\t\t\t\tgMaps, loadMap, wGmfail, fail, mapScr;\n\n\t\t\tif (ql.options.googleMapsApiKey) {\n\t\t\t\tql.addIntegration({\n\t\t\t\t\ttitle: 'Google Maps',\n\t\t\t\t\tlink: 'https://www.google.com/intl/' + fm.lang.replace('_', '-') + '/help/terms_maps.html'\n\t\t\t\t});\n\t\t\t\tgMaps = (window.google && google.maps);\n\t\t\t\t// start load maps\n\t\t\t\tloadMap = function(file, node, prog) {\n\t\t\t\t\tvar mapsOpts = ql.options.googleMapsOpts.maps;\n\t\t\t\t\tfm.forExternalUrl(file.hash, { progressBar: prog }).done(function(url) {\n\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tnew gMaps.KmlLayer(url, Object.assign({\n\t\t\t\t\t\t\t\t\tmap: new gMaps.Map(node.get(0), mapsOpts)\n\t\t\t\t\t\t\t\t}, ql.options.googleMapsOpts.kml));\n\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\t// keep stored error handler if exists\n\t\t\t\twGmfail = window.gm_authFailure;\n\t\t\t\t// on error function\n\t\t\t\tfail = function() {\n\t\t\t\t\tmapScr = null;\n\t\t\t\t};\n\t\t\t\t// API script url\n\t\t\t\tmapScr = 'https://maps.googleapis.com/maps/api/js?key=' + ql.options.googleMapsApiKey;\n\t\t\t\t// error handler\n\t\t\t\twindow.gm_authFailure = function() {\n\t\t\t\t\tfail();\n\t\t\t\t\twGmfail && wGmfail();\n\t\t\t\t};\n\n\t\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\t\tvar file = e.file;\n\t\t\t\t\tif (mapScr && mimes[file.mime.toLowerCase()]) {\n\t\t\t\t\t\tvar win     = ql.window,\n\t\t\t\t\t\t\tgetLink = (file.url == '1' && !fm.option('onetimeUrl', file.hash)),\n\t\t\t\t\t\t\tloading, prog, url, node;\n\t\t\t\t\t\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\t\t\t\t\t\tif (getLink) {\n\t\t\t\t\t\t\tpreview.hide();\n\t\t\t\t\t\t\t$('<div class=\"elfinder-quicklook-info-data\"><button class=\"elfinder-info-button\">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\t\t\tself.html('<span class=\"elfinder-spinner\">');\n\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\t\t\t\tprogressBar : prog\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\tself.html('');\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\t\tfile.url = rfile.url = data.url || '';\n\t\t\t\t\t\t\t\t\tif (file.url) {\n\t\t\t\t\t\t\t\t\t\tpreview.trigger({\n\t\t\t\t\t\t\t\t\t\t\ttype: ql.evUpdate,\n\t\t\t\t\t\t\t\t\t\t\tfile: file,\n\t\t\t\t\t\t\t\t\t\t\tforceUpdate: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (file.url !== '' && !getLink) {\n\t\t\t\t\t\t\tnode = $('<div style=\"width:100%;height:100%;\"/>').appendTo(preview);\n\t\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (!gMaps) {\n\t\t\t\t\t\t\t\tfm.loadScript([mapScr], function() {\n\t\t\t\t\t\t\t\t\tgMaps = window.google && google.maps;\n\t\t\t\t\t\t\t\t\tgMaps && loadMap(file, node, prog);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tloadMap(file, node, prog);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Any supported files preview plugin using (Google docs | MS Office) online viewer\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tmimes   = Object.assign(fm.arrayFlip(ql.options.googleDocsMimes || [], 'g'), fm.arrayFlip(ql.options.officeOnlineMimes || [], 'm')),\n\t\t\t\tpreview = ql.preview,\n\t\t\t\twin     = ql.window,\n\t\t\t\tnavi    = ql.navbar,\n\t\t\t\turls    = {\n\t\t\t\t\tg: 'docs.google.com/gview?embedded=true&url=',\n\t\t\t\t\tm: 'view.officeapps.live.com/op/embed.aspx?wdStartOn=0&src='\n\t\t\t\t},\n\t\t\t\tnavBottom = {\n\t\t\t\t\tg: '56px',\n\t\t\t\t\tm: '24px'\n\t\t\t\t},\n\t\t\t\tmLimits = {\n\t\t\t\t\txls  : 5242880, // 5MB\n\t\t\t\t\txlsb : 5242880,\n\t\t\t\t\txlsx : 5242880,\n\t\t\t\t\txlsm : 5242880,\n\t\t\t\t\tother: 10485760 // 10MB\n\t\t\t\t},\n\t\t\t\tnode, enable;\n\t\t\t\n\t\t\tif (ql.options.googleDocsMimes.length) {\n\t\t\t\tenable = true;\n\t\t\t\tql.addIntegration({\n\t\t\t\t\ttitle: 'Google Docs Viewer',\n\t\t\t\t\tlink: 'https://docs.google.com/'\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (ql.options.officeOnlineMimes.length) {\n\t\t\t\tenable = true;\n\t\t\t\tql.addIntegration({\n\t\t\t\t\ttitle: 'MS Online Doc Viewer',\n\t\t\t\t\tlink: 'https://products.office.com/office-online/view-office-documents-online'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (enable) {\n\t\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\t\tvar file = e.file,\n\t\t\t\t\t\ttype, dfd;\n\t\t\t\t\t// 25MB is maximum filesize of Google Docs prevew\n\t\t\t\t\tif (file.size <= 26214400 && (type = mimes[file.mime])) {\n\t\t\t\t\t\tvar win     = ql.window,\n\t\t\t\t\t\t\tsetNavi = function() {\n\t\t\t\t\t\t\t\tnavi.css('bottom', win.hasClass('elfinder-quicklook-fullscreen')? navBottom[type] : '');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\text     = fm.mimeTypes[file.mime],\n\t\t\t\t\t\t\tgetLink = (file.url == '1' && !fm.option('onetimeUrl', file.hash)),\n\t\t\t\t\t\t\tloading, prog, url, tm;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (type === 'm') {\n\t\t\t\t\t\t\tif ((mLimits[ext] && file.size > mLimits[ext]) || file.size > mLimits.other) {\n\t\t\t\t\t\t\t\ttype = 'g';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (getLink) {\n\t\t\t\t\t\t\tpreview.hide();\n\t\t\t\t\t\t\t$('<div class=\"elfinder-quicklook-info-data\"><button class=\"elfinder-info-button\">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\t\t\tself.html('<span class=\"elfinder-spinner\">');\n\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\tself.html('');\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\t\tfile.url = rfile.url = data.url || '';\n\t\t\t\t\t\t\t\t\tif (file.url) {\n\t\t\t\t\t\t\t\t\t\tpreview.trigger({\n\t\t\t\t\t\t\t\t\t\t\ttype: ql.evUpdate,\n\t\t\t\t\t\t\t\t\t\t\tfile: file,\n\t\t\t\t\t\t\t\t\t\t\tforceUpdate: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (file.url !== '' && !getLink) {\n\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\t\tdfd && dfd.status && dfd.status() === 'pending' && dfd.reject();\n\t\t\t\t\t\t\t\twin.off('viewchange.googledocs');\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\tnode.off('load').remove();\n\t\t\t\t\t\t\t\tnode = null;\n\t\t\t\t\t\t\t}).addClass('elfinder-overflow-auto');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\n\t\t\t\t\t\t\tnode = $('<iframe class=\"elfinder-quicklook-preview-iframe\"/>')\n\t\t\t\t\t\t\t\t.css('background-color', 'transparent')\n\t\t\t\t\t\t\t\t.appendTo(preview);\n\n\t\t\t\t\t\t\tdfd = fm.forExternalUrl(file.hash, { progressBar: prog }).done(function(url) {\n\t\t\t\t\t\t\t\tvar load = function() {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tif (node && (!node.attr('src') || node.get(0).contentWindow.document/*maybe HTTP 204*/)) {\n\t\t\t\t\t\t\t\t\t\t\t\tnode.attr('src', 'https://' + urls[type] + encodeURIComponent(url));\n\t\t\t\t\t\t\t\t\t\t\t\t// Retry because Google Docs viewer sometimes returns HTTP 204\n\t\t\t\t\t\t\t\t\t\t\t\ttm = setTimeout(load, 2000);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tif (url) {\n\t\t\t\t\t\t\t\t\tif (file.ts) {\n\t\t\t\t\t\t\t\t\t\turl += (url.match(/\\?/)? '&' : '?') + '_t=' + file.ts;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tnode.on('load', function() {\n\t\t\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\tql.preview.after(ql.info);\n\t\t\t\t\t\t\t\t\t\t$(this).css('background-color', '#fff').show();\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\t\tql.preview.after(ql.info);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tload();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\twin.on('viewchange.googledocs', setNavi);\n\t\t\t\t\t\t\tsetNavi();\n\t\t\t\t\t\t\tql.info.after(ql.preview);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Texts preview plugin\n\t\t *\n\t\t * @param elFinder.commands.quicklook\n\t\t **/\n\t\tfunction(ql) {\n\t\t\t\"use strict\";\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tpreview = ql.preview,\n\t\t\t\ttextLines = parseInt(ql.options.textInitialLines) || 150,\n\t\t\t\tprettifyLines = parseInt(ql.options.prettifyMaxLines) || 500,\n\t\t\t\tPR, _PR,\n\t\t\t\terror = function() {\n\t\t\t\t\tprettify = function() { return false; };\n\t\t\t\t\t_PR && (window.PR = _PR);\n\t\t\t\t\tPR = false;\n\t\t\t\t},\n\t\t\t\tprettify = function(node) {\n\t\t\t\t\tif (fm.options.cdns.prettify) {\n\t\t\t\t\t\tprettify = function(node) {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tPRcheck(node);\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\treturn 'pending';\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (window.PR) {\n\t\t\t\t\t\t\t_PR = window.PR;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfm.loadScript([fm.options.cdns.prettify + (fm.options.cdns.prettify.match(/\\?/)? '&' : '?') + 'autorun=false'], function(wPR) {\n\t\t\t\t\t\t\tPR = wPR || window.PR;\n\t\t\t\t\t\t\tif (typeof PR === 'object') {\n\t\t\t\t\t\t\t\tprettify = function() { return true; };\n\t\t\t\t\t\t\t\tif (_PR) {\n\t\t\t\t\t\t\t\t\twindow.PR = _PR;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdelete window.PR;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\texec(node);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\terror();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\terror : error\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\texec = function(node) {\n\t\t\t\t\tif (node && !node.hasClass('prettyprinted')) {\n\t\t\t\t\t\tnode.css('cursor', 'wait');\n\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\tPR.prettyPrint && PR.prettyPrint(null, node.get(0));\n\t\t\t\t\t\t\tnode.css('cursor', '');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tPRcheck = function(node) {\n\t\t\t\t\tvar status = prettify(node);\n\t\t\t\t\tif (status === true) {\n\t\t\t\t\t\texec(node);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\n\t\t\tpreview.on(ql.evUpdate, function(e) {\n\t\t\t\tvar file = e.file,\n\t\t\t\t\tmime = file.mime,\n\t\t\t\t\tjqxhr, loading, prog, encSelect;\n\t\t\t\t\n\t\t\t\tif (fm.mimeIsText(file.mime) && (!ql.options.getSizeMax || file.size <= ql.options.getSizeMax) && PR !== false) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\n\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(loading);\n\n\t\t\t\t\t// stop loading on change file if not loadin yet\n\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\tjqxhr.state() == 'pending' && jqxhr.reject();\n\t\t\t\t\t\tencSelect && encSelect.remove();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tjqxhr = fm.request({\n\t\t\t\t\t\tdata           : {cmd : 'get', target : file.hash, conv : (file.encoding || 1), _t : file.ts},\n\t\t\t\t\t\toptions        : {type: 'get', cache : true},\n\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\tprogressBar    : prog\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tvar reg = new RegExp('^(data:'+file.mime.replace(/([.+])/g, '\\\\$1')+';base64,)', 'i'),\n\t\t\t\t\t\t\ttext = data.content,\n\t\t\t\t\t\t\tpart, more, node, lines, m;\n\t\t\t\t\t\tif (typeof text !== 'string') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\tif (window.atob && (m = text.match(reg))) {\n\t\t\t\t\t\t\ttext = atob(text.substr(m[1].length));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tlines = text.match(/([^\\r\\n]{1,100}[\\r\\n]*)/g);\n\t\t\t\t\t\tmore = lines.length - textLines;\n\t\t\t\t\t\tif (more > 10) {\n\t\t\t\t\t\t\tpart = lines.splice(0, textLines).join('');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmore = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = $('<div class=\"elfinder-quicklook-preview-text-wrapper\"><pre class=\"elfinder-quicklook-preview-text prettyprint\"></pre></div>');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (more) {\n\t\t\t\t\t\t\tnode.append($('<div class=\"elfinder-quicklook-preview-charsleft\"><hr/><span>' + fm.i18n('linesLeft', fm.toLocaleString(more)) + '</span></div>')\n\t\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\t\tvar top = node.scrollTop();\n\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\tnode.children('pre').removeClass('prettyprinted').text(text).scrollTop(top);\n\t\t\t\t\t\t\t\t\tif (lines.length <= prettifyLines) {\n\t\t\t\t\t\t\t\t\t\tPRcheck(node);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode.children('pre').text(part || text);\n\t\t\t\t\t\t\n\t\t\t\t\t\tnode.on('touchstart', function(e) {\n\t\t\t\t\t\t\tif ($(this)['scroll' + (fm.direction === 'ltr'? 'Right' : 'Left')]() > 5) {\n\t\t\t\t\t\t\t\te.originalEvent._preventSwipeX = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).appendTo(preview);\n\n\t\t\t\t\t\t// make toast message\n\t\t\t\t\t\tif (data.toasts && Array.isArray(data.toasts)) {\n\t\t\t\t\t\t\t$.each(data.toasts, function() {\n\t\t\t\t\t\t\t\tthis.msg && fm.toast(this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tPRcheck(node);\n\t\t\t\t\t})\n\t\t\t\t\t.always(function(data) {\n\t\t\t\t\t\tvar cmdEdit, sel, head;\n\t\t\t\t\t\tif (cmdEdit = fm.getCommand('edit')) {\n\t\t\t\t\t\t\thead = [];\n\t\t\t\t\t\t\tif (data && data.encoding) {\n\t\t\t\t\t\t\t\thead.push({value: data.encoding});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thead.push({value: 'UTF-8'});\n\t\t\t\t\t\t\tsel = cmdEdit.getEncSelect(head);\n\t\t\t\t\t\t\tsel.on('change', function() {\n\t\t\t\t\t\t\t\tfile.encoding = sel.val();\n\t\t\t\t\t\t\t\tfm.cache(file, 'change');\n\t\t\t\t\t\t\t\tpreview.trigger({\n\t\t\t\t\t\t\t\t\ttype: ql.evUpdate,\n\t\t\t\t\t\t\t\t\tfile: file,\n\t\t\t\t\t\t\t\t\tforceUpdate: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tencSelect = $('<div class=\"elfinder-quicklook-encoding\"/>').append(sel);\n\t\t\t\t\t\t\tql.window.append(encSelect);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t];\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/reload',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"reload\"\n\t * Sync files and folders\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t(elFinder.prototype.commands.reload = function() {\n\t\t\"use strict\";\n\t\tvar self   = this,\n\t\t\tsearch = false;\n\t\t\n\t\tthis.alwaysEnabled = true;\n\t\tthis.updateOnSelect = true;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+shift+r f5'\n\t\t}];\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.init = function() {\n\t\t\tthis.fm.bind('search searchend', function() {\n\t\t\t\tsearch = this.type == 'search';\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.fm.bind('contextmenu', function(){\n\t\t\tvar fm = self.fm;\n\t\t\tif (fm.options.sync >= 1000) {\n\t\t\t\tself.extra = {\n\t\t\t\t\ticon: 'accept',\n\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t.attr({title: fm.i18n('autoSync')})\n\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t$(this).parent()\n\t\t\t\t\t\t\t\t.toggleClass('ui-state-disabled', fm.options.syncStart)\n\t\t\t\t\t\t\t\t.parent().removeClass('ui-state-hover');\n\t\t\t\t\t\t\tfm.options.syncStart = !fm.options.syncStart;\n\t\t\t\t\t\t\tfm.autoSync(fm.options.syncStart? null : 'stop');\n\t\t\t\t\t\t}).on('ready', function(){\n\t\t\t\t\t\t\t$(this).parent().toggleClass('ui-state-disabled', !fm.options.syncStart).css('pointer-events', 'auto');\n\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar fm = this.fm;\n\t\t\tif (!search) {\n\t\t\t\tvar dfrd    = fm.sync(),\n\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\tfm.notify({type : 'reload', cnt : 1, hideCnt : true});\n\t\t\t\t\t\tdfrd.always(function() { fm.notify({type : 'reload', cnt  : -1}); });\n\t\t\t\t\t}, fm.notifyDelay);\n\t\t\t\t\t\n\t\t\t\treturn dfrd.always(function() { \n\t\t\t\t\tclearTimeout(timeout); \n\t\t\t\t\tfm.trigger('reload');\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t$('div.elfinder-toolbar > div.'+fm.res('class', 'searchbtn') + ' > span.ui-icon-search').click();\n\t\t\t}\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/rename',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"rename\". \n\t * Rename selected file.\n\t *\n\t * @author Dmitry (dio) Levashov, dio@std42.ru\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.rename = function() {\n\t\t\"use strict\";\n\n\t\t// set alwaysEnabled to allow root rename on client size\n\t\tthis.alwaysEnabled = true;\n\n\t\tthis.syncTitleOnChange = true;\n\n\t\tvar self = this,\n\t\t\tfm = self.fm,\n\t\t\trequest = function(dfrd, targtes, file, name) {\n\t\t\t\tvar sel = targtes? [file.hash].concat(targtes) : [file.hash],\n\t\t\t\t\tcnt = sel.length,\n\t\t\t\t\tdata = {}, rootNames;\n\t\t\t\t\n\t\t\t\tfm.lockfiles({files : sel});\n\t\t\t\t\n\t\t\t\tif (fm.isRoot(file) && !file.netkey) {\n\t\t\t\t\tif (!(rootNames = fm.storage('rootNames'))) {\n\t\t\t\t\t\trootNames = {};\n\t\t\t\t\t}\n\t\t\t\t\tif (name === '') {\n\t\t\t\t\t\tif (rootNames[file.hash]) {\n\t\t\t\t\t\t\tfile.name = file._name;\n\t\t\t\t\t\t\tfile.i18 = file._i18;\n\t\t\t\t\t\t\tdelete rootNames[file.hash];\n\t\t\t\t\t\t\tdelete file._name;\n\t\t\t\t\t\t\tdelete file._i18;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd && dfrd.reject();\n\t\t\t\t\t\t\tfm.unlockfiles({files : sel}).trigger('selectfiles', {files : sel});\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (typeof file._name === 'undefined') {\n\t\t\t\t\t\t\tfile._name = file.name;\n\t\t\t\t\t\t\tfile._i18 = file.i18;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfile.name = rootNames[file.hash] = name;\n\t\t\t\t\t\tdelete file.i18;\n\t\t\t\t\t}\n\t\t\t\t\tfm.storage('rootNames', rootNames);\n\t\t\t\t\tdata = { changed: [file] };\n\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\tfm.change(data);\n\t\t\t\t\tdfrd && dfrd.resolve(data);\n\t\t\t\t\tfm.unlockfiles({files : sel}).trigger('selectfiles', {files : sel});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdata = {\n\t\t\t\t\tcmd : 'rename',\n\t\t\t\t\tname : name,\n\t\t\t\t\ttarget : file.hash\n\t\t\t\t};\n\n\t\t\t\tif (cnt > 1) {\n\t\t\t\t\tdata['targets'] = targtes;\n\t\t\t\t\tif (name.match(/\\*/)) {\n\t\t\t\t\t\tdata['q'] = name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.request({\n\t\t\t\t\t\tdata   : data,\n\t\t\t\t\t\tnotify : {type : 'rename', cnt : cnt},\n\t\t\t\t\t\tnavigate : {}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tvar err = fm.parseError(error);\n\t\t\t\t\t\tdfrd && dfrd.reject();\n\t\t\t\t\t\tif (! err || ! Array.isArray(err) || err[0] !== 'errRename') {\n\t\t\t\t\t\t\tfm.sync();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\tvar cwdHash;\n\t\t\t\t\t\tif (data.added && data.added.length && cnt === 1) {\n\t\t\t\t\t\t\tdata.undo = {\n\t\t\t\t\t\t\t\tcmd : 'rename',\n\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'rename', target : data.added[0].hash, name : file.name},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'undo', cnt : 1}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tdata.redo = {\n\t\t\t\t\t\t\t\tcmd : 'rename',\n\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\tdata   : {cmd : 'rename', target : file.hash, name : name},\n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'rename', cnt : 1}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdfrd && dfrd.resolve(data);\n\t\t\t\t\t\tif (!(cwdHash = fm.cwd().hash) || cwdHash === file.hash) {\n\t\t\t\t\t\t\tfm.exec('open', $.map(data.added, function(f) {\n\t\t\t\t\t\t\t\treturn (f.mime === 'directory')? f.hash : null;\n\t\t\t\t\t\t\t})[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tfm.unlockfiles({files : sel}).trigger('selectfiles', {files : sel});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tgetHint = function(name, target) {\n\t\t\t\tvar sel = target || fm.selected(),\n\t\t\t\t\tsplits = fm.splitFileExtention(name),\n\t\t\t\t\tf1 = fm.file(sel[0]),\n\t\t\t\t\tf2 = fm.file(sel[1]),\n\t\t\t\t\text, hint, add;\n\t\t\t\t\n\t\t\t\text = splits[1]? ('.' + splits[1]) : '';\n\t\t\t\tif (splits[1] && splits[0] === '*') {\n\t\t\t\t\t// change extention\n\t\t\t\t\thint =  '\"' + fm.splitFileExtention(f1.name)[0] + ext + '\", ';\n\t\t\t\t\thint += '\"' + fm.splitFileExtention(f2.name)[0] + ext + '\"';\n\t\t\t\t} else if (splits[0].length > 1) {\n\t\t\t\t\tif (splits[0].substr(-1) === '*') {\n\t\t\t\t\t\t// add prefix\n\t\t\t\t\t\tadd = splits[0].substr(0, splits[0].length - 1);\n\t\t\t\t\t\thint =  '\"' + add + f1.name+'\", ';\n\t\t\t\t\t\thint += '\"' + add + f2.name+'\"';\n\t\t\t\t\t} else if (splits[0].substr(0, 1) === '*') {\n\t\t\t\t\t\t// add suffix\n\t\t\t\t\t\tadd = splits[0].substr(1);\n\t\t\t\t\t\thint =  '\"'+fm.splitFileExtention(f1.name)[0] + add + ext + '\", ';\n\t\t\t\t\t\thint += '\"'+fm.splitFileExtention(f2.name)[0] + add + ext + '\"';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!hint) {\n\t\t\t\t\thint = '\"'+splits[0] + '1' + ext + '\", \"' + splits[0] + '2' + ext + '\"';\n\t\t\t\t}\n\t\t\t\tif (sel.length > 2) {\n\t\t\t\t\thint += ' ...';\n\t\t\t\t}\n\t\t\t\treturn hint;\n\t\t\t},\n\t\t\tbatchRename = function() {\n\t\t\t\tvar sel = fm.selected(),\n\t\t\t\t\ttplr = '<input name=\"type\" type=\"radio\" class=\"elfinder-tabstop\">',\n\t\t\t\t\tmkChk = function(node, label) {\n\t\t\t\t\t\treturn $('<label class=\"elfinder-rename-batch-checks\">' + fm.i18n(label) + '</label>').prepend(node);\n\t\t\t\t\t},\n\t\t\t\t\tname = $('<input type=\"text\" class=\"ui-corner-all elfinder-tabstop\">'),\n\t\t\t\t\tnum  = $(tplr),\n\t\t\t\t\tprefix  = $(tplr),\n\t\t\t\t\tsuffix  = $(tplr),\n\t\t\t\t\textention  = $(tplr),\n\t\t\t\t\tchecks = $('<div/>').append(\n\t\t\t\t\t\tmkChk(num, 'plusNumber'),\n\t\t\t\t\t\tmkChk(prefix, 'asPrefix'),\n\t\t\t\t\t\tmkChk(suffix, 'asSuffix'),\n\t\t\t\t\t\tmkChk(extention, 'changeExtention')\n\t\t\t\t\t),\n\t\t\t\t\tpreview = $('<div class=\"elfinder-rename-batch-preview\"/>'),\n\t\t\t\t\tnode = $('<div class=\"elfinder-rename-batch\"/>').append(\n\t\t\t\t\t\t\t$('<div class=\"elfinder-rename-batch-name\"/>').append(name),\n\t\t\t\t\t\t\t$('<div class=\"elfinder-rename-batch-type\"/>').append(checks),\n\t\t\t\t\t\t\tpreview\n\t\t\t\t\t\t),\n\t\t\t\t\topts = {\n\t\t\t\t\t\ttitle : fm.i18n('batchRename'),\n\t\t\t\t\t\tmodal : true,\n\t\t\t\t\t\tdestroyOnClose : true,\n\t\t\t\t\t\twidth: Math.min(380, fm.getUI().width() - 20),\n\t\t\t\t\t\tbuttons : {},\n\t\t\t\t\t\topen : function() {\n\t\t\t\t\t\t\tname.on('input', mkPrev).trigger('focus');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgetName = function() {\n\t\t\t\t\t\tvar vName = name.val(),\n\t\t\t\t\t\t\text = fm.splitFileExtention(fm.file(sel[0]).name)[1];\n\t\t\t\t\t\tif (vName !== '' || num.is(':checked')) {\n\t\t\t\t\t\t\tif (prefix.is(':checked')) {\n\t\t\t\t\t\t\t\tvName += '*';\n\t\t\t\t\t\t\t} else if (suffix.is(':checked')) {\n\t\t\t\t\t\t\t\tvName = '*' + vName + '.' + ext;\n\t\t\t\t\t\t\t} else if (extention.is(':checked')) {\n\t\t\t\t\t\t\t\tvName = '*.' + vName;\n\t\t\t\t\t\t\t} else if (ext) {\n\t\t\t\t\t\t\t\tvName += '.' + ext;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn vName;\n\t\t\t\t\t},\n\t\t\t\t\tmkPrev = function() {\n\t\t\t\t\t\tvar vName = getName();\n\t\t\t\t\t\tif (vName !== '') {\n\t\t\t\t\t\t\tpreview.html(fm.i18n(['renameMultiple', sel.length, getHint(vName)]));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpreview.empty();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tradios = checks.find('input:radio').on('change', mkPrev),\n\t\t\t\t\tdialog;\n\t\t\t\t\n\t\t\t\topts.buttons[fm.i18n('btnApply')] = function() {\n\t\t\t\t\tvar vName = getName(),\n\t\t\t\t\t\tfile, targets;\n\t\t\t\t\tif (vName !== '') {\n\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\ttargets = sel;\n\t\t\t\t\t\tfile = fm.file(targets.shift());\n\t\t\t\t\t\trequest(void(0), targets, file, vName);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\topts.buttons[fm.i18n('btnCancel')] = function() {\n\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t};\n\t\t\t\tif ($.fn.checkboxradio) {\n\t\t\t\t\tradios.checkboxradio({\n\t\t\t\t\t\tcreate: function(e, ui) {\n\t\t\t\t\t\t\tif (this === num.get(0)) {\n\t\t\t\t\t\t\t\tnum.prop('checked', true).change();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tchecks.buttonset({\n\t\t\t\t\t\tcreate: function(e, ui) {\n\t\t\t\t\t\t\tnum.prop('checked', true).change();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tdialog = self.fmDialog(node, opts);\n\t\t\t};\n\t\t\n\t\tthis.noChangeDirOnRemovedCwd = true;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern : 'f2' + (fm.OS == 'mac' ? ' enter' : '')\n\t\t}, {\n\t\t\tpattern : 'shift+f2',\n\t\t\tdescription : 'batchRename',\n\t\t\tcallback : function() {\n\t\t\t\tfm.selected().length > 1 && batchRename();\n\t\t\t}\n\t\t}];\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel = this.files(select),\n\t\t\t\tcnt = sel.length,\n\t\t\t\tphash, ext, mime, brk, state, isRoot;\n\t\t\t\n\t\t\tif (!cnt) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t\n\t\t\tif (cnt > 1 && sel[0].phash) {\n\t\t\t\tphash = sel[0].phash;\n\t\t\t\text = fm.splitFileExtention(sel[0].name)[1].toLowerCase();\n\t\t\t\tmime = sel[0].mime;\n\t\t\t}\n\t\t\tif (cnt === 1) {\n\t\t\t\tisRoot = fm.isRoot(sel[0]);\n\t\t\t}\n\n\t\t\tstate = (cnt === 1 && ((fm.cookieEnabled && isRoot) || !sel[0].locked) || (fm.api > 2.1030 && cnt === $.grep(sel, function(f) {\n\t\t\t\tif (!brk && !f.locked && f.phash === phash && !fm.isRoot(f) && (mime === f.mime || ext === fm.splitFileExtention(f.name)[1].toLowerCase())) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tbrk && (brk = true);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}).length)) ? 0 : -1;\n\t\t\t\n\t\t\t// because alwaysEnabled = true, it need check disabled on connector \n\t\t\tif (!isRoot && state === 0 && fm.option('disabledFlip', sel[0].hash)['rename']) {\n\t\t\t\tstate = -1;\n\t\t\t}\n\n\t\t\tif (state !== -1 && cnt > 1) {\n\t\t\t\tself.extra = {\n\t\t\t\t\ticon: 'preference',\n\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t.attr({title: fm.i18n('batchRename')})\n\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tfm.getUI().trigger('click'); // to close the context menu immediately\n\t\t\t\t\t\t\tbatchRename();\n\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tdelete self.extra;\n\t\t\t}\n\t\t\t\t\n\t\t\treturn state;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpts) {\n\t\t\tvar cwd      = fm.getUI('cwd'),\n\t\t\t\tsel      = hashes || (fm.selected().length? fm.selected() : false) || [fm.cwd().hash],\n\t\t\t\tcnt      = sel.length,\n\t\t\t\tfile     = fm.file(sel.shift()),\n\t\t\t\tfilename = '.elfinder-cwd-filename',\n\t\t\t\topts     = cOpts || {},\n\t\t\t\tincwd    = (fm.cwd().hash == file.hash),\n\t\t\t\ttype     = (opts._currentType === 'navbar' || opts._currentType === 'files')? opts._currentType : (incwd? 'navbar' : 'files'),\n\t\t\t\tnavbar   = (type !== 'files'),\n\t\t\t\ttarget   = fm[navbar? 'navHash2Elm' : 'cwdHash2Elm'](file.hash),\n\t\t\t\ttarea    = (!navbar && fm.storage('view') != 'list'),\n\t\t\t\tsplit    = function(name) {\n\t\t\t\t\tvar ext = fm.splitFileExtention(name)[1];\n\t\t\t\t\treturn [name.substr(0, name.length - ext.length - 1), ext];\n\t\t\t\t},\n\t\t\t\tunselect = function() {\n\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\tinput && input.trigger('blur');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\trest     = function(){\n\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\toverlay.elfinderoverlay('hide').off('click close', cancel);\n\t\t\t\t\t}\n\t\t\t\t\tpnode.removeClass('ui-front')\n\t\t\t\t\t\t.css('position', '')\n\t\t\t\t\t\t.off('unselect.'+fm.namespace, unselect);\n\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\tnode && node.css('max-height', '');\n\t\t\t\t\t} else if (!navbar) {\n\t\t\t\t\t\tpnode.css('width', '')\n\t\t\t\t\t\t\t.parent('td').css('overflow', '');\n\t\t\t\t\t}\n\t\t\t\t}, colwidth,\n\t\t\t\tdfrd     = $.Deferred()\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tvar parent = input.parent(),\n\t\t\t\t\t\t\tname   = fm.escape(file.i18 || file.name);\n\n\t\t\t\t\t\tinput.off();\n\t\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\t\tname = name.replace(/([_.])/g, '&#8203;$1');\n\t\t\t\t\t\t}\n\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\t\tinput.replaceWith(name);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (parent.length) {\n\t\t\t\t\t\t\t\t\tinput.remove();\n\t\t\t\t\t\t\t\t\tparent.html(name);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttarget.find(filename).html(name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t})\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\trest();\n\t\t\t\t\t\tfm.unbind('resize', resize);\n\t\t\t\t\t\tfm.enable();\n\t\t\t\t\t}),\n\t\t\t\tblur = function(e) {\n\t\t\t\t\tvar name   = $.trim(input.val()),\n\t\t\t\t\tsplits = fm.splitFileExtention(name),\n\t\t\t\t\tvalid  = true,\n\t\t\t\t\treq = function() {\n\t\t\t\t\t\tinput.off();\n\t\t\t\t\t\trest();\n\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\tinput.replaceWith(fm.escape(name));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.html(fm.escape(name));\n\t\t\t\t\t\t}\n\t\t\t\t\t\trequest(dfrd, sel, file, name);\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\tpnode.css('z-index', '');\n\t\t\t\t\t}\n\t\t\t\t\tif (name === '') {\n\t\t\t\t\t\tif (!fm.isRoot(file)) {\n\t\t\t\t\t\t\treturn cancel();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (navbar) {\n\t\t\t\t\t\t\tinput.replaceWith(fm.escape(file.name));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnode.html(fm.escape(file.name));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!inError && pnode.length) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tinput.off('blur');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cnt === 1 && name === file.name) {\n\t\t\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (fm.options.validName && fm.options.validName.test) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvalid = fm.options.validName.test(name);\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (name === '.' || name === '..' || !valid) {\n\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\tfm.error(file.mime === 'directory'? 'errInvDirname' : 'errInvName', {modal: true, close: function(){setTimeout(select, 120);}});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (cnt === 1 && fm.fileByName(name, file.phash)) {\n\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\tfm.error(['errExists', name], {modal: true, close: function(){setTimeout(select, 120);}});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (cnt === 1) {\n\t\t\t\t\t\t\treq();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfm.confirm({\n\t\t\t\t\t\t\t\ttitle : 'cmdrename',\n\t\t\t\t\t\t\t\ttext  : ['renameMultiple', cnt, getHint(name, [file.hash].concat(sel))],\n\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\tlabel : 'btnYes',\n\t\t\t\t\t\t\t\t\tcallback : req\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\tlabel : 'btnCancel',\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tinError = true;\n\t\t\t\t\t\t\t\t\t\t\tselect();\n\t\t\t\t\t\t\t\t\t\t}, 120);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', {files: fm.selected()})\n\t\t\t\t\t\t\t\t\t.trigger('selectfiles', {files : [file.hash].concat(sel)});\n\t\t\t\t\t\t\t}, 120);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinput = $(tarea? '<textarea/>' : '<input type=\"text\"/>')\n\t\t\t\t\t.on('keyup text', function(){\n\t\t\t\t\t\tif (tarea) {\n\t\t\t\t\t\t\tthis.style.height = '1px';\n\t\t\t\t\t\t\tthis.style.height = this.scrollHeight + 'px';\n\t\t\t\t\t\t} else if (colwidth) {\n\t\t\t\t\t\t\tthis.style.width = colwidth + 'px';\n\t\t\t\t\t\t\tif (this.scrollWidth > colwidth) {\n\t\t\t\t\t\t\t\tthis.style.width = this.scrollWidth + 10 + 'px';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t} else if (e.keyCode == $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tinput.trigger('blur');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('mousedown click dblclick', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tif (e.type === 'dblclick') {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.on('blur', blur)\n\t\t\t\t\t.on('dragenter dragleave dragover drop', function(e) {\n\t\t\t\t\t\t// stop bubbling to prevent upload with native drop event\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t}),\n\t\t\t\tselect = function() {\n\t\t\t\t\tvar name = fm.splitFileExtention(input.val())[0];\n\t\t\t\t\tif (!inError && fm.UA.Mobile && !fm.UA.iOS) { // since iOS has a bug? (z-index not effect) so disable it\n\t\t\t\t\t\toverlay.on('click close', cancel).elfinderoverlay('show');\n\t\t\t\t\t\tpnode.css('z-index', overlay.css('z-index') + 1);\n\t\t\t\t\t}\n\t\t\t\t\t! fm.enabled() && fm.enable();\n\t\t\t\t\tif (inError) {\n\t\t\t\t\t\tinError = false;\n\t\t\t\t\t\tinput.on('blur', blur);\n\t\t\t\t\t}\n\t\t\t\t\tinput.trigger('focus').trigger('select');\n\t\t\t\t\tinput[0].setSelectionRange && input[0].setSelectionRange(0, name.length);\n\t\t\t\t},\n\t\t\t\tnode = navbar? target.contents().filter(function(){ return this.nodeType==3 && $(this).parent().attr('id') === fm.navHash2Id(file.hash); })\n\t\t\t\t\t\t: target.find(filename),\n\t\t\t\tpnode = node.parent(),\n\t\t\t\toverlay = fm.getUI('overlay'),\n\t\t\t\tcancel = function(e) { \n\t\t\t\t\tif (!overlay.is(':hidden')) {\n\t\t\t\t\t\tpnode.css('z-index', '');\n\t\t\t\t\t}\n\t\t\t\t\tif (! inError) {\n\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresize = function() {\n\t\t\t\t\ttarget.trigger('scrolltoview', {blink : false});\n\t\t\t\t},\n\t\t\t\tinError = false;\n\t\t\t\n\t\t\tpnode.addClass('ui-front')\n\t\t\t\t.css('position', 'relative')\n\t\t\t\t.on('unselect.'+fm.namespace, unselect);\n\t\t\tfm.bind('resize', resize);\n\t\t\tif (navbar) {\n\t\t\t\tnode.replaceWith(input.val(file.name));\n\t\t\t} else {\n\t\t\t\tif (tarea) {\n\t\t\t\t\tnode.css('max-height', 'none');\n\t\t\t\t} else if (!navbar) {\n\t\t\t\t\tcolwidth = pnode.width();\n\t\t\t\t\tpnode.width(colwidth - 15)\n\t\t\t\t\t\t.parent('td').css('overflow', 'visible');\n\t\t\t\t}\n\t\t\t\tnode.empty().append(input.val(file.name));\n\t\t\t}\n\t\t\t\n\t\t\tif (cnt > 1 && fm.api <= 2.1030) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tif (!file || !node.length) {\n\t\t\t\treturn dfrd.reject('errCmdParams', this.title);\n\t\t\t}\n\t\t\t\n\t\t\tif (file.locked && !fm.isRoot(file)) {\n\t\t\t\treturn dfrd.reject(['errLocked', file.name]);\n\t\t\t}\n\t\t\t\n\t\t\tfm.one('select', function() {\n\t\t\t\tinput.parent().length && file && $.inArray(file.hash, fm.selected()) === -1 && input.trigger('blur');\n\t\t\t});\n\t\t\t\n\t\t\tinput.trigger('keyup');\n\t\t\t\n\t\t\tselect();\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t\tfm.bind('select contextmenucreate closecontextmenu', function(e) {\n\t\t\tvar sel = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected(),\n\t\t\t\tfile;\n\t\t\tif (sel && sel.length === 1 && (file = fm.file(sel[0])) && fm.isRoot(file)) {\n\t\t\t\tself.title = fm.i18n('kindAlias') + ' (' + fm.i18n('preference') + ')';\n\t\t\t} else {\n\t\t\t\tself.title = fm.i18n('cmdrename');\n\t\t\t}\n\t\t\tif (e.type !== 'closecontextmenu') {\n\t\t\t\tself.update(void(0), self.title);\n\t\t\t} else {\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tself.update(void(0), self.title);\n\t\t\t\t});\n\t\t\t}\n\t\t}).remove(function(e) {\n\t\t\tvar rootNames;\n\t\t\tif (e.data && e.data.removed && (rootNames = fm.storage('rootNames'))) {\n\t\t\t\t$.each(e.data.removed, function(i, h) {\n\t\t\t\t\tif (rootNames[h]) {\n\t\t\t\t\t\tdelete rootNames[h];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tfm.storage('rootNames', rootNames);\n\t\t\t}\n\t\t});\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/resize',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"resize\"\n\t * Open dialog to resize image\n\t *\n\t * @author Dmitry (dio) Levashov\n\t * @author Alexey Sukhotin\n\t * @author Naoki Sawada\n\t * @author Sergio Jovani\n\t **/\n\telFinder.prototype.commands.resize = function() {\n\t\t\"use strict\";\n\t\tvar fm = this.fm,\n\t\t\tlosslessRotate = 0,\n\t\t\tgetBounceBox = function(w, h, theta) {\n\t\t\t\tvar srcPts = [\n\t\t\t\t\t\t{x: w/2, y: h/2},\n\t\t\t\t\t\t{x: -w/2, y: h/2},\n\t\t\t\t\t\t{x: -w/2, y: -h/2},\n\t\t\t\t\t\t{x: w/2, y: -h/2}\n\t\t\t\t\t],\n\t\t\t\t\tdstPts = [],\n\t\t\t\t\tmin = {x: Number.MAX_VALUE, y: Number.MAX_VALUE},\n\t\t\t\t\tmax = {x: Number.MIN_VALUE, y: Number.MIN_VALUE};\n\t\t\t\t$.each(srcPts, function(i, srcPt){\n\t\t\t\t\tdstPts.push({\n\t\t\t\t\t\tx: srcPt.x * Math.cos(theta) - srcPt.y * Math.sin(theta),\n\t\t\t\t\t\ty: srcPt.x * Math.sin(theta) + srcPt.y * Math.cos(theta)\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t$.each(dstPts, function(i, pt) {\n\t\t\t\t\tmin.x = Math.min(min.x, pt.x);\n\t\t\t\t\tmin.y = Math.min(min.y, pt.y);\n\t\t\t\t\tmax.x = Math.max(max.x, pt.x);\n\t\t\t\t\tmax.y = Math.max(max.y, pt.y);\n\t\t\t\t});\n\t\t\t\treturn {\n\t\t\t\t\twidth: max.x - min.x, height: max.y - min.y\n\t\t\t\t};\n\t\t\t};\n\t\t\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\tvar sel = fm.selectedFiles();\n\t\t\treturn sel.length == 1 && sel[0].read && sel[0].write && sel[0].mime.indexOf('image/') !== -1 ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.resizeRequest = function(data, f, dfrd) {\n\t\t\tvar file = f || fm.file(data.target),\n\t\t\t\ttmb  = file? file.tmb : null,\n\t\t\t\tenabled = fm.isCommandEnabled('resize', data.target);\n\t\t\t\n\t\t\tif (enabled && (! file || (file && file.read && file.write && file.mime.indexOf('image/') !== -1 ))) {\n\t\t\t\treturn fm.request({\n\t\t\t\t\tdata : Object.assign(data, {\n\t\t\t\t\t\tcmd : 'resize'\n\t\t\t\t\t}),\n\t\t\t\t\tnotify : {type : 'resize', cnt : 1}\n\t\t\t\t})\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tif (dfrd) {\n\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.done(function() {\n\t\t\t\t\tif (data.quality) {\n\t\t\t\t\t\tfm.storage('jpgQuality', data.quality === fm.option('jpgQuality')? null : data.quality);\n\t\t\t\t\t}\n\t\t\t\t\tdfrd && dfrd.resolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar error;\n\t\t\t\t\n\t\t\t\tif (file) {\n\t\t\t\t\tif (file.mime.indexOf('image/') === -1) {\n\t\t\t\t\t\terror = ['errResize', file.name, 'errUsupportType'];\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror = ['errResize', file.name, 'errPerm'];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\terror = ['errResize', data.target, 'errPerm'];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (dfrd) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t} else {\n\t\t\t\t\tfm.error(error);\n\t\t\t\t}\n\t\t\t\treturn $.Deferred().reject(error);\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes) {\n\t\t\tvar self  = this,\n\t\t\t\tfiles = this.files(hashes),\n\t\t\t\tdfrd  = $.Deferred(),\n\t\t\t\tapi2  = (fm.api > 1),\n\t\t\t\toptions = this.options,\n\t\t\t\tdialogWidth = 650,\n\t\t\t\tfmnode = fm.getUI(),\n\t\t\t\tctrgrup = $().controlgroup? 'controlgroup' : 'buttonset',\n\t\t\t\tgrid8Def = typeof options.grid8px === 'undefined' || options.grid8px !== 'disable'? true : false,\n\t\t\t\tpresetSize = Array.isArray(options.presetSize)? options.presetSize : [],\n\t\t\t\tclactive = 'elfinder-dialog-active',\n\t\t\t\tclsediting = fm.res('class', 'editing'),\n\t\t\t\topen = function(file, id, src) {\n\t\t\t\t\tvar isJpeg   = (file.mime === 'image/jpeg'),\n\t\t\t\t\t\tdialog   = $('<div class=\"elfinder-resize-container\"/>'),\n\t\t\t\t\t\tinput    = '<input type=\"number\" class=\"ui-corner-all\"/>',\n\t\t\t\t\t\trow      = '<div class=\"elfinder-resize-row\"/>',\n\t\t\t\t\t\tlabel    = '<div class=\"elfinder-resize-label\"/>',\n\t\t\t\t\t\tchangeTm = null,\n\t\t\t\t\t\toperate  = false,\n\t\t\t\t\t\topStart  = function() { operate = true; },\n\t\t\t\t\t\topStop   = function() {\n\t\t\t\t\t\t\tif (operate) {\n\t\t\t\t\t\t\t\toperate = false;\n\t\t\t\t\t\t\t\tcontrol.trigger('change');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcontrol  = $('<div class=\"elfinder-resize-control\"/>')\n\t\t\t\t\t\t\t.on('focus', 'input[type=text],input[type=number]', function() {\n\t\t\t\t\t\t\t\t$(this).trigger('select');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tchangeTm && cancelAnimationFrame(changeTm);\n\t\t\t\t\t\t\t\tchangeTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\tvar panel, quty, canvas, ctx, img, sx, sy, sw, sh, deg, theta, bb;\n\t\t\t\t\t\t\t\t\tif (sizeImg && ! operate && (canvas = sizeImg.data('canvas'))) {\n\t\t\t\t\t\t\t\t\t\tpanel = control.children('div.elfinder-resize-control-panel:visible');\n\t\t\t\t\t\t\t\t\t\tquty = panel.find('input.elfinder-resize-quality');\n\t\t\t\t\t\t\t\t\t\tif (quty.is(':visible')) {\n\t\t\t\t\t\t\t\t\t\t\tctx = sizeImg.data('ctx');\n\t\t\t\t\t\t\t\t\t\t\timg = sizeImg.get(0);\n\t\t\t\t\t\t\t\t\t\t\tif (panel.hasClass('elfinder-resize-uiresize')) {\n\t\t\t\t\t\t\t\t\t\t\t\t// resize\n\t\t\t\t\t\t\t\t\t\t\t\tsw = canvas.width = width.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsh = canvas.height = height.val();\n\t\t\t\t\t\t\t\t\t\t\t\tctx.drawImage(img, 0, 0, sw, sh);\n\t\t\t\t\t\t\t\t\t\t\t} else if (panel.hasClass('elfinder-resize-uicrop')) {\n\t\t\t\t\t\t\t\t\t\t\t\t// crop\n\t\t\t\t\t\t\t\t\t\t\t\tsx = pointX.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsy = pointY.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsw = offsetX.val();\n\t\t\t\t\t\t\t\t\t\t\t\tsh = offsetY.val();\n\t\t\t\t\t\t\t\t\t\t\t\tcanvas.width = sw;\n\t\t\t\t\t\t\t\t\t\t\t\tcanvas.height = sh;\n\t\t\t\t\t\t\t\t\t\t\t\tctx.drawImage(img, sx, sy, sw, sh, 0, 0, sw, sh);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t// rotate\n\t\t\t\t\t\t\t\t\t\t\t\tdeg = degree.val();\n\t\t\t\t\t\t\t\t\t\t\t\ttheta = (degree.val() * Math.PI) / 180;\n\t\t\t\t\t\t\t\t\t\t\t\tbb = getBounceBox(owidth, oheight, theta);\n\t\t\t\t\t\t\t\t\t\t\t\tsw = canvas.width = bb.width;\n\t\t\t\t\t\t\t\t\t\t\t\tsh = canvas.height = bb.height;\n\t\t\t\t\t\t\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t\t\t\t\t\t\tif (deg % 90 !== 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tctx.fillStyle = bg.val() || '#FFF';\n\t\t\t\t\t\t\t\t\t\t\t\t\tctx.fillRect(0, 0, sw, sh);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tctx.translate(sw / 2, sh / 2);\n\t\t\t\t\t\t\t\t\t\t\t\tctx.rotate(theta);\n\t\t\t\t\t\t\t\t\t\t\t\tctx.drawImage(img, -img.width/2, -img.height/2, owidth, oheight);\n\t\t\t\t\t\t\t\t\t\t\t\tctx.restore();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tcanvas.toBlob(function(blob) {\n\t\t\t\t\t\t\t\t\t\t\t\tblob && quty.next('span').text(' (' + fm.formatSize(blob.size) + ')');\n\t\t\t\t\t\t\t\t\t\t\t}, 'image/jpeg', Math.max(Math.min(quty.val(), 100), 1) / 100);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('mouseup', 'input', function(e) {\n\t\t\t\t\t\t\t\t$(e.target).trigger('change');\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tpreview  = $('<div class=\"elfinder-resize-preview\"/>')\n\t\t\t\t\t\t\t.on('touchmove', function(e) {\n\t\t\t\t\t\t\t\tif ($(e.target).hasClass('touch-punch')) {\n\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tspinner  = $('<div class=\"elfinder-resize-loading\">'+fm.i18n('ntfloadimg')+'</div>'),\n\t\t\t\t\t\trhandle  = $('<div class=\"elfinder-resize-handle touch-punch\"/>'),\n\t\t\t\t\t\trhandlec = $('<div class=\"elfinder-resize-handle touch-punch\"/>'),\n\t\t\t\t\t\tuiresize = $('<div class=\"elfinder-resize-uiresize elfinder-resize-control-panel\"/>'),\n\t\t\t\t\t\tuicrop   = $('<div class=\"elfinder-resize-uicrop elfinder-resize-control-panel\"/>'),\n\t\t\t\t\t\tuirotate = $('<div class=\"elfinder-resize-rotate elfinder-resize-control-panel\"/>'),\n\t\t\t\t\t\tuideg270 = $('<button/>').attr('title',fm.i18n('rotate-cw')).append($('<span class=\"elfinder-button-icon elfinder-button-icon-rotate-l\"/>')),\n\t\t\t\t\t\tuideg90  = $('<button/>').attr('title',fm.i18n('rotate-ccw')).append($('<span class=\"elfinder-button-icon elfinder-button-icon-rotate-r\"/>')),\n\t\t\t\t\t\tuiprop   = $('<span />'),\n\t\t\t\t\t\treset    = $('<button class=\"elfinder-resize-reset\">').text(fm.i18n('reset'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tresetView();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\tprimary: 'ui-icon-arrowrefresh-1-n'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tuitype   = $('<div class=\"elfinder-resize-type\"/>')\n\t\t\t\t\t\t\t.append('<input type=\"radio\" name=\"type\" id=\"'+id+'-resize\" value=\"resize\" checked=\"checked\" /><label for=\"'+id+'-resize\">'+fm.i18n('resize')+'</label>',\n\t\t\t\t\t\t\t'<input class=\"api2\" type=\"radio\" name=\"type\" id=\"'+id+'-crop\" value=\"crop\" /><label class=\"api2\" for=\"'+id+'-crop\">'+fm.i18n('crop')+'</label>',\n\t\t\t\t\t\t\t'<input class=\"api2\" type=\"radio\" name=\"type\" id=\"'+id+'-rotate\" value=\"rotate\" /><label class=\"api2\" for=\"'+id+'-rotate\">'+fm.i18n('rotate')+'</label>'),\n\t\t\t\t\t\tmode     = 'resize',\n\t\t\t\t\t\ttype     = uitype[ctrgrup]()[ctrgrup]('disable').find('input')\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tmode = $(this).val();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tresetView();\n\t\t\t\t\t\t\t\tresizable(true);\n\t\t\t\t\t\t\t\tcroppable(true);\n\t\t\t\t\t\t\t\trotateable(true);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (mode == 'resize') {\n\t\t\t\t\t\t\t\t\tuiresize.show();\n\t\t\t\t\t\t\t\t\tuirotate.hide();\n\t\t\t\t\t\t\t\t\tuicrop.hide();\n\t\t\t\t\t\t\t\t\tresizable();\n\t\t\t\t\t\t\t\t\tisJpeg && grid8px.insertAfter(uiresize.find('.elfinder-resize-grid8'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (mode == 'crop') {\n\t\t\t\t\t\t\t\t\tuirotate.hide();\n\t\t\t\t\t\t\t\t\tuiresize.hide();\n\t\t\t\t\t\t\t\t\tuicrop.show();\n\t\t\t\t\t\t\t\t\tcroppable();\n\t\t\t\t\t\t\t\t\tisJpeg && grid8px.insertAfter(uicrop.find('.elfinder-resize-grid8'));\n\t\t\t\t\t\t\t\t} else if (mode == 'rotate') {\n\t\t\t\t\t\t\t\t\tuiresize.hide();\n\t\t\t\t\t\t\t\t\tuicrop.hide();\n\t\t\t\t\t\t\t\t\tuirotate.show();\n\t\t\t\t\t\t\t\t\trotateable();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\twidth   = $(input)\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tvar w = round(parseInt(width.val())),\n\t\t\t\t\t\t\t\t\th = round(cratio ? w/ratio : parseInt(height.val()));\n\n\t\t\t\t\t\t\t\tif (w > 0 && h > 0) {\n\t\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\t\twidth.val(w);\n\t\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).addClass('elfinder-focus'),\n\t\t\t\t\t\theight  = $(input)\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\tvar h = round(parseInt(height.val())),\n\t\t\t\t\t\t\t\t\tw = round(cratio ? h*ratio : parseInt(width.val()));\n\n\t\t\t\t\t\t\t\tif (w > 0 && h > 0) {\n\t\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\t\twidth.val(w);\n\t\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tpointX  = $(input).on('change', function(){crop.updateView();}),\n\t\t\t\t\t\tpointY  = $(input).on('change', function(){crop.updateView();}),\n\t\t\t\t\t\toffsetX = $(input).on('change', function(){crop.updateView('w');}),\n\t\t\t\t\t\toffsetY = $(input).on('change', function(){crop.updateView('h');}),\n\t\t\t\t\t\tquality = isJpeg && api2?\n\t\t\t\t\t\t\t$(input).val(fm.storage('jpgQuality') > 0? fm.storage('jpgQuality') : fm.option('jpgQuality'))\n\t\t\t\t\t\t\t\t.addClass('elfinder-resize-quality')\n\t\t\t\t\t\t\t\t.attr('min', '1').attr('max', '100').attr('title', '1 - 100')\n\t\t\t\t\t\t\t\t.on('blur', function(){\n\t\t\t\t\t\t\t\t\tvar q = Math.min(100, Math.max(1, parseInt(this.value)));\n\t\t\t\t\t\t\t\t\tcontrol.find('input.elfinder-resize-quality').val(q);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tdegree = $('<input type=\"number\" class=\"ui-corner-all\" maxlength=\"3\" value=\"0\" />')\n\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\trotate.update();\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tuidegslider = $('<div class=\"elfinder-resize-rotate-slider touch-punch\"/>')\n\t\t\t\t\t\t\t.slider({\n\t\t\t\t\t\t\t\tmin: 0,\n\t\t\t\t\t\t\t\tmax: 360,\n\t\t\t\t\t\t\t\tvalue: degree.val(),\n\t\t\t\t\t\t\t\tanimate: true,\n\t\t\t\t\t\t\t\tstart: opStart,\n\t\t\t\t\t\t\t\tstop: opStop,\n\t\t\t\t\t\t\t\tchange: function(event, ui) {\n\t\t\t\t\t\t\t\t\tif (ui.value != uidegslider.slider('value')) {\n\t\t\t\t\t\t\t\t\t\trotate.update(ui.value);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tslide: function(event, ui) {\n\t\t\t\t\t\t\t\t\trotate.update(ui.value, false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).find('.ui-slider-handle')\n\t\t\t\t\t\t\t\t.addClass('elfinder-tabstop')\n\t\t\t\t\t\t\t\t.off('keydown')\n\t\t\t\t\t\t\t\t.on('keydown', function(e) {\n\t\t\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.LEFT || e.keyCode == $.ui.keyCode.RIGHT) {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\trotate.update(Number(degree.val()) + (e.keyCode == $.ui.keyCode.RIGHT? 1 : -1), false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.end(),\n\t\t\t\t\t\tpickimg,\n\t\t\t\t\t\tpickcanv,\n\t\t\t\t\t\tpickctx,\n\t\t\t\t\t\tpickc = {},\n\t\t\t\t\t\tpick = function(e) {\n\t\t\t\t\t\t\tvar color, r, g, b, h, s, l;\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tcolor = pickc[Math.round(e.offsetX)][Math.round(e.offsetY)];\n\t\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\t\tif (!color) return;\n\n\t\t\t\t\t\t\tr = color[0]; g = color[1]; b = color[2];\n\t\t\t\t\t\t\th = color[3]; s = color[4]; l = color[5];\n\n\t\t\t\t\t\t\tsetbg(r, g, b, (e.type === 'click'));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpalpick = function(e) {\n\t\t\t\t\t\t\tsetbg($(this).css('backgroundColor'), '', '', (e.type === 'click'));\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetbg = function(r, g, b, off) {\n\t\t\t\t\t\t\tvar s, m, cc;\n\t\t\t\t\t\t\tif (typeof r === 'string') {\n\t\t\t\t\t\t\t\tg = '';\n\t\t\t\t\t\t\t\tif (r && (s = $('<span>').css('backgroundColor', r).css('backgroundColor')) && (m = s.match(/rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/i))) {\n\t\t\t\t\t\t\t\t\tr = Number(m[1]);\n\t\t\t\t\t\t\t\t\tg = Number(m[2]);\n\t\t\t\t\t\t\t\t\tb = Number(m[3]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcc = (g === '')? r : '#' + getColorCode(r, g, b);\n\t\t\t\t\t\t\tbg.val(cc).css({ backgroundColor: cc, backgroundImage: 'none', color: (r+g+b < 384? '#fff' : '#000') });\n\t\t\t\t\t\t\tpreview.css('backgroundColor', cc);\n\t\t\t\t\t\t\tif (off) {\n\t\t\t\t\t\t\t\timgr.off('.picker').removeClass('elfinder-resize-picking');\n\t\t\t\t\t\t\t\tpallet.off('.picker').removeClass('elfinder-resize-picking');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetColorCode = function(r, g, b) {\n\t\t\t\t\t\t\treturn $.map([r,g,b], function(c){return ('0'+parseInt(c).toString(16)).slice(-2);}).join('');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpicker = $('<button>').text(fm.i18n('colorPicker'))\n\t\t\t\t\t\t.on('click', function() { \n\t\t\t\t\t\t\timgr.on('mousemove.picker click.picker', pick).addClass('elfinder-resize-picking');\n\t\t\t\t\t\t\tpallet.on('mousemove.picker click.picker', 'span', palpick).addClass('elfinder-resize-picking');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\tprimary: 'ui-icon-pin-s'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t}),\n\t\t\t\t\t\treseter = $('<button>').text(fm.i18n('reset'))\n\t\t\t\t\t\t\t.on('click', function() { \n\t\t\t\t\t\t\t\tsetbg('', '', '', true);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\tprimary: 'ui-icon-arrowrefresh-1-n'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tbg = $('<input class=\"ui-corner-all elfinder-resize-bg\" type=\"text\">')\n\t\t\t\t\t\t\t.on('focus', function() {\n\t\t\t\t\t\t\t\t$(this).attr('style', '');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('blur', function() {\n\t\t\t\t\t\t\t\tsetbg($(this).val());\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tpallet  = $('<div class=\"elfinder-resize-pallet\">').on('click', 'span', function() {\n\t\t\t\t\t\t\tsetbg($(this).css('backgroundColor'));\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tratio   = 1,\n\t\t\t\t\t\tprop    = 1,\n\t\t\t\t\t\towidth  = 0,\n\t\t\t\t\t\toheight = 0,\n\t\t\t\t\t\tcratio  = true,\n\t\t\t\t\t\tcratioc = false,\n\t\t\t\t\t\tpwidth  = 0,\n\t\t\t\t\t\tpheight = 0,\n\t\t\t\t\t\trwidth  = 0,\n\t\t\t\t\t\trheight = 0,\n\t\t\t\t\t\trdegree = 0,\n\t\t\t\t\t\tgrid8   = isJpeg? grid8Def : false,\n\t\t\t\t\t\tconstr  = $('<button>').html(fm.i18n('aspectRatio'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tcratio = ! cratio;\n\t\t\t\t\t\t\t\tconstr.button('option', {\n\t\t\t\t\t\t\t\t\ticons : { primary: cratio? 'ui-icon-locked' : 'ui-icon-unlocked'}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tresize.fixHeight();\n\t\t\t\t\t\t\t\trhandle.resizable('option', 'aspectRatio', cratio).data('uiResizable')._aspectRatio = cratio;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons : {\n\t\t\t\t\t\t\t\t\tprimary: cratio? 'ui-icon-locked' : 'ui-icon-unlocked'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tconstrc = $('<button>').html(fm.i18n('aspectRatio'))\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tcratioc = ! cratioc;\n\t\t\t\t\t\t\t\tconstrc.button('option', {\n\t\t\t\t\t\t\t\t\ticons : { primary: cratioc? 'ui-icon-locked' : 'ui-icon-unlocked'}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\trhandlec.resizable('option', 'aspectRatio', cratioc).data('uiResizable')._aspectRatio = cratioc;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons : {\n\t\t\t\t\t\t\t\t\tprimary: cratioc? 'ui-icon-locked' : 'ui-icon-unlocked'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tgrid8px = $('<button>').html(fm.i18n(grid8? 'enabled' : 'disabled')).toggleClass('ui-state-active', grid8)\n\t\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t\tgrid8 = ! grid8;\n\t\t\t\t\t\t\t\tgrid8px.html(fm.i18n(grid8? 'enabled' : 'disabled')).toggleClass('ui-state-active', grid8);\n\t\t\t\t\t\t\t\tsetStep8();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.button(),\n\t\t\t\t\t\tsetStep8 = function() {\n\t\t\t\t\t\t\tvar step = grid8? 8 : 1;\n\t\t\t\t\t\t\t$.each([width, height, offsetX, offsetY, pointX, pointY], function() {\n\t\t\t\t\t\t\t\tthis.attr('step', step);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (grid8) {\n\t\t\t\t\t\t\t\twidth.val(round(width.val()));\n\t\t\t\t\t\t\t\theight.val(round(height.val()));\n\t\t\t\t\t\t\t\toffsetX.val(round(offsetX.val()));\n\t\t\t\t\t\t\t\toffsetY.val(round(offsetY.val()));\n\t\t\t\t\t\t\t\tpointX.val(round(pointX.val()));\n\t\t\t\t\t\t\t\tpointY.val(round(pointY.val()));\n\t\t\t\t\t\t\t\tif (uiresize.is(':visible')) {\n\t\t\t\t\t\t\t\t\tresize.updateView(width.val(), height.val());\n\t\t\t\t\t\t\t\t} else if (uicrop.is(':visible')) {\n\t\t\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetuprimg = function() {\n\t\t\t\t\t\t\tvar r_scale,\n\t\t\t\t\t\t\t\tfail = function() {\n\t\t\t\t\t\t\t\t\tbg.parent().hide();\n\t\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tr_scale = Math.min(pwidth, pheight) / Math.sqrt(Math.pow(owidth, 2) + Math.pow(oheight, 2));\n\t\t\t\t\t\t\trwidth = Math.ceil(owidth * r_scale);\n\t\t\t\t\t\t\trheight = Math.ceil(oheight * r_scale);\n\t\t\t\t\t\t\timgr.width(rwidth)\n\t\t\t\t\t\t\t\t.height(rheight)\n\t\t\t\t\t\t\t\t.css('margin-top', (pheight-rheight)/2 + 'px')\n\t\t\t\t\t\t\t\t.css('margin-left', (pwidth-rwidth)/2 + 'px');\n\t\t\t\t\t\t\tif (imgr.is(':visible') && bg.is(':visible')) {\n\t\t\t\t\t\t\t\tif (file.mime !== 'image/png') {\n\t\t\t\t\t\t\t\t\tpreview.css('backgroundColor', bg.val());\n\t\t\t\t\t\t\t\t\tpickimg = $('<img>');\n\t\t\t\t\t\t\t\t\tif (fm.isCORS) {\n\t\t\t\t\t\t\t\t\t\tpickimg.attr('crossorigin', 'use-credentials');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tpickimg.on('load', function() {\n\t\t\t\t\t\t\t\t\t\tif (pickcanv && pickcanv.width !== rwidth) {\n\t\t\t\t\t\t\t\t\t\t\tsetColorData();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.on('error', fail)\n\t\t\t\t\t\t\t\t\t.attr('src', canvSrc);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetupimg = function() {\n\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\n\t\t\t\t\t\t\tsetuprimg();\n\t\t\t\t\t\t\tbasec\n\t\t\t\t\t\t\t\t.width(img.width())\n\t\t\t\t\t\t\t\t.height(img.height());\n\t\t\t\t\t\t\timgc\n\t\t\t\t\t\t\t\t.width(img.width())\n\t\t\t\t\t\t\t\t.height(img.height());\n\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetColorData = function() {\n\t\t\t\t\t\t\tif (pickctx) {\n\t\t\t\t\t\t\t\tvar n, w, h, r, g, b, a, s, l, hsl, hue,\n\t\t\t\t\t\t\t\t\tdata, scale, tx1, tx2, ty1, ty2, rgb,\n\t\t\t\t\t\t\t\t\tdomi = {},\n\t\t\t\t\t\t\t\t\tdomic = [],\n\t\t\t\t\t\t\t\t\tdomiv, palc,\n\t\t\t\t\t\t\t\t\trgbToHsl = function (r, g, b) {\n\t\t\t\t\t\t\t\t\t\tvar h, s, l,\n\t\t\t\t\t\t\t\t\t\t\tmax = Math.max(Math.max(r, g), b),\n\t\t\t\t\t\t\t\t\t\t\tmin = Math.min(Math.min(r, g), b);\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t// Hue, 0 ~ 359\n\t\t\t\t\t\t\t\t\t\tif (max === min) {\n\t\t\t\t\t\t\t\t\t\t\th = 0;\n\t\t\t\t\t\t\t\t\t\t} else if (r === max) {\n\t\t\t\t\t\t\t\t\t\t\th = ((g - b) / (max - min) * 60 + 360) % 360;\n\t\t\t\t\t\t\t\t\t\t} else if (g === max) {\n\t\t\t\t\t\t\t\t\t\t\th = (b - r) / (max - min) * 60 + 120;\n\t\t\t\t\t\t\t\t\t\t} else if (b === max) {\n\t\t\t\t\t\t\t\t\t\t\th = (r - g) / (max - min) * 60 + 240;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// Saturation, 0 ~ 1\n\t\t\t\t\t\t\t\t\t\ts = (max - min) / max;\n\t\t\t\t\t\t\t\t\t\t// Lightness, 0 ~ 1\n\t\t\t\t\t\t\t\t\t\tl = (r *  0.3 + g * 0.59 + b * 0.11) / 255;\n\t\t\t\n\t\t\t\t\t\t\t\t\t\treturn [h, s, l, 'hsl'];\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trgbRound = function(c) {\n\t\t\t\t\t\t\t\t\t\treturn Math.round(c / 8) * 8;\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tcalc:\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tw = pickcanv.width = imgr.width();\n\t\t\t\t\t\t\t\t\th = pickcanv.height = imgr.height();\n\t\t\t\t\t\t\t\t\tscale = w / owidth;\n\t\t\t\t\t\t\t\t\tpickctx.scale(scale, scale);\n\t\t\t\t\t\t\t\t\tpickctx.drawImage(pickimg.get(0), 0, 0);\n\t\t\t\t\n\t\t\t\t\t\t\t\t\tdata = pickctx.getImageData(0, 0, w, h).data;\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Range to detect the dominant color\n\t\t\t\t\t\t\t\t\ttx1 = w * 0.1;\n\t\t\t\t\t\t\t\t\ttx2 = w * 0.9;\n\t\t\t\t\t\t\t\t\tty1 = h * 0.1;\n\t\t\t\t\t\t\t\t\tty2 = h * 0.9;\n\t\t\t\t\n\t\t\t\t\t\t\t\t\tfor (var y = 0; y < h - 1; y++) {\n\t\t\t\t\t\t\t\t\t\tfor (var x = 0; x < w - 1; x++) {\n\t\t\t\t\t\t\t\t\t\t\tn = x * 4 + y * w * 4;\n\t\t\t\t\t\t\t\t\t\t\t// RGB\n\t\t\t\t\t\t\t\t\t\t\tr = data[n]; g = data[n + 1]; b = data[n + 2]; a = data[n + 3];\n\t\t\t\t\t\t\t\t\t\t\t// check alpha ch\n\t\t\t\t\t\t\t\t\t\t\tif (a !== 255) {\n\t\t\t\t\t\t\t\t\t\t\t\tbg.parent().hide();\n\t\t\t\t\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t\t\t\t\t\tbreak calc;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// HSL\n\t\t\t\t\t\t\t\t\t\t\thsl = rgbToHsl(r, g, b);\n\t\t\t\t\t\t\t\t\t\t\thue = Math.round(hsl[0]); s = Math.round(hsl[1] * 100); l = Math.round(hsl[2] * 100);\n\t\t\t\t\t\t\t\t\t\t\tif (! pickc[x]) {\n\t\t\t\t\t\t\t\t\t\t\t\tpickc[x] = {};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// set pickc\n\t\t\t\t\t\t\t\t\t\t\tpickc[x][y] = [r, g, b, hue, s, l];\n\t\t\t\t\t\t\t\t\t\t\t// detect the dominant color\n\t\t\t\t\t\t\t\t\t\t\tif ((x < tx1 || x > tx2) && (y < ty1 || y > ty2)) {\n\t\t\t\t\t\t\t\t\t\t\t\trgb = rgbRound(r) + ',' + rgbRound(g) + ',' + rgbRound(b);\n\t\t\t\t\t\t\t\t\t\t\t\tif (! domi[rgb]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdomi[rgb] = 1;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t++domi[rgb];\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (! pallet.children(':first').length) {\n\t\t\t\t\t\t\t\t\t\tpalc = 1;\n\t\t\t\t\t\t\t\t\t\t$.each(domi, function(c, v) {\n\t\t\t\t\t\t\t\t\t\t\tdomic.push({c: c, v: v});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t$.each(domic.sort(function(a, b) {\n\t\t\t\t\t\t\t\t\t\t\treturn (a.v > b.v)? -1 : 1;\n\t\t\t\t\t\t\t\t\t\t}), function() {\n\t\t\t\t\t\t\t\t\t\t\tif (this.v < 2 || palc > 10) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tpallet.append($('<span style=\"width:20px;height:20px;display:inline-block;background-color:rgb('+this.c+');\">'));\n\t\t\t\t\t\t\t\t\t\t\t++palc;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetupPicker = function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tpickcanv = document.createElement('canvas');\n\t\t\t\t\t\t\t\tpickctx = pickcanv.getContext('2d');\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tpicker.hide();\n\t\t\t\t\t\t\t\tpallet.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetupPreset = function() {\n\t\t\t\t\t\t\tpreset.on('click', 'span.elfinder-resize-preset', function() {\n\t\t\t\t\t\t\t\tvar btn = $(this),\n\t\t\t\t\t\t\t\t\tw = btn.data('s')[0],\n\t\t\t\t\t\t\t\t\th = btn.data('s')[1],\n\t\t\t\t\t\t\t\t\tr = owidth / oheight;\n\t\t\t\t\t\t\t\tbtn.data('s', [h, w]).text(h + 'x' + w);\n\t\t\t\t\t\t\t\tif (owidth > w || oheight > h) {\n\t\t\t\t\t\t\t\t\tif (owidth <= w) {\n\t\t\t\t\t\t\t\t\t\tw = round(h * r);\n\t\t\t\t\t\t\t\t\t} else if (oheight <= h) {\n\t\t\t\t\t\t\t\t\t\th = round(w / r);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (owidth - w > oheight - h) {\n\t\t\t\t\t\t\t\t\t\t\th = round(w / r);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tw = round(h * r);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tw = owidth;\n\t\t\t\t\t\t\t\t\th = oheight;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twidth.val(w);\n\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpresetc.on('click', 'span.elfinder-resize-preset', function() {\n\t\t\t\t\t\t\t\tvar btn = $(this),\n\t\t\t\t\t\t\t\t\tw = btn.data('s')[0],\n\t\t\t\t\t\t\t\t\th = btn.data('s')[1],\n\t\t\t\t\t\t\t\t\tx = pointX.val(),\n\t\t\t\t\t\t\t\t\ty = pointY.val();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tbtn.data('s', [h, w]).text(h + 'x' + w);\n\t\t\t\t\t\t\t\tif (owidth >= w && oheight >= h) {\n\t\t\t\t\t\t\t\t\tif (owidth - w - x < 0) {\n\t\t\t\t\t\t\t\t\t\tx = owidth - w;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (oheight - h - y < 0) {\n\t\t\t\t\t\t\t\t\t\ty = oheight - h;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tpointX.val(x);\n\t\t\t\t\t\t\t\t\tpointY.val(y);\n\t\t\t\t\t\t\t\t\toffsetX.val(w);\n\t\t\t\t\t\t\t\t\toffsetY.val(h);\n\t\t\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpresetc.children('span.elfinder-resize-preset').each(function() {\n\t\t\t\t\t\t\t\tvar btn = $(this),\n\t\t\t\t\t\t\t\t\tw = btn.data('s')[0],\n\t\t\t\t\t\t\t\t\th = btn.data('s')[1];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tbtn[(owidth >= w && oheight >= h)? 'show' : 'hide']();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdimreq  = null,\n\t\t\t\t\t\tinited  = false,\n\t\t\t\t\t\tsetdim  = function(dim) {\n\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\trfile.width = dim[0];\n\t\t\t\t\t\t\trfile.height = dim[1];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinit    = function() {\n\t\t\t\t\t\t\tvar elm, memSize, r_scale, imgRatio;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (inited) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinited = true;\n\t\t\t\t\t\t\tdimreq && dimreq.state && dimreq.state() === 'pending' && dimreq.reject();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// check lossless rotete\n\t\t\t\t\t\t\tif (fm.api >= 2.1030) {\n\t\t\t\t\t\t\t\tif (losslessRotate === 0) {\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\tcmd    : 'resize',\n\t\t\t\t\t\t\t\t\t\t\ttarget : file.hash,\n\t\t\t\t\t\t\t\t\t\t\tdegree : 0,\n\t\t\t\t\t\t\t\t\t\t\tmode   : 'rotate'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\t\t\tlosslessRotate = data.losslessRotate? 1 : -1;\n\t\t\t\t\t\t\t\t\t\tif (losslessRotate === 1 && (degree.val() % 90 === 0)) {\n\t\t\t\t\t\t\t\t\t\t\tuirotate.children('div.elfinder-resize-quality').hide();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\tlosslessRotate = -1;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlosslessRotate = -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\telm = img.get(0);\n\t\t\t\t\t\t\tmemSize = file.width && file.height? {w: file.width, h: file.height} : (elm.naturalWidth? null : {w: img.width(), h: img.height()});\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tmemSize && img.removeAttr('width').removeAttr('height');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\towidth  = file.width || elm.naturalWidth || elm.width || img.width();\n\t\t\t\t\t\t\toheight = file.height || elm.naturalHeight || elm.height || img.height();\n\t\t\t\t\t\t\tif (!file.width || !file.height) {\n\t\t\t\t\t\t\t\tsetdim([owidth, oheight]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tmemSize && img.width(memSize.w).height(memSize.h);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdMinBtn.show();\n\t\t\n\t\t\t\t\t\t\timgRatio = oheight / owidth;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (imgRatio < 1 && preview.height() > preview.width() * imgRatio) {\n\t\t\t\t\t\t\t\tpreview.height(preview.width() * imgRatio);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (preview.height() > img.height() + 20) {\n\t\t\t\t\t\t\t\tpreview.height(img.height() + 20);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tratio = owidth/oheight;\n\t\t\n\t\t\t\t\t\t\trhandle.append(img.show()).show();\n\t\t\t\t\t\t\twidth.val(owidth);\n\t\t\t\t\t\t\theight.val(oheight);\n\t\t\n\t\t\t\t\t\t\tsetupPicker();\n\t\t\t\t\t\t\tsetupPreset();\n\t\t\t\t\t\t\tsetupimg();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tuitype[ctrgrup]('enable');\n\t\t\t\t\t\t\tcontrol.find('input,select').prop('disabled', false)\n\t\t\t\t\t\t\t\t.filter(':text').on('keydown', function(e) {\n\t\t\t\t\t\t\t\t\tvar cOpts;\n\t\t\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ENTER) {\n\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tcOpts = {\n\t\t\t\t\t\t\t\t\t\t\ttitle  : $('input:checked', uitype).val(),\n\t\t\t\t\t\t\t\t\t\t\ttext   : 'confirmReq',\n\t\t\t\t\t\t\t\t\t\t\taccept : {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnApply',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcancel : {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function(){\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).trigger('focus');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (useSaveAs) {\n\t\t\t\t\t\t\t\t\t\t\tcOpts['buttons'] = [{\n\t\t\t\t\t\t\t\t\t\t\t\tlabel    : 'btnSaveAs',\n\t\t\t\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(saveAs);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfm.confirm(cOpts);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.on('keyup', function() {\n\t\t\t\t\t\t\t\t\tvar $this = $(this);\n\t\t\t\t\t\t\t\t\tif (! $this.hasClass('elfinder-resize-bg')) {\n\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\t\t$this.val($this.val().replace(/[^0-9]/g, ''));\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.filter(':first');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsetStep8();\n\t\t\t\t\t\t\t!fm.UA.Mobile && width.trigger('focus');\n\t\t\t\t\t\t\tresizable();\n\t\t\t\t\t\t},\n\t\t\t\t\t\timg     = $('<img/>')\n\t\t\t\t\t\t\t.on('load', init)\n\t\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\t\tspinner.html(fm.i18n('ntfsmth')).css('background', 'transparent');\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\tbasec = $('<div/>'),\n\t\t\t\t\t\timgc = $('<img/>'),\n\t\t\t\t\t\tcoverc = $('<div/>'),\n\t\t\t\t\t\timgr = $('<img class=\"elfinder-resize-imgrotate\" />'),\n\t\t\t\t\t\tround = function(v, max) {\n\t\t\t\t\t\t\tv = grid8? Math.round(v/8)*8 : Math.round(v);\n\t\t\t\t\t\t\tv = Math.max(0, v);\n\t\t\t\t\t\t\tif (max && v > max) {\n\t\t\t\t\t\t\t\tv = grid8? Math.floor(max/8)*8 : max;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn v;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresetView = function() {\n\t\t\t\t\t\t\twidth.val(owidth);\n\t\t\t\t\t\t\theight.val(oheight);\n\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\n\t\t\t\t\t\t\tpointX.val(0);\n\t\t\t\t\t\t\tpointY.val(0);\n\t\t\t\t\t\t\toffsetX.val(owidth);\n\t\t\t\t\t\t\toffsetY.val(oheight);\n\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresize = {\n\t\t\t\t\t\t\tupdate : function() {\n\t\t\t\t\t\t\t\twidth.val(round(img.width()/prop));\n\t\t\t\t\t\t\t\theight.val(round(img.height()/prop));\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdateView : function(w, h) {\n\t\t\t\t\t\t\t\tif (w > pwidth || h > pheight) {\n\t\t\t\t\t\t\t\t\tif (w / pwidth > h / pheight) {\n\t\t\t\t\t\t\t\t\t\tprop = pwidth / w;\n\t\t\t\t\t\t\t\t\t\timg.width(pwidth).height(round(h*prop));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tprop = pheight / h;\n\t\t\t\t\t\t\t\t\t\timg.height(pheight).width(round(w*prop));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\timg.width(round(w)).height(round(h));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tprop = img.width()/w;\n\t\t\t\t\t\t\t\tuiprop.text('1 : '+(1/prop).toFixed(2));\n\t\t\t\t\t\t\t\tresize.updateHandle();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdateHandle : function() {\n\t\t\t\t\t\t\t\trhandle.width(img.width()).height(img.height());\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfixHeight : function() {\n\t\t\t\t\t\t\t\tvar w, h;\n\t\t\t\t\t\t\t\tif (cratio) {\n\t\t\t\t\t\t\t\t\tw = width.val();\n\t\t\t\t\t\t\t\t\th = round(w/ratio);\n\t\t\t\t\t\t\t\t\tresize.updateView(w, h);\n\t\t\t\t\t\t\t\t\theight.val(h);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcrop = {\n\t\t\t\t\t\t\tupdate : function(change) {\n\t\t\t\t\t\t\t\tpointX.val(round(((rhandlec.data('x')||rhandlec.position().left))/prop, owidth));\n\t\t\t\t\t\t\t\tpointY.val(round(((rhandlec.data('y')||rhandlec.position().top))/prop, oheight));\n\t\t\t\t\t\t\t\tif (change !== 'xy') {\n\t\t\t\t\t\t\t\t\toffsetX.val(round((rhandlec.data('w')||rhandlec.width())/prop, owidth - pointX.val()));\n\t\t\t\t\t\t\t\t\toffsetY.val(round((rhandlec.data('h')||rhandlec.height())/prop, oheight - pointY.val()));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdateView : function(change) {\n\t\t\t\t\t\t\t\tvar r, x, y, w, h;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tpointX.val(round(pointX.val(), owidth - (grid8? 8 : 1)));\n\t\t\t\t\t\t\t\tpointY.val(round(pointY.val(), oheight - (grid8? 8 : 1)));\n\t\t\t\t\t\t\t\toffsetX.val(round(offsetX.val(), owidth - pointX.val()));\n\t\t\t\t\t\t\t\toffsetY.val(round(offsetY.val(), oheight - pointY.val()));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (cratioc) {\n\t\t\t\t\t\t\t\t\tr = coverc.width() / coverc.height();\n\t\t\t\t\t\t\t\t\tif (change === 'w') {\n\t\t\t\t\t\t\t\t\t\toffsetY.val(round(parseInt(offsetX.val()) / r));\n\t\t\t\t\t\t\t\t\t} else if (change === 'h') {\n\t\t\t\t\t\t\t\t\t\toffsetX.val(round(parseInt(offsetY.val()) * r));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tx = Math.round(parseInt(pointX.val()) * prop);\n\t\t\t\t\t\t\t\ty = Math.round(parseInt(pointY.val()) * prop);\n\t\t\t\t\t\t\t\tif (change !== 'xy') {\n\t\t\t\t\t\t\t\t\tw = Math.round(parseInt(offsetX.val()) * prop);\n\t\t\t\t\t\t\t\t\th = Math.round(parseInt(offsetY.val()) * prop);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tw = rhandlec.data('w');\n\t\t\t\t\t\t\t\t\th = rhandlec.data('h');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\trhandlec.data({x: x, y: y, w: w, h: h})\n\t\t\t\t\t\t\t\t\t.width(w)\n\t\t\t\t\t\t\t\t\t.height(h)\n\t\t\t\t\t\t\t\t\t.css({left: x, top: y});\n\t\t\t\t\t\t\t\tcoverc.width(w)\n\t\t\t\t\t\t\t\t\t.height(h);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresize_update : function(e, ui) {\n\t\t\t\t\t\t\t\trhandlec.data({x: ui.position.left, y: ui.position.top, w: ui.size.width, h: ui.size.height});\n\t\t\t\t\t\t\t\tcrop.update();\n\t\t\t\t\t\t\t\tcrop.updateView();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdrag_update : function(e, ui) {\n\t\t\t\t\t\t\t\trhandlec.data({x: ui.position.left, y: ui.position.top});\n\t\t\t\t\t\t\t\tcrop.update('xy');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trotate = {\n\t\t\t\t\t\t\tmouseStartAngle : 0,\n\t\t\t\t\t\t\timageStartAngle : 0,\n\t\t\t\t\t\t\timageBeingRotated : false,\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsetQuality : function() {\n\t\t\t\t\t\t\t\tuirotate.children('div.elfinder-resize-quality')[(losslessRotate > 0 && (degree.val() % 90) === 0)? 'hide' : 'show']();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdate : function(value, animate) {\n\t\t\t\t\t\t\t\tif (typeof value == 'undefined') {\n\t\t\t\t\t\t\t\t\trdegree = value = parseInt(degree.val());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (typeof animate == 'undefined') {\n\t\t\t\t\t\t\t\t\tanimate = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (! animate || fm.UA.Opera || fm.UA.ltIE8) {\n\t\t\t\t\t\t\t\t\timgr.rotate(value);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\timgr.animate({rotate: value + 'deg'});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvalue = value % 360;\n\t\t\t\t\t\t\t\tif (value < 0) {\n\t\t\t\t\t\t\t\t\tvalue += 360;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdegree.val(parseInt(value));\n\n\t\t\t\t\t\t\t\tuidegslider.slider('value', degree.val());\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotate.setQuality();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\texecute : function ( e ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ( !rotate.imageBeingRotated ) return;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar imageCentre = rotate.getCenter( imgr );\n\t\t\t\t\t\t\t\tvar ev = e.originalEvent.touches? e.originalEvent.touches[0] : e;\n\t\t\t\t\t\t\t\tvar mouseXFromCentre = ev.pageX - imageCentre[0];\n\t\t\t\t\t\t\t\tvar mouseYFromCentre = ev.pageY - imageCentre[1];\n\t\t\t\t\t\t\t\tvar mouseAngle = Math.atan2( mouseYFromCentre, mouseXFromCentre );\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar rotateAngle = mouseAngle - rotate.mouseStartAngle + rotate.imageStartAngle;\n\t\t\t\t\t\t\t\trotateAngle = Math.round(parseFloat(rotateAngle) * 180 / Math.PI);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ( e.shiftKey ) {\n\t\t\t\t\t\t\t\t\trotateAngle = Math.round((rotateAngle + 6)/15) * 15;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\timgr.rotate(rotateAngle);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotateAngle = rotateAngle % 360;\n\t\t\t\t\t\t\t\tif (rotateAngle < 0) {\n\t\t\t\t\t\t\t\t\trotateAngle += 360;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdegree.val(rotateAngle);\n\n\t\t\t\t\t\t\t\tuidegslider.slider('value', degree.val());\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotate.setQuality();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tstart : function ( e ) {\n\t\t\t\t\t\t\t\tif (imgr.hasClass('elfinder-resize-picking')) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\topStart();\n\t\t\t\t\t\t\t\trotate.imageBeingRotated = true;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar imageCentre = rotate.getCenter( imgr );\n\t\t\t\t\t\t\t\tvar ev = e.originalEvent.touches? e.originalEvent.touches[0] : e;\n\t\t\t\t\t\t\t\tvar mouseStartXFromCentre = ev.pageX - imageCentre[0];\n\t\t\t\t\t\t\t\tvar mouseStartYFromCentre = ev.pageY - imageCentre[1];\n\t\t\t\t\t\t\t\trotate.mouseStartAngle = Math.atan2( mouseStartYFromCentre, mouseStartXFromCentre );\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trotate.imageStartAngle = parseFloat(imgr.rotate()) * Math.PI / 180.0;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$(document).on('mousemove', rotate.execute);\n\t\t\t\t\t\t\t\timgr.on('touchmove', rotate.execute);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tstop : function ( e ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ( !rotate.imageBeingRotated ) return;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$(document).off('mousemove', rotate.execute);\n\t\t\t\t\t\t\t\timgr.off('touchmove', rotate.execute);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trequestAnimationFrame(function() { rotate.imageBeingRotated = false; });\n\t\t\t\t\t\t\t\topStop();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tgetCenter : function ( image ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar currentRotation = imgr.rotate();\n\t\t\t\t\t\t\t\timgr.rotate(0);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar imageOffset = imgr.offset();\n\t\t\t\t\t\t\t\tvar imageCentreX = imageOffset.left + imgr.width() / 2;\n\t\t\t\t\t\t\t\tvar imageCentreY = imageOffset.top + imgr.height() / 2;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\timgr.rotate(currentRotation);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn Array( imageCentreX, imageCentreY );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresizable = function(destroy) {\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\trhandle.filter(':ui-resizable').resizable('destroy');\n\t\t\t\t\t\t\t\trhandle.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\trhandle.show();\n\t\t\t\t\t\t\t\trhandle.resizable({\n\t\t\t\t\t\t\t\t\talsoResize  : img,\n\t\t\t\t\t\t\t\t\taspectRatio : cratio,\n\t\t\t\t\t\t\t\t\tresize      : resize.update,\n\t\t\t\t\t\t\t\t\tstart       : opStart,\n\t\t\t\t\t\t\t\t\tstop        : function(e) {\n\t\t\t\t\t\t\t\t\t\tresize.fixHeight;\n\t\t\t\t\t\t\t\t\t\tresize.updateView(width.val(), height.val());\n\t\t\t\t\t\t\t\t\t\topStop();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcroppable = function(destroy) {\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\trhandlec.filter(':ui-resizable').resizable('destroy')\n\t\t\t\t\t\t\t\t\t.filter(':ui-draggable').draggable('destroy');\n\t\t\t\t\t\t\t\tbasec.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tbasec.show();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\trhandlec\n\t\t\t\t\t\t\t\t\t.resizable({\n\t\t\t\t\t\t\t\t\t\tcontainment : basec,\n\t\t\t\t\t\t\t\t\t\taspectRatio : cratioc,\n\t\t\t\t\t\t\t\t\t\tresize      : crop.resize_update,\n\t\t\t\t\t\t\t\t\t\tstart       : opStart,\n\t\t\t\t\t\t\t\t\t\tstop        : opStop,\n\t\t\t\t\t\t\t\t\t\thandles     : 'all'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.draggable({\n\t\t\t\t\t\t\t\t\t\thandle      : coverc,\n\t\t\t\t\t\t\t\t\t\tcontainment : imgc,\n\t\t\t\t\t\t\t\t\t\tdrag        : crop.drag_update,\n\t\t\t\t\t\t\t\t\t\tstart       : opStart,\n\t\t\t\t\t\t\t\t\t\tstop        : function() {\n\t\t\t\t\t\t\t\t\t\t\tcrop.updateView('xy');\n\t\t\t\t\t\t\t\t\t\t\topStop();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t\tcrop.update();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\trotateable = function(destroy) {\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\timgr.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\timgr.show();\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcheckVals = function() {\n\t\t\t\t\t\t\tvar w, h, x, y, d, q, b = '';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (mode == 'resize') {\n\t\t\t\t\t\t\t\tw = parseInt(width.val()) || 0;\n\t\t\t\t\t\t\t\th = parseInt(height.val()) || 0;\n\t\t\t\t\t\t\t} else if (mode == 'crop') {\n\t\t\t\t\t\t\t\tw = parseInt(offsetX.val()) || 0;\n\t\t\t\t\t\t\t\th = parseInt(offsetY.val()) || 0;\n\t\t\t\t\t\t\t\tx = parseInt(pointX.val()) || 0;\n\t\t\t\t\t\t\t\ty = parseInt(pointY.val()) || 0;\n\t\t\t\t\t\t\t} else if (mode == 'rotate') {\n\t\t\t\t\t\t\t\tw = owidth;\n\t\t\t\t\t\t\t\th = oheight;\n\t\t\t\t\t\t\t\td = parseInt(degree.val()) || 0;\n\t\t\t\t\t\t\t\tif (d < 0 || d > 360) {\n\t\t\t\t\t\t\t\t\tfm.error('Invalid rotate degree');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (d == 0 || d == 360) {\n\t\t\t\t\t\t\t\t\tfm.error('errResizeNoChange');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tb = bg.val();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tq = quality? parseInt(quality.val()) : 0;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (mode != 'rotate') {\n\t\t\t\t\t\t\t\tif (w <= 0 || h <= 0) {\n\t\t\t\t\t\t\t\t\tfm.error('Invalid image size');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (w == owidth && h == oheight) {\n\t\t\t\t\t\t\t\t\tfm.error('errResizeNoChange');\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn {w: w, h: h, x: x, y: y, d: d, q: q, b: b};\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsave = function() {\n\t\t\t\t\t\t\tvar vals;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (vals = checkVals()) {\n\t\t\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\t\t\tself.resizeRequest({\n\t\t\t\t\t\t\t\t\ttarget : file.hash,\n\t\t\t\t\t\t\t\t\twidth  : vals.w,\n\t\t\t\t\t\t\t\t\theight : vals.h,\n\t\t\t\t\t\t\t\t\tx      : vals.x,\n\t\t\t\t\t\t\t\t\ty      : vals.y,\n\t\t\t\t\t\t\t\t\tdegree : vals.d,\n\t\t\t\t\t\t\t\t\tquality: vals.q,\n\t\t\t\t\t\t\t\t\tbg     : vals.b,\n\t\t\t\t\t\t\t\t\tmode   : mode\n\t\t\t\t\t\t\t\t}, file, dfrd);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsaveAs = function() {\n\t\t\t\t\t\t\tvar fail = function() {\n\t\t\t\t\t\t\t\t\tdialogs.addClass(clsediting).fadeIn(function() {\n\t\t\t\t\t\t\t\t\t\tbase.addClass(clactive);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfm.disable();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmake = function() {\n\t\t\t\t\t\t\t\t\tself.mime = file.mime;\n\t\t\t\t\t\t\t\t\tself.prefix = file.name.replace(/ \\d+(\\.[^.]+)?$/, '$1');\n\t\t\t\t\t\t\t\t\tself.requestCmd = 'mkfile';\n\t\t\t\t\t\t\t\t\tself.nextAction = {};\n\t\t\t\t\t\t\t\t\tself.data = {target : file.phash};\n\t\t\t\t\t\t\t\t\t$.proxy(fm.res('mixin', 'make'), self)()\n\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\tvar hash, dfd;\n\t\t\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\t\t\thash = data.added[0].hash;\n\t\t\t\t\t\t\t\t\t\t\t\tdfd = fm.api < 2.1032? fm.url(file.hash, { async: true, temporary: true }) : null;\n\t\t\t\t\t\t\t\t\t\t\t\t$.when(dfd).done(function(url) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toptions : {type : 'post'},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd     : 'put',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget  : hash,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tencoding: dfd? 'scheme' : 'hash', \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent : dfd? fm.convAbsUrl(url) : file.hash\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'copy', cnt : 1},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsyncOnFail : true\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t.fail(fail)\n\t\t\t\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata = fm.normalize(data);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfile = fm.file(hash);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata.changed && data.changed.length && fm.change(data);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbase.show().find('.elfinder-dialog-title').html(fm.escape(file.name));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsave();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdialogs.fadeIn();\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}).fail(fail);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tfail();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.fail(fail)\n\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\tdelete self.mime;\n\t\t\t\t\t\t\t\t\t\t\tdelete self.prefix;\n\t\t\t\t\t\t\t\t\t\t\tdelete self.nextAction;\n\t\t\t\t\t\t\t\t\t\t\tdelete self.data;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfm.trigger('unselectfiles', { files: [ file.hash ] });\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\treqOpen = null,\n\t\t\t\t\t\t\t\tdialogs;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (checkVals()) {\n\t\t\t\t\t\t\t\tdialogs = fmnode.children('.' + self.dialogClass + ':visible').removeClass(clsediting).fadeOut();\n\t\t\t\t\t\t\t\tbase.removeClass(clactive);\n\t\t\t\t\t\t\t\tfm.enable();\n\t\t\t\t\t\t\t\tif (fm.searchStatus.state < 2 && file.phash !== fm.cwd().hash) {\n\t\t\t\t\t\t\t\t\treqOpen = fm.exec('open', [file.phash], {thash: file.phash});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$.when([reqOpen]).done(function() {\n\t\t\t\t\t\t\t\t\treqOpen? fm.one('cwdrender', make) : make();\n\t\t\t\t\t\t\t\t}).fail(fail);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbuttons = {},\n\t\t\t\t\t\thline   = 'elfinder-resize-handle-hline',\n\t\t\t\t\t\tvline   = 'elfinder-resize-handle-vline',\n\t\t\t\t\t\trpoint  = 'elfinder-resize-handle-point',\n\t\t\t\t\t\tcanvSrc = src,\n\t\t\t\t\t\tsizeImg = quality? $('<img>').attr('crossorigin', fm.isCORS? 'use-credentials' : '').attr('src', canvSrc).on('load', function() {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tvar canv = document.createElement('canvas');\n\t\t\t\t\t\t\t\tsizeImg.data('canvas', canv).data('ctx', canv.getContext('2d'));\n\t\t\t\t\t\t\t\tjpgCalc();\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\tsizeImg.removeData('canvas').removeData('ctx');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}) : null,\n\t\t\t\t\t\tjpgCalc = function() {\n\t\t\t\t\t\t\tcontrol.find('input.elfinder-resize-quality:visible').trigger('change');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdinit   = function(e) {\n\t\t\t\t\t\t\tif (base.hasClass('elfinder-dialog-minimized') || base.is(':hidden')) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpreset.hide();\n\t\t\t\t\t\t\tpresetc.hide();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar win   = fm.options.dialogContained? fmnode : $(window),\n\t\t\t\t\t\t\t\twinH  = win.height(),\n\t\t\t\t\t\t\t\twinW  = win.width(),\n\t\t\t\t\t\t\t\tpresW = 'auto',\n\t\t\t\t\t\t\t\tpresIn = true,\n\t\t\t\t\t\t\t\tdw, ctrW, prvW;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbase.width(Math.min(dialogWidth, winW - 30));\n\t\t\t\t\t\t\tpreview.attr('style', '');\n\t\t\t\t\t\t\tif (owidth && oheight) {\n\t\t\t\t\t\t\t\tpwidth  = preview.width()  - (rhandle.outerWidth()  - rhandle.width());\n\t\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tctrW  = dialog.find('div.elfinder-resize-control').width();\n\t\t\t\t\t\t\tprvW  = preview.width();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdw = dialog.width() - 20;\n\t\t\t\t\t\t\tif (prvW > dw) {\n\t\t\t\t\t\t\t\tpreview.width(dw);\n\t\t\t\t\t\t\t\tpresIn = false;\n\t\t\t\t\t\t\t} else if ((dw - prvW) < ctrW) {\n\t\t\t\t\t\t\t\tif (winW > winH) {\n\t\t\t\t\t\t\t\t\tpreview.width(dw - ctrW - 20);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tpreview.css({ float: 'none', marginLeft: 'auto', marginRight: 'auto'});\n\t\t\t\t\t\t\t\t\tpresIn = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (presIn) {\n\t\t\t\t\t\t\t\tpresW = ctrW;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpwidth  = preview.width()  - (rhandle.outerWidth()  - rhandle.width());\n\t\t\t\t\t\t\tif (fmnode.hasClass('elfinder-fullscreen')) {\n\t\t\t\t\t\t\t\tif (base.height() > winH) {\n\t\t\t\t\t\t\t\t\twinH -= 2;\n\t\t\t\t\t\t\t\t\tpreview.height(winH - base.height() + preview.height());\n\t\t\t\t\t\t\t\t\tbase.css('top', 0 - fmnode.offset().top);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twinH -= 30;\n\t\t\t\t\t\t\t\t(preview.height() > winH) && preview.height(winH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\tif (owidth && oheight) {\n\t\t\t\t\t\t\t\tsetupimg();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (img.height() && preview.height() > img.height() + 20) {\n\t\t\t\t\t\t\t\tpreview.height(img.height() + 20);\n\t\t\t\t\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\n\t\t\t\t\t\t\t\tsetuprimg();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tpreset.css('width', presW).show();\n\t\t\t\t\t\t\tpresetc.css('width', presW).show();\n\t\t\t\t\t\t\tif (!presetc.children('span.elfinder-resize-preset:visible').length) {\n\t\t\t\t\t\t\t\tpresetc.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.elfinderdialog('posInit');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreset = (function() {\n\t\t\t\t\t\t\tvar sets = $('<fieldset class=\"elfinder-resize-preset-container\">').append($('<legend>').html(fm.i18n('presets'))).css('box-sizing', 'border-box').hide(),\n\t\t\t\t\t\t\t\thasC;\n\t\t\t\t\t\t\t$.each(presetSize, function(i, s) {\n\t\t\t\t\t\t\t\tif (s.length === 2) {\n\t\t\t\t\t\t\t\t\thasC = true;\n\t\t\t\t\t\t\t\t\tsets.append($('<span class=\"elfinder-resize-preset\"/>')\n\t\t\t\t\t\t\t\t\t\t.data('s', s)\n\t\t\t\t\t\t\t\t\t\t.text(s[0]+'x'+s[1])\n\t\t\t\t\t\t\t\t\t\t.button()\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (!hasC) {\n\t\t\t\t\t\t\t\treturn $();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn sets;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tpresetc = preset.clone(true),\n\t\t\t\t\t\tuseSaveAs = fm.uploadMimeCheck(file.mime, file.phash),\n\t\t\t\t\t\tdMinBtn, base;\n\t\t\t\t\t\n\t\t\t\t\tuiresize.append(\n\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('width')), width),\n\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('height')), height, $('<div class=\"elfinder-resize-whctrls\">').append(constr, reset)),\n\t\t\t\t\t\t(quality? $(row).append($(label).text(fm.i18n('quality')), quality, $('<span/>')) : $()),\n\t\t\t\t\t\t(isJpeg? $(row).append($(label).text(fm.i18n('8pxgrid')).addClass('elfinder-resize-grid8'), grid8px) : $()),\n\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('scale')), uiprop),\n\t\t\t\t\t\t$(row).append(preset)\n\t\t\t\t\t);\n\n\t\t\t\t\tif (api2) {\n\t\t\t\t\t\tuicrop.append(\n\t\t\t\t\t\t\t$(row).append($(label).text('X'), pointX),\n\t\t\t\t\t\t\t$(row).append($(label).text('Y')).append(pointY),\n\t\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('width')), offsetX),\n\t\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('height')), offsetY, $('<div class=\"elfinder-resize-whctrls\">').append(constrc, reset.clone(true))),\n\t\t\t\t\t\t\t(quality? $(row).append($(label).text(fm.i18n('quality')), quality.clone(true), $('<span/>')) : $()),\n\t\t\t\t\t\t\t(isJpeg? $(row).append($(label).text(fm.i18n('8pxgrid')).addClass('elfinder-resize-grid8')) : $()),\n\t\t\t\t\t\t\t$(row).append(presetc)\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tuirotate.append(\n\t\t\t\t\t\t\t$(row).addClass('elfinder-resize-degree').append(\n\t\t\t\t\t\t\t\t$(label).text(fm.i18n('rotate')),\n\t\t\t\t\t\t\t\tdegree,\n\t\t\t\t\t\t\t\t$('<span/>').text(fm.i18n('degree')),\n\t\t\t\t\t\t\t\t$('<div/>').append(uideg270, uideg90)[ctrgrup]()\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$(row).css('height', '20px').append(uidegslider),\n\t\t\t\t\t\t\t((quality)? $(row)[losslessRotate < 1? 'show' : 'hide']().addClass('elfinder-resize-quality').append(\n\t\t\t\t\t\t\t\t$(label).text(fm.i18n('quality')),\n\t\t\t\t\t\t\t\tquality.clone(true),\n\t\t\t\t\t\t\t\t$('<span/>')) : $()\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$(row).append($(label).text(fm.i18n('bgcolor')), bg, picker, reseter),\n\t\t\t\t\t\t\t$(row).css('height', '20px').append(pallet)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tuideg270.on('click', function() {\n\t\t\t\t\t\t\trdegree = rdegree - 90;\n\t\t\t\t\t\t\trotate.update(rdegree);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tuideg90.on('click', function(){\n\t\t\t\t\t\t\trdegree = rdegree + 90;\n\t\t\t\t\t\t\trotate.update(rdegree);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdialog.append(uitype).on('resize', function(e){\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (api2) {\n\t\t\t\t\t\tcontrol.append(/*$(row), */uiresize, uicrop.hide(), uirotate.hide());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontrol.append(/*$(row), */uiresize);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\trhandle.append('<div class=\"'+hline+' '+hline+'-top\"/>',\n\t\t\t\t\t\t'<div class=\"'+hline+' '+hline+'-bottom\"/>',\n\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-left\"/>',\n\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-right\"/>',\n\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-e\"/>',\n\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-se\"/>',\n\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-s\"/>');\n\t\t\t\t\t\t\n\t\t\t\t\tpreview.append(spinner).append(rhandle.hide()).append(img.hide());\n\n\t\t\t\t\tif (api2) {\n\t\t\t\t\t\trhandlec.css('position', 'absolute')\n\t\t\t\t\t\t\t.append('<div class=\"'+hline+' '+hline+'-top\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+hline+' '+hline+'-bottom\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-left\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+vline+' '+vline+'-right\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-n\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-e\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-s\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-w\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-ne\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-se\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-sw\"/>',\n\t\t\t\t\t\t\t'<div class=\"'+rpoint+' '+rpoint+'-nw\"/>');\n\n\t\t\t\t\t\tpreview.append(basec.css('position', 'absolute').hide().append(imgc, rhandlec.append(coverc)));\n\t\t\t\t\t\t\n\t\t\t\t\t\tpreview.append(imgr.hide());\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tpreview.css('overflow', 'hidden');\n\t\t\t\t\t\n\t\t\t\t\tdialog.append(preview, control);\n\t\t\t\t\t\n\t\t\t\t\tbuttons[fm.i18n('btnApply')] = save;\n\t\t\t\t\tif (useSaveAs) {\n\t\t\t\t\t\tbuttons[fm.i18n('btnSaveAs')] = function() { requestAnimationFrame(saveAs); };\n\t\t\t\t\t}\n\t\t\t\t\tbuttons[fm.i18n('btnCancel')] = function() { dialog.elfinderdialog('close'); };\n\t\t\t\t\t\n\t\t\t\t\tdialog.find('input,button').addClass('elfinder-tabstop');\n\t\t\t\t\t\n\t\t\t\t\tbase = self.fmDialog(dialog, {\n\t\t\t\t\t\ttitle          : fm.escape(file.name),\n\t\t\t\t\t\twidth          : dialogWidth,\n\t\t\t\t\t\tresizable      : false,\n\t\t\t\t\t\tbuttons        : buttons,\n\t\t\t\t\t\topen           : function() {\n\t\t\t\t\t\t\tvar doDimReq = function(force) {\n\t\t\t\t\t\t\t\t\tdimreq = fm.request({\n\t\t\t\t\t\t\t\t\t\tdata : {cmd : 'dim', target : file.hash, substitute : substituteImg? 400 : ''},\n\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\tif (!data.url && needPng) {\n\t\t\t\t\t\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\t\t\t\t\t\tfm.error(['errOpen', file.name]);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tif (data.dim) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\n\t\t\t\t\t\t\t\t\t\t\t\tfile.width = dim[0];\n\t\t\t\t\t\t\t\t\t\t\t\tfile.height = dim[1];\n\t\t\t\t\t\t\t\t\t\t\t\tsetdim(dim);\n\t\t\t\t\t\t\t\t\t\t\t\tif (data.url) {\n\t\t\t\t\t\t\t\t\t\t\t\t\timg.attr('src', data.url);\n\t\t\t\t\t\t\t\t\t\t\t\t\timgc.attr('src', data.url);\n\t\t\t\t\t\t\t\t\t\t\t\t\timgr.attr('src', data.url);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\treturn init();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tneedPng = !{'image/jpeg':true,'image/png':true,'image/gif':true,}[file.mime],\n\t\t\t\t\t\t\t\tsubstituteImg = fm.option('substituteImg', file.hash) && (needPng || file.size > options.dimSubImgSize)? true : false,\n\t\t\t\t\t\t\t\thasSize = (file.width && file.height)? true : false;\n\t\t\t\t\t\t\tdMinBtn = base.find('.ui-dialog-titlebar .elfinder-titlebar-minimize').hide();\n\t\t\t\t\t\t\tfm.bind('resize', dinit);\n\t\t\t\t\t\t\timg.attr('src', src).one('error.dimreq', function() {\n\t\t\t\t\t\t\t\tdoDimReq(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\timgc.attr('src', src);\n\t\t\t\t\t\t\timgr.attr('src', src);\n\t\t\t\t\t\t\tif (api2) {\n\t\t\t\t\t\t\t\timgr.on('mousedown touchstart', rotate.start)\n\t\t\t\t\t\t\t\t\t.on('touchend', rotate.stop);\n\t\t\t\t\t\t\t\tbase.on('mouseup', rotate.stop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (hasSize && !substituteImg) {\n\t\t\t\t\t\t\t\treturn init();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (file.size > (options.getDimThreshold || 0)) {\n\t\t\t\t\t\t\t\timg.off('error.dimreq');\n\t\t\t\t\t\t\t\tdoDimReq();\n\t\t\t\t\t\t\t} else if (hasSize) {\n\t\t\t\t\t\t\t\treturn init();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tclose          : function() {\n\t\t\t\t\t\t\tif (api2) {\n\t\t\t\t\t\t\t\timgr.off('mousedown touchstart', rotate.start)\n\t\t\t\t\t\t\t\t\t.off('touchend', rotate.stop);\n\t\t\t\t\t\t\t\t$(document).off('mouseup', rotate.stop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.unbind('resize', dinit);\n\t\t\t\t\t\t\t$(this).elfinderdialog('destroy');\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresize         : function(e, data) {\n\t\t\t\t\t\t\tif (data && data.minimize === 'off') {\n\t\t\t\t\t\t\t\tdinit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).attr('id', id).closest('.ui-dialog').addClass(clsediting);\n\t\t\t\t\t\n\t\t\t\t\t// for IE < 9 dialog mising at open second+ time.\n\t\t\t\t\tif (fm.UA.ltIE8) {\n\t\t\t\t\t\t$('.elfinder-dialog').css('filter', '');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcoverc.css({ 'opacity': 0.2, 'background-color': '#fff', 'position': 'absolute'}),\n\t\t\t\t\trhandlec.css('cursor', 'move');\n\t\t\t\t\trhandlec.find('.elfinder-resize-handle-point').css({\n\t\t\t\t\t\t'background-color' : '#fff',\n\t\t\t\t\t\t'opacity': 0.5,\n\t\t\t\t\t\t'border-color':'#000'\n\t\t\t\t\t});\n\n\t\t\t\t\tif (! api2) {\n\t\t\t\t\t\tuitype.find('.api2').remove();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tcontrol.find('input,select').prop('disabled', true);\n\t\t\t\t\tcontrol.find('input.elfinder-resize-quality')\n\t\t\t\t\t\t.next('span').addClass('elfinder-resize-jpgsize').attr('title', fm.i18n('roughFileSize'));\n\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tid, dialog\n\t\t\t\t;\n\t\t\t\t\n\n\t\t\tif (!files.length || files[0].mime.indexOf('image/') === -1) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\tid = 'resize-'+fm.namespace+'-'+files[0].hash;\n\t\t\tdialog = fmnode.find('#'+id);\n\t\t\t\n\t\t\tif (dialog.length) {\n\t\t\t\tdialog.elfinderdialog('toTop');\n\t\t\t\treturn dfrd.resolve();\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tfm.openUrl(files[0].hash, 'sameorigin', function(src) {\n\t\t\t\topen(files[0], id, src);\n\t\t\t});\n\t\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\t(function ($) {\n\t\t\n\t\tvar findProperty = function (styleObject, styleArgs) {\n\t\t\tvar i = 0 ;\n\t\t\tfor( i in styleArgs) {\n\t\t        if (typeof styleObject[styleArgs[i]] != 'undefined') \n\t\t        \treturn styleArgs[i];\n\t\t\t}\n\t\t\tstyleObject[styleArgs[i]] = '';\n\t\t    return styleArgs[i];\n\t\t};\n\t\t\n\t\t$.cssHooks.rotate = {\n\t\t\tget: function(elem, computed, extra) {\n\t\t\t\treturn $(elem).rotate();\n\t\t\t},\n\t\t\tset: function(elem, value) {\n\t\t\t\t$(elem).rotate(value);\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\t$.cssHooks.transform = {\n\t\t\tget: function(elem, computed, extra) {\n\t\t\t\tvar name = findProperty( elem.style , \n\t\t\t\t\t['WebkitTransform', 'MozTransform', 'OTransform' , 'msTransform' , 'transform'] );\n\t\t\t\treturn elem.style[name];\n\t\t\t},\n\t\t\tset: function(elem, value) {\n\t\t\t\tvar name = findProperty( elem.style , \n\t\t\t\t\t['WebkitTransform', 'MozTransform', 'OTransform' , 'msTransform' , 'transform'] );\n\t\t\t\telem.style[name] = value;\n\t\t\t\treturn value;\n\t\t\t}\n\t\t};\n\t\t\n\t\t$.fn.rotate = function(val) {\n\t\t\tvar r;\n\t\t\tif (typeof val == 'undefined') {\n\t\t\t\tif (!!window.opera) {\n\t\t\t\t\tr = this.css('transform').match(/rotate\\((.*?)\\)/);\n\t\t\t\t\treturn  ( r && r[1])?\n\t\t\t\t\t\tMath.round(parseFloat(r[1]) * 180 / Math.PI) : 0;\n\t\t\t\t} else {\n\t\t\t\t\tr = this.css('transform').match(/rotate\\((.*?)\\)/);\n\t\t\t\t\treturn  ( r && r[1])? parseInt(r[1]) : 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.css('transform', \n\t\t\t\tthis.css('transform').replace(/none|rotate\\(.*?\\)/, '') + 'rotate(' + parseInt(val) + 'deg)');\n\t\t\treturn this;\n\t\t};\n\n\t\t$.fx.step.rotate  = function(fx) {\n\t\t\tif ( fx.state == 0 ) {\n\t\t\t\tfx.start = $(fx.elem).rotate();\n\t\t\t\tfx.now = fx.start;\n\t\t\t}\n\t\t\t$(fx.elem).rotate(fx.now);\n\t\t};\n\n\t\tif (typeof window.addEventListener == \"undefined\" && typeof document.getElementsByClassName == \"undefined\") { // IE & IE<9\n\t\t\tvar GetAbsoluteXY = function(element) {\n\t\t\t\tvar pnode = element;\n\t\t\t\tvar x = pnode.offsetLeft;\n\t\t\t\tvar y = pnode.offsetTop;\n\t\t\t\t\n\t\t\t\twhile ( pnode.offsetParent ) {\n\t\t\t\t\tpnode = pnode.offsetParent;\n\t\t\t\t\tif (pnode != document.body && pnode.currentStyle['position'] != 'static') {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (pnode != document.body && pnode != document.documentElement) {\n\t\t\t\t\t\tx -= pnode.scrollLeft;\n\t\t\t\t\t\ty -= pnode.scrollTop;\n\t\t\t\t\t}\n\t\t\t\t\tx += pnode.offsetLeft;\n\t\t\t\t\ty += pnode.offsetTop;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn { x: x, y: y };\n\t\t\t};\n\t\t\t\n\t\t\tvar StaticToAbsolute = function (element) {\n\t\t\t\tif ( element.currentStyle['position'] != 'static') {\n\t\t\t\t\treturn ;\n\t\t\t\t}\n\n\t\t\t\tvar xy = GetAbsoluteXY(element);\n\t\t\t\telement.style.position = 'absolute' ;\n\t\t\t\telement.style.left = xy.x + 'px';\n\t\t\t\telement.style.top = xy.y + 'px';\n\t\t\t};\n\n\t\t\tvar IETransform = function(element,transform){\n\n\t\t\t\tvar r;\n\t\t\t\tvar m11 = 1;\n\t\t\t\tvar m12 = 1;\n\t\t\t\tvar m21 = 1;\n\t\t\t\tvar m22 = 1;\n\n\t\t\t\tif (typeof element.style['msTransform'] != 'undefined'){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tStaticToAbsolute(element);\n\n\t\t\t\tr = transform.match(/rotate\\((.*?)\\)/);\n\t\t\t\tvar rotate =  ( r && r[1])\t?\tparseInt(r[1])\t:\t0;\n\n\t\t\t\trotate = rotate % 360;\n\t\t\t\tif (rotate < 0) rotate = 360 + rotate;\n\n\t\t\t\tvar radian= rotate * Math.PI / 180;\n\t\t\t\tvar cosX =Math.cos(radian);\n\t\t\t\tvar sinY =Math.sin(radian);\n\n\t\t\t\tm11 *= cosX;\n\t\t\t\tm12 *= -sinY;\n\t\t\t\tm21 *= sinY;\n\t\t\t\tm22 *= cosX;\n\n\t\t\t\telement.style.filter =  (element.style.filter || '').replace(/progid:DXImageTransform\\.Microsoft\\.Matrix\\([^)]*\\)/, \"\" ) +\n\t\t\t\t\t(\"progid:DXImageTransform.Microsoft.Matrix(\" + \n\t\t\t\t\t\t \"M11=\" + m11 + \n\t\t\t\t\t\t\",M12=\" + m12 + \n\t\t\t\t\t\t\",M21=\" + m21 + \n\t\t\t\t\t\t\",M22=\" + m22 + \n\t\t\t\t\t\t\",FilterType='bilinear',sizingMethod='auto expand')\") \n\t\t\t\t\t;\n\n\t\t  \t\tvar ow = parseInt(element.style.width || element.width || 0 );\n\t\t  \t\tvar oh = parseInt(element.style.height || element.height || 0 );\n\n\t\t\t\tradian = rotate * Math.PI / 180;\n\t\t\t\tvar absCosX =Math.abs(Math.cos(radian));\n\t\t\t\tvar absSinY =Math.abs(Math.sin(radian));\n\n\t\t\t\tvar dx = (ow - (ow * absCosX + oh * absSinY)) / 2;\n\t\t\t\tvar dy = (oh - (ow * absSinY + oh * absCosX)) / 2;\n\n\t\t\t\telement.style.marginLeft = Math.floor(dx) + \"px\";\n\t\t\t\telement.style.marginTop  = Math.floor(dy) + \"px\";\n\n\t\t\t\treturn(true);\n\t\t\t};\n\t\t\t\n\t\t\tvar transform_set = $.cssHooks.transform.set;\n\t\t\t$.cssHooks.transform.set = function(elem, value) {\n\t\t\t\ttransform_set.apply(this, [elem, value] );\n\t\t\t\tIETransform(elem,value);\n\t\t\t\treturn value;\n\t\t\t};\n\t\t}\n\n\t})(jQuery);\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/restore',[\n\t\"../elFinder\"\n],function(elFinder){\n\t\t/**\n\t\t * @class  elFinder command \"restore\"\n\t\t * Restore items from the trash\n\t\t *\n\t\t * @author Naoki Sawada\n\t\t **/\n\t\t(elFinder.prototype.commands.restore = function() {\n\t\t\t\"use strict\";\n\t\t\tvar self = this,\n\t\t\t\tfm = this.fm,\n\t\t\t\tfakeCnt = 0,\n\t\t\t\tgetFilesRecursively = function(files) {\n\t\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\t\tdirs = [],\n\t\t\t\t\t\tresults = [],\n\t\t\t\t\t\treqs = [],\n\t\t\t\t\t\tphashes = [],\n\t\t\t\t\t\tgetFile;\n\t\t\t\t\t\n\t\t\t\t\tdfd._xhrReject = function() {\n\t\t\t\t\t\t$.each(reqs, function() {\n\t\t\t\t\t\t\tthis && this.reject && this.reject();\n\t\t\t\t\t\t});\n\t\t\t\t\t\tgetFile && getFile._xhrReject();\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\tf.mime === 'directory'? dirs.push(f) : results.push(f);\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (dirs.length) {\n\t\t\t\t\t\t$.each(dirs, function(i, d) {\n\t\t\t\t\t\t\treqs.push(fm.request({\n\t\t\t\t\t\t\t\tdata : {cmd  : 'open', target : d.hash},\n\t\t\t\t\t\t\t\tpreventDefault : true,\n\t\t\t\t\t\t\t\tasNotOpen : true\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\tphashes[i] = d.hash;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$.when.apply($, reqs).fail(function() {\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t}).done(function() {\n\t\t\t\t\t\t\tvar items = [];\n\t\t\t\t\t\t\t$.each(arguments, function(i, r) {\n\t\t\t\t\t\t\t\tvar files;\n\t\t\t\t\t\t\t\tif (r.files) {\n\t\t\t\t\t\t\t\t\tif (r.files.length) {\n\t\t\t\t\t\t\t\t\t\titems = items.concat(r.files);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\t\t\t\t\thash: 'fakefile_' + (fakeCnt++),\n\t\t\t\t\t\t\t\t\t\t\tphash: phashes[i],\n\t\t\t\t\t\t\t\t\t\t\tmime: 'fakefile',\n\t\t\t\t\t\t\t\t\t\t\tname: 'fakefile',\n\t\t\t\t\t\t\t\t\t\t\tts: 0\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.cache(items);\n\t\t\t\t\t\t\tgetFile = getFilesRecursively(items).done(function(res) {\n\t\t\t\t\t\t\t\tresults = results.concat(res);\n\t\t\t\t\t\t\t\tdfd.resolve(results);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfd.resolve(results);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn dfd;\n\t\t\t\t},\n\t\t\t\trestore = function(dfrd, files, targets, ops) {\n\t\t\t\t\tvar rHashes = {},\n\t\t\t\t\t\tothers = [],\n\t\t\t\t\t\tfound = false,\n\t\t\t\t\t\tdirs = [],\n\t\t\t\t\t\topts = ops || {},\n\t\t\t\t\t\tid = +new Date(),\n\t\t\t\t\t\ttm, getFile;\n\t\t\t\t\t\n\t\t\t\t\tfm.lockfiles({files : targets});\n\t\t\t\t\t\n\t\t\t\t\tdirs = $.map(files, function(f) {\n\t\t\t\t\t\treturn f.mime === 'directory'? f.hash : null;\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tdfrd.done(function() {\n\t\t\t\t\t\tdirs && fm.exec('rm', dirs, {forceRm : true, quiet : true});\n\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\tfm.notify({type : 'search', id : id, cnt : 1, hideCnt : true, cancel : function() {\n\t\t\t\t\t\t\tgetFile && getFile._xhrReject();\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}});\n\t\t\t\t\t}, fm.notifyDelay);\n\n\t\t\t\t\tfakeCnt = 0;\n\t\t\t\t\tgetFile = getFilesRecursively(files).always(function() {\n\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\tfm.notify({type : 'search', id: id, cnt : -1, hideCnt : true});\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfrd.reject('errRestore', 'errFileNotFound');\n\t\t\t\t\t}).done(function(res) {\n\t\t\t\t\t\tvar errFolderNotfound = ['errRestore', 'errFolderNotFound'],\n\t\t\t\t\t\t\tdirTop = '';\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (res.length) {\n\t\t\t\t\t\t\t$.each(res, function(i, f) {\n\t\t\t\t\t\t\t\tvar phash = f.phash,\n\t\t\t\t\t\t\t\t\tpfile,\n\t\t\t\t\t\t\t\t\tsrcRoot, tPath;\n\t\t\t\t\t\t\t\twhile(phash) {\n\t\t\t\t\t\t\t\t\tif (srcRoot = fm.trashes[phash]) {\n\t\t\t\t\t\t\t\t\t\tif (! rHashes[srcRoot]) {\n\t\t\t\t\t\t\t\t\t\t\tif (found) {\n\t\t\t\t\t\t\t\t\t\t\t\t// Keep items of other trash\n\t\t\t\t\t\t\t\t\t\t\t\tothers.push(f.hash);\n\t\t\t\t\t\t\t\t\t\t\t\treturn null; // continue $.each\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\trHashes[srcRoot] = {};\n\t\t\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t\ttPath = fm.path(f.hash).substr(fm.path(phash).length).replace(/\\\\/g, '/');\n\t\t\t\t\t\t\t\t\t\ttPath = tPath.replace(/\\/[^\\/]+?$/, '');\n\t\t\t\t\t\t\t\t\t\tif (tPath === '') {\n\t\t\t\t\t\t\t\t\t\t\ttPath = '/';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!rHashes[srcRoot][tPath]) {\n\t\t\t\t\t\t\t\t\t\t\trHashes[srcRoot][tPath] = [];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (f.mime === 'fakefile') {\n\t\t\t\t\t\t\t\t\t\t\tfm.updateCache({removed:[f.hash]});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\trHashes[srcRoot][tPath].push(f.hash);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!dirTop || dirTop.length > tPath.length) {\n\t\t\t\t\t\t\t\t\t\t\tdirTop = tPath;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Go up one level for next check\n\t\t\t\t\t\t\t\t\tpfile = fm.file(phash);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (!pfile) {\n\t\t\t\t\t\t\t\t\t\tphash = false;\n\t\t\t\t\t\t\t\t\t\t// Detection method for search results\n\t\t\t\t\t\t\t\t\t\t$.each(fm.trashes, function(ph) {\n\t\t\t\t\t\t\t\t\t\t\tvar file = fm.file(ph),\n\t\t\t\t\t\t\t\t\t\t\t\tfilePath = fm.path(ph);\n\t\t\t\t\t\t\t\t\t\t\tif ((!file.volumeid || f.hash.indexOf(file.volumeid) === 0) && fm.path(f.hash).indexOf(filePath) === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tphash = ph;\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tphash = pfile.phash;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (found) {\n\t\t\t\t\t\t\t\t$.each(rHashes, function(src, dsts) {\n\t\t\t\t\t\t\t\t\tvar dirs = Object.keys(dsts),\n\t\t\t\t\t\t\t\t\t\tcnt = dirs.length;\n\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\tdata   : {cmd  : 'mkdir', target : src, dirs : dirs}, \n\t\t\t\t\t\t\t\t\t\tnotify : {type : 'chkdir', cnt : cnt},\n\t\t\t\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\t\t\tvar cmdPaste, hashes;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif (hashes = data.hashes) {\n\t\t\t\t\t\t\t\t\t\t\tcmdPaste = fm.getCommand('paste');\n\t\t\t\t\t\t\t\t\t\t\tif (cmdPaste) {\n\t\t\t\t\t\t\t\t\t\t\t\t// wait until file cache made\n\t\t\t\t\t\t\t\t\t\t\t\tfm.one('mkdirdone', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar hasErr = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.each(dsts, function(dir, files) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (hashes[dir]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (files.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (fm.file(hashes[dir])) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.clipboard(files, true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('paste', [ hashes[dir] ], {_cmd : 'restore', noToast : (opts.noToast || dir !== dirTop)})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data && (data.error || data.warning)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thasErr = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thasErr = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (--cnt < 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd[hasErr? 'reject' : 'resolve']();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (others.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Restore items of other trash\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('restore', others);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(errFolderNotfound);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (--cnt < 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (others.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Restore items of other trash\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('restore', others);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(['errRestore', 'errCmdNoSupport', '(paste)']);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(errFolderNotfound);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.reject(errFolderNotfound);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfrd.reject('errFileNotFound');\n\t\t\t\t\t\t\tdirs && fm.exec('rm', dirs, {forceRm : true, quiet : true});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\n\t\t\t// for to be able to overwrite\n\t\t\tthis.restore = restore;\n\n\t\t\tthis.linkedCmds = ['copy', 'paste', 'mkdir', 'rm'];\n\t\t\tthis.updateOnSelect = false;\n\t\t\t\n\t\t\tthis.init = function() {\n\t\t\t\t// re-assign for extended command\n\t\t\t\tself = this;\n\t\t\t\tfm = this.fm;\n\t\t\t};\n\n\t\t\tthis.getstate = function(sel, e) {\n\t\t\t\tsel = sel || fm.selected();\n\t\t\t\treturn sel.length && $.grep(sel, function(h) {var f = fm.file(h); return f && ! f.locked && ! fm.isRoot(f)? true : false; }).length == sel.length\n\t\t\t\t\t? 0 : -1;\n\t\t\t};\n\t\t\t\n\t\t\tthis.exec = function(hashes, opts) {\n\t\t\t\tvar dfrd   = $.Deferred()\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t}),\n\t\t\t\t\tfiles  = self.files(hashes);\n\n\t\t\t\tif (! files.length) {\n\t\t\t\t\treturn dfrd.reject();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(files, function(i, file) {\n\t\t\t\t\tif (fm.isRoot(file)) {\n\t\t\t\t\t\treturn !dfrd.reject(['errRestore', file.name]);\n\t\t\t\t\t}\n\t\t\t\t\tif (file.locked) {\n\t\t\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (dfrd.state() === 'pending') {\n\t\t\t\t\tthis.restore(dfrd, files, hashes, opts);\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\treturn dfrd;\n\t\t\t};\n\n\t\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/rm',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"rm\"\n\t * Delete files\n\t *\n\t * @author Dmitry (dio) Levashov\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.rm = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\ttpl = '<div class=\"ui-helper-clearfix elfinder-rm-title\"><span class=\"elfinder-cwd-icon {class} ui-corner-all\"/>{title}<div class=\"elfinder-rm-desc\">{desc}</div></div>',\n\t\t\tconfirm = function(dfrd, targets, files, tHash, addTexts) {\n\t\t\t\tvar cnt = targets.length,\n\t\t\t\t\tcwd = fm.cwd().hash,\n\t\t\t\t\tdescs = [],\n\t\t\t\t\tspinner = fm.i18n('calc') + '<span class=\"elfinder-spinner\"/>',\n\t\t\t\t\tdialog, text, tmb, size, f, fname;\n\t\t\t\t\n\t\t\t\tif (cnt > 1) {\n\t\t\t\t\tsize = 0;\n\t\t\t\t\t$.each(files, function(h, f) { \n\t\t\t\t\t\tif (f.size && f.size != 'unknown' && f.mime !== 'directory') {\n\t\t\t\t\t\t\tvar s = parseInt(f.size);\n\t\t\t\t\t\t\tif (s >= 0 && size >= 0) {\n\t\t\t\t\t\t\t\tsize += s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsize = 'unknown';\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tgetSize = (size === 'unknown');\n\t\t\t\t\tdescs.push(fm.i18n('size')+': '+(getSize? spinner : fm.formatSize(size)));\n\t\t\t\t\ttext = [$(tpl.replace('{class}', 'elfinder-cwd-icon-group').replace('{title}', '<strong>' + fm.i18n('items')+ ': ' + cnt + '</strong>').replace('{desc}', descs.join('<br>')))];\n\t\t\t\t} else {\n\t\t\t\t\tf = files[0];\n\t\t\t\t\ttmb = fm.tmb(f);\n\t\t\t\t\tgetSize = (f.mime === 'directory');\n\t\t\t\t\tdescs.push(fm.i18n('size')+': '+(getSize? spinner : fm.formatSize(f.size)));\n\t\t\t\t\tdescs.push(fm.i18n('modify')+': '+fm.formatDate(f));\n\t\t\t\t\tfname = fm.escape(f.i18 || f.name).replace(/([_.])/g, '&#8203;$1');\n\t\t\t\t\ttext = [$(tpl.replace('{class}', fm.mime2class(f.mime)).replace('{title}', '<strong>' + fname + '</strong>').replace('{desc}', descs.join('<br>')))];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (addTexts) {\n\t\t\t\t\ttext = text.concat(addTexts);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ttext.push(tHash? 'confirmTrash' : 'confirmRm');\n\t\t\t\t\n\t\t\t\tdialog = fm.confirm({\n\t\t\t\t\ttitle  : self.title,\n\t\t\t\t\ttext   : text,\n\t\t\t\t\taccept : {\n\t\t\t\t\t\tlabel    : 'btnRm',\n\t\t\t\t\t\tcallback : function() {  \n\t\t\t\t\t\t\tif (tHash) {\n\t\t\t\t\t\t\t\tself.toTrash(dfrd, targets, tHash);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tremove(dfrd, targets);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcancel : {\n\t\t\t\t\t\tlabel    : 'btnCancel',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\tif (targets.length === 1 && fm.file(targets[0]).phash !== cwd) {\n\t\t\t\t\t\t\t\tfm.select({selected : targets});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfm.selectfiles({files : targets});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// load thumbnail\n\t\t\t\tif (tmb) {\n\t\t\t\t\t$('<img/>')\n\t\t\t\t\t\t.on('load', function() { dialog.find('.elfinder-cwd-icon').addClass(tmb.className).css('background-image', \"url('\"+tmb.url+\"')\"); })\n\t\t\t\t\t\t.attr('src', tmb.url);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (getSize) {\n\t\t\t\t\tgetSize = fm.getSize($.map(files, function(f) { return f.mime === 'directory'? f.hash : null; })).done(function(data) {\n\t\t\t\t\t\tdialog.find('span.elfinder-spinner').parent().html(fm.i18n('size')+': '+data.formated);\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdialog.find('span.elfinder-spinner').parent().html(fm.i18n('size')+': '+fm.i18n('unknown'));\n\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\tgetSize = false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ttoTrash = function(dfrd, targets, tHash) {\n\t\t\t\tvar dsts = {},\n\t\t\t\t\titemCnt = targets.length,\n\t\t\t\t\tmaxCnt = self.options.toTrashMaxItems,\n\t\t\t\t\tcheckDirs = [],\n\t\t\t\t\treqDfd = $.Deferred(),\n\t\t\t\t\treq, dirs, cnt;\n\t\t\t\t\n\t\t\t\tif (itemCnt > maxCnt) {\n\t\t\t\t\tself.confirm(dfrd, targets, self.files(targets), null, [fm.i18n('tooManyToTrash')]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Directory preparation preparation and directory enumeration\n\t\t\t\t$.each(targets, function(i, h) {\n\t\t\t\t\tvar file = fm.file(h),\n\t\t\t\t\t\tpath = fm.path(h).replace(/\\\\/g, '/'),\n\t\t\t\t\t\tm = path.match(/^[^\\/]+?(\\/(?:[^\\/]+?\\/)*)[^\\/]+?$/);\n\t\t\t\t\t\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tif (m) {\n\t\t\t\t\t\t\tm[1] = m[1].replace(/(^\\/.*?)\\/?$/, '$1');\n\t\t\t\t\t\t\tif (! dsts[m[1]]) {\n\t\t\t\t\t\t\t\tdsts[m[1]] = [];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdsts[m[1]].push(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (file.mime === 'directory') {\n\t\t\t\t\t\t\tcheckDirs.push(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Check directory information\n\t\t\t\tif (checkDirs.length) {\n\t\t\t\t\treq = fm.request({\n\t\t\t\t\t\tdata : {cmd : 'size', targets : checkDirs},\n\t\t\t\t\t\tnotify : {type: 'readdir', cnt: 1, hideCnt: true},\n\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\tvar cnt = 0;\n\t\t\t\t\t\tdata.fileCnt && (cnt += parseInt(data.fileCnt));\n\t\t\t\t\t\tdata.dirCnt && (cnt += parseInt(data.dirCnt));\n\t\t\t\t\t\treqDfd[cnt > maxCnt ? 'reject' : 'resolve']();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\treqDfd.reject();\n\t\t\t\t\t});\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tvar xhr = (req && req.xhr)? req.xhr : null;\n\t\t\t\t\t\tif (xhr && xhr.state() == 'pending') {\n\t\t\t\t\t\t\treq.syncOnFail(false);\n\t\t\t\t\t\t\treq.reject();\n\t\t\t\t\t\t\treqDfd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, self.options.infoCheckWait * 1000);\n\t\t\t\t} else {\n\t\t\t\t\treqDfd.resolve();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Directory creation and paste command execution\n\t\t\t\treqDfd.done(function() {\n\t\t\t\t\tdirs = Object.keys(dsts);\n\t\t\t\t\tcnt = dirs.length;\n\t\t\t\t\tif (cnt) {\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata   : {cmd  : 'mkdir', target : tHash, dirs : dirs}, \n\t\t\t\t\t\t\tnotify : {type : 'chkdir', cnt : cnt},\n\t\t\t\t\t\t\tpreventFail : true\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar margeRes = function(data, phash, reqData) {\n\t\t\t\t\t\t\t\t\tvar undo, prevUndo, redo, prevRedo;\n\t\t\t\t\t\t\t\t\t$.each(data, function(k, v) {\n\t\t\t\t\t\t\t\t\t\tif (Array.isArray(v)) {\n\t\t\t\t\t\t\t\t\t\t\tif (res[k]) {\n\t\t\t\t\t\t\t\t\t\t\t\tres[k] = res[k].concat(v);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tres[k] = v;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tif (data.sync) {\n\t\t\t\t\t\t\t\t\t\tres.sync = 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tundo = function() {\n\t\t\t\t\t\t\t\t\t\t\tvar targets = [],\n\t\t\t\t\t\t\t\t\t\t\t\tdirs    = $.map(data.added, function(f) { return f.mime === 'directory'? f.hash : null; });\n\t\t\t\t\t\t\t\t\t\t\t$.each(data.added, function(i, f) {\n\t\t\t\t\t\t\t\t\t\t\t\tif ($.inArray(f.phash, dirs) === -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttargets.push(f.hash);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\treturn fm.exec('restore', targets, {noToast: true});\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tredo = function() {\n\t\t\t\t\t\t\t\t\t\t\treturn fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata   : reqData,\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'redo', cnt : targets.length}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tif (res.undo) {\n\t\t\t\t\t\t\t\t\t\t\tprevUndo = res.undo;\n\t\t\t\t\t\t\t\t\t\t\tres.undo = function() {\n\t\t\t\t\t\t\t\t\t\t\t\tundo();\n\t\t\t\t\t\t\t\t\t\t\t\tprevUndo();\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tres.undo = undo;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (res.redo) {\n\t\t\t\t\t\t\t\t\t\t\tprevRedo = res.redo;\n\t\t\t\t\t\t\t\t\t\t\tres.redo = function() {\n\t\t\t\t\t\t\t\t\t\t\t\tredo();\n\t\t\t\t\t\t\t\t\t\t\t\tprevRedo();\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tres.redo = redo;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terr = ['errTrash'],\n\t\t\t\t\t\t\t\tres = {},\n\t\t\t\t\t\t\t\thasNtf = function() {\n\t\t\t\t\t\t\t\t\treturn fm.ui.notify.children('.elfinder-notify-trash').length;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\thashes, tm, prg, prgSt;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (hashes = data.hashes) {\n\t\t\t\t\t\t\t\tprg = 1 / cnt * 100;\n\t\t\t\t\t\t\t\tprgSt = cnt === 1? 100 : 5;\n\t\t\t\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\t\t\t\tfm.notify({type : 'trash', cnt : 1, hideCnt : true, progress : prgSt});\n\t\t\t\t\t\t\t\t}, fm.notifyDelay);\n\t\t\t\t\t\t\t\t$.each(dsts, function(dir, files) {\n\t\t\t\t\t\t\t\t\tvar phash = fm.file(files[0]).phash,\n\t\t\t\t\t\t\t\t\t\treqData;\n\t\t\t\t\t\t\t\t\tif (hashes[dir]) {\n\t\t\t\t\t\t\t\t\t\treqData = {cmd : 'paste', dst : hashes[dir], targets : files, cut : 1};\n\t\t\t\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\t\t\t\tdata : reqData,\n\t\t\t\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\t\terr = err.concat(error);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\t\t\t\tdata = fm.normalize(data);\n\t\t\t\t\t\t\t\t\t\t\tfm.updateCache(data);\n\t\t\t\t\t\t\t\t\t\t\tmargeRes(data, phash, reqData);\n\t\t\t\t\t\t\t\t\t\t\tif (data.warning) {\n\t\t\t\t\t\t\t\t\t\t\t\terr = err.concat(data.warning);\n\t\t\t\t\t\t\t\t\t\t\t\tdelete data.warning;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t// fire some event to update cache/ui\n\t\t\t\t\t\t\t\t\t\t\tdata.removed && data.removed.length && fm.remove(data);\n\t\t\t\t\t\t\t\t\t\t\tdata.added   && data.added.length   && fm.add(data);\n\t\t\t\t\t\t\t\t\t\t\tdata.changed && data.changed.length && fm.change(data);\n\t\t\t\t\t\t\t\t\t\t\t// fire event with command name\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('paste', data);\n\t\t\t\t\t\t\t\t\t\t\t// fire event with command name + 'done'\n\t\t\t\t\t\t\t\t\t\t\tfm.trigger('pastedone');\n\t\t\t\t\t\t\t\t\t\t\t// force update content\n\t\t\t\t\t\t\t\t\t\t\tdata.sync && fm.sync();\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\t\t\t\tvar hashes = [], addTexts, end = 2;\n\t\t\t\t\t\t\t\t\t\t\tif (hasNtf()) {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.notify({type : 'trash', cnt : 0, hideCnt : true, progress : prg});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tprgSt+= prg;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif (--cnt < 1) {\n\t\t\t\t\t\t\t\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\t\t\t\t\t\t\t\thasNtf() && fm.notify({type : 'trash', cnt  : -1});\n\t\t\t\t\t\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\t\t\t\t\t\tif (Object.keys(res).length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (err.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.removed || res.removed.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thashes = $.grep(targets, function(h) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn $.inArray(h, res.removed) === -1? true : false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (hashes.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (err.length > end) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend = (fm.messages[err[end-1]] || '').indexOf('$') === -1? end : end + 1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('rm', hashes, { addTexts: err.slice(0, end), forceRm: true });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.error(err);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tres._noSound = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.undo && res.redo) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tres.undo = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd : 'trash',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcallback : res.undo,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tres.redo = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcmd : 'trash',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcallback : res.redo\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.resolve(res);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdfrd.reject(err);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdfrd.reject('errFolderNotFound');\n\t\t\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdfrd.reject(['error', 'The folder hierarchy to be deleting can not be determined.']);\n\t\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t\t}\n\t\t\t\t}).fail(function() {\n\t\t\t\t\tself.confirm(dfrd, targets, self.files(targets), null, [fm.i18n('tooManyToTrash')]);\n\t\t\t\t});\n\t\t\t},\n\t\t\tremove = function(dfrd, targets, quiet) {\n\t\t\t\tvar notify = quiet? {} : {type : 'rm', cnt : targets.length};\n\t\t\t\tfm.request({\n\t\t\t\t\tdata   : {cmd  : 'rm', targets : targets}, \n\t\t\t\t\tnotify : notify,\n\t\t\t\t\tpreventFail : true\n\t\t\t\t})\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\tif (data.error || data.warning) {\n\t\t\t\t\t\tdata.sync = true;\n\t\t\t\t\t}\n\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t})\n\t\t\t\t.always(function() {\n\t\t\t\t\tfm.unlockfiles({files : targets});\n\t\t\t\t});\n\t\t\t},\n\t\t\tgetTHash = function(targets) {\n\t\t\t\tvar thash = null,\n\t\t\t\t\troot1st;\n\t\t\t\t\n\t\t\t\tif (targets && targets.length) {\n\t\t\t\t\tif (targets.length > 1 && fm.searchStatus.state === 2) {\n\t\t\t\t\t\troot1st = fm.file(fm.root(targets[0])).volumeid;\n\t\t\t\t\t\tif (!$.grep(targets, function(h) { return h.indexOf(root1st) !== 0? true : false ; }).length) {\n\t\t\t\t\t\t\tthash = fm.option('trashHash', targets[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthash = fm.option('trashHash', targets[0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn thash;\n\t\t\t},\n\t\t\tgetSize = false;\n\t\t\n\t\t// for to be able to overwrite\n\t\tthis.confirm = confirm;\n\t\tthis.toTrash = toTrash;\n\t\tthis.remove = remove;\n\n\t\tthis.syncTitleOnChange = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'delete ctrl+backspace shift+delete'\n\t\t}];\n\t\tthis.value = 'rm';\n\t\t\n\t\tthis.init = function() {\n\t\t\t// re-assign for extended command\n\t\t\tself = this;\n\t\t\tfm = this.fm;\n\t\t\t// bind function of change\n\t\t\tself.change(function() {\n\t\t\t\tvar targets;\n\t\t\t\tdelete self.extra;\n\t\t\t\tself.title = fm.i18n('cmd' + self.value);\n\t\t\t\tself.className = self.value;\n\t\t\t\tself.button && self.button.children('span.elfinder-button-icon')[self.value === 'trash'? 'addClass' : 'removeClass']('elfinder-button-icon-trash');\n\t\t\t\tif (self.value === 'trash') {\n\t\t\t\t\tself.extra = {\n\t\t\t\t\t\ticon: 'rm',\n\t\t\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t\t\t.attr({title: fm.i18n('cmdrm')})\n\t\t\t\t\t\t\t.on('ready', function(e, data) {\n\t\t\t\t\t\t\t\t//targets = data.targets; // modified by lwf\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tfm.getUI().trigger('click'); // to close the context menu immediately\n\t\t\t\t\t\t\t\tfm.exec('rm', targets, {_userAction: true, forceRm : true});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\n\t\tthis.getstate = function(select) {\n\t\t\tvar sel   = this.hashes(select);\n\t\t\t\n\t\t\treturn sel.length && $.grep(sel, function(h) { var f = fm.file(h); return f && ! f.locked && ! fm.isRoot(f)? true : false; }).length == sel.length\n\t\t\t\t? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpts) {\n\t\t\tvar opts   = cOpts || {},\n\t\t\t\tdfrd   = $.Deferred()\n\t\t\t\t\t.always(function() {\n\t\t\t\t\t\tif (getSize && getSize.state && getSize.state() === 'pending') {\n\t\t\t\t\t\t\tgetSize.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t!opts.quiet && !data._noSound && data.removed && data.removed.length && fm.trigger('playsound', {soundFile : 'rm.wav'});\n\t\t\t\t\t}),\n\t\t\t\tfiles  = self.files(hashes),\n\t\t\t\tcnt    = files.length,\n\t\t\t\ttHash  = null,\n\t\t\t\taddTexts = opts.addTexts? opts.addTexts : null,\n\t\t\t\tforceRm = opts.forceRm,\n\t\t\t\tquiet = opts.quiet,\n\t\t\t\ttargets;\n\n\t\t\tif (! cnt) {\n\t\t\t\treturn dfrd.reject();\n\t\t\t}\n\t\t\t\n\t\t\t$.each(files, function(i, file) {\n\t\t\t\tif (fm.isRoot(file)) {\n\t\t\t\t\treturn !dfrd.reject(['errRm', file.name, 'errPerm']);\n\t\t\t\t}\n\t\t\t\tif (file.locked) {\n\t\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (dfrd.state() === 'pending') {\n\t\t\t\ttargets = self.hashes(hashes);\n\t\t\t\tcnt     = files.length;\n\t\t\t\t\n\t\t\t\tif (forceRm || (self.event && self.event.originalEvent && self.event.originalEvent.shiftKey)) {\n\t\t\t\t\ttHash = '';\n\t\t\t\t\tself.title = fm.i18n('cmdrm');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (tHash === null) {\n\t\t\t\t\ttHash = getTHash(targets);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.lockfiles({files : targets});\n\t\t\t\t\n\t\t\t\tif (tHash && self.options.quickTrash) {\n\t\t\t\t\tself.toTrash(dfrd, targets, tHash);\n\t\t\t\t} else {\n\t\t\t\t\tif (quiet) {\n\t\t\t\t\t\tremove(dfrd, targets, quiet);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.confirm(dfrd, targets, files, tHash, addTexts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t\tfm.bind('select contextmenucreate closecontextmenu', function(e) {\n\t\t\tvar targets = (e.data? (e.data.selected || e.data.targets) : null) || fm.selected();\n\t\t\tif (targets && targets.length) {\n\t\t\t\tself.update(void(0), (targets? getTHash(targets) : fm.option('trashHash'))? 'trash' : 'rm');\n\t\t\t}\n\t\t});\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/search',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"search\"\n\t * Find files\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.search = function() {\n\t\t\"use strict\";\n\t\tthis.title          = 'Find files';\n\t\tthis.options        = {ui : 'searchbutton'};\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\t/**\n\t\t * Return command status.\n\t\t * Search does not support old api.\n\t\t *\n\t\t * @return Number\n\t\t **/\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Send search request to backend.\n\t\t *\n\t\t * @param  String  search string\n\t\t * @return $.Deferred\n\t\t **/\n\t\tthis.exec = function(q, target, mime, type) {\n\t\t\tvar fm = this.fm,\n\t\t\t\treqDef = [],\n\t\t\t\tsType = type || '',\n\t\t\t\tonlyMimes = fm.options.onlyMimes,\n\t\t\t\tphash, targetVolids = [],\n\t\t\t\tsetType = function(data) {\n\t\t\t\t\tif (sType && sType !== 'SearchName' && sType !== 'SearchMime') {\n\t\t\t\t\t\tdata.type = sType;\n\t\t\t\t\t}\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\trootCnt;\n\t\t\t\n\t\t\tif (typeof q == 'string' && q) {\n\t\t\t\tif (typeof target == 'object') {\n\t\t\t\t\tmime = target.mime || '';\n\t\t\t\t\ttarget = target.target || '';\n\t\t\t\t}\n\t\t\t\ttarget = target? target : '';\n\t\t\t\tif (mime) {\n\t\t\t\t\tmime = $.trim(mime).replace(',', ' ').split(' ');\n\t\t\t\t\tif (onlyMimes.length) {\n\t\t\t\t\t\tmime = $.map(mime, function(m){ \n\t\t\t\t\t\t\tm = $.trim(m);\n\t\t\t\t\t\t\treturn m && ($.inArray(m, onlyMimes) !== -1\n\t\t\t\t\t\t\t\t\t\t|| $.grep(onlyMimes, function(om) { return m.indexOf(om) === 0? true : false; }).length\n\t\t\t\t\t\t\t\t\t\t)? m : null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmime = [].concat(onlyMimes);\n\t\t\t\t}\n\n\t\t\t\tfm.trigger('searchstart', setType({query : q, target : target, mimes : mime}));\n\t\t\t\t\n\t\t\t\tif (! onlyMimes.length || mime.length) {\n\t\t\t\t\tif (target === '' && fm.api >= 2.1) {\n\t\t\t\t\t\trootCnt = Object.keys(fm.roots).length;\n\t\t\t\t\t\t$.each(fm.roots, function(id, hash) {\n\t\t\t\t\t\t\treqDef.push(fm.request({\n\t\t\t\t\t\t\t\tdata   : setType({cmd : 'search', q : q, target : hash, mimes : mime}),\n\t\t\t\t\t\t\t\tnotify : {type : 'search', cnt : 1, hideCnt : (rootCnt > 1? false : true)},\n\t\t\t\t\t\t\t\tcancel : true,\n\t\t\t\t\t\t\t\tpreventDone : true\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treqDef.push(fm.request({\n\t\t\t\t\t\t\tdata   : setType({cmd : 'search', q : q, target : target, mimes : mime}),\n\t\t\t\t\t\t\tnotify : {type : 'search', cnt : 1, hideCnt : true},\n\t\t\t\t\t\t\tcancel : true,\n\t\t\t\t\t\t\tpreventDone : true\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tif (target !== '' && fm.api >= 2.1 && Object.keys(fm.leafRoots).length) {\n\t\t\t\t\t\t\t$.each(fm.leafRoots, function(hash, roots) {\n\t\t\t\t\t\t\t\tphash = hash;\n\t\t\t\t\t\t\t\twhile(phash) {\n\t\t\t\t\t\t\t\t\tif (target === phash) {\n\t\t\t\t\t\t\t\t\t\t$.each(roots, function() {\n\t\t\t\t\t\t\t\t\t\t\tvar f = fm.file(this);\n\t\t\t\t\t\t\t\t\t\t\tf && f.volumeid && targetVolids.push(f.volumeid);\n\t\t\t\t\t\t\t\t\t\t\treqDef.push(fm.request({\n\t\t\t\t\t\t\t\t\t\t\t\tdata   : setType({cmd : 'search', q : q, target : this, mimes : mime}),\n\t\t\t\t\t\t\t\t\t\t\t\tnotify : {type : 'search', cnt : 1, hideCnt : false},\n\t\t\t\t\t\t\t\t\t\t\t\tcancel : true,\n\t\t\t\t\t\t\t\t\t\t\t\tpreventDone : true\n\t\t\t\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tphash = (fm.file(phash) || {}).phash;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treqDef = [$.Deferred().resolve({files: []})];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfm.searchStatus.mixed = (reqDef.length > 1)? targetVolids : false;\n\t\t\t\t\n\t\t\t\treturn $.when.apply($, reqDef).done(function(data) {\n\t\t\t\t\tvar argLen = arguments.length,\n\t\t\t\t\t\ti;\n\t\t\t\t\t\n\t\t\t\t\tdata.warning && fm.error(data.warning);\n\t\t\t\t\t\n\t\t\t\t\tif (argLen > 1) {\n\t\t\t\t\t\tdata.files = (data.files || []);\n\t\t\t\t\t\tfor(i = 1; i < argLen; i++) {\n\t\t\t\t\t\t\targuments[i].warning && fm.error(arguments[i].warning);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (arguments[i].files) {\n\t\t\t\t\t\t\t\tdata.files.push.apply(data.files, arguments[i].files);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// because \"preventDone : true\" so update files cache\n\t\t\t\t\tdata.files && data.files.length && fm.cache(data.files);\n\t\t\t\t\t\n\t\t\t\t\tfm.lazy(function() {\n\t\t\t\t\t\tfm.trigger('search', data);\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t// fire event with command name + 'done'\n\t\t\t\t\t\treturn fm.lazy(function() {\n\t\t\t\t\t\t\tfm.trigger('searchdone');\n\t\t\t\t\t\t});\n\t\t\t\t\t}).then(function() {\n\t\t\t\t\t\t// force update content\n\t\t\t\t\t\tdata.sync && fm.sync();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tfm.getUI('toolbar').find('.'+fm.res('class', 'searchbtn')+' :text').trigger('focus');\n\t\t\treturn $.Deferred().reject();\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/selectall',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"selectall\"\n\t * Select ALL of cwd items\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.selectall = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tstate = 0;\n\t\t\n\t\tthis.fm.bind('select', function(e) {\n\t\t\tstate = (e.data && e.data.selectall)? -1 : 0;\n\t\t});\n\t\t\n\t\tthis.state = 0;\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn state;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\t$(document).trigger($.Event('keydown', { keyCode: 65, ctrlKey : true, shiftKey : false, altKey : false, metaKey : false }));\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/selectinvert',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"selectinvert\"\n\t * Invert Selection of cwd items\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.selectinvert = function() {\n\t\t\"use strict\";\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\t$(document).trigger($.Event('keydown', { keyCode: 73, ctrlKey : true, shiftKey : true, altKey : false, metaKey : false }));\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/selectnone',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"selectnone\"\n\t * Unselect ALL of cwd items\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.selectnone = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\tstate = -1;\n\t\t\n\t\tfm.bind('select', function(e) {\n\t\t\tstate = (e.data && e.data.unselectall)? -1 : 0;\n\t\t});\n\t\t\n\t\tthis.state = -1;\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn state;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tfm.getUI('cwd').trigger('unselectall');\n\t\t\treturn $.Deferred().resolve();\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/sort',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"sort\"\n\t * Change sort files rule\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.sort = function() {\n\t\t\"use strict\";\n\t\tvar self  = this,\n\t\t\tfm    = self.fm,\n\t\t\tsetVar = function() {\n\t\t\t\tself.variants = [];\n\t\t\t\t$.each(fm.sortRules, function(name, value) {\n\t\t\t\t\tif (fm.sorters[name]) {\n\t\t\t\t\t\tvar arr = (name === fm.sortType)? (fm.sortOrder === 'asc'? 'n' : 's') : '';\n\t\t\t\t\t\tself.variants.push([name, (arr? '<span class=\"ui-icon ui-icon-arrowthick-1-'+arr+'\"></span>' : '') + '&nbsp;' + fm.i18n('sort'+name)]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tself.variants.push('|');\n\t\t\t\tself.variants.push([\n\t\t\t\t\t'stick',\n\t\t\t\t\t(fm.sortStickFolders? '<span class=\"ui-icon ui-icon-check\"/>' : '') + '&nbsp;' + fm.i18n('sortFoldersFirst')\n\t\t\t\t]);\n\t\t\t\tif (fm.ui.tree && fm.options.sortAlsoTreeview !== null) {\n\t\t\t\t\tself.variants.push('|');\n\t\t\t\t\tself.variants.push([\n\t\t\t\t\t\t'tree',\n\t\t\t\t\t\t(fm.sortAlsoTreeview? '<span class=\"ui-icon ui-icon-check\"/>' : '') + '&nbsp;' + fm.i18n('sortAlsoTreeview')\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t\tupdateContextmenu();\n\t\t\t},\n\t\t\tupdateContextmenu = function() {\n\t\t\t\tvar cm = fm.getUI('contextmenu'),\n\t\t\t\t\ticon, sub;\n\t\t\t\tif (cm.is(':visible')) {\n\t\t\t\t\ticon = cm.find('span.elfinder-button-icon-sort');\n\t\t\t\t\tsub = icon.siblings('div.elfinder-contextmenu-sub');\n\t\t\t\t\tsub.find('span.ui-icon').remove();\n\t\t\t\t\tsub.children('div.elfinder-contextsubmenu-item').each(function() {\n\t\t\t\t\t\tvar tgt = $(this).children('span'),\n\t\t\t\t\t\t\tname = tgt.text().trim(),\n\t\t\t\t\t\t\tarr;\n\t\t\t\t\t\tif (name === (i18Name.stick || (i18Name.stick = fm.i18n('sortFoldersFirst')))) {\n\t\t\t\t\t\t\tif (fm.sortStickFolders) {\n\t\t\t\t\t\t\t\ttgt.prepend('<span class=\"ui-icon ui-icon-check\"/>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (name === (i18Name.tree || (i18Name.tree = fm.i18n('sortAlsoTreeview')))) {\n\t\t\t\t\t\t\tif (fm.sortAlsoTreeview) {\n\t\t\t\t\t\t\t\ttgt.prepend('<span class=\"ui-icon ui-icon-check\"/>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (name === (i18Name[fm.sortType] || (i18Name[fm.sortType] = fm.i18n('sort' + fm.sortType)))) {\n\t\t\t\t\t\t\tarr = fm.sortOrder === 'asc'? 'n' : 's';\n\t\t\t\t\t\t\ttgt.prepend('<span class=\"ui-icon ui-icon-arrowthick-1-'+arr+'\"></span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\ti18Name = {};\n\t\t\n\t\t/**\n\t\t * Command options\n\t\t *\n\t\t * @type  Object\n\t\t */\n\t\tthis.options = {ui : 'sortbutton'};\n\t\t\n\t\tthis.keepContextmenu = true;\n\n\t\tfm.bind('sortchange', setVar)\n\t\t.bind('sorterupdate', function() {\n\t\t\tsetVar();\n\t\t\tfm.getUI().children('.elfinder-button-sort-menu').children('.elfinder-button-menu-item').each(function() {\n\t\t\t\tvar tgt = $(this),\n\t\t\t\t\trel = tgt.attr('rel');\n\t\t\t\ttgt.toggle(!!(! rel || fm.sorters[rel]));\n\t\t\t});\n\t\t})\n\t\t.bind('cwdrender', function() {\n\t\t\tvar cols = $(fm.cwd).find('div.elfinder-cwd-wrapper-list table');\n\t\t\tif (cols.length) {\n\t\t\t\t$.each(fm.sortRules, function(name, value) {\n\t\t\t\t\tvar td = cols.find('thead tr td.elfinder-cwd-view-th-'+name);\n\t\t\t\t\tif (td.length) {\n\t\t\t\t\t\tvar current = ( name == fm.sortType),\n\t\t\t\t\t\tsort = {\n\t\t\t\t\t\t\ttype  : name,\n\t\t\t\t\t\t\torder : current ? fm.sortOrder == 'asc' ? 'desc' : 'asc' : fm.sortOrder\n\t\t\t\t\t\t},arr;\n\t\t\t\t\t\tif (current) {\n\t\t\t\t\t\t\ttd.addClass('ui-state-active');\n\t\t\t\t\t\t\tarr = fm.sortOrder == 'asc' ? 'n' : 's';\n\t\t\t\t\t\t\t$('<span class=\"ui-icon ui-icon-triangle-1-'+arr+'\"/>').appendTo(td);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(td).on('click', function(e){\n\t\t\t\t\t\t\tif (! $(this).data('dragging')) {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tif (! fm.getUI('cwd').data('longtap')) {\n\t\t\t\t\t\t\t\t\tfm.exec('sort', [], sort);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('mouseenter mouseleave', function(e) {\n\t\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type === 'mouseenter');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.exec = function(hashes, cOpt) {\n\t\t\tvar fm = this.fm,\n\t\t\t\tsortopt = $.isPlainObject(cOpt)? cOpt : (function() {\n\t\t\t\t\tcOpt += '';\n\t\t\t\t\tvar sOpts = {};\n\t\t\t\t\tif (cOpt === 'stick') {\n\t\t\t\t\t\tsOpts.stick = !fm.sortStickFolders;\n\t\t\t\t\t} else if (cOpt === 'tree') {\n\t\t\t\t\t\tsOpts.tree = !fm.sortAlsoTreeview;\n\t\t\t\t\t} else if (fm.sorters[cOpt]) {\n\t\t\t\t\t\tif (fm.sortType === cOpt) {\n\t\t\t\t\t\t\tsOpts.order = fm.sortOrder === 'asc'? 'desc' : 'asc';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsOpts.type = cOpt;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn sOpts;\n\t\t\t\t})(),\n\t\t\t\tsort = Object.assign({\n\t\t\t\t\ttype  : fm.sortType,\n\t\t\t\t\torder : fm.sortOrder,\n\t\t\t\t\tstick : fm.sortStickFolders,\n\t\t\t\t\ttree  : fm.sortAlsoTreeview\n\t\t\t\t}, sortopt);\n\n\t\t\treturn fm.lazy(function() {\n\t\t\t\tfm.setSort(sort.type, sort.order, sort.stick, sort.tree);\n\t\t\t\tthis.resolve();\n\t\t\t});\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/undo',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"undo\"\n\t * Undo previous commands\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.undo = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\tsetTitle = function(undo) {\n\t\t\t\tif (undo) {\n\t\t\t\t\tself.title = fm.i18n('cmdundo') + ' ' + fm.i18n('cmd'+undo.cmd);\n\t\t\t\t\tself.state = 0;\n\t\t\t\t} else {\n\t\t\t\t\tself.title = fm.i18n('cmdundo');\n\t\t\t\t\tself.state = -1;\n\t\t\t\t}\n\t\t\t\tself.change();\n\t\t\t},\n\t\t\tcmds = [];\n\t\t\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts      = [{\n\t\t\tpattern     : 'ctrl+z'\n\t\t}];\n\t\tthis.syncTitleOnChange = true;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn cmds.length? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.setUndo = function(undo, redo) {\n\t\t\tvar _undo = {};\n\t\t\tif (undo) {\n\t\t\t\tif ($.isPlainObject(undo) && undo.cmd && undo.callback) {\n\t\t\t\t\tObject.assign(_undo, undo);\n\t\t\t\t\tif (redo) {\n\t\t\t\t\t\tdelete redo.undo;\n\t\t\t\t\t\t_undo.redo = redo;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.getCommand('redo').setRedo(null);\n\t\t\t\t\t}\n\t\t\t\t\tcmds.push(_undo);\n\t\t\t\t\tsetTitle(_undo);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar redo = fm.getCommand('redo'),\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\tundo, res, _redo = {};\n\t\t\tif (cmds.length) {\n\t\t\t\tundo = cmds.pop();\n\t\t\t\tif (undo.redo) {\n\t\t\t\t\tObject.assign(_redo, undo.redo);\n\t\t\t\t\tdelete undo.redo;\n\t\t\t\t} else {\n\t\t\t\t\t_redo = null;\n\t\t\t\t} \n\t\t\t\tdfd.done(function() {\n\t\t\t\t\tif (_redo) {\n\t\t\t\t\t\tredo.setRedo(_redo, undo);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tsetTitle(cmds.length? cmds[cmds.length-1] : void(0));\n\t\t\t\t\n\t\t\t\tres = undo.callback();\n\t\t\t\t\n\t\t\t\tif (res && res.done) {\n\t\t\t\t\tres.done(function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfd.resolve();\n\t\t\t\t}\n\t\t\t\tif (cmds.length) {\n\t\t\t\t\tthis.update(0, cmds[cmds.length - 1].name);\n\t\t\t\t} else {\n\t\t\t\t\tthis.update(-1, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdfd.reject();\n\t\t\t}\n\t\t\treturn dfd;\n\t\t};\n\t\t\n\t\tfm.bind('exec', function(e) {\n\t\t\tvar data = e.data || {};\n\t\t\tif (data.opts && data.opts._userAction) {\n\t\t\t\tif (data.dfrd && data.dfrd.done) {\n\t\t\t\t\tdata.dfrd.done(function(res) {\n\t\t\t\t\t\tif (res && res.undo && res.redo) {\n\t\t\t\t\t\t\tres.undo.redo = res.redo;\n\t\t\t\t\t\t\tself.setUndo(res.undo);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * @class  elFinder command \"redo\"\n\t * Redo previous commands\n\t *\n\t * @author Naoki Sawada\n\t **/\n\telFinder.prototype.commands.redo = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm   = this.fm,\n\t\t\tsetTitle = function(redo) {\n\t\t\t\tif (redo && redo.callback) {\n\t\t\t\t\tself.title = fm.i18n('cmdredo') + ' ' + fm.i18n('cmd'+redo.cmd);\n\t\t\t\t\tself.state = 0;\n\t\t\t\t} else {\n\t\t\t\t\tself.title = fm.i18n('cmdredo');\n\t\t\t\t\tself.state = -1;\n\t\t\t\t}\n\t\t\t\tself.change();\n\t\t\t},\n\t\t\tcmds = [];\n\t\t\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\t\tthis.shortcuts      = [{\n\t\t\tpattern     : 'shift+ctrl+z ctrl+y'\n\t\t}];\n\t\tthis.syncTitleOnChange = true;\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn cmds.length? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.setRedo = function(redo, undo) {\n\t\t\tif (redo === null) {\n\t\t\t\tcmds = [];\n\t\t\t\tsetTitle();\n\t\t\t} else {\n\t\t\t\tif (redo && redo.cmd && redo.callback) {\n\t\t\t\t\tif (undo) {\n\t\t\t\t\t\tredo.undo = undo;\n\t\t\t\t\t}\n\t\t\t\t\tcmds.push(redo);\n\t\t\t\t\tsetTitle(redo);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar undo = fm.getCommand('undo'),\n\t\t\t\tdfd = $.Deferred(),\n\t\t\t\tredo, res, _undo = {}, _redo = {};\n\t\t\tif (cmds.length) {\n\t\t\t\tredo = cmds.pop();\n\t\t\t\tif (redo.undo) {\n\t\t\t\t\tObject.assign(_undo, redo.undo);\n\t\t\t\t\tObject.assign(_redo, redo);\n\t\t\t\t\tdelete _redo.undo;\n\t\t\t\t\tdfd.done(function() {\n\t\t\t\t\t\tundo.setUndo(_undo, _redo);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tsetTitle(cmds.length? cmds[cmds.length-1] : void(0));\n\t\t\t\t\n\t\t\t\tres = redo.callback();\n\t\t\t\t\n\t\t\t\tif (res && res.done) {\n\t\t\t\t\tres.done(function() {\n\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdfd.resolve();\n\t\t\t\t}\n\t\t\t\treturn dfd;\n\t\t\t} else {\n\t\t\t\treturn dfd.reject();\n\t\t\t}\n\t\t};\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/up',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"up\"\n\t * Go into parent directory\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\t(elFinder.prototype.commands.up = function() {\n\t\t\"use strict\";\n\t\tthis.alwaysEnabled = true;\n\t\tthis.updateOnSelect = false;\n\t\t\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+up'\n\t\t}];\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn this.fm.cwd().phash ? 0 : -1;\n\t\t};\n\t\t\n\t\tthis.exec = function() {\n\t\t\tvar fm = this.fm,\n\t\t\t\tcwdhash = fm.cwd().hash;\n\t\t\treturn this.fm.cwd().phash ? this.fm.exec('open', this.fm.cwd().phash).done(function() {\n\t\t\t\tfm.one('opendone', function() {\n\t\t\t\t\tfm.selectfiles({files : [cwdhash]});\n\t\t\t\t});\n\t\t\t}) : $.Deferred().reject();\n\t\t};\n\n\t}).prototype = { forceLoad : true }; // this is required command\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/upload',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class elFinder command \"upload\"\n\t * Upload files using iframe or XMLHttpRequest & FormData.\n\t * Dialog allow to send files using drag and drop\n\t *\n\t * @type  elFinder.command\n\t * @author  Dmitry (dio) Levashov\n\t */\n\telFinder.prototype.commands.upload = function() {\n\t\t\"use strict\";\n\t\tvar hover = this.fm.res('class', 'hover');\n\t\t\n\t\tthis.disableOnSearch = true;\n\t\tthis.updateOnSelect  = false;\n\t\t\n\t\t// Shortcut opens dialog\n\t\tthis.shortcuts = [{\n\t\t\tpattern     : 'ctrl+u'\n\t\t}];\n\t\t\n\t\t/**\n\t\t * Return command state\n\t\t *\n\t\t * @return Number\n\t\t **/\n\t\tthis.getstate = function(select) {\n\t\t\tvar fm = this.fm, f,\n\t\t\tsel = (select || [fm.cwd().hash]);\n\t\t\tif (!this._disabled && sel.length == 1) {\n\t\t\t\tf = fm.file(sel[0]);\n\t\t\t}\n\t\t\treturn (f && f.mime == 'directory' && f.write)? 0 : -1;\n\t\t};\n\t\t\n\t\t\n\t\tthis.exec = function(data) {\n\t\t\tvar fm = this.fm,\n\t\t\t\tcwdHash = fm.cwd().hash,\n\t\t\t\tgetTargets = function() {\n\t\t\t\t\tvar tgts = data && (data instanceof Array)? data : null,\n\t\t\t\t\t\tsel;\n\t\t\t\t\tif (! data || data instanceof Array) {\n\t\t\t\t\t\tif (! tgts && (sel = fm.selected()).length === 1 && fm.file(sel[0]).mime === 'directory') {\n\t\t\t\t\t\t\ttgts = sel;\n\t\t\t\t\t\t} else if (!tgts || tgts.length !== 1 || fm.file(tgts[0]).mime !== 'directory') {\n\t\t\t\t\t\t\ttgts = [ cwdHash ];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn tgts;\n\t\t\t\t},\n\t\t\t\ttargets = getTargets(),\n\t\t\t\tcheck = targets? targets[0] : (data && data.target? data.target : null),\n\t\t\t\ttargetDir = check? fm.file(check) : fm.cwd(),\n\t\t\t\tfmUpload = function(data) {\n\t\t\t\t\tfm.upload(data)\n\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\tvar cwd = fm.getUI('cwd'),\n\t\t\t\t\t\t\t\tnode;\n\t\t\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t\t\t\tif (data && data.added && data.added[0] && ! fm.ui.notify.children('.elfinder-notify-upload').length) {\n\t\t\t\t\t\t\t\tvar newItem = fm.findCwdNodes(data.added);\n\t\t\t\t\t\t\t\tif (newItem.length) {\n\t\t\t\t\t\t\t\t\tnewItem.trigger('scrolltoview');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (targetDir.hash !== cwdHash) {\n\t\t\t\t\t\t\t\t\t\tnode = $('<div/>').append(\n\t\t\t\t\t\t\t\t\t\t\t$('<button type=\"button\" class=\"ui-button ui-widget ui-state-default ui-corner-all elfinder-tabstop\"><span class=\"ui-button-text\">'+fm.i18n('cmdopendir')+'</span></button>')\n\t\t\t\t\t\t\t\t\t\t\t.on('mouseenter mouseleave', function(e) { \n\t\t\t\t\t\t\t\t\t\t\t\t$(this).toggleClass('ui-state-hover', e.type == 'mouseenter');\n\t\t\t\t\t\t\t\t\t\t\t}).on('click', function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.exec('open', check).done(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.one('opendone', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfm.trigger('selectfiles', {files : $.map(data.added, function(f) {return f.hash;})});\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tfm.trigger('selectfiles', {files : $.map(data.added, function(f) {return f.hash;})});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfm.toast({msg: fm.i18n(['complete', fm.i18n('cmdupload')]), extNode: node});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.progress(function() {\n\t\t\t\t\t\t\tdfrd.notifyWith(this, Array.from(arguments));\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tupload = function(data) {\n\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\tif (targets) {\n\t\t\t\t\t\tdata.target = targets[0];\n\t\t\t\t\t}\n\t\t\t\t\tfmUpload(data);\n\t\t\t\t},\n\t\t\t\tgetSelector = function() {\n\t\t\t\t\tvar hash = targetDir.hash,\n\t\t\t\t\t\tdirs = $.map(fm.files(hash), function(f) {\n\t\t\t\t\t\t\treturn (f.mime === 'directory' && f.write)? f : null; \n\t\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (! dirs.length) {\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn $('<div class=\"elfinder-upload-dirselect elfinder-tabstop\" title=\"' + fm.i18n('folders') + '\"/>')\n\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tdirs = fm.sortFiles(dirs);\n\t\t\t\t\t\tvar $this  = $(this),\n\t\t\t\t\t\t\tcwd    = fm.cwd(),\n\t\t\t\t\t\t\tbase   = dialog.closest('div.ui-dialog'),\n\t\t\t\t\t\t\tgetRaw = function(f, icon) {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tlabel    : fm.escape(f.i18 || f.name),\n\t\t\t\t\t\t\t\t\ticon     : icon,\n\t\t\t\t\t\t\t\t\tremain   : false,\n\t\t\t\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\t\t\t\tvar title = base.children('.ui-dialog-titlebar:first').find('span.elfinder-upload-target');\n\t\t\t\t\t\t\t\t\t\ttargets = [ f.hash ];\n\t\t\t\t\t\t\t\t\t\ttitle.html(' - ' + fm.escape(f.i18 || f.name));\n\t\t\t\t\t\t\t\t\t\t$this.trigger('focus');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\toptions  : {\n\t\t\t\t\t\t\t\t\t\tclassName : (targets && targets.length && f.hash === targets[0])? 'ui-state-active' : '',\n\t\t\t\t\t\t\t\t\t\ticonClass : f.csscls || '',\n\t\t\t\t\t\t\t\t\t\ticonImg   : f.icon   || ''\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\traw = [ getRaw(targetDir, 'opendir'), '|' ];\n\t\t\t\t\t\t$.each(dirs, function(i, f) {\n\t\t\t\t\t\t\traw.push(getRaw(f, 'dir'));\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$this.trigger('blur');\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: raw,\n\t\t\t\t\t\t\tx: e.pageX || $(this).offset().left,\n\t\t\t\t\t\t\ty: e.pageY || $(this).offset().top,\n\t\t\t\t\t\t\tprevNode: base,\n\t\t\t\t\t\t\tfitHeight: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}).append('<span class=\"elfinder-button-icon elfinder-button-icon-dir\" />');\n\t\t\t\t},\n\t\t\t\tinputButton = function(type, caption) {\n\t\t\t\t\tvar button,\n\t\t\t\t\t\tinput = $('<input type=\"file\" ' + type + '/>')\n\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t// for IE's bug\n\t\t\t\t\t\t\tif (fm.UA.IE) {\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tform.css('display', 'none').css('position', 'relative');\n\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\tform.css('display', '').css('position', '');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\tupload({input : input.get(0), type : 'files'});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('dragover', function(e) {\n\t\t\t\t\t\t\te.originalEvent.dataTransfer.dropEffect = 'copy';\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tform = $('<form/>').append(input).on('click', function(e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t});\n\n\t\t\t\t\treturn $('<div class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only elfinder-tabstop elfinder-focus\"><span class=\"ui-button-text\">'+fm.i18n(caption)+'</span></div>')\n\t\t\t\t\t\t.append(form)\n\t\t\t\t\t\t.on('click', function(e) {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tinput.trigger('click');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('mouseenter mouseleave', function(e) {\n\t\t\t\t\t\t\t$(this).toggleClass(hover, e.type === 'mouseenter');\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\tdialog, dropbox, pastebox, dropUpload, paste, dirs, spinner, uidialog;\n\t\t\t\n\t\t\tdropUpload = function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\tvar file = false,\n\t\t\t\t\ttype = '',\n\t\t\t\t\telfFrom = null,\n\t\t\t\t\tmycwd = '',\n\t\t\t\t\tdata = null,\n\t\t\t\t\ttarget = e._target || null,\n\t\t\t\t\ttrf = e.dataTransfer || null,\n\t\t\t\t\tkind = (trf.items && trf.items.length && trf.items[0].kind)? trf.items[0].kind : '',\n\t\t\t\t\terrors;\n\t\t\t\t\n\t\t\t\tif (trf) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\telfFrom = trf.getData('elfinderfrom');\n\t\t\t\t\t\tif (elfFrom) {\n\t\t\t\t\t\t\tmycwd = window.location.href + fm.cwd().hash;\n\t\t\t\t\t\t\tif ((!target && elfFrom === mycwd) || target === mycwd) {\n\t\t\t\t\t\t\t\tdfrd.reject();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\n\t\t\t\t\tif (kind === 'file' && (trf.items[0].getAsEntry || trf.items[0].webkitGetAsEntry)) {\n\t\t\t\t\t\tfile = trf;\n\t\t\t\t\t\ttype = 'data';\n\t\t\t\t\t} else if (kind !== 'string' && trf.files && trf.files.length && $.inArray('Text', trf.types) === -1) {\n\t\t\t\t\t\tfile = trf.files;\n\t\t\t\t\t\ttype = 'files';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif ((data = trf.getData('text/html')) && data.match(/<(?:img|a)/i)) {\n\t\t\t\t\t\t\t\tfile = [ data ];\n\t\t\t\t\t\t\t\ttype = 'html';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t\tif (! file) {\n\t\t\t\t\t\t\tif (data = trf.getData('text')) {\n\t\t\t\t\t\t\t\tfile = [ data ];\n\t\t\t\t\t\t\t\ttype = 'text';\n\t\t\t\t\t\t\t} else if (trf && trf.files) {\n\t\t\t\t\t\t\t\t// maybe folder uploading but this UA dose not support it\n\t\t\t\t\t\t\t\tkind = 'file';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (file) {\n\t\t\t\t\tfmUpload({files : file, type : type, target : target, dropEvt : e});\n\t\t\t\t} else {\n\t\t\t\t\terrors = ['errUploadNoFiles'];\n\t\t\t\t\tif (kind === 'file') {\n\t\t\t\t\t\terrors.push('errFolderUpload');\n\t\t\t\t\t}\n\t\t\t\t\tfm.error(errors);\n\t\t\t\t\tdfrd.reject();\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tif (!targets && data) {\n\t\t\t\tif (data.input || data.files) {\n\t\t\t\t\tdata.type = 'files';\n\t\t\t\t\tfmUpload(data);\n\t\t\t\t} else if (data.dropEvt) {\n\t\t\t\t\tdropUpload(data.dropEvt);\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t}\n\t\t\t\n\t\t\tpaste = function(ev) {\n\t\t\t\tvar e = ev.originalEvent || ev;\n\t\t\t\tvar files = [], items = [];\n\t\t\t\tvar file;\n\t\t\t\tif (e.clipboardData) {\n\t\t\t\t\tif (e.clipboardData.items && e.clipboardData.items.length){\n\t\t\t\t\t\titems = e.clipboardData.items;\n\t\t\t\t\t\tfor (var i=0; i < items.length; i++) {\n\t\t\t\t\t\t\tif (e.clipboardData.items[i].kind == 'file') {\n\t\t\t\t\t\t\t\tfile = e.clipboardData.items[i].getAsFile();\n\t\t\t\t\t\t\t\tfiles.push(file);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (e.clipboardData.files && e.clipboardData.files.length) {\n\t\t\t\t\t\tfiles = e.clipboardData.files;\n\t\t\t\t\t}\n\t\t\t\t\tif (files.length) {\n\t\t\t\t\t\tupload({files : files, type : 'files', clipdata : true});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar my = e.target || e.srcElement;\n\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\tvar type = 'text',\n\t\t\t\t\t\tsrc;\n\t\t\t\t\tif (my.innerHTML) {\n\t\t\t\t\t\t$(my).find('img').each(function(i, v){\n\t\t\t\t\t\t\tif (v.src.match(/^webkit-fake-url:\\/\\//)) {\n\t\t\t\t\t\t\t\t// For Safari's bug.\n\t\t\t\t\t\t\t\t// ref. https://bugs.webkit.org/show_bug.cgi?id=49141\n\t\t\t\t\t\t\t\t//      https://dev.ckeditor.com/ticket/13029\n\t\t\t\t\t\t\t\t$(v).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tif ($(my).find('a,img').length) {\n\t\t\t\t\t\t\ttype = 'html';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsrc = my.innerHTML;\n\t\t\t\t\t\tmy.innerHTML = '';\n\t\t\t\t\t\tupload({files : [ src ], type : type});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\t\n\t\t\tdialog = $('<div class=\"elfinder-upload-dialog-wrapper\"/>')\n\t\t\t\t.append(inputButton('multiple', 'selectForUpload'));\n\t\t\t\n\t\t\tif (! fm.UA.Mobile && (function(input) {\n\t\t\t\treturn (typeof input.webkitdirectory !== 'undefined' || typeof input.directory !== 'undefined');})(document.createElement('input'))) {\n\t\t\t\tdialog.append(inputButton('multiple webkitdirectory directory', 'selectFolder'));\n\t\t\t}\n\t\t\t\n\t\t\tif (targetDir.dirs) {\n\t\t\t\t\n\t\t\t\tif (targetDir.hash === cwdHash || fm.navHash2Elm(targetDir.hash).hasClass('elfinder-subtree-loaded')) {\n\t\t\t\t\tgetSelector().appendTo(dialog);\n\t\t\t\t} else {\n\t\t\t\t\tspinner = $('<div class=\"elfinder-upload-dirselect\" title=\"' + fm.i18n('nowLoading') + '\"/>')\n\t\t\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-spinner\" />')\n\t\t\t\t\t\t.appendTo(dialog);\n\t\t\t\t\tfm.request({cmd : 'tree', target : targetDir.hash})\n\t\t\t\t\t\t.done(function() { \n\t\t\t\t\t\t\tfm.one('treedone', function() {\n\t\t\t\t\t\t\t\tspinner.replaceWith(getSelector());\n\t\t\t\t\t\t\t\tuidialog.elfinderdialog('tabstopsInit');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\tspinner.remove();\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (fm.dragUpload) {\n\t\t\t\tdropbox = $('<div class=\"ui-corner-all elfinder-upload-dropbox elfinder-tabstop\" contenteditable=\"true\" data-ph=\"'+fm.i18n('dropPasteFiles')+'\"></div>')\n\t\t\t\t\t.on('paste', function(e){\n\t\t\t\t\t\tpaste(e);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mousedown click', function(){\n\t\t\t\t\t\t$(this).trigger('focus');\n\t\t\t\t\t})\n\t\t\t\t\t.on('focus', function(){\n\t\t\t\t\t\tthis.innerHTML = '';\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseover', function(){\n\t\t\t\t\t\t$(this).addClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseout', function(){\n\t\t\t\t\t\t$(this).removeClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragenter', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t  \te.preventDefault();\n\t\t\t\t\t  \t$(this).addClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragleave', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t  \te.preventDefault();\n\t\t\t\t\t  \t$(this).removeClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragover', function(e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t  \te.preventDefault();\n\t\t\t\t\t\te.originalEvent.dataTransfer.dropEffect = 'copy';\n\t\t\t\t\t\t$(this).addClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('drop', function(e) {\n\t\t\t\t\t\tdialog.elfinderdialog('close');\n\t\t\t\t\t\ttargets && (e.originalEvent._target = targets[0]);\n\t\t\t\t\t\tdropUpload(e.originalEvent);\n\t\t\t\t\t})\n\t\t\t\t\t.prependTo(dialog)\n\t\t\t\t\t.after('<div class=\"elfinder-upload-dialog-or\">'+fm.i18n('or')+'</div>')[0];\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tpastebox = $('<div class=\"ui-corner-all elfinder-upload-dropbox\" contenteditable=\"true\">'+fm.i18n('dropFilesBrowser')+'</div>')\n\t\t\t\t\t.on('paste drop', function(e){\n\t\t\t\t\t\tpaste(e);\n\t\t\t\t\t})\n\t\t\t\t\t.on('mousedown click', function(){\n\t\t\t\t\t\t$(this).trigger('focus');\n\t\t\t\t\t})\n\t\t\t\t\t.on('focus', function(){\n\t\t\t\t\t\tthis.innerHTML = '';\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragenter mouseover', function(){\n\t\t\t\t\t\t$(this).addClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.on('dragleave mouseout', function(){\n\t\t\t\t\t\t$(this).removeClass(hover);\n\t\t\t\t\t})\n\t\t\t\t\t.prependTo(dialog)\n\t\t\t\t\t.after('<div class=\"elfinder-upload-dialog-or\">'+fm.i18n('or')+'</div>')[0];\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tuidialog = this.fmDialog(dialog, {\n\t\t\t\ttitle          : this.title + '<span class=\"elfinder-upload-target\">' + (targetDir? ' - ' + fm.escape(targetDir.i18 || targetDir.name) : '') + '</span>',\n\t\t\t\tmodal          : true,\n\t\t\t\tresizable      : false,\n\t\t\t\tdestroyOnClose : true,\n\t\t\t\tpropagationEvents : ['mousemove', 'mouseup', 'click'],\n\t\t\t\tclose          : function() {\n\t\t\t\t\tvar cm = fm.getUI('contextmenu');\n\t\t\t\t\tif (cm.is(':visible')) {\n\t\t\t\t\t\tcm.click();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/commands/view',[\n\t\"../elFinder\"\n],function(elFinder){\n\t/**\n\t * @class  elFinder command \"view\"\n\t * Change current directory view (icons/list)\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\telFinder.prototype.commands.view = function() {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tfm = this.fm,\n\t\t\tsubMenuRaw;\n\t\tthis.value          = fm.viewType;\n\t\tthis.alwaysEnabled  = true;\n\t\tthis.updateOnSelect = false;\n\n\t\tthis.options = { ui : 'viewbutton'};\n\t\t\n\t\tthis.getstate = function() {\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t\tthis.extra = {\n\t\t\ticon: 'menu',\n\t\t\tnode: $('<span/>')\n\t\t\t\t.attr({title: fm.i18n('viewtype')})\n\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar node = $(this);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\traw: getSubMenuRaw(),\n\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\ty: node.offset().top\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t};\n\n\t\tthis.exec = function() {\n\t\t\tvar self  = this,\n\t\t\t\tvalue = this.value == 'list' ? 'icons' : 'list';\n\t\t\t\t\n\t\t\tfm.storage('view', value);\n\t\t\treturn fm.lazy(function() {\n\t\t\t\tfm.viewchange();\n\t\t\t\tself.update(void(0), value);\n\t\t\t\tthis.resolve();\n\t\t\t});\n\t\t};\n\n\t\tfm.bind('init', function() {\n\t\t\tsubMenuRaw = (function() {\n\t\t\t\tvar cwd = fm.getUI('cwd'),\n\t\t\t\t\traws = [],\n\t\t\t\t\tsizeNames = fm.options.uiOptions.cwd.iconsView.sizeNames,\n\t\t\t\t\tmax = fm.options.uiOptions.cwd.iconsView.sizeMax,\n\t\t\t\t\ti, size;\n\t\t\t\tfor (i = 0; i <= max; i++) {\n\t\t\t\t\traws.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel    : fm.i18n(sizeNames[i] || ('Size-' + i + ' icons')),\n\t\t\t\t\t\t\ticon     : 'view',\n\t\t\t\t\t\t\tcallback : (function(s) {\n\t\t\t\t\t\t\t\treturn function() {\n\t\t\t\t\t\t\t\t\tcwd.trigger('iconpref', {size: s});\n\t\t\t\t\t\t\t\t\tfm.storage('iconsize', s);\n\t\t\t\t\t\t\t\t\tif (self.value === 'list') {\n\t\t\t\t\t\t\t\t\t\tself.exec();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})(i)\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\traws.push('|');\n\t\t\t\traws.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel    : fm.i18n('viewlist'),\n\t\t\t\t\t\ticon     : 'view-list',\n\t\t\t\t\t\tcallback : function() {\n\t\t\t\t\t\t\tif (self.value !== 'list') {\n\t\t\t\t\t\t\t\tself.exec();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\n\t\t\t\t);\n\t\t\t\treturn raws;\n\t\t\t})();\n\t\t}).bind('contextmenucreate', function() {\n\t\t\tself.extra = {\n\t\t\t\ticon: 'menu',\n\t\t\t\tnode: $('<span/>')\n\t\t\t\t\t.attr({title: fm.i18n('cmdview')})\n\t\t\t\t\t.on('click touchstart', function(e){\n\t\t\t\t\t\tif (e.type === 'touchstart' && e.originalEvent.touches.length > 1) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar node = $(this),\n\t\t\t\t\t\t\traw = subMenuRaw.concat(),\n\t\t\t\t\t\t\tidx, i;\n\t\t\t\t\t\tif (self.value === 'list') {\n\t\t\t\t\t\t\tidx = subMenuRaw.length - 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tidx = parseInt(fm.storage('iconsize') || 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (i = 0; i < subMenuRaw.length; i++) {\n\t\t\t\t\t\t\tif (subMenuRaw[i] !== '|') {\n\t\t\t\t\t\t\t\tsubMenuRaw[i].options = (i === idx? {'className': 'ui-state-active'} : void(0))\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tfm.trigger('contextmenu', {\n\t\t\t\t\t\t\traw: subMenuRaw,\n\t\t\t\t\t\t\tx: node.offset().left,\n\t\t\t\t\t\t\ty: node.offset().top\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t};\n\t\t});\n\n\t};\n\n\treturn elFinder;\n\n});\ndefine('skylark-elfinder/proxy/elFinderSupportVer1',[],function() {\n\t/**\n\t * elFinder transport to support old protocol.\n\t *\n\t * @example\n\t * $('selector').elfinder({\n\t *   .... \n\t *   transport : new elFinderSupportVer1()\n\t * })\n\t *\n\t * @author Dmitry (dio) Levashov\n\t **/\n\twindow.elFinderSupportVer1 = function(upload) {\n\t\t\"use strict\";\n\t\tvar self = this,\n\t\t\tdateObj, today, yesterday,\n\t\t\tgetDateString = function(date) {\n\t\t\t\treturn date.replace('Today', today).replace('Yesterday', yesterday);\n\t\t\t};\n\t\t\n\t\tdateObj = new Date();\n\t\ttoday = dateObj.getFullYear() + '/' + (dateObj.getMonth() + 1) + '/' + dateObj.getDate();\n\t\tdateObj = new Date(Date.now() - 86400000);\n\t\tyesterday = dateObj.getFullYear() + '/' + (dateObj.getMonth() + 1) + '/' + dateObj.getDate();\n\t\t\n\t\tthis.upload = upload || 'auto';\n\t\t\n\t\tthis.init = function(fm) {\n\t\t\tthis.fm = fm;\n\t\t\tthis.fm.parseUploadData = function(text) {\n\t\t\t\tvar data;\n\n\t\t\t\tif (!$.trim(text)) {\n\t\t\t\t\treturn {error : ['errResponse', 'errDataEmpty']};\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(text);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn {error : ['errResponse', 'errDataNotJSON']};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn self.normalize('upload', data);\n\t\t\t};\n\t\t};\n\t\t\n\t\t\n\t\tthis.send = function(opts) {\n\t\t\tvar self = this,\n\t\t\t\tfm = this.fm,\n\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\tcmd = opts.data.cmd,\n\t\t\t\targs = [],\n\t\t\t\t_opts = {},\n\t\t\t\tdata,\n\t\t\t\txhr;\n\t\t\t\t\n\t\t\tdfrd.abort = function() {\n\t\t\t\tif (xhr.state() == 'pending') {\n\t\t\t\t\txhr.quiet = true;\n\t\t\t\t\txhr.abort();\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tswitch (cmd) {\n\t\t\t\tcase 'open':\n\t\t\t\t\topts.data.tree = 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'parents':\n\t\t\t\tcase 'tree':\n\t\t\t\t\treturn dfrd.resolve({tree : []});\n\t\t\t\tcase 'get':\n\t\t\t\t\topts.data.cmd = 'read';\n\t\t\t\t\topts.data.current = fm.file(opts.data.target).phash;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'put':\n\t\t\t\t\topts.data.cmd = 'edit';\n\t\t\t\t\topts.data.current = fm.file(opts.data.target).phash;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'archive':\n\t\t\t\tcase 'rm':\n\t\t\t\t\topts.data.current = fm.file(opts.data.targets[0]).phash;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'extract':\n\t\t\t\tcase 'rename':\n\t\t\t\tcase 'resize':\n\t\t\t\t\topts.data.current = fm.file(opts.data.target).phash;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'duplicate':\n\t\t\t\t\t_opts = $.extend(true, {}, opts);\n\n\t\t\t\t\t$.each(opts.data.targets, function(i, hash) {\n\t\t\t\t\t\t$.ajax(Object.assign(_opts, {data : {cmd : 'duplicate', target : hash, current : fm.file(hash).phash}}))\n\t\t\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\t\t\tfm.error(fm.res('error', 'connect'));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tdata = self.normalize('duplicate', data);\n\t\t\t\t\t\t\t\tif (data.error) {\n\t\t\t\t\t\t\t\t\tfm.error(data.error);\n\t\t\t\t\t\t\t\t} else if (data.added) {\n\t\t\t\t\t\t\t\t\tfm.trigger('add', {added : data.added});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\treturn dfrd.resolve({});\n\t\t\t\t\t\n\t\t\t\tcase 'mkdir':\n\t\t\t\tcase 'mkfile':\n\t\t\t\t\topts.data.current = opts.data.target;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'paste':\n\t\t\t\t\topts.data.current = opts.data.dst;\n\t\t\t\t\tif (! opts.data.tree) {\n\t\t\t\t\t\t$.each(opts.data.targets, function(i, h) {\n\t\t\t\t\t\t\tif (fm.file(h) && fm.file(h).mime === 'directory') {\n\t\t\t\t\t\t\t\topts.data.tree = '1';\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\tcase 'size':\n\t\t\t\t\treturn dfrd.resolve({error : fm.res('error', 'cmdsupport')});\n\t\t\t\tcase 'search':\n\t\t\t\t\treturn dfrd.resolve({error : fm.res('error', 'cmdsupport')});\n\t\t\t\t\t\n\t\t\t\tcase 'file':\n\t\t\t\t\topts.data.cmd = 'open';\n\t\t\t\t\topts.data.current = fm.file(opts.data.target).phash;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t// cmd = opts.data.cmd\n\t\t\t\n\t\t\txhr = $.ajax(opts)\n\t\t\t\t.fail(function(error) {\n\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t})\n\t\t\t\t.done(function(raw) {\n\t\t\t\t\tdata = self.normalize(cmd, raw);\n\t\t\t\t\tdfrd.resolve(data);\n\t\t\t\t});\n\t\t\t\t\n\t\t\treturn dfrd;\n\t\t};\n\t\t\n\t\t// fix old connectors errors messages as possible\n\t\t// this.errors = {\n\t\t// \t'Unknown command'                                  : 'Unknown command.',\n\t\t// \t'Invalid backend configuration'                    : 'Invalid backend configuration.',\n\t\t// \t'Access denied'                                    : 'Access denied.',\n\t\t// \t'PHP JSON module not installed'                    : 'PHP JSON module not installed.',\n\t\t// \t'File not found'                                   : 'File not found.',\n\t\t// \t'Invalid name'                                     : 'Invalid file name.',\n\t\t// \t'File or folder with the same name already exists' : 'File named \"$1\" already exists in this location.',\n\t\t// \t'Not allowed file type'                            : 'Not allowed file type.',\n\t\t// \t'File exceeds the maximum allowed filesize'        : 'File exceeds maximum allowed size.',\n\t\t// \t'Unable to copy into itself'                       : 'Unable to copy \"$1\" into itself.',\n\t\t// \t'Unable to create archive'                         : 'Unable to create archive.',\n\t\t// \t'Unable to extract files from archive'             : 'Unable to extract files from \"$1\".'\n\t\t// }\n\t\t\n\t\tthis.normalize = function(cmd, data) {\n\t\t\tvar self = this,\n\t\t\t\tfm   = this.fm,\n\t\t\t\tfiles = {}, \n\t\t\t\tfilter = function(file) { return file && file.hash && file.name && file.mime ? file : null; },\n\t\t\t\tgetDirs = function(items) {\n\t\t\t\t\treturn $.grep(items, function(i) {\n\t\t\t\t\t\treturn i && i.mime && i.mime === 'directory'? true : false;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tgetTreeDiff = function(files) {\n\t\t\t\t\tvar dirs = getDirs(files);\n\t\t\t\t\ttreeDiff = fm.diff(dirs, null, ['date', 'ts']);\n\t\t\t\t\tif (treeDiff.added.length) {\n\t\t\t\t\t\ttreeDiff.added = getDirs(treeDiff.added);\n\t\t\t\t\t}\n\t\t\t\t\tif (treeDiff.changed.length) {\n\t\t\t\t\t\ttreeDiff.changed = getDirs(treeDiff.changed);\n\t\t\t\t\t}\n\t\t\t\t\tif (treeDiff.removed.length) {\n\t\t\t\t\t\tvar removed = [];\n\t\t\t\t\t\t$.each(treeDiff.removed, function(i, h) {\n\t\t\t\t\t\t\tvar item;\n\t\t\t\t\t\t\tif ((item = fm.file(h)) && item.mime === 'directory') {\n\t\t\t\t\t\t\t\tremoved.push(h);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttreeDiff.removed = removed;\n\t\t\t\t\t}\n\t\t\t\t\treturn treeDiff;\n\t\t\t\t},\n\t\t\t\tphash, diff, isCwd, treeDiff;\n\n\t\t\tif ((cmd == 'tmb' || cmd == 'get')) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t\t\n\t\t\t// if (data.error) {\n\t\t\t// \t$.each(data.error, function(i, msg) {\n\t\t\t// \t\tif (self.errors[msg]) {\n\t\t\t// \t\t\tdata.error[i] = self.errors[msg];\n\t\t\t// \t\t}\n\t\t\t// \t});\n\t\t\t// }\n\t\t\t\n\t\t\tif (cmd == 'upload' && data.error && data.cwd) {\n\t\t\t\tdata.warning = Object.assign({}, data.error);\n\t\t\t\tdata.error = false;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tif (data.error) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t\t\n\t\t\tif (cmd == 'put') {\n\n\t\t\t\tphash = fm.file(data.target.hash).phash;\n\t\t\t\treturn {changed : [this.normalizeFile(data.target, phash)]};\n\t\t\t}\n\t\t\t\n\t\t\tphash = data.cwd.hash;\n\n\t\t\tisCwd = (phash == fm.cwd().hash);\n\t\t\t\n\t\t\tif (data.tree) {\n\t\t\t\t$.each(this.normalizeTree(data.tree), function(i, file) {\n\t\t\t\t\tfiles[file.hash] = file;\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t$.each(data.cdc||[], function(i, file) {\n\t\t\t\tvar hash = file.hash,\n\t\t\t\t\tmcts;\n\n\t\t\t\tif (files[hash]) {\n\t\t\t\t\tif (file.date) {\n\t\t\t\t\t\tmcts = Date.parse(getDateString(file.date));\n\t\t\t\t\t\tif (mcts && !isNaN(mcts)) {\n\t\t\t\t\t\t\tfiles[hash].ts = Math.floor(mcts / 1000);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfiles[hash].date = file.date || fm.formatDate(file);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfiles[hash].locked = file.hash == phash ? true : file.rm === void(0) ? false : !file.rm;\n\t\t\t\t} else {\n\t\t\t\t\tfiles[hash] = self.normalizeFile(file, phash, data.tmb);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (!data.tree) {\n\t\t\t\t$.each(fm.files(), function(hash, file) {\n\t\t\t\t\tif (!files[hash] && file.phash != phash && file.mime == 'directory') {\n\t\t\t\t\t\tfiles[hash] = file;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tif (cmd == 'open') {\n\t\t\t\treturn {\n\t\t\t\t\t\tcwd     : files[phash] || this.normalizeFile(data.cwd),\n\t\t\t\t\t\tfiles   : $.map(files, function(f) { return f; }),\n\t\t\t\t\t\toptions : self.normalizeOptions(data),\n\t\t\t\t\t\tinit    : !!data.params,\n\t\t\t\t\t\tdebug   : data.debug\n\t\t\t\t\t};\n\t\t\t}\n\t\t\t\n\t\t\tif (isCwd) {\n\t\t\t\tdiff = fm.diff($.map(files, filter));\n\t\t\t} else {\n\t\t\t\tif (data.tree && cmd !== 'paste') {\n\t\t\t\t\tdiff = getTreeDiff(files);\n\t\t\t\t} else {\n\t\t\t\t\tdiff = {\n\t\t\t\t\t\tadded   : [],\n\t\t\t\t\t\tremoved : [],\n\t\t\t\t\t\tchanged : []\n\t\t\t\t\t};\n\t\t\t\t\tif (cmd === 'paste') {\n\t\t\t\t\t\tdiff.sync = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn Object.assign({\n\t\t\t\tcurrent : data.cwd.hash,\n\t\t\t\terror   : data.error,\n\t\t\t\twarning : data.warning,\n\t\t\t\toptions : {tmb : !!data.tmb}\n\t\t\t}, diff);\n\t\t\t\n\t\t};\n\t\t\n\t\t/**\n\t\t * Convert old api tree into plain array of dirs\n\t\t *\n\t\t * @param  Object  root dir\n\t\t * @return Array\n\t\t */\n\t\tthis.normalizeTree = function(root) {\n\t\t\tvar self     = this,\n\t\t\t\tresult   = [],\n\t\t\t\ttraverse = function(dirs, phash) {\n\t\t\t\t\tvar i, dir;\n\t\t\t\t\t\n\t\t\t\t\tfor (i = 0; i < dirs.length; i++) {\n\t\t\t\t\t\tdir = dirs[i];\n\t\t\t\t\t\tresult.push(self.normalizeFile(dir, phash));\n\t\t\t\t\t\tdir.dirs.length && traverse(dir.dirs, dir.hash);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\ttraverse([root]);\n\n\t\t\treturn result;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Convert file info from old api format into new one\n\t\t *\n\t\t * @param  Object  file\n\t\t * @param  String  parent dir hash\n\t\t * @return Object\n\t\t */\n\t\tthis.normalizeFile = function(file, phash, tmb) {\n\t\t\tvar mime = file.mime || 'directory',\n\t\t\t\tsize = mime == 'directory' && !file.linkTo ? 0 : file.size,\n\t\t\t\tmcts = file.date? Date.parse(getDateString(file.date)) : void 0,\n\t\t\t\tinfo = {\n\t\t\t\t\turl    : file.url,\n\t\t\t\t\thash   : file.hash,\n\t\t\t\t\tphash  : phash,\n\t\t\t\t\tname   : file.name,\n\t\t\t\t\tmime   : mime,\n\t\t\t\t\tts     : file.ts,\n\t\t\t\t\tsize   : size,\n\t\t\t\t\tread   : file.read,\n\t\t\t\t\twrite  : file.write,\n\t\t\t\t\tlocked : !phash ? true : file.rm === void(0) ? false : !file.rm\n\t\t\t\t};\n\t\t\t\n\t\t\tif (! info.ts) {\n\t\t\t\tif (mcts && !isNaN(mcts)) {\n\t\t\t\t\tinfo.ts = Math.floor(mcts / 1000);\n\t\t\t\t} else {\n\t\t\t\t\tinfo.date = file.date || this.fm.formatDate(file);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (file.mime == 'application/x-empty' || file.mime == 'inode/x-empty') {\n\t\t\t\tinfo.mime = 'text/plain';\n\t\t\t}\n\t\t\t\n\t\t\tif (file.linkTo) {\n\t\t\t\tinfo.alias = file.linkTo;\n\t\t\t}\n\n\t\t\tif (file.linkTo) {\n\t\t\t\tinfo.linkTo = file.linkTo;\n\t\t\t}\n\t\t\t\n\t\t\tif (file.tmb) {\n\t\t\t\tinfo.tmb = file.tmb;\n\t\t\t} else if (info.mime.indexOf('image/') === 0 && tmb) {\n\t\t\t\tinfo.tmb = 1;\n\t\t\t\t\n\t\t\t}\n\n\t\t\tif (file.dirs && file.dirs.length) {\n\t\t\t\tinfo.dirs = true;\n\t\t\t}\n\t\t\tif (file.dim) {\n\t\t\t\tinfo.dim = file.dim;\n\t\t\t}\n\t\t\tif (file.resize) {\n\t\t\t\tinfo.resize = file.resize;\n\t\t\t}\n\t\t\treturn info;\n\t\t};\n\t\t\n\t\tthis.normalizeOptions = function(data) {\n\t\t\tvar opts = {\n\t\t\t\t\tpath          : data.cwd.rel,\n\t\t\t\t\tdisabled      : $.merge((data.disabled || []), [ 'search', 'netmount', 'zipdl' ]),\n\t\t\t\t\ttmb           : !!data.tmb,\n\t\t\t\t\tcopyOverwrite : true\n\t\t\t\t};\n\t\t\t\n\t\t\tif (data.params) {\n\t\t\t\topts.api      = 1;\n\t\t\t\topts.url      = data.params.url;\n\t\t\t\topts.archivers = {\n\t\t\t\t\tcreate  : data.params.archives || [],\n\t\t\t\t\textract : data.params.extract || []\n\t\t\t\t};\n\t\t\t}\n\t\t\t\n\t\t\tif (opts.path.indexOf('/') !== -1) {\n\t\t\t\topts.separator = '/';\n\t\t\t} else if (opts.path.indexOf('\\\\') !== -1) {\n\t\t\t\topts.separator = '\\\\';\n\t\t\t}\n\t\t\treturn opts;\n\t\t};\n\t};\n\n});\ndefine('skylark-elfinder/extras/editors.default',[\n\t\"../elFinder\"\n],function(elFinder) {\n\t\"use strict\";\n\tvar apps = {},\n\t\t// get query of getfile\n\t\tgetfile = window.location.search.match(/getfile=([a-z]+)/),\n\t\tuseRequire = elFinder.prototype.hasRequire,\n\t\thasFlash = (function() {\n\t\t\tvar hasFlash;\n\t\t\ttry {\n\t\t\t\thasFlash = !!(new ActiveXObject('ShockwaveFlash.ShockwaveFlash'));\n\t\t\t} catch (e) {\n\t\t\t\thasFlash = !!(typeof window.orientation === 'undefined' || (navigator && navigator.mimeTypes[\"application/x-shockwave-flash\"]));\n\t\t\t}\n\t\t\treturn hasFlash;\n\t\t})(),\n\t\text2mime = {\n\t\t\tbmp: 'image/x-ms-bmp',\n\t\t\tdng: 'image/x-adobe-dng',\n\t\t\tgif: 'image/gif',\n\t\t\tjpeg: 'image/jpeg',\n\t\t\tjpg: 'image/jpeg',\n\t\t\tpdf: 'application/pdf',\n\t\t\tpng: 'image/png',\n\t\t\tppm: 'image/x-portable-pixmap',\n\t\t\tpsd: 'image/vnd.adobe.photoshop',\n\t\t\tpxd: 'image/x-pixlr-data',\n\t\t\tsvg: 'image/svg+xml',\n\t\t\ttiff: 'image/tiff',\n\t\t\twebp: 'image/webp',\n\t\t\txcf: 'image/x-xcf',\n\t\t\tsketch: 'application/x-sketch',\n\t\t\tico: 'image/x-icon',\n\t\t\tdds: 'image/vnd-ms.dds',\n\t\t\temf: 'application/x-msmetafile'\n\t\t},\n\t\tmime2ext,\n\t\tgetExtention = function(mime, fm, jpeg) {\n\t\t\tif (!mime2ext) {\n\t\t\t\tmime2ext = fm.arrayFlip(ext2mime);\n\t\t\t}\n\t\t\tvar ext = mime2ext[mime] || fm.mimeTypes[mime];\n\t\t\tif (!jpeg) {\n\t\t\t\tif (ext === 'jpeg') {\n\t\t\t\t\text = 'jpg';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (ext === 'jpg') {\n\t\t\t\t\text = 'jpeg';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ext;\n\t\t},\n\t\tchangeImageType = function(src, toMime) {\n\t\t\tvar dfd = $.Deferred();\n\t\t\ttry {\n\t\t\t\tvar canvas = document.createElement('canvas'),\n\t\t\t\t\tctx = canvas.getContext('2d'),\n\t\t\t\t\timg = new Image(),\n\t\t\t\t\tconv = function() {\n\t\t\t\t\t\tvar url = canvas.toDataURL(toMime),\n\t\t\t\t\t\t\tmime, m;\n\t\t\t\t\t\tif (m = url.match(/^data:([a-z0-9]+\\/[a-z0-9.+-]+)/i)) {\n\t\t\t\t\t\t\tmime = m[1];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmime = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (mime.toLowerCase() === toMime.toLowerCase()) {\n\t\t\t\t\t\t\tdfd.resolve(canvas.toDataURL(toMime), canvas);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\timg.src = src;\n\t\t\t\t$(img).on('load', function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcanvas.width = img.width;\n\t\t\t\t\t\tcanvas.height = img.height;\n\t\t\t\t\t\tctx.drawImage(img, 0, 0);\n\t\t\t\t\t\tconv();\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t}\n\t\t\t\t}).on('error', function () {\n\t\t\t\t\tdfd.reject();\n\t\t\t\t});\n\t\t\t\treturn dfd;\n\t\t\t} catch(e) {\n\t\t\t\treturn dfd.reject();\n\t\t\t}\n\t\t},\n\t\tinitImgTag = function(id, file, content, fm) {\n\t\t\tvar node = $(this).children('img:first').data('ext', getExtention(file.mime, fm)),\n\t\t\t\tspnr = $('<div class=\"elfinder-edit-spinner elfinder-edit-image\"/>')\n\t\t\t\t\t.html('<span class=\"elfinder-spinner-text\">' + fm.i18n('ntfloadimg') + '</span><span class=\"elfinder-spinner\"/>')\n\t\t\t\t\t.hide()\n\t\t\t\t\t.appendTo(this),\n\t\t\t\tsetup = function() {\n\t\t\t\t\tnode.attr('id', id+'-img')\n\t\t\t\t\t\t.attr('src', url || content)\n\t\t\t\t\t\t.css({'height':'', 'max-width':'100%', 'max-height':'100%', 'cursor':'pointer'})\n\t\t\t\t\t\t.data('loading', function(done) {\n\t\t\t\t\t\t\tvar btns = node.closest('.elfinder-dialog').find('button,.elfinder-titlebar-button');\n\t\t\t\t\t\t\tbtns.prop('disabled', !done)[done? 'removeClass' : 'addClass']('ui-state-disabled');\n\t\t\t\t\t\t\tnode.css('opacity', done? '' : '0.3');\n\t\t\t\t\t\t\tspnr[done? 'hide' : 'show']();\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\turl;\n\t\t\t\n\t\t\tif (!content.match(/^data:/)) {\n\t\t\t\tfm.openUrl(file.hash, false, function(v) {\n\t\t\t\t\turl = v;\n\t\t\t\t\tnode.attr('_src', content);\n\t\t\t\t\tsetup();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetup();\n\t\t\t}\n\t\t},\n\t\timgBase64 = function(node, mime) {\n\t\t\tvar style = node.attr('style'),\n\t\t\t\timg, canvas, ctx, data;\n\t\t\ttry {\n\t\t\t\t// reset css for getting image size\n\t\t\t\tnode.attr('style', '');\n\t\t\t\t// img node\n\t\t\t\timg = node.get(0);\n\t\t\t\t// New Canvas\n\t\t\t\tcanvas = document.createElement('canvas');\n\t\t\t\tcanvas.width  = img.width;\n\t\t\t\tcanvas.height = img.height;\n\t\t\t\t// restore css\n\t\t\t\tnode.attr('style', style);\n\t\t\t\t// Draw Image\n\t\t\t\tcanvas.getContext('2d').drawImage(img, 0, 0);\n\t\t\t\t// To Base64\n\t\t\t\tdata = canvas.toDataURL(mime);\n\t\t\t} catch(e) {\n\t\t\t\tdata = node.attr('src');\n\t\t\t}\n\t\t\treturn data;\n\t\t},\n\t\tpixlrCallBack = function() {\n\t\t\tif (!hasFlash || window.parent === window) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar pixlr = window.location.search.match(/[?&]pixlr=([^&]+)/),\n\t\t\t\timage = window.location.search.match(/[?&]image=([^&]+)/),\n\t\t\t\tp, ifm, url, node, ext;\n\t\t\tif (pixlr) {\n\t\t\t\t// case of redirected from pixlr.com\n\t\t\t\tp = window.parent;\n\t\t\t\tifm = p.$('#'+pixlr[1]+'iframe').hide();\n\t\t\t\tnode = p.$('#'+pixlr[1]).data('resizeoff')();\n\t\t\t\tif (image[1].substr(0, 4) === 'http') {\n\t\t\t\t\turl = image[1];\n\t\t\t\t\text = url.replace(/.+\\.([^.]+)$/, '$1');\n\t\t\t\t\tif (node.data('ext') !== ext) {\n\t\t\t\t\t\tnode.closest('.ui-dialog').trigger('changeType', {\n\t\t\t\t\t\t\textention: ext,\n\t\t\t\t\t\t\tmime : ext2mime[ext]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (window.location.protocol === 'https:') {\n\t\t\t\t\t\turl = url.replace(/^http:/, 'https:');\n\t\t\t\t\t}\n\t\t\t\t\tnode.on('load error', function() {\n\t\t\t\t\t\t\tnode.data('loading')(true);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.attr('src', url)\n\t\t\t\t\t\t.data('loading')();\n\t\t\t\t} else {\n\t\t\t\t\tnode.data('loading')(true);\n\t\t\t\t}\n\t\t\t\tifm.trigger('destroy').remove();\n\t\t\t}\n\t\t},\n\t\tpixlrSetup = function(opts, fm) {\n\t\t\tif (!hasFlash || fm.UA.ltIE8) {\n\t\t\t\tthis.disabled = true;\n\t\t\t}\n\t\t},\n\t\tpixlrLoad = function(mode, base) {\n\t\t\tif (navigator && !navigator.mimeTypes[\"application/x-shockwave-flash\"]) {\n\t\t\t\tvar src = 'data:application/x-shockwave-flash;base64,Q1dTCJUCAAB42kxSTW/TQBB9Xjv1hkLamoIvEeJaQBUHjvQjVEUKImnkIK7BjTapi5u1dlfQ/gJ6KjdLCHHl9/CPyszaRexhdt/sm3kzs3uJ+A+QVsCTAEfillZ3DbQmAZmD3jZZOk1ms0k+/5wvld0d5cUKt71QMOv6Nx7De2bLUp/mJZbKfVTGFnoFq9zbMrdnd3jBAOrSKbMi5nF7GK5oX+RzhXlelqiMdtpdVQoXnHd6ZZ26oKsqPy3KwhXK4kub8ClsRS7s4gXONZGPjdEGyhhgMJ0qNzG6ohKWFrWARD9Jfgm8CxgEfe+6kdxtuINXqLuIGUSBFNm3ACKt1xEJGcbcqox8QGfMds3bOEuJhpM6QgQpxwSCtAHdmy0eXLQDYb8uMq0dNlHHjYDEIVHD1AeS2L8afuK7ROcTXjJmhXtec92r3R/f1SQfxPw6VFovqzvwoL1MIDc8lpv/cSh6q+1IkGv/hyAJ9iacP8Lz9zVdDmk2iXc/HL3mbZuJMXwQnp3UG42UiII4ZIlHeykOwjd0vO4TY/RhMD2ajQbDMdxZYZtv4d/QT5pHlbaTj5tMUvj+wizFIcG/AAAA//8DAFw0fxk=';\n\t\t\t\t$(base).empty().append('<object data=\"'+src+'\" type=\"application/x-shockwave-flash\" style=\"width:100%;height:100%\"><param name=\"movie\" value=\"'+src+'\"></object>');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar self = this,\n\t\t\t\tfm = this.fm,\n\t\t\t\tclPreventBack = fm.res('class', 'preventback'),\n\t\t\t\tnode = $(base).children('img:first')\n\t\t\t\t\t.data('loading')()\n\t\t\t\t\t.data('resizeoff', function() {\n\t\t\t\t\t\t$(window).off('resize.'+node.attr('id'));\n\t\t\t\t\t\tdialog.addClass(clPreventBack);\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t})\n\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\tlaunch();\n\t\t\t\t\t}),\n\t\t\t\tdialog = $(base).closest('.ui-dialog'),\n\t\t\t\telfNode = fm.getUI(),\n\t\t\t\tuiToast = fm.getUI('toast'),\n\t\t\t\tcontainer = $('<iframe class=\"ui-front\" allowtransparency=\"true\">'),\n\t\t\t\tfile = this.file,\n\t\t\t\ttimeout = 15,\n\t\t\t\terror = function(error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tcontainer.trigger('destroy').remove();\n\t\t\t\t\t\tnode.data('loading')(true);\n\t\t\t\t\t\tfm.error(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuiToast.appendTo(dialog.closest('.ui-dialog'));\n\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\tmode: 'info',\n\t\t\t\t\t\t\tmsg: 'Can not launch Pixlr yet. Waiting ' + timeout + ' seconds.',\n\t\t\t\t\t\t\tbutton: {\n\t\t\t\t\t\t\t\ttext: 'Abort',\n\t\t\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\t\t\tcontainer.trigger('destroy').remove();\n\t\t\t\t\t\t\t\t\tnode.data('loading')(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\tuiToast.children().length === 1 && uiToast.appendTo(fm.getUI());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\terrtm = setTimeout(error, timeout * 1000);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tlaunch = function() {\n\t\t\t\t\tvar src = 'https://pixlr.com/'+mode+'/?s=c',\n\t\t\t\t\t\tmyurl = window.location.href.toString().replace(/#.*$/, ''),\n\t\t\t\t\t\topts = {};\n\n\t\t\t\t\terrtm = setTimeout(error, timeout * 1000);\n\t\t\t\t\tmyurl += (myurl.indexOf('?') === -1? '?' : '&') + 'pixlr='+node.attr('id');\n\t\t\t\t\tsrc += '&referrer=elFinder&locktitle=true';\n\t\t\t\t\tsrc += '&exit='+encodeURIComponent(myurl+'&image=0');\n\t\t\t\t\tsrc += '&target='+encodeURIComponent(myurl);\n\t\t\t\t\tsrc += '&title='+encodeURIComponent(file.name);\n\t\t\t\t\tsrc += '&image='+encodeURIComponent(node.attr('_src'));\n\t\t\t\t\t\n\t\t\t\t\topts.src = src;\n\t\t\t\t\topts.css = {\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\theight: $(window).height()+'px',\n\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\tbackgroundColor: 'transparent',\n\t\t\t\t\t\tborder: 'none',\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tright: 0\n\t\t\t\t\t};\n\n\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\tnode: base,\n\t\t\t\t\t\teditorObj: void(0),\n\t\t\t\t\t\tinstance: container,\n\t\t\t\t\t\topts: opts\n\t\t\t\t\t});\n\n\t\t\t\t\tcontainer\n\t\t\t\t\t\t.attr('id', node.attr('id')+'iframe')\n\t\t\t\t\t\t.attr('src', opts.src)\n\t\t\t\t\t\t.css(opts.css)\n\t\t\t\t\t\t.one('load', function() {\n\t\t\t\t\t\t\terrtm && clearTimeout(errtm);\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tif (container.is(':hidden')) {\n\t\t\t\t\t\t\t\t\terror('Please disable your ad blocker.');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\tdialog.addClass(clPreventBack);\n\t\t\t\t\t\t\tfm.toggleMaximize(container, true);\n\t\t\t\t\t\t\tfm.toFront(container);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('destroy', function() {\n\t\t\t\t\t\t\tfm.toggleMaximize(container, false);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('error', error)\n\t\t\t\t\t\t.appendTo(elfNode.hasClass('elfinder-fullscreen')? elfNode : 'body');\n\t\t\t\t},\n\t\t\t\terrtm;\n\t\t\t$(base).on('saveAsFail', launch);\n\t\t\tlaunch();\n\t\t},\n\t\tiframeClose = function(ifm) {\n\t\t\tvar $ifm = $(ifm),\n\t\t\t\tdfd = $.Deferred().always(function() {\n\t\t\t\t\t$ifm.off('load', load);\n\t\t\t\t}),\n\t\t\t\tab = 'about:blank',\n\t\t\t\tchk = function() {\n\t\t\t\t\ttm = setTimeout(function() {\n\t\t\t\t\t\tvar src;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tsrc = base.contentWindow.location.href;\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\tsrc = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (src === ab) {\n\t\t\t\t\t\t\tdfd.resolve();\n\t\t\t\t\t\t} else if (--cnt > 0){\n\t\t\t\t\t\t\tchk();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfd.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 500);\n\t\t\t\t},\n\t\t\t\tload = function() {\n\t\t\t\t\ttm && clearTimeout(tm);\n\t\t\t\t\tdfd.resolve();\n\t\t\t\t},\n\t\t\t\tcnt = 20, // 500ms * 20 = 10sec wait\n\t\t\t\ttm;\n\t\t\t$ifm.one('load', load);\n\t\t\tifm.src = ab;\n\t\t\tchk();\n\t\t\treturn dfd;\n\t\t};\n\t\n\t// check callback from pixlr\n\tpixlrCallBack();\n\t\n\t// check getfile callback function\n\tif (getfile) {\n\t\tgetfile = getfile[1];\n\t\tif (getfile === 'ckeditor') {\n\t\t\telFinder.prototype._options.getFileCallback = function(file, fm) {\n\t\t\t\twindow.opener.CKEDITOR.tools.callFunction((function() {\n\t\t\t\t\tvar reParam = new RegExp('(?:[\\?&]|&amp;)CKEditorFuncNum=([^&]+)', 'i'),\n\t\t\t\t\t\tmatch = window.location.search.match(reParam);\n\t\t\t\t\treturn (match && match.length > 1) ? match[1] : '';\n\t\t\t\t})(), fm.convAbsUrl(file.url));\n\t\t\t\tfm.destroy();\n\t\t\t\twindow.close();\n\t\t\t};\n\t\t}\n\t}\n\t\n\t// return editors Array\n\treturn [\n\t\t{\n\t\t\t// tui.image-editor - https://github.com/nhnent/tui.image-editor\n\t\t\tinfo : {\n\t\t\t\tid: 'tuiimgedit',\n\t\t\t\tname: 'TUI Image Editor',\n\t\t\t\ticonImg: 'img/editor-icons.png 0 -48',\n\t\t\t\tdataScheme: true,\n\t\t\t\tschemeContent: true,\n\t\t\t\topenMaximized: true,\n\t\t\t\tcanMakeEmpty: false,\n\t\t\t\tintegrate: {\n\t\t\t\t\ttitle: 'TOAST UI Image Editor',\n\t\t\t\t\tlink: 'http://ui.toast.com/tui-image-editor/'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// MIME types to accept\n\t\t\tmimes : ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml', 'image/x-ms-bmp'],\n\t\t\t// HTML of this editor\n\t\t\thtml : '<div class=\"elfinder-edit-imageeditor\"><canvas></canvas></div>',\n\t\t\t// called on initialization of elFinder cmd edit (this: this editor's config object)\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.ltIE8 || fm.UA.Mobile) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.opts = Object.assign({\n\t\t\t\t\t\tversion: 'v3.9.0'\n\t\t\t\t\t}, opts.extraOptions.tuiImgEditOpts || {}, {\n\t\t\t\t\t\ticonsPath : fm.baseUrl + 'img/tui-',\n\t\t\t\t\t\ttheme : {}\n\t\t\t\t\t});\n\t\t\t\t\tif (!fm.isSameOrigin(this.opts.iconsPath)) {\n\t\t\t\t\t\tthis.disabled = true;\n\t\t\t\t\t\tfm.debug('warning', 'Setting `commandOptions.edit.extraOptions.tuiImgEditOpts.iconsPath` MUST follow the same origin policy.');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Initialization of editing node (this: this editors HTML node)\n\t\t\tinit : function(id, file, content, fm) {\n\t\t\t\tthis.data('url', content);\n\t\t\t},\n\t\t\tload : function(base) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tcdns = fm.options.cdns,\n\t\t\t\t\tver  = self.confObj.opts.version,\n\t\t\t\t\tinit = function(editor) {\n\t\t\t\t\t\tvar $base = $(base),\n\t\t\t\t\t\t\tbParent = $base.parent(),\n\t\t\t\t\t\t\topts = self.confObj.opts,\n\t\t\t\t\t\t\ticonsPath = opts.iconsPath,\n\t\t\t\t\t\t\ttmpContainer = $('<div class=\"tui-image-editor-container\">').appendTo(bParent),\n\t\t\t\t\t\t\ttmpDiv = [\n\t\t\t\t\t\t\t\t$('<div class=\"tui-image-editor-submenu\"/>').appendTo(tmpContainer),\n\t\t\t\t\t\t\t\t$('<div class=\"tui-image-editor-controls\"/>').appendTo(tmpContainer)\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tiEditor = new editor(base, {\n\t\t\t\t\t\t\t\tincludeUI: {\n\t\t\t\t\t\t\t\t\tloadImage: {\n\t\t\t\t\t\t\t\t\t\tpath: $base.data('url'),\n\t\t\t\t\t\t\t\t\t\tname: self.file.name\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttheme: Object.assign(opts.theme, {\n\t\t\t\t\t\t\t\t\t\t'menu.normalIcon.path': iconsPath + 'icon-d.svg',\n\t\t\t\t\t\t\t\t\t\t'menu.normalIcon.name': 'icon-d',\n\t\t\t\t\t\t\t\t\t\t'menu.activeIcon.path': iconsPath + 'icon-b.svg',\n\t\t\t\t\t\t\t\t\t\t'menu.activeIcon.name': 'icon-b',\n\t\t\t\t\t\t\t\t\t\t'menu.disabledIcon.path': iconsPath + 'icon-a.svg',\n\t\t\t\t\t\t\t\t\t\t'menu.disabledIcon.name': 'icon-a',\n\t\t\t\t\t\t\t\t\t\t'menu.hoverIcon.path': iconsPath + 'icon-c.svg',\n\t\t\t\t\t\t\t\t\t\t'menu.hoverIcon.name': 'icon-c',\n\t\t\t\t\t\t\t\t\t\t'submenu.normalIcon.path': iconsPath + 'icon-d.svg',\n\t\t\t\t\t\t\t\t\t\t'submenu.normalIcon.name': 'icon-d',\n\t\t\t\t\t\t\t\t\t\t'submenu.activeIcon.path': iconsPath + 'icon-c.svg',\n\t\t\t\t\t\t\t\t\t\t'submenu.activeIcon.name': 'icon-c'\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tinitMenu: 'filter',\n\t\t\t\t\t\t\t\t\tmenuBarPosition: 'bottom'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcssMaxWidth: Math.max(300, bParent.width()),\n\t\t\t\t\t\t\t\tcssMaxHeight: Math.max(200, bParent.height() - (tmpDiv[0].height() + tmpDiv[1].height() + 3 /*margin*/)),\n\t\t\t\t\t\t\t\tusageStatistics: false\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tcanvas = $base.find('canvas:first').get(0),\n\t\t\t\t\t\t\tzoom = function(v) {\n\t\t\t\t\t\t\t\tif (typeof v !== 'undefined') {\n\t\t\t\t\t\t\t\t\tvar c = $(canvas),\n\t\t\t\t\t\t\t\t\t\tw = parseInt(c.attr('width')),\n\t\t\t\t\t\t\t\t\t\th = parseInt(c.attr('height')),\n\t\t\t\t\t\t\t\t\t\ta = w / h,\n\t\t\t\t\t\t\t\t\t\tmw, mh;\n\t\t\t\t\t\t\t\t\tif (v === 0) {\n\t\t\t\t\t\t\t\t\t\tmw = w;\n\t\t\t\t\t\t\t\t\t\tmh = h;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tmw = parseInt(c.css('max-width')) + Number(v);\n\t\t\t\t\t\t\t\t\t\tmh = mw / a;\n\t\t\t\t\t\t\t\t\t\tif (mw > w && mh > h) {\n\t\t\t\t\t\t\t\t\t\t\tmw = w;\n\t\t\t\t\t\t\t\t\t\t\tmh = h;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tper.text(Math.round(mw / w * 100) + '%');\n\t\t\t\t\t\t\t\t\tiEditor.resizeCanvasDimension({width: mw, height: mh});\n\t\t\t\t\t\t\t\t\t// continually change more\n\t\t\t\t\t\t\t\t\tif (zoomMore) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tzoomMore && zoom(v);\n\t\t\t\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tzup = $('<span class=\"ui-icon ui-icon-plusthick\"/>').data('val', 10),\n\t\t\t\t\t\t\tzdown = $('<span class=\"ui-icon ui-icon-minusthick\"/>').data('val', -10),\n\t\t\t\t\t\t\tper = $('<button/>').css('width', '4em').text('%').attr('title', '100%').data('val', 0),\n\t\t\t\t\t\t\tquty, qutyTm, zoomTm, zoomMore;\n\n\t\t\t\t\t\ttmpContainer.remove();\n\t\t\t\t\t\t$base.removeData('url').data('mime', self.file.mime);\n\t\t\t\t\t\t// jpeg quality controls\n\t\t\t\t\t\tif (self.file.mime === 'image/jpeg') {\n\t\t\t\t\t\t\t$base.data('quality', fm.storage('jpgQuality') || fm.option('jpgQuality'));\n\t\t\t\t\t\t\tquty = $('<input type=\"number\" class=\"ui-corner-all elfinder-resize-quality elfinder-tabstop\"/>')\n\t\t\t\t\t\t\t\t.attr('min', '1')\n\t\t\t\t\t\t\t\t.attr('max', '100')\n\t\t\t\t\t\t\t\t.attr('title', '1 - 100')\n\t\t\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\t\t\tvar q = quty.val();\n\t\t\t\t\t\t\t\t\t$base.data('quality', q);\n\t\t\t\t\t\t\t\t\tqutyTm && cancelAnimationFrame(qutyTm);\n\t\t\t\t\t\t\t\t\tqutyTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\tcanvas.toBlob(function(blob) {\n\t\t\t\t\t\t\t\t\t\t\tblob && quty.next('span').text(' (' + fm.formatSize(blob.size) + ')');\n\t\t\t\t\t\t\t\t\t\t}, 'image/jpeg', Math.max(Math.min(q, 100), 1) / 100);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.val($base.data('quality'));\n\t\t\t\t\t\t\t$('<div class=\"ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality\"/>')\n\t\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\t\t$('<span>').html(fm.i18n('quality') + ' : '), quty, $('<span/>')\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.prependTo($base.parent().next());\n\t\t\t\t\t\t} else if (self.file.mime === 'image/svg+xml') {\n\t\t\t\t\t\t\t$base.closest('.ui-dialog').trigger('changeType', {\n\t\t\t\t\t\t\t\textention: 'png',\n\t\t\t\t\t\t\t\tmime : 'image/png',\n\t\t\t\t\t\t\t\tkeepEditor: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// zoom scale controls\n\t\t\t\t\t\t$('<div class=\"ui-dialog-buttonset elfinder-edit-extras\"/>')\n\t\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t\tzdown, per, zup\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.attr('title', fm.i18n('scale'))\n\t\t\t\t\t\t\t.on('click', 'span,button', function() {\n\t\t\t\t\t\t\t\tzoom($(this).data('val'));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('mousedown mouseup mouseleave', 'span', function(e) {\n\t\t\t\t\t\t\t\tzoomMore = false;\n\t\t\t\t\t\t\t\tzoomTm && clearTimeout(zoomTm);\n\t\t\t\t\t\t\t\tif (e.type === 'mousedown') {\n\t\t\t\t\t\t\t\t\tzoomTm = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tzoomMore = true;\n\t\t\t\t\t\t\t\t\t\tzoom($(e.target).data('val'));\n\t\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.prependTo($base.parent().next());\n\n\t\t\t\t\t\t// wait canvas ready\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tdfrd.resolve(iEditor);\n\t\t\t\t\t\t\tif (quty) {\n\t\t\t\t\t\t\t\tquty.trigger('change');\n\t\t\t\t\t\t\t\tiEditor.on('redoStackChanged undoStackChanged', function() {\n\t\t\t\t\t\t\t\t\tquty.trigger('change');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// show initial scale\n\t\t\t\t\t\t\tzoom(null);\n\t\t\t\t\t\t}, 100);\n\n\t\t\t\t\t\t// show color slider (maybe TUI-Image-Editor's bug)\n\t\t\t\t\t\t// see https://github.com/nhn/tui.image-editor/issues/153\n\t\t\t\t\t\t$base.find('.tui-colorpicker-palette-container').on('click', '.tui-colorpicker-palette-preview', function() {\n\t\t\t\t\t\t\t$(this).closest('.color-picker-control').height('auto').find('.tui-colorpicker-slider-container').toggle();\n\t\t\t\t\t\t});\n\t\t\t\t\t\t$base.on('click', function() {\n\t\t\t\t\t\t\t$base.find('.tui-colorpicker-slider-container').hide();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tloader;\n\n\t\t\t\tif (!self.confObj.editor) {\n\t\t\t\t\tloader = $.Deferred();\n\t\t\t\t\tfm.loadCss([\n\t\t\t\t\t\tcdns.tui + '/tui-color-picker/latest/tui-color-picker.css',\n\t\t\t\t\t\tcdns.tui + '/tui-image-editor/'+ver+'/tui-image-editor.css'\n\t\t\t\t\t]);\n\t\t\t\t\tif (fm.hasRequire) {\n\t\t\t\t\t\trequire.config({\n\t\t\t\t\t\t\tpaths : {\n\t\t\t\t\t\t\t\t'fabric/dist/fabric.require' : cdns.fabric + '/fabric.require.min', // for fabric < 2.0.1\n\t\t\t\t\t\t\t\t'fabric' : cdns.fabric + '/fabric.min', // for fabric >= 2.0.1\n\t\t\t\t\t\t\t\t'tui-code-snippet' : cdns.tui + '/tui.code-snippet/latest/tui-code-snippet.min',\n\t\t\t\t\t\t\t\t'tui-color-picker' : cdns.tui + '/tui-color-picker/latest/tui-color-picker.min',\n\t\t\t\t\t\t\t\t'tui-image-editor' : cdns.tui + '/tui-image-editor/'+ver+'/tui-image-editor.min'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\trequire(['tui-image-editor'], function(ImageEditor) {\n\t\t\t\t\t\t\tloader.resolve(ImageEditor);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfm.loadScript([\n\t\t\t\t\t\t\tcdns.fabric + '/fabric.min.js',\n\t\t\t\t\t\t\tcdns.tui + '/tui.code-snippet/latest/tui-code-snippet.min.js'\n\t\t\t\t\t\t], function() {\n\t\t\t\t\t\t\tfm.loadScript([\n\t\t\t\t\t\t\t\tcdns.tui + '/tui-color-picker/latest/tui-color-picker.min.js'\n\t\t\t\t\t\t\t], function() {\n\t\t\t\t\t\t\t\tfm.loadScript([\n\t\t\t\t\t\t\t\t\tcdns.tui + '/tui-image-editor/'+ver+'/tui-image-editor.min.js'\n\t\t\t\t\t\t\t\t], function() {\n\t\t\t\t\t\t\t\t\tloader.resolve(window.tui.ImageEditor);\n\t\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\t\tloadType: 'tag'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\tloadType: 'tag'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tloadType: 'tag'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tloader.done(function(editor) {\n\t\t\t\t\t\tself.confObj.editor = editor;\n\t\t\t\t\t\tinit(editor);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tinit(self.confObj.editor);\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tgetContent : function(base) {\n\t\t\t\tvar editor = this.editor,\n\t\t\t\t\tfm = editor.fm,\n\t\t\t\t\t$base = $(base),\n\t\t\t\t\tquality = $base.data('quality');\n\t\t\t\tif (editor.instance) {\n\t\t\t\t\tif ($base.data('mime') === 'image/jpeg') {\n\t\t\t\t\t\tquality = quality || fm.storage('jpgQuality') || fm.option('jpgQuality');\n\t\t\t\t\t\tquality = Math.max(0.1, Math.min(1, quality / 100));\n\t\t\t\t\t}\n\t\t\t\t\treturn editor.instance.toDataURL({\n\t\t\t\t\t\tformat: getExtention($base.data('mime'), fm, true),\n\t\t\t\t\t\tquality: quality\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tsave : function(base) {\n\t\t\t\tvar $base = $(base),\n\t\t\t\t\tquality = $base.data('quality'),\n\t\t\t\t\thash = $base.data('hash'),\n\t\t\t\t\tfile;\n\t\t\t\tthis.instance.deactivateAll();\n\t\t\t\tif (typeof quality !== 'undefined') {\n\t\t\t\t\tthis.fm.storage('jpgQuality', quality);\n\t\t\t\t}\n\t\t\t\tif (hash) {\n\t\t\t\t\tfile = this.fm.file(hash);\n\t\t\t\t\t$base.data('mime', file.mime);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// Pixlr Editor\n\t\t\tinfo : {\n\t\t\t\tid : 'pixlreditor',\n\t\t\t\tname : 'Pixlr Editor',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -128',\n\t\t\t\turlAsContent: true,\n\t\t\t\tschemeContent: true,\n\t\t\t\tsingle: true,\n\t\t\t\tcanMakeEmpty: true,\n\t\t\t\tintegrate: {\n\t\t\t\t\ttitle: 'PIXLR EDITOR',\n\t\t\t\t\tlink: 'https://pixlr.com/editor/'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// MIME types to accept\n\t\t\tmimes : ['image/jpeg', 'image/png', 'image/gif', 'image/x-ms-bmp', 'image/x-pixlr-data'],\n\t\t\t// HTML of this editor\n\t\t\thtml : '<div class=\"elfinder-edit-imageeditor\"><img/></div>',\n\t\t\t// called on initialization of elFinder cmd edit (this: this editor's config object)\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tpixlrSetup.call(this, opts, fm);\n\t\t\t},\n\t\t\t// Initialization of editing node (this: this editors HTML node)\n\t\t\tinit : function(id, file, url, fm) {\n\t\t\t\tinitImgTag.call(this, id, file, file.size > 0? fm.convAbsUrl(url) : '', fm);\n\t\t\t},\n\t\t\t// Get data uri scheme (this: this editors HTML node)\n\t\t\tgetContent : function() {\n\t\t\t\treturn $(this).children('img:first').attr('src');\n\t\t\t},\n\t\t\tload : function(base) {\n\t\t\t\tpixlrLoad.call(this, 'editor', base);\n\t\t\t},\n\t\t\tsave : function(base) {},\n\t\t\tclose : function(base) {}\n\t\t},\n\t\t{\n\t\t\t// Photopea advanced image editor\n\t\t\tinfo : {\n\t\t\t\tid : 'photopea',\n\t\t\t\tname : 'Photopea',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -160',\n\t\t\t\tsingle: true,\n\t\t\t\tnoContent: true,\n\t\t\t\tarrayBufferContent: true,\n\t\t\t\topenMaximized: true,\n\t\t\t\t// Disable file types that cannot be saved on Photopea.\n\t\t\t\tcanMakeEmpty: ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml', 'image/x-ms-bmp', 'image/tiff', /*'image/x-adobe-dng',*/ 'image/webp', /*'image/x-xcf',*/ 'image/vnd.adobe.photoshop', 'application/pdf', 'image/x-portable-pixmap', 'image/x-sketch', 'image/x-icon', 'image/vnd-ms.dds', /*'application/x-msmetafile'*/],\n\t\t\t\tintegrate: {\n\t\t\t\t\ttitle: 'Photopea',\n\t\t\t\t\tlink: 'https://www.photopea.com/learn/'\n\t\t\t\t}\n\t\t\t},\n\t\t\tmimes : ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml', 'image/x-ms-bmp', 'image/tiff', 'image/x-adobe-dng', 'image/webp', 'image/x-xcf', 'image/vnd.adobe.photoshop', 'application/pdf', 'image/x-portable-pixmap', 'image/x-sketch', 'image/x-icon', 'image/vnd-ms.dds', 'application/x-msmetafile'],\n\t\t\thtml : '<iframe style=\"width:100%;height:100%;border:none;\"></iframe>',\n\t\t\t// setup on elFinder bootup\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.IE || fm.UA.Mobile) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Initialization of editing node (this: this editors HTML node)\n\t\t\tinit : function(id, file, dum, fm) {\n\t\t\t\tvar orig = 'https://www.photopea.com',\n\t\t\t\t\tifm = $(this).hide()\n\t\t\t\t\t\t//.css('box-sizing', 'border-box')\n\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t//spnr.remove();\n\t\t\t\t\t\t\tifm.show();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\tspnr.remove();\n\t\t\t\t\t\t\tifm.show();\n\t\t\t\t\t\t}),\n\t\t\t\t\teditor = this.editor,\n\t\t\t\t\tconfObj = editor.confObj,\n\t\t\t\t\tspnr = $('<div class=\"elfinder-edit-spinner elfinder-edit-photopea\"/>')\n\t\t\t\t\t\t.html('<span class=\"elfinder-spinner-text\">' + fm.i18n('nowLoading') + '</span><span class=\"elfinder-spinner\"/>')\n\t\t\t\t\t\t.appendTo(ifm.parent()),\n\t\t\t\t\tsaveMimes = fm.arrayFlip(confObj.info.canMakeEmpty),\n\t\t\t\t\tgetType = function(mime) {\n\t\t\t\t\t\tvar ext = getExtention(mime, fm),\n\t\t\t\t\t\t\textmime = ext2mime[ext];\n\n\t\t\t\t\t\tif (!confObj.mimesFlip[extmime]) {\n\t\t\t\t\t\t\text = '';\n\t\t\t\t\t\t} else if (ext === 'jpeg') {\n\t\t\t\t\t\t\text = 'jpg';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!ext || !saveMimes[extmime]) {\n\t\t\t\t\t\t\text = 'psd';\n\t\t\t\t\t\t\textmime = ext2mime[ext];\n\t\t\t\t\t\t\tifm.closest('.ui-dialog').trigger('changeType', {\n\t\t\t\t\t\t\t\textention: ext,\n\t\t\t\t\t\t\t\tmime : extmime,\n\t\t\t\t\t\t\t\tkeepEditor: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn ext;\n\t\t\t\t\t},\n\t\t\t\t\tmime = file.mime,\n\t\t\t\t\tliveMsg, type, quty;\n\t\t\t\t\n\t\t\t\tif (!confObj.mimesFlip) {\n\t\t\t\t\tconfObj.mimesFlip = fm.arrayFlip(confObj.mimes, true);\n\t\t\t\t}\n\t\t\t\tif (!confObj.liveMsg) {\n\t\t\t\t\tconfObj.liveMsg = function(ifm, spnr, file) {\n\t\t\t\t\t\tvar wnd = ifm.get(0).contentWindow,\n\t\t\t\t\t\t\tphase = 0,\n\t\t\t\t\t\t\tdata = null,\n\t\t\t\t\t\t\tdfdIni = $.Deferred().done(function() {\n\t\t\t\t\t\t\t\tspnr.remove();\n\t\t\t\t\t\t\t\tphase = 1;\n\t\t\t\t\t\t\t\twnd.postMessage(data, orig);\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tdfdGet;\n\n\t\t\t\t\t\tthis.load = function() {\n\t\t\t\t\t\t\treturn fm.getContents(file.hash, 'arraybuffer').done(function(d) {\n\t\t\t\t\t\t\t\tdata = d;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.receive = function(e) {\n\t\t\t\t\t\t\tvar ev = e.originalEvent,\n\t\t\t\t\t\t\t\tstate;\n\t\t\t\t\t\t\tif (ev.origin === orig && ev.source === wnd) {\n\t\t\t\t\t\t\t\tif (ev.data === 'done') {\n\t\t\t\t\t\t\t\t\tif (phase === 0) {\n\t\t\t\t\t\t\t\t\t\tdfdIni.resolve();\n\t\t\t\t\t\t\t\t\t} else if (phase === 1) {\n\t\t\t\t\t\t\t\t\t\tphase = 2;\n\t\t\t\t\t\t\t\t\t\tifm.trigger('contentsloaded');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (dfdGet && dfdGet.state() === 'pending') {\n\t\t\t\t\t\t\t\t\t\t\tdfdGet.reject('errDataEmpty');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if (ev.data === 'Save') {\n\t\t\t\t\t\t\t\t\teditor.doSave();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (dfdGet && dfdGet.state() === 'pending') {\n\t\t\t\t\t\t\t\t\t\tif (typeof ev.data === 'object') {\n\t\t\t\t\t\t\t\t\t\t\tdfdGet.resolve('data:' + mime + ';base64,' + fm.arrayBufferToBase64(ev.data));\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdfdGet.reject('errDataEmpty');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.getContent = function() {\n\t\t\t\t\t\t\tvar type, q;\n\t\t\t\t\t\t\tif (phase > 1) {\n\t\t\t\t\t\t\t\tdfdGet && dfdGet.state() === 'pending' && dfdGet.reject();\n\t\t\t\t\t\t\t\tdfdGet = null;\n\t\t\t\t\t\t\t\tdfdGet = $.Deferred();\n\t\t\t\t\t\t\t\tif (phase === 2) {\n\t\t\t\t\t\t\t\t\tphase = 3;\n\t\t\t\t\t\t\t\t\tdfdGet.resolve('data:' + mime + ';base64,' + fm.arrayBufferToBase64(data));\n\t\t\t\t\t\t\t\t\tdata = null;\n\t\t\t\t\t\t\t\t\treturn dfdGet;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (ifm.data('mime')) {\n\t\t\t\t\t\t\t\t\tmime = ifm.data('mime');\n\t\t\t\t\t\t\t\t\ttype = getType(mime);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (q = ifm.data('quality')) {\n\t\t\t\t\t\t\t\t\ttype += ':' + (q / 100);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twnd.postMessage('app.activeDocument.saveToOE(\"' + type + '\")', orig);\n\t\t\t\t\t\t\t\treturn dfdGet;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tifm.parent().css('padding', 0);\n\t\t\t\ttype = getType(file.mime);\n\t\t\t\tliveMsg = editor.liveMsg = new confObj.liveMsg(ifm, spnr, file);\n\t\t\t\t$(window).on('message.' + fm.namespace, liveMsg.receive);\n\t\t\t\tliveMsg.load().done(function() {\n\t\t\t\t\tvar d = JSON.stringify({\n\t\t\t\t\t\tfiles : [],\n\t\t\t\t\t\tenvironment : {\n\t\t\t\t\t\t\tlang: fm.lang.replace(/_/g, '-'),\n\t\t\t\t\t\t\tcustomIO: {\"save\": \"app.echoToOE(\\\"Save\\\");\"}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tifm.attr('src', orig + '/#' + encodeURI(d));\n\t\t\t\t}).fail(function(err) {\n\t\t\t\t\terr && fm.error(err);\n\t\t\t\t\teditor.initFail = true;\n\t\t\t\t});\n\n\t\t\t\t// jpeg quality controls\n\t\t\t\tif (file.mime === 'image/jpeg' || file.mime === 'image/webp') {\n\t\t\t\t\tifm.data('quality', fm.storage('jpgQuality') || fm.option('jpgQuality'));\n\t\t\t\t\tquty = $('<input type=\"number\" class=\"ui-corner-all elfinder-resize-quality elfinder-tabstop\"/>')\n\t\t\t\t\t\t.attr('min', '1')\n\t\t\t\t\t\t.attr('max', '100')\n\t\t\t\t\t\t.attr('title', '1 - 100')\n\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\tvar q = quty.val();\n\t\t\t\t\t\t\tifm.data('quality', q);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.val(ifm.data('quality'));\n\t\t\t\t\t$('<div class=\"ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality\"/>')\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<span>').html(fm.i18n('quality') + ' : '), quty, $('<span/>')\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.prependTo(ifm.parent().next());\n\t\t\t\t}\n\t\t\t},\n\t\t\tload : function(base) {\n\t\t\t\tvar dfd = $.Deferred(),\n\t\t\t\t\tself = this,\n\t\t\t\t\tfm = this.fm,\n\t\t\t\t\t$base = $(base);\n\t\t\t\tif (self.initFail) {\n\t\t\t\t\tdfd.reject();\n\t\t\t\t} else {\n\t\t\t\t\t$base.on('contentsloaded', function() {\n\t\t\t\t\t\tdfd.resolve(self.liveMsg);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn dfd;\n\t\t\t},\n\t\t\tgetContent : function() {\n\t\t\t\treturn this.editor.liveMsg? this.editor.liveMsg.getContent() : void(0);\n\t\t\t},\n\t\t\tsave : function(base, liveMsg) {\n\t\t\t\tvar $base = $(base),\n\t\t\t\t\tquality = $base.data('quality'),\n\t\t\t\t\thash = $base.data('hash'),\n\t\t\t\t\tfile;\n\t\t\t\tif (typeof quality !== 'undefined') {\n\t\t\t\t\tthis.fm.storage('jpgQuality', quality);\n\t\t\t\t}\n\t\t\t\tif (hash) {\n\t\t\t\t\tfile = this.fm.file(hash);\n\t\t\t\t\t$base.data('mime', file.mime);\n\t\t\t\t} else {\n\t\t\t\t\t$base.removeData('mime');\n\t\t\t\t}\n\t\t\t},\n\t\t\t// On dialog closed\n\t\t\tclose : function(base, liveMsg) {\n\t\t\t\t$(base).attr('src', '');\n\t\t\t\tliveMsg && $(window).off('message.' + this.fm.namespace, liveMsg.receive);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// Pixo is cross-platform image editor\n\t\t\tinfo : {\n\t\t\t\tid : 'pixo',\n\t\t\t\tname : 'Pixo Editor',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -208',\n\t\t\t\tdataScheme: true,\n\t\t\t\tschemeContent: true,\n\t\t\t\tsingle: true,\n\t\t\t\tcanMakeEmpty: false,\n\t\t\t\tintegrate: {\n\t\t\t\t\ttitle: 'Pixo Editor',\n\t\t\t\t\tlink: 'https://pixoeditor.com/privacy-policy/'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// MIME types to accept\n\t\t\tmimes : ['image/jpeg', 'image/png', 'image/gif', 'image/svg+xml', 'image/x-ms-bmp'],\n\t\t\t// HTML of this editor\n\t\t\thtml : '<div class=\"elfinder-edit-imageeditor\"><img/></div>',\n\t\t\t// called on initialization of elFinder cmd edit (this: this editor's config object)\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.ltIE8 || !opts.extraOptions || !opts.extraOptions.pixo || !opts.extraOptions.pixo.apikey) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.editorOpts = opts.extraOptions.pixo;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Initialization of editing node (this: this editors HTML node)\n\t\t\tinit : function(id, file, content, fm) {\n\t\t\t\tinitImgTag.call(this, id, file, content, fm);\n\t\t\t},\n\t\t\t// Get data uri scheme (this: this editors HTML node)\n\t\t\tgetContent : function() {\n\t\t\t\treturn $(this).children('img:first').attr('src');\n\t\t\t},\n\t\t\t// Launch Pixo editor when dialog open\n\t\t\tload : function(base) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm = this.fm,\n\t\t\t\t\t$base = $(base),\n\t\t\t\t\tnode = $base.children('img:first'),\n\t\t\t\t\tdialog = $base.closest('.ui-dialog'),\n\t\t\t\t\telfNode = fm.getUI(),\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tcontainer = $('#elfinder-pixo-container'),\n\t\t\t\t\tinit = function(onload) {\n\t\t\t\t\t\tvar opts;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\tif (!container.length) {\n\t\t\t\t\t\t\tcontainer = $('<div id=\"elfinder-pixo-container\" class=\"ui-front\"/>').css({\n\t\t\t\t\t\t\t\tposition: 'fixed',\n\t\t\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\t\t\tright: 0,\n\t\t\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\t\t\theight: $(window).height(),\n\t\t\t\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t\t\t\t}).hide().appendTo(elfNode.hasClass('elfinder-fullscreen')? elfNode : 'body');\n\t\t\t\t\t\t\t// bind switch fullscreen event\n\t\t\t\t\t\t\telfNode.on('resize.'+fm.namespace, function(e, data) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tdata && data.fullscreen && container.appendTo(data.fullscreen === 'on'? elfNode : 'body');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.bind('destroy', function() {\n\t\t\t\t\t\t\t\teditor && editor.cancelEditing();\n\t\t\t\t\t\t\t\tcontainer.remove();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// always moves to last\n\t\t\t\t\t\t\tcontainer.appendTo(container.parent());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode.on('click', launch);\n\t\t\t\t\t\t// Constructor options\n\t\t\t\t\t\topts = Object.assign({\n\t\t\t\t\t\t\ttype: 'child',\n\t\t\t\t\t\t\tparent: container.get(0),\n\t\t\t\t\t\t\toutput: {format: 'png'},\n\t\t\t\t\t\t\tonSave: function(arg) {\n\t\t\t\t\t\t\t\t// Check current file.hash, all callbacks are called on multiple instances\n\t\t\t\t\t\t\t\tvar mime = arg.toBlob().type,\n\t\t\t\t\t\t\t\t\text = getExtention(mime, fm),\n\t\t\t\t\t\t\t\t\tdraw = function(url) {\n\t\t\t\t\t\t\t\t\t\tnode.one('load error', function() {\n\t\t\t\t\t\t\t\t\t\t\t\tnode.data('loading') && node.data('loading')(true);\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.attr('crossorigin', 'anonymous')\n\t\t\t\t\t\t\t\t\t\t\t.attr('src', url);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\turl = arg.toDataURL();\n\t\t\t\t\t\t\t\tnode.data('loading')();\n\t\t\t\t\t\t\t\tdelete base._canvas;\n\t\t\t\t\t\t\t\tif (node.data('ext') !== ext) {\n\t\t\t\t\t\t\t\t\tchangeImageType(url, self.file.mime).done(function(res, cv) {\n\t\t\t\t\t\t\t\t\t\tif (cv) {\n\t\t\t\t\t\t\t\t\t\t\tbase._canvas = canvas = cv;\n\t\t\t\t\t\t\t\t\t\t\tquty.trigger('change');\n\t\t\t\t\t\t\t\t\t\t\tqBase && qBase.show();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdraw(res);\n\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\tdialog.trigger('changeType', {\n\t\t\t\t\t\t\t\t\t\t\textention: ext,\n\t\t\t\t\t\t\t\t\t\t\tmime : mime\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tdraw(url);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdraw(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonClose: function() {\n\t\t\t\t\t\t\t\tdialog.removeClass(fm.res('class', 'preventback'));\n\t\t\t\t\t\t\t\tfm.toggleMaximize(container, false);\n\t\t\t\t\t\t\t\tcontainer.hide();\n\t\t\t\t\t\t\t\tfm.toFront(dialog);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, self.confObj.editorOpts);\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: base,\n\t\t\t\t\t\t\teditorObj: Pixo,\n\t\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// make editor instance\n\t\t\t\t\t\teditor = new Pixo.Bridge(opts);\n\t\t\t\t\t\tdfrd.resolve(editor);\n\t\t\t\t\t\t$base.on('saveAsFail', launch);\n\t\t\t\t\t\tif (onload) {\n\t\t\t\t\t\t\tonload();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tlaunch = function() {\n\t\t\t\t\t\tdialog.addClass(fm.res('class', 'preventback'));\n\t\t\t\t\t\tfm.toggleMaximize(container, true);\n\t\t\t\t\t\tfm.toFront(container);\n\t\t\t\t\t\tcontainer.show().data('curhash', self.file.hash);\n\t\t\t\t\t\teditor.edit(node.get(0));\n\t\t\t\t\t\tnode.data('loading')(true);\n\t\t\t\t\t},\n\t\t\t\t\tqBase, quty, qutyTm, canvas, editor;\n\n\t\t\t\tnode.data('loading')();\n\n\t\t\t\t// jpeg quality controls\n\t\t\t\tif (self.file.mime === 'image/jpeg') {\n\t\t\t\t\tquty = $('<input type=\"number\" class=\"ui-corner-all elfinder-resize-quality elfinder-tabstop\"/>')\n\t\t\t\t\t\t.attr('min', '1')\n\t\t\t\t\t\t.attr('max', '100')\n\t\t\t\t\t\t.attr('title', '1 - 100')\n\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\tvar q = quty.val();\n\t\t\t\t\t\t\tqutyTm && cancelAnimationFrame(qutyTm);\n\t\t\t\t\t\t\tqutyTm = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\tif (canvas) {\n\t\t\t\t\t\t\t\t\tcanvas.toBlob(function(blob) {\n\t\t\t\t\t\t\t\t\t\tblob && quty.next('span').text(' (' + fm.formatSize(blob.size) + ')');\n\t\t\t\t\t\t\t\t\t}, 'image/jpeg', Math.max(Math.min(q, 100), 1) / 100);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.val(fm.storage('jpgQuality') || fm.option('jpgQuality'));\n\t\t\t\t\tqBase = $('<div class=\"ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality\"/>')\n\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<span>').html(fm.i18n('quality') + ' : '), quty, $('<span/>')\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.prependTo($base.parent().next());\n\t\t\t\t\t$base.data('quty', quty);\n\t\t\t\t}\n\n\t\t\t\t// load script then init\n\t\t\t\tif (typeof Pixo === 'undefined') {\n\t\t\t\t\tfm.loadScript(['https://pixoeditor.com:8443/editor/scripts/bridge.m.js'], function() {\n\t\t\t\t\t\tinit(launch);\n\t\t\t\t\t}, {loadType: 'tag'});\n\t\t\t\t} else {\n\t\t\t\t\tinit();\n\t\t\t\t\tlaunch();\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\t// Convert content url to data uri scheme to save content\n\t\t\tsave : function(base) {\n\t\t\t\tvar self = this,\n\t\t\t\t\t$base = $(base),\n\t\t\t\t\tnode = $base.children('img:first'),\n\t\t\t\t\tq;\n\t\t\t\tif (base._canvas) {\n\t\t\t\t\tif ($base.data('quty')) {\n\t\t\t\t\t\tq = $base.data('quty').val();\n\t\t\t\t\t\tq && this.fm.storage('jpgQuality', q);\n\t\t\t\t\t}\n\t\t\t\t\tnode.attr('src', base._canvas.toDataURL(self.file.mime, q? Math.max(Math.min(q, 100), 1) / 100 : void(0)));\n\t\t\t\t} else if (node.attr('src').substr(0, 5) !== 'data:') {\n\t\t\t\t\tnode.attr('src', imgBase64(node, this.file.mime));\n\t\t\t\t}\n\t\t\t},\n\t\t\tclose : function(base, editor) {\n\t\t\t\teditor && editor.destroy();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// ACE Editor\n\t\t\t// called on initialization of elFinder cmd edit (this: this editor's config object)\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.ltIE8 || !fm.options.cdns.ace) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// `mimes` is not set for support everything kind of text file\n\t\t\tinfo : {\n\t\t\t\tid : 'aceeditor',\n\t\t\t\tname : 'ACE Editor',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -96'\n\t\t\t},\n\t\t\tload : function(textarea) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tcdn  = fm.options.cdns.ace,\n\t\t\t\t\tstart = function() {\n\t\t\t\t\t\tvar editor, editorBase, mode,\n\t\t\t\t\t\tta = $(textarea),\n\t\t\t\t\t\ttaBase = ta.parent(),\n\t\t\t\t\t\tdialog = taBase.parent(),\n\t\t\t\t\t\tid = textarea.id + '_ace',\n\t\t\t\t\t\text = self.file.name.replace(/^.+\\.([^.]+)|(.+)$/, '$1$2').toLowerCase(),\n\t\t\t\t\t\t// MIME/mode map\n\t\t\t\t\t\tmimeMode = {\n\t\t\t\t\t\t\t'text/x-php'\t\t\t  : 'php',\n\t\t\t\t\t\t\t'application/x-php'\t\t  : 'php',\n\t\t\t\t\t\t\t'text/html'\t\t\t\t  : 'html',\n\t\t\t\t\t\t\t'application/xhtml+xml'\t  : 'html',\n\t\t\t\t\t\t\t'text/javascript'\t\t  : 'javascript',\n\t\t\t\t\t\t\t'application/javascript'  : 'javascript',\n\t\t\t\t\t\t\t'text/css'\t\t\t\t  : 'css',\n\t\t\t\t\t\t\t'text/x-c'\t\t\t\t  : 'c_cpp',\n\t\t\t\t\t\t\t'text/x-csrc'\t\t\t  : 'c_cpp',\n\t\t\t\t\t\t\t'text/x-chdr'\t\t\t  : 'c_cpp',\n\t\t\t\t\t\t\t'text/x-c++'\t\t\t  : 'c_cpp',\n\t\t\t\t\t\t\t'text/x-c++src'\t\t\t  : 'c_cpp',\n\t\t\t\t\t\t\t'text/x-c++hdr'\t\t\t  : 'c_cpp',\n\t\t\t\t\t\t\t'text/x-shellscript'\t  : 'sh',\n\t\t\t\t\t\t\t'application/x-csh'\t\t  : 'sh',\n\t\t\t\t\t\t\t'text/x-python'\t\t\t  : 'python',\n\t\t\t\t\t\t\t'text/x-java'\t\t\t  : 'java',\n\t\t\t\t\t\t\t'text/x-java-source'\t  : 'java',\n\t\t\t\t\t\t\t'text/x-ruby'\t\t\t  : 'ruby',\n\t\t\t\t\t\t\t'text/x-perl'\t\t\t  : 'perl',\n\t\t\t\t\t\t\t'application/x-perl'\t  : 'perl',\n\t\t\t\t\t\t\t'text/x-sql'\t\t\t  : 'sql',\n\t\t\t\t\t\t\t'text/xml'\t\t\t\t  : 'xml',\n\t\t\t\t\t\t\t'application/docbook+xml' : 'xml',\n\t\t\t\t\t\t\t'application/xml'\t\t  : 'xml'\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// set base height\n\t\t\t\t\t\ttaBase.height(taBase.height());\n\n\t\t\t\t\t\t// set basePath of ace\n\t\t\t\t\t\tace.config.set('basePath', cdn);\n\n\t\t\t\t\t\t// Base node of Ace editor\n\t\t\t\t\t\teditorBase = $('<div id=\"'+id+'\" style=\"width:100%; height:100%;\"/>').text(ta.val()).insertBefore(ta.hide());\n\n\t\t\t\t\t\t// Editor flag\n\t\t\t\t\t\tta.data('ace', true);\n\n\t\t\t\t\t\t// Aceeditor instance\n\t\t\t\t\t\teditor = ace.edit(id);\n\n\t\t\t\t\t\t// Ace editor configure\n\t\t\t\t\t\teditor.$blockScrolling = Infinity;\n\t\t\t\t\t\teditor.setOptions({\n\t\t\t\t\t\t\ttheme: 'ace/theme/monokai',\n\t\t\t\t\t\t\tfontSize: '14px',\n\t\t\t\t\t\t\twrap: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tace.config.loadModule('ace/ext/modelist', function() {\n\t\t\t\t\t\t\t// detect mode\n\t\t\t\t\t\t\tmode = ace.require('ace/ext/modelist').getModeForPath('/' + self.file.name).name;\n\t\t\t\t\t\t\tif (mode === 'text') {\n\t\t\t\t\t\t\t\tif (mimeMode[self.file.mime]) {\n\t\t\t\t\t\t\t\t\tmode = mimeMode[self.file.mime];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// show MIME:mode in title bar\n\t\t\t\t\t\t\ttaBase.prev().children('.elfinder-dialog-title').append(' (' + self.file.mime + ' : ' + mode.split(/[\\/\\\\]/).pop() + ')');\n\t\t\t\t\t\t\teditor.setOptions({\n\t\t\t\t\t\t\t\tmode: 'ace/mode/' + mode\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (dfrd.state() === 'resolved') {\n\t\t\t\t\t\t\t\tdialog.trigger('resize');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tace.config.loadModule('ace/ext/language_tools', function() {\n\t\t\t\t\t\t\tace.require('ace/ext/language_tools');\n\t\t\t\t\t\t\teditor.setOptions({\n\t\t\t\t\t\t\t\tenableBasicAutocompletion: true,\n\t\t\t\t\t\t\t\tenableSnippets: true,\n\t\t\t\t\t\t\t\tenableLiveAutocompletion: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\tace.config.loadModule('ace/ext/settings_menu', function() {\n\t\t\t\t\t\t\tace.require('ace/ext/settings_menu').init(editor);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Short cuts\n\t\t\t\t\t\teditor.commands.addCommand({\n\t\t\t\t\t\t\tname : \"saveFile\",\n\t\t\t\t\t\t\tbindKey: {\n\t\t\t\t\t\t\t\twin : 'Ctrl-s',\n\t\t\t\t\t\t\t\tmac : 'Command-s'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texec: function(editor) {\n\t\t\t\t\t\t\t\tself.doSave();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\teditor.commands.addCommand({\n\t\t\t\t\t\t\tname : \"closeEditor\",\n\t\t\t\t\t\t\tbindKey: {\n\t\t\t\t\t\t\t\twin : 'Ctrl-w|Ctrl-q',\n\t\t\t\t\t\t\t\tmac : 'Command-w|Command-q'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\texec: function(editor) {\n\t\t\t\t\t\t\t\tself.doCancel();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\teditor.resize();\n\n\t\t\t\t\t\t// TextArea button and Setting button\n\t\t\t\t\t\t$('<div class=\"ui-dialog-buttonset\"/>').css('float', 'left')\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<button/>').html(self.fm.i18n('TextArea'))\n\t\t\t\t\t\t\t.button()\n\t\t\t\t\t\t\t.on('click', function(){\n\t\t\t\t\t\t\t\tif (ta.data('ace')) {\n\t\t\t\t\t\t\t\t\tta.removeData('ace');\n\t\t\t\t\t\t\t\t\teditorBase.hide();\n\t\t\t\t\t\t\t\t\tta.val(editor.session.getValue()).show().trigger('focus');\n\t\t\t\t\t\t\t\t\t$(this).text('AceEditor');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tta.data('ace', true);\n\t\t\t\t\t\t\t\t\teditorBase.show();\n\t\t\t\t\t\t\t\t\teditor.setValue(ta.hide().val(), -1);\n\t\t\t\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t\t\t\t\t$(this).html(self.fm.i18n('TextArea'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<button>Ace editor setting</button>')\n\t\t\t\t\t\t\t.button({\n\t\t\t\t\t\t\t\ticons: {\n\t\t\t\t\t\t\t\t\tprimary: 'ui-icon-gear',\n\t\t\t\t\t\t\t\t\tsecondary: 'ui-icon-triangle-1-e'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttext: false\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('click', function(){\n\t\t\t\t\t\t\t\teditor.showSettingsMenu();\n\t\t\t\t\t\t\t\t$('#ace_settingsmenu')\n\t\t\t\t\t\t\t\t\t.css('font-size', '80%')\n\t\t\t\t\t\t\t\t\t.find('div[contains=\"setOptions\"]').hide().end()\n\t\t\t\t\t\t\t\t\t.parent().appendTo($('#elfinder'));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.prependTo(taBase.next());\n\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\t\teditorObj: ace,\n\t\t\t\t\t\t\tinstance: editor,\n\t\t\t\t\t\t\topts: {}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t//dialog.trigger('resize');\n\t\t\t\t\t\tdfrd.resolve(editor);\n\t\t\t\t\t};\n\n\t\t\t\t// check ace & start\n\t\t\t\tif (!self.confObj.loader) {\n\t\t\t\t\tself.confObj.loader = $.Deferred();\n\t\t\t\t\tself.fm.loadScript([ cdn+'/ace.js' ], function() {\n\t\t\t\t\t\tself.confObj.loader.resolve();\n\t\t\t\t\t}, void 0, {obj: window, name: 'ace'});\n\t\t\t\t}\n\t\t\t\tself.confObj.loader.done(start);\n\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tclose : function(textarea, instance) {\n\t\t\t\tinstance && instance.destroy();\n\t\t\t},\n\t\t\tsave : function(textarea, instance) {\n\t\t\t\tinstance && $(textarea).data('ace') && (textarea.value = instance.session.getValue());\n\t\t\t},\n\t\t\tfocus : function(textarea, instance) {\n\t\t\t\tinstance && $(textarea).data('ace') && instance.focus();\n\t\t\t},\n\t\t\tresize : function(textarea, instance, e, data) {\n\t\t\t\tinstance && instance.resize();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// CodeMirror\n\t\t\t// called on initialization of elFinder cmd edit (this: this editor's config object)\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.ltIE10 || !fm.options.cdns.codemirror) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// `mimes` is not set for support everything kind of text file\n\t\t\tinfo : {\n\t\t\t\tid : 'codemirror',\n\t\t\t\tname : 'CodeMirror',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -176'\n\t\t\t},\n\t\t\tload : function(textarea) {\n\t\t\t\tvar fm = this.fm,\n\t\t\t\t\tcmUrl = fm.convAbsUrl(fm.options.cdns.codemirror),\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tself = this,\n\t\t\t\t\tstart = function(CodeMirror) {\n\t\t\t\t\t\tvar ta   = $(textarea),\n\t\t\t\t\t\t\tbase = ta.parent(),\n\t\t\t\t\t\t\teditor, editorBase, opts;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// set base height\n\t\t\t\t\t\tbase.height(base.height());\n\t\t\t\t\t\t\n\t\t\t\t\t\t// CodeMirror configure options\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\tlineNumbers: true,\n\t\t\t\t\t\t\tlineWrapping: true,\n\t\t\t\t\t\t\textraKeys : {\n\t\t\t\t\t\t\t\t'Ctrl-S': function() { self.doSave(); },\n\t\t\t\t\t\t\t\t'Ctrl-Q': function() { self.doCancel(); },\n\t\t\t\t\t\t\t\t'Ctrl-W': function() { self.doCancel(); }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\t\teditorObj: CodeMirror,\n\t\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// CodeMirror configure\n\t\t\t\t\t\teditor = CodeMirror.fromTextArea(textarea, opts);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// return editor instance\n\t\t\t\t\t\tdfrd.resolve(editor);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Auto mode set\n\t\t\t\t\t\tvar info, m, mode, spec;\n\t\t\t\t\t\tif (! info) {\n\t\t\t\t\t\t\tinfo = CodeMirror.findModeByMIME(self.file.mime);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (! info && (m = self.file.name.match(/.+\\.([^.]+)$/))) {\n\t\t\t\t\t\t\tinfo = CodeMirror.findModeByExtension(m[1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (info) {\n\t\t\t\t\t\t\tCodeMirror.modeURL = useRequire? 'codemirror/mode/%N/%N.min' : cmUrl + '/mode/%N/%N.min.js';\n\t\t\t\t\t\t\tmode = info.mode;\n\t\t\t\t\t\t\tspec = info.mime;\n\t\t\t\t\t\t\teditor.setOption('mode', spec);\n\t\t\t\t\t\t\tCodeMirror.autoLoadMode(editor, mode);\n\t\t\t\t\t\t\t// show MIME:mode in title bar\n\t\t\t\t\t\t\tbase.prev().children('.elfinder-dialog-title').append(' (' + spec + (mode != 'null'? ' : ' + mode : '') + ')');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// editor base node\n\t\t\t\t\t\teditorBase = $(editor.getWrapperElement()).css({\n\t\t\t\t\t\t\t// fix CSS conflict to SimpleMDE\n\t\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\t\tborder: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tta.data('cm', true);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// fit height to base\n\t\t\t\t\t\teditorBase.height('100%');\n\t\t\t\t\t\t\n\t\t\t\t\t\t// TextArea button and Setting button\n\t\t\t\t\t\t$('<div class=\"ui-dialog-buttonset\"/>').css('float', 'left')\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\t$('<button/>').html(self.fm.i18n('TextArea'))\n\t\t\t\t\t\t\t.button()\n\t\t\t\t\t\t\t.on('click', function(){\n\t\t\t\t\t\t\t\tif (ta.data('cm')) {\n\t\t\t\t\t\t\t\t\tta.removeData('cm');\n\t\t\t\t\t\t\t\t\teditorBase.hide();\n\t\t\t\t\t\t\t\t\tta.val(editor.getValue()).show().trigger('focus');\n\t\t\t\t\t\t\t\t\t$(this).text('CodeMirror');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tta.data('cm', true);\n\t\t\t\t\t\t\t\t\teditorBase.show();\n\t\t\t\t\t\t\t\t\teditor.setValue(ta.hide().val());\n\t\t\t\t\t\t\t\t\teditor.refresh();\n\t\t\t\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t\t\t\t\t$(this).html(self.fm.i18n('TextArea'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.prependTo(base.next());\n\t\t\t\t\t};\n\t\t\t\t// load script then start\n\t\t\t\tif (!self.confObj.loader) {\n\t\t\t\t\tself.confObj.loader = $.Deferred();\n\t\t\t\t\tif (useRequire) {\n\t\t\t\t\t\trequire.config({\n\t\t\t\t\t\t\tpackages: [{\n\t\t\t\t\t\t\t\tname: 'codemirror',\n\t\t\t\t\t\t\t\tlocation: cmUrl,\n\t\t\t\t\t\t\t\tmain: 'codemirror.min'\n\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\tmap: {\n\t\t\t\t\t\t\t\t'codemirror': {\n\t\t\t\t\t\t\t\t\t'codemirror/lib/codemirror': 'codemirror'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\trequire([\n\t\t\t\t\t\t\t'codemirror',\n\t\t\t\t\t\t\t'codemirror/addon/mode/loadmode.min',\n\t\t\t\t\t\t\t'codemirror/mode/meta.min'\n\t\t\t\t\t\t], function(CodeMirror) {\n\t\t\t\t\t\t\tself.confObj.loader.resolve(CodeMirror);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.fm.loadScript([\n\t\t\t\t\t\t\tcmUrl + '/codemirror.min.js'\n\t\t\t\t\t\t], function() {\n\t\t\t\t\t\t\tself.fm.loadScript([\n\t\t\t\t\t\t\t\tcmUrl + '/addon/mode/loadmode.min.js',\n\t\t\t\t\t\t\t\tcmUrl + '/mode/meta.min.js'\n\t\t\t\t\t\t\t], function() {\n\t\t\t\t\t\t\t\tself.confObj.loader.resolve(CodeMirror);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, {loadType: 'tag'});\n\t\t\t\t\t}\n\t\t\t\t\tself.fm.loadCss(cmUrl + '/codemirror.css');\n\t\t\t\t}\n\t\t\t\tself.confObj.loader.done(start);\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tclose : function(textarea, instance) {\n\t\t\t\tinstance && instance.toTextArea();\n\t\t\t},\n\t\t\tsave : function(textarea, instance) {\n\t\t\t\tinstance && $(textarea).data('cm') && (textarea.value = instance.getValue());\n\t\t\t},\n\t\t\tfocus : function(textarea, instance) {\n\t\t\t\tinstance && $(textarea).data('cm') && instance.focus();\n\t\t\t},\n\t\t\tresize : function(textarea, instance, e, data) {\n\t\t\t\tinstance && instance.refresh();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// SimpleMDE\n\t\t\t// called on initialization of elFinder cmd edit (this: this editor's config object)\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.ltIE10 || !fm.options.cdns.simplemde) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\tinfo : {\n\t\t\t\tid : 'simplemde',\n\t\t\t\tname : 'SimpleMDE',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -80'\n\t\t\t},\n\t\t\texts  : ['md'],\n\t\t\tload : function(textarea) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tbase = $(textarea).parent(),\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tcdn  = fm.options.cdns.simplemde,\n\t\t\t\t\tstart = function(SimpleMDE) {\n\t\t\t\t\t\tvar h\t = base.height(),\n\t\t\t\t\t\t\tdelta = base.outerHeight(true) - h + 14,\n\t\t\t\t\t\t\teditor, editorBase, opts;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// fit height function\n\t\t\t\t\t\ttextarea._setHeight = function(height) {\n\t\t\t\t\t\t\tvar h\t= height || base.height(),\n\t\t\t\t\t\t\t\tctrH = 0,\n\t\t\t\t\t\t\t\tareaH;\n\t\t\t\t\t\t\tbase.children('.editor-toolbar,.editor-statusbar').each(function() {\n\t\t\t\t\t\t\t\tctrH += $(this).outerHeight(true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tareaH = h - ctrH - delta;\n\t\t\t\t\t\t\teditorBase.height(areaH);\n\t\t\t\t\t\t\teditor.codemirror.refresh();\n\t\t\t\t\t\t\treturn areaH;\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\t// set base height\n\t\t\t\t\t\tbase.height(h);\n\t\t\t\t\t\t\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\telement: textarea,\n\t\t\t\t\t\t\tautofocus: true\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\t\teditorObj: SimpleMDE,\n\t\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// make editor\n\t\t\t\t\t\teditor = new SimpleMDE(opts);\n\t\t\t\t\t\tdfrd.resolve(editor);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// editor base node\n\t\t\t\t\t\teditorBase = $(editor.codemirror.getWrapperElement());\n\t\t\t\t\t\t\n\t\t\t\t\t\t// fit height to base\n\t\t\t\t\t\teditorBase.css('min-height', '50px')\n\t\t\t\t\t\t\t.children('.CodeMirror-scroll').css('min-height', '50px');\n\t\t\t\t\t\ttextarea._setHeight(h);\n\t\t\t\t\t};\n\n\t\t\t\t// check SimpleMDE & start\n\t\t\t\tif (!self.confObj.loader) {\n\t\t\t\t\tself.confObj.loader = $.Deferred();\n\t\t\t\t\tself.fm.loadCss(cdn+'/simplemde.min.css');\n\t\t\t\t\tif (useRequire) {\n\t\t\t\t\t\trequire([\n\t\t\t\t\t\t\tcdn+'/simplemde.min.js'\n\t\t\t\t\t\t], function(SimpleMDE) {\n\t\t\t\t\t\t\tself.confObj.loader.resolve(SimpleMDE);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.fm.loadScript([cdn+'/simplemde.min.js'], function() {\n\t\t\t\t\t\t\tself.confObj.loader.resolve(SimpleMDE);\n\t\t\t\t\t\t}, {loadType: 'tag'});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tself.confObj.loader.done(start);\n\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tclose : function(textarea, instance) {\n\t\t\t\tinstance && instance.toTextArea();\n\t\t\t\tinstance = null;\n\t\t\t},\n\t\t\tsave : function(textarea, instance) {\n\t\t\t\tinstance && (textarea.value = instance.value());\n\t\t\t},\n\t\t\tfocus : function(textarea, instance) {\n\t\t\t\tinstance && instance.codemirror.focus();\n\t\t\t},\n\t\t\tresize : function(textarea, instance, e, data) {\n\t\t\t\tinstance && textarea._setHeight();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// CKEditor for html file\n\t\t\tinfo : {\n\t\t\t\tid : 'ckeditor',\n\t\t\t\tname : 'CKEditor',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 0'\n\t\t\t},\n\t\t\texts  : ['htm', 'html', 'xhtml'],\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tvar confObj = this;\n\t\t\t\tif (!fm.options.cdns.ckeditor) {\n\t\t\t\t\tconfObj.disabled = true;\n\t\t\t\t} else {\n\t\t\t\t\tconfObj.ckeOpts = {};\n\t\t\t\t\tif (opts.extraOptions) {\n\t\t\t\t\t\tconfObj.ckeOpts = Object.assign({}, opts.extraOptions.ckeditor || {});\n\t\t\t\t\t\tif (opts.extraOptions.managerUrl) {\n\t\t\t\t\t\t\tconfObj.managerUrl = opts.extraOptions.managerUrl;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tload : function(textarea) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tinit = function() {\n\t\t\t\t\t\tvar base = $(textarea).parent(),\n\t\t\t\t\t\t\tdlg = base.closest('.elfinder-dialog'),\n\t\t\t\t\t\t\th = base.height(),\n\t\t\t\t\t\t\treg = /([&?]getfile=)[^&]+/,\n\t\t\t\t\t\t\tloc = self.confObj.managerUrl || window.location.href.replace(/#.*$/, ''),\n\t\t\t\t\t\t\tname = 'ckeditor',\n\t\t\t\t\t\t\topts;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// make manager location\n\t\t\t\t\t\tif (reg.test(loc)) {\n\t\t\t\t\t\t\tloc = loc.replace(reg, '$1' + name);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tloc += '?getfile=' + name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// set base height\n\t\t\t\t\t\tbase.height(h);\n\n\t\t\t\t\t\t// CKEditor configure options\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\tstartupFocus : true,\n\t\t\t\t\t\t\tfullPage: true,\n\t\t\t\t\t\t\tallowedContent: true,\n\t\t\t\t\t\t\tfilebrowserBrowseUrl : loc,\n\t\t\t\t\t\t\ttoolbarCanCollapse: true,\n\t\t\t\t\t\t\ttoolbarStartupExpanded: !fm.UA.Mobile,\n\t\t\t\t\t\t\tremovePlugins: 'resize',\n\t\t\t\t\t\t\textraPlugins: 'colorbutton,justify,docprops',\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t'instanceReady' : function(e) {\n\t\t\t\t\t\t\t\t\tvar editor = e.editor;\n\t\t\t\t\t\t\t\t\teditor.resize('100%', h);\n\t\t\t\t\t\t\t\t\t// re-build on dom move\n\t\t\t\t\t\t\t\t\tdlg.one('beforedommove.'+fm.namespace, function() {\n\t\t\t\t\t\t\t\t\t\teditor.destroy();\n\t\t\t\t\t\t\t\t\t}).one('dommove.'+fm.namespace, function() {\n\t\t\t\t\t\t\t\t\t\tself.load(textarea).done(function(editor) {\n\t\t\t\t\t\t\t\t\t\t\tself.instance = editor;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t// return editor instance\n\t\t\t\t\t\t\t\t\tdfrd.resolve(e.editor);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\t\teditorObj: CKEDITOR,\n\t\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// CKEditor configure\n\t\t\t\t\t\tCKEDITOR.replace(textarea.id, Object.assign(opts, self.confObj.ckeOpts));\n\t\t\t\t\t\tCKEDITOR.on('dialogDefinition', function(e) {\n\t\t\t\t\t\t\tvar dlg = e.data.definition.dialog;\n\t\t\t\t\t\t\tdlg.on('show', function(e) {\n\t\t\t\t\t\t\t\tfm.getUI().append($('.cke_dialog_background_cover')).append(this.getElement().$);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tdlg.on('hide', function(e) {\n\t\t\t\t\t\t\t\t$('body:first').append($('.cke_dialog_background_cover')).append(this.getElement().$);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\tif (!self.confObj.loader) {\n\t\t\t\t\tself.confObj.loader = $.Deferred();\n\t\t\t\t\twindow.CKEDITOR_BASEPATH = fm.options.cdns.ckeditor + '/';\n\t\t\t\t\t$.getScript(fm.options.cdns.ckeditor + '/ckeditor.js', function() {\n\t\t\t\t\t\tself.confObj.loader.resolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tself.confObj.loader.done(init);\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tclose : function(textarea, instance) {\n\t\t\t\tinstance && instance.destroy();\n\t\t\t},\n\t\t\tsave : function(textarea, instance) {\n\t\t\t\tinstance && (textarea.value = instance.getData());\n\t\t\t},\n\t\t\tfocus : function(textarea, instance) {\n\t\t\t\tinstance && instance.focus();\n\t\t\t},\n\t\t\tresize : function(textarea, instance, e, data) {\n\t\t\t\tvar self;\n\t\t\t\tif (instance) {\n\t\t\t\t\tif (instance.status === 'ready') {\n\t\t\t\t\t\tinstance.resize('100%', $(textarea).parent().height());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// CKEditor5 balloon mode for html file\n\t\t\tinfo : {\n\t\t\t\tid : 'ckeditor5',\n\t\t\t\tname : 'CKEditor5',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -16'\n\t\t\t},\n\t\t\texts : ['htm', 'html', 'xhtml'],\n\t\t\thtml : '<div class=\"edit-editor-ckeditor5\"></div>',\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tvar confObj = this;\n\t\t\t\t// check cdn and ES6 support\n\t\t\t\tif (!fm.options.cdns.ckeditor5 || typeof window.Symbol !== 'function' || typeof Symbol() !== 'symbol') {\n\t\t\t\t\tconfObj.disabled = true;\n\t\t\t\t} else {\n\t\t\t\t\tconfObj.ckeOpts = {};\n\t\t\t\t\tif (opts.extraOptions) {\n\t\t\t\t\t\t// @deprecated option extraOptions.ckeditor5Mode\n\t\t\t\t\t\tif (opts.extraOptions.ckeditor5Mode) {\n\t\t\t\t\t\t\tconfObj.ckeditor5Mode = opts.extraOptions.ckeditor5Mode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconfObj.ckeOpts = Object.assign({}, opts.extraOptions.ckeditor5 || {});\n\t\t\t\t\t\tif (confObj.ckeOpts.mode) {\n\t\t\t\t\t\t\tconfObj.ckeditor5Mode = confObj.ckeOpts.mode;\n\t\t\t\t\t\t\tdelete confObj.ckeOpts.mode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (opts.extraOptions.managerUrl) {\n\t\t\t\t\t\t\tconfObj.managerUrl = opts.extraOptions.managerUrl;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfm.bind('destroy', function() {\n\t\t\t\t\tconfObj.editor = null;\n\t\t\t\t});\n\t\t\t},\n\t\t\t// Prepare on before show dialog\n\t\t\tprepare : function(base, dialogOpts, file) {\n\t\t\t\t$(base).height(base.editor.fm.getUI().height() - 100);\n\t\t\t},\n\t\t\tinit : function(id, file, data, fm) {\n\t\t\t\tvar m = data.match(/^([\\s\\S]*<body[^>]*>)([\\s\\S]+)(<\\/body>[\\s\\S]*)$/i),\n\t\t\t\t\theader = '',\n\t\t\t\t\tbody = '',\n\t\t\t\t\tfooter ='';\n\t\t\t\tthis.css({\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: '100%',\n\t\t\t\t\t'box-sizing': 'border-box'\n\t\t\t\t});\n\t\t\t\tif (m) {\n\t\t\t\t\theader = m[1];\n\t\t\t\t\tbody = m[2];\n\t\t\t\t\tfooter = m[3];\n\t\t\t\t} else {\n\t\t\t\t\tbody = data;\n\t\t\t\t}\n\t\t\t\tthis.data('data', {\n\t\t\t\t\theader: header,\n\t\t\t\t\tbody: body,\n\t\t\t\t\tfooter: footer\n\t\t\t\t});\n\t\t\t\tthis._setupSelEncoding(data);\n\t\t\t},\n\t\t\tload : function(editnode) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tmode = self.confObj.ckeditor5Mode || 'decoupled-document',\n\t\t\t\t\tlang = (function() {\n\t\t\t\t\t\tvar l = fm.lang.toLowerCase().replace('_', '-');\n\t\t\t\t\t\tif (l.substr(0, 2) === 'zh' && l !== 'zh-cn') {\n\t\t\t\t\t\t\tl = 'zh';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn l;\n\t\t\t\t\t})(),\n\t\t\t\t\tinit = function(cEditor) {\n\t\t\t\t\t\tvar base = $(editnode).parent(),\n\t\t\t\t\t\t\topts;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// set base height\n\t\t\t\t\t\tbase.height(fm.getUI().height() - 100);\n\n\t\t\t\t\t\t// CKEditor5 configure options\n\t\t\t\t\t\topts = Object.assign({\n\t\t\t\t\t\t\ttoolbar: [\"heading\", \"|\", \"fontSize\", \"fontFamily\", \"|\", \"bold\", \"italic\", \"underline\", \"strikethrough\", \"highlight\", \"|\", \"alignment\", \"|\", \"numberedList\", \"bulletedList\", \"blockQuote\", \"indent\", \"outdent\", \"|\", \"ckfinder\", \"link\", \"imageUpload\", \"insertTable\", \"mediaEmbed\", \"|\", \"undo\", \"redo\"],\n\t\t\t\t\t\t\tlanguage: lang\n\t\t\t\t\t\t}, self.confObj.ckeOpts);\n\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: editnode,\n\t\t\t\t\t\t\teditorObj: cEditor,\n\t\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcEditor\n\t\t\t\t\t\t\t.create(editnode, opts)\n\t\t\t\t\t\t\t.then(function(editor) {\n\t\t\t\t\t\t\t\tvar ckf = editor.commands.get('ckfinder'),\n\t\t\t\t\t\t\t\t\tfileRepo = editor.plugins.get('FileRepository'),\n\t\t\t\t\t\t\t\t\tprevVars = {}, isImage, insertImages;\n\t\t\t\t\t\t\t\tif (editor.ui.view.toolbar && (mode === 'classic' || mode === 'decoupled-document')) {\n\t\t\t\t\t\t\t\t\t$(editnode).closest('.elfinder-dialog').children('.ui-widget-header').append($(editor.ui.view.toolbar.element).css({marginRight:'-1em',marginLeft:'-1em'}));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (mode === 'classic') {\n\t\t\t\t\t\t\t\t\t$(editnode).closest('.elfinder-edit-editor').css('overflow', 'auto');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Set up this elFinder instead of CKFinder\n\t\t\t\t\t\t\t\tif (ckf) {\n\t\t\t\t\t\t\t\t\tisImage = function(f) {\n\t\t\t\t\t\t\t\t\t\treturn f && f.mime.match(/^image\\//i);\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\tinsertImages = function(urls) {\n\t\t\t\t\t\t\t\t\t\tvar imgCmd = editor.commands.get('imageUpload');\n\t\t\t\t\t\t\t\t\t\tif (!imgCmd.isEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tvar ntf = editor.plugins.get('Notification'),\n\t\t\t\t\t\t\t\t\t\t\t\ti18 = editor.locale.t;\n\t\t\t\t\t\t\t\t\t\t\tntf.showWarning(i18('Could not insert image at the current position.'), {\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: i18('Inserting image failed'),\n\t\t\t\t\t\t\t\t\t\t\t\tnamespace: 'ckfinder'\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\teditor.execute('imageInsert', { source: urls });\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t// Take over ckfinder execute()\n\t\t\t\t\t\t\t\t\tckf.execute = function() {\n\t\t\t\t\t\t\t\t\t\tvar dlg = base.closest('.elfinder-dialog'),\n\t\t\t\t\t\t\t\t\t\t\tgf = fm.getCommand('getfile'),\n\t\t\t\t\t\t\t\t\t\t\trever = function() {\n\t\t\t\t\t\t\t\t\t\t\t\tif (prevVars.hasVar) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdlg.off('resize close', rever);\n\t\t\t\t\t\t\t\t\t\t\t\t\tgf.callback = prevVars.callback;\n\t\t\t\t\t\t\t\t\t\t\t\t\tgf.options.folders = prevVars.folders;\n\t\t\t\t\t\t\t\t\t\t\t\t\tgf.options.multiple = prevVars.multi;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.commandMap.open = prevVars.open;\n\t\t\t\t\t\t\t\t\t\t\t\t\tprevVars.hasVar = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tdlg.trigger('togleminimize').one('resize close', rever);\n\t\t\t\t\t\t\t\t\t\tprevVars.callback = gf.callback;\n\t\t\t\t\t\t\t\t\t\tprevVars.folders = gf.options.folders;\n\t\t\t\t\t\t\t\t\t\tprevVars.multi = gf.options.multiple;\n\t\t\t\t\t\t\t\t\t\tprevVars.open = fm.commandMap.open;\n\t\t\t\t\t\t\t\t\t\tprevVars.hasVar = true;\n\t\t\t\t\t\t\t\t\t\tgf.callback = function(files) {\n\t\t\t\t\t\t\t\t\t\t\tvar imgs = [];\n\t\t\t\t\t\t\t\t\t\t\tif (files.length === 1 && files[0].mime === 'directory') {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.one('open', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfm.commandMap.open = 'getfile';\n\t\t\t\t\t\t\t\t\t\t\t\t}).getCommand('open').exec(files[0].hash);\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tfm.getUI('cwd').trigger('unselectall');\n\t\t\t\t\t\t\t\t\t\t\t$.each(files, function(i, f) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (isImage(f)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\timgs.push(fm.convAbsUrl(f.url));\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditor.execute('link', fm.convAbsUrl(f.url));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tif (imgs.length) {\n\t\t\t\t\t\t\t\t\t\t\t\tinsertImages(imgs);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdlg.trigger('togleminimize');\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tgf.options.folders = true;\n\t\t\t\t\t\t\t\t\t\tgf.options.multiple = true;\n\t\t\t\t\t\t\t\t\t\tfm.commandMap.open = 'getfile';\n\t\t\t\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\t\t\t\tmode: 'info',\n\t\t\t\t\t\t\t\t\t\t\tmsg: fm.i18n('dblclickToSelect')\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Set up image uploader\n\t\t\t\t\t\t\t\tfileRepo.createUploadAdapter = function(loader) {\n\t\t\t\t\t\t\t\t\treturn new uploder(loader);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\teditor.setData($(editnode).data('data').body);\n\t\t\t\t\t\t\t\t// move .ck-body to elFinder node for fullscreen mode\n\t\t\t\t\t\t\t\tfm.getUI().append($('body > div.ck-body'));\n\t\t\t\t\t\t\t\t$('div.ck-balloon-panel').css({\n\t\t\t\t\t\t\t\t\t'z-index': fm.getMaximizeCss().zIndex + 1\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tdfrd.resolve(editor);\n\t\t\t\t\t\t\t\t/*fm.log({\n\t\t\t\t\t\t\t\t\tdefaultConfig: cEditor.defaultConfig,\n\t\t\t\t\t\t\t\t\tplugins: cEditor.builtinPlugins.map(function(p) { return p.pluginName; }),\n\t\t\t\t\t\t\t\t\ttoolbars: Array.from(editor.ui.componentFactory.names())\n\t\t\t\t\t\t\t\t});*/\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t['catch'](function(error) { // ['cache'] instead .cache for fix error on ie8 \n\t\t\t\t\t\t\t\tfm.error(error);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tuploder = function(loader) {\n\t\t\t\t\t\tvar upload = function(file, resolve, reject) {\n\t\t\t\t\t\t\tfm.exec('upload', {files: [file]}, void(0), fm.cwd().hash)\n\t\t\t\t\t\t\t\t.done(function(data){\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tfm.url(data.added[0].hash, { async: true }).done(function(url) {\n\t\t\t\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\t\t\t\t'default': fm.convAbsUrl(url)\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\t\treject('errFileNotFound');\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treject(fm.i18n(data.error? data.error : 'errUpload'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.fail(function(err) {\n\t\t\t\t\t\t\t\t\tvar error = fm.parseError(err);\n\t\t\t\t\t\t\t\t\treject(fm.i18n(error? (error === 'userabort'? 'errAbort' : error) : 'errUploadNoFiles'));\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.progress(function(data) {\n\t\t\t\t\t\t\t\t\tloader.uploadTotal = data.total;\n\t\t\t\t\t\t\t\t\tloader.uploaded = data.progress;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.upload = function() {\n\t\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\t\t\t\tif (loader.file instanceof Promise || (loader.file && typeof loader.file.then === 'function')) {\n\t\t\t\t\t\t\t\t\tloader.file.then(function(file) {\n\t\t\t\t\t\t\t\t\t\tupload(file, resolve, reject);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tupload(loader.file, resolve, reject);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.abort = function() {\n\t\t\t\t\t\t\tfm.getUI().trigger('uploadabort');\n\t\t\t\t\t\t};\n\t\t\t\t\t}, loader;\n\n\t\t\t\tif (!self.confObj.editor) {\n\t\t\t\t\tloader = $.Deferred();\n\t\t\t\t\tself.fm.loadScript([\n\t\t\t\t\t\tfm.options.cdns.ckeditor5 + '/' + mode + '/ckeditor.js'\n\t\t\t\t\t], function(editor) {\n\t\t\t\t\t\tif (!editor) {\n\t\t\t\t\t\t\teditor = window.BalloonEditor || window.InlineEditor || window.ClassicEditor || window.DecoupledEditor;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (fm.lang !== 'en') {\n\t\t\t\t\t\t\tself.fm.loadScript([\n\t\t\t\t\t\t\t\tfm.options.cdns.ckeditor5 + '/' + mode + '/translations/' + lang + '.js'\n\t\t\t\t\t\t\t], function(obj) {\n\t\t\t\t\t\t\t\tloader.resolve(editor);\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\t\t\tloadType: 'tag',\n\t\t\t\t\t\t\t\terror: function(obj) {\n\t\t\t\t\t\t\t\t\tlang = 'en';\n\t\t\t\t\t\t\t\t\tloader.resolve(editor);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tloader.resolve(editor);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttryRequire: true,\n\t\t\t\t\t\tloadType: 'tag'\n\t\t\t\t\t});\n\t\t\t\t\tloader.done(function(editor) {\n\t\t\t\t\t\tself.confObj.editor = editor;\n\t\t\t\t\t\tinit(editor);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tinit(self.confObj.editor);\n\t\t\t\t}\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tgetContent : function() {\n\t\t\t\tvar data = $(this).data('data');\n\t\t\t\treturn data.header + data.body + data.footer;\n\t\t\t},\n\t\t\tclose : function(editnode, instance) {\n\t\t\t\tinstance && instance.destroy();\n\t\t\t},\n\t\t\tsave : function(editnode, instance) {\n\t\t\t\tvar elm = $(editnode),\n\t\t\t\t\tdata = elm.data('data');\n\t\t\t\tif (instance) {\n\t\t\t\t\tdata.body = instance.getData();\n\t\t\t\t\telm.data('data', data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfocus : function(editnode, instance) {\n\t\t\t\t$(editnode).trigger('focus');\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// TinyMCE for html file\n\t\t\tinfo : {\n\t\t\t\tid : 'tinymce',\n\t\t\t\tname : 'TinyMCE',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -64'\n\t\t\t},\n\t\t\texts  : ['htm', 'html', 'xhtml'],\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tvar confObj = this;\n\t\t\t\tif (!fm.options.cdns.tinymce) {\n\t\t\t\t\tconfObj.disabled = true;\n\t\t\t\t} else {\n\t\t\t\t\tconfObj.mceOpts = {};\n\t\t\t\t\tif (opts.extraOptions) {\n\t\t\t\t\t\tconfObj.uploadOpts = Object.assign({}, opts.extraOptions.uploadOpts || {});\n\t\t\t\t\t\tconfObj.mceOpts = Object.assign({}, opts.extraOptions.tinymce || {});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconfObj.uploadOpts = {};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tload : function(textarea) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tfm   = this.fm,\n\t\t\t\t\tdfrd = $.Deferred(),\n\t\t\t\t\tinit = function() {\n\t\t\t\t\t\tvar base = $(textarea).show().parent(),\n\t\t\t\t\t\t\tdlg = base.closest('.elfinder-dialog'),\n\t\t\t\t\t\t\th = base.height(),\n\t\t\t\t\t\t\tdelta = base.outerHeight(true) - h,\n\t\t\t\t\t\t\t// hide MCE dialog and modal block\n\t\t\t\t\t\t\thideMceDlg = function() {\n\t\t\t\t\t\t\t\tvar mceW;\n\t\t\t\t\t\t\t\tif (tinymce.activeEditor.windowManager.windows) {\n\t\t\t\t\t\t\t\t\tmceW = tinymce.activeEditor.windowManager.windows[0];\n\t\t\t\t\t\t\t\t\tmceDlg = $(mceW? mceW.getEl() : void(0)).hide();\n\t\t\t\t\t\t\t\t\tmceCv = $('#mce-modal-block').hide();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tmceDlg = $('.tox-dialog-wrap').hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t// Show MCE dialog and modal block\n\t\t\t\t\t\t\tshowMceDlg = function() {\n\t\t\t\t\t\t\t\tmceCv && mceCv.show();\n\t\t\t\t\t\t\t\tmceDlg && mceDlg.show();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttVer = tinymce.majorVersion,\n\t\t\t\t\t\t\topts, mceDlg, mceCv;\n\n\t\t\t\t\t\t// set base height\n\t\t\t\t\t\tbase.height(h);\n\t\t\t\t\t\t// fit height function\n\t\t\t\t\t\ttextarea._setHeight = function(height) {\n\t\t\t\t\t\t\tif (tVer < 5) {\n\t\t\t\t\t\t\t\tvar base = $(this).parent(),\n\t\t\t\t\t\t\t\t\th = height || base.innerHeight(),\n\t\t\t\t\t\t\t\t\tctrH = 0,\n\t\t\t\t\t\t\t\t\tareaH;\n\t\t\t\t\t\t\t\tbase.find('.mce-container-body:first').children('.mce-top-part,.mce-statusbar').each(function() {\n\t\t\t\t\t\t\t\t\tctrH += $(this).outerHeight(true);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tareaH = h - ctrH - delta;\n\t\t\t\t\t\t\t\tbase.find('.mce-edit-area iframe:first').height(areaH);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// TinyMCE configure options\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\tselector: '#' + textarea.id,\n\t\t\t\t\t\t\tresize: false,\n\t\t\t\t\t\t\tplugins: 'print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help',\n\t\t\t\t\t\t\ttoolbar: 'formatselect | bold italic strikethrough forecolor backcolor | link image media | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat',\n\t\t\t\t\t\t\timage_advtab: true,\n\t\t\t\t\t\t\tinit_instance_callback : function(editor) {\n\t\t\t\t\t\t\t\t// fit height on init\n\t\t\t\t\t\t\t\ttextarea._setHeight(h);\n\t\t\t\t\t\t\t\t// re-build on dom move\n\t\t\t\t\t\t\t\tdlg.one('beforedommove.'+fm.namespace, function() {\n\t\t\t\t\t\t\t\t\ttinymce.execCommand('mceRemoveEditor', false, textarea.id);\n\t\t\t\t\t\t\t\t}).one('dommove.'+fm.namespace, function() {\n\t\t\t\t\t\t\t\t\tself.load(textarea).done(function(editor) {\n\t\t\t\t\t\t\t\t\t\tself.instance = editor;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t// return editor instance\n\t\t\t\t\t\t\t\tdfrd.resolve(editor);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfile_picker_callback : function (callback, value, meta) {\n\t\t\t\t\t\t\t\tvar gf = fm.getCommand('getfile'),\n\t\t\t\t\t\t\t\t\trevar = function() {\n\t\t\t\t\t\t\t\t\t\tif (prevVars.hasVar) {\n\t\t\t\t\t\t\t\t\t\t\tgf.callback = prevVars.callback;\n\t\t\t\t\t\t\t\t\t\t\tgf.options.folders = prevVars.folders;\n\t\t\t\t\t\t\t\t\t\t\tgf.options.multiple = prevVars.multi;\n\t\t\t\t\t\t\t\t\t\t\tfm.commandMap.open = prevVars.open;\n\t\t\t\t\t\t\t\t\t\t\tprevVars.hasVar = false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdlg.off('resize close', revar);\n\t\t\t\t\t\t\t\t\t\tshowMceDlg();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tprevVars = {};\n\t\t\t\t\t\t\t\tprevVars.callback = gf.callback;\n\t\t\t\t\t\t\t\tprevVars.folders = gf.options.folders;\n\t\t\t\t\t\t\t\tprevVars.multi = gf.options.multiple;\n\t\t\t\t\t\t\t\tprevVars.open = fm.commandMap.open;\n\t\t\t\t\t\t\t\tprevVars.hasVar = true;\n\t\t\t\t\t\t\t\tgf.callback = function(file) {\n\t\t\t\t\t\t\t\t\tvar url, info;\n\n\t\t\t\t\t\t\t\t\tif (file.mime === 'directory') {\n\t\t\t\t\t\t\t\t\t\tfm.one('open', function() {\n\t\t\t\t\t\t\t\t\t\t\tfm.commandMap.open = 'getfile';\n\t\t\t\t\t\t\t\t\t\t}).getCommand('open').exec(file.hash);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// URL normalization\n\t\t\t\t\t\t\t\t\turl = fm.convAbsUrl(file.url);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Make file info\n\t\t\t\t\t\t\t\t\tinfo = file.name + ' (' + fm.formatSize(file.size) + ')';\n\n\t\t\t\t\t\t\t\t\t// Provide file and text for the link dialog\n\t\t\t\t\t\t\t\t\tif (meta.filetype == 'file') {\n\t\t\t\t\t\t\t\t\t\tcallback(url, {text: info, title: info});\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Provide image and alt text for the image dialog\n\t\t\t\t\t\t\t\t\tif (meta.filetype == 'image') {\n\t\t\t\t\t\t\t\t\t\tcallback(url, {alt: info});\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Provide alternative source and posted for the media dialog\n\t\t\t\t\t\t\t\t\tif (meta.filetype == 'media') {\n\t\t\t\t\t\t\t\t\t\tcallback(url);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdlg.trigger('togleminimize');\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tgf.options.folders = true;\n\t\t\t\t\t\t\t\tgf.options.multiple = false;\n\t\t\t\t\t\t\t\tfm.commandMap.open = 'getfile';\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\thideMceDlg();\n\t\t\t\t\t\t\t\tdlg.trigger('togleminimize').one('resize close', revar);\n\t\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\t\tmode: 'info',\n\t\t\t\t\t\t\t\t\tmsg: fm.i18n('dblclickToSelect')\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\timages_upload_handler : function (blobInfo, success, failure) {\n\t\t\t\t\t\t\t\tvar file = blobInfo.blob(),\n\t\t\t\t\t\t\t\t\terr = function(e) {\n\t\t\t\t\t\t\t\t\t\tvar dlg = e.data.dialog || {};\n\t\t                                if (dlg.hasClass('elfinder-dialog-error') || dlg.hasClass('elfinder-confirm-upload')) {\n\t\t                                    hideMceDlg();\n\t\t                                    dlg.trigger('togleminimize').one('resize close', revert);\n\t\t                                    fm.unbind('dialogopened', err);\n\t\t                                }\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trevert = function() {\n\t\t\t\t\t\t\t\t\t\tdlg.off('resize close', revert);\n\t\t\t\t\t\t\t\t\t\tshowMceDlg();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tclipdata = true;\n\n\t\t\t\t\t\t\t\t// check file object\n\t\t\t\t\t\t\t\tif (file.name) {\n\t\t\t\t\t\t\t\t\t// file blob of client side file object\n\t\t\t\t\t\t\t\t\tclipdata = void(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.bind('dialogopened', err).exec('upload', Object.assign({\n\t\t\t\t\t\t\t\t\tfiles: [file],\n\t\t\t\t\t\t\t\t\tclipdata: clipdata // to get unique name on connector\n\t\t\t\t\t\t\t\t}, self.confObj.uploadOpts), void(0), fm.cwd().hash).done(function(data) {\n\t\t\t\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\t\t\t\tfm.url(data.added[0].hash, { async: true }).done(function(url) {\n\t\t\t\t\t\t\t\t\t\t\tshowMceDlg();\n\t\t\t\t\t\t\t\t\t\t\tsuccess(fm.convAbsUrl(url));\n\t\t\t\t\t\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\t\t\t\t\t\tfailure(fm.i18n('errFileNotFound'));\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tfailure(fm.i18n(data.error? data.error : 'errUpload'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}).fail(function(err) {\n\t\t\t\t\t\t\t\t\tvar error = fm.parseError(err);\n\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\tif (error === 'errUnknownCmd') {\n\t\t\t\t\t\t\t\t\t\t\terror = 'errPerm';\n\t\t\t\t\t\t\t\t\t\t} else if (error === 'userabort') {\n\t\t\t\t\t\t\t\t\t\t\terror = 'errAbort';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfailure(fm.i18n(error? error : 'errUploadNoFiles'));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// TinyMCE 5 supports \"height: 100%\"\n\t\t\t\t\t\tif (tVer >= 5) {\n\t\t\t\t\t\t\topts.height = '100%';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tself.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: textarea,\n\t\t\t\t\t\t\teditorObj: tinymce,\n\t\t\t\t\t\t\tinstance: void(0),\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// TinyMCE configure\n\t\t\t\t\t\ttinymce.init(Object.assign(opts, self.confObj.mceOpts));\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif (!self.confObj.loader) {\n\t\t\t\t\tself.confObj.loader = $.Deferred();\n\t\t\t\t\tself.fm.loadScript([fm.options.cdns.tinymce + (fm.options.cdns.tinymce.match(/\\.js/)? '' : '/tinymce.min.js')], function() {\n\t\t\t\t\t\tself.confObj.loader.resolve();\n\t\t\t\t\t}, {\n\t\t\t\t\t\tloadType: 'tag'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tself.confObj.loader.done(init);\n\t\t\t\treturn dfrd;\n\t\t\t},\n\t\t\tclose : function(textarea, instance) {\n\t\t\t\tinstance && tinymce.execCommand('mceRemoveEditor', false, textarea.id);\n\t\t\t},\n\t\t\tsave : function(textarea, instance) {\n\t\t\t\tinstance && instance.save();\n\t\t\t},\n\t\t\tfocus : function(textarea, instance) {\n\t\t\t\tinstance && instance.focus();\n\t\t\t},\n\t\t\tresize : function(textarea, instance, e, data) {\n\t\t\t\t// fit height to base node on dialog resize\n\t\t\t\tinstance && textarea._setHeight();\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tinfo : {\n\t\t\t\tid : 'zohoeditor',\n\t\t\t\tname : 'Zoho Editor',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -32',\n\t\t\t\tcmdCheck : 'ZohoOffice',\n\t\t\t\tpreventGet: true,\n\t\t\t\thideButtons: true,\n\t\t\t\tsyncInterval : 15000,\n\t\t\t\tcanMakeEmpty: true,\n\t\t\t\tintegrate: {\n\t\t\t\t\ttitle: 'Zoho Office API',\n\t\t\t\t\tlink: 'https://www.zoho.com/officeapi/'\n\t\t\t\t}\n\t\t\t},\n\t\t\tmimes : [\n\t\t\t\t'application/msword',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n\t\t\t\t//'application/pdf',\n\t\t\t\t'application/vnd.oasis.opendocument.text',\n\t\t\t\t'application/rtf',\n\t\t\t\t'text/html',\n\t\t\t\t'application/vnd.ms-excel',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n\t\t\t\t'application/vnd.oasis.opendocument.spreadsheet',\n\t\t\t\t'application/vnd.sun.xml.calc',\n\t\t\t\t'text/csv',\n\t\t\t\t'text/tab-separated-values',\n\t\t\t\t'application/vnd.ms-powerpoint',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n\t\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.slideshow',\n\t\t\t\t'application/vnd.oasis.opendocument.presentation',\n\t\t\t\t'application/vnd.sun.xml.impress'\n\t\t\t],\n\t\t\thtml : '<iframe style=\"width:100%;max-height:100%;border:none;\"></iframe>',\n\t\t\t// setup on elFinder bootup\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tif (fm.UA.Mobile || fm.UA.ltIE8) {\n\t\t\t\t\tthis.disabled = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\t// Prepare on before show dialog\n\t\t\tprepare : function(base, dialogOpts, file) {\n\t\t\t\tvar elfNode = base.editor.fm.getUI();\n\t\t\t\t$(base).height(elfNode.height());\n\t\t\t\tdialogOpts.width = Math.max(dialogOpts.width || 0, elfNode.width() * 0.8);\n\t\t\t},\n\t\t\t// Initialization of editing node (this: this editors HTML node)\n\t\t\tinit : function(id, file, dum, fm) {\n\t\t\t\tvar ta = this,\n\t\t\t\t\tifm = $(this).hide(),\n\t\t\t\t\tuiToast = fm.getUI('toast'),\n\t\t\t\t\tspnr = $('<div class=\"elfinder-edit-spinner elfinder-edit-zohoeditor\"/>')\n\t\t\t\t\t\t.html('<span class=\"elfinder-spinner-text\">' + fm.i18n('nowLoading') + '</span><span class=\"elfinder-spinner\"/>')\n\t\t\t\t\t\t.appendTo(ifm.parent()),\n\t\t\t\t\tcdata = function() {\n\t\t\t\t\t\tvar data = '';\n\t\t\t\t\t\t$.each(fm.customData, function(key, val) {\n\t\t\t\t\t\t\tdata += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(val);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$(ta).data('xhr', fm.request({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcmd: 'editor',\n\t\t\t\t\t\tname: ta.editor.confObj.info.cmdCheck,\n\t\t\t\t\t\tmethod: 'init',\n\t\t\t\t\t\t'args[target]': file.hash,\n\t\t\t\t\t\t'args[lang]' : fm.lang,\n\t\t\t\t\t\t'args[cdata]' : cdata()\n\t\t\t\t\t},\n\t\t\t\t\tpreventDefault : true\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tvar opts;\n\t\t\t\t\tif (data.zohourl) {\n\t\t\t\t\t\topts = {\n\t\t\t\t\t\t\tcss: {\n\t\t\t\t\t\t\t\theight: '100%'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\t\t\tta.editor.trigger('Prepare', {\n\t\t\t\t\t\t\tnode: ta,\n\t\t\t\t\t\t\teditorObj: void(0),\n\t\t\t\t\t\t\tinstance: ifm,\n\t\t\t\t\t\t\topts: opts\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tifm.attr('src', data.zohourl).show().css(opts.css);\n\t\t\t\t\t\tif (data.warning) {\n\t\t\t\t\t\t\tuiToast.appendTo(ta.closest('.ui-dialog'));\n\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\tmsg: fm.i18n(data.warning),\n\t\t\t\t\t\t\t\tmode: 'warning',\n\t\t\t\t\t\t\t\ttimeOut: 0,\n\t\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\t\tuiToast.children().length === 1 && uiToast.appendTo(fm.getUI());\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tbutton: {\n\t\t\t\t\t\t\t\t\ttext: 'btnYes'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.error && fm.error(data.error);\n\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t}\n\t\t\t\t}).fail(function(error) {\n\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t}).always(function() {\n\t\t\t\t\tspnr.remove();\n\t\t\t\t}));\n\t\t\t},\n\t\t\tload : function() {},\n\t\t\tgetContent : function() {},\n\t\t\tsave : function() {},\n\t\t\t// Before dialog close\n\t\t\tbeforeclose : iframeClose,\n\t\t\t// On dialog closed\n\t\t\tclose : function(ta) {\n\t\t\t\tvar fm = this.fm,\n\t\t\t\t\txhr = $(ta).data('xhr');\n\t\t\t\tif (xhr.state() === 'pending') {\n\t\t\t\t\txhr.reject();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t// Zip Archive with FlySystem\n\t\t\tinfo : {\n\t\t\t\tid : 'ziparchive',\n\t\t\t\tname : 'btnMount',\n\t\t\t\ticonImg : 'img/toolbar.png 0 -416',\n\t\t\t\tcmdCheck : 'ZipArchive',\n\t\t\t\tedit : function(file, editor) {\n\t\t\t\t\tvar fm = this,\n\t\t\t\t\t\tdfrd = $.Deferred();\n\t\t\t\t\tfm.request({\n\t\t\t\t\t\tdata:{\n\t\t\t\t\t\t\tcmd: 'netmount',\n\t\t\t\t\t\t\tprotocol: 'ziparchive',\n\t\t\t\t\t\t\thost: file.hash,\n\t\t\t\t\t\t\tpath: file.phash\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpreventFail: true,\n\t\t\t\t\t\tnotify : {type : 'netmount', cnt : 1, hideCnt : true}\n\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\tvar pdir;\n\t\t\t\t\t\tif (data.added && data.added.length) {\n\t\t\t\t\t\t\tif (data.added[0].phash) {\n\t\t\t\t\t\t\t\tif (pdir = fm.file(data.added[0].phash)) {\n\t\t\t\t\t\t\t\t\tif (! pdir.dirs) {\n\t\t\t\t\t\t\t\t\t\tpdir.dirs = 1;\n\t\t\t\t\t\t\t\t\t\tfm.change({ changed: [ pdir ] });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.one('netmountdone', function() {\n\t\t\t\t\t\t\t\tfm.exec('open', data.added[0].hash);\n\t\t\t\t\t\t\t\tfm.one('opendone', function() {\n\t\t\t\t\t\t\t\t\tdata.toast && fm.toast(data.toast);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdfrd.resolve();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function(error) {\n\t\t\t\t\t\tdfrd.reject(error);\n\t\t\t\t\t});\n\t\t\t\t\treturn dfrd;\n\t\t\t\t}\n\t\t\t},\n\t\t\tmimes : ['application/zip'],\n\t\t\tload : function() {},\n\t\t\tsave : function(){}\n\t\t},\n\t\t{\n\t\t\t// Simple Text (basic textarea editor)\n\t\t\tinfo : {\n\t\t\t\tid : 'textarea',\n\t\t\t\tname : 'TextArea',\n\t\t\t\tuseTextAreaEvent : true\n\t\t\t},\n\t\t\tload : function(textarea) {\n\t\t\t\t// trigger event 'editEditorPrepare'\n\t\t\t\tthis.trigger('Prepare', {\n\t\t\t\t\tnode: textarea,\n\t\t\t\t\teditorObj: void(0),\n\t\t\t\t\tinstance: void(0),\n\t\t\t\t\topts: {}\n\t\t\t\t});\n\t\t\t\ttextarea.setSelectionRange && textarea.setSelectionRange(0, 0);\n\t\t\t\t$(textarea).trigger('focus').show();\n\t\t\t},\n\t\t\tsave : function(){}\n\t\t},\n\t\t{\n\t\t\t// File converter with online-convert.com\n\t\t\tinfo : {\n\t\t\t\tid : 'onlineconvert',\n\t\t\t\tname : 'Online Convert',\n\t\t\t\ticonImg : 'img/editor-icons.png 0 -144',\n\t\t\t\tcmdCheck : 'OnlineConvert',\n\t\t\t\tpreventGet: true,\n\t\t\t\thideButtons: true,\n\t\t\t\tsingle: true,\n\t\t\t\tconverter: true,\n\t\t\t\tcanMakeEmpty: false,\n\t\t\t\tintegrate: {\n\t\t\t\t\ttitle: 'ONLINE-CONVERT.COM',\n\t\t\t\t\tlink: 'https://online-convert.com'\n\t\t\t\t}\n\t\t\t},\n\t\t\tmimes : ['*'],\n\t\t\thtml : '<div style=\"width:100%;max-height:100%;\"></div>',\n\t\t\t// setup on elFinder bootup\n\t\t\tsetup : function(opts, fm) {\n\t\t\t\tvar mOpts = opts.extraOptions.onlineConvert || {maxSize:100,showLink:true};\n\t\t\t\tif (mOpts.maxSize) {\n\t\t\t\t\tthis.info.maxSize = mOpts.maxSize * 1048576;\n\t\t\t\t}\n\t\t\t\tthis.set = Object.assign({\n\t\t\t\t\turl : 'https://%s.online-convert.com%s?external_url=',\n\t\t\t\t\tconv : {\n\t\t\t\t\t\tArchive: {'7Z':{}, 'BZ2':{ext:'bz'}, 'GZ':{}, 'ZIP':{}},\n\t\t\t\t\t\tAudio: {'MP3':{}, 'OGG':{ext:'oga'}, 'WAV':{}, 'WMA':{}, 'AAC':{}, 'AIFF':{ext:'aif'}, 'FLAC':{}, 'M4A':{}, 'MMF':{}, 'OPUS':{ext:'oga'}},\n\t\t\t\t\t\tDocument: {'DOC':{}, 'DOCX':{}, 'HTML':{}, 'ODT':{}, 'PDF':{}, 'PPT':{}, 'PPTX':{}, 'RTF':{}, 'SWF':{}, 'TXT':{}},\n\t\t\t\t\t\teBook: {'AZW3':{ext:'azw'}, 'ePub':{}, 'FB2':{ext:'xml'}, 'LIT':{}, 'LRF':{}, 'MOBI':{}, 'PDB':{}, 'PDF':{},'PDF-eBook':{ext:'pdf'}, 'TCR':{}},\n\t\t\t\t\t\tHash: {'Adler32':{},  'Apache-htpasswd':{}, 'Blowfish':{}, 'CRC32':{}, 'CRC32B':{}, 'Gost':{}, 'Haval128':{},'MD4':{}, 'MD5':{}, 'RIPEMD128':{}, 'RIPEMD160':{}, 'SHA1':{}, 'SHA256':{}, 'SHA384':{}, 'SHA512':{}, 'Snefru':{}, 'Std-DES':{}, 'Tiger128':{}, 'Tiger128-calculator':{}, 'Tiger128-converter':{}, 'Tiger160':{}, 'Tiger192':{}, 'Whirlpool':{}},\n\t\t\t\t\t\tImage: {'BMP':{}, 'EPS':{ext:'ai'}, 'GIF':{}, 'EXR':{}, 'ICO':{}, 'JPG':{}, 'PNG':{}, 'SVG':{}, 'TGA':{}, 'TIFF':{ext:'tif'}, 'WBMP':{}, 'WebP':{}},\n\t\t\t\t\t\tVideo: {'3G2':{}, '3GP':{}, 'AVI':{}, 'FLV':{}, 'HLS':{ext:'m3u8'}, 'MKV':{}, 'MOV':{}, 'MP4':{}, 'MPEG-1':{ext:'mpeg'}, 'MPEG-2':{ext:'mpeg'}, 'OGG':{ext:'ogv'}, 'OGV':{}, 'WebM':{}, 'WMV':{}, 'Android':{link:'/convert-video-for-%s',ext:'mp4'}, 'Blackberry':{link:'/convert-video-for-%s',ext:'mp4'}, 'DPG':{link:'/convert-video-for-%s',ext:'avi'}, 'iPad':{link:'/convert-video-for-%s',ext:'mp4'}, 'iPhone':{link:'/convert-video-for-%s',ext:'mp4'}, 'iPod':{link:'/convert-video-for-%s',ext:'mp4'}, 'Nintendo-3DS':{link:'/convert-video-for-%s',ext:'avi'}, 'Nintendo-DS':{link:'/convert-video-for-%s',ext:'avi'}, 'PS3':{link:'/convert-video-for-%s',ext:'mp4'}, 'Wii':{link:'/convert-video-for-%s',ext:'avi'}, 'Xbox':{link:'/convert-video-for-%s',ext:'wmv'}}\n\t\t\t\t\t},\n\t\t\t\t\tcatExts : {\n\t\t\t\t\t\tHash: 'txt'\n\t\t\t\t\t},\n\t\t\t\t\tlink : '<div class=\"elfinder-edit-onlineconvert-link\"><a href=\"https://www.online-convert.com\" target=\"_blank\"><span class=\"elfinder-button-icon\"></span>ONLINE-CONVERT.COM</a></div>',\n\t\t\t\t\tuseTabs : ($.fn.tabs && !fm.UA.iOS)? true : false // Can't work on iOS, I don't know why.\n\t\t\t\t}, mOpts);\n\t\t\t},\n\t\t\t// Prepare on before show dialog\n\t\t\tprepare : function(base, dialogOpts, file) {\n\t\t\t\tvar elfNode = base.editor.fm.getUI();\n\t\t\t\t$(base).height(elfNode.height());\n\t\t\t\tdialogOpts.width = Math.max(dialogOpts.width || 0, elfNode.width() * 0.8);\n\t\t\t},\n\t\t\t// Initialization of editing node (this: this editors HTML node)\n\t\t\tinit : function(id, file, dum, fm) {\n\t\t\t\tvar ta = this,\n\t\t\t\t\tconfObj = ta.editor.confObj,\n\t\t\t\t\tset = confObj.set,\n\t\t\t\t\tuiToast = fm.getUI('toast'),\n\t\t\t\t\tidxs = {},\n\t\t\t\t\tallowZip = fm.uploadMimeCheck('application/zip', file.phash),\n\t\t\t\t\tselfUrl = $('base').length? document.location.href.replace(/#.*$/, '') : '',\n\t\t\t\t\tgetExt = function(cat, con) {\n\t\t\t\t\t\tvar c;\n\t\t\t\t\t\tif (set.catExts[cat]) {\n\t\t\t\t\t\t\treturn set.catExts[cat];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (set.conv[cat] && (c = set.conv[cat][con])) {\n\t\t\t\t\t\t\treturn (c.ext || con).toLowerCase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn con.toLowerCase();\n\t\t\t\t\t},\n\t\t\t\t\tsetOptions = function(cat, done) {\n\t\t\t\t\t\tvar type, dfdInit, dfd;\n\t\t\t\t\t\tif (typeof confObj.api === 'undefined') {\n\t\t\t\t\t\t\tdfdInit = fm.request({\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tcmd: 'editor',\n\t\t\t\t\t\t\t\t\tname: 'OnlineConvert',\n\t\t\t\t\t\t\t\t\tmethod: 'init'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdfdInit = $.Deferred().resolve({api: confObj.api});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcat = cat.toLowerCase();\n\t\t\t\t\t\tdfdInit.done(function(data) {\n\t\t\t\t\t\t\tconfObj.api = data.api;\n\t\t\t\t\t\t\tif (confObj.api) {\n\t\t\t\t\t\t\t\tif (cat) {\n\t\t\t\t\t\t\t\t\ttype = '?category=' + cat;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttype = '';\n\t\t\t\t\t\t\t\t\tcat = 'all';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!confObj.conversions) {\n\t\t\t\t\t\t\t\t\tconfObj.conversions = {};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!confObj.conversions[cat]) {\n\t\t\t\t\t\t\t\t\tdfd = $.getJSON('https://api2.online-convert.com/conversions' + type);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdfd = $.Deferred().resolve(confObj.conversions[cat]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdfd.done(function(d) {\n\t\t\t\t\t\t\t\t\tconfObj.conversions[cat] = d;\n\t\t\t\t\t\t\t\t\t$.each(d, function(i, o) {\n\t\t\t\t\t\t\t\t\t\tbtns[set.useTabs? 'children' : 'find']('.onlineconvert-category-' + o.category).children('.onlineconvert-' + o.target).trigger('makeoption', o);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tdone && done();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbtns = (function() {\n\t\t\t\t\t\tvar btns = $('<div/>').on('click', 'button', function() {\n\t\t\t\t\t\t\t\tvar b = $(this),\n\t\t\t\t\t\t\t\t\topts = b.data('opts') || null,\n\t\t\t\t\t\t\t\t\tcat = b.closest('.onlineconvert-category').data('cname'),\n\t\t\t\t\t\t\t\t\tcon = b.data('conv');\n\t\t\t\t\t\t\t\tif (confObj.api === true) {\n\t\t\t\t\t\t\t\t\tapi({\n\t\t\t\t\t\t\t\t\t\tcategory: cat,\n\t\t\t\t\t\t\t\t\t\tconvert: con,\n\t\t\t\t\t\t\t\t\t\toptions: opts\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).on('change', function(e) {\n\t\t\t\t\t\t\t\tvar t = $(e.target),\n\t\t\t\t\t\t\t\t\tp = t.parent(), \n\t\t\t\t\t\t\t\t\tb = t.closest('.elfinder-edit-onlineconvert-button').children('button:first'),\n\t\t\t\t\t\t\t\t\to = b.data('opts') || {},\n\t\t\t\t\t\t\t\t\tv = p.data('type') === 'boolean'? t.is(':checked') : t.val();\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tif (v) {\n\t\t\t\t\t\t\t\t\tif (p.data('type') === 'integer') {\n\t\t\t\t\t\t\t\t\t\tv = parseInt(v);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (p.data('pattern')) {\n\t\t\t\t\t\t\t\t\t\tvar reg = new RegExp(p.data('pattern'));\n\t\t\t\t\t\t\t\t\t\tif (!reg.test(v)) {\n\t\t\t\t\t\t\t\t\t\t\trequestAnimationFrame(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tfm.error('\"' + fm.escape(v) + '\" is not match to \"/' + fm.escape(p.data('pattern')) + '/\"');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tv = null;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (v) {\n\t\t\t\t\t\t\t\t\to[t.parent().data('optkey')] = v;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdelete o[p.data('optkey')];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tb.data('opts', o);\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tul = $('<ul/>'),\n\t\t\t\t\t\t\toform = function(n, o) {\n\t\t\t\t\t\t\t\tvar f = $('<p/>').data('optkey', n).data('type', o.type),\n\t\t\t\t\t\t\t\t\tchecked = '',\n\t\t\t\t\t\t\t\t\tdisabled = '',\n\t\t\t\t\t\t\t\t\tnozip = false,\n\t\t\t\t\t\t\t\t\topts, btn, elm;\n\t\t\t\t\t\t\t\tif (o.description) {\n\t\t\t\t\t\t\t\t\tf.attr('title', fm.i18n(o.description));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (o.pattern) {\n\t\t\t\t\t\t\t\t\tf.data('pattern', o.pattern);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tf.append($('<span/>').text(fm.i18n(n) + ' : '));\n\t\t\t\t\t\t\t\tif (o.type === 'boolean') {\n\t\t\t\t\t\t\t\t\tif (o['default'] || (nozip = (n === 'allow_multiple_outputs' && !allowZip))) {\n\t\t\t\t\t\t\t\t\t\tchecked = ' checked';\n\t\t\t\t\t\t\t\t\t\tif (nozip) {\n\t\t\t\t\t\t\t\t\t\t\tdisabled = ' disabled';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbtn = this.children('button:first');\n\t\t\t\t\t\t\t\t\t\topts = btn.data('opts') || {};\n\t\t\t\t\t\t\t\t\t\topts[n] = true;\n\t\t\t\t\t\t\t\t\t\tbtn.data('opts', opts);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tf.append($('<input type=\"checkbox\" value=\"true\"'+checked+disabled+'/>'));\n\t\t\t\t\t\t\t\t} else if (o['enum']){\n\t\t\t\t\t\t\t\t\telm = $('<select/>').append($('<option value=\"\"/>').text('Select...'));\n\t\t\t\t\t\t\t\t\t$.each(o['enum'], function(i, v) {\n\t\t\t\t\t\t\t\t\t\telm.append($('<option value=\"'+v+'\"/>').text(v));\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tf.append(elm);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tf.append($('<input type=\"text\" value=\"\"/>'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn f;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmakeOption = function(o) {\n\t\t\t\t\t\t\t\tvar elm = this,\n\t\t\t\t\t\t\t\t\tb = $('<span class=\"elfinder-button-icon elfinder-button-icon-preference\"/>').on('click', function() {\n\t\t\t\t\t\t\t\t\t\tf.toggle();\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tf = $('<div class=\"elfinder-edit-onlinconvert-options\"/>').hide();\n\t\t\t\t\t\t\t\tif (o.options) {\n\t\t\t\t\t\t\t\t\t$.each(o.options, function(k, v) {\n\t\t\t\t\t\t\t\t\t\tk !== 'download_password' && f.append(oform.call(elm, k, v));\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telm.append(b, f);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tts = (+new Date()),\n\t\t\t\t\t\t\ti = 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!confObj.ext2mime) {\n\t\t\t\t\t\t\tconfObj.ext2mime = Object.assign(fm.arrayFlip(fm.mimeTypes), ext2mime);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$.each(set.conv, function(t, c) {\n\t\t\t\t\t\t\tvar cname = t.toLowerCase(),\n\t\t\t\t\t\t\t\tid = 'elfinder-edit-onlineconvert-' + cname + ts,\n\t\t\t\t\t\t\t\ttype = $('<div id=\"' + id + '\" class=\"onlineconvert-category onlineconvert-category-'+cname+'\"/>').data('cname', t),\n\t\t\t\t\t\t\t\tcext;\n\t\t\t\t\t\t\t$.each(c, function(n, o) {\n\t\t\t\t\t\t\t\tvar nl = n.toLowerCase(),\n\t\t\t\t\t\t\t\t\text = getExt(t, n);\n\t\t\t\t\t\t\t\tif (!confObj.ext2mime[ext]) {\n\t\t\t\t\t\t\t\t\tif (cname === 'audio' || cname === 'image' || cname === 'video') {\n\t\t\t\t\t\t\t\t\t\tconfObj.ext2mime[ext] = cname + '/x-' + nl;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconfObj.ext2mime[ext] = 'application/octet-stream';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (fm.uploadMimeCheck(confObj.ext2mime[ext], file.phash)) {\n\t\t\t\t\t\t\t\t\ttype.append($('<div class=\"elfinder-edit-onlineconvert-button onlineconvert-'+nl+'\"/>').on('makeoption', function(e, data) {\n\t\t\t\t\t\t\t\t\t\tvar elm = $(this);\n\t\t\t\t\t\t\t\t\t\tif (!elm.children('.elfinder-button-icon-preference').length) {\n\t\t\t\t\t\t\t\t\t\t\tmakeOption.call(elm, data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}).append($('<button/>').text(n).data('conv', n)));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (type.children().length) {\n\t\t\t\t\t\t\t\tul.append($('<li/>').append($('<a/>').attr('href', selfUrl + '#' + id).text(t)));\n\t\t\t\t\t\t\t\tbtns.append(type);\n\t\t\t\t\t\t\t\tidxs[cname] = i++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (set.useTabs) {\n\t\t\t\t\t\t\tbtns.prepend(ul).tabs({\n\t\t\t\t\t\t\t\tbeforeActivate: function(e, ui) {\n\t\t\t\t\t\t\t\t\tsetOptions(ui.newPanel.data('cname'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$.each(set.conv, function(t) {\n\t\t\t\t\t\t\t\tvar tl = t.toLowerCase();\n\t\t\t\t\t\t\t\tbtns.append($('<fieldset class=\"onlineconvert-fieldset-' + tl + '\"/>').append($('<legend/>').text(t)).append(btns.children('.onlineconvert-category-' + tl)));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn btns;\n\t\t\t\t\t})(),\n\t\t\t\t\tselect = $(this)\n\t\t\t\t\t\t.append(\n\t\t\t\t\t\t\tbtns,\n\t\t\t\t\t\t\t(set.showLink? $(set.link) : null)\n\t\t\t\t\t\t),\n\t\t\t\t\tspnr = $('<div class=\"elfinder-edit-spinner elfinder-edit-onlineconvert\"/>')\n\t\t\t\t\t\t.hide()\n\t\t\t\t\t\t.html('<span class=\"elfinder-spinner-text\">' + fm.i18n('nowLoading') + '</span><span class=\"elfinder-spinner\"/>')\n\t\t\t\t\t\t.appendTo(select.parent()),\n\t\t\t\t\tprog = $('<div class=\"elfinder-quicklook-info-progress\"/>').appendTo(spnr),\n\t\t\t\t\t_url = null,\n\t\t\t\t\turl = function() {\n\t\t\t\t\t\tvar onetime;\n\t\t\t\t\t\tif (_url) {\n\t\t\t\t\t\t\treturn $.Deferred().resolve(_url);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tspnr.show();\n\t\t\t\t\t\t\treturn fm.forExternalUrl(file.hash, { progressBar: prog }).done(function(url) {\n\t\t\t\t\t\t\t\t_url = url;\n\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t}).always(function() {\n\t\t\t\t\t\t\t\tspnr.hide();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tapi = function(opts) {\n\t\t\t\t\t\t$(ta).data('dfrd', url().done(function(url) {\n\t\t\t\t\t\t\tselect.fadeOut();\n\t\t\t\t\t\t\tsetStatus({info: 'Start conversion request.'});\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tcmd: 'editor',\n\t\t\t\t\t\t\t\t\tname: 'OnlineConvert',\n\t\t\t\t\t\t\t\t\tmethod: 'api',\n\t\t\t\t\t\t\t\t\t'args[category]' : opts.category.toLowerCase(),\n\t\t\t\t\t\t\t\t\t'args[convert]'  : opts.convert.toLowerCase(),\n\t\t\t\t\t\t\t\t\t'args[options]'  : JSON.stringify(opts.options),\n\t\t\t\t\t\t\t\t\t'args[source]'   : fm.convAbsUrl(url),\n\t\t\t\t\t\t\t\t\t'args[filename]' : fm.splitFileExtention(file.name)[0] + '.' + getExt(opts.category, opts.convert),\n\t\t\t\t\t\t\t\t\t'args[mime]'     : file.mime\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\t\tcheckRes(data.apires, opts.category, opts.convert);\n\t\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}));\n\t\t\t\t\t},\n\t\t\t\t\tcheckRes = function(res, cat, con) {\n\t\t\t\t\t\tvar status, err = [];\n\t\t\t\t\t\tif (res && res.id) {\n\t\t\t\t\t\t\tstatus = res.status;\n\t\t\t\t\t\t\tif (status.code === 'failed') {\n\t\t\t\t\t\t\t\tspnr.hide();\n\t\t\t\t\t\t\t\tif (res.errors && res.errors.length) {\n\t\t\t\t\t\t\t\t\t$.each(res.errors, function(i, o) {\n\t\t\t\t\t\t\t\t\t\to.message && err.push(o.message);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfm.error(err.length? err : status.info);\n\t\t\t\t\t\t\t\tselect.fadeIn();\n\t\t\t\t\t\t\t} else if (status.code === 'completed') {\n\t\t\t\t\t\t\t\tupload(res);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetStatus(status);\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tpolling(res.id);\n\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuiToast.appendTo(ta.closest('.ui-dialog'));\n\t\t\t\t\t\t\tif (res.message) {\n\t\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\t\tmsg: fm.i18n(res.message),\n\t\t\t\t\t\t\t\t\tmode: 'error',\n\t\t\t\t\t\t\t\t\ttimeOut: 5000,\n\t\t\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\t\t\tuiToast.children().length === 1 && uiToast.appendTo(fm.getUI());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfm.toast({\n\t\t\t\t\t\t\t\tmsg: fm.i18n('editorConvNoApi'),\n\t\t\t\t\t\t\t\tmode: 'error',\n\t\t\t\t\t\t\t\ttimeOut: 3000,\n\t\t\t\t\t\t\t\tonHidden: function() {\n\t\t\t\t\t\t\t\t\tuiToast.children().length === 1 && uiToast.appendTo(fm.getUI());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tspnr.hide();\n\t\t\t\t\t\t\tselect.show();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tsetStatus = function(status) {\n\t\t\t\t\t\tspnr.show().children('.elfinder-spinner-text').text(status.info);\n\t\t\t\t\t},\n\t\t\t\t\tpolling = function(jobid) {\n\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcmd: 'editor',\n\t\t\t\t\t\t\t\tname: 'OnlineConvert',\n\t\t\t\t\t\t\t\tmethod: 'api',\n\t\t\t\t\t\t\t\t'args[jobid]': jobid\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t}).done(function(data) {\n\t\t\t\t\t\t\tcheckRes(data.apires);\n\t\t\t\t\t\t}).fail(function(error) {\n\t\t\t\t\t\t\terror && fm.error(error);\n\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tupload = function(res) {\n\t\t\t\t\t\tvar output = res.output,\n\t\t\t\t\t\t\tid = res.id,\n\t\t\t\t\t\t\turl = '';\n\t\t\t\t\t\tspnr.hide();\n\t\t\t\t\t\tif (output && output.length) {\n\t\t\t\t\t\t\tta.elfinderdialog('destroy');\n\t\t\t\t\t\t\t$.each(output, function(i, o) {\n\t\t\t\t\t\t\t\tif (o.uri) {\n\t\t\t\t\t\t\t\t\turl += o.uri + '\\n';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfm.upload({\n\t\t\t\t\t\t\t\ttarget: file.phash,\n\t\t\t\t\t\t\t\tfiles: [url],\n\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\textraData: {\n\t\t\t\t\t\t\t\t\tcontentSaveId: 'OnlineConvert-' + res.id\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmode = 'document',\n\t\t\t\t\tcl, m;\n\t\t\t\tselect.parent().css({overflow: 'auto'}).addClass('overflow-scrolling-touch');\n\t\t\t\tif (m = file.mime.match(/^(audio|image|video)/)) {\n\t\t\t\t\tmode = m[1];\n\t\t\t\t}\n\t\t\t\tif (set.useTabs) {\n\t\t\t\t\tif (idxs[mode]) {\n\t\t\t\t\t\tbtns.tabs('option', 'active', idxs[mode]);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcl = Object.keys(set.conv).length;\n\t\t\t\t\t$.each(set.conv, function(t) {\n\t\t\t\t\t\tif (t.toLowerCase() === mode) {\n\t\t\t\t\t\t\tsetOptions(t, function() {\n\t\t\t\t\t\t\t\t$.each(set.conv, function(t0) {\n\t\t\t\t\t\t\t\t\tt0.toLowerCase() !== mode && setOptions(t0);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcl--;\n\t\t\t\t\t});\n\t\t\t\t\tif (!cl) {\n\t\t\t\t\t\t$.each(set.conv, function(t) {\n\t\t\t\t\t\t\tsetOptions(t);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tselect.parent().scrollTop(btns.children('.onlineconvert-fieldset-' + mode).offset().top);\n\t\t\t\t}\n\t\t\t},\n\t\t\tload : function() {},\n\t\t\tgetContent : function() {},\n\t\t\tsave : function() {},\n\t\t\t// On dialog closed\n\t\t\tclose : function(ta) {\n\t\t\t\tvar fm = this.fm,\n\t\t\t\t\tdfrd = $(ta).data('dfrd');\n\t\t\t\tif (dfrd && dfrd.state() === 'pending') {\n\t\t\t\t\tdfrd.reject();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t];\n});\n\ndefine('skylark-elfinder/extras/quicklook.googledocs',[\n\t\"../elFinder\",\n\t\"../commands/quicklook\"\n],function(elFinder){\n\t\"use strict\";\n\ttry {\n\t\tif (! elFinder.prototype.commands.quicklook.plugins) {\n\t\t\telFinder.prototype.commands.quicklook.plugins = [];\n\t\t}\n\t\telFinder.prototype.commands.quicklook.plugins.push(function(ql) {\n\t\t\tvar fm      = ql.fm,\n\t\t\t\tpreview = ql.preview;\n\t\t\t\t\n\t\t\tpreview.on('update', function(e) {\n\t\t\t\tvar win  = ql.window,\n\t\t\t\t\tfile = e.file, node, loading;\n\t\t\t\t\n\t\t\t\tif (file.mime.indexOf('application/vnd.google-apps.') === 0) {\n\t\t\t\t\tif (file.url == '1') {\n\t\t\t\t\t\tpreview.hide();\n\t\t\t\t\t\t$('<div class=\"elfinder-quicklook-info-data\"><button class=\"elfinder-info-button\">'+fm.i18n('getLink')+'</button></div>').appendTo(ql.info.find('.elfinder-quicklook-info'))\n\t\t\t\t\t\t.on('click', function() {\n\t\t\t\t\t\t\t$(this).html('<span class=\"elfinder-spinner\">');\n\t\t\t\t\t\t\tfm.request({\n\t\t\t\t\t\t\t\tdata : {cmd : 'url', target : file.hash},\n\t\t\t\t\t\t\t\tpreventDefault : true\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.always(function() {\n\t\t\t\t\t\t\t\tpreview.show();\n\t\t\t\t\t\t\t\t$(this).html('');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\n\t\t\t\t\t\t\t\tql.value.url = rfile.url = data.url || '';\n\t\t\t\t\t\t\t\tif (ql.value.url) {\n\t\t\t\t\t\t\t\t\tpreview.trigger($.Event('update', {file : ql.value}));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (file.url !== '' && file.url != '1') {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\t\tloading = $('<div class=\"elfinder-quicklook-info-data\"><span class=\"elfinder-spinner-text\">'+fm.i18n('nowLoading')+'</span><span class=\"elfinder-spinner\"/></div>').appendTo(ql.info.find('.elfinder-quicklook-info'));\n\n\t\t\t\t\t\tnode = $('<iframe class=\"elfinder-quicklook-preview-iframe\"/>')\n\t\t\t\t\t\t\t.css('background-color', 'transparent')\n\t\t\t\t\t\t\t.on('load', function() {\n\t\t\t\t\t\t\t\tql.hideinfo();\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\tnode.css('background-color', '#fff');\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.on('error', function() {\n\t\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.appendTo(preview)\n\t\t\t\t\t\t\t.attr('src', fm.url(file.hash));\n\n\t\t\t\t\t\tpreview.one('change', function() {\n\t\t\t\t\t\t\tloading.remove();\n\t\t\t\t\t\t\tnode.off('load').remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t});\n\t} catch(e) {}\n\n\n\treturn elFinder;\n});\n\ndefine('skylark-elfinder/main',[\r\n\t\"skylark-jqueryui\",\r\n\t//<!-- elfinder core -->\r\n\t\"./elFinder\",\r\n\t\"./version\",\r\n\t\"./jquery.elfinder\",\r\n\t\"./mimetypes\",\r\n\t\"./options\",\r\n\t\"./options.netmount\",\r\n\t\"./history\",\r\n\t\"./command\",\r\n\t\"./resources\",\r\n\r\n\t//<!-- elfinder dialog -->\r\n\t\"./jquery.dialogelfinder\",\r\n\r\n\t//<!-- elfinder default lang -->\r\n\t\"./i18n/elfinder.en\",\r\n\r\n\t//<!-- elfinder ui -->\r\n\t\"./ui/button\",\r\n\t\"./ui/contextmenu\",\r\n\t\"./ui/cwd\",\r\n\t\"./ui/dialog\",\r\n\t\"./ui/fullscreenbutton\",\r\n\t\"./ui/navbar\",\r\n\t\"./ui/navdock\",\r\n\t\"./ui/overlay\",\r\n\t\"./ui/panel\",\r\n\t\"./ui/path\",\r\n\t\"./ui/places\",\r\n\t\"./ui/searchbutton\",\r\n\t\"./ui/sortbutton\",\r\n\t\"./ui/stat\",\r\n\t\"./ui/toast\",\r\n\t\"./ui/toolbar\",\r\n\t\"./ui/tree\",\r\n\t\"./ui/uploadButton\",\r\n\t\"./ui/viewbutton\",\r\n\t\"./ui/workzone\",\r\n\r\n\t//<!-- elfinder commands -->\r\n\t\"./commands/archive\",\r\n\t\"./commands/back\",\r\n\t\"./commands/chmod\",\r\n\t\"./commands/colwidth\",\r\n\t\"./commands/copy\",\r\n\t\"./commands/cut\",\r\n\t\"./commands/download\",\r\n\t\"./commands/duplicate\",\r\n\t\"./commands/edit\",\r\n\t\"./commands/empty\",\r\n\t\"./commands/extract\",\r\n\t\"./commands/forward\",\r\n\t\"./commands/fullscreen\",\r\n\t\"./commands/getfile\",\r\n\t\"./commands/help\",\r\n\t\"./commands/hidden\",\r\n\t\"./commands/hide\",\r\n\t\"./commands/home\",\r\n\t\"./commands/info\",\r\n\t\"./commands/mkdir\",\r\n\t\"./commands/mkfile\",\r\n\t\"./commands/netmount\",\r\n\t\"./commands/open\",\r\n\t\"./commands/opendir\",\r\n\t\"./commands/opennew\",\r\n\t\"./commands/paste\",\r\n\t\"./commands/places\",\r\n\t\"./commands/preference\",\r\n\t\"./commands/quicklook\",\r\n\t\"./commands/quicklook.plugins\",\r\n\t\"./commands/reload\",\r\n\t\"./commands/rename\",\r\n\t\"./commands/resize\",\r\n\t\"./commands/restore\",\r\n\t\"./commands/rm\",\r\n\t\"./commands/search\",\r\n\t\"./commands/selectall\",\r\n\t\"./commands/selectinvert\",\r\n\t\"./commands/selectnone\",\r\n\t\"./commands/sort\",\r\n\t\"./commands/undo\",\r\n\t\"./commands/up\",\r\n\t\"./commands/upload\",\r\n\t\"./commands/view\",\r\n\r\n\t//<!-- elfinder 1.x connector API support (OPTIONAL) -->\r\n\t\"./proxy/elFinderSupportVer1\",\r\n\r\n\t//<!-- Extra contents editors (OPTIONAL) -->\r\n\t\"./extras/editors.default\",\r\n\r\n\t//<!-- GoogleDocs Quicklook plugin for GoogleDrive Volume (OPTIONAL) -->\r\n\t\"./extras/quicklook.googledocs\"\r\n\r\n\r\n],function($,elFinder){\r\n\treturn elFinder;\r\n});\ndefine('skylark-elfinder', ['skylark-elfinder/main'], function (main) { return main; });\n\n"]}